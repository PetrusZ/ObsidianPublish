{"/+-Encounters/%E7%AC%94%E8%AE%B0/obsidian":{"title":"obsidian","content":"\n# æ–¹æ³•è®º\n\n[[+ Encounters/ç¬”è®°/ç¬”è®°æ–¹æ³•è®º]]\n\n# æ•™ç¨‹\n\n- æ’ä»¶\n\t- [ChatV: Obsidianï¼Œå¯èƒ½æ˜¯æœ€é€‚åˆåšä¸ªäººçŸ¥è¯†åº“çš„è½¯ä»¶ â€”â€” å¤‡æ³¨ï¼šæœ¬å¸–å°†æŒç»­æ›´æ–°ã€‚æœ‰éœ€è¦çš„å³å‹ï¼Œå¯è½¬å‘æˆ–æ”¶è—ï¼Œä¾¿äºæŸ¥çœ‹æ›´æ–°ã€‚ â€”â€” é…ç½®å¥½çš„ Obsidianï¼Œä¸åˆšå¼€å§‹æ¥è§¦çš„ Obsidianï¼Œçœ‹èµ·æ¥å®Œå…¨åƒä¸¤ä¸ªä¸åŒçš„ä¸œè¥¿ã€‚ åˆšå¼€å§‹ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä¸ç¦ç–‘æƒ‘ï¼šå°±è¿™ï¼Ÿç½‘ä¸Šå¾ˆå¤šäººç§°èµï¼Œä½†æˆ‘è§‰å¾—è¿™ä¸å°±ä¸€ Markdown ç¼–è¾‘å™¨å—ï¼Œè¿ Typora éƒ½ä¸å¦‚ã€‚ ä½†æ˜¯ - å³åˆ»](https://web.okjike.com/originalPost/6317dd9989e1f3feb56f30b2)\n\t- [Obsidian æ–°æ‰‹ç³»åˆ—ä¹‹ä½ ä¸å¯ä¸çŸ¥çš„æ’ä»¶ - ç»éªŒåˆ†äº« - Obsidian ä¸­æ–‡è®ºå›](https://forum-zh.obsidian.md/t/topic/194)\n\t- [obsidianæ’ä»¶ä¹‹dataviewå…¥é—¨ - ç»éªŒåˆ†äº« - Obsidian ä¸­æ–‡è®ºå›](https://forum-zh.obsidian.md/t/topic/195)\n\t- [Obsidianæœ€å¼ºæ’ä»¶ï¼šquickadd :: å–œäºå¾®](https://lillianwho.com/posts/obsidian/obsidian%E6%9C%80%E5%BC%BA%E6%8F%92%E4%BB%B6quickadd/)\n\t- [æˆ‘çš„ Obsidian å·¥ä½œæµï¼šæ¨¡æ¿+QuickAdd+Dataview å¿«é€Ÿåˆ›å»ºå’Œè‡ªåŠ¨ç´¢å¼• :: å–œäºå¾®](https://lillianwho.com/posts/obsidian/obsidian%E5%B7%A5%E4%BD%9C%E6%B5%81/)\n\t\t- é—ªå¿µç¬”è®°ï¼šéšæ—¶è®°å½•é—ªå¿µï¼Œåˆ°å½“å¤©æ—¥è®°ã€‚å¦‚æœæœ‰éœ€è¦å±•å¼€çš„é—ªå¿µï¼Œåˆ™åœ¨æ—¶é—´å……è£•æ—¶å•ç‹¬åšä¸€å¼ å¡ç‰‡ã€‚\n\t\t- æ–‡çŒ®ç¬”è®°ï¼šå³é˜…è¯»å’Œè§‚å½±ç¬”è®°ã€‚é˜…è¯»äº§ç”Ÿçš„æ€è€ƒä¼šåœ¨é˜…è¯»å®Œä¹‹åæ‹†åˆ†åˆ°æ–°çš„å¡ç‰‡ã€‚\n\t\t- é¡¹ç›®ç¬”è®°ï¼šä¸ºå†™ä½œè€ŒæœåŠ¡ï¼Œåˆ†ä¸ºçµæ„Ÿææ¡ˆã€å†™ä½œä¸­çš„æ–‡ç« å’Œå·²å®Œæˆçš„æ–‡ç« ã€‚\n- ç»¼åˆ\n\t- [Obsidianæ–‡æ¡£å’–å•¡è±†ç‰ˆ | obsidianæ–‡æ¡£å’–å•¡è±†ç‰ˆ](https://coffeetea.top/zh/)\n\t- [2021å¹´æ–°æ•™ç¨‹ - Obsidianä¸­æ–‡æ•™ç¨‹ - Obsidian Publish](https://publish.obsidian.md/chinesehelp/01+2021%E6%96%B0%E6%95%99%E7%A8%8B/2021%E5%B9%B4%E6%96%B0%E6%95%99%E7%A8%8B)\n\t- ç©è½¬ obsidian\n\t\t-   ã€Š[ç©è½¬ Obsidian 01ï¼šç”¨ Obsidian æ‰“é€ ã€ŒçŸ¥è¯†å¾ªç¯ã€åˆ©å™¨](https://xzsj.vip/2020/obsidian-01)ã€‹\n\t\t-   ã€Š[ç©è½¬ Obsidian 02ï¼šåŸºç¡€è®¾ç½®ç¯‡](https://xzsj.vip/2020/obsidian-02)ã€‹\n\t\t-   ã€Š[ç©è½¬ Obsidian 03ï¼šå¦‚ä½•è®°å½•ã€Œé—´æ­‡å¼æ—¥è®°ã€](https://xzsj.vip/2020/obsidian-03)ã€‹\n\t\t-   ã€Š[ç©è½¬ Obsidian 04ï¼šä¸ºä»€ä¹ˆæ¨èä½¿ç”¨ Obsidian åšçŸ¥è¯†ç®¡ç†](https://xzsj.vip/2021/obsidian-04)ã€‹\n\t\t-   ã€Š[ç©è½¬ Obsidian 05ï¼šå¦‚ä½•è¿›è¡Œé˜…è¯»åŠæ‘˜è¦](https://xzsj.vip/2021/obsidian-05)ã€‹\n\t\t-   ã€Š[ç©è½¬ Obsidian 06ï¼šå¦‚ä½•ç”¨ Obsidian è¿›è¡Œæ¸è¿›å¼æ€»ç»“](https://xzsj.vip/2021/obsidian-06)ã€‹\n\t\t-   ã€Š[ç©è½¬ Obsidian 07 ï¼šè‡ªåŠ¨åŒ–ã€Œé—´æ­‡å¼æ—¥è®°ã€](https://xzsj.vip/2021/obsidian-07)ã€‹\n\t\t-   ã€Š[ç©è½¬ Obsidian 08ï¼šåˆ©ç”¨ Dataview æ‰“é€ è‡ªåŠ¨åŒ– HomePage](https://xzsj.vip/2022/obsidian-08)ã€‹ \n- å·¥ä½œæµ\n\t- [å·¥ä½œæµåˆæ¢ | obsidianæ–‡æ¡£å’–å•¡è±†ç‰ˆ](https://coffeetea.top/zh/workflow/workflow-guide.html)\n- ä¸‰å¤§åŸåˆ™\n\t- é“¾æ¥\n\t\t- link first, folder least.\n\t\t- å°½é‡å°‘çš„å»ºç«‹å±‚çº§\n\t\t- é€šè¿‡â€œä¸­æ¢â€æ–¹å¼åˆ›å»ºæ–°ç¬”è®°\n\t- æ ‡ç­¾\n\t\t- æ ‡é¢˜åˆ†ç±»ï¼Œæ ‘çŠ¶ã€namespace ç±»ä¼¼\n\t\t- æ ‡ç­¾ä½ç½®ï¼Œfont matter æˆ–æœ€å‰ã€æœ€å\n\t\t- æ ‡ç­¾è¦åˆ†çš„å¾ˆç¢ï¼Œåªè®²ä¸€ä¸ªä¸œè¥¿ã€‚ç²¾ç»†çš„ç»„åˆï¼å…¨é¢çš„æ¦‚æ‹¬ã€‚å±‚çº§æ— é™æ‰©å±•ï¼Œé€‚å½“å°±å¥½\n\t  - æ¨¡æ¿\n\t\t  - æ€ç»´å¯¼å›¾ï¼šåœ¨åŸæœ‰æ–‡ä»¶ä¸­å†™æ¸…æ¥šç»“æ„ï¼Œç„¶åå¯¼å…¥ä¸º markdown\n\t\t  - æ’ä»¶ï¼šadvanced cursorsã€templaterã€quickadd\n\t\t  - quickaddï¼šcapture å¿«é€Ÿæ·»åŠ \n\t\t  - æ…é‡å®šç»“æ„çµæ´»ç”¨ç‰‡æ®µ\n\n# æ–‡ä»¶å¤¹ç»“æ„\n\n![[Extras/Images/Pasted Graphic.png]]\n\n# æ’ä»¶\n\n![[Extras/Images/Pasted Graphic 1.png]]\n\n# å¿«æ·é”®\n\n## é»˜è®¤\n\n- `Cmd-E` ï¼šç¼–è¾‘ã€é¢„è§ˆæ¨¡å¼åˆ‡æ¢\n- æŒ‰ä½Â `Cmd`Â ç‚¹å‡»é“¾æ¥ï¼šåœ¨æ–°é¢æ¿ä¸­æ‰“å¼€è¯¥é“¾æ¥\n- ç¼–è¾‘æ¨¡å¼ä¸‹æŒ‰ä½ `Cmd` å†å•å‡»é“¾æ¥ï¼šè·³è½¬é“¾æ¥\n- `Cmd-alt-å·¦æ–¹å‘é”®` æˆ– `é¼ æ ‡ä¾§é”®`ï¼šå›åˆ°ä¹‹å‰çš„é¡µé¢\n- `Cmd-P`ï¼šæ‰“å¼€å‘½ä»¤é¢æ¿\n- `Ctrl-Enter`ï¼šåˆ‡æ¢ list å’Œ todo\n- `Ctrl-T`ï¼šç¼–è¾‘æˆ–æ–°å»º task\n- `Ctrl-D`ï¼šæ‰“å¼€æˆ–æ–°å»ºå½“å¤©æ—¥è®°\n- `Alt+é¼ æ ‡å•å‡»`ï¼šå¤šå…‰æ ‡æ“ä½œ\n\n## æ’ä»¶\n\n- `cmd+ctrl+p` omnisearch value æœç´¢\n- `cmd+ctrl+f` omnisearch file æœç´¢\n- `cmd+shift+p` better command palette\n- `cmd+shft+o`\n- `cmd+o`\n\n# TODO\n\n- [x] åˆæ­¥æ•´ç† obsidian æ­£ç¡®ä½¿ç”¨å§¿åŠ¿ä»¥åŠæ–¹æ³•è®º âœ… 2023-05-03\n- [ ] ç™½æ¿ä¸ Excalidraw å¯¹æ¯”\n- [x] ä»€ä¹ˆæ˜¯å¡ç‰‡ç¬”è®° âœ… 2023-05-03\n","lastmodified":"2023-05-18T16:10:29.684349606Z","tags":["Inbox"]},"/Atlas/MOCs/broken-links-output":{"title":"broken links output","content":"Don't forget that creating the file from here may create the file in the wrong directory!\n- [[Calendar/Daily notes/2023/04/4æœˆ28, 2023, å‘¨äº”]] in [[Calendar/Daily notes/2023/04/4æœˆ29, 2023, å‘¨å…­]]\n- [[Calendar/Daily notes/2023/05/5æœˆ4, 2023, å‘¨å››]] in [[Calendar/Daily notes/2023/05/5æœˆ3, 2023, å‘¨ä¸‰]], [[Calendar/Daily notes/2023/05/5æœˆ5, 2023, å‘¨äº”]]\n- [[Calendar/Daily notes/2023/05/5æœˆ6, 2023, å‘¨å…­]] in [[Calendar/Daily notes/2023/05/5æœˆ5, 2023, å‘¨äº”]]\n- [[Calendar/Daily notes/2023/05/5æœˆ8, 2023, å‘¨ä¸€]] in [[Calendar/Daily notes/2023/05/5æœˆ9, 2023, å‘¨äºŒ]]\n- [[GitHub Copilot]] in [[Calendar/Daily notes/2023/05/5æœˆ9, 2023, å‘¨äºŒ]]\n- [[ç½‘é¡µæ”¶è—]] in [[Calendar/Daily notes/2023/05/5æœˆ13, 2023, å‘¨å…­]]\n- [[çŸ¥è¯†å¾ªç¯]] in [[Calendar/Daily notes/2023/05/5æœˆ13, 2023, å‘¨å…­]], [[+ Encounters/ç¬”è®°/ç¬”è®°æ–¹æ³•è®º]]\n- [[Meta PKM]] in [[+ Encounters/+ About Encounters]], [[Atlas/+ About Atlas]], [[Calendar/+ About Calendar]], [[Cards/+ About Cards]], [[Sources/+ About Sources]], [[Spaces/+ About Spaces]]\n- [[Inbox]] in [[+ Encounters/+ About Encounters]]\n- [[Home]] in [[Atlas/+ About Atlas]]\n- [[Information that crosses our attentional filter becomes knowledge]] in [[Cards/+ About Cards]]\n- [[æ°¸ä¹…ç¬”è®°]] in [[Cards/+ About Cards]], [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[é—ªå¿µç¬”è®°]] in [[Cards/+ About Cards]], [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[æ–‡çŒ®ç¬”è®°]] in [[Cards/+ About Cards]], [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[å¡ç‰‡ç¬”è®°]] in [[Cards/+ About Cards]]\n- [[MOC]] in [[Cards/+ About Cards]], [[Cards/LYT ç¬”è®°æ¡†æ¶]], [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[Calendar/Daily notes/2023/05/5æœˆ17, 2023, å‘¨ä¸‰]] in [[Calendar/Daily notes/2023/05/5æœˆ16, 2023, å‘¨äºŒ]]\n- [[Be tempted by power and clip countless articles into your PKM note library.]] in [[Sources/+ About Sources]]\n- [[Ask Gandalf for assistance.]] in [[Sources/+ About Sources]]\n- [[Efforts]] in [[Spaces/+ About Spaces]]\n- [[My Newsletter MOC]] in [[Spaces/+ About Spaces]]\n- [[/md/dev-spec/pattern/15_chain.html]] in [[Cards/CS/ElasticSearch/æŸ¥è¯¢ä¸èšåˆ]]\n- [[Linuxè¿›ç¨‹]] in [[Cards/CS/Golang/GMP]]\n- [[obsidianã€notionå’Œlogseqçš„å¼‚åŒåˆ†æåŠè½¯ä»¶é€‰ç”¨]] in [[Cards/LYT ç¬”è®°æ¡†æ¶]]\n- [[å¡ç‰‡ç›’ç¬”è®°æ³• - Zettelkasten]] in [[Cards/LYT ç¬”è®°æ¡†æ¶]]\n- [[æµåŠ¨å¼æ¡†æ¶]] in [[Cards/LYT ç¬”è®°æ¡†æ¶]]\n- [[å¦‚ä½•åšç¬”è®° note-making]] in [[Cards/LYT ç¬”è®°æ¡†æ¶]]\n- [[ACCESS ç¬”è®°ç»„ç»‡æ³•]] in [[Cards/LYT ç¬”è®°æ¡†æ¶]], [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[ç”¨effortsè€Œéprojectsæ€ç»´ï¼Œå»å‘å±•è‡ªå·±çš„æƒ³æ³•]] in [[Cards/LYT ç¬”è®°æ¡†æ¶]]\n- [[PKM çš„æŒ‡å¯¼æ€§åŸåˆ™ from lyt]] in [[Cards/LYT ç¬”è®°æ¡†æ¶]]\n- [[å¸¸é’ç¬”è®°]] in [[Cards/LYT ç¬”è®°æ¡†æ¶]]\n- [[ğŸ§‘Nick Milo]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[PKMç³»ç»Ÿçš„ä¸åŒä¾§é‡ç‚¹-å››è±¡é™å›¾ by lyt]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[æ–‡ä»¶å¤¹å’Œæ ‡ç­¾]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[âˆ‘ PKM]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[Dataview]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[2022-07-01]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[Text expand]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[2022-07-27]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[æ··åˆç¬”è®°æ³•]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[2022-07-04]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[è®¡åˆ’ä¸å›é¡¾]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[dailynote]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[+ Encounters/Daily noteså·¥ä½œæµ]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[PARAå’ŒMOCè”ç”¨ç»„ç»‡ç¬”è®°]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[Excalidraw]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[æ¨¡æ¿ä¸å¥—è·¯]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[é¡¹ç›®ç¬”è®°]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[PARA]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[Spaces ä¸­çš„ MAPS ç»„ç»‡æ–¹æ³•]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[2022-07-20]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[2022-08-05]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n- [[âˆ‘ æœ¬åº“ ACCESS çš„æ–‡ä»¶å¤¹å…¥å£æ±‡æ€»]] in [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]","lastmodified":"2023-05-18T16:10:29.92834953Z","tags":[]},"/Atlas/Tasks/Tasks":{"title":"Tasks","content":"# All Tasks\n\n```tasks\nlimit 100\ngroup by filename\nsort by due reverse\nsort by description\n# explain\n```","lastmodified":"2023-05-18T16:10:29.92834953Z","tags":[]},"/Calendar/Daily-notes/2023/04/4%E6%9C%8816-2023-%E5%91%A8%E6%97%A5":{"title":"4æœˆ16, 2023, å‘¨æ—¥","content":"- æ˜å¤©ç»§ç»­å¤„ç†è‡ªå®šä¹‰å·¥ä½œæµ [[Spaces/Zadig/æœåŠ¡å˜é‡]]\n\t- äº‘å™¨bugåˆæ­¥æ‰¾åˆ°åŸå› ï¼Œå¾…å¤ç°\n\t\t1. ä½¿ç”¨Studio 3Tå¯¼å‡ºæ•°æ®åº“\n\t\t2.  åœ¨productè¡¨é‡ŒæŸ¥æ‰¾åˆ°ï¼Œ`{ \"product_name\" : â€œ${projectName}, \"env_name\" : â€œ${envName}â€œ }`ï¼Œå¯¼å‡º\n\t\t3.  åœ¨ä¸Šé¢æŸ¥åˆ°æ•°æ®ä¸­ï¼Œæ‰¾å‡º`render.revisionå’Œservices[0].service_name`å’Œ`revision`\n\t\t4.  åœ¨render_setè¡¨é‡ŒæŸ¥æ‰¾ï¼Œ`{ \"product_tmpl\" : \"${projectName}\", \"revision\" : NumberLong(2) }`ï¼Œå¯¼å‡º\n\t\t5.  åœ¨product_template_service/template_serviceè¡¨ä¸­æŸ¥æ‰¾ï¼Œ`{ \"service_name\" : \"${serviceName}â€, \"product_name\" : \"${projectName}, \"revision\" : NumberLong(1) }`ï¼Œå¯¼å‡º\n\t\t6. è¿˜éœ€æŸ¥çœ‹æ“ä½œæ—¥å¿—ï¼ŒæŸ¥çœ‹æ˜¯æ€ä¹ˆéƒ¨ç½²çš„\n\t- å˜é‡åˆå¹¶æ— æ³•è§£å†³ï¼Œéœ€è¦æ›´æ–°è®¾è®¡","lastmodified":"2023-05-18T16:10:29.92834953Z","tags":[]},"/Calendar/Daily-notes/2023/04/4%E6%9C%8817-2023-%E5%91%A8%E4%B8%80":{"title":"4æœˆ17, 2023, å‘¨ä¸€","content":"- è‡ªå®šä¹‰å·¥ä½œæµ[[Spaces/Zadig/æœåŠ¡å˜é‡]] å¼€å‘ã€è°ƒè¯•\n\t- é…ç½®è‡ªå®šä¹‰å˜é‡å’Œæ‰§è¡Œæ—¶è·å–å€¼çš„æ¥å£æ²¡æœ‰åˆ†å¼€ï¼Œè€¦åˆå¤ªä¸¥é‡","lastmodified":"2023-05-18T16:10:29.92834953Z","tags":[]},"/Calendar/Daily-notes/2023/04/4%E6%9C%8818-2023-%E5%91%A8%E4%BA%8C":{"title":"4æœˆ18, 2023, å‘¨äºŒ","content":"- å‘ç‰ˆå›å½’æµ‹è¯•\n\t- [[Spaces/Zadig/æµ‹è¯•èµ„æº]]\n\t\t- æµ‹è¯•è„šæœ¬\n\t\t\t- https://zadigx-demo.koderover.com/v1/projects/detail/yaml-poc/test/function/pytest-yaml ã€‚demo/demo123ã€‚ä¸è¦æ‰§è¡Œå†™æ“ä½œ\n\t\t- æœºå™¨äººé€šçŸ¥\n\t\t\t- ä¼ä¸šå¾®ä¿¡æœºå™¨äººåœ°å€ï¼šhttps://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=dc80b1ee-49fc-4c11-b474-c29ae2d04f31\n\t\t\t- é’‰é’‰æœºå™¨äººåœ°å€ï¼šhttps://oapi.dingtalk.com/robot/send?access_token=b9c3d9236ef9d958d68ecbfb9aa60fbc7e3761457ac8bb1b29fd3892a805c6f2\n\t\t\t- é£ä¹¦æœºå™¨äººåœ°å€ï¼šhttps://open.feishu.cn/open-apis/bot/v2/hook/cfc3d4f4-ab80-4529-9dd5-8b45b46412ce\n\t\t\t\t- Liliançš„é£ä¹¦userIDï¼šc9b6e25c\n\t\t\t- æ–‡æ¡£ï¼š[https://docs.koderover.com/zadig/dev/project/workflow/#im-%E7%8A%B6%E6%80%81%E9%80%9A%E7%9F%A5](https://docs.koderover.com/zadig/dev/project/workflow/#im-%E7%8A%B6%E6%80%81%E9%80%9A%E7%9F%A5)\n\t- è‡ªå®šä¹‰å·¥ä½œæµï¼Œå›ºå®šç¯å¢ƒï¼Œenvä¸­å¸¦æœ‰\u003c+fixed\u003eå‰ç¼€ï¼Œé€ æˆè·å–productå‡ºé”™\n\t- FilterEnvæ¥å£500æŠ¥é”™\n\t\t- ![[Extras/Images/CleanShot 2023-04-18 at 21.08.31@2x.png]]\n\t- filterEnvæ£€æŸ¥tmplSvcæ˜¯å¦ä¸ºnil","lastmodified":"2023-05-18T16:10:29.92834953Z","tags":[]},"/Calendar/Daily-notes/2023/04/4%E6%9C%8820-2023-%E5%91%A8%E5%9B%9B":{"title":"4æœˆ20, 2023, å‘¨å››","content":"- å°è¯•[[Spaces/Zadig/å®‰è£…|å®‰è£…]]zadigï¼Œhelmå’Œplutus costomer\n- æ„æ€[[Spaces/Zadig/æœåŠ¡å˜é‡|å˜é‡]]æ–°è®¾è®¡","lastmodified":"2023-05-18T16:10:29.92834953Z","tags":[]},"/Calendar/Daily-notes/2023/04/4%E6%9C%8821-2023-%E5%91%A8%E4%BA%94":{"title":"4æœˆ21, 2023, å‘¨äº”","content":"- è®¨è®ºå˜é‡è®¾è®¡\n- é”™è¯¯ revision bug å¤„ç†","lastmodified":"2023-05-18T16:10:29.92834953Z","tags":[]},"/Calendar/Daily-notes/2023/04/4%E6%9C%8823-2023-%E5%91%A8%E6%97%A5":{"title":"4æœˆ23, 2023, å‘¨æ—¥","content":"- [[Spaces/Zadig/æœåŠ¡å˜é‡]]æ–°è®¾è®¡\n\t- unmarshal æ•°ç»„ yaml å¯ä»¥å®ç°ï¼Œä½†éœ€è¦å’Œ map ç±»å‹è¿›è¡ŒåŒºåˆ†ï¼Œåˆå¹¶åˆ° parent ä¹Ÿæ²¡æœ‰é—®é¢˜\n\t- yaml è½¬ kv è¿˜æ˜¯åŸæ¥æ–¹å¼ï¼Ÿåˆå¹¶åªæ˜¾ç¤ºç¬¬ä¸€å±‚çš„å€¼ï¼Œå®Œå…¨éœ€è¦å‰ç«¯æ¥è¯´ï¼Œåç«¯è¿˜æ˜¯ä¸å˜ï¼Ÿkv æ ¼å¼æ˜¯å¦è¦æ”¹å˜ï¼Ÿ\n\t- ç¡®è®¤ KV çš„ä½œç”¨\n\t- extract æ¨¡ç‰ˆç¬¬ä¸€å±‚ key éªŒè¯å¯è¡Œ\n - revision é”™è¯¯é—®é¢˜\n\t - æ˜¯ç”±äºè‡ªåŠ¨æ›´æ–°ï¼Œè¯¥åŠŸèƒ½åŸæœ¬åªæœ‰æµ‹è¯•æœåŠ¡æ‰æœ‰ï¼Œå®ƒæ›´æ–°äº†æ‰€æœ‰ç¯å¢ƒçš„åŒåæœåŠ¡é€ æˆçš„ï¼ŒåŒ…æ‹¬ç”Ÿäº§ç¯å¢ƒï¼Œè¦†ç›–äº†åŸæœ¬ç”Ÿäº§ç¯å¢ƒä¸­æ­£å¸¸çš„ revisionï¼Œå¤å†™æˆäº†æµ‹è¯•æœåŠ¡çš„ revision\n\t - æ£€æŸ¥äº†æ‰€æœ‰æŸ¥è¯¢ product çš„åœ°æ–¹ï¼Œæ·»åŠ äº†ä»…é™æµ‹è¯•æœåŠ¡çš„æ¡ä»¶\n\t - æŸ¥ä¸åˆ°tmplSvcéœ€è¦è¿”å›æŠ¥é”™è€Œä¸æ˜¯panic\n","lastmodified":"2023-05-18T16:10:29.92834953Z","tags":[]},"/Calendar/Daily-notes/2023/04/4%E6%9C%8824-2023-%E5%91%A8%E4%B8%80":{"title":"4æœˆ24, 2023, å‘¨ä¸€","content":"# Notes\n- ç»§ç»­ç ”ç©¶ [[Cards/ChatGPT]]\n\t- Azure OpenAI\n\t\t- https://azure.microsoft.com/zh-cn/products/cognitive-services/openai-service\n\t\t- å¾®è½¯ Azure æ˜¯ OpenAI ç‹¬å®¶äº‘æœåŠ¡æä¾›å•†ï¼Œå¯åœ¨äº‘å¹³å°ä¸Šç›´æ¥è°ƒç”¨ OpenAI æ¨¡å‹ï¼ŒåŒ…æ‹¬ GPT-3.5ã€Codex å’Œ DALL.E æ¨¡å‹ã€‚\n\t\t- GPT ä¸æ”¯æŒå¾®è°ƒæ¨¡å‹ã€‚ä½†å…¶ä»–æ¨¡å‹æ”¯æŒã€‚\n\t  - Chat2SQL\n\t\t   - ç”Ÿæˆ SQL\n\t\t\t   - æ¥æ”¶ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢è¯·æ±‚ï¼Œä¾‹å¦‚â€œæ¯ä¸ªå“ç‰Œçš„é€€æ¬¾é¢æ˜¯å¤šå°‘â€ï¼›\n\t\t   - è§£é‡Š SQL\n\t\t\t - â€œè¿™æ®µ SQL æ˜¯å¦å¯åšè¿›ä¸€æ­¥æ€§èƒ½ä¼˜åŒ–â€\n\t\t   - æµè§ˆå™¨æ’ä»¶å½¢å¼\n\t  - OpenAI Codex\n\t\t  - Github Copilot ä½¿ç”¨çš„å°±æ˜¯è¿™ä¸ª\n\t\t  - Codex å¯ä»¥æ€»ç»“å·²ç¼–å†™çš„å‡½æ•°ã€è§£é‡Š SQL æŸ¥è¯¢æˆ–è¡¨ï¼Œä»¥åŠå°†å‡½æ•°ä»ä¸€ç§ç¼–ç¨‹è¯­è¨€è½¬æ¢ä¸ºå¦ä¸€ç§ç¼–ç¨‹è¯­è¨€ã€‚\n\t -  ChatGPT + å‘é‡æ•°æ®åº“ï¼ˆvector databaseï¼‰+ prompt-as-code\n\t\t - æä¾›å›ç­”å‡†ç¡®æ€§\n\t\t - å‘é‡æ•°æ®åº“æ€§èƒ½ä¸å¥½\n\t - GPT æ¨¡å‹éå¸¸æ“…é•¿å®Œæˆè‹¥å¹²è‡ªç„¶è¯­è¨€ä»»åŠ¡ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š\n\t\t - æ±‡æ€»æ–‡æœ¬\n\t\t - å¯¹æ–‡æœ¬è¿›è¡Œåˆ†ç±»\n\t\t - ç”Ÿæˆåç§°æˆ–çŸ­è¯­\n\t\t - ç¿»è¯‘\n\t\t - å›ç­”é—®é¢˜\n\t\t - å»ºè®®å†…å®¹\n\t - è½»é‡ä½¿ç”¨åœºæ™¯\n\t\t - codex è¡¥å…¨ yamlã€~~åŸºäºæˆ‘ä»¬æä¾›çš„ yaml ä¾‹å­ï¼Œè¿›è¡Œå·¥ä½œæµ yaml æ ¼å¼æ ¡éªŒ~~ï¼Œå·¥ä½œæµ yaml è§£é‡Š\n\t\t - æ„å»ºè„šæœ¬ lintã€è§£é‡Š\n\t - æ¨¡å‹å¾®è°ƒ\n\t\t  - [Fine-tuning - OpenAI API](https://platform.openai.com/docs/guides/fine-tuning)\n\t\t  - å¯ä»¥è®­ç»ƒæ•°æ®\n\t - æ’ä»¶\n\t\t  - æ’ä»¶å¯ä»¥è·å–å®æ—¶æ•°æ®ï¼Œè·å–å¤©æ°”ã€è‚¡ç¥¨ã€æ–°é—»ç­‰ï¼›æ£€ç´¢çŸ¥è¯†åº“ä¿¡æ¯ï¼Œåƒå…¬å¸æ–‡æ¡£æˆ–ä¸ªäººç¬”è®°ï¼›ä»£è¡¨ç”¨æˆ·æ‰§è¡Œæ“ä½œï¼Œåƒæ˜¯é¢„å®šæœºç¥¨ï¼Œç‚¹å¤–å–ç­‰ã€‚\n\t\t  - [Introduction - OpenAI API](https://platform.openai.com/docs/plugins/introduction)\n - ç»§ç»­è®¨è®º[[Spaces/Zadig/æœåŠ¡å˜é‡]]ç»†èŠ‚\n\t - å˜æ›´å¤ªå¤šï¼Œå˜é‡æ¶‰åŠã€å…¥å£å¤ªå¤š\n\t - æœåŠ¡ä¸­æœ‰å…¨å±€å˜é‡æ¨¡å—ï¼Ÿé‚£ç¯å¢ƒå‘¢ï¼Ÿ\n\t - æ•°æ®å˜æ›´ç¡®è®¤\n\t - æ¥å£å˜æ›´\n\t\t  - å·¥ä½œæµè·å–å˜é‡æ¥å£\n- [[Spaces/Zadig/æœåŠ¡å˜é‡]]ç¡®å®šå†…å®¹\n\t- ä¿å­˜æœåŠ¡è‡ªåŠ¨è§£æå˜é‡\n\t- å…ˆåšæœ€æ ¸å¿ƒçš„åŠŸèƒ½\n\t- kv å’Œ yaml è½¬æ¢æ¥å£\n\t- ä½¿ç”¨å˜é‡æ—¶ï¼Œåªä»¥ kv ä¸ºä¸»ï¼Œyaml åšé¢„è§ˆï¼Œä¸èƒ½ä¿®æ”¹\n\t- å…¨å±€å˜é‡æ¨¡å—æ˜¯é¡¹ç›®ç»´åº¦ï¼Œç¯å¢ƒé‡Œçš„ä»¥é¡¹ç›®çš„å…¨å±€å˜é‡å®šä¹‰ä¸ºä¸»\n\t- ç»†ç²’åº¦å¯è§æ€§å¦‚ä½•èšåˆæˆä»¥ prefix ä¸ºä¸»çš„ç²—ç²’åº¦å¯è§æ€§\n\t- ä¿®æ”¹æœåŠ¡å˜é‡å¼•ç”¨å…¨å±€å˜é‡ï¼Œå¢åŠ ç‰ˆæœ¬å·ï¼Ÿæ›´æ¢äº†è®¾è®¡\n\t- ç¯å¢ƒéœ€è¦å±•ç¤ºå…¨å±€å˜é‡å…³è”å…³ç³»\n\n# TODO\n- [ ] è§£å†³ ssh remote åœ¨å‘½ä»¤è¡Œä¸­ï¼Œæ¯æ¬¡å†å²è®°å½•éƒ½æ¶ˆå¤±çš„é—®é¢˜\n- [x] æ·»åŠ æ¯æ—¥æ—¥å¿—æ¨¡ç‰ˆ âœ… 2023-04-29","lastmodified":"2023-05-18T16:10:29.92834953Z","tags":[]},"/Calendar/Daily-notes/2023/04/4%E6%9C%8825-2023-%E5%91%A8%E4%BA%8C":{"title":"4æœˆ25, 2023, å‘¨äºŒ","content":"# TODO\n\n- [ ] æ•´ç†mongodbæ–‡æ¡£","lastmodified":"2023-05-18T16:10:29.92834953Z","tags":[]},"/Calendar/Daily-notes/2023/04/4%E6%9C%8826-2023-%E5%91%A8%E4%B8%89":{"title":"4æœˆ26, 2023, å‘¨ä¸‰","content":"- æœåŠ¡å˜é‡ kv ä¸ yaml è½¬æ¢\n\t- è°ƒè¯•ã€è‡ªæµ‹\n- swagger æ”¯æŒ\n- å˜é‡æ–°æ–‡æ¡£\n- [[Spaces/Zadig/æµ‹è¯•]]è¶…æ—¶é”™è¯¯ bug\n\t- ä¸çŸ¥é“åœ¨æµ‹è¯•é¡µé¢å¯ä»¥æ‰§è¡Œtask\n\t- å›å½’æµ‹è¯•ä¸å®Œå–„\n\t- æ²¡æœ‰äº¤å‰æµ‹è¯•\n\t\t- é¦–å…ˆè‡ªæµ‹å®Œå¤‡\n\t\t- ç†è§£éœ€æ±‚\n\t\t- æ€ç»´ç¢°æ’ï¼Œæ¯ä¸ªäººæƒ³æ³•çš„å·®å¼‚\n\t- æµ‹è¯•å¤šèŠ±ä¸€äº›æ—¶é—´\n\t- è‡ªæµ‹å®Œå–„ï¼Œè‡ªæµ‹å®Œå†å›å½’å†è‡ªæµ‹ä¸€éæ²¡ä»€ä¹ˆæ„ä¹‰","lastmodified":"2023-05-18T16:10:29.92834953Z","tags":[]},"/Calendar/Daily-notes/2023/04/4%E6%9C%8827-2023-%E5%91%A8%E5%9B%9B":{"title":"4æœˆ27, 2023, å‘¨å››","content":"- [[Spaces/Zadig/é•œåƒåç§°]]é—®é¢˜\n\t- æ¢³ç†è·å–é•œåƒåˆ—è¡¨çš„åœºæ™¯\n\t\t- Build ç”Ÿæˆé•œåƒï¼Œä½¿ç”¨é•œåƒçš„åœºæ™¯ï¼Ÿ\n\t\t- è‡ªå®šä¹‰å·¥ä½œæµ\n\t\t\t- éƒ¨ç½²\n\t\t\t- é•œåƒåˆ†å‘\n\t\t\t- k8s éƒ¨ç½²\n\t\t\t- çº¢ç»¿å‘å¸ƒ\n\t\t\t- é‡‘ä¸é›€å‘å¸ƒ\n\t\t- äº§å“å·¥ä½œæµ\n\t\t\t- äº¤ä»˜ç‰©éƒ¨ç½²\n\t- æ¢³ç†é•œåƒç”Ÿæˆè§„åˆ™\n\t\t- æ²¡æœ‰è®¾ç½®ä»£ç æº\n\t\t- æœ‰è®¾ç½®ä»£ç æº\n\t\t\t- é»˜è®¤æ²¡æœ‰ä¿å­˜é•œåƒè§„åˆ™\n\t\t\t\t- ä½¿ç”¨ service name ä½œä¸ºé•œåƒå\n\t\t\t- ä¿æŒäº†é•œåƒè§„åˆ™\n\t\t\t\t- æ ¹æ®é•œåƒè§„åˆ™æ¥è®¾ç½®\n\t\t- é•œåƒååº”è¯¥ä¸å¯æ”¹ï¼Œå¦åˆ™ä¼šå‡ºç°é€‰æ‹©ä¸åˆ°çš„æƒ…å†µã€‚\n\t\t\t- ä»…éƒ¨ç½²çš„æƒ…å†µä¸‹ï¼Œæ— æ³•è·å–æ„å»ºç”Ÿæˆçš„å®Œæ•´image\n\t\t\t- å­˜å‚¨çš„ imageName æ²¡æœ‰æŒ‰ç…§ç”Ÿæˆè§„åˆ™æ¥\n\t- ä¼˜åŒ–è·å–é•œåƒåé€»è¾‘\n\t\t- æ ¹æ® image è§£æ image name\n\t\t\t- image è§£æå¯èƒ½å’ŒæœåŠ¡æœ€æ–°å®šä¹‰ä¸ä¸€è‡´ã€‚éƒ¨ç½²æ—¶ä½¿ç”¨å“ªä¸ªï¼Ÿ\n- Ymal linter\n","lastmodified":"2023-05-18T16:10:29.92834953Z","tags":[]},"/Calendar/Daily-notes/2023/04/4%E6%9C%8829-2023-%E5%91%A8%E5%85%AD":{"title":"4æœˆ29, 2023, å‘¨å…­","content":"\n\u003c\u003c [[ Calendar/Daily notes/2023/04/4æœˆ28, 2023, å‘¨äº”|å‰ä¸€å¤©çš„æ—¥è®°]]  |  [[Calendar/Daily notes/2023/04/4æœˆ30, 2023, å‘¨æ—¥|åä¸€å¤©çš„æ—¥è®°]] \u003e\u003e\n\n# æ¯æ—¥è®°å½•\n\n- æ¢³ç†é•œåƒåç§°\n- æ·»åŠ  obsidian æ—¥å¿—æ¨¡ç‰ˆ\n\n# å¾…åŠäº‹é¡¹\n\n\n\n# æœ¬æ—¥åˆ°æœŸ\u0008\n\n```tasks\ndue on today\n```\n\n# æœ¬æ—¥å®Œæˆ\n\n```tasks\ndone 2023-04-29\n```\n\n# æœªå®Œæˆ\n\n```tasks\npath does not include 4æœˆ29, 2023, å‘¨å…­\nnot done\nsort by due reverse\nsort by description\n```\n\n# çµå…‰ä¸€é—ª\n","lastmodified":"2023-05-18T16:10:29.92834953Z","tags":["DailyNotes"]},"/Calendar/Daily-notes/2023/04/4%E6%9C%8830-2023-%E5%91%A8%E6%97%A5":{"title":"4æœˆ30, 2023, å‘¨æ—¥","content":"\n\u003c\u003c [[ Calendar/Daily notes/2023/04/4æœˆ29, 2023, å‘¨å…­|å‰ä¸€å¤©çš„æ—¥è®°]]  |  [[Calendar/Daily notes/2023/05/5æœˆ1, 2023, å‘¨ä¸€|åä¸€å¤©çš„æ—¥è®°]] \u003e\u003e\n\n# æ¯æ—¥è®°å½•\n\n\n\n# å¾…åŠäº‹é¡¹\n\n- [ ] æ•´ç†ã€åˆå¹¶ã€è¿ç§» blog åˆ° obsidian\n\n# æœ¬æ—¥åˆ°æœŸ\u0008\n\n```tasks\ndue on 2023-04-30\n```\n\n# æœ¬æ—¥å®Œæˆ\n\n```tasks\ndone  2023-04-30\n```\n\n# æœªå®Œæˆ\n\n```tasks\npath does not include 4æœˆ30, 2023, å‘¨æ—¥\nnot done\nsort by due reverse\nsort by description\n```\n\n# çµå…‰ä¸€é—ª\n","lastmodified":"2023-05-18T16:10:29.92834953Z","tags":["DailyNotes"]},"/Calendar/Daily-notes/2023/05/5%E6%9C%881-2023-%E5%91%A8%E4%B8%80":{"title":"5æœˆ1, 2023, å‘¨ä¸€","content":"\n\u003c\u003c [[ Calendar/Daily notes/2023/04/4æœˆ30, 2023, å‘¨æ—¥|å‰ä¸€å¤©çš„æ—¥è®°]] | [[Calendar/Daily notes/2023/05/5æœˆ2, 2023, å‘¨äºŒ|åä¸€å¤©çš„æ—¥è®°]] \u003e\u003e\n\n# æ¯æ—¥è®°å½•\n\n- å­¦ä¹  obsidian\n- æ•´ç†æ’ä»¶\n- å®Œå–„ front matter å’Œlinter\n\n# å¾…åŠäº‹é¡¹\n\n- [ ] æ•´ç†tagsï¼Œæ ‘çŠ¶å±‚çº§\n\n# æœ¬æ—¥åˆ°æœŸ\u0008\n\n```tasks\ndue on 2023-05-01\n```\n\n# æœ¬æ—¥å®Œæˆ\n\n```tasks\ndone  2023-05-01\n```\n\n# æœªå®Œæˆ\n\n```tasks\npath does not include 5æœˆ1, 2023, å‘¨ä¸€\nnot done\nsort by due reverse\nsort by description\n```\n\n# çµå…‰ä¸€é—ª\n\n- 00:05 #ç¬”è®°è½¯ä»¶/å¯¹æ¯”\u003cbr\u003e\u003cbr\u003eå…¶ä»–äººçš„ä½¿ç”¨ ï¼š\u003cbr\u003e\u003cbr\u003eFlomoï¼ˆçµæ„Ÿæ”¶é›†ï¼‰ã€å¹•å¸ƒï¼ˆæ€ç»´å¯¼å›¾ï¼‰ã€æ€æº\u0026Obsidianï¼ˆæ±‡æ€»ç ”ç©¶ï¼‰ã€è¯­é›€ï¼ˆå‘å¸ƒåˆ†äº«ï¼‰\n- 00:05 #åšå®¢/éœ€æ±‚\u003cbr\u003e\u003cbr\u003eæˆ‘å¸Œæœ›blogèƒ½åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯åƒwikiä¸€æ ·èƒ½æ ¹æ®ç›®å½•åˆ†ç±»çš„ï¼Œä¸€éƒ¨åˆ†æ˜¯è·Ÿæ™®é€šblogé‚£æ ·æŒ‰æ—¶é—´é¡ºåºçš„ï¼Œæœ€å¥½æ ¼å¼è¿˜æ˜¯MDçš„ï¼Œæœ‰è¿™ç§blogå—ï¼Ÿ\n- 00:07 #çµæ„Ÿ/iPad\u003cbr\u003e\u003cbr\u003eiPad ç”¨ç¬”è®°è½¯ä»¶å­¦ä¹ ï¼Ÿ\n- 00:08 #çµæ„Ÿ/iPad\u003cbr\u003e\u003cbr\u003eiPadè½¯ä»¶ï¼š\u003cbr\u003e1. Notability\u003cbr\u003e2. GoodNotes\u003cbr\u003e3. Flexcil\u003cbr\u003e4. MarginNote \u003cbr\u003e5. Planner\u003cbr\u003e6. Prodrafts\u003cbr\u003e7. æ¬§é™†è¯å…¸\n- 00:08 #çµæ„Ÿ\u003cbr\u003e\u003cbr\u003eéœ€è¦æ·±å…¥çš„ä½¿ç”¨äº†è§£ï¼Œæ‰èƒ½äº†è§£ä¸€ä¸ªäº‹ç‰©ï¼Œæ¯”å¦‚äº†è§£ä¸€æ¬¾è½¯ä»¶ï¼Œå°±éœ€è¦è‡ªå·±ä¸€æ®µæ—¶é—´çš„ä½¿ç”¨ï¼Œæ‰èƒ½å¤Ÿæ·±å…¥çš„äº†è§£å®ƒçš„ä¼˜ç¼ºç‚¹ï¼Œè€Œä¸æ˜¯å†åœç•™åœ¨å„ç§è¯„æµ‹çš„è¡¨é¢å°è±¡ä¸­ã€‚\u003cbr\u003e\u003cbr\u003eå…‰çœ‹æ–‡ç« è¿˜ä¸å¤Ÿï¼Œè¿˜éœ€è¦å®è·µã€‚\n- 00:08 #çµæ„Ÿ/ç”Ÿæ´»\u003cbr\u003e\u003cbr\u003eæ”¾é€ã€è‡ªåœ¨ï¼Œä¸è¦çº¦æŸï¼Œä¸è¦å—ä»–äººå½±å“\n- 00:08 #çµæ„Ÿ/æˆé•¿\u003cbr\u003e\u003cbr\u003eäººæˆé•¿çš„è¿‡ç¨‹ï¼Œå°±æ˜¯ä¸€ä¸ªä¸æ–­è¾“å…¥ä¿¡æ¯ã€åˆ†æä¿¡æ¯ã€å½’çº³æ€»ç»“å¹¶å­¦ä»¥è‡´ç”¨çš„è¿‡ç¨‹ ã€‚\n- 00:08 #çµæ„Ÿ/æˆé•¿\u003cbr\u003e\u003cbr\u003eè‡ªæˆ‘é©±åŠ¨ï¼Œä¸æ–­æˆé•¿ ^h5odua\n- 00:10 #çµæ„Ÿ/å‡è‚¥\u003cbr\u003e\u003cbr\u003estay hungry\n- 00:10 #è®¾è®¡åŸåˆ™\u003cbr\u003e\u003cbr\u003eæ¶æ„/è®¾è®¡åŸåˆ™ï¼š\u003cbr\u003e1. é«˜å†…èšæ¾è€¦åˆ\u003cbr\u003e2. K.I.S.S\n- 00:10 #iptables/æ’æŸ¥\u003cbr\u003e\u003cbr\u003e1. æŸ¥çœ‹dmesgï¼ˆå¦‚æœæŸä¸ªåŒ…è¢«æŒ¡äº†ï¼Œdmesgé‡Œä¼šæœ‰è®°å½•ï¼‰\u003cbr\u003e2. tcpdump\n- 00:11 #golang/slice\u003cbr\u003e\u003cbr\u003eå·¦é—­å³å¼€\n- 00:11 #çµæ„Ÿ/æˆé•¿\u003cbr\u003e\u003cbr\u003e1. ä¸‡äº‹å¼€å¤´éš¾\u003cbr\u003e2. Just do it\u003cbr\u003e3. ä»ç°åœ¨å¼€å§‹è¡ŒåŠ¨\n- 00:12 #çµæ„Ÿ/è¨€è®º\u003cbr\u003e\u003cbr\u003eç”Ÿå‘½å¤ªçŸ­æš‚ï¼Œä¸èƒ½èŠ±åœ¨é‚£äº›ä¸å€¼å¾—é˜…è¯»çš„å†…å®¹ä¸Šé¢ã€‚\u003cbr\u003e\u003cbr\u003eå°±ç®—ä½ æ˜¯ä¸€ä¸ªå¾ˆçˆ±è¯»ä¹¦çš„äººï¼Œæ´»åˆ°70å²æœ€å¤šå¤§æ¦‚èƒ½é˜…è¯»15000æœ¬ä¹¦ï¼Œè¿™åªå ä¸–ç•Œæœ€å¤§å›¾ä¹¦é¦†ç¾å›½å›½ä¼šå›¾ä¹¦é¦†3800ä¸‡å†Œè—ä¹¦çš„0.04%ã€‚\u003cbr\u003e\u003cbr\u003eæˆ‘ä»¬ä¸€ç”Ÿä¸­èƒ½å¤Ÿé˜…è¯»çš„ä¹¦ç±å…¶å®å¾ˆå°‘ã€‚å› æ­¤ï¼Œå…³é”®æŠ€èƒ½ä¸æ˜¯å¤šè¯»ï¼Œè€Œæ˜¯è·³è¿‡é‚£äº›ä¸å€¼å¾—è¯»çš„å†…å®¹ã€‚\u003cbr\u003e\u003cbr\u003eæœ‰äº›é¢†åŸŸå˜åŒ–éå¸¸å¿«ï¼Œåœ¨æœ‰äººå†™ä¹¦ä¹‹å‰ï¼Œåšå®¢æœ‰æ—¶æ˜¯å”¯ä¸€çš„ä¿¡æ¯æ¥æºã€‚Stable diffusion æ¨¡å‹å‡ºç°åçš„ç¬¬äºŒå¤©ï¼Œäººä»¬å°±å·²ç»åœ¨å†™åšå®¢äº†ï¼Œä¹¦ç±æ°¸è¿œä¸ä¼šé‚£ä¹ˆå¿«ã€‚\u003cbr\u003e\u003cbr\u003eè€Œä¸”ï¼Œåšå®¢å¾€å¾€æ˜¯å…è´¹çš„ï¼Œè€Œä¹¦ç±å’Œè®ºæ–‡åˆ™è¢«é”å®šåœ¨ä»˜è´¹å¢™ä¹‹åã€‚å› æ­¤ï¼Œä½ å¯ä»¥è¿™ä¹ˆè®¤ä¸ºï¼Œåšå®¢è·å–çµæ„Ÿï¼Œä¹¦ç±è·å–çŸ¥è¯†ã€‚\n- 00:12 #çµæ„Ÿ/ç¼–ç¨‹\u003cbr\u003e\u003cbr\u003eé­”é¬¼è—åœ¨ç»†èŠ‚ä¸­\n- 00:12 #çµæ„Ÿ/æˆé•¿ \u003cbr\u003e\u003cbr\u003eä»€ä¹ˆæ˜¯èƒ½åŠ›ï¼Ÿ\u003cbr\u003e\u003cbr\u003eé‡åˆ°é—®é¢˜çš„æ€åº¦\u003cbr\u003e\u003cbr\u003eå¤„ç†é—®é¢˜çš„æ€è·¯å’Œæ–¹æ³•\u003cbr\u003e\u003cbr\u003eè¿™å°±æ˜¯èƒ½åŠ›\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["DailyNotes"]},"/Calendar/Daily-notes/2023/05/5%E6%9C%8810-2023-%E5%91%A8%E4%B8%89":{"title":"5æœˆ10, 2023, å‘¨ä¸‰","content":"\n\u003c\u003c [[ Calendar/Daily notes/2023/05/5æœˆ9, 2023, å‘¨äºŒ|å‰ä¸€å¤©çš„æ—¥è®°]]  |  [[Calendar/Daily notes/2023/05/5æœˆ11, 2023, å‘¨å››|åä¸€å¤©çš„æ—¥è®°]] \u003e\u003e\n\n# æ¯æ—¥è®°å½•\n\n- å˜é‡ä¼˜åŒ–å…¨å±€å˜é‡æ¨¡å—\n- ç¯å¢ƒå˜é‡æ•°æ®å®šä¹‰\n\n# å¾…åŠäº‹é¡¹\n\n\n\n# æœ¬æ—¥åˆ°æœŸ\u0008\n\n```tasks\ndue on 2023-05-10\n```\n\n# æœ¬æ—¥å®Œæˆ\n\n```tasks\ndone  2023-05-10\n```\n\n# æœªå®Œæˆ\n\n```tasks\npath does not include 5æœˆ10, 2023, å‘¨ä¸‰\nnot done\nsort by due reverse\nsort by description\n```\n\n# çµå…‰ä¸€é—ª\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["daily-notes"]},"/Calendar/Daily-notes/2023/05/5%E6%9C%8811-2023-%E5%91%A8%E5%9B%9B":{"title":"5æœˆ11, 2023, å‘¨å››","content":"\n\u003c\u003c [[ Calendar/Daily notes/2023/05/5æœˆ10, 2023, å‘¨ä¸‰|å‰ä¸€å¤©çš„æ—¥è®°]] | [[Calendar/Daily notes/2023/05/5æœˆ12, 2023, å‘¨äº”|åä¸€å¤©çš„æ—¥è®°]] \u003e\u003e\n\n# æ¯æ—¥è®°å½•\n\n- å˜é‡ä¼˜åŒ–ï¼šæœåŠ¡åŠ å…¥ç¯å¢ƒã€æ·»åŠ æœåŠ¡ã€æ›´æ–°æœåŠ¡\n\n# å¾…åŠäº‹é¡¹\n\n# æœ¬æ—¥åˆ°æœŸ\u0008\n\n```tasks\ndue on 2023-05-11\n```\n\n# æœ¬æ—¥å®Œæˆ\n\n```tasks\ndone  2023-05-11\n```\n\n# æœªå®Œæˆ\n\n```tasks\npath does not include 5æœˆ11, 2023, å‘¨å››\nnot done\nsort by due reverse\nsort by description\n```\n\n# çµå…‰ä¸€é—ª\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["daily-notes"]},"/Calendar/Daily-notes/2023/05/5%E6%9C%8812-2023-%E5%91%A8%E4%BA%94":{"title":"5æœˆ12, 2023, å‘¨äº”","content":"\n\u003c\u003c [[ Calendar/Daily notes/2023/05/5æœˆ11, 2023, å‘¨å››|å‰ä¸€å¤©çš„æ—¥è®°]]  |  [[Calendar/Daily notes/2023/05/5æœˆ13, 2023, å‘¨å…­|åä¸€å¤©çš„æ—¥è®°]] \u003e\u003e\n\n# æ¯æ—¥è®°å½•\n\n- [[Cards/ChatGPT|ChatGPT]] ä½¿ç”¨æŠ€å·§\n\t- è®¾å®šè§’è‰²\n\t- åŒæ—¶æä¾›æŒ‡ä»¤å’Œç¤ºä¾‹\n\t- åˆ†è§£å¤æ‚é—®é¢˜\n\n\n# å¾…åŠäº‹é¡¹\n\n\n\n# æœ¬æ—¥åˆ°æœŸ\u0008\n\n```tasks\ndue on 2023-05-12\n```\n\n# æœ¬æ—¥å®Œæˆ\n\n```tasks\ndone  2023-05-12\n```\n\n# æœªå®Œæˆ\n\n```tasks\npath does not include 5æœˆ12, 2023, å‘¨äº”\nnot done\nsort by due reverse\nsort by description\n```\n\n# çµå…‰ä¸€é—ª\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["daily-notes"]},"/Calendar/Daily-notes/2023/05/5%E6%9C%8813-2023-%E5%91%A8%E5%85%AD":{"title":"5æœˆ13, 2023, å‘¨å…­","content":"\n\u003c\u003c [[ Calendar/Daily notes/2023/05/5æœˆ12, 2023, å‘¨äº”|å‰ä¸€å¤©çš„æ—¥è®°]]  |  [[Calendar/Daily notes/2023/05/5æœˆ14, 2023, å‘¨æ—¥|åä¸€å¤©çš„æ—¥è®°]] \u003e\u003e\n\n# æ¯æ—¥è®°å½•\n\n- [[ç½‘é¡µæ”¶è—]]\n\t- [Developer Roadmaps - roadmap.sh](https://roadmap.sh/)\n- simple bank\n\t- VerifyEmail gapi\n\t- test and mock CreateUser API\n- gentoo package\n\t- guru uxplay\n\t- gig cockpit\n- Learning [[+ Encounters/ç¬”è®°/obsidian]]\n\t- [ç©è½¬ Obsidian 01ï¼šæ‰“é€ çŸ¥è¯†å¾ªç¯åˆ©å™¨ - å°‘æ•°æ´¾](https://sspai.com/post/62414)\n\t- **[[çŸ¥è¯†å¾ªç¯]]**\n\t\t- ã€ŒæŒæ¡çŸ¥è¯†=ç”¨è‡ªå·±çš„è¯æè¿°=å†™å‡ºæ¥ã€ï¼Œæˆ‘æŠŠå®ƒæ€»ç»“ä¸€ä¸‹å³ï¼šæŠŠã€Œå†™ä½œã€å½“åšçŸ¥è¯†ç®¡ç†çš„å”¯ä¸€ç›®çš„ã€‚è€Œå®ç°è¿™ä¸€ç›®çš„çš„æ‰‹æ®µï¼Œæˆ‘æŠŠå®ƒç§°ä¹‹ä¸ºã€ŒçŸ¥è¯†å¾ªç¯ã€\n\t\t- çŸ¥è¯†å¾ªç¯æŒ‡çš„æ˜¯ä»¥ã€Œå†™ä½œã€ä¸ºå”¯ä¸€ç›®çš„çš„ã€ŒçŸ¥è¯†ç®¡ç†ã€æ–¹å¼ï¼Œåœ¨ã€Œå†™ä½œã€çš„è¿‡ç¨‹ä¸­ç»å†é˜…è¯»/è®°å½•/æ•´ç†å’Œè¾“å‡º\n\n# å¾…åŠäº‹é¡¹\n\n- [ ] ArgoCD è‡ªåŠ¨éƒ¨ç½² helm\n- [ ] è°ƒç ” obsidian æ˜¯å¦è¦ä½¿ç”¨å›¾åºŠ\n- [ ] è°ƒç ” Roam-highlighter æ˜¯å¦æœ‰å¿…è¦ä½¿ç”¨ï¼Ÿè¿˜æœ‰ç®€é˜…å‘¢ï¼Ÿ\n\n# æœ¬æ—¥åˆ°æœŸ\u0008\n\n```tasks\ndue on 2023-05-13\n```\n\n# æœ¬æ—¥å®Œæˆ\n\n```tasks\ndone  2023-05-13\n```\n\n# æœªå®Œæˆ\n\n```tasks\npath does not include 5æœˆ13, 2023, å‘¨å…­\nnot done\nsort by due reverse\nsort by description\n```\n\n# çµå…‰ä¸€é—ª\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["daily-notes"]},"/Calendar/Daily-notes/2023/05/5%E6%9C%8814-2023-%E5%91%A8%E6%97%A5":{"title":"5æœˆ14, 2023, å‘¨æ—¥","content":"\n\u003c\u003c [[ Calendar/Daily notes/2023/05/5æœˆ13, 2023, å‘¨å…­|å‰ä¸€å¤©çš„æ—¥è®°]]  |  [[Calendar/Daily notes/2023/05/5æœˆ15, 2023, å‘¨ä¸€|åä¸€å¤©çš„æ—¥è®°]] \u003e\u003e\n\n# æ¯æ—¥è®°å½•\n\n\n\n# å¾…åŠäº‹é¡¹\n\n- [ ] æ•´ç†ç¬”è®°æ–¹æ³•è®º\n- [ ] å­¦ä¹ æ•´ç†ç¬”è®°çš„æ–¹æ³•è®º\n- [ ] æ•´ç†ç¬”è®°æ–‡ä»¶å¤¹\n\n# æœ¬æ—¥åˆ°æœŸ\u0008\n\n```tasks\ndue on 2023-05-14\n```\n\n# æœ¬æ—¥å®Œæˆ\n\n```tasks\ndone  2023-05-14\n```\n\n# æœªå®Œæˆ\n\n```tasks\npath does not include 5æœˆ14, 2023, å‘¨æ—¥\nnot done\nsort by due reverse\nsort by description\n```\n\n# çµå…‰ä¸€é—ª\n\n- 23:15 #çµæ„Ÿ/æˆé•¿\u003cbr\u003e\u003cbr\u003eLearn from the best.","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["daily-notes"]},"/Calendar/Daily-notes/2023/05/5%E6%9C%8815-2023-%E5%91%A8%E4%B8%80":{"title":"5æœˆ15, 2023, å‘¨ä¸€","content":"\n\u003c\u003c [[Calendar/Daily notes/2023/05/5æœˆ14, 2023, å‘¨æ—¥|å‰ä¸€å¤©çš„æ—¥è®°]] |  [[Calendar/Daily notes/2023/05/5æœˆ16, 2023, å‘¨äºŒ|åä¸€å¤©çš„æ—¥è®°]] \u003e\u003e\n\n# æ¯æ—¥è®°å½•\n\n- å­¦ä¹  LYT å’Œ ACCESS\n- ä½¿ç”¨ ACCESS é‡æ„ vault\n\n# å¾…åŠäº‹é¡¹\n\n# æœ¬æ—¥åˆ°æœŸ\u0008\n\n```tasks\ndue on 2023-05-15\n```\n\n# æœ¬æ—¥å®Œæˆ\n\n```tasks\ndone  2023-05-15\n```\n\n# æœªå®Œæˆ\n\n```tasks\npath does not include 5æœˆ15, 2023, å‘¨ä¸€\nnot done\nsort by due reverse\nsort by description\n```\n\n# çµå…‰ä¸€é—ª\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["daily-notes"]},"/Calendar/Daily-notes/2023/05/5%E6%9C%8816-2023-%E5%91%A8%E4%BA%8C":{"title":"5æœˆ16, 2023, å‘¨äºŒ","content":"\n\u003c\u003c [[Calendar/Daily notes/2023/05/5æœˆ15, 2023, å‘¨ä¸€|å‰ä¸€å¤©çš„æ—¥è®°]]  |  [[Calendar/Daily notes/2023/05/5æœˆ17, 2023, å‘¨ä¸‰|åä¸€å¤©çš„æ—¥è®°]] \u003e\u003e\n\n# æ¯æ—¥è®°å½•\n\n- [[Spaces/Zadig/æœåŠ¡å˜é‡|æœåŠ¡å˜é‡]]\n\t- æ˜¯å¦è¿˜è¦ä¿ç•™ variableYaml\n\t- ç›®å‰ä»£ç å’Œæ¥å£æ„Ÿè§‰æœ‰äº›æ‚ä¹±\n\t- å‰ç«¯ä¹Ÿå¯ä»¥ç¡®è®¤ä¸€ä¸‹å“ªäº›æ¥å£çœŸçš„éœ€è¦ yaml\n\t- ç¡®è®¤ service/variable æ¥å£é‡Œçš„ latest å­—æ®µæ˜¯å¦è¿˜éœ€è¦\n\t- æ•´ç†å·¥ä½œæµæ¥å£\n- [[Cards/CS/Linux/homelab|homelab]]\n\t- [ ] å¤‡ä»½æ•°æ®åˆ°å…¶ä»–åœ°æ–¹ï¼Œåšåˆ°ç¦»çº¿å¯ç”¨\n\n# å¾…åŠäº‹é¡¹\n\n\n\n# æœ¬æ—¥åˆ°æœŸ\u0008\n\n```tasks\ndue on 2023-05-16\n```\n\n# æœ¬æ—¥å®Œæˆ\n\n```tasks\ndone  2023-05-16\n```\n\n# æœªå®Œæˆ\n\n```tasks\npath does not include 5æœˆ16, 2023, å‘¨äºŒ\nnot done\nsort by due reverse\nsort by description\n```\n\n# çµå…‰ä¸€é—ª\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["daily-notes"]},"/Calendar/Daily-notes/2023/05/5%E6%9C%8817-2023-%E5%91%A8%E4%B8%89":{"title":"5æœˆ17, 2023, å‘¨ä¸‰","content":"\n\u003c\u003c [[Calendar/Daily notes/2023/05/5æœˆ16, 2023, å‘¨äºŒ|å‰ä¸€å¤©çš„æ—¥è®°]] |  [[Calendar/Daily notes/2023/05/5æœˆ18, 2023, å‘¨å››|åä¸€å¤©çš„æ—¥è®°]] \u003e\u003e\n\n# æ¯æ—¥è®°å½•\n\n# å¾…åŠäº‹é¡¹\n\n- [ ] CustomYaml.RenderVaraibleKVs æ‹¼å†™é”™è¯¯\n- [ ] æ£€æŸ¥å…¶ä»–æ‹¼å†™é”™è¯¯\n- [ ] ç¡®è®¤å·¥ä½œæµå…¨å±€å˜é‡é—®é¢˜\n- [ ] ç¡®è®¤å·¥ä½œæµæ•°æ®ç»“æ„å˜åŒ–ï¼Œæä¾›ç»™å†¬å†¬UA\n\n# æœ¬æ—¥åˆ°æœŸ\n\n```tasks\ndue on 2023-05-17\n```\n\n# æœ¬æ—¥å®Œæˆ\n\n```tasks\ndone  2023-05-17\n```\n\n# æœªå®Œæˆ\n\n```tasks\npath does not include 5æœˆ17, 2023, å‘¨ä¸‰\nnot done\nsort by due reverse\nsort by description\n```\n\n# çµå…‰ä¸€é—ª\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["daily-notes"]},"/Calendar/Daily-notes/2023/05/5%E6%9C%8818-2023-%E5%91%A8%E5%9B%9B":{"title":"5æœˆ18, 2023, å‘¨å››","content":"\n\u003c\u003c [[Calendar/Daily notes/2023/05/5æœˆ17, 2023, å‘¨ä¸‰|å‰ä¸€å¤©çš„æ—¥è®°]] | [[Calendar/Daily notes/2023/05/5æœˆ19, 2023, å‘¨äº”|åä¸€å¤©çš„æ—¥è®°]] \u003e\u003e\n\n# æ¯æ—¥è®°å½•\n\n- [[Spaces/Zadig/æœåŠ¡å˜é‡]]\n\t- ServiceVariableKV çš„ yaml ç±»å‹\n\t\t- ä¸è¿›è¡Œ marshal å’Œ unmarshal è½¬æ¢\n\t\t- å‰ç«¯ä¼ å‚æ˜¯ stringï¼Œç•Œé¢ä¸Šæ˜¾ç¤ºçš„ä¹Ÿæ˜¯ string\n\t\t- è¦æƒ³ä¸è½¬æ¢ï¼Œéœ€è¦å‰ç«¯ä¼  unmarshal åçš„å†…å®¹\n\t\t- æ€»å¾—è¦unmarshal\n\n# å¾…åŠäº‹é¡¹\n\n- [ ] å·¥ä½œæµéƒ¨ç½²é‡æ„\n- [ ] ç¡®å®š OpenAPI å®‰æ’ğŸ“… 2023-05-19 \n\n# æœ¬æ—¥åˆ°æœŸ\n\n```tasks\ndue on 2023-05-18\n```\n\n# æœ¬æ—¥å®Œæˆ\n\n```tasks\ndone  2023-05-18\n```\n\n# æœªå®Œæˆ\n\n```tasks\npath does not include 5æœˆ18, 2023, å‘¨å››\nnot done\nsort by due reverse\nsort by description\n```\n\n# çµå…‰ä¸€é—ª\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["daily-notes"]},"/Calendar/Daily-notes/2023/05/5%E6%9C%8819-2023-%E5%91%A8%E4%BA%94":{"title":"5æœˆ19, 2023, å‘¨äº”","content":"\n\u003c\u003c [[Calendar/Daily notes/2023/05/5æœˆ18, 2023, å‘¨å››|å‰ä¸€å¤©çš„æ—¥è®°]] |  [[Calendar/Daily notes/2023/05/5æœˆ20, 2023, å‘¨å…­|åä¸€å¤©çš„æ—¥è®°]] \u003e\u003e\n\n# æ¯æ—¥è®°å½•\n\n# å¾…åŠäº‹é¡¹\n\n# æœ¬æ—¥åˆ°æœŸ\n\n```tasks\ndue on 2023-05-19\n```\n\n# æœ¬æ—¥å®Œæˆ\n\n```tasks\ndone  2023-05-19\n```\n\n# æœªå®Œæˆ\n\n```tasks\npath does not include 5æœˆ19, 2023, å‘¨äº”\nnot done\nsort by due reverse\nsort by description\n```\n\n# çµå…‰ä¸€é—ª\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["daily-notes"]},"/Calendar/Daily-notes/2023/05/5%E6%9C%882-2023-%E5%91%A8%E4%BA%8C":{"title":"5æœˆ2, 2023, å‘¨äºŒ","content":"\n\u003c\u003c [[ Calendar/Daily notes/2023/05/5æœˆ1, 2023, å‘¨ä¸€|å‰ä¸€å¤©çš„æ—¥è®°]]  |  [[Calendar/Daily notes/2023/05/5æœˆ3, 2023, å‘¨ä¸‰|åä¸€å¤©çš„æ—¥è®°]] \u003e\u003e\n\n# æ¯æ—¥è®°å½•\n\n\n\n# å¾…åŠäº‹é¡¹\n\n\n\n# æœ¬æ—¥åˆ°æœŸ\u0008\n\n```tasks\ndue on 2023-05-02\n```\n\n# æœ¬æ—¥å®Œæˆ\n\n```tasks\ndone  2023-05-02\n```\n\n# æœªå®Œæˆ\n\n```tasks\npath does not include 5æœˆ2, 2023, å‘¨äºŒ\nnot done\nsort by due reverse\nsort by description\n```\n\n# çµå…‰ä¸€é—ª\n\n- 17:56 #çµæ„Ÿ/ç¬”è®°\u003cbr\u003e\u003cbr\u003eä¸åº”æ²‰è¿·åœ¨obsidiançš„æ’ä»¶æˆ–è£…ä¿®\u003cbr\u003eæˆ–è€…æ²‰æµ¸åœ¨å„ç§ç¬”è®°æ–¹æ³•è®ºä¸­\u003cbr\u003e\u003cbr\u003eç¬”è®°è¿˜æ˜¯åº”è¯¥å…ˆè®°ä¸‹æ¥ï¼Œå…¶ä»–éƒ½æ˜¯æ¬¡è¦äº†ï¼Œç»“æ„ã€æ’ä»¶ä¹‹ç±»çš„å¯ä»¥å›å¤´æœ‰ç©ºå†è°ƒæ•´","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["DailyNotes"]},"/Calendar/Daily-notes/2023/05/5%E6%9C%883-2023-%E5%91%A8%E4%B8%89":{"title":"5æœˆ3, 2023, å‘¨ä¸‰","content":"\n\u003c\u003c [[ Calendar/Daily notes/2023/05/5æœˆ2, 2023, å‘¨äºŒ|å‰ä¸€å¤©çš„æ—¥è®°]]  |  [[Calendar/Daily notes/2023/05/5æœˆ4, 2023, å‘¨å››|åä¸€å¤©çš„æ—¥è®°]] \u003e\u003e\n\n# æ¯æ—¥è®°å½•\n\n\n\n# å¾…åŠäº‹é¡¹\n\n\n\n# æœ¬æ—¥åˆ°æœŸ\u0008\n\n```tasks\ndue on 2023-05-03\n```\n\n# æœ¬æ—¥å®Œæˆ\n\n```tasks\ndone  2023-05-03\n```\n\n# æœªå®Œæˆ\n\n```tasks\npath does not include 5æœˆ3, 2023, å‘¨ä¸‰\nnot done\nsort by due reverse\nsort by description\n```\n\n# çµå…‰ä¸€é—ª\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["daily-notes"]},"/Calendar/Daily-notes/2023/05/5%E6%9C%885-2023-%E5%91%A8%E4%BA%94":{"title":"5æœˆ5, 2023, å‘¨äº”","content":"\n\u003c\u003c [[ Calendar/Daily notes/2023/05/5æœˆ4, 2023, å‘¨å››|å‰ä¸€å¤©çš„æ—¥è®°]] |  [[Calendar/Daily notes/2023/05/5æœˆ6, 2023, å‘¨å…­|åä¸€å¤©çš„æ—¥è®°]] \u003e\u003e\n\n# æ¯æ—¥è®°å½•\n\n- [[Spaces/Zadig/æœåŠ¡å˜é‡|å˜é‡]]ä¼˜åŒ–æœåŠ¡æ¨¡å—\n\t- å·²å†™å®Œ\n\t\t- æ ¡éªŒå˜é‡\n\t\t- ä¿å­˜å˜é‡\n\t\t- ä¿å­˜æœåŠ¡æ—¶è‡ªåŠ¨è§£æå˜é‡\n\t\t- swagger docs\n\t- è¿˜æœªæµ‹è¯•\n\n# å¾…åŠäº‹é¡¹\n\n- [ ] å’–å•¡åˆ†äº«\n\n# æœ¬æ—¥åˆ°æœŸ\u0008\n\n```tasks\ndue on 2023-05-05\n```\n\n# æœ¬æ—¥å®Œæˆ\n\n```tasks\ndone  2023-05-05\n```\n\n# æœªå®Œæˆ\n\n```tasks\npath does not include 5æœˆ5, 2023, å‘¨äº”\nnot done\nsort by due reverse\nsort by description\n```\n\n# çµå…‰ä¸€é—ª\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["daily-notes"]},"/Calendar/Daily-notes/2023/05/5%E6%9C%889-2023-%E5%91%A8%E4%BA%8C":{"title":"5æœˆ9, 2023, å‘¨äºŒ","content":"\n\u003c\u003c [[ Calendar/Daily notes/2023/05/5æœˆ8, 2023, å‘¨ä¸€|å‰ä¸€å¤©çš„æ—¥è®°]] |  [[Calendar/Daily notes/2023/05/5æœˆ10, 2023, å‘¨ä¸‰|åä¸€å¤©çš„æ—¥è®°]] \u003e\u003e\n\n# æ¯æ—¥è®°å½•\n\n- Azure OpenAI è°ƒç ”\n- [[GitHub Copilot]] for Business Privacy Statement\n\t- [GitHub Copilot for Business Privacy Statement - GitHub Docs](https://docs.github.com/en/site-policy/privacy-policies/github-copilot-for-business-privacy-statement)\n\t- ä¼šæ”¶é›† User Engagement æ•°æ®ï¼ŒåŒ…æ‹¬ç”¨æˆ·ç¼–è¾‘æ“ä½œäº‹ä»¶ï¼Œåƒæ˜¯æ¥å—å’Œå–æ¶ˆè¡¥å…¨ï¼Œè¿˜æœ‰é”™è¯¯å’Œä¸€èˆ¬ä½¿ç”¨æ•°æ®ä»¥è¯†åˆ«å»¶è¿Ÿå’ŒåŠŸèƒ½å‚ä¸åº¦ç­‰æŒ‡æ ‡ã€‚æ­¤ä¿¡æ¯å¯èƒ½åŒ…æ‹¬ä¸ªäººæ•°æ®ï¼Œä¾‹å¦‚å‡åæ ‡è¯†ç¬¦ã€‚\n\t- ä¸ä¼šæ”¶é›†ä»£ç ç‰‡æ®µæ•°æ®ã€‚GitHub Copilot å°†ä»£ç ç‰‡æ®µä» IDE ä¼ è¾“åˆ° GitHub ä»¥æä¾›å»ºè®®ã€‚ä»£ç ç‰‡æ®µæ•°æ®ä»…å®æ—¶ä¼ è¾“ä»¥è¿”å›å»ºè®®ï¼Œä¸€æ—¦è¿”å›å»ºè®®å³è¢«ä¸¢å¼ƒã€‚Copilot for Business ä¸ä¿ç•™ä»»ä½•ä»£ç ç‰‡æ®µæ•°æ®ã€‚\n- æµ‹è¯•å˜é‡ä¼˜åŒ–æœåŠ¡æ¨¡å—\n- å¼€å§‹å˜é‡ä¼˜åŒ–å…¨å±€å˜é‡æ¨¡å—\n\n# å¾…åŠäº‹é¡¹\n\n# æœ¬æ—¥åˆ°æœŸ\n\n```tasks\ndue on 2023-05-09\n```\n\n# æœ¬æ—¥å®Œæˆ\n\n```tasks\ndone  2023-05-09\n```\n\n# æœªå®Œæˆ\n\n```tasks\npath does not include 5æœˆ9, 2023, å‘¨äºŒ\nnot done\nsort by due reverse\nsort by description\n```\n\n# çµå…‰ä¸€é—ª\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["daily-notes"]},"/Calendar/Daily-notes/memo_delete":{"title":"memo_delete","content":"\n\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":[]},"/Cards/%E5%92%96%E5%95%A1/%E5%92%96%E5%95%A1%E7%90%86%E8%AE%BA":{"title":"å’–å•¡ç†è®º","content":"\n# æ„å¼èƒå–ç†è®º\n\n![CleanShot 2022-11-29 at 17.09.31-2x.png](Extras/Images/CleanShot_2022-11-29_at_17.09.31-2x_1669712988560_0.png)\n\n![CleanShot 2022-11-29 at 16.43.54-2x.png](Extras/Images/CleanShot_2022-11-29_at_16.43.54-2x_1669711447206_0.png)\n\nErgunå…¬å¼ï¼šè®¡ç®—æ°´é€šè¿‡ç²‰é¥¼çš„å‹é™ã€‚å‹é™deltaPå°±æ˜¯æ°´ä»å¼€å§‹æ¥è§¦ç²‰é¥¼çš„é¢ï¼Œåˆ°ä»ç²‰é¥¼å‡ºæ¥çš„è¿™ä¸ªé¢ç»“æŸï¼Œè¿™æ®µè¿‡ç¨‹ä¸­å› ä¸ºç²‰é¥¼çš„é˜»åŠ›ï¼Œé€ æˆçš„æ°´çš„å‹å¼ºçš„æŸå¤±ã€‚\n\nu0æ˜¯æ°´çš„æµé€Ÿã€‚\n\n![CleanShot 2022-11-29 at 16.44.53-2x.png](Extras/Images/CleanShot_2022-11-29_at_16.44.53-2x_1669711503019_0.png)\n\n![CleanShot 2022-11-29 at 16.46.27-2x.png](Extras/Images/CleanShot_2022-11-29_at_16.46.27-2x_1669711597473_0.png)\n\n![CleanShot 2022-11-29 at 16.48.20-2x.png](Extras/Images/CleanShot_2022-11-29_at_16.48.20-2x_1669711707926_0.png)\n\n![CleanShot 2022-11-29 at 16.50.46-2x.png](Extras/Images/CleanShot_2022-11-29_at_16.50.46-2x_1669711858130_0.png)\n\n![CleanShot 2022-11-29 at 16.57.58-2x.png](Extras/Images/CleanShot_2022-11-29_at_16.57.58-2x_1669712493583_0.png)\n\n![CleanShot 2022-11-29 at 17.05.01-2x.png](Extras/Images/CleanShot_2022-11-29_at_17.05.01-2x_1669712715373_0.png)\n\n# å’–å•¡å†²ç…®çš„æœ€æ ¹æœ¬åŸåˆ™\u0026åº•å±‚é€»è¾‘\n\n* æ˜¯å¦ä½¿ç”¨æ»¤çº¸\n\t* æ‰€æœ‰å¸¦æ»¤çº¸çš„å†²ç…®ï¼Œè·å¾—çš„å’–å•¡æ¶²ä¸­çš„ç‰©è´¨æ„æˆç§ç±»æ˜¯ä¸€æ ·çš„\n\t\t* å‘³é“ä¸åŒçš„åŸå› ï¼šç‰©è´¨çš„æ¯”ä¾‹ä¸åŒ\n\t* ä¸å¸¦æ»¤çº¸çš„å†²ç…®ï¼Œè¿˜ä¼šæœ‰æ‚¬æµŠåˆ†æ•£ç³»çš„åˆ†å­\n* æº¶è§£é€Ÿç‡\n\t* å’–å•¡èƒå–æ²¡æœ‰â€œæœ€å…ˆèƒå–å‡ºæ¥é…¸å‘³ç‰©è´¨ã€ç„¶åç”œã€æœ€åè‹¦â€çš„è¯´æ³•\n\t* æ˜¯ä¸åŒé£å‘³ç‰©è´¨çš„æº¶è§£é€Ÿç‡ä¸åŒï¼Œéƒ½æ˜¯åŒæ—¶å¼€å§‹è¢«èƒå–çš„\n\t\t* é…¸æœ€å®¹æ˜“æº¶è§£ã€èƒå–é€Ÿç‡æœ€å¿«ï¼Œå…¶æ¬¡ç”œï¼Œæœ€åè‹¦\n\t* åŒä¸€ä¸ªè±†å­å†²ç…®çš„å’–å•¡åè‹¦åé…¸çš„åŸå› \n\t\t* é…¸å‘³ç‰©è´¨éƒ½å·®ä¸å¤šä¸€æ ·å¤š\n\t\t* åé…¸çš„ï¼Œç”œå‘³è‹¦å‘³ç‰©è´¨æ›´å°‘ï¼Œé…¸å‘³æ›´çªå‡º\n\t\t* åè‹¦çš„ï¼Œç”œå‘³è‹¦å‘³ç‰©è´¨æ›´å¤šï¼Œé…¸å‘³æ²¡é‚£ä¹ˆçªå‡º\n* ã€è°ƒèŠ‚é£å‘³çš„åŸºæœ¬åŸåˆ™ã€‘\n\t* è°ƒèŠ‚è±†å­é‡Œé¢é£å‘³ç‰¹å¾æ›´éš¾èƒå–çš„é‚£ä¸€éƒ¨åˆ†\n\t* ä¾‹å¦‚æµ…çƒ˜è±†å­ï¼Œè°ƒèŠ‚ç”œå‘³ç‰©è´¨çš„èƒå–\n\t\t* çªå‡ºé…¸å‘³ï¼šé™ä½èƒå–ç‡çš„æ–¹æ³•\n\t\t* çªå‡ºç”œå‘³ï¼šæé«˜èƒå–ç‡çš„æ–¹æ³•\n\t* ä¾‹å¦‚æ·±çƒ˜è±†å­ï¼Œè°ƒèŠ‚è‹¦å‘³ç‰©è´¨çš„èƒå–\n\t\t* çªå‡ºç”œå‘³ï¼šé™ä½èƒå–ç‡çš„æ–¹æ³•\n\t\t* çªå‡ºè‹¦å‘³ï¼šæé«˜èƒå–ç‡çš„æ–¹æ³•\n* èƒå–æ—¶éœ€è¦é¿å…ï¼Œä¸¥é‡çš„èƒå–ä¸è¶³å’Œèƒå–è¿‡åº¦\n\t* é€šè¿‡åˆ†æ®µæ¥æ§åˆ¶æ€»ä½“èƒå–ç‡\n* æƒ³è¦æ§åˆ¶é…¸ï¼Œåªèƒ½é€šè¿‡æ”¹å˜æ°´è´¨çš„æ–¹æ³•\n* https://www.bilibili.com/video/BV1Y34y1k769\n\n","lastmodified":"2023-05-18T16:10:29.940349526Z","tags":["å’–å•¡"]},"/Cards/%E5%92%96%E5%95%A1/%E5%92%96%E5%95%A1%E8%B1%86":{"title":"å’–å•¡è±†","content":"\n# æ‘©å¡å£¶\n\nå•¡èˆå…‹é‡Œå¥¥ç‰‡æ„å¼æ‹¼é…ï¼šæ·±åº¦çƒ˜ç„™ã€‚227g 48.4å…ƒï¼Œ0.21å…ƒ/gã€‚å±åœ°é©¬æ‹‰ã€å“¥æ–¯è¾¾é»åŠ ã€æ´ªéƒ½æ‹‰æ–¯ã€‚å»ºè®®é…åˆç‰›å¥¶ã€‚\n\nè å‰ªå’–å•¡æˆå­æ—¥å¼æ·±çƒ˜ï¼šæ·±åº¦çƒ˜ç„™ã€‚66.63å…ƒ 250å…‹ 0.26å…ƒ/å…‹ã€‚åŸƒå¡ä¿„æ¯”äºšã€å“¥ä¼¦æ¯”äºšã€å·´è¥¿ã€‚å»ºè®®é…åˆç‰›å¥¶ã€‚\n\næ²»å…‰å¸ˆåŒ—é‡æ‹¼é…ï¼šæ·±åº¦çƒ˜ç„™ã€‚72.6å…ƒ 300å…‹ 0.24å…ƒ/å…‹ã€‚å“¥ä¼¦æ¯”äºšã€æ›¼ç‰¹å®ã€å±åœ°é©¬æ‹‰å’Œç§˜é²ã€é’å°¼äºšã€äº‘å—æ°´æ´—ã€‚å‡è¡¡ã€‚\n\nM2M Casanove æ„å¼æ‹¼é…ï¼šæ·±åº¦çƒ˜ç„™ã€‚85.9å…ƒ 500å…‹ 0.17å…ƒ/å…‹ã€‚åŸƒå¡ä¿„æ¯”äºšã€å“¥ä¼¦æ¯”äºšã€‚è‹¦å‘³çªå‡ºï¼Œæ²¡æœ‰é…¸å‘³ã€‚ç¾å¼å’Œå¥¶å’–éƒ½ä¸é”™ã€‚\n\nç½—é©¬å‡æ—¥æ„å¼æ‹¼é…ï¼šä¸­æ·±çƒ˜ç„™ã€‚61å…ƒ 454å…‹ 0.13å…ƒ/å…‹ã€‚å·´è¥¿ã€å“¥ä¼¦æ¯”äºšã€ä¹Œæ‰‹è¾¾ã€‚é€‚åˆåšå¥¶å’–ã€‚\n\næ¶²ä½“èŠå£«SOEï¼šä¸­æ·±çƒ˜ç„™ã€‚57.14å…ƒ227å…‹ 0.25å…ƒ/å…‹ã€‚åŸƒå¡ä¿„æ¯”äºšã€å¤å§¬ç½•è´æ‹‰ã€‚å£æ„Ÿé†‡åšé¡ºæ»‘ï¼Œå£æ„Ÿä½ï¼Œæ— é…¸ã€‚é…åˆæçº¯å¥¶ã€‚\n\nM2Mçƒ­å¸¦å…¬è·¯æ„å¼æ‹¼é…ï¼šä¸­åº¦çƒ˜ç„™ã€‚129å…ƒ 500å…‹ 0.26å…ƒ/å…‹ã€‚åŸƒå¡ä¿„æ¯”äºšã€å“¥ä¼¦æ¯”äºšã€‚ç”œæ„Ÿé«˜ï¼Œè‹¦æ„Ÿä½ï¼Œå‘³é“ä¸°å¯Œï¼Œé…¸å‘³çªå‡ºã€‚ç¾å¼ã€å¥¶å’–éƒ½é€‚åˆã€‚\n\nç‰›å¥¶ç”Ÿå·§æ„å¼æ‹¼é…ï¼šä¸­æ·±çƒ˜ç„™ã€‚45.5å…ƒ 250å…‹ 0.18å…ƒ/å…‹ã€‚äº‘å—ã€å“¥ä¼¦æ¯”äºšã€åŸƒå¡ä¿„æ¯”äºšã€‚é†‡åšåº¦å¾ˆé«˜ï¼Œæ²¹è„‚ä¸°å¯Œï¼Œå·§å…‹åŠ›é¦™ï¼Œé¡ºæ»‘ã€‚\n\n","lastmodified":"2023-05-18T16:10:29.940349526Z","tags":["å’–å•¡"]},"/Cards/%E5%92%96%E5%95%A1/%E6%91%A9%E5%8D%A1%E5%A3%B6":{"title":"æ‘©å¡å£¶","content":"\n# æ‘©å¡å£¶åŸºç¡€ç†è®º\n\nå…ˆæ˜¯å°ç«ï¼Œç„¶åå‡ºæ¶²åæ”¹æœ€å°ç«ï¼Œæœ€åç¦»ç«æˆ–é“ºæ»¡åº•éƒ¨åç¦»ç«ã€‚\n\nåŠ çƒ­å¯é€‰å¯¼çƒ­æ¿ï¼Œå¯ä»¥åœ¨å…³ç«åç»§ç»­ç¼“ç¼“é‡Šæ”¾çƒ­é‡ã€‚\n\nä½çƒ˜éœ€è¦æ›´å¤šçš„å’–å•¡æ¶²ï¼Œæ·±çƒ˜å¯ä»¥å°‘ä¸€äº›ï¼Œæ·±çƒ˜å¯ä»¥åœ¨è¿‡çƒ­ä¹‹å‰ï¼Œææ—©ç»“æŸèƒå–ã€‚åŒæ—¶èƒå–çš„æ¶²ä½“è¶Šå¤šï¼Œèƒå–ç‡ä¹Ÿå°±è¶Šé«˜ã€‚\n\nç²‰è¶Šç»†ï¼Œèƒå–å‹åŠ›è¶Šé«˜ï¼Œå¹¶æ²¡æœ‰å‘ç”Ÿé€šé“æ•ˆåº”ï¼ŒåŒæ—¶ç²‰è¶Šç»†ï¼Œèƒå–æ¸©åº¦è¶Šé«˜ã€‚\n\nä½†æ˜¯é«˜æ¸©èƒå–å‡ºæ¥çš„ï¼Œè™½ç„¶èƒå–ç‡é«˜ï¼Œå‘³é“å¹¶ä¸æ˜¯ç‰¹åˆ«å¥½ã€‚\n\nåº•éƒ¨åŠ å¼€æ°´ï¼Œæ”¾æ»¤çº¸ï¼ˆç”¨æ°´ç¨å¾®æµ¸æ¹¿ï¼‰ï¼Œå°ç«åŠ çƒ­ç›´åˆ°æ¶²ä½“æµå‡ºï¼Œç„¶åå…³é—­ç«æºï¼ˆå¦‚æœç”¨å¯¼çƒ­æ¿ï¼‰æˆ–æœ€å°ç«ï¼Œ10ç§’åç¦»å¼€çƒ­æºã€‚\n\n120gå’–å•¡æ¶²ï¼ŒåŠ å…¥80-100gæ°´\n\n---\n\næ‘©å¡å£¶ä¸»è¦è¦é¿å…è¿‡çƒ­ï¼Œè¿‡çƒ­ä¼šå¯¼è‡´éå¸¸è‹¦ã€‚\n\næ·±çƒ˜è±†å­ä¸è¦å¤ªæ»¡ï¼Œå¤ªæ»¡ä¼šé€ æˆæ›´é«˜çš„æ¸©åº¦\n\nå¦‚æœå‡ºæ¶²å¤ªå°‘ï¼Œåœ¨èƒå–è¶³å¤Ÿçš„æ¶²ä½“ä¹‹å‰å¼€å§‹å–·å°„ï¼Œæœ‰å¯èƒ½æ˜¯å’–å•¡è±†ç ”ç£¨çš„å¤ªç»†äº†ï¼›å¦å¤–è¿˜æœ‰å¯èƒ½æ˜¯å£¶å˜çƒ­çš„å¤ªå¿«ï¼Œåœ¨å‡ºæ¶²åå°è¯•ä½¿ç”¨æ›´å°ç«ã€‚\n\nå°å£¶åœ¨å‡ºæ¶²ååŸºæœ¬å¯ä»¥ç›´æ¥ç¦»ç«ã€‚\n\n# æ‘©å¡å£¶èƒå–é…æ–¹\n\næ‘©å¡æ–°æ‰‹è¿‘2ä¸ªæœˆçš„å°è¯•\n\nå•é˜€ä¸‰æ¯ä»½ï¼Œ18gç²‰ï¼Œæ„å¼ç ”ç£¨åº¦è½»å‹ï¼ŒåŠ ä¸ªæ»¤çº¸ï¼Œ90gæ°´å‡º50gä¸åˆ°ï¼Œç¾å¼æˆ–è€…æ‹¿é“éƒ½å¯\n\nåŒé˜€ä¸¤æ¯ä»½ï¼Œ20gç²‰ï¼Œå…¶ä»–å‚æ•°ä¸€è‡´ï¼Œæ‹¿é“æ›´å¥½å–ä¸€äº›ã€‚\n\n---\n\n16gå’–å•¡è±†ï¼ŒC40 7æ ¼ï¼ˆæ¯”æ„å¼è¿˜ç»†ä¸€ç‚¹ï¼‰ï¼Œçƒ­æ°´60gï¼Œé€šå¸¸å’–å•¡ç²‰çš„å¸æ°´é‡æ˜¯ç²‰é‡çš„ä¸¤å€ï¼Œå¾—åˆ°å’–å•¡æ¶²31.6gã€‚åšç¾å¼å’–å•¡æ¶²è·Ÿæ°´çš„æ¯”ä¾‹æ˜¯1:6ã€‚\n\nå•é˜€ä¸‰äººä»½+å¡æ–¯ç‚‰ä¸­ç«\nç»†ç ”ç£¨ C40 7æ ¼\nå°ç²‰æ°´æ¯”\n16gå’–å•¡ç²‰\n60gçƒ­æ°´ 70åº¦å·¦å³ 30gæ¶²ç¼©å’–å•¡\nåŠ æ°´åŠ å¥¶ 1ï¼š6 è‡ªè¡Œè°ƒæ•´\nè¿½æ±‚é«˜å“è´¨ï¼Œè¦è¿›è¡ŒæŒ‘è±†\n\n---\n\n18gå’–å•¡è±†ï¼ŒC40 10æ ¼ï¼ˆæ ‡å‡†æ„å¼ï¼‰ï¼Œæ°´90-100gï¼Œå¾—åˆ°60-70gå’–å•¡æ¶²ã€‚\n\næ¯”ä¹è’‚åŒé˜€åŒæ¯ä»½+æˆ·å¤–ä¸€ä½“ç“¦æ–¯ç‚‰\nç²—ç ”ç£¨ C4O 10æ ¼ \n18gå’–å•¡ç²‰\n100gçƒ­æ°´\n60gæµ“ç¼©å’–å•¡ï¼ˆä¿ç•™å‰ä¸­æ®µï¼‰ \nåŠ æ°´åŠ å¥¶åˆ°300mlï¼ˆè‡ªè¡Œè°ƒæ•´ï¼‰\n\n---\n\næ¯”ä¹è’‚åŒé˜€åŒæ¯ä»½+ç”µé™¶ç‚‰P3æ¡£\nä¸­ç­‰ç ”ç£¨ C40 8æ ¼\n1ï¼š6ç²‰æ°´æ¯”\n17gå’–å•¡ç²‰\n102gçƒ­æ°´\n60gå·¦å³æµ“ç¼©å’–å•¡\næ ¹æ®è‡ªå·±å–œå¥½åŠ æ°´/å¥¶\n\n---\n\n16gç²‰é‡ï¼Œç£¨è±†æœºåˆ»åº¦30ï¼Œæ°´é‡75gå·¦å³\n\nå‡ºæ¶²30gå·¦å³ï¼Œå‘³é“ç¨å¾®æœ‰ç‚¹é…¸ï¼Œå¾®ç”œï¼Œç•¥è‹¦","lastmodified":"2023-05-18T16:10:29.940349526Z","tags":["å’–å•¡"]},"/Cards/%E5%92%96%E5%95%A1/%E6%B1%89%E5%8C%A0K6%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E":{"title":"æ±‰åŒ K6ä½¿ç”¨è¯´æ˜","content":"\n# åˆ»åº¦å‚è€ƒ\n\n- æ„å¼ï¼š0.5-1 åœˆ\n- æ‘©å¡å£¶ï¼š1-1.5 åœˆ\n- æ‰‹å†²ã€å†·èƒï¼š1.5-2 åœˆ\n- æ³•å‹ï¼š2.5 åœˆ\n\n# å®é™…åˆ»åº¦\n\n- æ„å¼ï¼š35 æ ¼\n- å†·èƒï¼šä¸€åœˆ 15 æ ¼\n\n# ç”µé’»\n\nç”µé’»15æ‰­çŸ©ä»¥ä¸Šï¼Œæ­é… 6.35mm æˆ–14è‹±åˆ¶å†…å…­è§’å¥—ç­’å³å¯\n\nå¥—ç­’æœç´¢å…³é”®è¯ï¼šæ‰¹å¤´åŠ é•¿æ¥æ†ç”µé’»æ¥å¤´å»¶é•¿æ† 6.35mm ç£æ€§å†…å…­è§’1/4å¥—ç­’è‡ªé”è¿æ¥æ†\n\n# è¯´æ˜ä¹¦\n\n![[Extras/Images/4A2E0104-B3B0-4D1F-8EF2-F0FDD0DFE7C0_1_102_o.jpeg]]\n","lastmodified":"2023-05-18T16:10:29.940349526Z","tags":["å’–å•¡","ç£¨è±†æœº"]},"/Cards/%E5%92%96%E5%95%A1/%E7%A3%A8%E8%B1%86%E6%9C%BA":{"title":"ç£¨è±†æœº","content":"\n# ç£¨è±†æœºçš„å½±å“å› ç´ \n\né¢—ç²’å½¢çŠ¶ï¼Œå¹³åˆ€ç‰‡çŠ¶ï¼Œèƒå–ç‡æ›´é«˜ï¼Œæº¶è§£çš„ä¸€è‡´æ€§æ›´å¥½ã€‚é¬¼é½¿é”¥åˆ€å—çŠ¶ï¼Œèƒå–ç‡ç›¸å¯¹ä½ã€‚éœ€è¦æ ¹æ®å½¢çŠ¶è°ƒæ•´å‚æ•°\n\nç²’å¾„åˆ†å¸ƒã€‚åˆ†å¸ƒè¶Šé›†ä¸­ä¸€è‡´æ€§æ›´å¥½ï¼Œåˆ†å¸ƒå®½æ³›ä¸€ç‚¹ä¼šæœ‰å·®å¼‚æ€§å‘³é“ã€‚å“ªä¸ªæ›´å¥½å–å†³äºä¸ªäººï¼Œæ²¡æœ‰ç»å¯¹å¥½å\n\nç»†ç²‰ï¼Œä¸¤ä¸ªä½œç”¨ï¼Œä¸€æ˜¯å¢åŠ å±‚æ¬¡æ„Ÿä¸°å¯Œæ€§ï¼ŒäºŒæ˜¯å µæ»¤çº¸åº•å¢åŠ èƒå–ç‡ã€‚åˆ°åº•ç»†ç²‰å¥½ä¸å¥½éœ€è¦æ ¹æ®è±†å­ç­‰å…·ä½“åˆ¤æ–­\n\nåˆ€ç‰‡ç›´å¾„ï¼Œå½±å“ç ”ç£¨é€Ÿåº¦ï¼Œè¶Šå¤§è¶Šå¿«ã€‚å‘çƒ­å®¶ç”¨å¯ä»¥åŸºæœ¬å¿½ç•¥ï¼Œå•†ç”¨å‘çƒ­è¶Šå°‘è¶Šå¥½\n\nek43æ˜¯ä¸­å›½å’–å•¡ä¸šçš„æœ€å¤§ç¬‘è¯ï¼Œé™¤éä½ æ˜¯å¼€å’–å•¡åº—ç»™åˆ«äººç£¨è±†å­æˆ–è€…å‚èµ›è¦æ±‚0æ®‹ç²‰ï¼Œè¦ä¸ç„¶é‚£äº›é’±ä¹°ä¸ªåŒå“è´¨ç£¨è±†æœºè¿˜èƒ½å‰©å¾ˆå¤š","lastmodified":"2023-05-18T16:10:29.940349526Z","tags":["å’–å•¡"]},"/Cards/%E5%92%96%E5%95%A1/%E8%83%B6%E5%9B%8A%E5%92%96%E5%95%A1":{"title":"èƒ¶å›Šå’–å•¡","content":"\n* nespresso\n\t* æµ“ç¼©å’–å•¡\n\t\t* volluto æ²ƒé²æ‰˜\n\t* çµæ„Ÿä¹‹æº\n\t\t* arpeggio é˜¿ä½©å¥‡æ¬§\n\t* å¤§æ¯ç³»åˆ—\n\t\t* Tokyo ä¸œäº¬å”¯æ²ƒæ‰˜\n\t* å¤§å¸ˆåŒ å¿ƒ\n\t\t* Ethiopia åŸƒå¡ä¿„æ¯”äºš\n\t\t* Nicaragua å°¼åŠ æ‹‰ç“œ\n* illy\n\t* ä¸­åº¦çƒ˜ç„™\n\t* æ·±åº¦çƒ˜ç„™\n* æ˜è°¦\n\t* å¹³è¡¡70","lastmodified":"2023-05-18T16:10:29.940349526Z","tags":["å’–å•¡"]},"/Cards/%E5%92%96%E5%95%A1/Understanding-Espresso":{"title":"Understanding Espresso","content":"\n# Dose (Episode #1)\n\n## Extraction theory\n\nä»å’–å•¡ç²‰ä¸­æå–å¯æº¶è§£ç‰©è´¨\n\n![CleanShot 2022-12-31 at 22.49.46-2x.png](Extras/Images/CleanShot_2022-12-31_at_22.49.46-2x_1672498192970_0.png)\n\n## How much work\n\næå–å¯æº¶è§£ç‰©è´¨åˆ°æ¯å­ä¸­æ˜¯åšåŠŸï¼ˆworkï¼‰\n\nä¸ºäº†æé«˜èƒå–ç‡å¿…é¡»æ›´åŠ åŠªåŠ›åšåŠŸ\n\nç”¨çš„å’–å•¡ç²‰è¶Šå¤šï¼Œå¿…é¡»åšçš„åŠŸä¹Ÿè¶Šå¤š\n\n## The basket\n\nç²‰ç¢—æ˜¯æœ€ä¸»è¦çš„å†³å®šç²‰é‡çš„å› ç´ \n\nç²‰ç¢—æ ‡æ³¨å¤§å°çš„æ­£è´Ÿ1gæ˜¯åº”è¯¥ä½¿ç”¨çš„ç²‰é‡å¤§å°\n\nå¦‚æœä½¿ç”¨çš„ç²‰é‡è¿‡å°‘ï¼Œä¼šåœ¨ç²‰é¥¼é¡¶ç«¯å’Œå†²ç…®å¤´ä¹‹é—´äº§ç”Ÿä¸€äº›ç©ºéš™ã€‚è¿™ä¼šé€ æˆç²‰é¥¼å‡Œä¹±ã€ç³ŠçŠ¶ï¼Œè¿™æ ·çš„ç²‰é¥¼æ— æ³•å‘Šè¯‰ä½ ä»»ä½•å…³äºèƒå–æ—¶å‘ç”Ÿäº†ä»€ä¹ˆä¿¡æ¯ï¼ŒåŒæ—¶è¿™ä¹Ÿéå¸¸éš¾ä»¥æ¸…ç†ã€‚\n\nä½¿ç”¨æ›´å¤šçš„ç²‰é‡å¹¶æ²¡æœ‰ä»»ä½•æ›´å¥½çš„åœ°æ–¹ã€‚ä¼ ç»Ÿä¸­ä½¿ç”¨æ›´å¤šçš„ç²‰é‡ï¼Œæ˜¯å› ä¸ºä»¥å‰ç£¨è±†æœºæ²¡æœ‰å®šé‡åŠŸèƒ½ï¼Œåªèƒ½ä¸ºäº†å¾—åˆ°ç»Ÿä¸€çš„ç²‰é‡ï¼Œè€Œæ‰‹åŠ¨çš„å¡«æ»¡ç²‰ç¢—ã€‚ç°åœ¨ç£¨è±†æœºæœ‰äº†å®šé‡åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä½•æˆ‘ä»¬æƒ³è¦çš„ç²‰é‡ã€‚\n\n## The coffee\n\nå’–å•¡è¶Šæ˜¯æ·±çƒ˜ï¼Œèƒå–æ—¶éœ€è¦åšçš„åŠŸè¶Šå°‘ï¼Œè¶Šå®¹æ˜“å¾—åˆ°å¯æº¶è§£ç‰©è´¨ã€‚\n\né€šå¸¸æ¥è¯´ï¼Œæ›´æ·±çƒ˜çš„å’–å•¡ä½¿ç”¨æ›´å¤šçš„ç²‰é‡æ˜¯å¯ä»¥çš„ï¼Œè€Œæµ…çƒ˜çš„å’–å•¡éœ€è¦æ›´åŠªåŠ›çš„åšå·¥èƒå–ã€‚ä½¿ç”¨å¤§ç²‰é‡éœ€è¦åšçš„åŠŸå¤ªå¤šï¼Œéœ€è¦ä¸å¯èƒ½çš„åšåŠŸé‡ï¼Œæ€»æ˜¯ä¼šå¾—åˆ°é…¸æ¶©ã€ä¸å®Œå…¨èƒå–çš„ã€è–„å¼±çš„é†‡åšæ„Ÿã€‚\n\næ‰€ä»¥æ¨èæµ…çƒ˜ä½¿ç”¨å°ç²‰é‡ã€‚\n\n## What should we do\n\nåœ¨å’–å•¡å°èµ·æ¥å¯ä»¥ï¼Œä½†æ˜¯è¿˜å¯ä»¥ç¨å¾®è°ƒæ•´ä¸€ä¸‹çš„æ—¶å€™ï¼Œåº”è¯¥ç¨ç¨å¢åŠ 0.5gç²‰é‡ï¼Œè€Œä¸æ˜¯è°ƒæ•´ç£¨è±†æœºåˆ»åº¦ã€‚ä½¿ç”¨çš„å’–å•¡ç²‰é‡è¶Šå¤šï¼Œç²‰é¥¼æä¾›çš„é˜»åŠ›å°±è¶Šé«˜ï¼Œæ°´è¶Šéš¾é€šè¿‡ç²‰é¥¼ï¼Œå¾—åˆ°æƒ³è¦çš„ç²‰æ°´æ¯”éœ€è¦çš„æ¥è§¦æ—¶é—´æ›´é•¿ã€‚è¿™ä¼šä½¿å¾—èƒå–æ—¶é—´ç¨å¾®å»¶é•¿ï¼Œç¨å¾®å¤šä¸€ç‚¹å’–å•¡æ¶²ï¼Œä½†æ˜¯ç²‰æ°´æ¯”ä¸å˜ï¼Œè¿™ä¼šä½¿ç”¨å¯èƒ½æœ€å°çš„æµªè´¹ï¼Œå¾—åˆ°æœ€ç¾å‘³çš„å’–å•¡ã€‚ç›¸åï¼Œèƒå–æ—¶é—´å¤ªé•¿æ—¶ï¼Œä¹Ÿå¯ä»¥ç¨å¾®å‡å°‘ç²‰é‡ï¼Œä½¿å¾—æµé€Ÿæ›´å¿«ã€‚åŒæ—¶å‡å°‘ç²‰é‡ï¼Œåšçš„åŠŸä¹Ÿè¶Šå°‘ï¼Œè¿™æ ·å³ä½¿æµé€Ÿç¨å¾®è¿‡å¿«ï¼Œèƒå–ä»ç„¶å¾ˆå¥½ã€‚æ‰€ä»¥å°è°ƒæ•´æ˜¯å¯ä»¥çš„ï¼Œåªè¦ç²‰é¥¼çŠ¶æ€æ²¡é—®é¢˜ï¼Œä½†å¦‚æœå·®å¾—å¾ˆè¿œï¼Œé‚£å°±ä¸è¦æ”¹å˜ç²‰é‡ï¼Œè€Œä¸”è°ƒæ•´å…¶ä»–å˜é‡ã€‚\n\n## Caffeine\n\nç²‰é‡è¶Šå¤šï¼Œå–åˆ°çš„å’–å•¡å› ä¹Ÿå°±è¶Šå¤šã€‚\n\næ¯ä¸€æ¬¡ç”¨çš„ç²‰é‡è¶Šå¤šï¼Œä¸€å¤©ä¸­åˆ¶ä½œå’–å•¡æ¬¡æ•°å°±åº”è¯¥è¶Šå°‘ã€‚é€šè¿‡å‡å°‘ç²‰é‡ï¼Œå¯ä»¥å¢åŠ ä¸€å¤©ä¸­å¯ä»¥åˆ¶ä½œå’–å•¡çš„æ¬¡æ•°ï¼Œå¹¶ä¸”ä¸ä¼šè®©ä½ å’–å•¡å› è¿‡é‡ã€‚\n\n# Ratio (Episode #2)\n\n![CleanShot 2022-12-31 at 23.58.06-2x.png](Extras/Images/CleanShot_2022-12-31_at_23.58.06-2x_1672502304195_0.png)\n\næ°´åœ¨å’–å•¡åˆ¶ä½œä¸­æ˜¯ä¸€ç§æº¶å‰‚ï¼Œç”¨æ¥æº¶è§£å›ºä½“ç‰©è´¨ï¼Œå°†å’–å•¡ç²‰ä¸­çš„å¥½é£å‘³å’Œå…¶ä»–çš„å¥½ç‰©è´¨ï¼Œèƒå–å‡ºæ¥ä»¥ä¾›æˆ‘ä»¬æœ€ç»ˆèƒ½å¤Ÿå“å°çš„ã€‚ä½ æ˜¯ç”¨çš„æº¶å‰‚è¶Šå¤šï¼Œä½ èƒå–å¾—å°±è¶Šå¤šï¼Œä½ ç©¿è¿‡å’–å•¡ç²‰é¥¼çš„æ°´è¶Šå¤šï¼Œä½ ä»ä¸­èƒå–å‡ºçš„å›ºä½“ç‰©è´¨å°±è¶Šå¤šã€‚è¿™æ˜¯ä¸€ç§å¾ˆç®€å•çš„æ–¹æ³•ï¼Œå»å¢åŠ æˆ–å‡å°‘ä½ çš„èƒå–é‡ã€‚\n\næœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„æ³¨æ„äº‹é¡¹ï¼Œæ”¹å˜æ°´é‡ä¼šåŒæ—¶æ”¹å˜ä¸¤ä¸ªè¾“å‡ºé‡ã€‚å½“ä½¿ç”¨æ›´å¤šçš„æ¶²ä½“ï¼Œæ˜æ˜¾èƒ½å¢åŠ èƒå–ç‡ï¼Œä½†åŒæ—¶ä¹Ÿä¼šé™ä½å’–å•¡çš„å¼ºåº¦ã€‚\n\nç”¨å›ºå®šçš„æ¯”ä¾‹ä½œä¸ºå¼€å§‹ï¼Œè¿™æ˜¯æ›´åŠ äº«å—çš„æµ“ç¼©å’–å•¡é£å‘³æ¯”ä¾‹ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šä½¿ç”¨1:2åˆ°1:2.2çš„æ¯”ä¾‹åŒºé—´ã€‚ç„¶åä»¥è¿™ä¸ªå›ºå®šå’Œç¨³å®šçš„æ¯”ä¾‹å¼€å§‹è¿›è¡Œè°ƒæ•´ã€‚\n\nä»ä¾‹å¦‚è°ƒèŠ‚ç£¨è±†æœºå¼€å§‹å°è¯•ï¼Œè¾¾åˆ°æƒ³è¦çš„æ„å¼å’–å•¡é£å‘³ï¼Œè€Œä¸æ˜¯ç›²ç›®æ··ä¹±åœ°å°è¯•ä¸åŒçš„æ¯”ä¾‹ã€‚å¦‚æœéœ€è¦åˆ¶ä½œä¸€æ¯æµ“ç¼©ï¼Œä½†ä¸æƒ³æ”¹å˜ç£¨è±†æœºçš„è®¾ç½®ï¼Œä½†æƒ³æœ‰è½»å¾®çš„è°ƒæ•´ï¼Œè¿™æ˜¯åº”ç”¨æ¯”ä¾‹çš„æœ€å¥½æœºä¼šï¼Œä½ ä¼šæ„Ÿåˆ°éœ‡æƒŠï¼Œä»…å› ä¸ºå¤šäº†2-3æ¯«å‡çš„å’–å•¡æ¶²ï¼Œå°±äº§ç”Ÿäº†è¿™ä¹ˆå¤šå˜åŒ–ã€‚\n\nå¦‚æœéœ€è¦å¤šå‡ºå¤šä½™2æˆ–3å…‹çš„å˜åŒ–ï¼Œé‚£é£å‘³å’Œå£æ„Ÿçš„å˜åŒ–ï¼Œç¦»æˆ‘æƒ³è¾¾åˆ°çš„æ„å¼å’–å•¡é£å‘³ä¼šæœ‰å¾ˆå¤§å˜åŒ–ï¼Œæ‰€ä»¥å€¾å‘äºä¸è¦æ”¹å˜è¿™ä¹ˆå¤šï¼Œå¦åˆ™å’–å•¡æ¶²ä¼šè¢«ç¨€é‡Šå¤ªå¤šï¼Œæ‰€ä»¥å€¾å‘äºæ”¹å˜ç²‰é‡æˆ–ç£¨è±†æœºè®¾ç½®ã€‚ä½†è‹¥æƒ³å¿«é€Ÿç®€å•åœ°åšå‡ºè°ƒæ•´ï¼Œè°ƒæ•´æ¯”ä¾‹ã€‚\n\n# Brew Time (Episode #3)\n\nå†²ç…®æ—¶é—´çš„å®šä¹‰æ˜¯ï¼Œä»åœ¨å’–å•¡æœºä¸ŠæŒ‰ä¸‹å¼€å§‹é”®å¼€å§‹ï¼Œåˆ°æŒ‰ä¸‹ç»“æŸé”®ç»“æŸï¼Œæ˜¯æ•´ä¸ªå†²ç…®è¿‡ç¨‹çš„æŒç»­æ—¶é—´ã€‚å»ºè®®çš„å†²ç…®æ—¶é—´èŒƒå›´æ˜¯25-30ç§’ã€‚\n\nè¿˜æœ‰ä¸€ç§å®šä¹‰æ˜¯ï¼Œä»å’–å•¡æ¶²å¼€å§‹å‡ºç°ï¼Œç›´åˆ°æŒ‰ä¸‹åœæ­¢æŒ‰é’®ã€‚å¦‚æœä½ å¼€å§‹è°ƒæ•´é¢„æµ¸æ³¡æ—¶é—´ï¼Œæ— è®ºæ˜¯è°ƒçŸ­è¿˜æ˜¯è°ƒé•¿ï¼Œåœ¨è¿™ç§å®šä¹‰ä¸‹å†²ç…®æ—¶é—´æ˜¯è¶‹è¿‘å’Œç›¸ä¼¼çš„ã€‚\n\næ€»ç»“ï¼Œå¯¹æ–°æ‰‹æ¥è¯´25-30ç§’çš„å†²ç…®æ—¶é—´è§„åˆ™éå¸¸æœ‰å¸®åŠ©ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨æ æ†æœºï¼Œæˆ–æœ‰å‹åŠ›å’Œæµé‡å‰–æçš„æœºå™¨ï¼Œä½ å¯ä»¥ç ´åè¿™ä¸ªè§„åˆ™ã€‚\n\n# Grind Size (Episode #4)\n\nä½¿ç”¨æ­£ç¡®çš„ç ”ç£¨åº¦æ¥è·å¾—ç¾å‘³çš„å’–å•¡ï¼Œä¿®å¤é…æ–¹è€Œä¸æ˜¯æ”¹å˜ã€‚è°ƒæ•´ç ”ç£¨åº¦æ¥è·å¾—ä¸€æ¯ä¸é”™çš„å’–å•¡ï¼Œç„¶åç”¨é…æ–¹ä¸­çš„å…¶ä»–å˜é‡æ¥è¿›è¡Œå¾®è°ƒã€‚\n\nå°½å¯èƒ½çš„ç£¨çš„æ›´ç»†ï¼Œç›´åˆ°äº§ç”Ÿé€šé“ã€‚äº§ç”Ÿé€šé“çš„å’–å•¡ä¼šæ¯”é¢„æœŸçš„æ›´åŠ è–„å¼±ã€ç©ºæ´ä¸€äº›ï¼ŒåŒæ—¶ä½™å‘³ä¹Ÿä¼šå…·æœ‰é…¸æ¶©å’Œè‹¦æ¶©çš„å‘³é“ã€‚\n\nåœ¨åŒä¸€æ—¶é—´åªæ”¹å˜ä¸€ç§è·Ÿæµé€Ÿæœ‰å…³çš„å˜é‡ã€‚å¦‚æœè¦æ”¹å˜ç ”ç£¨åº¦ï¼Œé‚£ä¹ˆå°±ä¸è¦åŒæ—¶æ”¹å˜ç²‰é‡ã€‚\n\næ”¹å˜ç ”ç£¨åº¦åï¼Œæ¸…ç†æ˜¯æœ‰å¿…è¦çš„ã€‚\n\n# Brew Temperature (Episode #5)\n\nä¸€èˆ¬æ¥è¯´æ¸©åº¦è¶Šé«˜ï¼Œèƒå–ç‡ä¹Ÿå°±è¶Šé«˜ã€‚æ¸©åº¦æ˜¯ä¸€ä¸ªå¾®è°ƒçš„å˜é‡ã€‚å…ˆè°ƒæ•´ç²‰é‡ã€æ¯”ä¾‹ã€é…æ–¹ï¼Œç„¶åå†è€ƒè™‘è°ƒæ•´æ¸©åº¦ã€‚ç²‰é‡å’Œæ¯”ä¾‹ï¼Œæ¯”èµ·æ¸©åº¦ï¼Œä¼šå¯¹å’–å•¡é£å‘³æœ‰æ›´å¤§çš„å½±å“ã€‚\n\nä¸€èˆ¬æ¥è¯´ï¼Œæ·±çƒ˜85-90åº¦ï¼Œä¸­çƒ˜88-92åº¦ï¼Œæµ…çƒ˜90-85åº¦ã€‚\n\n# Pressure (Episode #6)\n\né¢„æµ¸æ³¡çš„å®šä¹‰ï¼Œæ˜¯ä»æ°´è¿›å…¥ç²‰ç¢—çš„æ—¶åˆ»å¼€å§‹ï¼Œå½“æœºå™¨è¾¾åˆ°å†²ç…®å‹åŠ›å·…å³°ç»“æŸã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œè‡´åŠ›äºåœ¨é«˜å‹çš„æ°´é€šè¿‡å’–å•¡ç²‰ä¹‹å‰ï¼Œå°†æ‰€æœ‰çš„å’–å•¡ç²‰éƒ½å‡åŒ€çš„æµ¸æ³¡ã€‚åœ¨ç†è®ºä¸Šï¼Œé•¿æ—¶é—´çš„é¢„æµ¸æ³¡ä¿ƒè¿›äº†èƒå–çš„å‡åŒ€æ€§ï¼Œç”±æ­¤äº§ç”Ÿæ›´ç¾å‘³çš„å’–å•¡ã€‚\n\n9 baræ˜¯æœŸæœ›å€¼ï¼Œä½†ç”¨èµ·æ¥æ¯”è¾ƒå›°éš¾ï¼Œå¯èƒ½ä¼šå‡ºç°é€šé“ç­‰ã€‚é€šè¿‡å‡å°‘å‹åŠ›ï¼Œå¯ä»¥è®©èƒå–å˜å¾—ç®€å•ä¸€äº›ã€‚è¿™æ˜¯ä¸€ä¸ªå¦¥åï¼Œä½†æ˜¯æ€»ä½“æ¥è¯´ä¼šå¾—åˆ°ä¸€æ¯æ›´å¥½çš„æµ“ç¼©ã€‚\n\n","lastmodified":"2023-05-18T16:10:29.940349526Z","tags":["å’–å•¡"]},"/Cards/%E5%B7%A5%E5%85%B7%E5%88%86%E4%BA%AB":{"title":"å·¥å…·åˆ†äº«","content":"\n# åŸºç¡€è®¾æ–½\n\n## æœåŠ¡å™¨\n\n### Deskmini ä»‹ç»\n\n![[Extras/Images/Pasted image 20230416112309.png]]\n\n1. å°å‹åŒ–APUå¹³å°ï¼Œä½“ç§¯ä»…1.92å‡\n2. æœ€å¤§æ”¯æŒå†…å­˜64G\n3. 2x M.2 PCIe Gen3 x4 + 2x 2.5\" SATA 6Gb SSD/HDD\n4. å¯ä»¥å°†å…¶ä¸­ä¸€ä¸ªM.2æ¥å£è½¬æ¥æœ‰çº¿ç½‘å¡\n\n### å…·ä½“é…ç½®\n\n1. CPU: AMDÂ Ryzenâ„¢ 5Â 3400GÂ with Radeonâ„¢ RX Vega 11 Graphicsï¼ˆ938 Â¥ï¼‰\n2. MEM: DDR4 64G 3200MHz ï¼ˆ800 Â¥ï¼‰\n3. å‡†ç³»ç»Ÿ+æœºç®±ï¼šDeskMini A300 ï¼ˆ987 Â¥ï¼‰\n4. ç¡¬ç›˜: 256Gï¼ˆNVMEï¼‰ + 4Tï¼ˆ2x SATA 2.5\" SSDï¼‰ï¼ˆ265 Â¥ + 1800 Â¥ï¼‰\n5. é£æ‰‡: çŒ«å¤´é¹° NF-A9x14 PWM 9cm ï¼ˆ125 Â¥ï¼‰\n\næ€»ä»·ï¼š4915 Â¥\n\nçº¯ SSD ç¡¬ç›˜+çŒ«æ‰‡ï¼šé™éŸ³ï¼Œå‡ ä¹æ²¡æœ‰å£°éŸ³ï¼Œå¯ç›´æ¥æ”¾åœ¨å§å®¤ï¼›æ€§èƒ½å¼ºåŠ²ï¼Œ8C16T CPUï¼Œ64G å†…å­˜ã€‚\n\n### æ“ä½œç³»ç»Ÿ\n\n#### Gentoo Linux\n\n##### ä»‹ç»\n\n[About Gentoo â€“ Gentoo Linux](https://www.gentoo.org/get-started/about/)\n\nGentoo æ˜¯ä¸€ä¸ª **æºç çº§**Â GNU/Linux å‘è¡Œç‰ˆï¼Œæœ€æœ‰ä»£è¡¨æ€§çš„ç‰¹ç‚¹å°±æ˜¯è®©ç”¨æˆ·è‡ªå·±ç¼–è¯‘ç³»ç»Ÿçš„å‡ ä¹æ‰€æœ‰ç»„ä»¶ï¼Œä¹ƒè‡³äº Linux å†…æ ¸ä¹Ÿå¯ä»¥è‡ªå·±ç¼–è¯‘ã€‚\n\nGentoo Linux æ˜¯ä¸€ç§å¯ä»¥é’ˆå¯¹ä»»ä½•åº”ç”¨å’Œéœ€è¦è€Œè‡ªåŠ¨ä¼˜åŒ–å’Œè‡ªå®šä¹‰çš„ç‰¹æ®Šçš„ Linux å‘è¡Œç‰ˆã€‚Gentoo æ‹¥æœ‰ä¼˜ç§€çš„æ€§èƒ½ã€é«˜åº¦çš„å¯é…ç½®æ€§å’Œä¸€æµçš„ç”¨æˆ·åŠå¼€å‘ç¤¾åŒºã€‚\n\n##### ä¼˜ç‚¹\n\n1. ä»æºç æ„å»º\n2. ç¨³å®šæ€§é«˜\n3. è‡ªç”±åº¦é«˜\n4. æ»šåŠ¨å‡çº§\n5. è½¯ä»¶åŒ…å¤šä¸”æ–°\n\nGentoo Linux çš„æ¯ä¸€éƒ¨åˆ†éƒ½å¯ä»¥åœ¨æœ€ç»ˆç”¨æˆ·çš„ç³»ç»Ÿä¸Šé‡æ–°ç¼–è¯‘å»ºé€ ï¼Œç”šè‡³åŒ…æ‹¬æœ€åŸºæœ¬çš„ç³»ç»Ÿåº“å’Œç¼–è¯‘å™¨è‡ªèº«ã€‚é€šè¿‡ä¾èµ–å…³ç³»æè¿°å’Œæºä»£ç é•œåƒçš„å½¢å¼æä¾›è½¯ä»¶ï¼Œ**Gentoo Linux**æä¾›äº†å¤§é‡è½¯ä»¶ä¾›ç”¨æˆ·é€‰æ‹©ã€‚\n\nç”±äºå¯ä»¥åœ¨æœ¬åœ°ç¼–è¯‘è½¯ä»¶ï¼Œå‚æ•°å’Œå˜é‡çš„é€‰æ‹©å¯ä»¥ç”±ç”¨æˆ·è‡ªå·±æŒ‡å®šã€‚\n\næŒ‡å®šå‚æ•°çš„ä¼˜åŠ¿ä¸ä»…åœ¨äºç”¨æˆ·äº†è§£äº†è®¾ç½®ï¼Œæ›´å¤šæ˜¯å¢åŠ äº†é’ˆå¯¹ç¡¬ä»¶è¿›è¡Œæ€§èƒ½æå‡çš„ä½™åœ°ã€‚ è€Œä¸”ç”¨æˆ·å¯ä»¥ä½¿ç”¨è‡ªå·±å–œæ¬¢çš„è¡¥ä¸æˆ–æ’ä»¶å¯¹è½¯ä»¶åŠŸèƒ½è¿›è¡Œè°ƒæ•´ï¼Œæ¯”å¦‚å½“å‰çš„**Gentoo Linux**å†…æ ¸å‘å¸ƒåŒ…æ‹¬15ç§ã€‚\n\n##### ç¼ºç‚¹\n\n1. ä»æºç æ„å»ºè´¹æ—¶ã€è´¹ç”µ\n2. å®‰è£…ã€é…ç½®å¤æ‚\n\nå®‰è£… Gentoo Linux å¯¹è®¡ç®—æœºç³»ç»Ÿçš„æ€§èƒ½ä¹Ÿæœ‰è¾ƒé«˜çš„è¦æ±‚ï¼ŒåŒ…æ‹¬ CPU å’Œå­˜å‚¨å™¨ï¼Œä¸è¿‡éšç€è®¡ç®—æœºäº§ä¸šçš„å¿«é€Ÿå‘å±•ï¼Œå³ä½¿ä¸­ä½ç«¯ PC å’Œç¬”è®°æœ¬ä¹Ÿèƒ½è¾ƒä¸ºå¿«é€Ÿåœ°å®Œæˆç¼–è¯‘ã€‚å½“ç„¶è¿™ä¸æ„å‘³ç€ Gentoo Linux ä¸èƒ½ä½¿ç”¨åœ¨ä½é…ç½®è®¾å¤‡ä¸Šï¼Œåªæ˜¯ç”¨æˆ·å°†ä¼šåœ¨å®‰è£…ç›¸åŒçš„ç¯å¢ƒæ—¶ä¼šä»˜å‡ºæ›´å¤šæ—¶é—´ï¼Œæˆ–è€…ä½¿ç”¨å¦ä¸€å°ä¸»æœºä¸Šé¢„ç¼–è¯‘å¥½çš„è½¯ä»¶åŒ…ï¼ˆBINHOST æ–¹å¼ï¼‰ã€‚\n\nGentoo Linuxè®©ç”¨æˆ·è‡ªè¡Œè®¾ç½®å’Œç¼–è¯‘è½¯ä»¶åŒ…çš„ç‰¹æ€§ï¼Œä½¿ç”¨æˆ·çš„Gentoo Linuxç³»ç»Ÿå…·æœ‰é«˜åº¦å¯å¡‘æ€§ï¼Œä½†ç›¸æ¯”èµ·å…¶ä»–å¸¸è§çš„Linuxå‘è¡Œç‰ˆï¼ŒGentoo Linuxçš„ç”¨æˆ·ä¹Ÿéœ€è¦å¯¹Linuxç³»ç»Ÿå’Œç”µè„‘çš„è¿ä½œæœ‰ä¸€å®šçš„è®¤è¯†ï¼Œæ‰èƒ½å¯¹å…¶ç³»ç»Ÿä½œå‡ºåˆé€‚çš„è®¾ç½®ã€‚\n\n#### Openwrt\n\n\u003e [!info] å®˜æ–¹ä»‹ç»\n\u003e OpenWrté¡¹ç›®æ˜¯ä¸€ä¸ªé’ˆå¯¹åµŒå…¥å¼è®¾å¤‡çš„Linuxæ“ä½œç³»ç»Ÿã€‚OpenWrtä¸æ˜¯ä¸€ä¸ªå•ä¸€ä¸”ä¸å¯æ›´æ”¹çš„å›ºä»¶ï¼Œè€Œæ˜¯æä¾›äº†å…·æœ‰è½¯ä»¶åŒ…ç®¡ç†åŠŸèƒ½çš„å®Œå…¨å¯å†™çš„æ–‡ä»¶ç³»ç»Ÿã€‚è¿™ä½¿æ‚¨å¯ä»¥ä»ä¾›åº”å•†æä¾›çš„åº”ç”¨èŒƒå›´å’Œé…ç½®ä¸­è§£è„±å‡ºæ¥ï¼Œå¹¶ä¸”è®©æ‚¨é€šè¿‡ä½¿ç”¨é€‚é…ä»»ä½•åº”ç”¨çš„è½¯ä»¶åŒ…æ¥å®šåˆ¶è®¾å¤‡ã€‚å¯¹äºå¼€å‘äººå‘˜æ¥è¯´ï¼ŒOpenWrtæ˜¯ä¸€ä¸ªæ— éœ€å›´ç»•å®ƒæ„å»ºå®Œæ•´å›ºä»¶å°±èƒ½å¼€å‘åº”ç”¨ç¨‹åºçš„æ¡†æ¶; å¯¹äºæ™®é€šç”¨æˆ·æ¥è¯´ï¼Œè¿™æ„å‘³ç€æ‹¥æœ‰äº†å®Œå…¨å®šåˆ¶çš„èƒ½åŠ›ï¼Œèƒ½ä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼ä½¿ç”¨è¯¥è®¾å¤‡ã€‚\n\n[OpenWrt Wiki æ¬¢è¿è®¿é—® OpenWrt é¡¹ç›®]( https://openwrt.org/zh/start )\n\n##### ä¼˜åŠ¿\n\n- æ— é¡»è‡ªå·±ç¼–è¯‘ï¼Œç›´æ¥ä½¿ç”¨åˆ«äººæ„å»ºå¥½çš„é•œåƒä¸è½¯ä»¶åŒ…ï¼Œå®‰è£…è½¯ä»¶è·Ÿå…¶ä»– linux ç³»ç»Ÿä¸€æ ·ç®€å•\n- åŸºäº Linux ç³»ç»Ÿï¼Œå¯æ‹“å±•æ€§éå¸¸å¼º\n\n##### ç¼ºç‚¹\n\n- ç¡¬è·¯ç”±ä½“éªŒä¸€èˆ¬\n- è®¸å¤šç¡¬ä»¶è·¯ç”±å™¨æ²¡æœ‰å¼€æ”¾é©±åŠ¨\n- é©±åŠ¨ä¸å®Œå–„\n\n##### å»ºè®®\n\n- ä½¿ç”¨ X86 æ¶æ„\n- ä½¿ç”¨æ—§ç”µè„‘æˆ–ç½‘ä¸Šè´­ä¹°ä¸“é—¨å®šåˆ¶çš„å·¥æ§æœºè·¯ç”±å™¨\n\n##### è½¯ä»¶\n\n1. ä»£ç†ï¼šopenclash\n2. åŠ é€Ÿå™¨ï¼šuuæ¸¸æˆåŠ é€Ÿå™¨\n3. VPNç»„ç½‘ï¼šzerotier/tailsacle\n\n### ç½‘ç»œæ‹“æ‰‘\n\n![[Extras/Images/Pasted image 20230416211344.png]]\n\n### è½¯ä»¶\n\n1. æ–‡ä»¶ç³»ç»Ÿï¼šext4(btrfs) + zfs\n\t1. ext4 ç¨³å®šï¼Œä¼ ç»Ÿ linux æ–‡ä»¶ç³»ç»Ÿæ ¼å¼\n\t2. zfs æ”¯æŒ raidã€snapshot\n2. ç½‘ç»œæ–‡ä»¶å…±äº«ï¼šNFS + samba\n3. ç³»ç»Ÿç®¡ç†ï¼šsmartd, nginxç­‰\n\t1. smartd ç¡¬ç›˜çŠ¶æ€æ£€æµ‹\n\t2. nginx åä»£\n\t3. acme.sh è‡ªç­¾è¯ä¹¦\n4. è™šæ‹Ÿæœºï¼šlibvirt + qemu + kvm\n\t1. ä¸€å¥—linux è™šæ‹ŸåŒ–è§£å†³æ–¹æ¡ˆ\n\t2. The libvirt project:is a toolkit to manage virtualization platforms;is accessible from C, Python, Perl, Go and more;supports KVM, QEMU, Xen, Virtuozzo, VMWare ESX, LXC, BHyve and more.\n\t\t1. Libvirtæ˜¯ä¸€ç»„å·¥å…·é›†ï¼Œæä¾›äº†è™šæ‹ŸåŒ–å¹³å°çš„ç®¡ç†ä»¥åŠä¸€å¥—ç®¡ç†è™šæ‹ŸåŒ–ç›¸å…³åŠŸèƒ½çš„API\n\t3. QEMU is a generic and open source machine emulator and virtualizer.\n\t\t1. å°±æ˜¯æ¨¡æ‹Ÿå™¨å’Œè™šæ‹Ÿæœºï¼Œå¯ä»¥åœ¨ä¸€ç§æ¶æ„ä¸‹è¿è¡Œå¦ä¸€ç§æ¶æ„çš„ç¨‹åº(å¦‚åœ¨X86ä¸Šæ¨¡æ‹ŸRISC-V),ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–è™šæ‹Ÿæœºç®¡ç†ç¨‹åº(hypervisors)æ¥è¿ç”¨å¤„ç†å™¨æ‰©å±•(HVM)è¿›è¡Œè™šæ‹ŸåŒ–ï¼Œæ¯”å¦‚ä½¿ç”¨KVMå’ŒXEN\n\t4. KVM (for Kernel-based Virtual Machine) is a full virtualization solution for Linux on x86 hardware containing virtualization extensions (Intel VT or AMD-V).\n\t\t1. KVM æ˜¯ Linux çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”ä½¿ç”¨å¸¸è§„çš„ Linux è°ƒåº¦å’Œå†…å­˜ç®¡ç†ã€‚KVM ä½¿ç”¨çš„æ˜¯å¤„ç†å™¨æ‰©å±•æ¥è™šæ‹ŸåŒ–ï¼Œä¸æ”¯æŒ XEN é‚£æ ·çš„åŠè™šæ‹ŸåŒ–\n\t5. ç”¨äººè¯æ€»ç»“ä¸€ä¸‹ï¼Œå¤§æ¦‚å°±æ˜¯KVMè´Ÿè´£æå®šCPUè¿™å—ï¼ŒQEMUæ¨¡æ‹Ÿå…¶ä»–ç¡¬ä»¶ï¼Œè¿™ä¸¤ä¸ªå°±å·²ç»å¯ä»¥ç”¨å¾—å¾ˆå¥½äº†ï¼Œç„¶ååŠ ä¸Šlibvirtæ–¹ä¾¿ç®¡ç†ã€‚\n5. ä¸‹è½½ï¼šaria2 + qbittorrent\n\t1. aria2 http ä¸‹è½½\n\t2. qbittorrent bt/pt ä¸‹è½½\n\n### å®¹å™¨\n\ndocker + k8s\n\n1. åŸºç¡€è®¾æ–½ï¼šcert-manager, ingress, metallb\n2. ç›‘æ§ï¼šnetdata, prometheus-stack, EFK\n3. åª’ä½“æœåŠ¡å™¨ï¼šplex / emby / jellyfin\n\t1. plex æ”¶è´¹ï¼Œä¸æ”¯æŒåŸç›˜æ’­æ”¾ï¼Œä¸æ”¯æŒ amd æ˜¾å¡ç¡¬ä»¶è§£ç \n\t2. emby é«˜çº§åŠŸèƒ½æ”¶è´¹ï¼Œæ”¯æŒåŸç›˜æ’­æ”¾ï¼Œæ”¯æŒ amd æ˜¾å¡ç¡¬ä»¶è§£ç \n\t3. jellyfin å…è´¹ã€å¼€æºï¼Œæ”¯æŒåŸç›˜æ’­æ”¾ï¼Œæ”¯æŒ amd æ˜¾å¡ç¡¬ä»¶è§£ç \n4. RSSï¼š Awesome TTRSS + RSSHUB\n5. ç®¡ç†é¢æ¿ï¼športainer + kubesphere\n6. æ•°æ®åº“ï¼šPostgreSQL, Redis, Elasticsearch, Mongodb, Couchdb\n7. å…¶ä»–åº”ç”¨ï¼švaultwarden/bitwarden, umamiç­‰\n\n### ç¼ºå¤±\n\n1. å›¾ç‰‡æœåŠ¡å™¨\n2. æ¼«ç”»æœåŠ¡å™¨\n\n## å…¶ä»–\n\n## æ¶æ„å›¾\n\n![[Extras/Images/Pasted image 20230416200045.png]]\n\n# YubiKey\n\nä»‹ç»ï¼š[[Cards/CS/å®‰å…¨/ç©è½¬Yubikey]]\n\né…ç½®ï¼š[[Cards/CS/å®‰å…¨/YubiKeyé…ç½®]]\n\n# Shell\n\n## Zsh\n\n- åŸºæœ¬å…¼å®¹ bash\n- è¡¥å…¨ã€æ’ä»¶ã€ä¸»é¢˜ä¸°å¯Œ\n- æ’ä»¶ç®¡ç†å™¨ï¼š[zinit](https://github.com/zdharma-continuum/zinit)\n\t- Zinit æ˜¯ä¸€ä¸ªçµæ´»å¿«é€Ÿçš„ Zshell æ’ä»¶ç®¡ç†å™¨ï¼Œå®ƒå…è®¸ä½ ä» GitHub å’Œå…¶ä»–ç«™ç‚¹å®‰è£…æ‰€æœ‰ä¸œè¥¿ã€‚\n\t- æ”¯æŒä» git/svn æˆ–æœ¬åœ°/è¿œç¨‹ URL ä¸­å®‰è£…æˆ–ä¸‹è½½æ–‡ä»¶\n\t- Turbo Modeï¼šTurbo æ¨¡å¼æ˜¯æ€§èƒ½çš„å…³é”®ã€‚å®ƒå¯ä»¥å¼‚æ­¥åŠ è½½ï¼Œè¿™åœ¨æ’ä»¶æ•°é‡å¢åŠ æ—¶ä¼šäº§ç”Ÿå·¨å¤§çš„å·®å¼‚ã€‚\n\t- é…ç½®ç¨å¾®æœ‰ç‚¹å¤æ‚\n\t- ![](https://raw.githubusercontent.com/zdharma-continuum/zinit/images/startup-times.png)\n\n ```zsh\nzinit lucid as=program pick=\"$ZPFX/bin/(fzf|fzf-tmux)\" \\ \n\tatclone=\"cp shell/completion.zsh _fzf_completion; \\\n\t\tcp bin/(fzf|fzf-tmux) $ZPFX/bin\" \\\n\tmake=\"PREFIX=$ZPFX install\" for \\\n\t\tjunegunn/fzf\n\nzinit ice as\"command\" from\"gh-r\" \\\n          atclone\"./starship init zsh \u003e init.zsh; ./starship completions zsh \u003e _starship\" \\\n          atpull\"%atclone\" src\"init.zsh\"\nzinit light starship/starship\n```\n\n- [Benchmark](https://github.com/romkatv/zsh-bench)\n\n### æ’ä»¶\n\n- alias-tips\n- git-open\n- fzf-tab\n- zsh-completions\n- zsh-syntax-highlighting\n- zsh-autosuggestions\n- zsh-history-substring-search\n- ohmyzsh\n\n## Tmux\n\n## K9S\n\n- å¸¸ç”¨æ“ä½œ\n\t- æŸ¥çœ‹å„ç§èµ„æº\n\t\t- æŸ¥çœ‹ yaml\n\t\t- æŸ¥çœ‹ describe\n\t\t- æŒ‰èµ„æºå ç”¨ç­‰è¿›è¡Œæ’åº\n\t\t- æœç´¢\n\t- æŸ¥çœ‹ pod æ—¥å¿—\n\t- scale deployment\n\t- æŸ¥çœ‹å¹¶è§£ç  secret\n\t- æŸ¥çœ‹ secret useby\n\t- ç¼–è¾‘ yaml\n\t- port-forward\n\t- è¿›å…¥ pod çš„ shell\n\t- è®¾ç½®é•œåƒ\n\t- kill / restart pod\n- create / apply è¿˜æ˜¯éœ€è¦ä½¿ç”¨å‘½ä»¤è¡Œ\n\n## Readline Shortcuts\n\n- å¾ˆå¤šç¨‹åºéƒ½ä¼šç”¨åˆ° readline libraryï¼Œæ‰€ä»¥å®ƒçš„å¿«æ·é”®éå¸¸é€šç”¨ï¼Œåœ¨å„ä¸ªåœ°æ–¹éƒ½é€‚ç”¨ã€‚ä» shell åˆ°æµè§ˆå™¨åœ°å€æ ï¼Œä» emacs åˆ° vscodeï¼Œç”šè‡³ obsidianã€‚\n- [readline shortcuts Â· GitHub](https://gist.github.com/jottr/a2351377b7584abf100b#file-readline_shortcuts-md)\n\n# Macos / Apple\n\n- [Bob](https://bobtranslate.com/)\n\t- æˆ‘ç”¨è¿‡çš„æœ€å¥½ç”¨çš„ç¿»è¯‘è½¯ä»¶\n\t- å°å·§ç²¾æ‚ï¼Œä¸èˆ¬é¡ºæ»‘\n\t- åŠŸèƒ½ä»‹ç»\n\t\t- åˆ’è¯ç¿»è¯‘\n\t\t- OCR æˆªå›¾ç¿»è¯‘\n\t\t- è¾“å…¥ç¿»è¯‘\n\t- æ”¯æŒå¤šç§ç¿»è¯‘æºï¼Œä½†éœ€è¦[è‡ªå·±æ¥å…¥](https://bobtranslate.com/guide/advance/service.html#%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%80%89%E6%8B%A9)\n- [Clash for Windows](https://docs.cfw.lbyczf.com/)\n\t- TUN æ¨¡å¼\n\t\t- å¯¹äºä¸éµå¾ªç³»ç»Ÿä»£ç†çš„è½¯ä»¶ï¼ŒTUN æ¨¡å¼å¯ä»¥æ¥ç®¡å…¶æµé‡å¹¶äº¤ç”± CFW å¤„ç†\n\t\t- ä¸€é”®å¼€å¯ï¼Œæ–¹ä¾¿å¿«æ·\n- [Bartender](https://www.macbartender.com/)\n- [One Switch](https://fireball.studio/oneswitch/)\n- [iStat Menus](https://bjango.com/mac/istatmenus/)\n- [Setapp](https://setapp.com/)\n\t- Setapp æ˜¯ä¸€ä¸ªåº”ç”¨å•†åº—è½¯ä»¶ï¼Œç±»ä¼¼äº App Storeï¼Œé‡‡ç”¨è®¢é˜…åˆ¶ï¼Œè®¢é˜…æœŸé—´å†…å¯ä»¥å…è´¹ä½¿ç”¨ Setapp å†…çš„æ‰€æœ‰è½¯ä»¶\n\t- 240+ apps\n\t- **Marginnote** 3ï¼Œé˜…è¯»ç¬”è®°\n\t- **CleanMyMac**ï¼Œæ¸…ç†ä¼˜åŒ–\n\t- Timingï¼Œæ—¶é—´ç®¡ç†\n\t- Pasteï¼Œå‰ªåˆ‡æ¿ç®¡ç†\n\t- **Bartender**ï¼ŒçŠ¶æ€æ ç®¡ç†\n\t- Downieï¼Œè§†é¢‘ä¸‹è½½\n\t- **iStat Menus**ï¼Œç³»ç»Ÿç›‘æ§å·¥å…·\n\t- **One Switch**ï¼Œæ§åˆ¶è°ƒèŠ‚\n\t- PDF Penï¼ŒPDF é˜…è¯»ç¼–è¾‘å™¨\n\t- Xmindï¼Œè„‘å›¾å·¥å…·\n\t- CleanShotï¼Œæˆªå›¾å½•å±æ³¨å›¾\n\t- **TablePlus**ï¼Œæ•°æ®åº“ç®¡ç†å·¥å…·\n\t- PopClip\n\t- Luminar Neo\n\t- BetterTouchToolï¼Œè§¦æ§æ¿å¢å¼ºå·¥å…·\n- [Apple One](https://www.apple.com/apple-one/)\n\t- The bestÂ of Apple. All in one.\n\t- Apple One ä»¥æ›´ä½çš„æœˆç§Ÿä»·æ ¼æ†ç»‘å¤šè¾¾ 6 é¡¹ Apple è®¢é˜…ï¼ŒåŒ…æ‹¬é«˜è¾¾ 2TB çš„ iCloud+ å­˜å‚¨ç©ºé—´ã€‚\n\t\t- iCloud+ æœ€é«˜ 2T ç©ºé—´\n\t\t- Apple TV+\n\t\t- Apple Music\n\t\t- Apple Arcade\n\t\t- Apple Fitness+\n\t\t- Apple News+\n\t- æ”¯æŒÂ Family planã€‚\n\t- æœ€å¥½ç”¨ç¾åŒºè´¦å·\n\n# ç¼–è¾‘å™¨\n\n## IDE ä¸ç¼–è¾‘å™¨\n\n- IDE\n\t- é›†æˆå¼€å‘ç¯å¢ƒï¼Œä¸€èˆ¬åŒ…æ‹¬ä»£ç ç¼–è¾‘å™¨ã€ç¼–è¯‘å™¨ã€è°ƒè¯•å™¨å’Œå›¾å½¢ç”¨æˆ·ç•Œé¢å·¥å…·ã€‚é›†æˆäº†ä»£ç ç¼–å†™åŠŸèƒ½ã€åˆ†æåŠŸèƒ½ã€ç¼–è¯‘åŠŸèƒ½ã€è°ƒè¯•åŠŸèƒ½ç­‰ä¸€ä½“åŒ–çš„å¼€å‘è½¯ä»¶æœåŠ¡å¥—ã€‚\n\t- æ¯ç§ç¼–ç¨‹è¯­è¨€éƒ½æœ‰ä¸€äº›ç‰¹å®šçš„ IDEã€‚\n- ç¼–è¾‘å™¨\n\t- åŠŸèƒ½æ›´åŠ çº¯ç²¹ã€‚ç¼–è¾‘ä»£ç çš„å·¥å…·â€”â€”ä»£ç ç¼–è¾‘å™¨ã€‚\n\t- ä»£ç ç¼–è¾‘å™¨ä¸å…¸å‹çš„ IDE ä¸åŒï¼Œå¯ä»¥æŠŠå®ƒç”¨äºè‡ªå·±å–œæ¬¢çš„ä»»ä½•ä¸€ç§ç¼–ç è¯­è¨€æˆ–æ¡†æ¶ã€‚\n\t- æ›´åŠ çµæ´»ï¼Œå¯æ‹“å±•æ€§æ›´å¼ºã€‚\n\t- [Language Server Protocol](https://microsoft.github.io/language-server-protocol/)\n\n\n## VSCode\n\nä¸–ç•Œä¸Šæœ€å—å¼€å‘è€…æ¬¢è¿çš„ç¼–è¾‘å™¨ã€‚\n\n### ä¼˜ç‚¹\n\n- å…è´¹ã€å¼€æº\n- è½»é‡çº§\n- åŠŸèƒ½å¼ºå¤§\n\t- æ‰©å±•/æ’ä»¶ä¸°å¯Œ\n- è·¨å¹³å°\n\n### æ‰©å±•\n\n- è¿œç¨‹å¼€å‘\n\t- Remote SSH\n\t- Remote Exploer\n\t- Remote Tunnels\n\t- WSL\n\t- Dev Container\n- Git\n\t- GitLab Workflow\n\t- GitHub Actions\n- vim\n\t- VSpaceCode: Spacemacs like keybindings\n\t- Which Key: which-key like menu\n- å®¹å™¨\n\t- Docker\n\t- K8S\n- æ•°æ®åº“\n\t- MySQL\n\t- Redis\n\t- MongoDB\n- å…¶ä»–\n\t- Inline Bookmarks\n\t- Back \u0026 Forth\n- ç”šè‡³\n\t- QQ\n\n## Vim\n\n- å¶å°”åœ¨ç»ˆç«¯ä½¿ç”¨ vim\n- é«˜æ•ˆ\n- åœ¨å…¶ä»–è½¯ä»¶ä¸­ä¹Ÿæ”¯æŒ vim mode\n\n### Vim Everywhere\n\n- VSCode\n- Chrome\n- Obsidian\n- Shell\n\n# ç¬”è®°è½¯ä»¶\n\n[[Cards/ç¬”è®°è½¯ä»¶å¯¹æ¯”|ç¬”è®°è½¯ä»¶å¯¹æ¯”]]\n\n# Swagger / OpenAPI\n\n![[Extras/Images/CleanShot 2023-05-18 at 10.11.42@2x.png]]\n\n- ä»‹ç»\n\t- è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£ï¼ŒåŸºæœ¬ä¸Šèƒ½åšåˆ°æ ¹æ®ä»£ç å®æ—¶æ›´æ–°\n\t- gin å¯¹ swagger å’Œ validator çš„æ”¯æŒéå¸¸å¥½\n\t- [swaggoæ–‡æ¡£](https://github.com/swaggo/swag/blob/master/README_zh-CN.md)\n\t- é›†æˆäº† Swageer UI\n- ä½¿ç”¨æ–¹æ³•\n\t- API æ·»åŠ æ³¨é‡Š\n\t- ç”Ÿæˆæ–‡æ¡£ `make swag`\n\t- æ–‡æ¡£ä½ç½® `pkg/microservice/aslan/server/rest/doc`\n\t- åœ¨çº¿åœ°å€ https://zadig-ee-dev1.8slan.com/api/aslan/apidocs/index.html\n\n# Apifox\n\n- ä»‹ç»\n\t- åªè¦å®šä¹‰å¥½ API æ–‡æ¡£ï¼ŒAPI è°ƒè¯•ã€API Mockã€API è‡ªåŠ¨åŒ–æµ‹è¯•å³å¯ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å†æ¬¡å®šä¹‰ã€‚\n\t- API æ–‡æ¡£å’Œ API å¼€å‘è°ƒè¯•ä½¿ç”¨åŒä¸€ä¸ªå·¥å…·ï¼ŒAPI è°ƒè¯•å®Œæˆåå³å¯ä¿è¯å’Œ API æ–‡æ¡£å®šä¹‰å®Œå…¨ä¸€è‡´ã€‚é«˜æ•ˆã€åŠæ—¶ã€å‡†ç¡®ï¼\n- ä¼˜ç‚¹\n\t- å¯¼å…¥æ–¹ä¾¿ï¼Œpostman å¯¼å…¥ä¼šå¦å¤–åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ï¼Œè€Œä¸æ˜¯å’Œå·²æœ‰çš„åˆå¹¶\n\t- ä¸€é”®åˆ†äº«\n\t- æ”¯æŒä¿å­˜ç”¨ä¾‹\n\t- æ”¯æŒmock\n- ä½¿ç”¨æµç¨‹\n\t- ä»£ç ä¸­æ·»åŠ æ³¨é‡Š\n\t- ç”Ÿæˆ swagger æ–‡æ¡£\n\t- å°† swagger æ–‡æ¡£å¯¼å…¥ Apifox\n\t- ä½¿ç”¨ Apifox è¿›è¡Œæµ‹è¯•\n\t- å°†æ–‡æ¡£åˆ†äº«\n\n# RSS\n\n\u003e æˆ‘ä»¬æ¯å¤©éƒ½åœ¨æ¥æ”¶èµ„è®¯ã€‚æ— è®ºæ˜¯ç¤¾äº¤ç½‘ç»œä¸­å¥½å‹åˆ†äº«çš„æ–°é²œäº‹ï¼Œè¿˜æ˜¯åƒä»Šæ—¥å¤´æ¡ç­‰èšåˆé˜…è¯»å·¥å…·é‡Œçš„æ–‡ç« ï¼Œä¾é æ¨èç®—æ³•ï¼Œå®ƒä»¬æ€»èƒ½å¸¦æ¥ã€Œä½ å¯èƒ½æ„Ÿå…´è¶£çš„å†…å®¹ã€ã€‚è¿™äº›æˆ–æœ‰ç”¨ã€æˆ–æ— ç”¨çš„èµ„è®¯ä¸ä»…æ¶ˆè€—äº†æˆ‘ä»¬å¤§é‡çš„æ—¶é—´ï¼Œæ— ç©·å°½çš„ã€Œæ—¶é—´æµã€ä¹Ÿåœ¨è®©æˆ‘ä»¬è¶…è´Ÿè·åœ°æ¥å—ä¿¡æ¯ï¼Œè¿˜ä¼šåœ¨æ— å½¢ä¹‹ä¸­è®©æˆ‘ä»¬æ¥è§¦çš„èµ„è®¯ç±»å‹è¶Šæ¥è¶Šã€Œçª„ã€ã€‚\n\u003e ä¸ºäº†è§£å†³ä¿¡æ¯è¿‡è½½çš„é—®é¢˜ï¼Œè®©æˆ‘ä»¬å¯¹äºæ¥æ”¶çš„ä¿¡æ¯æŒæ¡ä¸»åŠ¨æƒï¼ŒRSSÂ é‡æ–°è¿›å…¥äº†æˆ‘ä»¬çš„è§†é‡ï¼šæˆ‘ä»¬å¯ä»¥è‡ªç”±é€‰æ‹©è®¢é˜…çš„ä¿¡æ¯æºï¼Œä¸ç”¨å†å—ç®—æ³•çš„ã€Œæ§åˆ¶ã€ï¼Œä¹Ÿå¯ä»¥åŠæ—¶åœ°å¯¹ä¿¡æ¯æºè¿›è¡Œè°ƒæ•´ä»¥é¿å…ä¿¡æ¯è¿‡è½½ã€‚\n\n- é«˜æ•ˆè·å–ä¿¡æ¯\n- RSSÂ çš„å…¨ç§°æ˜¯Â ReallyÂ SimpleÂ Syndicationï¼ˆç®€æ˜“ä¿¡æ¯èšåˆï¼‰\n- RSSÂ å°±æ˜¯ä¸€ç§è®¢é˜…æŸä¸ªç½‘ç«™å†…å®¹æ›´æ–°çš„åè®®\n- [é«˜æ•ˆè·å–ä¿¡æ¯ï¼Œä½ éœ€è¦è¿™ä»½ RSS å…¥é—¨æŒ‡å— - å°‘æ•°æ´¾](https://sspai.com/post/56391)\n- [[Cards/CS/RSS/æ­å»ºè‡ªå·±çš„RSSæœåŠ¡|æ­å»ºè‡ªå·±çš„RSSæœåŠ¡]]\n- [[Cards/CS/RSS/åŸºäºRSSçš„æ¨é€ç³»ç»Ÿ|åŸºäºRSSçš„æ¨é€ç³»ç»Ÿ]]\n\n# Telegram\n\n- ä¼˜ç‚¹\n\t- è‡ªç”±ï¼Œæ²¡æœ‰å®¡æŸ¥\n\t- å®¢æˆ·ç«¯å¼€æº\n\t- æ€§èƒ½å¥½\n\t- åŠŸèƒ½å¼ºå¤§\n\t\t- æ¯”å¾®ä¿¡å¼ºå¤ªå¤š\n\t- è¶…å¤§ç¾¤èŠ\n\t\t- å°é¡¶ 20 ä¸‡äºº\n\t\t- åˆç§Ÿé¢‘é“\n\t\t- æŠ€æœ¯ç¾¤ç»„\n\t- æ”¯æŒç«¯å¯¹ç«¯åŠ å¯†\n\t- å¤šç«¯åŒæ­¥\n\t\t- åªæœ‰ä¸€ä¸ªç»ˆç«¯ä¼šæ¨é€æ¶ˆæ¯\n- ç¼ºç‚¹\n\t- éœ€è¦ç§‘å­¦ä¸Šç½‘\n\t- æœç´¢èƒ½åŠ›å¾ˆå¼±\n\t- SPAM å’Œç°äº§å¾ˆå¤š\n\t\t- æœ‹å‹ä¹°å¸è¢«éª—äº† 1W å…ƒ\n- æ•™ç¨‹\n\t- [Telegramï¼ˆç”µæŠ¥ï¼‰ï¼šæ–°æ‰‹æŒ‡å—ã€ä½¿ç”¨æ•™ç¨‹åŠé¢‘é“æ¨è | åº­è¯´](https://tingtalk.me/telegram/)\n","lastmodified":"2023-05-18T16:10:29.940349526Z","tags":[]},"/Cards/%E7%AC%94%E8%AE%B0%E8%BD%AF%E4%BB%B6%E5%AF%B9%E6%AF%94":{"title":"ç¬”è®°è½¯ä»¶å¯¹æ¯”","content":"\n# åŒå‘è¿æ¥\n\n[B ç«™æœ€å¼º Notion æµ‹è¯„ï¼Œæè‡´ä¸æ»‘ï¼æ–°æ‰‹è¿›é˜¶å¿…çœ‹ 16 ä¸ªæ•™ç¨‹ç”¨æ³•ä¸¨ç¬”è®°è½¯ä»¶æ¨è\\_å“”å“©å“”å“©\\_bilibili](https://www.bilibili.com/video/BV1Df4y1o7ZH?t=845.0)\n\n# Notion\n\n[B ç«™æœ€å¼º Notion æµ‹è¯„ï¼Œæè‡´ä¸æ»‘ï¼æ–°æ‰‹è¿›é˜¶å¿…çœ‹ 16 ä¸ªæ•™ç¨‹ç”¨æ³•ä¸¨ç¬”è®°è½¯ä»¶æ¨è]( https://www.bilibili.com/video/BV1Df4y1o7ZH?vd_source=95893bf3c956973d41f5d92572ef8a93 )\n\n## ä¼˜ç‚¹\n\n1. æ•°æ®åº“ã€è§†å›¾åŠŸèƒ½å¼ºå¤§ã€‚\n2. æ’ç‰ˆç¾è§‚ï¼Œ\n3. ä½¿ç”¨ä¾¿æ·ã€‚\n\n## ç¼ºç‚¹\n\n1. æ ¼å¼ä¸é€šç”¨ï¼Œè™½ç„¶èƒ½å¯¼å‡ºmarkdownï¼Œä½†ä¼šæŸå¤±ä¸å°‘ä¿¡æ¯ã€‚\n2. åŒé“¾è¾ƒå¼±\n3. æ²¡æœ‰å¤§çº²ã€‚\n4. æœ‰æ—¶ä¼šå¡ã€æ…¢ã€‚\n5. ä¸æ”¯æŒåµŒå…¥Bç«™è§†é¢‘\n6. æ”¯æŒçš„æ ‡é¢˜å±‚çº§å¤ªå°‘\n\n## é€‚åˆ\n\n1. notioné€‚åˆç³»ç»Ÿçš„ã€çº¿æ€§çš„ã€æœ‰é€»è¾‘é¡ºåºçš„åˆ›ä½œï¼Œä¾‹å¦‚æ—¥è®°ã€å·¥ä½œæ–‡æ¡£ã€å­¦ä¹ ç¬”è®°ã€æ­å»ºçŸ¥è¯†ç³»ç»Ÿã€‚\n\n\t![[Extras/Images/Pasted image 20230518174553.png]]\n\n\n\n\tnotionä¹Ÿé€‚åˆç”¨æ¥ç»„ç»‡ã€æ•´ç†å’Œåˆ†äº«æ”¶é›†å’Œåˆ›å»ºçš„ç´ æå’Œå›¾æ–‡ä½œå“ã€‚ä½†notionä¸é€‚åˆç¢ç‰‡åŒ–çš„è®°å½•æ–¹å¼ã€‚\n\n# Obisidian\n\nå…ˆè®°ä¸‹æ¥ï¼Œæ’ä»¶ã€æ–¹æ³•è®ºå¯ä»¥åé¢å†é…ç½®ã€æ•´ç†ã€‚\n\nå‘å¸ƒ\n\nä¸‹æ¬¡è¯¦ç»†ä»‹ç»ã€‚\n\n[ä¹Ÿè®¸æ˜¯ B ç«™æœ€å¥½çš„ Obsidian æ–°æ‰‹æ•™ç¨‹ï¼çˆ†è‚30å¤©ï¼Œä¸€ç«™å¼å…¥é—¨åŒå‘é“¾æ¥ç¬”è®°è½¯ä»¶](https://www.bilibili.com/video/BV18a411r7mt?vd_source=95893bf3c956973d41f5d92572ef8a93)\n\n## ä¼˜ç‚¹\n\n1. åŒé“¾æ±‡æ€»å…³é”®ä¿¡æ¯ã€‚\n2. ä¼ ç»Ÿçš„æ–‡ä»¶å¤¹ç»“æ„\n3. æ’ä»¶å¤š\n\n## ç¼ºç‚¹\n\n1. åŸºæœ¬åªæ”¯æŒçº¯markdownï¼ŒåŸç”Ÿä¸æ”¯æŒåˆ†æ ï¼Œæ’ä»¶å®ç°åˆ†æ å¤ªéº»çƒ¦ã€‚æ’ä¾¿ä¸æ–¹ä¾¿ã€ä¸ç¾è§‚ã€‚åŒé“¾é¢„è§ˆçª—å£ä¸å¦‚æ€æºå¤§ã€‚ä¸æ”¯æŒæ•°æ®åº“-è§†å›¾ï¼Ÿ\n2. æ— æ³•åµŒå…¥æ’­æ”¾è§†é¢‘ï¼Œåªèƒ½åœ¨é˜…è¯»æ¨¡å¼ä¸­æ‰“å¼€ï¼Œå¹¶ä¸”æ’ä»¶è¿˜æœ‰bugï¼Œåˆ‡æ¢é˜…è¯»å’Œç¼–è¾‘æ¨¡å¼ä¼šä¸æ–­å¼¹å‡ºæ–°çª—å£\n3. PDFè¯»ä¹¦ç¬”è®°å‡ ä¹æ— æ³•ä½¿ç”¨ï¼ŒmarkMindä¸annotatorå‡ä¼šåœ¨ç¼–è¾‘æ¨¡å¼ä¸‹æ˜¾ç¤ºä¸€å¨ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿ï¼Œå¹¶ä¸”annotatoræ‰“å¼€å¤§PDFæ—¶éå¸¸å¡ï¼Œå¹¶ä¸”ä¸æ–¹ä¾¿å®ç°è·³è½¬ã€‚\n4. è§†é¢‘ç¬”è®°åŠŸèƒ½çš„æ’ä»¶æœ‰ä¸€äº›bugã€‚\n\n## ç”¨æ³•\n\n1. æ¯å¤©æ—¥è®°ä¸­çš„å¾…åŠäº‹é¡¹é›†ä¸­ç®¡ç†ã€‚\n2. è¯»ä¹¦ç¬”è®°ï¼Œæ·±åº¦é˜…è¯»ï¼ŒPDFæ‰¹æ³¨ï¼Œä¸²è”ç¬”è®°ã€ç”¨åŒé“¾æ‹“å±•è¯»ä¹¦ç¬”è®°\n3. é˜…è¯»æ¸…å•æ•´ç†ã€‚\n4. è§†é¢‘ç¬”è®°ï¼Œæ”¯æŒyoutubeã€bilibliï¼Œæ”¯æŒè·³è½¬æ—¶é—´æˆ³\n5. è®°å½•æ—¥æŠ¥å‘¨æŠ¥\n6. ç¼–å¹´å²è®°\n\n![[Extras/Images/Pasted image 20230518174701.png]]\n\n## æ’ä»¶\n\n1. dataviewï¼šä¸notionçš„æ•°æ®åº“-è§†å›¾åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ„Ÿè§‰è¿˜æ˜¯æ¯”ä¸è¿‡ï¼Œä½†èƒœåœ¨ç±»SQLè¯­å¥çµæ´»ã€‚\n2. QucikAddã€Templaterï¼šæ¨¡ç‰ˆã€å¿«é€Ÿæ·»åŠ \n3. Chartsï¼šç”Ÿæˆå„ç§å›¾è¡¨\n\n![[Extras/Images/Pasted image 20230518174905.png]]\n\n# æ€æº\n\n## ä¼˜ç‚¹\n\n1. æ¯”obsidianæ“ä½œæ–¹ä¾¿ï¼Œæ”¯æŒæ‹–æ‹½ä¸ `/`ã€‚\n2. å¼€æº\n\n## ç¼ºç‚¹\n\n1. ä¸å¥½çœ‹ã€‚\n2. ä¸æˆç†Ÿã€‚\n3. ç¬¬ä¸‰æ–¹æ’ä»¶å°‘ã€‚\n\n# Logseq\n\n[çˆ†è‚100å°æ—¶ï¼Œå…¨ç½‘æœ€æ˜“æ‡‚çš„ Logseq æŒ‡å—ï¼åŒå‘é“¾æ¥ç¬”è®°è½¯ä»¶ç§‘æ™®](https://www.bilibili.com/video/BV1DU4y1g7Bf?vd_source=95893bf3c956973d41f5d92572ef8a93)\n\nblock ä¸ºæœ€å°å•ä½ã€‚\n\n## ä¼˜ç‚¹\n\n1. è¶…çº§æ—¥è®°æœ¬ï¼šæ”¯æŒåµŒå…¥ä»£ç ã€è¡¨æ ¼ã€è§†é¢‘ã€ç”»æ¿\n2. å¯ä»¥åµŒå…¥è§†é¢‘åšè§†é¢‘ç¬”è®°ï¼Œyoutubeã€bilbiliæ”¯æŒæ—¶é—´æˆ³è·³è½¬ï¼Œæ„Ÿè§‰æ¯”obsidianåšçš„å¥½ï¼ŒåµŒå…¥çš„bilbiliè§†é¢‘å‘¢ä¸æ”¯æŒ1080\n3. PDFè¯»ä¹¦ç¬”è®°åšçš„æ¯”obsidianå¥½\n4. æœ‰æ’ä»¶ç³»ç»Ÿ\n\t1. æ”¯æŒflomoçš„çƒ­åŠ›å›¾\n\t2. æ”¯æŒå°†å¤§çº²è½¬æ¢æˆæ€ç»´å¯¼å›¾ï¼Œå¯ä»¥æ”¾å¼ƒå¹•å¸ƒ\n5. å¼€æº\n6. æœ‰æ½œåŠ›\n\n## ç¼ºç‚¹\n\n1. æ’ä»¶å¤ªå°‘\n2. å¼ºåˆ¶å¤§çº²æ¨¡å¼ï¼Œæ‰€æœ‰è¡Œå¼€å¤´éƒ½æœ‰ `-`\n3. é•¿æ–‡ä½“éªŒä¸å¥½\n4. æ²¡æœ‰æ–‡ä»¶å¤¹ç»“æ„\n5. å¡\n6. å¤šå¹³å°åŒæ­¥æ²¡æœ‰å…è´¹æ–¹æ¡ˆ\n7. åŸç”Ÿä¸æ”¯æŒåœ¨ä¾§è¾¹æ æ˜¾ç¤ºå¤§çº²ï¼ˆè·Ÿ notion ä¸€æ ·ï¼‰\n\n## ç”¨æ³•\n\n1. æ—¥å¿—\n2. ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ\n3. å·¥ä½œæ—¥æŠ¥å‘¨æŠ¥\n4. è¯»ä¹¦ç¬”è®°ï¼Œæ¯”obsidianåšçš„å¥½\n\n## ç‰¹ç‚¹\n\n1. ç§¯å°‘æˆå¤šï¼Œé›¶æ•£çš„å°†å†…å®¹è®°å½•åœ¨æ¯å¤©æ—¥è®°ä¸­ï¼Œå†é€šè¿‡åŒé“¾å°†æ¯å¤©æ—¥è®°ä¸­å€¼å¾—å…³æ³¨ç‚¹æ±‡æ€»\n\n# Flomo\n\n- è®°å½•çµæ„Ÿã€‚\n- è”ç½‘ã€æ…¢ã€å å†…å­˜\n\n# ä¸ªäººéœ€æ±‚\n\nè¯»ä¹¦ç¬”è®°ã€è§†é¢‘ç¬”è®°ï¼Œè‡ªå·±æ•´ç†çš„ç¬”è®°ï¼Œæ•°æ®åº“åŠè§†å›¾ï¼ŒåŒé“¾ä¹Ÿä¸é”™\n\næ˜¯å¦çœŸæœ‰å¿…è¦åœ¨PCä¸ŠåšPDFæ ‡æ³¨ï¼Ÿå¯èƒ½ä¼šä½¿ç”¨ipadåšè¯¥å·¥ä½œã€‚\n\n# å…¶ä»–\n\n![[Extras/Images/Pasted image 20230518175021.png]]\n\n![[Extras/Images/Pasted image 20230518175039.png]]\n\n# å‚è€ƒèµ„æ–™\n\n1. [Obsidian å’Œ Logseq å¯¹æ¯”]( https://www.skyue.com/22040623.html )\n2. [åŸºäº Logseq é‡æ„ä¸ªäººçŸ¥è¯†ç®¡ç†ä½“ç³» - gq's blog](https://zgq.ink/posts/knowledge-base-refactoring)\n","lastmodified":"2023-05-18T16:10:29.940349526Z","tags":[]},"/Cards/+-About-Cards":{"title":"About Cards","content":"\nup:: [[Meta PKM]]\n\nThe cards folder is one of my favorite places because it has _umami_. Apparently umami is one of the five basic tastes. There are: Sweetness, Sourness, Saltiness, Bitternessâ€”and that oddball Umami.\n\nUmami is hard to describe but you know when it's there. The same is true of this folder's contents. It's a mixture of insights and ideas, concepts and connections, all mingling together to create that mysterious full mouthfeel that magnificently completes any meal for the mind.\n\nSo, what are \"cards\"? Anything that is a bit of knowledge that you might call a \"thing\" or a \"statement about things\".\n\nYes, the definition is not rigid, but it works.\n\nOver time, you may have a few subfolders here too. I have a \"People\" subfolder. If I was an amateur chef with a growing number of recipe notes, I'd put a \"Recipes\" folder here. If I was making building a personal library of important exercises, I'd likely make an \"Exercises\" folder.\n\n[[Information that crosses our attentional filter becomes knowledge]].\n\n---\n\n# Here is a Fun view of This Cards Folder\n\n\u003e [!HINT]+ This data view ğŸ”¬ only renders in the free downloadable version.\n\u003e If you are viewing this note on Obsidian Publish, you won't be able to see the magic below unless you [download the kit](https://www.linkingyourthinking.com/download-lyt-kit).\n\u003e Note: If you can see the list below, you have already downloaded the LYT Kit.\n\n``` dataview\nLIST  \n\nFROM \"Cards\" and -#x/index and -#x/readme\n\nSORT file.name ASC\n```\n\n---\n\n# CARDS\n\n## Lt Helps You ..\n\nBuild and connect your ideas\n\n## What Goes In?\n\nldeas, insights, and othess things\n\n## What Are Some Examples?\n\n- ldeas\n- Things\n- People\n- Concepts\n- Statements\n\n---\n\n# knowledge-garden\n\nè™½ç„¶å«[[æ°¸ä¹…ç¬”è®°]] permanent noteï¼Œä½†ä¸ªäººç†è§£å…¶å®æ›´è´´åˆ‡çš„ç¿»è¯‘æ˜¯å¸¸é’ç¬”è®° evergreen noteã€‚ä¸€æ¥ï¼Œæ ¹æ®å½¢å¼ï¼Œå’Œ[[é—ªå¿µç¬”è®°]]ä¸[[æ–‡çŒ®ç¬”è®°]]åŒºåˆ†å¼€ã€‚äºŒæ¥ï¼Œæ ¹æ®ç›®çš„ï¼Œå®ƒæ˜¯æ°¸æ’ä¸”å‘å±•çš„ï¼Œèƒ½ä¸ºå°†æ¥æ‰€ç”¨çš„æ°¸ä¹…ç¬”è®°ã€‚\n\næš‚æ—¶å…ˆæŠŠæ—¥å¸¸ç‰‡æ®µå¼çš„æ€è€ƒå’Œé—ªå¿µï¼Œä»¥çŸ­å°çš„[[å¡ç‰‡ç¬”è®°]]çš„æ–¹å¼ï¼Œç›´æ¥ä¸¢åˆ°è¿™é‡Œï¼Œä¸å¼ºè°ƒæ–‡ä»¶å¤¹åˆ†ç±»ï¼Œè€Œæ˜¯å°è¯•é€šè¿‡ç‰¹æ®Šæ–‡ä»¶åã€æ ‡ç­¾å’Œé“¾æ¥ç­‰æ–¹å¼ï¼Œè®©è¿™äº›ç¬”è®°å…·å¤‡å¯å‘ç°æ€§ï¼Œæ›´å®¹æ˜“è¢«å°†æ¥çš„è‡ªå·±æ‰¾åˆ°ã€‚\n\næ€»è€Œè¨€ä¹‹ï¼Œå°±æ˜¯æ‚¬è€Œæœªå®šçš„ä½†å·²ç»æœ‰æ‰€æ€è€ƒçš„é›¶æ•£ç¬”è®°ï¼Œå°±ä¸¢è¿™é‡Œé¢ï¼ŒæœŸå¾…å°†æ¥é€æ­¥è¢«å‘ç°ï¼Œè¢«ç»“æ„åŒ–ï¼Œè¢«æ•´ç†ã€‚\n\nè¿™é‡Œçš„[[MOC]]æ˜¯äº‹åæ€»ç»“å½’çº³ï¼Œä¸å¼ºè°ƒå®Œå¤‡æ€§ã€‚\n\nä¸€äº›ä¸´æ—¶çš„ï¼Œpendingçš„åˆä¸èˆå¾—åˆ é™¤çš„ç¬”è®°å…ˆæ”¾åˆ°Pendingæ–‡ä»¶å¤¹é‡Œï¼Œç­‰ä»¥åå†å¤„ç†ã€‚\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["on/readme"]},"/Cards/ACCESS-%E7%9F%A5%E8%AF%86%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F":{"title":"ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ","content":"\nA.C.C.E.S.S Knowledge Management Systems\n\n[Folders or Links? The ACCESS Approach - YouTube](https://www.youtube.com/watch?v=p0zWJ-TLghw)\n\nå‡ºè‡ª [[Cards/LYT ç¬”è®°æ¡†æ¶]]ï¼Œæ ¹æ®è‡ªèº«æƒ…å†µï¼Œåšäº†å°å°çš„æ”¹å˜ã€‚æˆ‘çš„ç†è§£å’Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š\n\n# ç†è§£\n\n[[ğŸ§‘Nick Milo]] ä¸ºäº†è§£å†³ [[PKMç³»ç»Ÿçš„ä¸åŒä¾§é‡ç‚¹-å››è±¡é™å›¾ by lyt]] ä¸­æåˆ°çš„ 3 å¯¹çŸ›ç›¾ï¼Œæå‡ºäº† ACCESS æ–‡ä»¶å¤¹ç»“æ„ã€‚\n\nACCESS åŸºäºä¼ ç»Ÿ [[æ–‡ä»¶å¤¹å’Œæ ‡ç­¾]]å¼çš„ [[âˆ‘ PKM]] ç³»ç»Ÿï¼Œä½†æ›´å¼•å…¥äº† [[MOC]] æ¥åŠ¨æ€åœ°é“¾æ¥æ•£è½æˆ–åˆ†å¸ƒåœ¨å„ä¸ªæ–‡ä»¶å¤¹ä¸­çš„ç¬”è®°ï¼Œè¿™ç§åŠ¨æ€èšåˆèƒ½åŠ›ï¼ˆå¸¸å€Ÿç”¨ [[Dataview]] å®ç°ï¼‰ï¼Œä¹Ÿè¿œé«˜äºæ ‡ç­¾çš„ç®€å•èšåˆèƒ½åŠ›ã€‚å› æ­¤ç»“åˆ[[æ–‡ä»¶å¤¹å’Œæ ‡ç­¾]]åŠ [[MOC]]ï¼Œæœ€ç»ˆè¾¾åˆ°ç»“æ„æ€§å’Œçµæ´»æ€§çš„å¹³è¡¡ã€‚\n\nä½¿ç”¨è¿™ä¸ªæ–¹æ³•ä¸å¯ç¼ºå°‘çš„èƒ½åŠ›ä¹‹ä¸€ï¼Œå°±æ˜¯æŒæ¡ [[Dataview]]ã€‚\n\n[[2022-07-01]] æ–°å¢ï¼šè€ƒè™‘å°† [[Text expand]] ä½œä¸º MOC çš„ä¸€éƒ¨åˆ†ã€‚å‚è§ï¼š[Obsidian ç¬”è®°é‡ç»„ä¸æ‹†åˆ†çš„è‰ºæœ¯ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/362762027)\n\n[[2022-07-27]] æ–°æ„Ÿæ‚Ÿï¼Œ[[æ··åˆç¬”è®°æ³•]]ï¼Œæ‰æ˜¯èƒ½é€‚åº” ACCESS å¤šç§åœºæ™¯çš„æœ€ç»ˆå‡ºè·¯ã€‚\n\n# ä½¿ç”¨æ–¹æ³•\n\n- Inboxï¼ŒåŸå Encounters\n\t- Cooling Padï¼Œå¾…è€ƒå¯Ÿçš„ç¬”è®°ã€‚æœ‰äº›ç¬”è®°è¿‡ä¸€æ®µæ—¶é—´å¯èƒ½ä¼šå‘ç°æ²¡å•¥ç”¨ï¼Œé‚£å°±å¯ä»¥å‹‡æ•¢åˆ é™¤ã€‚\n\t- Unsortedï¼Œå¾…åˆ†ç±»çš„ç¬”è®°ã€‚\n\t- ç›®å‰å¯¹ä¸ªäººæ„Ÿè§‰æ²¡ç”¨ï¼Œæˆ‘å°†è¿™ç±»ç¬”è®°éƒ½å…ˆæ”¾åœ¨æ¯æ—¥æ—¥å¿—é‡Œé¢ï¼Œå®šæœŸæ•´ç†çš„æ—¶å€™ï¼Œå‘ç°æ²¡ç”¨ç›´æ¥åˆ äº†å°±è¡Œã€‚\n\t- [[2022-07-04]]ï¼šå†³å®šåˆ é™¤è¿™ä¸ªæ–‡ä»¶å¤¹ç›®å½•ï¼Œå¯¹æˆ‘è€Œè¨€ç¡®å®åœ¨ daily ä¸­å°±èƒ½å®ç°ã€‚å¦‚æœé‡‡ç”¨è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œåˆ™å…¶å®è¦å°†è®¾ç½®é‡Œæ”¹æˆï¼Œæ–°æ–‡ä»¶éƒ½é»˜è®¤åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­åˆ›å»ºã€‚\n- Atlas\n\t- ç¿»è¯‘ï¼šä¸»è¦èµ·åˆ°å¸®åŠ©æˆ‘ä»¬æœé›†ã€å‘å±•å’Œå¯¼èˆªè‡ªå·±çš„æƒ³æ³•äºä¸åŒçš„ç¬”è®°ä¸­çš„ä½œç”¨ã€‚è®©æˆ‘ä»¬èƒ½é¸Ÿç°æ•´ä¸ªç¬”è®°åº“å…¨å±€ã€‚\n\t- Logsï¼Œæ”¾é‡è¦è®°å½•å’Œç»Ÿè®¡ï¼Œæ¯”å¦‚å†å²çš„ç¬”è®°åº“æ•°æ®ï¼Œå†å²çš„å‘æ–‡ç« æ•°é‡ç­‰ã€‚\n\t- MOCsï¼Œä¸»è¦å­˜æ”¾ MOC æ–‡ä»¶ï¼Œæ˜¯æ•´ä¸ªç¬”è®°åº“çš„ç´¢å¼•ç¬”è®°ã€‚æ—¢æœ‰æ‰‹åŠ¨æ•´ç†å½’çº³çš„ï¼Œä¹Ÿæœ‰ dataview è‡ªåŠ¨ç»Ÿè®¡èšåˆçš„ã€‚\n\t- Scopesï¼Œä¸»è¦å­˜æ”¾ç¬”è®°åº“çš„ Sources æ–‡ä»¶å¤¹ä¸­çš„ç”¨ [[Dataview]] ç»Ÿè®¡çš„æ•°æ®ï¼Œéå¸¸å…·ä½“åŒ–ã€‚\n\t- TOCsï¼Œæ–‡ä»¶å¤¹ï¼Œè‡ªåˆ›ã€‚ä¸»è¦å­˜æ”¾ä¼ ç»Ÿç›®å½•å‹æ–‡ä»¶ï¼Œæ¯”å¦‚åšäº†æŸä¸ª PPT çš„æçº²ï¼Œå†™äº†æŸç¯‡é•¿æ–‡çš„ç›®å½•ç­‰ã€‚\n- Calendar\n\t- ç¿»è¯‘ï¼šä¸»è¦èµ·åˆ°æ—¥å¿—ã€è·Ÿè¸ªã€[[è®¡åˆ’ä¸å›é¡¾]]ç­‰ä½œç”¨ã€‚è®©æˆ‘ä»¬èƒ½æœ‰ä¸ªåŸºäºæ—¶é—´çº¿çš„è®°å½•æµå’Œå›é¡¾æµã€‚[[dailynote]]ã€‚\n\t- æˆ‘ç†è§£ä¸º[[é—ªå¿µç¬”è®°]]ã€‚[[+ Encounters/Daily noteså·¥ä½œæµ]]å¼€å§‹å†™ç¬”è®°ã€‚åœ¨åé¢æ•´åˆæ–‡ä»¶è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¸èƒ½ä¸¢å¤±åˆ›å»ºè®°å½•ï¼Œç¬”è®°å‘ç”Ÿçš„æ—¶åˆ»ï¼Œè¿™ä¸ªä¿¡æ¯ï¼Œå¯¹å°†æ¥å›é¡¾å¾ˆé‡è¦ã€‚\n- Cards\n\t- ç¿»è¯‘ï¼šä¸»è¦èµ·åˆ°æ„å»ºå’Œè¿æ¥æˆ‘ä»¬çš„æƒ³æ³•çš„ä½œç”¨ã€‚æƒ³æ³•ã€æ´è§ã€é—ªå¿µã€äººç‰©ã€æ¦‚å¿µç­‰ç­‰è¯æ¡éƒ½å¯ä»¥ã€‚\n\t- æˆ‘ç†è§£ä¸º[[æ°¸ä¹…ç¬”è®°]]ã€‚æŠŠé—ªå¿µç¬”è®°æ•´ç†åçš„ä¸œè¥¿éƒ½æ”¾è¿™ï¼Œä¸åšæ–‡ä»¶å¤¹çš„åˆ†ç±»äº†ï¼Œç´¯æ­»äº†ï¼Œä¹Ÿæ˜¯æˆ‘ä» [[PARAå’ŒMOCè”ç”¨ç»„ç»‡ç¬”è®°]]è½¬åˆ° [[ACCESS ç¬”è®°ç»„ç»‡æ³•]]çš„æ ¹æœ¬åŸå› ã€‚\n- Extras\n\t- ç¿»è¯‘ï¼šè®©æ”¯æ’‘ææ–™æ–¹ä¾¿è¢«å¼•ç”¨ã€‚æ¯”å¦‚æ–‡ä»¶ã€å›¾ç‰‡ã€ç…§ç‰‡å’Œæ¨¡æ¿ç­‰ã€‚\n\t- Drawsï¼Œæ”¾ [[Excalidraw]] çš„å›¾ã€‚\n\t- Mediaï¼Œæ”¾èµ„æºæ–‡ä»¶ã€‚\n\t- Templateï¼Œæ”¾å„ç§[[æ¨¡æ¿ä¸å¥—è·¯]]ã€‚\n- Sources\n\t- ç¿»è¯‘ï¼šè®©è¢«æˆ‘ä»¬æ¶ˆåŒ–è¿‡çš„å¤–éƒ¨èµ„æºä¸­çš„çŸ¥è¯†ï¼Œæ›´æ–¹ä¾¿è¢«å¼•ç”¨ã€‚æ–‡ç« ã€ä¹¦ã€åšå®¢ã€è®ºæ–‡ã€è¯¾ç¨‹ã€æ¼”è®²ã€ç”µå½±ç­‰ç­‰å¤–éƒ¨ææ–™éƒ½æ˜¯ã€‚\n\t- æˆ‘ç†è§£ä¸º[[æ–‡çŒ®ç¬”è®°]]ã€‚ä¹Ÿå°±æ˜¯å°†æ¶ˆåŒ–è¿‡çš„å¤–éƒ¨èµ„æºæˆ–ææ–™æ”¾è¿™ï¼Œæ–¹ä¾¿å¼•ç”¨ã€‚ä¹‹å‰ä¸ºäº†ä¿æŒ obsidian çš„çº¯ç²¹æ€§ï¼Œä¸å¾€é‡Œé¢æ”¾ epubï¼Œpdf ç­‰æ–‡ä»¶ï¼Œè™½ç„¶æœ‰å•å‘å¼•ç”¨é“¾æ¥å¯ä»¥è·³è½¬è‡³å¤–éƒ¨çš„è¿™äº›æ–‡ä»¶ï¼Œä½†ç¼ºå°‘åå‘é“¾æ¥æ€»æ˜¯ä¸å¾—åŠ²å„¿ï¼Œå…ˆå¼€å§‹å°è¯•æŠŠé‡è¦èµ„æºä¿å­˜è‡³ obsidian åº“å†…ã€‚\n- Spaces\n\t- ç¿»è¯‘ï¼šç”Ÿæ´»å’Œå·¥ä½œçš„å¤§äº‹é¡¹çš„å·¥ä½œå°ã€‚\n\t- æˆ‘ç†è§£ä¸º[[é¡¹ç›®ç¬”è®°]]ã€‚å³ä¸ºä¸€äº›å¯æ‰§è¡Œçš„æœ‰æœŸé™çš„å¯é—­ç¯çš„è¾ƒå¤§çš„äº‹å„¿ï¼Œè®¾ç«‹ä¸€ä¸ªä¸“é¢˜ã€‚æ¯”å¦‚æˆ‘çš„æŸä¸ªçˆ±å¥½çš„ä¸“é¢˜ã€‚è¿™ä¸ªç©ºé—´ä¹Ÿæ˜¯å¯¹ [[PKMç³»ç»Ÿçš„ä¸åŒä¾§é‡ç‚¹-å››è±¡é™å›¾ by lyt]] ä¸­çš„ knowledge å’Œ action çš„ 2 ä¸ªç»´åº¦çš„ç»“åˆå°è¯•ã€‚æœ‰ [[PARA]] çš„å½±å­ï¼š[[Spaces ä¸­çš„ MAPS ç»„ç»‡æ–¹æ³•]]\n\t- Archiveï¼Œè‡ªåˆ›ã€‚å¾…åˆ°å†…å®¹è§„æ¨¡å¤§äº†ï¼Œä¹Ÿè®¸è¿˜æ˜¯éœ€è¦å½’æ¡£æœºåˆ¶ï¼Œç¼“è§£å†…å¿ƒå‹åŠ›æ„Ÿã€‚\n\n# æˆ‘çš„ç–‘æƒ‘\n\n- å¾…å®è·µ 2 æ˜ŸæœŸå·¦å³æ¥çœ‹çœ‹ã€‚\n\t- åˆ›å»ºæ¯ä¸€åˆ™ç¬”è®°çš„å…¥å£ï¼Œé™¤äº† Calendar é‡Œé¢ï¼Œè¿˜æœ‰å“ªé‡Œï¼Ÿæ˜¯å¦éœ€è¦å€ŸåŠ© quickaddã€‚ä»¥åŠç¬”è®°åœ¨ä¸åŒæ–‡ä»¶å¤¹ä¹‹é—´çš„æµè½¬æ–¹å¼å’Œé¢‘ç‡ã€‚è¿™ä¼°è®¡ä¹Ÿæ˜¯ä»–å–è¯¾é‡Œé¢çš„æ ¸å¿ƒå†…å®¹ä¹‹ä¸€ã€‚\n\t- Spaces ä¸­ï¼ŒMAPS æ¨¡å‹å¦‚ä½•éƒ¨ç½²å’Œè½åœ°ï¼Ÿå¾…å®Œå·¥åï¼Œå¦‚ä½•å°†è¿™é‡Œé¢çš„ç¬”è®°è½¬åŒ–æˆ[[æ°¸ä¹…ç¬”è®°]]ï¼Œæˆ–è€…ç›´æ¥æ•´ä½“å½’æ¡£ï¼Ÿ\n- [[2022-07-20]] ä½“ä¼šï¼šé™¤äº†ç»´æŒåŸæœ‰çš„åœ¨ dailynote æˆ–æ–‡ä»¶ä¸­ç”¨åŒä¸­æ‹¬å·æ–°å»ºæ–‡ä»¶çš„ä¹ æƒ¯ã€‚ç”±äºæœ‰äº†æ–‡ä»¶å¤¹ç»“æ„ï¼Œä¸ºäº†ç»´æŒè¿™éƒ¨åˆ†æ–‡ä»¶å¤¹çš„æœ‰åºæ€§ï¼Œéœ€è¦åœ¨æ–‡ä»¶å¤¹ä¸­ï¼Œé€šè¿‡å³é”®æ–°å»ºç›¸å…³æ–‡ä»¶ï¼Œå¹¶ä¸æ˜¯æœ‰äº†æ–‡ä»¶å¤¹ï¼Œå°±èˆå¼ƒé“¾æ¥äº†ï¼Œæ­¤æ—¶åˆ›å»ºçš„æ–‡ä»¶æ˜¯å­¤ç«‹çš„ï¼Œæ‰€ä»¥ä¸€å®šè¦æ‰¾å®ƒå¯¹åº”çš„çˆ¶ã€å­ç­‰å…³ç³»ï¼Œä»¥å»ºç«‹é“¾æ¥ã€‚\n- [[2022-08-05]] æ›´æ–°ï¼š[[âˆ‘ æœ¬åº“ ACCESS çš„æ–‡ä»¶å¤¹å…¥å£æ±‡æ€»]]\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":[]},"/Cards/Apple/MacOS":{"title":"MacOS","content":"\n* è§£é™¤ä¸‹è½½ç¨‹åºçš„é™åˆ¶\n\t* è¿›å…¥ `/Applications` ç›®å½•ï¼Œæ‰§è¡Œ `xattr -r -c \u003capp name\u003e`\n* æŸ¥çœ‹è·¯ç”±\n\t* `netstat -rn`\n* æŸ¥çœ‹æŸä¸ªç½‘ç»œæ¥å£ç”±å“ªä¸ªç¨‹åºåˆ›å»º\n\t* `ifconfig -v \u003cinterface\u003e | grep \"agent domain\"`\n* SSHåˆ°åˆ«çš„æœåŠ¡å™¨åï¼Œä¸­æ–‡ä¹±ç \n\t* ç¼–è¾‘ /etc/ssh_configï¼Œæ³¨é‡Š`SendEnv LANG LC_*`ä¸€è¡Œå³å¯ã€‚\n* SSHè‡ªåŠ¨unlink GPG sockets\n\t* ç¼–è¾‘ /etc/ssh_configï¼Œæ·»åŠ é…ç½®`StreamLocalBindUnlink yes`","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["Apple"]},"/Cards/Apple/My-Apple-Devices":{"title":"My Apple Devices","content":"\n1. iPhone 14 Pro\n2. AirPods Pro\n3. Macbook Pro 2021 M1 Pro\n4. [[Cards/Apple/iPad]] Air 5\n5. Apple Watch S7\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":[]},"/Cards/Apple/iPad":{"title":"iPad","content":"\n* å‹å·\n\t* iPad Air 5\n* è´­ä¹°æ—¥æœŸ\n\t* 2022-09-29\n* æ— æ³•é”å±é—®é¢˜\n\t* å› ä¸ºé€šç”¨æ§åˆ¶\n* å­¦ä¹ å·¥å…·\n\t* MarginNote 3\n\t* GoodNotes 5\n\t* Prodrafts\n\t* PDF Expert\n* è´´è†œ\n\t* æ°´å‡è†œ\n* ç¬”å°–\n\t* æ´›å°å¸Œ2H","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["Apple"]},"/Cards/CS/%E5%AE%89%E5%85%A8/%E7%8E%A9%E8%BD%ACYubikey":{"title":"ç©è½¬YubiKey","content":"\n# ä»€ä¹ˆæ˜¯YubiKey\n\n## å®˜æ–¹è§£é‡Š\n\n\u003e [!info] å®˜æ–¹è§£é‡Š\n\u003e The YubiKey is a form of 2 Factor Authentication (2FA) which works as an extra layer of security to your online accounts. With a YubiKey, you simply register it to your account, then when you log in, you must input your login credentials (username+password) and use your YubiKey (plug into USB-port or scan via NFC). Both login credentials and YubiKey are needed at login. This physical layer of protection prevents many account takeovers that can be done virtually.\n\u003e https://support.yubico.com/hc/en-us/articles/4404456942738-FAQ#what-is-a-yubikey-\n\nYubikeyæ˜¯2å› å­éªŒè¯ï¼ˆ2FAï¼‰çš„ä¸€ç§å½¢å¼ï¼Œå¯ä½œä¸ºä½ çš„åœ¨çº¿è´¦æˆ·çš„ä¸€ä¸ªé¢å¤–çš„å®‰å…¨å±‚ã€‚ä½¿ç”¨ YubiKeyï¼Œä½ åªéœ€å°†å…¶æ³¨å†Œåˆ°ä½ çš„å¸æˆ·ï¼Œç„¶åå½“ç™»å½•æ—¶ï¼Œä½ å¿…é¡»è¾“å…¥ä½ çš„ç™»å½•å‡­æ®ï¼ˆç”¨æˆ·å+å¯†ç ï¼‰å¹¶ä½¿ç”¨ä½ çš„ YubiKeyï¼ˆæ’å…¥ USB ç«¯å£æˆ–é€šè¿‡ NFC æ‰«æï¼‰ã€‚ç™»å½•å‡­è¯å’ŒYubikeyä¸¤è€…åœ¨ç™»å½•æ—¶éƒ½ä¼šéœ€è¦ã€‚è¿™ç§ç‰©ç†ä¿æŠ¤å±‚å¯ä»¥é˜²æ­¢è®¸å¤šå¯ä»¥è™šæ‹Ÿå®Œæˆçš„å¸æˆ·æ¥ç®¡ã€‚\n\n## YubiKeyæ”¯æŒçš„åŠ å¯†åè®®\n\n\u003e [!info] å®˜æ–¹æ–‡æ¡£\n\u003e https://support.yubico.com/hc/en-us/articles/4404456942738-FAQ#security-protocols-explained\n\n### OTP\n\nOne-time passwordï¼Œä¸€æ¬¡æ€§å¯†ç ã€‚\n\nYubico OTP æ˜¯ä¸€ç§ç®€å•è€Œå¼ºå¤§çš„èº«ä»½éªŒè¯æœºåˆ¶ï¼Œå¼€ç®±å³ç”¨ï¼Œå—åˆ° YubiKey 5 ç³»åˆ—å’Œ YubiKey FIPS ç³»åˆ—çš„æ”¯æŒã€‚ Yubico OTP å¯ä»¥ç”¨ä½œåŒå› ç´ èº«ä»½éªŒè¯æ–¹æ¡ˆä¸­çš„ç¬¬äºŒä¸ªå› ç´ ï¼Œæˆ–è€…å•ç‹¬æä¾›å¼ºå¤§çš„å•å› ç´ èº«ä»½éªŒè¯ã€‚\n\n### FIDO2\n\nFIDO2 æ˜¯ FIDO U2F çš„æ— å¯†ç è¿›åŒ–ã€‚ FIDO2 çš„æ€»ä½“ç›®æ ‡æ˜¯æä¾›ä¸€ç»„æ‰©å±•åŠŸèƒ½ä»¥æ¶µç›–å…¶ä»–ç”¨ä¾‹ï¼Œä¸»è¦é©±åŠ¨å› ç´ æ˜¯æ— å¯†ç ç™»å½•æµç¨‹ã€‚ U2F æ¨¡å‹ä»ç„¶æ˜¯ FIDO2 çš„åŸºç¡€ï¼ŒFIDO2 è§„èŒƒä¸­æä¾›äº†ç°æœ‰ U2F éƒ¨ç½²çš„å…¼å®¹æ€§ã€‚\n\n### FIDO2 U2F\n\nFIDO2 Universal 2nd Factor\n\nU2Fç”±Yubicoå’Œè°·æ­Œå…±åŒå¼€å‘ï¼Œåœ¨ä¸ºè°·æ­Œå‘˜å·¥æˆåŠŸéƒ¨ç½²åè´¡çŒ®ç»™äº†FIDOè”ç›Ÿã€‚è¯¥åè®®æ—¨åœ¨ä½œä¸ºç¬¬äºŒä¸ªå› ç´ æ¥åŠ å¼ºç°æœ‰çš„åŸºäºç”¨æˆ·å/å¯†ç çš„ç™»å½•æµç¨‹ã€‚å®ƒå»ºç«‹åœ¨ Yubico å‘æ˜çš„å¯æ‰©å±•å…¬é’¥æ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œå…¶ä¸­ä¸ºæ¯ä¸ªæœåŠ¡ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯†é’¥å¯¹ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒæ— é™æ•°é‡çš„æœåŠ¡ï¼ŒåŒæ—¶ä¿æŒå®ƒä»¬ä¹‹é—´çš„å®Œå…¨åˆ†ç¦»ä»¥ä¿æŠ¤éšç§ã€‚\n\n### OpenPGP\n\nOpenPGP æ˜¯ä¸€ä¸ªç”¨äºç­¾åå’ŒåŠ å¯†çš„å¼€æ”¾æ ‡å‡†ã€‚å®ƒé€šè¿‡åƒ PKCS#11 è¿™æ ·çš„æ¥å£ï¼Œä½¿ç”¨å­˜å‚¨åœ¨æ™ºèƒ½å¡ä¸Šçš„ç§é’¥æ¥å¯ç”¨ RSA/ECC å¯†é’¥ï¼Œæ”¯æŒåŠ å¯†ã€ç­¾åã€è®¤è¯ç­‰åŠŸèƒ½ã€‚\n\n### WebAuthn\n\nWebAuthn æ˜¯ä¸€é¡¹æ–°çš„ W3C å…¨çƒæ ‡å‡†ï¼Œç”¨äºåœ¨æ‰€æœ‰é¢†å…ˆçš„æµè§ˆå™¨å’Œå¹³å°æ”¯æŒçš„ Web ä¸Šè¿›è¡Œå®‰å…¨èº«ä»½éªŒè¯ã€‚ WebAuthn ä½¿ç”¨æˆ·å¯ä»¥è½»æ¾åœ°é€‰æ‹©èº«ä»½éªŒè¯å™¨æ¥ä¿æŠ¤ä»–ä»¬çš„å¸æˆ·ï¼ŒåŒ…æ‹¬å¤–éƒ¨/ä¾¿æºå¼èº«ä»½éªŒè¯å™¨ï¼ˆä¾‹å¦‚ç¡¬ä»¶å®‰å…¨å¯†é’¥ï¼‰å’Œå†…ç½®å¹³å°èº«ä»½éªŒè¯å™¨ï¼ˆä¾‹å¦‚ç”Ÿç‰©è¯†åˆ«ä¼ æ„Ÿå™¨ï¼‰\n\n### OATH\n\nOATH æ˜¯ä¸€ä¸ªç»„ç»‡ï¼Œå®ƒæŒ‡å®šäº†ä¸¤ä¸ªå¼€æ”¾çš„è®¤è¯æ ‡å‡†ï¼šTOTPï¼ˆTime-Based One-Time Passwordï¼‰ å’Œ HOTPï¼ˆHMAC-based One-Time Passwordï¼‰ã€‚è¦ä½¿ç”¨ TOTP è¿›è¡Œèº«ä»½éªŒè¯ï¼Œç”¨æˆ·è¾“å…¥ä¸€ä¸ª 6-8 ä½ä»£ç ï¼Œè¯¥ä»£ç æ¯ 30 ç§’æ›´æ”¹ä¸€æ¬¡ã€‚è¯¥ä»£ç æ˜¯ä½¿ç”¨ HMAC(sharedSecret, timestamp) ç”Ÿæˆçš„ï¼Œå…¶ä¸­æ—¶é—´æˆ³æ¯ 30 ç§’æ›´æ”¹ä¸€æ¬¡ã€‚shared secreté€šå¸¸ä»¥äºŒç»´ç å½¢å¼æä¾›æˆ–é¢„ç¼–ç¨‹åˆ°ç¡¬ä»¶å®‰å…¨å¯†é’¥ä¸­ã€‚\n\n### PIV\n\nYubikey æ”¯æŒä¸ªäººèº«ä»½éªŒè¯ (PIV å’Œ FIPS 201) æ™ºèƒ½å¡æ¥å£ (NIST SP 800-73)ã€‚æ ¹æ®æ™ºèƒ½å¡ä¸Šå­˜å‚¨çš„ç§é’¥ï¼Œé€šè¿‡ PKCS#11 ä¸€ç±»çš„é€šç”¨æ¥å£è¿›è¡ŒRSA æˆ–è€… ESS çš„ç­¾åã€åŠ å¯†ã€è§£å¯†æ“ä½œã€‚\n\n## Yubikeyçš„è´¦æˆ·é™åˆ¶\n\n\u003e [!info] å®˜æ–¹æ–‡æ¡£\n\u003e https://support.yubico.com/hc/en-us/articles/4404456942738-FAQ#what-is-the-yubikey-s-account-limit-\n\n### OTP\n\næ­¤åº”ç”¨ç¨‹åºå¯ä»¥æŒæœ‰ä¸¤ä¸ªå‡­æ®ã€‚ç„¶è€Œï¼ŒYubico OTP æ˜¯æ”¾ç½®åœ¨è¿™ä¸ªåº”ç”¨ç¨‹åºä¸­æœ€æµè¡Œçš„å‡­è¯ç±»å‹ä¹‹ä¸€ï¼Œå¯ä»¥æ³¨å†Œæ— é™æ•°é‡çš„æœåŠ¡ã€‚\n\n### FIDO U2F\n\nä¸ Yubico OTP ç±»ä¼¼ï¼ŒU2F åº”ç”¨ç¨‹åºå¯ä»¥æ³¨å†Œæ— é™æ•°é‡çš„æœåŠ¡\n\n### FIDO2\n\nYubiKey 5 åœ¨å…¶ FIDO2 åº”ç”¨ç¨‹åºä¸­æœ€å¤šå¯å®¹çº³ 25 ä¸ªå¸¸é©»å¯†é’¥ã€‚\n\n### PIV\n\nYubiKey 5çš„PIVï¼ˆæ™ºèƒ½å¡ï¼‰åº”ç”¨ç¨‹åºæœ‰24ä¸ªæ’æ§½ï¼Œæ¯ä¸ªæ’æ§½å¯ä»¥å®¹çº³ä¸€ä¸ªè¯ä¹¦åŠå…¶ç›¸åº”çš„ç§é’¥\n\n### OpenPGP\n\nYubiKey 5 çš„ OpenPGP åº”ç”¨ç¨‹åºæœ€å¤šå¯ä»¥ä¿å­˜ä¸‰ä¸ª OpenPGP ç§é’¥ï¼Œä¸€ä¸ªç”¨äºåŠ å¯†ï¼Œä¸€ä¸ªç”¨äºç­¾åï¼Œä¸€ä¸ªç”¨äºèº«ä»½éªŒè¯ã€‚\n\n# ä½¿ç”¨è¯´æ˜\n\n## YubikeyÂ çš„ä½¿ç”¨æ–¹å¼\n\n-   ç¬¬ä¸‰æ–¹è½¯ä»¶è¯·æ±‚ Yubikey å¹¶éœ€è¦è§¦ç¢°ï¼ˆä¾‹å¦‚ FIDO U2Fï¼‰\n-   å°†ä¸¤ä¸ª Slot ä½œä¸ºæ¨¡æ‹Ÿé”®ç›˜è¾“å…¥ï¼ˆä¾‹å¦‚é™æ€å¯†ç ï¼‰\n-   é€šè¿‡ Yubico æŒ‡å®šçš„è½¯ä»¶ä½¿ç”¨ NFC æˆ–æ¥å£è¯»å– Yubikey å†…å…¶ä»–çš„æ•°æ®ï¼ˆä¾‹å¦‚ Yubico Authenticatorï¼‰\n\n## Yubikey çš„é‡‘å±ç‰‡è§¦ç¢°æ–¹å¼\n\n-   è½»è§¦ 1 ä¸‹ åœ¨ Yubikey äº®ç¯æ—¶ï¼Œ å…è®¸å½“å‰å¯¹äº Yubikey çš„è¯·æ±‚\n-   è½»è§¦ 1 ç§’ æ¿€æ´» Slot 1 å¹¶è¾“å…¥è¯¥æ’æ§½çš„é»˜è®¤è¾“å‡ºç»“æœ\n-   é•¿è§¦ 3 ç§’ æ¿€æ´» Slot 2 å¹¶è¾“å…¥è¯¥æ’æ§½çš„é»˜è®¤è¾“å‡ºç»“æœ\n\n## YubikeyÂ çš„ç¯å…‰å«ä¹‰\n\n-   çŸ­é—ªçƒï¼š æœ‰åº”ç”¨å¯¹ Yubikey å‘é€è¯·æ±‚\n-   é•¿äº®ï¼š ä½œä¸ºæ¨¡æ‹Ÿé”®ç›˜æ­£åœ¨å‘å½“å‰çª—å£è¾“å…¥æ’æ§½\n\n## ä½¿ç”¨åœºæ™¯\n\n### æ“ä½œç³»ç»Ÿç™»å½•\n\nWindowsã€Linuxå’ŒMacOSç³»ç»Ÿçš„ç™»å½•éªŒè¯ã€‚\n\n### ç½‘é¡µç™»å½•\n\nå¸¸è§çš„æ”¯æŒç½‘ç«™æœ‰ï¼š\n\n- Apple\n- Bitwarden\n- Cloudflare\n- Dropbox\n- Facebook\n- Google\n- Github\n- GItlab\n- Twitter\n- Microsoft\n\nç­‰ç­‰ã€‚\n\n### GPGå¯†é’¥\n\nå°†GPGå¯†é’¥å­˜å‚¨åˆ°YubiKeyé‡Œï¼Œæ›´åŠ å®‰å…¨å¹¶ä¸”ä¾¿æºã€‚\n\n### æ”¯æŒçš„å¯†ç ç®¡ç†å™¨\n\n1Passwordï¼ŒKeeperÂ®ï¼ŒLastPass Premiumï¼ŒBitwarden Premiumã€‚\n\n### Yubico Authenticator\n\nYubico Authenticator æ˜¯è·¨ç§»åŠ¨è®¾å¤‡å’Œæ¡Œé¢ç«¯çš„èº«ä»½éªŒè¯å™¨åº”ç”¨ã€‚  \nä¸å…¶ä»–èº«ä»½éªŒè¯å™¨åº”ç”¨ç¨‹åºï¼ˆåŒ…æ‹¬ Google Authenticatorã€Microsoft Authenticator ï¼‰å…¼å®¹ã€‚\n\nGoogle Authenticator èº«ä»½éªŒè¯åº”ç”¨ç¨‹åºåªå…è®¸å°†å‡­è¯å­˜å‚¨åœ¨æœ¬åœ°è®¾å¤‡ä¸Šï¼Œé¿å…äº†å› ä¸ºç½‘ç»œåŸå› å¯¼è‡´çš„å‡­è¯æ³„éœ²ï¼Œä½†æ˜¯å½“è®¾å¤‡æ— æ³•ä½¿ç”¨æ—¶æ— æ³•æ‰¾å›å·²ç»ä¿å­˜çš„å‡­è¯ã€‚\n\nMicrosoft Authenticator èº«ä»½éªŒè¯åº”ç”¨ç¨‹åºå…è®¸ç”¨æˆ·å°†å‡­è¯å­˜å‚¨ä¿å­˜åˆ° OneDrive ä¸Šï¼Œå¹¶ä¸”å…è®¸å¤šè®¾å¤‡ç™»å½•ã€‚\n\nYubico Authenticator èº«ä»½éªŒè¯åº”ç”¨ç¨‹åºå…è®¸å°†å”¯ä¸€å‡­æ®å­˜å‚¨åœ¨ç¡¬ä»¶æ”¯æŒçš„å®‰å…¨å¯†é’¥ä¸Šï¼Œæ— è®ºæ‚¨ä»ç§»åŠ¨è®¾å¤‡åˆ°æ¡Œé¢è®¾å¤‡ï¼Œéƒ½å¯ä»¥éšèº«æºå¸¦ã€‚æ— éœ€å†åœ¨æ‰‹æœºä¸Šå­˜å‚¨æ•æ„Ÿæœºå¯†ï¼Œé¿å…æ‚¨çš„å¸æˆ·è¢«ä»–äººæ¥ç®¡ã€‚\n\nYubico Authenticator åº”ç”¨ç¨‹åºåˆ›å»ºå‡­æ®å­˜å‚¨åå°†å‡­è¯å­˜å‚¨åœ¨ YubiKey ä¸Šè€Œä¸æ˜¯æ‰‹æœºä¸Šï¼Œè¿™æ ·å³ä½¿æ‰‹æœºæ— æ³•ä½¿ç”¨ä»ç„¶å¯ä»¥ä½¿ç”¨å¦ä¸€å°è®¾å¤‡æŸ¥çœ‹å‡­è¯ã€‚\n\n## Yubikey çš„å¤‡ä»½\n\nYubico å®˜æ–¹å»ºè®®æ‹¥æœ‰å¤šä¸ª YubiKeyã€‚è¿™æ ·ä¸€ä¸ªå¯†é’¥å¯ä»¥ç”¨ä½œä¸»å¯†é’¥ï¼Œå¦ä¸€ä¸ªå¯†é’¥å¯ä»¥ç”¨ä½œå¤‡ç”¨å¯†é’¥ã€‚æ‹¥æœ‰å¤‡ç”¨é’¥åŒ™çš„é‡è¦æ€§å·²å¾—åˆ°å……åˆ†è¯å®ï¼Œå¦‚æœä½ ä¸¢å¤±äº†ä¸»é’¥åŒ™ï¼Œåœ¨æœ€éœ€è¦çš„æ—¶å€™ï¼Œä½ ä¹Ÿä¸ä¼šå¤±å»è®¿é—®é‡è¦å¸æˆ·çš„æƒé™ã€‚æ¢å¥è¯è¯´ï¼Œæœ‰äº†å¤‡ç”¨é’¥åŒ™ï¼Œä½ å°±ä¸å¿…æ‹…å¿ƒè¢«é”åœ¨ä»»ä½•è´¦æˆ·ä¹‹å¤–ï¼Œä¹Ÿä¸éœ€è¦ç»å†æ¼«é•¿çš„æ¢å¤å’Œèº«ä»½éªŒè¯è¿‡ç¨‹æ¥é‡æ–°è·å¾—æ¯ä¸ªè´¦æˆ·çš„è®¿é—®æƒé™ã€‚\n\n# é…ç½®\n\nYubikeyçš„å…·ä½“é…ç½®å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š[[Cards/CS/å®‰å…¨/YubiKeyé…ç½®]]\n\n# å‚è€ƒèµ„æ–™\n\n1. [Yubikey å·¥ä½œåŸç†](https://www.mengorg.cn/archives/yubikey-work)\n2. [YubiKey 5 NFC å®‰å…¨å¯†åŒ™ç®€ä»‹ä¸ä½¿ç”¨](https://www.mengorg.cn/archives/yubikey-5-nfc)\n3. [Yubikey ä½¿ç”¨æ‰‹å†Œ](https://www.bookstack.cn/read/yubikey-handbook-chinese/README.md)\n4. [Yubikeyä½¿ç”¨ä¸€å¹´æ€»ç»“](https://blog.blahgeek.com/yubikey-review/)\n5. [YubiKey çš„è‹¥å¹²ç§ç©æ³•](https://blog.dl444.net/2021/06/05/YubiKey/)","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/å®‰å…¨","YubiKey"]},"/Cards/CS/%E5%AE%89%E5%85%A8/YubiKey%E9%85%8D%E7%BD%AE":{"title":"YubiKeyé…ç½®","content":"\n# åˆå§‹åŒ–è®¾ç½®\n\n\u003e https://xiaoqiang.blog/yubikey-shiyong/\n\nè®¾ç½®PIVåŠŸèƒ½çš„PINå’ŒPUK\n\nè®¾ç½®FIDO2åŠŸèƒ½çš„PIN\n\nè®¾ç½®OTPåŠŸèƒ½\n\n# æ“ä½œç³»ç»Ÿç™»å½•\n\n## Macç™»é™†é…ç½®\n\n\u003e https://support.yubico.com/hc/en-us/articles/360016649059-Using-Your-YubiKey-as-a-Smart-Card-in-macOS\n\næ³¨æ„éœ€è¦åœ¨Yubikey Mangerçš„Applications \u003e PIVé‡Œï¼Œç‚¹å‡»setup for macOS\n\n## Enable smartcard only on macOS\n\nå¼€å¯card onlyéªŒè¯åï¼Œåªæœ‰æœ€è¿‘ä½¿ç”¨è¿‡éªŒè¯çš„yubikeyèƒ½è§£é”macOSçš„å¯åŠ¨è¿‡ç¨‹ä¸­çš„ç™»é™†\n\n\u003e https://support.apple.com/zh-cn/guide/deployment/depfce8de48b/1/web/1.0\n\n### ä½¿ç”¨åŸºäºæœºå™¨çš„æ‰§è¡Œæ–¹æ¡ˆçš„ä»…æ™ºèƒ½å¡è®¤è¯\n\n`sudo defaults write /Library/Preferences/com.apple.security.smartcard enforceSmartCard -bool true`\n\n## Linuxç™»é™†é…ç½®\n\n\u003e https://support.yubico.com/hc/en-us/articles/360016649099-Ubuntu-Linux-Login-Guide-U2F\n\n## Windowsç™»å½•é…ç½®\n\n\u003e https://support.yubico.com/hc/en-us/articles/360013708460-Yubico-Login-for-Windows-Configuration-Guide\n\n# GPGé…ç½®\n\n\u003e https://github.com/drduh/YubiKey-Guide\n\n## Configure Smartcard\n\nEnable KDF\n\nChange PIN\n\nSet information\n\n## Transfer keys\n\n# OTP\n\nOTP åŠŸèƒ½å¼€ç®±å³ç”¨ï¼Œä¸€æ¬¡ä¸€å¯†ï¼Œéœ€è¦è”ç½‘è®¤è¯ï¼Œå®˜æ–¹æœ‰æä¾›è®¤è¯æœåŠ¡å™¨ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±æ­å»ºè®¤è¯æœåŠ¡å™¨ã€‚\n\n-   OTP:Â `KEY_ID+AES(AES_KEY, SECRET, COUNT++)`å³ç”Ÿæˆçš„å¯†ç åŒ…å«æ˜æ–‡çš„KEY_IDå’Œå¯¹ç§°åŠ å¯†çš„SECRETå’Œè®¡æ•°å™¨ã€‚ç¬¬ä¸€æ¬¡ä½¿ç”¨å‰éœ€è¦æŠŠKEY_IDï¼ŒAES_KEYï¼ŒSECRETæäº¤è‡³éªŒè¯æœåŠ¡å™¨ï¼ˆYubicoæä¾›æˆ–è€…è‡ªå·±æ­å»ºï¼‰ï¼Œä¹‹ååº”ç”¨ç¨‹åºæ¯æ¬¡é€šè¿‡æœåŠ¡å™¨éªŒè¯å¯†ç çš„å¯é æ€§ï¼ˆè§£ç åSECRETå¯¹åº”ã€COUNTå¢å¤§ï¼ˆé˜²æ­¢é‡æ”¾æ”»å‡»ï¼‰ï¼‰ã€‚\n-   Static: é™æ€å¯†ç ã€‚é¡¾åæ€ä¹‰ï¼Œæ¯æ¬¡ç”Ÿæˆå›ºå®šçš„ä¸€ä¸²å¯†ç ã€‚\n-   Challenge-Response:Â `HMAC(SECRET, INPUT)`å³å¯ä»¥é€šè¿‡HIDæ¥å£ç»™å®šä¸€ä¸ªè¾“å…¥ï¼Œè¾“å…¥HMACçš„è®¡ç®—ç»“æœã€‚è¾“å…¥éœ€è¦æœ¬åœ°ä»£ç å®ç°ã€‚\n-   HOTP:Â `HMAC(SECRET, COUNTER++)`ç®—æ³•ä¸Challenge-Responseç±»ä¼¼ï¼Œç„¶è€Œä½¿ç”¨ç´¯åŠ è®¡æ•°å™¨ä»£æ›¿äº†è¾“å…¥ï¼Œå¹¶ä¸”HTOPæ˜¯ä¸€ä¸ª[æ ‡å‡†åè®®](https://twofactorauth.org/)ï¼Œè®¸å¤šç½‘ç«™å’Œè®¾å¤‡éƒ½å…¼å®¹è¯¥æ ‡å‡†ã€‚\n\næ¯ä¸ªYubikeyéƒ½æœ‰ä¸¤ä¸ªslotï¼Œå‡ºå‚æ—¶é»˜è®¤OTPé…ç½®åœ¨slot 1ï¼ŒçŸ­æŒ‰æ“ä½œå³å¯è§¦å‘OTPè®¤è¯; slot 2å¯é…ç½®Â `é™æ€å¯†ç `Â `Challenge-Response`Â `HOTP`Â ä¸­çš„ä¸€ç§ï¼Œé•¿æŒ‰(2-5s)å¯è§¦å‘ã€‚\n\n# U2F\n\nYubiKeyä¸­è¯¥åŠŸèƒ½å¼€ç®±å³ç”¨ï¼Œæ— éœ€å¤æ‚é…ç½®ã€‚\n\nåªè¦æ ¹æ®ç½‘ç«™æç¤ºå¼€å¯äºŒæ¬¡éªŒè¯(2FA)å¹¶ç»‘å®šä½ çš„YubiKey, ä¸‹æ¬¡ç™»å½•è´¦æˆ·æ—¶ï¼Œä½ é¦–å…ˆéœ€è¦åƒå¾€å¸¸ä¸€æ ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åæ ¹æ®æç¤ºç”¨ä½ çš„YubiKeyè¿›è¡ŒäºŒæ¬¡éªŒè¯ã€‚è¿™æ ·å³ä½¿ä½ çš„å¸å·å¯†ç è¢«åˆ«äººçŸ¥é“äº†ï¼Œåªè¦keyåœ¨ä½ æ‰‹é‡Œï¼Œé‚£ä¹ˆä½ çš„å¸å·ä¾ç„¶æ˜¯å®‰å…¨çš„ã€‚\n\n## Apple\n\n## Bitwarden\n\n\u003e https://bitwarden.com/help/setup-two-step-login-yubikey/\n\n\u003e https://github.com/dani-garcia/vaultwarden/wiki/Enabling-Yubikey-OTP-authentication\n\n## Cloudflare\n\n## Google\n\n## Github\n\n## Microsoft\n\n# å˜æ›´opengpg email\n\n\u003e https://support.apple.com/zh-cn/guide/deployment/depfce8de48b/1/web/1.0\n\nè½½å…¥ä¸»å¯†é’¥çš„ç§é’¥\n\n`gpgÂ --importÂ /path/to/offline/master/key/MASTERKEY.priv.asc`\n\nç¼–è¾‘ä¸»å¯†é’¥\n\n```bash\ngpg --edit-key MASTERKEY\n    adduid # Fill out form\n    uid n # where n is the new uid number\n    primary # To set the new e-mail as the primary e-mail address for the key\n    save\n```\n\nåˆ†åˆ«å¯¼å‡ºä¸»å¯†é’¥çš„å…¬é’¥å’Œç§é’¥å¤‡ä»½ï¼Œå¹¶å¦¥å–„ä¿å­˜\n\n```bash\ngpg -a --export MASTERKEY \u003e /path/to/offline/master/key/MASTERKEY.pub.asc\ngpg -a --export-secret-key MASTERKEY \u003e /path/to/offline/master/key/MASTERKEY.priv.asc\n```\n\nåˆ é™¤ä¸»å¯†é’¥çš„ç§é’¥\n\n```bash\ngpg --delete-secret-key MASTERKEY\n```\n\nä¸Šä¼ å¹¶å¯¼å…¥å…¬é’¥\n\n```bash\ngpg --send-key $KEYID\ngpg --keyserver pgp.mit.edu --send-key $KEYID\ngpg --keyserver keys.gnupg.net --send-key $KEYID\ngpg --keyserver hkps://keyserver.ubuntu.com:443 --send-key $KEYID\n```","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/å®‰å…¨","YubiKey"]},"/Cards/CS/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93":{"title":"æ•°æ®ç»“æ„ä¸ç®—æ³•æ€»ç»“","content":"\n# æ•°æ®ç»“æ„ä¸ç®—æ³•æ€»ç»“\n\n# æ•°æ®ç»“æ„\n\n20ä¸ªæœ€å¸¸ç”¨çš„ã€æœ€åŸºç¡€æ•°æ®ç»“æ„ä¸ç®—æ³•ï¼š**æ•°ç»„ã€é“¾è¡¨ã€æ ˆã€é˜Ÿåˆ—ã€æ•£åˆ—è¡¨ã€äºŒå‰æ ‘ã€å †ã€è·³è¡¨ã€å›¾ã€Trie æ ‘ï¼›10 ä¸ªç®—æ³•ï¼šé€’å½’ã€æ’åºã€äºŒåˆ†æŸ¥æ‰¾ã€æœç´¢ã€å“ˆå¸Œç®—æ³•ã€è´ªå¿ƒç®—æ³•ã€åˆ†æ²»ç®—æ³•ã€å›æº¯ç®—æ³•ã€åŠ¨æ€è§„åˆ’ã€å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ã€‚**\n\n**æˆ‘ä»¬å­¦ä¹ æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œè¦å­¦ä¹ å®ƒçš„ç”±æ¥ã€ç‰¹æ€§ã€é€‚ç”¨çš„åœºæ™¯ä»¥åŠå®ƒèƒ½è§£å†³çš„é—®é¢˜ã€‚**\n\n## æ•°ç»„\n\næ•°ç»„å¯ä»¥è¯´æ˜¯æœ€åŸºç¡€ã€æœ€ç®€å•çš„æ•°æ®ç»“æ„äº†ã€‚æ•°ç»„ç”¨ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œæ¥å­˜å‚¨ç›¸åŒç±»å‹çš„ä¸€ç»„æ•°æ®ï¼Œ**æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯æ”¯æŒéšæœºè®¿é—®ï¼Œä½†æ’å…¥ã€åˆ é™¤æ“ä½œä¹Ÿå› æ­¤å˜å¾—æ¯”è¾ƒä½æ•ˆï¼Œå¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸º O(n)**ã€‚åœ¨å¹³æ—¶çš„ä¸šåŠ¡å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ç¼–ç¨‹è¯­è¨€æä¾›çš„å®¹å™¨ç±»ï¼Œä½†æ˜¯ï¼Œå¦‚æœæ˜¯ç‰¹åˆ«åº•å±‚çš„å¼€å‘ï¼Œç›´æ¥ä½¿ç”¨æ•°ç»„å¯èƒ½ä¼šæ›´åˆé€‚ã€‚\n\n## é“¾è¡¨\n\né“¾è¡¨è·Ÿæ•°ç»„ä¸€æ ·ï¼Œä¹Ÿæ˜¯éå¸¸åŸºç¡€ã€éå¸¸å¸¸ç”¨çš„æ•°æ®ç»“æ„ã€‚ä¸è¿‡é“¾è¡¨è¦æ¯”æ•°ç»„ç¨å¾®å¤æ‚ï¼Œä»æ™®é€šçš„å•é“¾è¡¨è¡ç”Ÿå‡ºæ¥å¥½å‡ ç§é“¾è¡¨ç»“æ„ï¼Œæ¯”å¦‚åŒå‘é“¾è¡¨ã€å¾ªç¯é“¾è¡¨ã€åŒå‘å¾ªç¯é“¾è¡¨ã€‚\n\nå’Œæ•°ç»„ç›¸æ¯”ï¼Œé“¾è¡¨æ›´é€‚åˆæ’å…¥ã€åˆ é™¤æ“ä½œé¢‘ç¹çš„åœºæ™¯ï¼ŒæŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦è¾ƒé«˜ã€‚ä¸è¿‡ï¼Œåœ¨å…·ä½“è½¯ä»¶å¼€å‘ä¸­ï¼Œè¦å¯¹æ•°ç»„å’Œé“¾è¡¨çš„å„ç§æ€§èƒ½è¿›è¡Œå¯¹æ¯”ï¼Œç»¼åˆæ¥é€‰æ‹©ä½¿ç”¨ä¸¤è€…ä¸­çš„å“ªä¸€ä¸ªã€‚\n\nå†™å‡ºæ­£ç¡®é“¾è¡¨ä»£ç çš„å…­ä¸ªæŠ€å·§ã€‚åˆ†åˆ«æ˜¯ç†è§£æŒ‡é’ˆæˆ–å¼•ç”¨çš„å«ä¹‰ã€è­¦æƒ•æŒ‡é’ˆä¸¢å¤±å’Œå†…å­˜æ³„æ¼ã€åˆ©ç”¨å“¨å…µç®€åŒ–å®ç°éš¾åº¦ã€é‡ç‚¹ç•™æ„è¾¹ç•Œæ¡ä»¶å¤„ç†ï¼Œä»¥åŠä¸¾ä¾‹ç”»å›¾ã€è¾…åŠ©æ€è€ƒï¼Œè¿˜æœ‰å¤šå†™å¤šç»ƒã€‚\n\nå†™é“¾è¡¨ä»£ç æ˜¯æœ€è€ƒéªŒé€»è¾‘æ€ç»´èƒ½åŠ›çš„ã€‚å› ä¸ºï¼Œé“¾è¡¨ä»£ç åˆ°å¤„éƒ½æ˜¯æŒ‡é’ˆçš„æ“ä½œã€è¾¹ç•Œæ¡ä»¶çš„å¤„ç†ï¼Œç¨æœ‰ä¸æ…å°±å®¹æ˜“äº§ç”Ÿ Bugã€‚é“¾è¡¨ä»£ç å†™å¾—å¥½åï¼Œå¯ä»¥çœ‹å‡ºä¸€ä¸ªäººå†™ä»£ç æ˜¯å¦å¤Ÿç»†å¿ƒï¼Œè€ƒè™‘é—®é¢˜æ˜¯å¦å…¨é¢ï¼Œæ€ç»´æ˜¯å¦ç¼œå¯†ã€‚æ‰€ä»¥ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šé¢è¯•å®˜å–œæ¬¢è®©äººæ‰‹å†™é“¾è¡¨ä»£ç çš„åŸå› ã€‚æ‰€ä»¥ï¼Œè¿™ä¸€èŠ‚è®²åˆ°çš„ä¸œè¥¿ï¼Œä½ ä¸€å®šè¦è‡ªå·±å†™ä»£ç å®ç°ä¸€ä¸‹ï¼Œæ‰æœ‰æ•ˆæœã€‚\n\n## **æ ˆ**\n\næ ˆæ˜¯ä¸€ç§æ“ä½œå—é™çš„æ•°æ®ç»“æ„ï¼Œåªæ”¯æŒå…¥æ ˆå’Œå‡ºæ ˆæ“ä½œã€‚åè¿›å…ˆå‡ºæ˜¯å®ƒæœ€å¤§çš„ç‰¹ç‚¹ã€‚æ ˆæ—¢å¯ä»¥é€šè¿‡æ•°ç»„å®ç°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é“¾è¡¨æ¥å®ç°ã€‚**ä¸ç®¡åŸºäºæ•°ç»„è¿˜æ˜¯é“¾è¡¨ï¼Œå…¥æ ˆã€å‡ºæ ˆçš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸º O(1)ã€‚**é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è®²äº†ä¸€ç§æ”¯æŒåŠ¨æ€æ‰©å®¹çš„é¡ºåºæ ˆï¼Œä½ éœ€è¦é‡ç‚¹æŒæ¡å®ƒçš„å‡æ‘Šæ—¶é—´å¤æ‚åº¦åˆ†ææ–¹æ³•ã€‚\n\n## **é˜Ÿåˆ—**\n\né˜Ÿåˆ—æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å…ˆè¿›å…ˆå‡ºï¼Œä¸»è¦çš„ä¸¤ä¸ªæ“ä½œæ˜¯å…¥é˜Ÿå’Œå‡ºé˜Ÿã€‚è·Ÿæ ˆä¸€æ ·ï¼Œå®ƒæ—¢å¯ä»¥ç”¨æ•°ç»„æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨é“¾è¡¨æ¥å®ç°ã€‚ç”¨æ•°ç»„å®ç°çš„å«é¡ºåºé˜Ÿåˆ—ï¼Œç”¨é“¾è¡¨å®ç°çš„å«é“¾å¼é˜Ÿåˆ—ã€‚ç‰¹åˆ«æ˜¯é•¿å¾—åƒä¸€ä¸ªç¯çš„å¾ªç¯é˜Ÿåˆ—ã€‚åœ¨æ•°ç»„å®ç°é˜Ÿåˆ—çš„æ—¶å€™ï¼Œä¼šæœ‰æ•°æ®æ¬ç§»æ“ä½œï¼Œè¦æƒ³è§£å†³æ•°æ®æ¬ç§»çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦åƒç¯ä¸€æ ·çš„å¾ªç¯é˜Ÿåˆ—ã€‚\n\nå¾ªç¯é˜Ÿåˆ—æ˜¯æˆ‘ä»¬è¿™èŠ‚çš„é‡ç‚¹ã€‚è¦æƒ³å†™å‡ºæ²¡æœ‰ bug çš„å¾ªç¯é˜Ÿåˆ—å®ç°ä»£ç ï¼Œå…³é”®è¦ç¡®å®šå¥½é˜Ÿç©ºå’Œé˜Ÿæ»¡çš„åˆ¤å®šæ¡ä»¶ï¼Œå…·ä½“çš„ä»£ç ä½ è¦èƒ½å†™å‡ºæ¥ã€‚\n\n## **è·³è¡¨**\n\nè·³è¡¨ä½¿ç”¨ç©ºé—´æ¢æ—¶é—´çš„è®¾è®¡æ€è·¯ï¼Œé€šè¿‡æ„å»ºå¤šçº§ç´¢å¼•æ¥æé«˜æŸ¥è¯¢çš„æ•ˆç‡ï¼Œå®ç°äº†åŸºäºé“¾è¡¨çš„â€œäºŒåˆ†æŸ¥æ‰¾â€ã€‚**è·³è¡¨æ˜¯ä¸€ç§åŠ¨æ€æ•°æ®ç»“æ„ï¼Œæ”¯æŒå¿«é€Ÿåœ°æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logn)**ã€‚\n\n**è·³è¡¨çš„ç©ºé—´å¤æ‚åº¦æ˜¯ O(n)**ã€‚ä¸è¿‡ï¼Œè·³è¡¨çš„å®ç°éå¸¸çµæ´»ï¼Œå¯ä»¥é€šè¿‡æ”¹å˜ç´¢å¼•æ„å»ºç­–ç•¥ï¼Œæœ‰æ•ˆå¹³è¡¡æ‰§è¡Œæ•ˆç‡å’Œå†…å­˜æ¶ˆè€—ã€‚è™½ç„¶è·³è¡¨çš„ä»£ç å®ç°å¹¶ä¸ç®€å•ï¼Œä½†æ˜¯ä½œä¸ºä¸€ç§åŠ¨æ€æ•°æ®ç»“æ„ï¼Œæ¯”èµ·çº¢é»‘æ ‘æ¥è¯´ï¼Œå®ç°è¦ç®€å•å¤šäº†ã€‚æ‰€ä»¥å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¸ºäº†ä»£ç çš„ç®€å•ã€æ˜“è¯»ï¼Œæ¯”èµ·çº¢é»‘æ ‘ï¼Œæˆ‘ä»¬æ›´å€¾å‘ç”¨è·³è¡¨ã€‚\n\n## **æ•£åˆ—è¡¨**\n\næ•£åˆ—è¡¨æ¥æºäºæ•°ç»„ï¼Œå®ƒå€ŸåŠ©æ•£åˆ—å‡½æ•°å¯¹æ•°ç»„è¿™ç§æ•°æ®ç»“æ„è¿›è¡Œæ‰©å±•ï¼Œåˆ©ç”¨çš„æ˜¯æ•°ç»„æ”¯æŒæŒ‰ç…§ä¸‹æ ‡éšæœºè®¿é—®å…ƒç´ çš„ç‰¹æ€§ã€‚æ•£åˆ—è¡¨ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜æ˜¯æ•£åˆ—å‡½æ•°è®¾è®¡å’Œæ•£åˆ—å†²çªè§£å†³ã€‚æ•£åˆ—å†²çªæœ‰ä¸¤ç§å¸¸ç”¨çš„è§£å†³æ–¹æ³•ï¼Œå¼€æ”¾å¯»å€æ³•å’Œé“¾è¡¨æ³•ã€‚æ•£åˆ—å‡½æ•°è®¾è®¡çš„å¥½åå†³å®šäº†æ•£åˆ—å†²çªçš„æ¦‚ç‡ï¼Œä¹Ÿå°±å†³å®šæ•£åˆ—è¡¨çš„æ€§èƒ½ã€‚\n\n---\n\nå¦‚ä½•è®¾è®¡ä¸€ä¸ªå·¥ä¸šçº§çš„æ•£åˆ—è¡¨ï¼Œä»¥åŠå¦‚ä½•åº”å¯¹å„ç§å¼‚å¸¸æƒ…å†µï¼Œé˜²æ­¢åœ¨æç«¯æƒ…å†µä¸‹ï¼Œæ•£åˆ—è¡¨çš„æ€§èƒ½é€€åŒ–è¿‡äºä¸¥é‡ã€‚æˆ‘åˆ†äº†ä¸‰éƒ¨åˆ†æ¥è®²è§£è¿™äº›å†…å®¹ï¼Œåˆ†åˆ«æ˜¯ï¼šå¦‚ä½•è®¾è®¡æ•£åˆ—å‡½æ•°ï¼Œå¦‚ä½•æ ¹æ®è£…è½½å› å­åŠ¨æ€æ‰©å®¹ï¼Œä»¥åŠå¦‚ä½•é€‰æ‹©æ•£åˆ—å†²çªè§£å†³æ–¹æ³•ã€‚\n\nå…³äºæ•£åˆ—å‡½æ•°çš„è®¾è®¡ï¼Œæˆ‘ä»¬è¦å°½å¯èƒ½è®©æ•£åˆ—åçš„å€¼éšæœºä¸”å‡åŒ€åˆ†å¸ƒï¼Œè¿™æ ·ä¼šå°½å¯èƒ½åœ°å‡å°‘æ•£åˆ—å†²çªï¼Œå³ä¾¿å†²çªä¹‹åï¼Œåˆ†é…åˆ°æ¯ä¸ªæ§½å†…çš„æ•°æ®ä¹Ÿæ¯”è¾ƒå‡åŒ€ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ•£åˆ—å‡½æ•°çš„è®¾è®¡ä¹Ÿä¸èƒ½å¤ªå¤æ‚ï¼Œå¤ªå¤æ‚å°±ä¼šå¤ªè€—æ—¶é—´ï¼Œä¹Ÿä¼šå½±å“æ•£åˆ—è¡¨çš„æ€§èƒ½ã€‚\n\nå…³äºæ•£åˆ—å†²çªè§£å†³æ–¹æ³•çš„é€‰æ‹©ï¼Œæˆ‘å¯¹æ¯”äº†å¼€æ”¾å¯»å€æ³•å’Œé“¾è¡¨æ³•ä¸¤ç§æ–¹æ³•çš„ä¼˜åŠ£å’Œé€‚åº”çš„åœºæ™¯ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œé“¾è¡¨æ³•æ›´åŠ æ™®é€‚ã€‚è€Œä¸”ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å°†é“¾è¡¨æ³•ä¸­çš„é“¾è¡¨æ”¹é€ æˆå…¶ä»–åŠ¨æ€æŸ¥æ‰¾æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚çº¢é»‘æ ‘ï¼Œæ¥é¿å…æ•£åˆ—è¡¨æ—¶é—´å¤æ‚åº¦é€€åŒ–æˆ O(n)ï¼ŒæŠµå¾¡æ•£åˆ—ç¢°æ’æ”»å‡»ã€‚ä½†æ˜¯ï¼Œå¯¹äºå°è§„æ¨¡æ•°æ®ã€è£…è½½å› å­ä¸é«˜çš„æ•£åˆ—è¡¨ï¼Œæ¯”è¾ƒé€‚åˆç”¨å¼€æ”¾å¯»å€æ³•ã€‚\n\nå¯¹äºåŠ¨æ€æ•£åˆ—è¡¨æ¥è¯´ï¼Œä¸ç®¡æˆ‘ä»¬å¦‚ä½•è®¾è®¡æ•£åˆ—å‡½æ•°ï¼Œé€‰æ‹©ä»€ä¹ˆæ ·çš„æ•£åˆ—å†²çªè§£å†³æ–¹æ³•ã€‚éšç€æ•°æ®çš„ä¸æ–­å¢åŠ ï¼Œæ•£åˆ—è¡¨æ€»ä¼šå‡ºç°è£…è½½å› å­è¿‡é«˜çš„æƒ…å†µã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯åŠ¨åŠ¨æ€æ‰©å®¹ã€‚\n\n---\n\nä¸ºä»€ä¹ˆæ•£åˆ—è¡¨å’Œé“¾è¡¨ç»å¸¸ä¸€å—ä½¿ç”¨ï¼Ÿ\n\næ•£åˆ—è¡¨è¿™ç§æ•°æ®ç»“æ„è™½ç„¶æ”¯æŒéå¸¸é«˜æ•ˆçš„æ•°æ®æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œï¼Œä½†æ˜¯æ•£åˆ—è¡¨ä¸­çš„æ•°æ®éƒ½æ˜¯é€šè¿‡æ•£åˆ—å‡½æ•°æ‰“ä¹±ä¹‹åæ— è§„å¾‹å­˜å‚¨çš„ã€‚ä¹Ÿå°±è¯´ï¼Œå®ƒæ— æ³•æ”¯æŒæŒ‰ç…§æŸç§é¡ºåºå¿«é€Ÿåœ°éå†æ•°æ®ã€‚å¦‚æœå¸Œæœ›æŒ‰ç…§é¡ºåºéå†æ•£åˆ—è¡¨ä¸­çš„æ•°æ®ï¼Œé‚£æˆ‘ä»¬éœ€è¦å°†æ•£åˆ—è¡¨ä¸­çš„æ•°æ®æ‹·è´åˆ°æ•°ç»„ä¸­ï¼Œç„¶åæ’åºï¼Œå†éå†ã€‚\n\nå› ä¸ºæ•£åˆ—è¡¨æ˜¯åŠ¨æ€æ•°æ®ç»“æ„ï¼Œä¸åœåœ°æœ‰æ•°æ®çš„æ’å…¥ã€åˆ é™¤ï¼Œæ‰€ä»¥æ¯å½“æˆ‘ä»¬å¸Œæœ›æŒ‰é¡ºåºéå†æ•£åˆ—è¡¨ä¸­çš„æ•°æ®çš„æ—¶å€™ï¼Œéƒ½éœ€è¦å…ˆæ’åºï¼Œé‚£æ•ˆç‡åŠ¿å¿…ä¼šå¾ˆä½ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†æ•£åˆ—è¡¨å’Œé“¾è¡¨ï¼ˆæˆ–è€…è·³è¡¨ï¼‰ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ã€‚\n\n## **äºŒå‰æ ‘**\n\næ ‘ã€‚å…³äºæ ‘ï¼Œæœ‰å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„æ¦‚å¿µä½ éœ€è¦æŒæ¡ï¼Œé‚£å°±æ˜¯ï¼šæ ¹èŠ‚ç‚¹ã€å¶å­èŠ‚ç‚¹ã€çˆ¶èŠ‚ç‚¹ã€å­èŠ‚ç‚¹ã€å…„å¼ŸèŠ‚ç‚¹ï¼Œè¿˜æœ‰èŠ‚ç‚¹çš„é«˜åº¦ã€æ·±åº¦ã€å±‚æ•°ï¼Œä»¥åŠæ ‘çš„é«˜åº¦ã€‚\n\næˆ‘ä»¬å¹³æ—¶æœ€å¸¸ç”¨çš„æ ‘å°±æ˜¯äºŒå‰æ ‘ã€‚äºŒå‰æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯å·¦å­èŠ‚ç‚¹å’Œå³å­èŠ‚ç‚¹ã€‚äºŒå‰æ ‘ä¸­ï¼Œæœ‰ä¸¤ç§æ¯”è¾ƒç‰¹æ®Šçš„æ ‘ï¼Œåˆ†åˆ«æ˜¯æ»¡äºŒå‰æ ‘å’Œå®Œå…¨äºŒå‰æ ‘ã€‚æ»¡äºŒå‰æ ‘åˆæ˜¯å®Œå…¨äºŒå‰æ ‘çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚\n\näºŒå‰æ ‘æ—¢å¯ä»¥ç”¨é“¾å¼å­˜å‚¨ï¼Œä¹Ÿå¯ä»¥ç”¨æ•°ç»„é¡ºåºå­˜å‚¨ã€‚æ•°ç»„é¡ºåºå­˜å‚¨çš„æ–¹å¼æ¯”è¾ƒé€‚åˆå®Œå…¨äºŒå‰æ ‘ï¼Œå…¶ä»–ç±»å‹çš„äºŒå‰æ ‘ç”¨æ•°ç»„å­˜å‚¨ä¼šæ¯”è¾ƒæµªè´¹å­˜å‚¨ç©ºé—´ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒäºŒå‰æ ‘é‡Œéå¸¸é‡è¦çš„æ“ä½œå°±æ˜¯å‰ã€ä¸­ã€ååºéå†æ“ä½œï¼Œéå†çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Œä½ éœ€è¦ç†è§£å¹¶èƒ½ç”¨é€’å½’ä»£ç æ¥å®ç°ã€‚\n\n---\n\näºŒå‰æŸ¥æ‰¾æ ‘æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æ ‘ï¼Œå®ƒæ”¯æŒå¿«é€Ÿåœ°æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤æ“ä½œã€‚\n\näºŒå‰æŸ¥æ‰¾æ ‘ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºå·¦å­æ ‘èŠ‚ç‚¹çš„å€¼ï¼Œå°äºå³å­æ ‘èŠ‚ç‚¹çš„å€¼ã€‚ä¸è¿‡ï¼Œè¿™åªæ˜¯é’ˆå¯¹æ²¡æœ‰é‡å¤æ•°æ®çš„æƒ…å†µã€‚å¯¹äºå­˜åœ¨é‡å¤æ•°æ®çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæˆ‘ä»‹ç»äº†ä¸¤ç§æ„å»ºæ–¹æ³•ï¼Œä¸€ç§æ˜¯è®©æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨å¤šä¸ªå€¼ç›¸åŒçš„æ•°æ®ï¼›å¦ä¸€ç§æ˜¯ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸­å­˜å‚¨ä¸€ä¸ªæ•°æ®ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åªéœ€è¦ç¨åŠ æ”¹é€ åŸæ¥çš„æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œå³å¯ã€‚\n\nåœ¨äºŒå‰æŸ¥æ‰¾æ ‘ä¸­ï¼ŒæŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤ç­‰å¾ˆå¤šæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½è·Ÿæ ‘çš„é«˜åº¦æˆæ­£æ¯”ã€‚ä¸¤ä¸ªæç«¯æƒ…å†µçš„æ—¶é—´å¤æ‚åº¦åˆ†åˆ«æ˜¯ O(n) å’Œ O(logn)ï¼Œåˆ†åˆ«å¯¹åº”äºŒå‰æ ‘é€€åŒ–æˆé“¾è¡¨çš„æƒ…å†µå’Œå®Œå…¨äºŒå‰æ ‘ã€‚\n\nä¸ºäº†é¿å…æ—¶é—´å¤æ‚åº¦çš„é€€åŒ–ï¼Œé’ˆå¯¹äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæˆ‘ä»¬åˆè®¾è®¡äº†ä¸€ç§æ›´åŠ å¤æ‚çš„æ ‘ï¼Œå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ—¶é—´å¤æ‚åº¦å¯ä»¥åšåˆ°ç¨³å®šçš„ O(logn)ã€‚\n\n## **çº¢é»‘æ ‘**\n\n**æˆ‘ä»¬å­¦ä¹ æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œè¦å­¦ä¹ å®ƒçš„ç”±æ¥ã€ç‰¹æ€§ã€é€‚ç”¨çš„åœºæ™¯ä»¥åŠå®ƒèƒ½è§£å†³çš„é—®é¢˜ã€‚å¯¹äºçº¢é»‘æ ‘ï¼Œä¹Ÿä¸ä¾‹å¤–ã€‚ä½ å¦‚æœèƒ½ææ‡‚è¿™å‡ ä¸ªé—®é¢˜ï¼Œå…¶å®å°±å·²ç»è¶³å¤Ÿäº†ã€‚**\n\nçº¢é»‘æ ‘æ˜¯ä¸€ç§å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ã€‚å®ƒæ˜¯ä¸ºäº†è§£å†³æ™®é€šäºŒå‰æŸ¥æ‰¾æ ‘åœ¨æ•°æ®æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œå¤æ‚åº¦é€€åŒ–çš„é—®é¢˜è€Œäº§ç”Ÿçš„ã€‚çº¢é»‘æ ‘çš„é«˜åº¦è¿‘ä¼¼ log2nï¼Œæ‰€ä»¥å®ƒæ˜¯è¿‘ä¼¼å¹³è¡¡ï¼Œæ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logn)ã€‚\n\nå› ä¸ºçº¢é»‘æ ‘æ˜¯ä¸€ç§æ€§èƒ½éå¸¸ç¨³å®šçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ‰€ä»¥ï¼Œåœ¨å·¥ç¨‹ä¸­ï¼Œä½†å‡¡æ˜¯ç”¨åˆ°åŠ¨æ€æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ•°æ®çš„åœºæ™¯ï¼Œéƒ½å¯ä»¥ç”¨åˆ°å®ƒã€‚ä¸è¿‡ï¼Œå®ƒå®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œå¦‚æœè‡ªå·±å†™ä»£ç å®ç°ï¼Œéš¾åº¦ä¼šæœ‰äº›é«˜ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å…¶å®æ›´å€¾å‘ç”¨è·³è¡¨æ¥æ›¿ä»£å®ƒã€‚\n\n## **å †**\n\nå †æ˜¯ä¸€ç§å®Œå…¨äºŒå‰æ ‘ã€‚å®ƒæœ€å¤§çš„ç‰¹æ€§æ˜¯ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºç­‰äºï¼ˆæˆ–å°äºç­‰äºï¼‰å…¶å­æ ‘èŠ‚ç‚¹çš„å€¼ã€‚å› æ­¤ï¼Œå †è¢«åˆ†æˆäº†ä¸¤ç±»ï¼Œå¤§é¡¶å †å’Œå°é¡¶å †ã€‚\n\nå †ä¸­æ¯”è¾ƒé‡è¦çš„ä¸¤ä¸ªæ“ä½œæ˜¯æ’å…¥ä¸€ä¸ªæ•°æ®å’Œåˆ é™¤å †é¡¶å…ƒç´ ã€‚è¿™ä¸¤ä¸ªæ“ä½œéƒ½è¦ç”¨åˆ°å †åŒ–ã€‚æ’å…¥ä¸€ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠæ–°æ’å…¥çš„æ•°æ®æ”¾åˆ°æ•°ç»„çš„æœ€åï¼Œç„¶åä»ä¸‹å¾€ä¸Šå †åŒ–ï¼›åˆ é™¤å †é¡¶æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠæ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ æ”¾åˆ°å †é¡¶ï¼Œç„¶åä»ä¸Šå¾€ä¸‹å †åŒ–ã€‚è¿™ä¸¤ä¸ªæ“ä½œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logn)ã€‚\n\né™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è®²äº†å †çš„ä¸€ä¸ªç»å…¸åº”ç”¨ï¼Œå †æ’åºã€‚å †æ’åºåŒ…å«ä¸¤ä¸ªè¿‡ç¨‹ï¼Œå»ºå †å’Œæ’åºã€‚æˆ‘ä»¬å°†ä¸‹æ ‡ä» n/2 åˆ° 1 çš„èŠ‚ç‚¹ï¼Œä¾æ¬¡è¿›è¡Œä»ä¸Šåˆ°ä¸‹çš„å †åŒ–æ“ä½œï¼Œç„¶åå°±å¯ä»¥å°†æ•°ç»„ä¸­çš„æ•°æ®ç»„ç»‡æˆå †è¿™ç§æ•°æ®ç»“æ„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿­ä»£åœ°å°†å †é¡¶çš„å…ƒç´ æ”¾åˆ°å †çš„æœ«å°¾ï¼Œå¹¶å°†å †çš„å¤§å°å‡ä¸€ï¼Œç„¶åå†å †åŒ–ï¼Œé‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°å †ä¸­åªå‰©ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œæ•´ä¸ªæ•°ç»„ä¸­çš„æ•°æ®å°±éƒ½æœ‰åºæ’åˆ—äº†ã€‚\n\n### å †çš„åº”ç”¨\n\nä¼˜å…ˆçº§é˜Ÿåˆ—ã€æ±‚ Top K é—®é¢˜å’Œæ±‚ä¸­ä½æ•°é—®é¢˜ã€‚\n\nä¼˜å…ˆçº§é˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—ï¼Œä¼˜å…ˆçº§é«˜çš„æ•°æ®å…ˆå‡ºé˜Ÿï¼Œè€Œä¸å†åƒæ™®é€šçš„é˜Ÿåˆ—é‚£æ ·ï¼Œå…ˆè¿›å…ˆå‡ºã€‚å®é™…ä¸Šï¼Œå †å°±å¯ä»¥çœ‹ä½œä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œåªæ˜¯ç§°è°“ä¸ä¸€æ ·ç½¢äº†ã€‚æ±‚ Top K é—®é¢˜åˆå¯ä»¥åˆ†ä¸ºé’ˆå¯¹é™æ€æ•°æ®å’Œé’ˆå¯¹åŠ¨æ€æ•°æ®ï¼Œåªéœ€è¦åˆ©ç”¨ä¸€ä¸ªå †ï¼Œå°±å¯ä»¥åšåˆ°éå¸¸é«˜æ•ˆç‡åœ°æŸ¥è¯¢ Top K çš„æ•°æ®ã€‚æ±‚ä¸­ä½æ•°å®é™…ä¸Šè¿˜æœ‰å¾ˆå¤šå˜å½¢ï¼Œæ¯”å¦‚æ±‚ 99 ç™¾åˆ†ä½æ•°æ®ã€90 ç™¾åˆ†ä½æ•°æ®ç­‰ï¼Œå¤„ç†çš„æ€è·¯éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå³åˆ©ç”¨ä¸¤ä¸ªå †ï¼Œä¸€ä¸ªå¤§é¡¶å †ï¼Œä¸€ä¸ªå°é¡¶å †ï¼Œéšç€æ•°æ®çš„åŠ¨æ€æ·»åŠ ï¼ŒåŠ¨æ€è°ƒæ•´ä¸¤ä¸ªå †ä¸­çš„æ•°æ®ï¼Œæœ€åå¤§é¡¶å †çš„å †é¡¶å…ƒç´ å°±æ˜¯è¦æ±‚çš„æ•°æ®ã€‚\n\n## **å›¾**\n\nå…³äºå›¾ï¼Œä½ éœ€è¦ç†è§£è¿™æ ·å‡ ä¸ªæ¦‚å¿µï¼šæ— å‘å›¾ã€æœ‰å‘å›¾ã€å¸¦æƒå›¾ã€é¡¶ç‚¹ã€è¾¹ã€åº¦ã€å…¥åº¦ã€å‡ºåº¦ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å­¦ä¹ äº†å›¾çš„ä¸¤ä¸ªä¸»è¦çš„å­˜å‚¨æ–¹å¼ï¼šé‚»æ¥çŸ©é˜µå’Œé‚»æ¥è¡¨ã€‚\n\né‚»æ¥çŸ©é˜µå­˜å‚¨æ–¹æ³•çš„ç¼ºç‚¹æ˜¯æ¯”è¾ƒæµªè´¹ç©ºé—´ï¼Œä½†æ˜¯ä¼˜ç‚¹æ˜¯æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œè€Œä¸”æ–¹ä¾¿çŸ©é˜µè¿ç®—ã€‚é‚»æ¥è¡¨å­˜å‚¨æ–¹æ³•ä¸­æ¯ä¸ªé¡¶ç‚¹éƒ½å¯¹åº”ä¸€ä¸ªé“¾è¡¨ï¼Œå­˜å‚¨ä¸å…¶ç›¸è¿æ¥çš„å…¶ä»–é¡¶ç‚¹ã€‚å°½ç®¡é‚»æ¥è¡¨çš„å­˜å‚¨æ–¹å¼æ¯”è¾ƒèŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œä½†é“¾è¡¨ä¸æ–¹ä¾¿æŸ¥æ‰¾ï¼Œæ‰€ä»¥æŸ¥è¯¢æ•ˆç‡æ²¡æœ‰é‚»æ¥çŸ©é˜µå­˜å‚¨æ–¹å¼é«˜ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œé‚»æ¥è¡¨è¿˜æœ‰æ”¹è¿›å‡çº§ç‰ˆï¼Œå³å°†é“¾è¡¨æ¢æˆæ›´åŠ é«˜æ•ˆçš„åŠ¨æ€æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ã€è·³è¡¨ã€æ•£åˆ—è¡¨ç­‰ã€‚\n\n## Trie æ ‘\n\nTrie æ ‘æ˜¯ä¸€ç§è§£å†³å­—ç¬¦ä¸²å¿«é€ŸåŒ¹é…é—®é¢˜çš„æ•°æ®ç»“æ„ã€‚å¦‚æœç”¨æ¥æ„å»º Trie æ ‘çš„è¿™ä¸€ç»„å­—ç¬¦ä¸²ä¸­ï¼Œå‰ç¼€é‡å¤çš„æƒ…å†µä¸æ˜¯å¾ˆå¤šï¼Œé‚£ Trie æ ‘è¿™ç§æ•°æ®ç»“æ„æ€»ä½“ä¸Šæ¥è®²æ˜¯æ¯”è¾ƒè´¹å†…å­˜çš„ï¼Œæ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„è§£å†³é—®é¢˜æ€è·¯ã€‚\n\nå°½ç®¡æ¯”è¾ƒè€—è´¹å†…å­˜ï¼Œä½†æ˜¯å¯¹å†…å­˜ä¸æ•æ„Ÿæˆ–è€…å†…å­˜æ¶ˆè€—åœ¨æ¥å—èŒƒå›´å†…çš„æƒ…å†µä¸‹ï¼Œåœ¨ Trie æ ‘ä¸­åšå­—ç¬¦ä¸²åŒ¹é…è¿˜æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(k)ï¼Œk è¡¨ç¤ºè¦åŒ¹é…çš„å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚\n\nä½†æ˜¯ï¼ŒTrie æ ‘çš„ä¼˜åŠ¿å¹¶ä¸åœ¨äºï¼Œç”¨å®ƒæ¥åšåŠ¨æ€é›†åˆæ•°æ®çš„æŸ¥æ‰¾ï¼Œå› ä¸ºï¼Œè¿™ä¸ªå·¥ä½œå®Œå…¨å¯ä»¥ç”¨æ›´åŠ åˆé€‚çš„æ•£åˆ—è¡¨æˆ–è€…çº¢é»‘æ ‘æ¥æ›¿ä»£ã€‚Trie æ ‘æœ€æœ‰ä¼˜åŠ¿çš„æ˜¯æŸ¥æ‰¾å‰ç¼€åŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚æœç´¢å¼•æ“ä¸­çš„å…³é”®è¯æç¤ºåŠŸèƒ½è¿™ä¸ªåœºæ™¯ï¼Œå°±æ¯”è¾ƒé€‚åˆç”¨å®ƒæ¥è§£å†³ï¼Œä¹Ÿæ˜¯ Trie æ ‘æ¯”è¾ƒç»å…¸çš„åº”ç”¨åœºæ™¯ã€‚\n\n# ç®—æ³•\n\n## é€’å½’\n\né€’å½’æ˜¯ä¸€ç§éå¸¸é«˜æ•ˆã€ç®€æ´çš„ç¼–ç æŠ€å·§ã€‚åªè¦æ˜¯æ»¡è¶³â€œä¸‰ä¸ªæ¡ä»¶â€çš„é—®é¢˜å°±å¯ä»¥é€šè¿‡é€’å½’ä»£ç æ¥è§£å†³ã€‚\n\nä¸è¿‡é€’å½’ä»£ç ä¹Ÿæ¯”è¾ƒéš¾å†™ã€éš¾ç†è§£ã€‚ç¼–å†™é€’å½’ä»£ç çš„å…³é”®å°±æ˜¯ä¸è¦æŠŠè‡ªå·±ç»•è¿›å»ï¼Œæ­£ç¡®å§¿åŠ¿æ˜¯å†™å‡ºé€’æ¨å…¬å¼ï¼Œæ‰¾å‡ºç»ˆæ­¢æ¡ä»¶ï¼Œç„¶åå†ç¿»è¯‘æˆé€’å½’ä»£ç ã€‚\n\né€’å½’ä»£ç è™½ç„¶ç®€æ´é«˜æ•ˆï¼Œä½†æ˜¯ï¼Œé€’å½’ä»£ç ä¹Ÿæœ‰å¾ˆå¤šå¼Šç«¯ã€‚æ¯”å¦‚ï¼Œå †æ ˆæº¢å‡ºã€é‡å¤è®¡ç®—ã€å‡½æ•°è°ƒç”¨è€—æ—¶å¤šã€ç©ºé—´å¤æ‚åº¦é«˜ç­‰ï¼Œæ‰€ä»¥ï¼Œåœ¨ç¼–å†™é€’å½’ä»£ç çš„æ—¶å€™ï¼Œä¸€å®šè¦æ§åˆ¶å¥½è¿™äº›å‰¯ä½œç”¨ã€‚\n\n## **æ’åº**\n\n![Untitled](Extras/Images/alg_sum.png)\n\nè¿™ä¸‰ç§æ—¶é—´å¤æ‚åº¦ä¸º O(n2) çš„æ’åºç®—æ³•ä¸­ï¼Œå†’æ³¡æ’åºã€é€‰æ‹©æ’åºï¼Œå¯èƒ½å°±çº¯ç²¹åœç•™åœ¨ç†è®ºçš„å±‚é¢äº†ï¼Œå­¦ä¹ çš„ç›®çš„ä¹Ÿåªæ˜¯ä¸ºäº†å¼€æ‹“æ€ç»´ï¼Œå®é™…å¼€å‘ä¸­åº”ç”¨å¹¶ä¸å¤šï¼Œä½†æ˜¯æ’å…¥æ’åºè¿˜æ˜¯æŒºæœ‰ç”¨çš„ã€‚åé¢è®²æ’åºä¼˜åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä¼šè®²åˆ°ï¼Œæœ‰äº›ç¼–ç¨‹è¯­è¨€ä¸­çš„æ’åºå‡½æ•°çš„å®ç°åŸç†ä¼šç”¨åˆ°æ’å…¥æ’åºç®—æ³•ã€‚\n\nè¿™ä¸‰ç§æ’åºç®—æ³•ï¼Œå®ç°ä»£ç éƒ½éå¸¸ç®€å•ï¼Œå¯¹äºå°è§„æ¨¡æ•°æ®çš„æ’åºï¼Œç”¨èµ·æ¥éå¸¸é«˜æ•ˆã€‚ä½†æ˜¯åœ¨å¤§è§„æ¨¡æ•°æ®æ’åºçš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶é—´å¤æ‚åº¦è¿˜æ˜¯ç¨å¾®æœ‰ç‚¹é«˜ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´å€¾å‘äºç”¨ä¸‹é¢è¦è®²çš„æ—¶é—´å¤æ‚åº¦ä¸º O(nlogn) çš„æ’åºç®—æ³•ã€‚\n\n---\n\nå½’å¹¶æ’åºå’Œå¿«é€Ÿæ’åºæ˜¯ä¸¤ç§ç¨å¾®å¤æ‚çš„æ’åºç®—æ³•ï¼Œå®ƒä»¬ç”¨çš„éƒ½æ˜¯åˆ†æ²»çš„æ€æƒ³ï¼Œä»£ç éƒ½é€šè¿‡é€’å½’æ¥å®ç°ï¼Œè¿‡ç¨‹éå¸¸ç›¸ä¼¼ã€‚ç†è§£å½’å¹¶æ’åºçš„é‡ç‚¹æ˜¯ç†è§£é€’æ¨å…¬å¼å’Œ merge() åˆå¹¶å‡½æ•°ã€‚åŒç†ï¼Œç†è§£å¿«æ’çš„é‡ç‚¹ä¹Ÿæ˜¯ç†è§£é€’æ¨å…¬å¼ï¼Œè¿˜æœ‰ partition() åˆ†åŒºå‡½æ•°ã€‚\n\nå½’å¹¶æ’åºç®—æ³•æ˜¯ä¸€ç§åœ¨ä»»ä½•æƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦éƒ½æ¯”è¾ƒç¨³å®šçš„æ’åºç®—æ³•ï¼Œè¿™ä¹Ÿä½¿å®ƒå­˜åœ¨è‡´å‘½çš„ç¼ºç‚¹ï¼Œå³å½’å¹¶æ’åºä¸æ˜¯åŸåœ°æ’åºç®—æ³•ï¼Œç©ºé—´å¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œæ˜¯ O(n)ã€‚æ­£å› ä¸ºæ­¤ï¼Œå®ƒä¹Ÿæ²¡æœ‰å¿«æ’åº”ç”¨å¹¿æ³›ã€‚\n\nå¿«é€Ÿæ’åºç®—æ³•è™½ç„¶æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n2)ï¼Œä½†æ˜¯å¹³å‡æƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(nlogn)ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå¿«é€Ÿæ’åºç®—æ³•æ—¶é—´å¤æ‚åº¦é€€åŒ–åˆ° O(n2) çš„æ¦‚ç‡éå¸¸å°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆç†åœ°é€‰æ‹© pivot æ¥é¿å…è¿™ç§æƒ…å†µã€‚\n\n## **çº¿æ€§æ’åº**\n\n3 ç§çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„æ’åºç®—æ³•ï¼Œæœ‰æ¡¶æ’åºã€è®¡æ•°æ’åºã€åŸºæ•°æ’åºã€‚å®ƒä»¬å¯¹è¦æ’åºçš„æ•°æ®éƒ½æœ‰æ¯”è¾ƒè‹›åˆ»çš„è¦æ±‚ï¼Œåº”ç”¨ä¸æ˜¯éå¸¸å¹¿æ³›ã€‚ä½†æ˜¯å¦‚æœæ•°æ®ç‰¹å¾æ¯”è¾ƒç¬¦åˆè¿™äº›æ’åºç®—æ³•çš„è¦æ±‚ï¼Œåº”ç”¨è¿™äº›ç®—æ³•ï¼Œä¼šéå¸¸é«˜æ•ˆï¼Œçº¿æ€§æ—¶é—´å¤æ‚åº¦å¯ä»¥è¾¾åˆ° O(n)ã€‚\n\næ¡¶æ’åºå’Œè®¡æ•°æ’åºçš„æ’åºæ€æƒ³æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œéƒ½æ˜¯é’ˆå¯¹èŒƒå›´ä¸å¤§çš„æ•°æ®ï¼Œå°†æ•°æ®åˆ’åˆ†æˆä¸åŒçš„æ¡¶æ¥å®ç°æ’åºã€‚åŸºæ•°æ’åºè¦æ±‚æ•°æ®å¯ä»¥åˆ’åˆ†æˆé«˜ä½ä½ï¼Œä½ä¹‹é—´æœ‰é€’è¿›å…³ç³»ã€‚æ¯”è¾ƒä¸¤ä¸ªæ•°ï¼Œæˆ‘ä»¬åªéœ€è¦æ¯”è¾ƒé«˜ä½ï¼Œé«˜ä½ç›¸åŒçš„å†æ¯”è¾ƒä½ä½ã€‚è€Œä¸”æ¯ä¸€ä½çš„æ•°æ®èŒƒå›´ä¸èƒ½å¤ªå¤§ï¼Œå› ä¸ºåŸºæ•°æ’åºç®—æ³•éœ€è¦å€ŸåŠ©æ¡¶æ’åºæˆ–è€…è®¡æ•°æ’åºæ¥å®Œæˆæ¯ä¸€ä¸ªä½çš„æ’åºå·¥ä½œã€‚\n\n## **æ’åºä¼˜åŒ–**\n\n![Untitled](Extras/Images/alg_sum_1.png)\n\nå¤§éƒ¨åˆ†æ’åºå‡½æ•°éƒ½æ˜¯é‡‡ç”¨ O(nlogn) æ’åºç®—æ³•æ¥å®ç°ï¼Œä½†æ˜¯ä¸ºäº†å°½å¯èƒ½åœ°æé«˜æ€§èƒ½ï¼Œä¼šåšå¾ˆå¤šä¼˜åŒ–ã€‚è¿˜ç€é‡è®²äº†å¿«é€Ÿæ’åºçš„ä¸€äº›ä¼˜åŒ–ç­–ç•¥ï¼Œæ¯”å¦‚åˆç†é€‰æ‹©åˆ†åŒºç‚¹ã€é¿å…é€’å½’å¤ªæ·±ç­‰ç­‰ã€‚\n\n## **äºŒåˆ†æŸ¥æ‰¾**\n\né’ˆå¯¹æœ‰åºæ•°æ®çš„é«˜æ•ˆæŸ¥æ‰¾ç®—æ³•ï¼ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå®ƒçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ã€‚\n\näºŒåˆ†æŸ¥æ‰¾çš„æ ¸å¿ƒæ€æƒ³ç†è§£èµ·æ¥éå¸¸ç®€å•ï¼Œæœ‰ç‚¹ç±»ä¼¼åˆ†æ²»æ€æƒ³ã€‚å³æ¯æ¬¡éƒ½é€šè¿‡è·ŸåŒºé—´ä¸­çš„ä¸­é—´å…ƒç´ å¯¹æ¯”ï¼Œå°†å¾…æŸ¥æ‰¾çš„åŒºé—´ç¼©å°ä¸ºä¸€åŠï¼Œç›´åˆ°æ‰¾åˆ°è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œæˆ–è€…åŒºé—´è¢«ç¼©å°ä¸º 0ã€‚ä½†æ˜¯äºŒåˆ†æŸ¥æ‰¾çš„ä»£ç å®ç°æ¯”è¾ƒå®¹æ˜“å†™é”™ã€‚ä½ éœ€è¦ç€é‡æŒæ¡å®ƒçš„ä¸‰ä¸ªå®¹æ˜“å‡ºé”™çš„åœ°æ–¹ï¼šå¾ªç¯é€€å‡ºæ¡ä»¶ã€mid çš„å–å€¼ï¼Œlow å’Œ high çš„æ›´æ–°ã€‚\n\näºŒåˆ†æŸ¥æ‰¾è™½ç„¶æ€§èƒ½æ¯”è¾ƒä¼˜ç§€ï¼Œä½†åº”ç”¨åœºæ™¯ä¹Ÿæ¯”è¾ƒæœ‰é™ã€‚åº•å±‚å¿…é¡»ä¾èµ–æ•°ç»„ï¼Œå¹¶ä¸”è¿˜è¦æ±‚æ•°æ®æ˜¯æœ‰åºçš„ã€‚å¯¹äºè¾ƒå°è§„æ¨¡çš„æ•°æ®æŸ¥æ‰¾ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨é¡ºåºéå†å°±å¯ä»¥äº†ï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„ä¼˜åŠ¿å¹¶ä¸æ˜æ˜¾ã€‚äºŒåˆ†æŸ¥æ‰¾æ›´é€‚åˆå¤„ç†é™æ€æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰é¢‘ç¹çš„æ•°æ®æ’å…¥ã€åˆ é™¤æ“ä½œã€‚\n\n---\n\n![Untitled](Extras/Images/alg_sum_2.png)\n\nå‡¡æ˜¯ç”¨äºŒåˆ†æŸ¥æ‰¾èƒ½è§£å†³çš„ï¼Œç»å¤§éƒ¨åˆ†æˆ‘ä»¬æ›´å€¾å‘äºç”¨æ•£åˆ—è¡¨æˆ–è€…äºŒå‰æŸ¥æ‰¾æ ‘ã€‚å³ä¾¿æ˜¯äºŒåˆ†æŸ¥æ‰¾åœ¨å†…å­˜ä½¿ç”¨ä¸Šæ›´èŠ‚çœï¼Œä½†æ˜¯æ¯•ç«Ÿå†…å­˜å¦‚æ­¤ç´§ç¼ºçš„æƒ…å†µå¹¶ä¸å¤šã€‚é‚£äºŒåˆ†æŸ¥æ‰¾çœŸçš„æ²¡ä»€ä¹ˆç”¨å¤„äº†å—ï¼Ÿ\n\nå®é™…ä¸Šï¼Œä¹‹å‰è®²çš„æ±‚â€œå€¼ç­‰äºç»™å®šå€¼â€çš„äºŒåˆ†æŸ¥æ‰¾ç¡®å®ä¸æ€ä¹ˆä¼šè¢«ç”¨åˆ°ï¼ŒäºŒåˆ†æŸ¥æ‰¾æ›´é€‚åˆç”¨åœ¨â€œè¿‘ä¼¼â€æŸ¥æ‰¾é—®é¢˜ï¼Œåœ¨è¿™ç±»é—®é¢˜ä¸Šï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„ä¼˜åŠ¿æ›´åŠ æ˜æ˜¾ã€‚æ¯”å¦‚å‡ ç§å˜ä½“é—®é¢˜ï¼Œç”¨å…¶ä»–æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚æ•£åˆ—è¡¨ã€äºŒå‰æ ‘ï¼Œå°±æ¯”è¾ƒéš¾å®ç°äº†ã€‚\n\nå˜ä½“çš„äºŒåˆ†æŸ¥æ‰¾ç®—æ³•å†™èµ·æ¥éå¸¸çƒ§è„‘ï¼Œå¾ˆå®¹æ˜“å› ä¸ºç»†èŠ‚å¤„ç†ä¸å¥½è€Œäº§ç”Ÿ Bugï¼Œè¿™äº›å®¹æ˜“å‡ºé”™çš„ç»†èŠ‚æœ‰ï¼š**ç»ˆæ­¢æ¡ä»¶ã€åŒºé—´ä¸Šä¸‹ç•Œæ›´æ–°æ–¹æ³•ã€è¿”å›å€¼é€‰æ‹©ã€‚**\n\n## **å“ˆå¸Œç®—æ³•**\n\nå“ˆå¸Œç®—æ³•çš„å››ä¸ªåº”ç”¨åœºæ™¯ã€‚\n\nç¬¬ä¸€ä¸ªåº”ç”¨æ˜¯å”¯ä¸€æ ‡è¯†ï¼Œå“ˆå¸Œç®—æ³•å¯ä»¥å¯¹å¤§æ•°æ®åšä¿¡æ¯æ‘˜è¦ï¼Œé€šè¿‡ä¸€ä¸ªè¾ƒçŸ­çš„äºŒè¿›åˆ¶ç¼–ç æ¥è¡¨ç¤ºå¾ˆå¤§çš„æ•°æ®ã€‚\n\nç¬¬äºŒä¸ªåº”ç”¨æ˜¯ç”¨äºæ ¡éªŒæ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ã€‚\n\nç¬¬ä¸‰ä¸ªåº”ç”¨æ˜¯å®‰å…¨åŠ å¯†ï¼Œæˆ‘ä»¬è®²åˆ°ä»»ä½•å“ˆå¸Œç®—æ³•éƒ½ä¼šå‡ºç°æ•£åˆ—å†²çªï¼Œä½†æ˜¯è¿™ä¸ªå†²çªæ¦‚ç‡éå¸¸å°ã€‚è¶Šæ˜¯å¤æ‚å“ˆå¸Œç®—æ³•è¶Šéš¾ç ´è§£ï¼Œä½†åŒæ ·è®¡ç®—æ—¶é—´ä¹Ÿå°±è¶Šé•¿ã€‚æ‰€ä»¥ï¼Œé€‰æ‹©å“ˆå¸Œç®—æ³•çš„æ—¶å€™ï¼Œè¦æƒè¡¡å®‰å…¨æ€§å’Œè®¡ç®—æ—¶é—´æ¥å†³å®šç”¨å“ªç§å“ˆå¸Œç®—æ³•ã€‚\n\nç¬¬å››ä¸ªåº”ç”¨æ˜¯æ•£åˆ—å‡½æ•°ï¼Œè¿™ä¸ªæˆ‘ä»¬å‰é¢è®²æ•£åˆ—è¡¨çš„æ—¶å€™å·²ç»è¯¦ç»†åœ°è®²è¿‡ï¼Œå®ƒå¯¹å“ˆå¸Œç®—æ³•çš„è¦æ±‚éå¸¸ç‰¹åˆ«ï¼Œæ›´åŠ çœ‹é‡çš„æ˜¯æ•£åˆ—çš„å¹³å‡æ€§å’Œå“ˆå¸Œç®—æ³•çš„æ‰§è¡Œæ•ˆç‡ã€‚\n\n---\n\nä¸‰ç§å“ˆå¸Œç®—æ³•åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šè´Ÿè½½å‡è¡¡ã€æ•°æ®åˆ†ç‰‡ã€åˆ†å¸ƒå¼å­˜å‚¨ã€‚\n\nåœ¨è´Ÿè½½å‡è¡¡åº”ç”¨ä¸­ï¼Œåˆ©ç”¨å“ˆå¸Œç®—æ³•æ›¿ä»£æ˜ å°„è¡¨ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªä¼šè¯ç²˜æ»çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚åœ¨æ•°æ®åˆ†ç‰‡åº”ç”¨ä¸­ï¼Œé€šè¿‡å“ˆå¸Œç®—æ³•å¯¹å¤„ç†çš„æµ·é‡æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œå¤šæœºåˆ†å¸ƒå¼å¤„ç†ï¼Œå¯ä»¥çªç ´å•æœºèµ„æºçš„é™åˆ¶ã€‚åœ¨åˆ†å¸ƒå¼å­˜å‚¨åº”ç”¨ä¸­ï¼Œåˆ©ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œå¯ä»¥è§£å†³ç¼“å­˜ç­‰åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ‰©å®¹ã€ç¼©å®¹å¯¼è‡´æ•°æ®å¤§é‡æ¬ç§»çš„éš¾é¢˜ã€‚\n\n## **æ·±åº¦å’Œå¹¿åº¦ä¼˜å…ˆæœç´¢**\n\nå¹¿åº¦ä¼˜å…ˆæœç´¢å’Œæ·±åº¦ä¼˜å…ˆæœç´¢æ˜¯å›¾ä¸Šçš„ä¸¤ç§æœ€å¸¸ç”¨ã€æœ€åŸºæœ¬çš„æœç´¢ç®—æ³•ï¼Œæ¯”èµ·å…¶ä»–é«˜çº§çš„æœç´¢ç®—æ³•ï¼Œæ¯”å¦‚ A*ã€IDA* ç­‰ï¼Œè¦ç®€å•ç²—æš´ï¼Œæ²¡æœ‰ä»€ä¹ˆä¼˜åŒ–ï¼Œæ‰€ä»¥ï¼Œä¹Ÿè¢«å«ä½œæš´åŠ›æœç´¢ç®—æ³•ã€‚æ‰€ä»¥ï¼Œè¿™ä¸¤ç§æœç´¢ç®—æ³•ä»…é€‚ç”¨äºçŠ¶æ€ç©ºé—´ä¸å¤§ï¼Œä¹Ÿå°±æ˜¯è¯´å›¾ä¸å¤§çš„æœç´¢ã€‚\n\nå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Œé€šä¿—çš„ç†è§£å°±æ˜¯ï¼Œåœ°æ¯¯å¼å±‚å±‚æ¨è¿›ï¼Œä»èµ·å§‹é¡¶ç‚¹å¼€å§‹ï¼Œä¾æ¬¡å¾€å¤–éå†ã€‚å¹¿åº¦ä¼˜å…ˆæœç´¢éœ€è¦å€ŸåŠ©é˜Ÿåˆ—æ¥å®ç°ï¼Œéå†å¾—åˆ°çš„è·¯å¾„å°±æ˜¯ï¼Œèµ·å§‹é¡¶ç‚¹åˆ°ç»ˆæ­¢é¡¶ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚æ·±åº¦ä¼˜å…ˆæœç´¢ç”¨çš„æ˜¯å›æº¯æ€æƒ³ï¼Œéå¸¸é€‚åˆç”¨é€’å½’å®ç°ã€‚æ¢ç§è¯´æ³•ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢æ˜¯å€ŸåŠ©æ ˆæ¥å®ç°çš„ã€‚åœ¨æ‰§è¡Œæ•ˆç‡æ–¹é¢ï¼Œæ·±åº¦ä¼˜å…ˆå’Œå¹¿åº¦ä¼˜å…ˆæœç´¢çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(E)ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯ O(V)ã€‚\n\n## **è´ªå¿ƒç®—æ³•**\n\nå®é™…ä¸Šï¼Œè´ªå¿ƒç®—æ³•é€‚ç”¨çš„åœºæ™¯æ¯”è¾ƒæœ‰é™ã€‚è¿™ç§ç®—æ³•æ€æƒ³æ›´å¤šçš„æ˜¯æŒ‡å¯¼è®¾è®¡åŸºç¡€ç®—æ³•ã€‚æ¯”å¦‚æœ€å°ç”Ÿæˆæ ‘ç®—æ³•ã€å•æºæœ€çŸ­è·¯å¾„ç®—æ³•ï¼Œè¿™äº›ç®—æ³•éƒ½ç”¨åˆ°äº†è´ªå¿ƒç®—æ³•ã€‚**ä»æˆ‘ä¸ªäººçš„å­¦ä¹ ç»éªŒæ¥è®²ï¼Œä¸è¦åˆ»æ„å»è®°å¿†è´ªå¿ƒç®—æ³•çš„åŸç†ï¼Œå¤šç»ƒä¹ æ‰æ˜¯æœ€æœ‰æ•ˆçš„å­¦ä¹ æ–¹æ³•ã€‚**\n\nè´ªå¿ƒç®—æ³•çš„æœ€éš¾çš„ä¸€å—æ˜¯å¦‚ä½•å°†è¦è§£å†³çš„é—®é¢˜æŠ½è±¡æˆè´ªå¿ƒç®—æ³•æ¨¡å‹ï¼Œåªè¦è¿™ä¸€æ­¥æå®šä¹‹åï¼Œè´ªå¿ƒç®—æ³•çš„ç¼–ç ä¸€èˆ¬éƒ½å¾ˆç®€å•ã€‚è´ªå¿ƒç®—æ³•è§£å†³é—®é¢˜çš„æ­£ç¡®æ€§è™½ç„¶å¾ˆå¤šæ—¶å€™éƒ½çœ‹èµ·æ¥æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œä½†æ˜¯è¦ä¸¥è°¨åœ°è¯æ˜ç®—æ³•èƒ½å¤Ÿå¾—åˆ°æœ€ä¼˜è§£ï¼Œå¹¶ä¸æ˜¯ä»¶å®¹æ˜“çš„äº‹ã€‚æ‰€ä»¥ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦å¤šä¸¾å‡ ä¸ªä¾‹å­ï¼Œçœ‹ä¸€ä¸‹è´ªå¿ƒç®—æ³•çš„è§£å†³æ–¹æ¡ˆæ˜¯å¦çœŸçš„èƒ½å¾—åˆ°æœ€ä¼˜è§£å°±å¯ä»¥äº†ã€‚\n\n## **åˆ†æ²»ç®—æ³•**\n\nåˆ†æ²»ç®—æ³•ç”¨å››ä¸ªå­—æ¦‚æ‹¬å°±æ˜¯â€œåˆ†è€Œæ²»ä¹‹â€ï¼Œå°†åŸé—®é¢˜åˆ’åˆ†æˆ n ä¸ªè§„æ¨¡è¾ƒå°è€Œç»“æ„ä¸åŸé—®é¢˜ç›¸ä¼¼çš„å­é—®é¢˜ï¼Œé€’å½’åœ°è§£å†³è¿™äº›å­é—®é¢˜ï¼Œç„¶åå†åˆå¹¶å…¶ç»“æœï¼Œå°±å¾—åˆ°åŸé—®é¢˜çš„è§£ã€‚è¿™ä¸ªæ€æƒ³éå¸¸ç®€å•ã€å¥½ç†è§£ã€‚\n\nä»Šå¤©æˆ‘ä»¬è®²äº†ä¸¤ç§åˆ†æ²»ç®—æ³•çš„å…¸å‹çš„åº”ç”¨åœºæ™¯ï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥æŒ‡å¯¼ç¼–ç ï¼Œé™ä½é—®é¢˜æ±‚è§£çš„æ—¶é—´å¤æ‚åº¦ï¼Œå¦ä¸€ä¸ªæ˜¯è§£å†³æµ·é‡æ•°æ®å¤„ç†é—®é¢˜ã€‚æ¯”å¦‚ MapReduce æœ¬è´¨ä¸Šå°±æ˜¯åˆ©ç”¨äº†åˆ†æ²»æ€æƒ³ã€‚\n\n## **å›æº¯ç®—æ³•**\n\nå›æº¯ç®—æ³•çš„æ€æƒ³éå¸¸ç®€å•ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ç”¨æ¥è§£å†³å¹¿ä¹‰çš„æœç´¢é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ï¼Œä»ä¸€ç»„å¯èƒ½çš„è§£ä¸­ï¼Œé€‰æ‹©å‡ºä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„è§£ã€‚å›æº¯ç®—æ³•éå¸¸é€‚åˆç”¨é€’å½’æ¥å®ç°ï¼Œåœ¨å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œå‰ªææ“ä½œæ˜¯æé«˜å›æº¯æ•ˆç‡çš„ä¸€ç§æŠ€å·§ã€‚åˆ©ç”¨å‰ªæï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ç©·ä¸¾æœç´¢æ‰€æœ‰çš„æƒ…å†µï¼Œä»è€Œæé«˜æœç´¢æ•ˆç‡ã€‚\n\nå°½ç®¡å›æº¯ç®—æ³•çš„åŸç†éå¸¸ç®€å•ï¼Œä½†æ˜¯å´å¯ä»¥è§£å†³å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬å¼€å¤´æåˆ°çš„æ·±åº¦ä¼˜å…ˆæœç´¢ã€å…«çš‡åã€0-1 èƒŒåŒ…é—®é¢˜ã€å›¾çš„ç€è‰²ã€æ—…è¡Œå•†é—®é¢˜ã€æ•°ç‹¬ã€å…¨æ’åˆ—ã€æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç­‰ç­‰ã€‚å¦‚æœæ„Ÿå…´è¶£çš„è¯ï¼Œä½ å¯ä»¥è‡ªå·±æœç´¢ç ”ç©¶ä¸€ä¸‹ï¼Œæœ€å¥½è¿˜èƒ½ç”¨ä»£ç å®ç°ä¸€ä¸‹ã€‚å¦‚æœè¿™å‡ ä¸ªé—®é¢˜éƒ½èƒ½å®ç°çš„è¯ï¼Œä½ åŸºæœ¬å°±æŒæ¡äº†å›æº¯ç®—æ³•ã€‚\n\n## **åŠ¨æ€è§„åˆ’**\n\nå¤§éƒ¨åˆ†åŠ¨æ€è§„åˆ’èƒ½è§£å†³çš„é—®é¢˜ï¼Œéƒ½å¯ä»¥é€šè¿‡å›æº¯ç®—æ³•æ¥è§£å†³ï¼Œåªä¸è¿‡å›æº¯ç®—æ³•è§£å†³èµ·æ¥æ•ˆç‡æ¯”è¾ƒä½ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯æŒ‡æ•°çº§çš„ã€‚åŠ¨æ€è§„åˆ’ç®—æ³•ï¼Œåœ¨æ‰§è¡Œæ•ˆç‡æ–¹é¢ï¼Œè¦é«˜å¾ˆå¤šã€‚å°½ç®¡æ‰§è¡Œæ•ˆç‡æé«˜äº†ï¼Œä½†æ˜¯åŠ¨æ€è§„åˆ’çš„ç©ºé—´å¤æ‚åº¦ä¹Ÿæé«˜äº†ï¼Œæ‰€ä»¥ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¼šè¯´ï¼ŒåŠ¨æ€è§„åˆ’æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„ç®—æ³•æ€æƒ³ã€‚\n\n---\n\næˆ‘é¦–å…ˆè®²äº†ä»€ä¹ˆæ ·çš„é—®é¢˜é€‚åˆç”¨åŠ¨æ€è§„åˆ’è§£å†³ã€‚è¿™äº›é—®é¢˜å¯ä»¥æ€»ç»“æ¦‚æ‹¬ä¸ºâ€œä¸€ä¸ªæ¨¡å‹ä¸‰ä¸ªç‰¹å¾â€ã€‚å…¶ä¸­ï¼Œâ€œä¸€ä¸ªæ¨¡å‹â€æŒ‡çš„æ˜¯ï¼Œé—®é¢˜å¯ä»¥æŠ½è±¡æˆåˆ†é˜¶æ®µå†³ç­–æœ€ä¼˜è§£æ¨¡å‹ã€‚â€œä¸‰ä¸ªç‰¹å¾â€æŒ‡çš„æ˜¯æœ€ä¼˜å­ç»“æ„ã€æ— åæ•ˆæ€§å’Œé‡å¤å­é—®é¢˜ã€‚\n\nç„¶åï¼Œæˆ‘è®²äº†ä¸¤ç§åŠ¨æ€è§„åˆ’çš„è§£é¢˜æ€è·¯ã€‚å®ƒä»¬åˆ†åˆ«æ˜¯çŠ¶æ€è½¬ç§»è¡¨æ³•å’ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹æ³•ã€‚å…¶ä¸­ï¼ŒçŠ¶æ€è½¬ç§»è¡¨æ³•è§£é¢˜æ€è·¯å¤§è‡´å¯ä»¥æ¦‚æ‹¬ä¸ºï¼Œ**å›æº¯ç®—æ³•å®ç° - å®šä¹‰çŠ¶æ€ - ç”»é€’å½’æ ‘ - æ‰¾é‡å¤å­é—®é¢˜ - ç”»çŠ¶æ€è½¬ç§»è¡¨ - æ ¹æ®é€’æ¨å…³ç³»å¡«è¡¨ - å°†å¡«è¡¨è¿‡ç¨‹ç¿»è¯‘æˆä»£ç **ã€‚çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ³•çš„å¤§è‡´æ€è·¯å¯ä»¥æ¦‚æ‹¬ä¸ºï¼Œ**æ‰¾æœ€ä¼˜å­ç»“æ„ - å†™çŠ¶æ€è½¬ç§»æ–¹ç¨‹ - å°†çŠ¶æ€è½¬ç§»æ–¹ç¨‹ç¿»è¯‘æˆä»£ç **ã€‚\n\næœ€åï¼Œæˆ‘ä»¬å¯¹æ¯”äº†ä¹‹å‰è®²è¿‡çš„å››ç§ç®—æ³•æ€æƒ³ã€‚è´ªå¿ƒã€å›æº¯ã€åŠ¨æ€è§„åˆ’å¯ä»¥è§£å†³çš„é—®é¢˜æ¨¡å‹ç±»ä¼¼ï¼Œéƒ½å¯ä»¥æŠ½è±¡æˆå¤šé˜¶æ®µå†³ç­–æœ€ä¼˜è§£æ¨¡å‹ã€‚å°½ç®¡åˆ†æ²»ç®—æ³•ä¹Ÿèƒ½è§£å†³æœ€ä¼˜é—®é¢˜ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†é—®é¢˜çš„èƒŒæ™¯éƒ½ä¸é€‚åˆæŠ½è±¡æˆå¤šé˜¶æ®µå†³ç­–æ¨¡å‹ã€‚","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS"]},"/Cards/CS/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84":{"title":"ç®—æ³•ä¸æ•°æ®ç»“æ„","content":"\n# ç®—æ³•ä¸æ•°æ®ç»“æ„\n\n# å‰è¨€\n\næƒ³è¦å­¦ä¹ æ•°æ®ç»“æ„ä¸ç®—æ³•ï¼Œ**é¦–å…ˆè¦æŒæ¡ä¸€ä¸ªæ•°æ®ç»“æ„ä¸ç®—æ³•ä¸­æœ€é‡è¦çš„æ¦‚å¿µâ€”â€”å¤æ‚åº¦åˆ†æã€‚**\n\nè¿™ä¸ªæ¦‚å¿µç©¶ç«Ÿæœ‰å¤šé‡è¦å‘¢ï¼Ÿå¯ä»¥è¿™ä¹ˆè¯´ï¼Œå®ƒå‡ ä¹å äº†æ•°æ®ç»“æ„å’Œç®—æ³•è¿™é—¨è¯¾çš„åŠå£æ±Ÿå±±ï¼Œæ˜¯æ•°æ®ç»“æ„å’Œç®—æ³•å­¦ä¹ çš„ç²¾é«“ã€‚\n\næ•°æ®ç»“æ„å’Œç®—æ³•è§£å†³çš„æ˜¯å¦‚ä½•æ›´çœã€æ›´å¿«åœ°å­˜å‚¨å’Œå¤„ç†æ•°æ®çš„é—®é¢˜ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªè€ƒé‡æ•ˆç‡å’Œèµ„æºæ¶ˆè€—çš„æ–¹æ³•ï¼Œè¿™å°±æ˜¯å¤æ‚åº¦åˆ†ææ–¹æ³•ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ åªæŒæ¡äº†æ•°æ®ç»“æ„å’Œç®—æ³•çš„ç‰¹ç‚¹ã€ç”¨æ³•ï¼Œä½†æ˜¯æ²¡æœ‰å­¦ä¼šå¤æ‚åº¦åˆ†æï¼Œé‚£å°±ç›¸å½“äºåªçŸ¥é“æ“ä½œå£è¯€ï¼Œè€Œæ²¡æŒæ¡å¿ƒæ³•ã€‚åªæœ‰æŠŠå¿ƒæ³•äº†ç„¶äºèƒ¸ï¼Œæ‰èƒ½åšåˆ°æ— æ‹›èƒœæœ‰æ‹›ï¼\n\n![Untitled](Extras/Images/alg.png)\n\n**æˆ‘ä»¬å­¦ä¹ æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œè¦å­¦ä¹ å®ƒçš„ç”±æ¥ã€ç‰¹æ€§ã€é€‚ç”¨çš„åœºæ™¯ä»¥åŠå®ƒèƒ½è§£å†³çš„é—®é¢˜ã€‚**\n\nä½œä¸ºåˆå­¦è€…ï¼Œæˆ–è€…ä¸€ä¸ªéç®—æ³•å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œéœ€è¦æŒæ¡çš„20ä¸ªæœ€å¸¸ç”¨çš„ã€æœ€åŸºç¡€æ•°æ®ç»“æ„ä¸ç®—æ³•ï¼š**æ•°ç»„ã€é“¾è¡¨ã€æ ˆã€é˜Ÿåˆ—ã€æ•£åˆ—è¡¨ã€äºŒå‰æ ‘ã€å †ã€è·³è¡¨ã€å›¾ã€Trie æ ‘ï¼›10 ä¸ªç®—æ³•ï¼šé€’å½’ã€æ’åºã€äºŒåˆ†æŸ¥æ‰¾ã€æœç´¢ã€å“ˆå¸Œç®—æ³•ã€è´ªå¿ƒç®—æ³•ã€åˆ†æ²»ç®—æ³•ã€å›æº¯ç®—æ³•ã€åŠ¨æ€è§„åˆ’ã€å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ã€‚**\n\n## ä¸€äº›å¯ä»¥è®©ä½ äº‹åŠåŠŸå€çš„å­¦ä¹ æŠ€å·§\n\n### è¾¹å­¦è¾¹ç»ƒï¼Œé€‚åº¦åˆ·é¢˜\n\nå»ºè®®ä½ æ¯å‘¨èŠ± 1ï½2 ä¸ªå°æ—¶çš„æ—¶é—´ï¼Œé›†ä¸­æŠŠå­¦ä¹ çš„æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œå…¨éƒ½è‡ªå·±å†™å‡ºæ¥ï¼Œç”¨ä»£ç å®ç°ä¸€éã€‚è¿™æ ·ä¸€å®šä¼šæ¯”å•çº¯åœ°çœ‹æˆ–è€…å¬çš„æ•ˆæœè¦å¥½å¾ˆå¤šï¼\n\n### å¤šé—®ã€å¤šæ€è€ƒã€å¤šäº’åŠ¨\n\nå­¦ä¹ æœ€å¥½çš„æ–¹æ³•æ˜¯ï¼Œæ‰¾åˆ°å‡ ä¸ªäººä¸€èµ·å­¦ä¹ ï¼Œä¸€å—å„¿è®¨è®ºåˆ‡ç£‹ï¼Œæœ‰é—®é¢˜åŠæ—¶å¯»æ±‚è€å¸ˆç­”ç–‘ã€‚\n\n### æ‰“æ€ªå‡çº§å­¦ä¹ æ³•\n\nå­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç¢°åˆ°æœ€å¤§çš„é—®é¢˜å°±æ˜¯ï¼ŒåšæŒä¸ä¸‹æ¥ã€‚ æ˜¯çš„ï¼Œå¾ˆå¤šåŸºç¡€è¯¾ç¨‹å­¦èµ·æ¥éƒ½éå¸¸æ¯ç‡¥ã€‚ä¸ºæ­¤ï¼Œæˆ‘è‡ªå·±æ€»ç»“äº†ä¸€å¥—â€œæ‰“æ€ªå‡çº§å­¦ä¹ æ³•â€ã€‚\n\næ¸¸æˆä½ è‚¯å®šç©è¿‡å§ï¼Ÿä¸ºä»€ä¹ˆå¾ˆå¤šçœ‹èµ·æ¥éå¸¸ç®€å•åˆæ²¡æœ‰ä¹è¶£çš„æ¸¸æˆï¼Œä½ ä¼šç©å¾—ä¸äº¦ä¹ä¹å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºï¼Œå½“ä½ åŠªåŠ›æ‰“åˆ°ä¸€å®šçº§åˆ«ä¹‹åï¼Œæ¯å¤©çœ‹ç€è‡ªå·±çš„ç»éªŒå€¼ã€æˆ˜æ–—åŠ›åœ¨æ…¢æ…¢æé«˜ï¼Œé‚£ç§æ¯å¤©éƒ½åœ¨ä¸€ç‚¹ä¸€ç‚¹æˆé•¿çš„æˆå°±æ„Ÿå°±ä¸ç”±è‡ªä¸»åœ°äº§ç”Ÿäº†ã€‚\n\næ‰€ä»¥ï¼Œ**æˆ‘ä»¬åœ¨æ¯ç‡¥çš„å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œä¹Ÿå¯ä»¥ç»™è‡ªå·±è®¾ç«‹ä¸€ä¸ªåˆ‡å®å¯è¡Œçš„ç›®æ ‡**ï¼Œå°±åƒæ‰“æ€ªå‡çº§ä¸€æ ·ã€‚\n\n### çŸ¥è¯†éœ€è¦æ²‰æ·€ï¼Œä¸è¦æƒ³è¯•å›¾ä¸€ä¸‹å­æŒæ¡æ‰€æœ‰\n\nåœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œä¸€å®šä¼šç¢°åˆ°â€œæ‹¦è·¯è™â€ã€‚å¦‚æœå“ªä¸ªçŸ¥è¯†ç‚¹æ²¡æœ‰æ€ä¹ˆå­¦æ‡‚ï¼Œä¸è¦ç€æ€¥ï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚å› ä¸ºï¼Œæƒ³å¬ä¸€éã€çœ‹ä¸€éå°±æŠŠæ‰€æœ‰çŸ¥è¯†æŒæ¡ï¼Œè¿™è‚¯å®šæ˜¯ä¸å¯èƒ½çš„ã€‚**å­¦ä¹ çŸ¥è¯†çš„è¿‡ç¨‹æ˜¯åå¤è¿­ä»£ã€ä¸æ–­æ²‰æ·€çš„è¿‡ç¨‹ã€‚**\n\n# å¤æ‚åº¦åˆ†æ\n\nè¿™é‡Œæœ‰æ®µéå¸¸ç®€å•çš„ä»£ç ï¼Œæ±‚ 1,2,3...n çš„ç´¯åŠ å’Œã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°±ä¸€å—æ¥ä¼°ç®—ä¸€ä¸‹è¿™æ®µä»£ç çš„æ‰§è¡Œæ—¶é—´ã€‚\n\n```c\nint cal(int n) {\n   int sum = 0;\n   int i = 1;\n   for (; i \u003c= n; ++i) {\n     sum = sum + i;\n   }\n   return sum;\n }\n```\n\nä» CPU çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ®µä»£ç çš„æ¯ä¸€è¡Œéƒ½æ‰§è¡Œç€ç±»ä¼¼çš„æ“ä½œï¼šè¯»æ•°æ®-è¿ç®—-å†™æ•°æ®ã€‚å°½ç®¡æ¯è¡Œä»£ç å¯¹åº”çš„ CPU æ‰§è¡Œçš„ä¸ªæ•°ã€æ‰§è¡Œçš„æ—¶é—´éƒ½ä¸ä¸€æ ·ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬è¿™é‡Œåªæ˜¯ç²—ç•¥ä¼°è®¡ï¼Œæ‰€ä»¥å¯ä»¥å‡è®¾æ¯è¡Œä»£ç æ‰§è¡Œçš„æ—¶é—´éƒ½ä¸€æ ·ï¼Œä¸º unit_timeã€‚åœ¨è¿™ä¸ªå‡è®¾çš„åŸºç¡€ä¹‹ä¸Šï¼Œè¿™æ®µä»£ç çš„æ€»æ‰§è¡Œæ—¶é—´æ˜¯å¤šå°‘å‘¢ï¼Ÿ\n\nç¬¬ 2ã€3 è¡Œä»£ç åˆ†åˆ«éœ€è¦ 1 ä¸ª unit_time çš„æ‰§è¡Œæ—¶é—´ï¼Œç¬¬ 4ã€5 è¡Œéƒ½è¿è¡Œäº† n éï¼Œæ‰€ä»¥éœ€è¦ 2n*unit_time çš„æ‰§è¡Œæ—¶é—´ï¼Œæ‰€ä»¥è¿™æ®µä»£ç æ€»çš„æ‰§è¡Œæ—¶é—´å°±æ˜¯ T(n)=(2n+2)*unit_timeã€‚å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ‰€æœ‰ä»£ç çš„æ‰§è¡Œæ—¶é—´ T(n) ä¸æ¯è¡Œä»£ç çš„æ‰§è¡Œæ¬¡æ•°æˆæ­£æ¯”ã€‚\n\nå°½ç®¡æˆ‘ä»¬ä¸çŸ¥é“ unit_time çš„å…·ä½“å€¼ï¼Œä½†æ˜¯é€šè¿‡è¿™ä¸¤æ®µä»£ç æ‰§è¡Œæ—¶é—´çš„æ¨å¯¼è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªéå¸¸é‡è¦çš„è§„å¾‹ï¼Œé‚£å°±æ˜¯ï¼Œæ‰€æœ‰ä»£ç çš„æ‰§è¡Œæ—¶é—´ T(n) ä¸æ¯è¡Œä»£ç çš„æ‰§è¡Œæ¬¡æ•° f(n) æˆæ­£æ¯”ã€‚\n\næˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªè§„å¾‹æ€»ç»“æˆä¸€ä¸ªå…¬å¼ã€‚\n\n![Untitled](Extras/Images/alg_1.png)\n\nT(n) æˆ‘ä»¬å·²ç»è®²è¿‡äº†ï¼Œå®ƒè¡¨ç¤ºä»£ç æ‰§è¡Œçš„æ—¶é—´ï¼›n è¡¨ç¤ºæ•°æ®è§„æ¨¡çš„å¤§å°ï¼›f(n) è¡¨ç¤ºæ¯è¡Œä»£ç æ‰§è¡Œçš„æ¬¡æ•°æ€»å’Œã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ªå…¬å¼ï¼Œæ‰€ä»¥ç”¨ f(n) æ¥è¡¨ç¤ºã€‚å…¬å¼ä¸­çš„ Oï¼Œè¡¨ç¤ºä»£ç çš„æ‰§è¡Œæ—¶é—´ T(n) ä¸ f(n) è¡¨è¾¾å¼æˆæ­£æ¯”ã€‚\n\næ‰€ä»¥ï¼Œç¬¬ä¸€ä¸ªä¾‹å­ä¸­çš„ T(n) = O(2n+2)ã€‚è¿™å°±æ˜¯å¤§ O æ—¶é—´å¤æ‚åº¦è¡¨ç¤ºæ³•ã€‚å¤§ O æ—¶é—´å¤æ‚åº¦å®é™…ä¸Šå¹¶ä¸å…·ä½“è¡¨ç¤ºä»£ç çœŸæ­£çš„æ‰§è¡Œæ—¶é—´ï¼Œè€Œæ˜¯è¡¨ç¤º**ä»£ç æ‰§è¡Œæ—¶é—´éšæ•°æ®è§„æ¨¡å¢é•¿çš„å˜åŒ–è¶‹åŠ¿**ï¼Œæ‰€ä»¥ï¼Œä¹Ÿå«ä½œ**æ¸è¿›æ—¶é—´å¤æ‚åº¦**ï¼ˆasymptotic time complexityï¼‰ï¼Œç®€ç§°**æ—¶é—´å¤æ‚åº¦**ã€‚\n\n## æ—¶é—´å¤æ‚åº¦åˆ†æ\n\n### åªå…³æ³¨å¾ªç¯æ‰§è¡Œæ¬¡æ•°æœ€å¤šçš„ä¸€æ®µä»£ç \n\nå¤§ O è¿™ç§å¤æ‚åº¦è¡¨ç¤ºæ–¹æ³•åªæ˜¯è¡¨ç¤ºä¸€ç§å˜åŒ–è¶‹åŠ¿ã€‚æˆ‘ä»¬é€šå¸¸ä¼šå¿½ç•¥æ‰å…¬å¼ä¸­çš„å¸¸é‡ã€ä½é˜¶ã€ç³»æ•°ï¼Œåªéœ€è¦è®°å½•ä¸€ä¸ªæœ€å¤§é˜¶çš„é‡çº§å°±å¯ä»¥äº†ã€‚æ‰€ä»¥ï¼Œ**æˆ‘ä»¬åœ¨åˆ†æä¸€ä¸ªç®—æ³•ã€ä¸€æ®µä»£ç çš„æ—¶é—´å¤æ‚åº¦çš„æ—¶å€™ï¼Œä¹Ÿåªå…³æ³¨å¾ªç¯æ‰§è¡Œæ¬¡æ•°æœ€å¤šçš„é‚£ä¸€æ®µä»£ç å°±å¯ä»¥äº†**ã€‚è¿™æ®µæ ¸å¿ƒä»£ç æ‰§è¡Œæ¬¡æ•°çš„ n çš„é‡çº§ï¼Œå°±æ˜¯æ•´æ®µè¦åˆ†æä»£ç çš„æ—¶é—´å¤æ‚åº¦ã€‚\n\n### åŠ æ³•æ³•åˆ™ï¼šæ€»å¤æ‚åº¦ç­‰äºé‡çº§æœ€å¤§çš„é‚£æ®µä»£ç çš„å¤æ‚åº¦\n\n**æ€»çš„æ—¶é—´å¤æ‚åº¦å°±ç­‰äºé‡çº§æœ€å¤§çš„é‚£æ®µä»£ç çš„æ—¶é—´å¤æ‚åº¦ã€‚**é‚£æˆ‘ä»¬å°†è¿™ä¸ªè§„å¾‹æŠ½è±¡æˆå…¬å¼å°±æ˜¯ï¼š\n\nå¦‚æœ T1(n)=O(f(n))ï¼ŒT2(n)=O(g(n))ï¼›é‚£ä¹ˆ T(n)=T1(n)+T2(n)=max(O(f(n)), O(g(n))) =O(max(f(n), g(n))).\n\n### ä¹˜æ³•æ³•åˆ™ï¼šåµŒå¥—ä»£ç çš„å¤æ‚åº¦ç­‰äºåµŒå¥—å†…å¤–ä»£ç å¤æ‚åº¦çš„ä¹˜ç§¯\n\nå¦‚æœ T1(n)=O(f(n))ï¼ŒT2(n)=O(g(n))ï¼›é‚£ä¹ˆ T(n)=T1(n)*T2(n)=O(f(n))*O(g(n))=O(f(n)*g(n)).ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡è®¾ T1(n) = O(n)ï¼ŒT2(n) = O(n2)ï¼Œåˆ™ T1(n) * T2(n) = O(n3)ã€‚\n\nè½å®åˆ°å…·ä½“çš„ä»£ç ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¹˜æ³•æ³•åˆ™çœ‹æˆæ˜¯**åµŒå¥—å¾ªç¯ã€‚**\n\n## å‡ ç§å¸¸è§æ—¶é—´å¤æ‚åº¦å®ä¾‹åˆ†æ\n\n![Untitled](Extras/Images/alg_2.png)\n\nå¯¹äºåˆšç½—åˆ—çš„å¤æ‚åº¦é‡çº§ï¼Œæˆ‘ä»¬å¯ä»¥ç²—ç•¥åœ°åˆ†ä¸ºä¸¤ç±»ï¼Œå¤šé¡¹å¼é‡çº§å’Œéå¤šé¡¹å¼é‡çº§ã€‚å…¶ä¸­ï¼Œéå¤šé¡¹å¼é‡çº§åªæœ‰ä¸¤ä¸ªï¼šO(2n) å’Œ O(n!)ã€‚\n\næˆ‘ä»¬æŠŠæ—¶é—´å¤æ‚åº¦ä¸ºéå¤šé¡¹å¼é‡çº§çš„ç®—æ³•é—®é¢˜å«ä½œ NPï¼ˆNon-Deterministic Polynomialï¼Œéç¡®å®šå¤šé¡¹å¼ï¼‰é—®é¢˜ã€‚\n\nå½“æ•°æ®è§„æ¨¡ n è¶Šæ¥è¶Šå¤§æ—¶ï¼Œéå¤šé¡¹å¼é‡çº§ç®—æ³•çš„æ‰§è¡Œæ—¶é—´ä¼šæ€¥å‰§å¢åŠ ï¼Œæ±‚è§£é—®é¢˜çš„æ‰§è¡Œæ—¶é—´ä¼šæ— é™å¢é•¿ã€‚æ‰€ä»¥ï¼Œéå¤šé¡¹å¼æ—¶é—´å¤æ‚åº¦çš„ç®—æ³•å…¶å®æ˜¯éå¸¸ä½æ•ˆçš„ç®—æ³•ã€‚\n\n### O(1)\n\nåªè¦ä»£ç çš„æ‰§è¡Œæ—¶é—´ä¸éš n çš„å¢å¤§è€Œå¢é•¿ï¼Œè¿™æ ·ä»£ç çš„æ—¶é—´å¤æ‚åº¦æˆ‘ä»¬éƒ½è®°ä½œ O(1)ã€‚æˆ–è€…è¯´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ**åªè¦ç®—æ³•ä¸­ä¸å­˜åœ¨å¾ªç¯è¯­å¥ã€é€’å½’è¯­å¥ï¼Œå³ä½¿æœ‰æˆåƒä¸Šä¸‡è¡Œçš„ä»£ç ï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ÎŸ(1)**ã€‚\n\n### O(logn)ã€O(nlogn)\n\nå¯¹æ•°é˜¶æ—¶é—´å¤æ‚åº¦éå¸¸å¸¸è§ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æœ€éš¾åˆ†æçš„ä¸€ç§æ—¶é—´å¤æ‚åº¦ã€‚\n\n```c\ni=1;\nwhile (i \u003c= n) {\n   i = i * 2;\n}\n```\n\næ ¹æ®æˆ‘ä»¬å‰é¢è®²çš„å¤æ‚åº¦åˆ†ææ–¹æ³•ï¼Œç¬¬ä¸‰è¡Œä»£ç æ˜¯å¾ªç¯æ‰§è¡Œæ¬¡æ•°æœ€å¤šçš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªè¦èƒ½è®¡ç®—å‡ºè¿™è¡Œä»£ç è¢«æ‰§è¡Œäº†å¤šå°‘æ¬¡ï¼Œå°±èƒ½çŸ¥é“æ•´æ®µä»£ç çš„æ—¶é—´å¤æ‚åº¦ã€‚\n\nä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œå˜é‡ i çš„å€¼ä» 1 å¼€å§‹å–ï¼Œæ¯å¾ªç¯ä¸€æ¬¡å°±ä¹˜ä»¥ 2ã€‚å½“å¤§äº n æ—¶ï¼Œå¾ªç¯ç»“æŸã€‚è¿˜è®°å¾—æˆ‘ä»¬é«˜ä¸­å­¦è¿‡çš„ç­‰æ¯”æ•°åˆ—å—ï¼Ÿå®é™…ä¸Šï¼Œå˜é‡ i çš„å–å€¼å°±æ˜¯ä¸€ä¸ªç­‰æ¯”æ•°åˆ—ã€‚å¦‚æœæˆ‘æŠŠå®ƒä¸€ä¸ªä¸€ä¸ªåˆ—å‡ºæ¥ï¼Œå°±åº”è¯¥æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š\n\n![Untitled](Extras/Images/alg_3.png)\n\næ‰€ä»¥ï¼Œæˆ‘ä»¬åªè¦çŸ¥é“ x å€¼æ˜¯å¤šå°‘ï¼Œå°±çŸ¥é“è¿™è¡Œä»£ç æ‰§è¡Œçš„æ¬¡æ•°äº†ã€‚é€šè¿‡ 2x=n æ±‚è§£ x è¿™ä¸ªé—®é¢˜æˆ‘ä»¬æƒ³é«˜ä¸­åº”è¯¥å°±å­¦è¿‡äº†ï¼Œæˆ‘å°±ä¸å¤šè¯´äº†ã€‚x=log2nï¼Œæ‰€ä»¥ï¼Œè¿™æ®µä»£ç çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(log2n)ã€‚\n\nå®é™…ä¸Šï¼Œä¸ç®¡æ˜¯ä»¥ 2 ä¸ºåº•ã€ä»¥ 3 ä¸ºåº•ï¼Œè¿˜æ˜¯ä»¥ 10 ä¸ºåº•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰å¯¹æ•°é˜¶çš„æ—¶é—´å¤æ‚åº¦éƒ½è®°ä¸º O(logn)ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\n\næˆ‘ä»¬çŸ¥é“ï¼Œå¯¹æ•°ä¹‹é—´æ˜¯å¯ä»¥äº’ç›¸è½¬æ¢çš„ï¼Œlog3n å°±ç­‰äº log32 * log2nï¼Œæ‰€ä»¥ O(log3n) = O(C * log2n)ï¼Œå…¶ä¸­ C=log32 æ˜¯ä¸€ä¸ªå¸¸é‡ã€‚åŸºäºæˆ‘ä»¬å‰é¢çš„ä¸€ä¸ªç†è®ºï¼šåœ¨é‡‡ç”¨å¤§ O æ ‡è®°å¤æ‚åº¦çš„æ—¶å€™ï¼Œå¯ä»¥å¿½ç•¥ç³»æ•°ï¼Œå³ O(Cf(n)) = O(f(n))ã€‚æ‰€ä»¥ï¼ŒO(log2n) å°±ç­‰äº O(log3n)ã€‚å› æ­¤ï¼Œåœ¨å¯¹æ•°é˜¶æ—¶é—´å¤æ‚åº¦çš„è¡¨ç¤ºæ–¹æ³•é‡Œï¼Œæˆ‘ä»¬å¿½ç•¥å¯¹æ•°çš„â€œåº•â€ï¼Œç»Ÿä¸€è¡¨ç¤ºä¸º O(logn)ã€‚\n\n### O(m+n)ã€O(m*n)\n\næˆ‘ä»¬å†æ¥è®²ä¸€ç§è·Ÿå‰é¢éƒ½ä¸ä¸€æ ·çš„æ—¶é—´å¤æ‚åº¦ï¼Œä»£ç çš„å¤æ‚åº¦**ç”±ä¸¤ä¸ªæ•°æ®çš„è§„æ¨¡**æ¥å†³å®šã€‚\n\n```c\nint cal(int m, int n) {\n  int sum_1 = 0;\n  int i = 1;\n  for (; i \u003c m; ++i) {\n    sum_1 = sum_1 + i;\n  }\n\n  int sum_2 = 0;\n  int j = 1;\n  for (; j \u003c n; ++j) {\n    sum_2 = sum_2 + j;\n  }\n\n  return sum_1 + sum_2;\n}\n```\n\nä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œm å’Œ n æ˜¯è¡¨ç¤ºä¸¤ä¸ªæ•°æ®è§„æ¨¡ã€‚æˆ‘ä»¬æ— æ³•äº‹å…ˆè¯„ä¼° m å’Œ n è°çš„é‡çº§å¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¡¨ç¤ºå¤æ‚åº¦çš„æ—¶å€™ï¼Œå°±ä¸èƒ½ç®€å•åœ°åˆ©ç”¨åŠ æ³•æ³•åˆ™ï¼Œçœç•¥æ‰å…¶ä¸­ä¸€ä¸ªã€‚æ‰€ä»¥ï¼Œä¸Šé¢ä»£ç çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(m+n)ã€‚\n\né’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒåŸæ¥çš„åŠ æ³•æ³•åˆ™å°±ä¸æ­£ç¡®äº†ï¼Œæˆ‘ä»¬éœ€è¦å°†åŠ æ³•è§„åˆ™æ”¹ä¸ºï¼šT1(m) + T2(n) = O(f(m) + g(n))ã€‚ä½†æ˜¯ä¹˜æ³•æ³•åˆ™ç»§ç»­æœ‰æ•ˆï¼šT1(m)*T2(n) = O(f(m) * f(n))ã€‚\n\n## ç©ºé—´å¤æ‚åº¦åˆ†æ\n\nå‰é¢æˆ‘è®²è¿‡ï¼Œæ—¶é—´å¤æ‚åº¦çš„å…¨ç§°æ˜¯æ¸è¿›æ—¶é—´å¤æ‚åº¦ï¼Œè¡¨ç¤ºç®—æ³•çš„æ‰§è¡Œæ—¶é—´ä¸æ•°æ®è§„æ¨¡ä¹‹é—´çš„å¢é•¿å…³ç³»ã€‚ç±»æ¯”ä¸€ä¸‹ï¼Œç©ºé—´å¤æ‚åº¦å…¨ç§°å°±æ˜¯æ¸è¿›ç©ºé—´å¤æ‚åº¦ï¼ˆasymptotic space complexityï¼‰ï¼Œè¡¨ç¤ºç®—æ³•çš„å­˜å‚¨ç©ºé—´ä¸æ•°æ®è§„æ¨¡ä¹‹é—´çš„å¢é•¿å…³ç³»ã€‚\n\n```c\nvoid print(int n) {\n  int i = 0;\n  int[] a = new int[n];\n  for (i; i \u003cn; ++i) {\n    a[i] = i * i;\n  }\n\n  for (i = n-1; i \u003e= 0; --i) {\n    print out a[i]\n  }\n}\n```\n\nè·Ÿæ—¶é—´å¤æ‚åº¦åˆ†æä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ 2 è¡Œä»£ç ä¸­ï¼Œæˆ‘ä»¬ç”³è¯·äº†ä¸€ä¸ªç©ºé—´å­˜å‚¨å˜é‡ iï¼Œä½†æ˜¯å®ƒæ˜¯å¸¸é‡é˜¶çš„ï¼Œè·Ÿæ•°æ®è§„æ¨¡ n æ²¡æœ‰å…³ç³»ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¿½ç•¥ã€‚ç¬¬ 3 è¡Œç”³è¯·äº†ä¸€ä¸ªå¤§å°ä¸º n çš„ int ç±»å‹æ•°ç»„ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå‰©ä¸‹çš„ä»£ç éƒ½æ²¡æœ‰å ç”¨æ›´å¤šçš„ç©ºé—´ï¼Œæ‰€ä»¥æ•´æ®µä»£ç çš„ç©ºé—´å¤æ‚åº¦å°±æ˜¯ O(n)ã€‚\n\næˆ‘ä»¬å¸¸è§çš„ç©ºé—´å¤æ‚åº¦å°±æ˜¯ O(1)ã€O(n)ã€O(n2 )ï¼Œåƒ O(logn)ã€O(nlogn) è¿™æ ·çš„å¯¹æ•°é˜¶å¤æ‚åº¦å¹³æ—¶éƒ½ç”¨ä¸åˆ°ã€‚è€Œä¸”ï¼Œç©ºé—´å¤æ‚åº¦åˆ†ææ¯”æ—¶é—´å¤æ‚åº¦åˆ†æè¦ç®€å•å¾ˆå¤šã€‚æ‰€ä»¥ï¼Œå¯¹äºç©ºé—´å¤æ‚åº¦ï¼ŒæŒæ¡åˆšæˆ‘è¯´çš„è¿™äº›å†…å®¹å·²ç»è¶³å¤Ÿäº†ã€‚\n\n## **æœ€å¥½ã€æœ€åã€å¹³å‡ã€å‡æ‘Šæ—¶é—´å¤æ‚åº¦**\n\n### æœ€å¥½ã€æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦\n\n```c\n// nè¡¨ç¤ºæ•°ç»„arrayçš„é•¿åº¦\nint find(int[] array, int n, int x) {\n  int i = 0;\n  int pos = -1;\n  for (; i \u003c n; ++i) {\n    if (array[i] == x) {\n       pos = i;\n       break;\n    }\n  }\n  return pos;\n}\n```\n\nå› ä¸ºï¼Œè¦æŸ¥æ‰¾çš„å˜é‡ x å¯èƒ½å‡ºç°åœ¨æ•°ç»„çš„ä»»æ„ä½ç½®ã€‚å¦‚æœæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ­£å¥½æ˜¯è¦æŸ¥æ‰¾çš„å˜é‡ xï¼Œé‚£å°±ä¸éœ€è¦ç»§ç»­éå†å‰©ä¸‹çš„ n-1 ä¸ªæ•°æ®äº†ï¼Œé‚£æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(1)ã€‚ä½†å¦‚æœæ•°ç»„ä¸­ä¸å­˜åœ¨å˜é‡ xï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦æŠŠæ•´ä¸ªæ•°ç»„éƒ½éå†ä¸€éï¼Œæ—¶é—´å¤æ‚åº¦å°±æˆäº† O(n)ã€‚æ‰€ä»¥ï¼Œä¸åŒçš„æƒ…å†µä¸‹ï¼Œè¿™æ®µä»£ç çš„æ—¶é—´å¤æ‚åº¦æ˜¯ä¸ä¸€æ ·çš„ã€‚\n\nä¸ºäº†è¡¨ç¤ºä»£ç åœ¨ä¸åŒæƒ…å†µä¸‹çš„ä¸åŒæ—¶é—´å¤æ‚åº¦ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ä¸‰ä¸ªæ¦‚å¿µï¼šæœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ã€æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦å’Œå¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦ã€‚\n\né¡¾åæ€ä¹‰ï¼Œ**æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦å°±æ˜¯ï¼Œåœ¨æœ€ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œè¿™æ®µä»£ç çš„æ—¶é—´å¤æ‚åº¦**ã€‚å°±åƒæˆ‘ä»¬åˆšåˆšè®²åˆ°çš„ï¼Œåœ¨æœ€ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œè¦æŸ¥æ‰¾çš„å˜é‡ x æ­£å¥½æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè¿™ä¸ªæ—¶å€™å¯¹åº”çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ã€‚\n\nåŒç†ï¼Œ**æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦å°±æ˜¯ï¼Œåœ¨æœ€ç³Ÿç³•çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œè¿™æ®µä»£ç çš„æ—¶é—´å¤æ‚åº¦**ã€‚å°±åƒåˆšä¸¾çš„é‚£ä¸ªä¾‹å­ï¼Œå¦‚æœæ•°ç»„ä¸­æ²¡æœ‰è¦æŸ¥æ‰¾çš„å˜é‡ xï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ•´ä¸ªæ•°ç»„éƒ½éå†ä¸€éæ‰è¡Œï¼Œæ‰€ä»¥è¿™ç§æœ€ç³Ÿç³•æƒ…å†µä¸‹å¯¹åº”çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦ã€‚\n\n### å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦\n\næˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦å’Œæœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦å¯¹åº”çš„éƒ½æ˜¯æç«¯æƒ…å†µä¸‹çš„ä»£ç å¤æ‚åº¦ï¼Œå‘ç”Ÿçš„æ¦‚ç‡å…¶å®å¹¶ä¸å¤§ã€‚ä¸ºäº†æ›´å¥½åœ°è¡¨ç¤ºå¹³å‡æƒ…å†µä¸‹çš„å¤æ‚åº¦ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥å¦ä¸€ä¸ªæ¦‚å¿µï¼šå¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦ï¼Œåé¢æˆ‘ç®€ç§°ä¸ºå¹³å‡æ—¶é—´å¤æ‚åº¦ã€‚\n\nå¹³å‡æ—¶é—´å¤æ‚åº¦åˆè¯¥æ€ä¹ˆåˆ†æå‘¢ï¼Ÿæˆ‘è¿˜æ˜¯å€ŸåŠ©åˆšæ‰æŸ¥æ‰¾å˜é‡ x çš„ä¾‹å­æ¥ç»™ä½ è§£é‡Šã€‚è¦æŸ¥æ‰¾çš„å˜é‡ x åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œæœ‰ n+1 ç§æƒ…å†µï¼šåœ¨æ•°ç»„çš„ 0ï½n-1 ä½ç½®ä¸­å’Œä¸åœ¨æ•°ç»„ä¸­ã€‚æˆ‘ä»¬æŠŠæ¯ç§æƒ…å†µä¸‹ï¼ŒæŸ¥æ‰¾éœ€è¦éå†çš„å…ƒç´ ä¸ªæ•°ç´¯åŠ èµ·æ¥ï¼Œç„¶åå†é™¤ä»¥ n+1ï¼Œå°±å¯ä»¥å¾—åˆ°éœ€è¦éå†çš„å…ƒç´ ä¸ªæ•°çš„å¹³å‡å€¼ï¼Œå³ï¼š\n\n![Untitled](Extras/Images/alg_4.png)\n\næˆ‘ä»¬çŸ¥é“ï¼Œæ—¶é—´å¤æ‚åº¦çš„å¤§ O æ ‡è®°æ³•ä¸­ï¼Œå¯ä»¥çœç•¥æ‰ç³»æ•°ã€ä½é˜¶ã€å¸¸é‡ï¼Œæ‰€ä»¥ï¼Œå’±ä»¬æŠŠåˆšåˆšè¿™ä¸ªå…¬å¼ç®€åŒ–ä¹‹åï¼Œå¾—åˆ°çš„å¹³å‡æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(n)ã€‚\n\nè¿™ä¸ªç»“è®ºè™½ç„¶æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯è®¡ç®—è¿‡ç¨‹ç¨å¾®æœ‰ç‚¹å„¿é—®é¢˜ã€‚ç©¶ç«Ÿæ˜¯ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬åˆšè®²çš„è¿™ n+1 ç§æƒ…å†µï¼Œå‡ºç°çš„æ¦‚ç‡å¹¶ä¸æ˜¯ä¸€æ ·çš„ã€‚æˆ‘å¸¦ä½ å…·ä½“åˆ†æä¸€ä¸‹ã€‚ï¼ˆè¿™é‡Œè¦ç¨å¾®ç”¨åˆ°ä¸€ç‚¹å„¿æ¦‚ç‡è®ºçš„çŸ¥è¯†ï¼Œä¸è¿‡éå¸¸ç®€å•ï¼Œä½ ä¸ç”¨æ‹…å¿ƒã€‚ï¼‰\n\næˆ‘ä»¬çŸ¥é“ï¼Œè¦æŸ¥æ‰¾çš„å˜é‡ xï¼Œè¦ä¹ˆåœ¨æ•°ç»„é‡Œï¼Œè¦ä¹ˆå°±ä¸åœ¨æ•°ç»„é‡Œã€‚è¿™ä¸¤ç§æƒ…å†µå¯¹åº”çš„æ¦‚ç‡ç»Ÿè®¡èµ·æ¥å¾ˆéº»çƒ¦ï¼Œä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘ä»¬å‡è®¾åœ¨æ•°ç»„ä¸­ä¸ä¸åœ¨æ•°ç»„ä¸­çš„æ¦‚ç‡éƒ½ä¸º 1/2ã€‚å¦å¤–ï¼Œè¦æŸ¥æ‰¾çš„æ•°æ®å‡ºç°åœ¨ 0ï½n-1 è¿™ n ä¸ªä½ç½®çš„æ¦‚ç‡ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¸º 1/nã€‚æ‰€ä»¥ï¼Œæ ¹æ®æ¦‚ç‡ä¹˜æ³•æ³•åˆ™ï¼Œè¦æŸ¥æ‰¾çš„æ•°æ®å‡ºç°åœ¨ 0ï½n-1 ä¸­ä»»æ„ä½ç½®çš„æ¦‚ç‡å°±æ˜¯ 1/(2n)ã€‚\n\nå› æ­¤ï¼Œå‰é¢çš„æ¨å¯¼è¿‡ç¨‹ä¸­å­˜åœ¨çš„æœ€å¤§é—®é¢˜å°±æ˜¯ï¼Œæ²¡æœ‰å°†å„ç§æƒ…å†µå‘ç”Ÿçš„æ¦‚ç‡è€ƒè™‘è¿›å»ã€‚å¦‚æœæˆ‘ä»¬æŠŠæ¯ç§æƒ…å†µå‘ç”Ÿçš„æ¦‚ç‡ä¹Ÿè€ƒè™‘è¿›å»ï¼Œé‚£å¹³å‡æ—¶é—´å¤æ‚åº¦çš„è®¡ç®—è¿‡ç¨‹å°±å˜æˆäº†è¿™æ ·ï¼š\n\n![Untitled](Extras/Images/alg_5.png)\n\nè¿™ä¸ªå€¼å°±æ˜¯æ¦‚ç‡è®ºä¸­çš„**åŠ æƒå¹³å‡å€¼**ï¼Œä¹Ÿå«ä½œ**æœŸæœ›å€¼**ï¼Œæ‰€ä»¥å¹³å‡æ—¶é—´å¤æ‚åº¦çš„å…¨ç§°åº”è¯¥å«**åŠ æƒå¹³å‡æ—¶é—´å¤æ‚åº¦**æˆ–è€…**æœŸæœ›æ—¶é—´å¤æ‚åº¦**ã€‚\n\nå¼•å…¥æ¦‚ç‡ä¹‹åï¼Œå‰é¢é‚£æ®µä»£ç çš„åŠ æƒå¹³å‡å€¼ä¸º (3n+1)/4ã€‚ç”¨å¤§ O è¡¨ç¤ºæ³•æ¥è¡¨ç¤ºï¼Œå»æ‰ç³»æ•°å’Œå¸¸é‡ï¼Œè¿™æ®µä»£ç çš„åŠ æƒå¹³å‡æ—¶é—´å¤æ‚åº¦ä»ç„¶æ˜¯ O(n)ã€‚\n\nå®é™…ä¸Šï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦åŒºåˆ†æœ€å¥½ã€æœ€åã€å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸‰ç§æƒ…å†µã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå¤æ‚åº¦å°±å¯ä»¥æ»¡è¶³éœ€æ±‚äº†ã€‚åªæœ‰åŒä¸€å—ä»£ç åœ¨ä¸åŒçš„æƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦æœ‰é‡çº§çš„å·®è·ï¼Œæˆ‘ä»¬æ‰ä¼šä½¿ç”¨è¿™ä¸‰ç§å¤æ‚åº¦è¡¨ç¤ºæ³•æ¥åŒºåˆ†ã€‚\n\n### å‡æ‘Šæ—¶é—´å¤æ‚åº¦\n\n```c\n// arrayè¡¨ç¤ºä¸€ä¸ªé•¿åº¦ä¸ºnçš„æ•°ç»„\n // ä»£ç ä¸­çš„array.lengthå°±ç­‰äºn\n int[] array = new int[n];\n int count = 0;\n\n void insert(int val) {\n    if (count == array.length) {\n       int sum = 0;\n       for (int i = 0; i \u003c array.length; ++i) {\n          sum = sum + array[i];\n       }\n       array[0] = sum;\n       count = 1;\n    }\n\n    array[count] = val;\n    ++count;\n }\n```\n\nè¿™æ®µä»£ç å®ç°äº†ä¸€ä¸ªå¾€æ•°ç»„ä¸­æ’å…¥æ•°æ®çš„åŠŸèƒ½ã€‚å½“æ•°ç»„æ»¡äº†ä¹‹åï¼Œä¹Ÿå°±æ˜¯ä»£ç ä¸­çš„ count == array.length æ—¶ï¼Œæˆ‘ä»¬ç”¨ for å¾ªç¯éå†æ•°ç»„æ±‚å’Œï¼Œå¹¶æ¸…ç©ºæ•°ç»„ï¼Œå°†æ±‚å’Œä¹‹åçš„ sum å€¼æ”¾åˆ°æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œç„¶åå†å°†æ–°çš„æ•°æ®æ’å…¥ã€‚ä½†å¦‚æœæ•°ç»„ä¸€å¼€å§‹å°±æœ‰ç©ºé—²ç©ºé—´ï¼Œåˆ™ç›´æ¥å°†æ•°æ®æ’å…¥æ•°ç»„ã€‚\n\næœ€ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œæ•°ç»„ä¸­æœ‰ç©ºé—²ç©ºé—´ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ•°æ®æ’å…¥åˆ°æ•°ç»„ä¸‹æ ‡ä¸º count çš„ä½ç½®å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚æœ€åçš„æƒ…å†µä¸‹ï¼Œæ•°ç»„ä¸­æ²¡æœ‰ç©ºé—²ç©ºé—´äº†ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåšä¸€æ¬¡æ•°ç»„çš„éå†æ±‚å’Œï¼Œç„¶åå†å°†æ•°æ®æ’å…¥ï¼Œæ‰€ä»¥æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚\n\né‚£å¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ O(1)ã€‚æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡å‰é¢è®²çš„æ¦‚ç‡è®ºçš„æ–¹æ³•æ¥åˆ†æã€‚\n\nå‡è®¾æ•°ç»„çš„é•¿åº¦æ˜¯ nï¼Œæ ¹æ®æ•°æ®æ’å…¥çš„ä½ç½®çš„ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥åˆ†ä¸º n ç§æƒ…å†µï¼Œæ¯ç§æƒ…å†µçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§â€œé¢å¤–â€çš„æƒ…å†µï¼Œå°±æ˜¯åœ¨æ•°ç»„æ²¡æœ‰ç©ºé—²ç©ºé—´æ—¶æ’å…¥ä¸€ä¸ªæ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚è€Œä¸”ï¼Œè¿™ n+1 ç§æƒ…å†µå‘ç”Ÿçš„æ¦‚ç‡ä¸€æ ·ï¼Œéƒ½æ˜¯ 1/(n+1)ã€‚æ‰€ä»¥ï¼Œæ ¹æ®åŠ æƒå¹³å‡çš„è®¡ç®—æ–¹æ³•ï¼Œæˆ‘ä»¬æ±‚å¾—çš„å¹³å‡æ—¶é—´å¤æ‚åº¦å°±æ˜¯ï¼š\n\n![Untitled](Extras/Images/alg_6.png)\n\nè¿™ä¸ªä¾‹å­é‡Œçš„å¹³å‡å¤æ‚åº¦åˆ†æå…¶å®å¹¶ä¸éœ€è¦è¿™ä¹ˆå¤æ‚ï¼Œä¸éœ€è¦å¼•å…¥æ¦‚ç‡è®ºçš„çŸ¥è¯†ã€‚æˆ‘ä»¬å…ˆæ¥å¯¹æ¯”ä¸€ä¸‹è¿™ä¸ª insert() çš„ä¾‹å­å’Œå‰é¢é‚£ä¸ª find() çš„ä¾‹å­ï¼Œä½ å°±ä¼šå‘ç°è¿™ä¸¤è€…æœ‰å¾ˆå¤§å·®åˆ«ã€‚\n\né¦–å…ˆï¼Œfind() å‡½æ•°åœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¤æ‚åº¦æ‰ä¸º O(1)ã€‚ä½† insert() åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦éƒ½ä¸º O(1)ã€‚åªæœ‰ä¸ªåˆ«æƒ…å†µä¸‹ï¼Œå¤æ‚åº¦æ‰æ¯”è¾ƒé«˜ï¼Œä¸º O(n)ã€‚è¿™æ˜¯ insert()ç¬¬ä¸€ä¸ªåŒºåˆ«äº find() çš„åœ°æ–¹ã€‚\n\næˆ‘ä»¬å†æ¥çœ‹ç¬¬äºŒä¸ªä¸åŒçš„åœ°æ–¹ã€‚å¯¹äº insert() å‡½æ•°æ¥è¯´ï¼ŒO(1) æ—¶é—´å¤æ‚åº¦çš„æ’å…¥å’Œ O(n) æ—¶é—´å¤æ‚åº¦çš„æ’å…¥ï¼Œå‡ºç°çš„é¢‘ç‡æ˜¯éå¸¸æœ‰è§„å¾‹çš„ï¼Œè€Œä¸”æœ‰ä¸€å®šçš„å‰åæ—¶åºå…³ç³»ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸€ä¸ª O(n) æ’å…¥ä¹‹åï¼Œç´§è·Ÿç€ n-1 ä¸ª O(1) çš„æ’å…¥æ“ä½œï¼Œå¾ªç¯å¾€å¤ã€‚\n\né’ˆå¯¹è¿™ç§ç‰¹æ®Šçš„åœºæ™¯ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ç§æ›´åŠ ç®€å•çš„åˆ†ææ–¹æ³•ï¼š**æ‘Šè¿˜åˆ†ææ³•**ï¼Œé€šè¿‡æ‘Šè¿˜åˆ†æå¾—åˆ°çš„æ—¶é—´å¤æ‚åº¦æˆ‘ä»¬èµ·äº†ä¸€ä¸ªåå­—ï¼Œå«**å‡æ‘Šæ—¶é—´å¤æ‚åº¦**ã€‚\n\né‚£ç©¶ç«Ÿå¦‚ä½•ä½¿ç”¨æ‘Šè¿˜åˆ†ææ³•æ¥åˆ†æç®—æ³•çš„å‡æ‘Šæ—¶é—´å¤æ‚åº¦å‘¢ï¼Ÿæ¯ä¸€æ¬¡ O(n) çš„æ’å…¥æ“ä½œï¼Œéƒ½ä¼šè·Ÿç€ n-1 æ¬¡ O(1) çš„æ’å…¥æ“ä½œï¼Œæ‰€ä»¥æŠŠè€—æ—¶å¤šçš„é‚£æ¬¡æ“ä½œå‡æ‘Šåˆ°æ¥ä¸‹æ¥çš„ n-1 æ¬¡è€—æ—¶å°‘çš„æ“ä½œä¸Šï¼Œå‡æ‘Šä¸‹æ¥ï¼Œè¿™ä¸€ç»„è¿ç»­çš„æ“ä½œçš„å‡æ‘Šæ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(1)ã€‚è¿™å°±æ˜¯å‡æ‘Šåˆ†æçš„å¤§è‡´æ€è·¯ã€‚\n\nå¯¹ä¸€ä¸ªæ•°æ®ç»“æ„è¿›è¡Œä¸€ç»„è¿ç»­æ“ä½œä¸­ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦éƒ½å¾ˆä½ï¼Œåªæœ‰ä¸ªåˆ«æƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œè€Œä¸”è¿™äº›æ“ä½œä¹‹é—´å­˜åœ¨å‰åè¿è´¯çš„æ—¶åºå…³ç³»ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†è¿™ä¸€ç»„æ“ä½œæ”¾åœ¨ä¸€å—å„¿åˆ†æï¼Œçœ‹æ˜¯å¦èƒ½å°†è¾ƒé«˜æ—¶é—´å¤æ‚åº¦é‚£æ¬¡æ“ä½œçš„è€—æ—¶ï¼Œå¹³æ‘Šåˆ°å…¶ä»–é‚£äº›æ—¶é—´å¤æ‚åº¦æ¯”è¾ƒä½çš„æ“ä½œä¸Šã€‚è€Œä¸”ï¼Œåœ¨èƒ½å¤Ÿåº”ç”¨å‡æ‘Šæ—¶é—´å¤æ‚åº¦åˆ†æçš„åœºåˆï¼Œä¸€èˆ¬å‡æ‘Šæ—¶é—´å¤æ‚åº¦å°±ç­‰äºæœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ã€‚\n\n**å‡æ‘Šæ—¶é—´å¤æ‚åº¦å°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¹³å‡æ—¶é—´å¤æ‚åº¦**ï¼Œæˆ‘ä»¬æ²¡å¿…è¦èŠ±å¤ªå¤šç²¾åŠ›å»åŒºåˆ†å®ƒä»¬ã€‚ä½ æœ€åº”è¯¥æŒæ¡çš„æ˜¯å®ƒçš„åˆ†ææ–¹æ³•ï¼Œæ‘Šè¿˜åˆ†æã€‚\n\n# æ•°æ®ç»“æ„\n\n## **æ•°ç»„**\n\næ•°ç»„ï¼ˆArrayï¼‰æ˜¯ä¸€ç§çº¿æ€§è¡¨æ•°æ®ç»“æ„ã€‚å®ƒç”¨ä¸€ç»„è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œæ¥å­˜å‚¨ä¸€ç»„å…·æœ‰ç›¸åŒç±»å‹çš„æ•°æ®ã€‚æ­£å› ä¸ºå¦‚æ­¤ä¹Ÿä½¿å¾—æ•°ç»„å…·æœ‰éšæœºè®¿é—®çš„ç‰¹æ€§ã€‚\n\nä½æ•ˆçš„â€œæ’å…¥â€å’Œâ€œåˆ é™¤â€ï¼šæ’å…¥å’Œåˆ é™¤çš„å¹³å‡æ—¶é—´å¤æ‚åº¦å‡ä¸ºO(n)ã€‚\n\nå®¹å™¨èƒ½å¦å®Œå…¨æ›¿ä»£æ•°ç»„ï¼Ÿ\n\nå®¹å™¨æœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯å¯ä»¥å°†å¾ˆå¤šæ•°ç»„æ“ä½œçš„ç»†èŠ‚å°è£…èµ·æ¥ã€‚æ¯”å¦‚å‰é¢æåˆ°çš„æ•°ç»„æ’å…¥ã€åˆ é™¤æ•°æ®æ—¶éœ€è¦æ¬ç§»å…¶ä»–æ•°æ®ç­‰ã€‚å¦å¤–ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªä¼˜åŠ¿ï¼Œå°±æ˜¯æ”¯æŒåŠ¨æ€æ‰©å®¹ã€‚\n\nä¸è¿‡ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå› ä¸ºæ‰©å®¹æ“ä½œæ¶‰åŠå†…å­˜ç”³è¯·å’Œæ•°æ®æ¬ç§»ï¼Œæ˜¯æ¯”è¾ƒè€—æ—¶çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœäº‹å…ˆèƒ½ç¡®å®šéœ€è¦å­˜å‚¨çš„æ•°æ®å¤§å°ï¼Œæœ€å¥½åœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™äº‹å…ˆæŒ‡å®šæ•°æ®å¤§å°ã€‚\n\næ€»ç»“ä¸€ä¸‹ï¼Œå¯¹äºä¸šåŠ¡å¼€å‘ï¼Œç›´æ¥ä½¿ç”¨å®¹å™¨å°±è¶³å¤Ÿäº†ï¼Œçœæ—¶çœåŠ›ã€‚æ¯•ç«ŸæŸè€—ä¸€ä¸¢ä¸¢æ€§èƒ½ï¼Œå®Œå…¨ä¸ä¼šå½±å“åˆ°ç³»ç»Ÿæ•´ä½“çš„æ€§èƒ½ã€‚ä½†å¦‚æœä½ æ˜¯åšä¸€äº›éå¸¸åº•å±‚çš„å¼€å‘ï¼Œæ¯”å¦‚å¼€å‘ç½‘ç»œæ¡†æ¶ï¼Œæ€§èƒ½çš„ä¼˜åŒ–éœ€è¦åšåˆ°æè‡´ï¼Œè¿™ä¸ªæ—¶å€™æ•°ç»„å°±ä¼šä¼˜äºå®¹å™¨ï¼Œæˆä¸ºé¦–é€‰ã€‚\n\n## **é“¾è¡¨**\n\nåº•å±‚çš„å­˜å‚¨ç»“æ„ä¸Šæ¥çœ‹ï¼Œæ•°ç»„éœ€è¦ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´æ¥å­˜å‚¨ï¼Œè€Œé“¾è¡¨æ°æ°ç›¸åï¼Œå®ƒå¹¶ä¸éœ€è¦ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå®ƒé€šè¿‡â€œæŒ‡é’ˆâ€å°†ä¸€ç»„é›¶æ•£çš„å†…å­˜å—ä¸²è”èµ·æ¥ä½¿ç”¨ã€‚\n\n![Untitled](Extras/Images/alg_7.png)\n\né“¾è¡¨ç»“æ„äº”èŠ±å…«é—¨ï¼Œä»Šå¤©ä»‹ç»ä¸‰ç§æœ€å¸¸è§çš„é“¾è¡¨ç»“æ„ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šå•é“¾è¡¨ã€åŒå‘é“¾è¡¨å’Œå¾ªç¯é“¾è¡¨ã€‚\n\n![Untitled](Extras/Images/alg_8.png)\n\nåœ¨è¿›è¡Œæ•°ç»„çš„æ’å…¥ã€åˆ é™¤æ“ä½œæ—¶ï¼Œä¸ºäº†ä¿æŒå†…å­˜æ•°æ®çš„è¿ç»­æ€§ï¼Œéœ€è¦åšå¤§é‡çš„æ•°æ®æ¬ç§»ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚è€Œåœ¨é“¾è¡¨ä¸­æ’å…¥æˆ–è€…åˆ é™¤ä¸€ä¸ªæ•°æ®ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ä¸ºäº†ä¿æŒå†…å­˜çš„è¿ç»­æ€§è€Œæ¬ç§»ç»“ç‚¹ï¼Œå› ä¸ºé“¾è¡¨çš„å­˜å‚¨ç©ºé—´æœ¬èº«å°±ä¸æ˜¯è¿ç»­çš„ã€‚é’ˆå¯¹é“¾è¡¨çš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘ç›¸é‚»ç»“ç‚¹çš„æŒ‡é’ˆæ”¹å˜ï¼Œæ‰€ä»¥å¯¹åº”çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚\n\nä½†æ˜¯ï¼Œæœ‰åˆ©å°±æœ‰å¼Šã€‚é“¾è¡¨è¦æƒ³éšæœºè®¿é—®ç¬¬ k ä¸ªå…ƒç´ ï¼Œå°±æ²¡æœ‰æ•°ç»„é‚£ä¹ˆé«˜æ•ˆäº†ã€‚å› ä¸ºé“¾è¡¨ä¸­çš„æ•°æ®å¹¶éè¿ç»­å­˜å‚¨çš„ï¼Œæ‰€ä»¥æ— æ³•åƒæ•°ç»„é‚£æ ·ï¼Œæ ¹æ®é¦–åœ°å€å’Œä¸‹æ ‡ï¼Œé€šè¿‡å¯»å€å…¬å¼å°±èƒ½ç›´æ¥è®¡ç®—å‡ºå¯¹åº”çš„å†…å­˜åœ°å€ï¼Œè€Œæ˜¯éœ€è¦æ ¹æ®æŒ‡é’ˆä¸€ä¸ªç»“ç‚¹ä¸€ä¸ªç»“ç‚¹åœ°ä¾æ¬¡éå†ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸åº”çš„ç»“ç‚¹ã€‚\n\n**å¾ªç¯é“¾è¡¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„å•é“¾è¡¨ã€‚**\n\n![Untitled](Extras/Images/alg_9.png)\n\nå•å‘é“¾è¡¨åªæœ‰ä¸€ä¸ªæ–¹å‘ï¼Œç»“ç‚¹åªæœ‰ä¸€ä¸ªåç»§æŒ‡é’ˆ next æŒ‡å‘åé¢çš„ç»“ç‚¹ã€‚è€Œ**åŒå‘é“¾è¡¨**ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒæ”¯æŒä¸¤ä¸ªæ–¹å‘ï¼Œæ¯ä¸ªç»“ç‚¹ä¸æ­¢æœ‰ä¸€ä¸ªåç»§æŒ‡é’ˆ next æŒ‡å‘åé¢çš„ç»“ç‚¹ï¼Œè¿˜æœ‰ä¸€ä¸ªå‰é©±æŒ‡é’ˆ prev æŒ‡å‘å‰é¢çš„ç»“ç‚¹ã€‚\n\n![Untitled](Extras/Images/alg_10.png)\n\nè¿™é‡Œæœ‰ä¸€ä¸ªæ›´åŠ é‡è¦çš„çŸ¥è¯†ç‚¹éœ€è¦ä½ æŒæ¡ï¼Œé‚£å°±æ˜¯ç”¨ç©ºé—´æ¢æ—¶é—´çš„è®¾è®¡æ€æƒ³ã€‚å½“å†…å­˜ç©ºé—´å……è¶³çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬æ›´åŠ è¿½æ±‚ä»£ç çš„æ‰§è¡Œé€Ÿåº¦ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€‰æ‹©ç©ºé—´å¤æ‚åº¦ç›¸å¯¹è¾ƒé«˜ã€ä½†æ—¶é—´å¤æ‚åº¦ç›¸å¯¹å¾ˆä½çš„ç®—æ³•æˆ–è€…æ•°æ®ç»“æ„ã€‚ç›¸åï¼Œå¦‚æœå†…å­˜æ¯”è¾ƒç´§ç¼ºï¼Œæ¯”å¦‚ä»£ç è·‘åœ¨æ‰‹æœºæˆ–è€…å•ç‰‡æœºä¸Šï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±è¦åè¿‡æ¥ç”¨æ—¶é—´æ¢ç©ºé—´çš„è®¾è®¡æ€è·¯ã€‚\n\nå¯¹äºæ‰§è¡Œè¾ƒæ…¢çš„ç¨‹åºï¼Œå¯ä»¥é€šè¿‡æ¶ˆè€—æ›´å¤šçš„å†…å­˜ï¼ˆç©ºé—´æ¢æ—¶é—´ï¼‰æ¥è¿›è¡Œä¼˜åŒ–ï¼›è€Œæ¶ˆè€—è¿‡å¤šå†…å­˜çš„ç¨‹åºï¼Œå¯ä»¥é€šè¿‡æ¶ˆè€—æ›´å¤šçš„æ—¶é—´ï¼ˆæ—¶é—´æ¢ç©ºé—´ï¼‰æ¥é™ä½å†…å­˜çš„æ¶ˆè€—ã€‚\n\näº†è§£äº†å¾ªç¯é“¾è¡¨å’ŒåŒå‘é“¾è¡¨ï¼Œå¦‚æœæŠŠè¿™ä¸¤ç§é“¾è¡¨æ•´åˆåœ¨ä¸€èµ·å°±æ˜¯ä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼š**åŒå‘å¾ªç¯é“¾è¡¨**ã€‚\n\n![Untitled](Extras/Images/alg_11.png)\n\n### é“¾è¡¨ VS æ•°ç»„æ€§èƒ½å¤§æ¯”æ‹¼\n\n![Untitled](Extras/Images/alg_12.png)\n\næ•°ç»„ç®€å•æ˜“ç”¨ï¼Œåœ¨å®ç°ä¸Šä½¿ç”¨çš„æ˜¯è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥å€ŸåŠ© CPU çš„ç¼“å­˜æœºåˆ¶ï¼Œé¢„è¯»æ•°ç»„ä¸­çš„æ•°æ®ï¼Œæ‰€ä»¥è®¿é—®æ•ˆç‡æ›´é«˜ã€‚è€Œé“¾è¡¨åœ¨å†…å­˜ä¸­å¹¶ä¸æ˜¯è¿ç»­å­˜å‚¨ï¼Œæ‰€ä»¥å¯¹ CPU ç¼“å­˜ä¸å‹å¥½ï¼Œæ²¡åŠæ³•æœ‰æ•ˆé¢„è¯»ã€‚\n\né“¾è¡¨ä¸­çš„æ¯ä¸ªç»“ç‚¹éƒ½éœ€è¦æ¶ˆè€—é¢å¤–çš„å­˜å‚¨ç©ºé—´å»å­˜å‚¨ä¸€ä»½æŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹çš„æŒ‡é’ˆï¼Œæ‰€ä»¥å†…å­˜æ¶ˆè€—ä¼šç¿»å€ã€‚è€Œä¸”ï¼Œå¯¹é“¾è¡¨è¿›è¡Œé¢‘ç¹çš„æ’å…¥ã€åˆ é™¤æ“ä½œï¼Œè¿˜ä¼šå¯¼è‡´é¢‘ç¹çš„å†…å­˜ç”³è¯·å’Œé‡Šæ”¾ï¼Œå®¹æ˜“é€ æˆå†…å­˜ç¢ç‰‡ï¼Œå¦‚æœæ˜¯ Java è¯­è¨€ï¼Œå°±æœ‰å¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹çš„ GCï¼ˆGarbage Collectionï¼Œåƒåœ¾å›æ”¶ï¼‰ã€‚\n\nå’Œæ•°ç»„ç›¸æ¯”ï¼Œé“¾è¡¨æ›´é€‚åˆæ’å…¥ã€åˆ é™¤æ“ä½œé¢‘ç¹çš„åœºæ™¯ï¼ŒæŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦è¾ƒé«˜ã€‚ä¸è¿‡ï¼Œåœ¨å…·ä½“è½¯ä»¶å¼€å‘ä¸­ï¼Œè¦å¯¹æ•°ç»„å’Œé“¾è¡¨çš„å„ç§æ€§èƒ½è¿›è¡Œå¯¹æ¯”ï¼Œç»¼åˆæ¥é€‰æ‹©ä½¿ç”¨ä¸¤è€…ä¸­çš„å“ªä¸€ä¸ªã€‚\n\n### å‡ ä¸ªå†™é“¾è¡¨ä»£ç æŠ€å·§\n\n- **æŠ€å·§ä¸€ï¼šç†è§£æŒ‡é’ˆæˆ–å¼•ç”¨çš„å«ä¹‰**\n\n    å°†æŸä¸ªå˜é‡èµ‹å€¼ç»™æŒ‡é’ˆï¼Œå®é™…ä¸Šå°±æ˜¯å°†è¿™ä¸ªå˜é‡çš„åœ°å€èµ‹å€¼ç»™æŒ‡é’ˆï¼Œæˆ–è€…åè¿‡æ¥è¯´ï¼ŒæŒ‡é’ˆä¸­å­˜å‚¨äº†è¿™ä¸ªå˜é‡çš„å†…å­˜åœ°å€ï¼ŒæŒ‡å‘äº†è¿™ä¸ªå˜é‡ï¼Œé€šè¿‡æŒ‡é’ˆå°±èƒ½æ‰¾åˆ°è¿™ä¸ªå˜é‡ã€‚\n\n- **æŠ€å·§äºŒï¼šè­¦æƒ•æŒ‡é’ˆä¸¢å¤±å’Œå†…å­˜æ³„æ¼**\n\n    æ’å…¥ç»“ç‚¹æ—¶ï¼Œä¸€å®šè¦æ³¨æ„æ“ä½œçš„é¡ºåºã€‚åˆ é™¤é“¾è¡¨ç»“ç‚¹æ—¶ï¼Œä¹Ÿä¸€å®šè¦è®°å¾—æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚\n\n- **æŠ€å·§ä¸‰ï¼šåˆ©ç”¨å“¨å…µç®€åŒ–å®ç°éš¾åº¦**\n\n    é’ˆå¯¹é“¾è¡¨çš„æ’å…¥ã€åˆ é™¤æ“ä½œï¼Œéœ€è¦å¯¹æ’å…¥ç¬¬ä¸€ä¸ªç»“ç‚¹å’Œåˆ é™¤æœ€åä¸€ä¸ªç»“ç‚¹çš„æƒ…å†µè¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚\n\n    å¦‚æœæˆ‘ä»¬å¼•å…¥å“¨å…µç»“ç‚¹ï¼Œåœ¨ä»»ä½•æ—¶å€™ï¼Œä¸ç®¡é“¾è¡¨æ˜¯ä¸æ˜¯ç©ºï¼Œhead æŒ‡é’ˆéƒ½ä¼šä¸€ç›´æŒ‡å‘è¿™ä¸ªå“¨å…µç»“ç‚¹ã€‚æˆ‘ä»¬ä¹ŸæŠŠè¿™ç§æœ‰å“¨å…µç»“ç‚¹çš„é“¾è¡¨å«**å¸¦å¤´é“¾è¡¨**ã€‚ç›¸åï¼Œæ²¡æœ‰å“¨å…µç»“ç‚¹çš„é“¾è¡¨å°±å«ä½œä¸å¸¦å¤´é“¾è¡¨ã€‚\n\n    å“¨å…µç»“ç‚¹æ˜¯ä¸å­˜å‚¨æ•°æ®çš„ã€‚å› ä¸ºå“¨å…µç»“ç‚¹ä¸€ç›´å­˜åœ¨ï¼Œæ‰€ä»¥æ’å…¥ç¬¬ä¸€ä¸ªç»“ç‚¹å’Œæ’å…¥å…¶ä»–ç»“ç‚¹ï¼Œåˆ é™¤æœ€åä¸€ä¸ªç»“ç‚¹å’Œåˆ é™¤å…¶ä»–ç»“ç‚¹ï¼Œéƒ½å¯ä»¥ç»Ÿä¸€ä¸ºç›¸åŒçš„ä»£ç å®ç°é€»è¾‘äº†ã€‚\n\n    ![Untitled](Extras/Images/alg_13.png)\n\n- **æŠ€å·§å››ï¼šé‡ç‚¹ç•™æ„è¾¹ç•Œæ¡ä»¶å¤„ç†**\n    - å¦‚æœé“¾è¡¨ä¸ºç©ºæ—¶ï¼Œä»£ç æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œï¼Ÿ\n    - å¦‚æœé“¾è¡¨åªåŒ…å«ä¸€ä¸ªç»“ç‚¹æ—¶ï¼Œä»£ç æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œï¼Ÿ\n    - å¦‚æœé“¾è¡¨åªåŒ…å«ä¸¤ä¸ªç»“ç‚¹æ—¶ï¼Œä»£ç æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œï¼Ÿ\n    - ä»£ç é€»è¾‘åœ¨å¤„ç†å¤´ç»“ç‚¹å’Œå°¾ç»“ç‚¹çš„æ—¶å€™ï¼Œæ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œï¼Ÿ\n\n    ä¸å…‰å…‰æ˜¯å†™é“¾è¡¨ä»£ç ï¼Œä½ åœ¨å†™ä»»ä½•ä»£ç æ—¶ï¼Œä¹Ÿåƒä¸‡ä¸è¦åªæ˜¯å®ç°ä¸šåŠ¡æ­£å¸¸æƒ…å†µä¸‹çš„åŠŸèƒ½å°±å¥½äº†ï¼Œä¸€å®šè¦å¤šæƒ³æƒ³ï¼Œä½ çš„ä»£ç åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šé‡åˆ°å“ªäº›è¾¹ç•Œæƒ…å†µæˆ–è€…å¼‚å¸¸æƒ…å†µã€‚é‡åˆ°äº†åº”è¯¥å¦‚ä½•åº”å¯¹ï¼Œè¿™æ ·å†™å‡ºæ¥çš„ä»£ç æ‰å¤Ÿå¥å£®ï¼\n\n- **æŠ€å·§äº”ï¼šä¸¾ä¾‹ç”»å›¾ï¼Œè¾…åŠ©æ€è€ƒ**\n\n    å¯¹äºç¨å¾®å¤æ‚çš„é“¾è¡¨æ“ä½œï¼Œæ¯”å¦‚å‰é¢æˆ‘ä»¬æåˆ°çš„å•é“¾è¡¨åè½¬ï¼ŒæŒ‡é’ˆä¸€ä¼šå„¿æŒ‡è¿™ï¼Œä¸€ä¼šå„¿æŒ‡é‚£ï¼Œä¸€ä¼šå„¿å°±è¢«ç»•æ™•äº†ã€‚æ€»æ„Ÿè§‰è„‘å®¹é‡ä¸å¤Ÿï¼Œæƒ³ä¸æ¸…æ¥šã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±è¦ä½¿ç”¨å¤§æ‹›äº†ï¼Œä¸¾ä¾‹æ³•å’Œç”»å›¾æ³•ã€‚\n\n    ä½ å¯ä»¥æ‰¾ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼ŒæŠŠå®ƒç”»åœ¨çº¸ä¸Šï¼Œé‡Šæ”¾ä¸€äº›è„‘å®¹é‡ï¼Œç•™æ›´å¤šçš„ç»™é€»è¾‘æ€è€ƒï¼Œè¿™æ ·å°±ä¼šæ„Ÿè§‰åˆ°æ€è·¯æ¸…æ™°å¾ˆå¤šã€‚æ¯”å¦‚å¾€å•é“¾è¡¨ä¸­æ’å…¥ä¸€ä¸ªæ•°æ®è¿™æ ·ä¸€ä¸ªæ“ä½œï¼Œæˆ‘ä¸€èˆ¬éƒ½æ˜¯æŠŠå„ç§æƒ…å†µéƒ½ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œç”»å‡ºæ’å…¥å‰å’Œæ’å…¥åçš„é“¾è¡¨å˜åŒ–ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š\n\n    ![Untitled](Extras/Images/alg_14.png)\n\n- **æŠ€å·§å…­ï¼šå¤šå†™å¤šç»ƒï¼Œæ²¡æœ‰æ·å¾„**\n\n    æˆ‘ç²¾é€‰äº† 5 ä¸ªå¸¸è§çš„é“¾è¡¨æ“ä½œã€‚ä½ åªè¦æŠŠè¿™å‡ ä¸ªæ“ä½œéƒ½èƒ½å†™ç†Ÿç»ƒï¼Œä¸ç†Ÿå°±å¤šå†™å‡ éï¼Œæˆ‘ä¿è¯ä½ ä¹‹åå†ä¹Ÿä¸ä¼šå®³æ€•å†™é“¾è¡¨ä»£ç ã€‚\n\n    - å•é“¾è¡¨åè½¬\n    - é“¾è¡¨ä¸­ç¯çš„æ£€æµ‹\n    - ä¸¤ä¸ªæœ‰åºçš„é“¾è¡¨åˆå¹¶\n    - åˆ é™¤é“¾è¡¨å€’æ•°ç¬¬ n ä¸ªç»“ç‚¹\n    - æ±‚é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹\n\n## **æ ˆ**\n\nå…³äºâ€œæ ˆâ€ï¼Œæˆ‘æœ‰ä¸€ä¸ªéå¸¸è´´åˆ‡çš„ä¾‹å­ï¼Œå°±æ˜¯ä¸€æ‘å åœ¨ä¸€èµ·çš„ç›˜å­ã€‚æˆ‘ä»¬å¹³æ—¶æ”¾ç›˜å­çš„æ—¶å€™ï¼Œéƒ½æ˜¯ä»ä¸‹å¾€ä¸Šä¸€ä¸ªä¸€ä¸ªæ”¾ï¼›å–çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯ä»ä¸Šå¾€ä¸‹ä¸€ä¸ªä¸€ä¸ªåœ°ä¾æ¬¡å–ï¼Œä¸èƒ½ä»ä¸­é—´ä»»æ„æŠ½å‡ºã€‚**åè¿›è€…å…ˆå‡ºï¼Œå…ˆè¿›è€…åå‡ºï¼Œè¿™å°±æ˜¯å…¸å‹çš„â€œæ ˆâ€ç»“æ„ã€‚**\n\n![Untitled](Extras/Images/alg_15.png)\n\nä»æ ˆçš„æ“ä½œç‰¹æ€§ä¸Šæ¥çœ‹ï¼Œ**æ ˆæ˜¯ä¸€ç§â€œæ“ä½œå—é™â€çš„çº¿æ€§è¡¨ï¼Œåªå…è®¸åœ¨ä¸€ç«¯æ’å…¥å’Œåˆ é™¤æ•°æ®**ã€‚\n\nä»åŠŸèƒ½ä¸Šæ¥è¯´ï¼Œæ•°ç»„æˆ–é“¾è¡¨ç¡®å®å¯ä»¥æ›¿ä»£æ ˆï¼Œä½†ä½ è¦çŸ¥é“ï¼Œç‰¹å®šçš„æ•°æ®ç»“æ„æ˜¯å¯¹ç‰¹å®šåœºæ™¯çš„æŠ½è±¡ï¼Œè€Œä¸”ï¼Œæ•°ç»„æˆ–é“¾è¡¨æš´éœ²äº†å¤ªå¤šçš„æ“ä½œæ¥å£ï¼Œæ“ä½œä¸Šçš„ç¡®çµæ´»è‡ªç”±ï¼Œä½†ä½¿ç”¨æ—¶å°±æ¯”è¾ƒä¸å¯æ§ï¼Œè‡ªç„¶ä¹Ÿå°±æ›´å®¹æ˜“å‡ºé”™ã€‚\n\n**å½“æŸä¸ªæ•°æ®é›†åˆåªæ¶‰åŠåœ¨ä¸€ç«¯æ’å…¥å’Œåˆ é™¤æ•°æ®ï¼Œå¹¶ä¸”æ»¡è¶³åè¿›å…ˆå‡ºã€å…ˆè¿›åå‡ºçš„ç‰¹æ€§ï¼Œè¿™æ—¶æˆ‘ä»¬å°±åº”è¯¥é¦–é€‰â€œæ ˆâ€è¿™ç§æ•°æ®ç»“æ„ã€‚**\n\næ ˆæ—¢å¯ä»¥ç”¨æ•°ç»„æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨é“¾è¡¨æ¥å®ç°ã€‚ç”¨æ•°ç»„å®ç°çš„æ ˆï¼Œæˆ‘ä»¬å«ä½œ**é¡ºåºæ ˆ**ï¼Œç”¨é“¾è¡¨å®ç°çš„æ ˆï¼Œæˆ‘ä»¬å«ä½œ**é“¾å¼æ ˆ**ã€‚\n\n### æ ˆåœ¨è¡¨è¾¾å¼æ±‚å€¼ä¸­çš„åº”ç”¨\n\nç¼–è¯‘å™¨é€šè¿‡ä¸¤ä¸ªæ ˆæ¥å®ç°çš„ã€‚å…¶ä¸­ä¸€ä¸ªä¿å­˜æ“ä½œæ•°çš„æ ˆï¼Œå¦ä¸€ä¸ªæ˜¯ä¿å­˜è¿ç®—ç¬¦çš„æ ˆã€‚æˆ‘ä»¬ä»å·¦å‘å³éå†è¡¨è¾¾å¼ï¼Œå½“é‡åˆ°æ•°å­—ï¼Œæˆ‘ä»¬å°±ç›´æ¥å‹å…¥æ“ä½œæ•°æ ˆï¼›å½“é‡åˆ°è¿ç®—ç¬¦ï¼Œå°±ä¸è¿ç®—ç¬¦æ ˆçš„æ ˆé¡¶å…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚\n\nå¦‚æœæ¯”è¿ç®—ç¬¦æ ˆé¡¶å…ƒç´ çš„ä¼˜å…ˆçº§é«˜ï¼Œå°±å°†å½“å‰è¿ç®—ç¬¦å‹å…¥æ ˆï¼›å¦‚æœæ¯”è¿ç®—ç¬¦æ ˆé¡¶å…ƒç´ çš„ä¼˜å…ˆçº§ä½æˆ–è€…ç›¸åŒï¼Œä»è¿ç®—ç¬¦æ ˆä¸­å–æ ˆé¡¶è¿ç®—ç¬¦ï¼Œä»æ“ä½œæ•°æ ˆçš„æ ˆé¡¶å– 2 ä¸ªæ“ä½œæ•°ï¼Œç„¶åè¿›è¡Œè®¡ç®—ï¼Œå†æŠŠè®¡ç®—å®Œçš„ç»“æœå‹å…¥æ“ä½œæ•°æ ˆï¼Œç»§ç»­æ¯”è¾ƒã€‚\n\n![Untitled](Extras/Images/alg_16.png)\n\n### æ ˆåœ¨æ‹¬å·åŒ¹é…ä¸­çš„åº”ç”¨\n\næˆ‘ä»¬å‡è®¾è¡¨è¾¾å¼ä¸­åªåŒ…å«ä¸‰ç§æ‹¬å·ï¼Œåœ†æ‹¬å· ()ã€æ–¹æ‹¬å·[]å’ŒèŠ±æ‹¬å·{}ï¼Œå¹¶ä¸”å®ƒä»¬å¯ä»¥ä»»æ„åµŒå¥—ã€‚æ¯”å¦‚ï¼Œ{[] ()[{}]}æˆ–[{()}([])]ç­‰éƒ½ä¸ºåˆæ³•æ ¼å¼ï¼Œè€Œ{[}()]æˆ–[({)]ä¸ºä¸åˆæ³•çš„æ ¼å¼ã€‚é‚£æˆ‘ç°åœ¨ç»™ä½ ä¸€ä¸ªåŒ…å«ä¸‰ç§æ‹¬å·çš„è¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œå¦‚ä½•æ£€æŸ¥å®ƒæ˜¯å¦åˆæ³•å‘¢ï¼Ÿ\n\nè¿™é‡Œä¹Ÿå¯ä»¥ç”¨æ ˆæ¥è§£å†³ã€‚æˆ‘ä»¬ç”¨æ ˆæ¥ä¿å­˜æœªåŒ¹é…çš„å·¦æ‹¬å·ï¼Œä»å·¦åˆ°å³ä¾æ¬¡æ‰«æå­—ç¬¦ä¸²ã€‚å½“æ‰«æåˆ°å·¦æ‹¬å·æ—¶ï¼Œåˆ™å°†å…¶å‹å…¥æ ˆä¸­ï¼›å½“æ‰«æåˆ°å³æ‹¬å·æ—¶ï¼Œä»æ ˆé¡¶å–å‡ºä¸€ä¸ªå·¦æ‹¬å·ã€‚å¦‚æœèƒ½å¤ŸåŒ¹é…ï¼Œæ¯”å¦‚â€œ(â€è·Ÿâ€œ)â€åŒ¹é…ï¼Œâ€œ[â€è·Ÿâ€œ]â€åŒ¹é…ï¼Œâ€œ{â€è·Ÿâ€œ}â€åŒ¹é…ï¼Œåˆ™ç»§ç»­æ‰«æå‰©ä¸‹çš„å­—ç¬¦ä¸²ã€‚å¦‚æœæ‰«æçš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ä¸èƒ½é…å¯¹çš„å³æ‹¬å·ï¼Œæˆ–è€…æ ˆä¸­æ²¡æœ‰æ•°æ®ï¼Œåˆ™è¯´æ˜ä¸ºéæ³•æ ¼å¼ã€‚\n\nå½“æ‰€æœ‰çš„æ‹¬å·éƒ½æ‰«æå®Œæˆä¹‹åï¼Œå¦‚æœæ ˆä¸ºç©ºï¼Œåˆ™è¯´æ˜å­—ç¬¦ä¸²ä¸ºåˆæ³•æ ¼å¼ï¼›å¦åˆ™ï¼Œè¯´æ˜æœ‰æœªåŒ¹é…çš„å·¦æ‹¬å·ï¼Œä¸ºéæ³•æ ¼å¼ã€‚\n\n## **é˜Ÿåˆ—**\n\né˜Ÿåˆ—è¿™ä¸ªæ¦‚å¿µéå¸¸å¥½ç†è§£ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆæ’é˜Ÿä¹°ç¥¨ï¼Œå…ˆæ¥çš„å…ˆä¹°ï¼Œåæ¥çš„äººåªèƒ½ç«™æœ«å°¾ï¼Œä¸å…è®¸æ’é˜Ÿã€‚**å…ˆè¿›è€…å…ˆå‡ºï¼Œè¿™å°±æ˜¯å…¸å‹çš„â€œé˜Ÿåˆ—â€ã€‚**\n\né˜Ÿåˆ—è·Ÿæ ˆä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ç§æ“ä½œå—é™çš„çº¿æ€§è¡¨æ•°æ®ç»“æ„ã€‚\n\nè·Ÿæ ˆä¸€æ ·ï¼Œé˜Ÿåˆ—å¯ä»¥ç”¨æ•°ç»„æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨é“¾è¡¨æ¥å®ç°ã€‚ç”¨æ•°ç»„å®ç°çš„æ ˆå«ä½œé¡ºåºæ ˆï¼Œç”¨é“¾è¡¨å®ç°çš„æ ˆå«ä½œé“¾å¼æ ˆã€‚åŒæ ·ï¼Œç”¨æ•°ç»„å®ç°çš„é˜Ÿåˆ—å«ä½œ**é¡ºåºé˜Ÿåˆ—**ï¼Œç”¨é“¾è¡¨å®ç°çš„é˜Ÿåˆ—å«ä½œ**é“¾å¼é˜Ÿåˆ—**ã€‚\n\nåœ¨å®ç°ä¸Šï¼Œå¯¹äºæ ˆæ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ª**æ ˆé¡¶æŒ‡é’ˆ**å°±å¯ä»¥äº†ã€‚ä½†æ˜¯é˜Ÿåˆ—éœ€è¦ä¸¤ä¸ªæŒ‡é’ˆï¼šä¸€ä¸ªæ˜¯ head æŒ‡é’ˆï¼ŒæŒ‡å‘é˜Ÿå¤´ï¼›ä¸€ä¸ªæ˜¯ tail æŒ‡é’ˆï¼ŒæŒ‡å‘é˜Ÿå°¾ã€‚\n\n![Untitled](Extras/Images/alg_17.png)\n\n### å¾ªç¯é˜Ÿåˆ—\n\nè¦æƒ³å†™å‡ºæ²¡æœ‰ bug çš„å¾ªç¯é˜Ÿåˆ—çš„å®ç°ä»£ç ï¼Œæˆ‘ä¸ªäººè§‰å¾—ï¼Œæœ€å…³é”®çš„æ˜¯ï¼Œ**ç¡®å®šå¥½é˜Ÿç©ºå’Œé˜Ÿæ»¡çš„åˆ¤å®šæ¡ä»¶ã€‚**\n\né˜Ÿåˆ—ä¸ºç©ºçš„åˆ¤æ–­æ¡ä»¶ä»ç„¶æ˜¯ head == tailã€‚ä½†é˜Ÿåˆ—æ»¡çš„åˆ¤æ–­æ¡ä»¶å°±ç¨å¾®æœ‰ç‚¹å¤æ‚äº†ã€‚æˆ‘ç”»äº†ä¸€å¼ é˜Ÿåˆ—æ»¡çš„å›¾ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ï¼Œè¯•ç€æ€»ç»“ä¸€ä¸‹è§„å¾‹ã€‚\n\n![Untitled](Extras/Images/alg_18.png)\n\nå°±åƒæˆ‘å›¾ä¸­ç”»çš„é˜Ÿæ»¡çš„æƒ…å†µï¼Œtail=3ï¼Œhead=4ï¼Œn=8ï¼Œæ‰€ä»¥æ€»ç»“ä¸€ä¸‹è§„å¾‹å°±æ˜¯ï¼š(3+1)%8=4ã€‚å¤šç”»å‡ å¼ é˜Ÿæ»¡çš„å›¾ï¼Œä½ å°±ä¼šå‘ç°ï¼Œå½“é˜Ÿæ»¡æ—¶ï¼Œ**(tail+1)%n=head**ã€‚\n\nä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œå½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œå›¾ä¸­çš„ tail æŒ‡å‘çš„ä½ç½®å®é™…ä¸Šæ˜¯æ²¡æœ‰å­˜å‚¨æ•°æ®çš„ã€‚æ‰€ä»¥ï¼Œå¾ªç¯é˜Ÿåˆ—ä¼šæµªè´¹ä¸€ä¸ªæ•°ç»„çš„å­˜å‚¨ç©ºé—´ã€‚\n\n### **äºŒå‰æ ‘åŸºç¡€**\n\n### æ ‘ï¼ˆTreeï¼‰\n\nä¸‹é¢è¿™å¹…å›¾ï¼ŒA èŠ‚ç‚¹å°±æ˜¯ B èŠ‚ç‚¹çš„**çˆ¶èŠ‚ç‚¹**ï¼ŒB èŠ‚ç‚¹æ˜¯ A èŠ‚ç‚¹çš„**å­èŠ‚ç‚¹**ã€‚Bã€Cã€D è¿™ä¸‰ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥å®ƒä»¬ä¹‹é—´äº’ç§°ä¸º**å…„å¼ŸèŠ‚ç‚¹**ã€‚æˆ‘ä»¬æŠŠæ²¡æœ‰çˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹å«åš**æ ¹èŠ‚ç‚¹**ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„èŠ‚ç‚¹ Eã€‚æˆ‘ä»¬æŠŠæ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹å«åš**å¶å­èŠ‚ç‚¹**æˆ–è€…**å¶èŠ‚ç‚¹**ï¼Œæ¯”å¦‚å›¾ä¸­çš„ Gã€Hã€Iã€Jã€Kã€L éƒ½æ˜¯å¶å­èŠ‚ç‚¹ã€‚\n\n![Untitled](Extras/Images/alg_19.png)\n\nå…³äºâ€œæ ‘â€ï¼Œè¿˜æœ‰ä¸‰ä¸ªæ¯”è¾ƒç›¸ä¼¼çš„æ¦‚å¿µï¼šé«˜åº¦ï¼ˆHeightï¼‰ã€æ·±åº¦ï¼ˆDepthï¼‰ã€å±‚ï¼ˆLevelï¼‰ã€‚å®ƒä»¬çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š\n\n![Untitled](Extras/Images/alg_20.png)\n\nè¿™ä¸‰ä¸ªæ¦‚å¿µçš„å®šä¹‰æ¯”è¾ƒå®¹æ˜“æ··æ·†ï¼Œæè¿°èµ·æ¥ä¹Ÿæ¯”è¾ƒç©ºæ´ã€‚æˆ‘ä¸¾ä¸ªä¾‹å­è¯´æ˜ä¸€ä¸‹ï¼Œä½ ä¸€çœ‹åº”è¯¥å°±èƒ½æ˜ç™½ã€‚\n\n![Untitled](Extras/Images/alg_21.png)\n\nè®°è¿™å‡ ä¸ªæ¦‚å¿µï¼Œæˆ‘è¿˜æœ‰ä¸€ä¸ªå°çªé—¨ï¼Œå°±æ˜¯ç±»æ¯”â€œé«˜åº¦â€â€œæ·±åº¦â€â€œå±‚â€è¿™å‡ ä¸ªåè¯åœ¨ç”Ÿæ´»ä¸­çš„å«ä¹‰ã€‚\n\nåœ¨æˆ‘ä»¬çš„ç”Ÿæ´»ä¸­ï¼Œâ€œé«˜åº¦â€è¿™ä¸ªæ¦‚å¿µï¼Œå…¶å®å°±æ˜¯ä»ä¸‹å¾€ä¸Šåº¦é‡ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦åº¦é‡ç¬¬ 10 å±‚æ¥¼çš„é«˜åº¦ã€ç¬¬ 13 å±‚æ¥¼çš„é«˜åº¦ï¼Œèµ·ç‚¹éƒ½æ˜¯åœ°é¢ã€‚æ‰€ä»¥ï¼Œæ ‘è¿™ç§æ•°æ®ç»“æ„çš„é«˜åº¦ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä»æœ€åº•å±‚å¼€å§‹è®¡æ•°ï¼Œå¹¶ä¸”è®¡æ•°çš„èµ·ç‚¹æ˜¯ 0ã€‚\n\nâ€œæ·±åº¦â€è¿™ä¸ªæ¦‚å¿µåœ¨ç”Ÿæ´»ä¸­æ˜¯ä»ä¸Šå¾€ä¸‹åº¦é‡çš„ï¼Œæ¯”å¦‚æ°´ä¸­é±¼çš„æ·±åº¦ï¼Œæ˜¯ä»æ°´å¹³é¢å¼€å§‹åº¦é‡çš„ã€‚æ‰€ä»¥ï¼Œæ ‘è¿™ç§æ•°æ®ç»“æ„çš„æ·±åº¦ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä»æ ¹ç»“ç‚¹å¼€å§‹åº¦é‡ï¼Œå¹¶ä¸”è®¡æ•°èµ·ç‚¹ä¹Ÿæ˜¯ 0ã€‚\n\nâ€œå±‚æ•°â€è·Ÿæ·±åº¦çš„è®¡ç®—ç±»ä¼¼ï¼Œä¸è¿‡ï¼Œè®¡æ•°èµ·ç‚¹æ˜¯ 1ï¼Œä¹Ÿå°±æ˜¯è¯´æ ¹èŠ‚ç‚¹ä½äºç¬¬ 1 å±‚ã€‚\n\n### äºŒå‰æ ‘ï¼ˆBinary Treeï¼‰\n\näºŒå‰æ ‘ï¼Œé¡¾åæ€ä¹‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªâ€œå‰â€ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯å·¦å­èŠ‚ç‚¹å’Œå³å­èŠ‚ç‚¹ã€‚ä¸è¿‡ï¼ŒäºŒå‰æ ‘å¹¶ä¸è¦æ±‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œæœ‰çš„èŠ‚ç‚¹åªæœ‰å·¦å­èŠ‚ç‚¹ï¼Œæœ‰çš„èŠ‚ç‚¹åªæœ‰å³å­èŠ‚ç‚¹ã€‚\n\n![Untitled](Extras/Images/alg_22.png)\n\nç¼–å· 2 çš„äºŒå‰æ ‘ä¸­ï¼Œå¶å­èŠ‚ç‚¹å…¨éƒ½åœ¨æœ€åº•å±‚ï¼Œé™¤äº†å¶å­èŠ‚ç‚¹ä¹‹å¤–ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å·¦å³ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œè¿™ç§äºŒå‰æ ‘å°±å«åš**æ»¡äºŒå‰æ ‘**ã€‚\n\nç¼–å· 3 çš„äºŒå‰æ ‘ä¸­ï¼Œå¶å­èŠ‚ç‚¹éƒ½åœ¨æœ€åº•ä¸‹ä¸¤å±‚ï¼Œæœ€åä¸€å±‚çš„å¶å­èŠ‚ç‚¹éƒ½é å·¦æ’åˆ—ï¼Œå¹¶ä¸”é™¤äº†æœ€åä¸€å±‚ï¼Œå…¶ä»–å±‚çš„èŠ‚ç‚¹ä¸ªæ•°éƒ½è¦è¾¾åˆ°æœ€å¤§ï¼Œè¿™ç§äºŒå‰æ ‘å«åš**å®Œå…¨äºŒå‰æ ‘**ã€‚\n\nè¦ç†è§£å®Œå…¨äºŒå‰æ ‘å®šä¹‰çš„ç”±æ¥ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ï¼Œå¦‚ä½•**è¡¨ç¤ºï¼ˆæˆ–è€…å­˜å‚¨ï¼‰ä¸€æ£µäºŒå‰æ ‘**ï¼Ÿ\n\næƒ³è¦å­˜å‚¨ä¸€æ£µäºŒå‰æ ‘ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯åŸºäºæŒ‡é’ˆæˆ–è€…å¼•ç”¨çš„äºŒå‰é“¾å¼å­˜å‚¨æ³•ï¼Œä¸€ç§æ˜¯åŸºäºæ•°ç»„çš„é¡ºåºå­˜å‚¨æ³•ã€‚\n\næˆ‘ä»¬å…ˆæ¥çœ‹æ¯”è¾ƒç®€å•ã€ç›´è§‚çš„**é“¾å¼å­˜å‚¨æ³•**ã€‚ä»å›¾ä¸­ä½ åº”è¯¥å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸‰ä¸ªå­—æ®µï¼Œå…¶ä¸­ä¸€ä¸ªå­˜å‚¨æ•°æ®ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯æŒ‡å‘å·¦å³å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚æˆ‘ä»¬åªè¦æ‹ä½æ ¹èŠ‚ç‚¹ï¼Œå°±å¯ä»¥é€šè¿‡å·¦å³å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼ŒæŠŠæ•´æ£µæ ‘éƒ½ä¸²èµ·æ¥ã€‚è¿™ç§å­˜å‚¨æ–¹å¼æˆ‘ä»¬æ¯”è¾ƒå¸¸ç”¨ã€‚å¤§éƒ¨åˆ†äºŒå‰æ ‘ä»£ç éƒ½æ˜¯é€šè¿‡è¿™ç§ç»“æ„æ¥å®ç°çš„ã€‚\n\n![Untitled](Extras/Images/alg_23.png)\n\næˆ‘ä»¬å†æ¥çœ‹ï¼ŒåŸºäºæ•°ç»„çš„**é¡ºåºå­˜å‚¨æ³•**ã€‚æˆ‘ä»¬æŠŠæ ¹èŠ‚ç‚¹å­˜å‚¨åœ¨ä¸‹æ ‡ i = 1 çš„ä½ç½®ï¼Œé‚£å·¦å­èŠ‚ç‚¹å­˜å‚¨åœ¨ä¸‹æ ‡ 2 * i = 2 çš„ä½ç½®ï¼Œå³å­èŠ‚ç‚¹å­˜å‚¨åœ¨ 2 * i + 1 = 3 çš„ä½ç½®ã€‚ä»¥æ­¤ç±»æ¨ï¼ŒB èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹å­˜å‚¨åœ¨ 2 * i = 2 * 2 = 4 çš„ä½ç½®ï¼Œå³å­èŠ‚ç‚¹å­˜å‚¨åœ¨ 2 * i + 1 = 2 * 2 + 1 = 5 çš„ä½ç½®ã€‚\n\n![Untitled](Extras/Images/alg_24.png)\n\nå¦‚æœèŠ‚ç‚¹ X å­˜å‚¨åœ¨æ•°ç»„ä¸­ä¸‹æ ‡ä¸º i çš„ä½ç½®ï¼Œä¸‹æ ‡ä¸º 2 * i çš„ä½ç½®å­˜å‚¨çš„å°±æ˜¯å·¦å­èŠ‚ç‚¹ï¼Œä¸‹æ ‡ä¸º 2 * i + 1 çš„ä½ç½®å­˜å‚¨çš„å°±æ˜¯å³å­èŠ‚ç‚¹ã€‚åè¿‡æ¥ï¼Œä¸‹æ ‡ä¸º i/2 çš„ä½ç½®å­˜å‚¨å°±æ˜¯å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬åªè¦çŸ¥é“æ ¹èŠ‚ç‚¹å­˜å‚¨çš„ä½ç½®ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ºäº†æ–¹ä¾¿è®¡ç®—å­èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹ä¼šå­˜å‚¨åœ¨ä¸‹æ ‡ä¸º 1 çš„ä½ç½®ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ä¸‹æ ‡è®¡ç®—ï¼ŒæŠŠæ•´æ£µæ ‘éƒ½ä¸²èµ·æ¥ã€‚\n\nåˆšåˆšä¸¾çš„ä¾‹å­æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ï¼Œæ‰€ä»¥ä»…ä»…â€œæµªè´¹â€äº†ä¸€ä¸ªä¸‹æ ‡ä¸º 0 çš„å­˜å‚¨ä½ç½®ã€‚å¦‚æœæ˜¯éå®Œå…¨äºŒå‰æ ‘ï¼Œå…¶å®ä¼šæµªè´¹æ¯”è¾ƒå¤šçš„æ•°ç»„å­˜å‚¨ç©ºé—´ã€‚\n\n![Untitled](Extras/Images/alg_25.png)\n\næ‰€ä»¥ï¼Œå¦‚æœæŸæ£µäºŒå‰æ ‘æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ï¼Œé‚£ç”¨æ•°ç»„å­˜å‚¨æ— ç–‘æ˜¯æœ€èŠ‚çœå†…å­˜çš„ä¸€ç§æ–¹å¼ã€‚å› ä¸ºæ•°ç»„çš„å­˜å‚¨æ–¹å¼å¹¶ä¸éœ€è¦åƒé“¾å¼å­˜å‚¨æ³•é‚£æ ·ï¼Œè¦å­˜å‚¨é¢å¤–çš„å·¦å³å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå®Œå…¨äºŒå‰æ ‘ä¼šå•ç‹¬æ‹å‡ºæ¥çš„åŸå› ï¼Œä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå®Œå…¨äºŒå‰æ ‘è¦æ±‚æœ€åä¸€å±‚çš„å­èŠ‚ç‚¹éƒ½é å·¦çš„åŸå› ã€‚\n\n### äºŒå‰æ ‘çš„éå†\n\nå¦‚ä½•å°†æ‰€æœ‰èŠ‚ç‚¹éƒ½éå†æ‰“å°å‡ºæ¥å‘¢ï¼Ÿç»å…¸çš„æ–¹æ³•æœ‰ä¸‰ç§ï¼Œå‰åºéå†ã€ä¸­åºéå†å’Œååºéå†ã€‚å…¶ä¸­ï¼Œå‰ã€ä¸­ã€ååºï¼Œè¡¨ç¤ºçš„æ˜¯èŠ‚ç‚¹ä¸å®ƒçš„å·¦å³å­æ ‘èŠ‚ç‚¹éå†æ‰“å°çš„å…ˆåé¡ºåºã€‚\n\n- å‰åºéå†æ˜¯æŒ‡ï¼Œå¯¹äºæ ‘ä¸­çš„ä»»æ„èŠ‚ç‚¹æ¥è¯´ï¼Œå…ˆæ‰“å°è¿™ä¸ªèŠ‚ç‚¹ï¼Œç„¶åå†æ‰“å°å®ƒçš„å·¦å­æ ‘ï¼Œæœ€åæ‰“å°å®ƒçš„å³å­æ ‘ã€‚\n- ä¸­åºéå†æ˜¯æŒ‡ï¼Œå¯¹äºæ ‘ä¸­çš„ä»»æ„èŠ‚ç‚¹æ¥è¯´ï¼Œå…ˆæ‰“å°å®ƒçš„å·¦å­æ ‘ï¼Œç„¶åå†æ‰“å°å®ƒæœ¬èº«ï¼Œæœ€åæ‰“å°å®ƒçš„å³å­æ ‘ã€‚\n- ååºéå†æ˜¯æŒ‡ï¼Œå¯¹äºæ ‘ä¸­çš„ä»»æ„èŠ‚ç‚¹æ¥è¯´ï¼Œå…ˆæ‰“å°å®ƒçš„å·¦å­æ ‘ï¼Œç„¶åå†æ‰“å°å®ƒçš„å³å­æ ‘ï¼Œæœ€åæ‰“å°è¿™ä¸ªèŠ‚ç‚¹æœ¬èº«ã€‚\n\n![Untitled](Extras/Images/alg_26.png)\n\n**å®é™…ä¸Šï¼ŒäºŒå‰æ ‘çš„å‰ã€ä¸­ã€ååºéå†å°±æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ã€‚**æ¯”å¦‚ï¼Œå‰åºéå†ï¼Œå…¶å®å°±æ˜¯å…ˆæ‰“å°æ ¹èŠ‚ç‚¹ï¼Œç„¶åå†é€’å½’åœ°æ‰“å°å·¦å­æ ‘ï¼Œæœ€åé€’å½’åœ°æ‰“å°å³å­æ ‘ã€‚\n\n```java\nå‰åºéå†çš„é€’æ¨å…¬å¼ï¼š\npreOrder(r) = print r-\u003epreOrder(r-\u003eleft)-\u003epreOrder(r-\u003eright)\n\nä¸­åºéå†çš„é€’æ¨å…¬å¼ï¼š\ninOrder(r) = inOrder(r-\u003eleft)-\u003eprint r-\u003einOrder(r-\u003eright)\n\nååºéå†çš„é€’æ¨å…¬å¼ï¼š\npostOrder(r) = postOrder(r-\u003eleft)-\u003epostOrder(r-\u003eright)-\u003eprint r\n```\n\n```java\nvoid preOrder(Node* root) {\n  if (root == null) return;\n  print root // æ­¤å¤„ä¸ºä¼ªä»£ç ï¼Œè¡¨ç¤ºæ‰“å°rootèŠ‚ç‚¹\n  preOrder(root-\u003eleft);\n  preOrder(root-\u003eright);\n}\n\nvoid inOrder(Node* root) {\n  if (root == null) return;\n  inOrder(root-\u003eleft);\n  print root // æ­¤å¤„ä¸ºä¼ªä»£ç ï¼Œè¡¨ç¤ºæ‰“å°rootèŠ‚ç‚¹\n  inOrder(root-\u003eright);\n}\n\nvoid postOrder(Node* root) {\n  if (root == null) return;\n  postOrder(root-\u003eleft);\n  postOrder(root-\u003eright);\n  print root // æ­¤å¤„ä¸ºä¼ªä»£ç ï¼Œè¡¨ç¤ºæ‰“å°rootèŠ‚ç‚¹\n}\n```\n\nä»å‰é¢ç”»çš„å‰ã€ä¸­ã€ååºéå†çš„é¡ºåºå›¾ï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šä¼šè¢«è®¿é—®ä¸¤æ¬¡ï¼Œæ‰€ä»¥éå†æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ï¼Œè·ŸèŠ‚ç‚¹çš„ä¸ªæ•° n æˆæ­£æ¯”ï¼Œä¹Ÿå°±æ˜¯è¯´äºŒå‰æ ‘éå†çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚\n\n### äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary Search Treeï¼‰\n\n**äºŒå‰æŸ¥æ‰¾æ ‘è¦æ±‚ï¼Œåœ¨æ ‘ä¸­çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…¶å·¦å­æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ï¼Œéƒ½è¦å°äºè¿™ä¸ªèŠ‚ç‚¹çš„å€¼ï¼Œè€Œå³å­æ ‘èŠ‚ç‚¹çš„å€¼éƒ½å¤§äºè¿™ä¸ªèŠ‚ç‚¹çš„å€¼ã€‚**\n\n1. **äºŒå‰æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾æ“ä½œ**\n\n    æˆ‘ä»¬å…ˆå–æ ¹èŠ‚ç‚¹ï¼Œå¦‚æœå®ƒç­‰äºæˆ‘ä»¬è¦æŸ¥æ‰¾çš„æ•°æ®ï¼Œé‚£å°±è¿”å›ã€‚å¦‚æœè¦æŸ¥æ‰¾çš„æ•°æ®æ¯”æ ¹èŠ‚ç‚¹çš„å€¼å°ï¼Œé‚£å°±åœ¨å·¦å­æ ‘ä¸­é€’å½’æŸ¥æ‰¾ï¼›å¦‚æœè¦æŸ¥æ‰¾çš„æ•°æ®æ¯”æ ¹èŠ‚ç‚¹çš„å€¼å¤§ï¼Œé‚£å°±åœ¨å³å­æ ‘ä¸­é€’å½’æŸ¥æ‰¾ã€‚\n\n    ![Untitled](Extras/Images/alg_27.png)\n\n    ```java\n    public class BinarySearchTree {\n      private Node tree;\n\n      public Node find(int data) {\n        Node p = tree;\n        while (p != null) {\n          if (data \u003c p.data) p = p.left;\n          else if (data \u003e p.data) p = p.right;\n          else return p;\n        }\n        return null;\n      }\n\n      public static class Node {\n        private int data;\n        private Node left;\n        private Node right;\n\n        public Node(int data) {\n          this.data = data;\n        }\n      }\n    }\n    ```\n\n2. **äºŒå‰æŸ¥æ‰¾æ ‘çš„æ’å…¥æ“ä½œ**\n\n    äºŒå‰æŸ¥æ‰¾æ ‘çš„æ’å…¥è¿‡ç¨‹æœ‰ç‚¹ç±»ä¼¼æŸ¥æ‰¾æ“ä½œã€‚æ–°æ’å…¥çš„æ•°æ®ä¸€èˆ¬éƒ½æ˜¯åœ¨å¶å­èŠ‚ç‚¹ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡æ¯”è¾ƒè¦æ’å…¥çš„æ•°æ®å’ŒèŠ‚ç‚¹çš„å¤§å°å…³ç³»ã€‚\n\n    å¦‚æœè¦æ’å…¥çš„æ•°æ®æ¯”èŠ‚ç‚¹çš„æ•°æ®å¤§ï¼Œå¹¶ä¸”èŠ‚ç‚¹çš„å³å­æ ‘ä¸ºç©ºï¼Œå°±å°†æ–°æ•°æ®ç›´æ¥æ’åˆ°å³å­èŠ‚ç‚¹çš„ä½ç½®ï¼›å¦‚æœä¸ä¸ºç©ºï¼Œå°±å†é€’å½’éå†å³å­æ ‘ï¼ŒæŸ¥æ‰¾æ’å…¥ä½ç½®ã€‚åŒç†ï¼Œå¦‚æœè¦æ’å…¥çš„æ•°æ®æ¯”èŠ‚ç‚¹æ•°å€¼å°ï¼Œå¹¶ä¸”èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ºç©ºï¼Œå°±å°†æ–°æ•°æ®æ’å…¥åˆ°å·¦å­èŠ‚ç‚¹çš„ä½ç½®ï¼›å¦‚æœä¸ä¸ºç©ºï¼Œå°±å†é€’å½’éå†å·¦å­æ ‘ï¼ŒæŸ¥æ‰¾æ’å…¥ä½ç½®ã€‚\n\n    ![Untitled](Extras/Images/alg_28.png)\n\n    ```java\n    public void insert(int data) {\n      if (tree == null) {\n        tree = new Node(data);\n        return;\n      }\n\n      Node p = tree;\n      while (p != null) {\n        if (data \u003e p.data) {\n          if (p.right == null) {\n            p.right = new Node(data);\n            return;\n          }\n          p = p.right;\n        } else { // data \u003c p.data\n          if (p.left == null) {\n            p.left = new Node(data);\n            return;\n          }\n          p = p.left;\n        }\n      }\n    }\n    ```\n\n3. **äºŒå‰æŸ¥æ‰¾æ ‘çš„åˆ é™¤æ“ä½œ**\n\n    é’ˆå¯¹è¦åˆ é™¤èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°çš„ä¸åŒï¼Œæˆ‘ä»¬éœ€è¦åˆ†ä¸‰ç§æƒ…å†µæ¥å¤„ç†ã€‚\n\n    ç¬¬ä¸€ç§æƒ…å†µæ˜¯ï¼Œå¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œæˆ‘ä»¬åªéœ€è¦ç›´æ¥å°†çˆ¶èŠ‚ç‚¹ä¸­ï¼ŒæŒ‡å‘è¦åˆ é™¤èŠ‚ç‚¹çš„æŒ‡é’ˆç½®ä¸º nullã€‚æ¯”å¦‚å›¾ä¸­çš„åˆ é™¤èŠ‚ç‚¹ 55ã€‚\n\n    ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼Œå¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼ˆåªæœ‰å·¦å­èŠ‚ç‚¹æˆ–è€…å³å­èŠ‚ç‚¹ï¼‰ï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ–°çˆ¶èŠ‚ç‚¹ä¸­ï¼ŒæŒ‡å‘è¦åˆ é™¤èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œè®©å®ƒæŒ‡å‘è¦åˆ é™¤èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å°±å¯ä»¥äº†ã€‚æ¯”å¦‚å›¾ä¸­çš„åˆ é™¤èŠ‚ç‚¹ 13ã€‚\n\n    ç¬¬ä¸‰ç§æƒ…å†µæ˜¯ï¼Œå¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œè¿™å°±æ¯”è¾ƒå¤æ‚äº†ã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°è¿™ä¸ªèŠ‚ç‚¹çš„å³å­æ ‘ä¸­çš„æœ€å°èŠ‚ç‚¹ï¼ŒæŠŠå®ƒæ›¿æ¢åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹ä¸Šã€‚ç„¶åå†åˆ é™¤æ‰è¿™ä¸ªæœ€å°èŠ‚ç‚¹ï¼Œå› ä¸ºæœ€å°èŠ‚ç‚¹è‚¯å®šæ²¡æœ‰å·¦å­èŠ‚ç‚¹ï¼ˆå¦‚æœæœ‰å·¦å­ç»“ç‚¹ï¼Œé‚£å°±ä¸æ˜¯æœ€å°èŠ‚ç‚¹äº†ï¼‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åº”ç”¨ä¸Šé¢ä¸¤æ¡è§„åˆ™æ¥åˆ é™¤è¿™ä¸ªæœ€å°èŠ‚ç‚¹ã€‚æ¯”å¦‚å›¾ä¸­çš„åˆ é™¤èŠ‚ç‚¹ 18ã€‚\n\n    ![Untitled](Extras/Images/alg_29.png)\n\n    ```java\n    public void delete(int data) {\n      Node p = tree; // pæŒ‡å‘è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œåˆå§‹åŒ–æŒ‡å‘æ ¹èŠ‚ç‚¹\n      Node pp = null; // ppè®°å½•çš„æ˜¯pçš„çˆ¶èŠ‚ç‚¹\n      while (p != null \u0026\u0026 p.data != data) {\n        pp = p;\n        if (data \u003e p.data) p = p.right;\n        else p = p.left;\n      }\n      if (p == null) return; // æ²¡æœ‰æ‰¾åˆ°\n\n      // è¦åˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹\n      if (p.left != null \u0026\u0026 p.right != null) { // æŸ¥æ‰¾å³å­æ ‘ä¸­æœ€å°èŠ‚ç‚¹\n        Node minP = p.right;\n        Node minPP = p; // minPPè¡¨ç¤ºminPçš„çˆ¶èŠ‚ç‚¹\n        while (minP.left != null) {\n          minPP = minP;\n          minP = minP.left;\n        }\n        p.data = minP.data; // å°†minPçš„æ•°æ®æ›¿æ¢åˆ°pä¸­\n        p = minP; // ä¸‹é¢å°±å˜æˆäº†åˆ é™¤minPäº†\n        pp = minPP;\n      }\n\n      // åˆ é™¤èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹æˆ–è€…ä»…æœ‰ä¸€ä¸ªå­èŠ‚ç‚¹\n      Node child; // pçš„å­èŠ‚ç‚¹\n      if (p.left != null) child = p.left;\n      else if (p.right != null) child = p.right;\n      else child = null;\n\n      if (pp == null) tree = child; // åˆ é™¤çš„æ˜¯æ ¹èŠ‚ç‚¹\n      else if (pp.left == p) pp.left = child;\n      else pp.right = child;\n    }\n    ```\n\n4. **äºŒå‰æŸ¥æ‰¾æ ‘çš„å…¶ä»–æ“ä½œ**\n\n    é™¤äº†æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œä¹‹å¤–ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘ä¸­è¿˜å¯ä»¥æ”¯æŒ**å¿«é€Ÿåœ°æŸ¥æ‰¾æœ€å¤§èŠ‚ç‚¹å’Œæœ€å°èŠ‚ç‚¹ã€å‰é©±èŠ‚ç‚¹å’Œåç»§èŠ‚ç‚¹**ã€‚\n\n    äºŒå‰æŸ¥æ‰¾æ ‘é™¤äº†æ”¯æŒä¸Šé¢å‡ ä¸ªæ“ä½œä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç‰¹æ€§ï¼Œå°±æ˜¯**ä¸­åºéå†äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå¯ä»¥è¾“å‡ºæœ‰åºçš„æ•°æ®åºåˆ—ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)**ï¼Œéå¸¸é«˜æ•ˆã€‚å› æ­¤ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘ä¹Ÿå«ä½œäºŒå‰æ’åºæ ‘ã€‚\n\n\n### æ”¯æŒé‡å¤æ•°æ®çš„äºŒå‰æŸ¥æ‰¾æ ‘\n\nå‰é¢æˆ‘ä»¬è®²çš„äºŒå‰æŸ¥æ‰¾æ ‘çš„æ“ä½œï¼Œé’ˆå¯¹çš„éƒ½æ˜¯ä¸å­˜åœ¨é”®å€¼ç›¸åŒçš„æƒ…å†µã€‚é‚£å¦‚æœå­˜å‚¨çš„ä¸¤ä¸ªå¯¹è±¡é”®å€¼ç›¸åŒï¼Œè¿™ç§æƒ…å†µè¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿæœ‰ä¸¤ç§è§£å†³æ–¹æ³•ã€‚\n\nç¬¬ä¸€ç§æ–¹æ³•æ¯”è¾ƒå®¹æ˜“ã€‚äºŒå‰æŸ¥æ‰¾æ ‘ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸ä»…ä¼šå­˜å‚¨ä¸€ä¸ªæ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬é€šè¿‡é“¾è¡¨å’Œæ”¯æŒåŠ¨æ€æ‰©å®¹çš„æ•°ç»„ç­‰æ•°æ®ç»“æ„ï¼ŒæŠŠå€¼ç›¸åŒçš„æ•°æ®éƒ½å­˜å‚¨åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚\n\nç¬¬äºŒç§æ–¹æ³•æ¯”è¾ƒä¸å¥½ç†è§£ï¼Œä¸è¿‡æ›´åŠ ä¼˜é›…ã€‚\n\næ¯ä¸ªèŠ‚ç‚¹ä»ç„¶åªå­˜å‚¨ä¸€ä¸ªæ•°æ®ã€‚åœ¨æŸ¥æ‰¾æ’å…¥ä½ç½®çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœç¢°åˆ°ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼ï¼Œä¸è¦æ’å…¥æ•°æ®çš„å€¼ç›¸åŒï¼Œæˆ‘ä»¬å°±å°†è¿™ä¸ªè¦æ’å…¥çš„æ•°æ®æ”¾åˆ°è¿™ä¸ªèŠ‚ç‚¹çš„å³å­æ ‘ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠŠè¿™ä¸ªæ–°æ’å…¥çš„æ•°æ®å½“ä½œå¤§äºè¿™ä¸ªèŠ‚ç‚¹çš„å€¼æ¥å¤„ç†ã€‚\n\n![Untitled](Extras/Images/alg_30.png)\n\nå½“è¦æŸ¥æ‰¾æ•°æ®çš„æ—¶å€™ï¼Œé‡åˆ°å€¼ç›¸åŒçš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¹¶ä¸åœæ­¢æŸ¥æ‰¾æ“ä½œï¼Œè€Œæ˜¯ç»§ç»­åœ¨å³å­æ ‘ä¸­æŸ¥æ‰¾ï¼Œç›´åˆ°é‡åˆ°å¶å­èŠ‚ç‚¹ï¼Œæ‰åœæ­¢ã€‚è¿™æ ·å°±å¯ä»¥æŠŠé”®å€¼ç­‰äºè¦æŸ¥æ‰¾å€¼çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ‰¾å‡ºæ¥ã€‚\n\n![Untitled](Extras/Images/alg_31.png)\n\nå¯¹äºåˆ é™¤æ“ä½œï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å…ˆæŸ¥æ‰¾åˆ°æ¯ä¸ªè¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œç„¶åå†æŒ‰å‰é¢è®²çš„åˆ é™¤æ“ä½œçš„æ–¹æ³•ï¼Œä¾æ¬¡åˆ é™¤ã€‚\n\n![Untitled](Extras/Images/alg_32.png)\n\n### äºŒå‰æŸ¥æ‰¾æ ‘çš„æ—¶é—´å¤æ‚åº¦\n\nä¸ç®¡æ“ä½œæ˜¯æ’å…¥ã€åˆ é™¤è¿˜æ˜¯æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦å…¶å®éƒ½è·Ÿæ ‘çš„é«˜åº¦æˆæ­£æ¯”ï¼Œä¹Ÿå°±æ˜¯ O(height)ã€‚\n\nåœ¨äºŒå‰æŸ¥æ‰¾æ ‘ä¸­ï¼ŒæŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤ç­‰å¾ˆå¤šæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½è·Ÿæ ‘çš„é«˜åº¦æˆæ­£æ¯”ã€‚ä¸¤ä¸ªæç«¯æƒ…å†µçš„æ—¶é—´å¤æ‚åº¦åˆ†åˆ«æ˜¯ O(n) å’Œ O(logn)ï¼Œåˆ†åˆ«å¯¹åº”äºŒå‰æ ‘é€€åŒ–æˆé“¾è¡¨çš„æƒ…å†µå’Œå®Œå…¨äºŒå‰æ ‘ã€‚\n\n## å †\n\n### å¦‚ä½•ç†è§£â€œå †â€ï¼Ÿ\n\nå †æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ‘ã€‚ä»€ä¹ˆæ ·çš„æ ‘æ‰æ˜¯å †ã€‚æˆ‘ç½—åˆ—äº†ä¸¤ç‚¹è¦æ±‚ï¼Œåªè¦æ»¡è¶³è¿™ä¸¤ç‚¹ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå †ã€‚\n\n- å †æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼›\n- å †ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¿…é¡»å¤§äºç­‰äºï¼ˆæˆ–å°äºç­‰äºï¼‰å…¶å­æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ã€‚\n\nå¯¹äºæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºç­‰äºå­æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹å€¼çš„å †ï¼Œæˆ‘ä»¬å«åšâ€œå¤§é¡¶å †â€ã€‚å¯¹äºæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å°äºç­‰äºå­æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹å€¼çš„å †ï¼Œæˆ‘ä»¬å«åšâ€œå°é¡¶å †â€ã€‚\n\n### å¦‚ä½•å®ç°ä¸€ä¸ªå †ï¼Ÿ\n\nè¦å®ç°ä¸€ä¸ªå †ï¼Œæˆ‘ä»¬å…ˆè¦çŸ¥é“ï¼Œ**å †éƒ½æ”¯æŒå“ªäº›æ“ä½œ**ä»¥åŠ**å¦‚ä½•å­˜å‚¨ä¸€ä¸ªå †**ã€‚\n\nä¹‹å‰è®²è¿‡ï¼Œå®Œå…¨äºŒå‰æ ‘æ¯”è¾ƒé€‚åˆç”¨æ•°ç»„æ¥å­˜å‚¨ã€‚ç”¨æ•°ç»„æ¥å­˜å‚¨å®Œå…¨äºŒå‰æ ‘æ˜¯éå¸¸èŠ‚çœå­˜å‚¨ç©ºé—´çš„ã€‚å› ä¸ºæˆ‘ä»¬ä¸éœ€è¦å­˜å‚¨å·¦å³å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå•çº¯åœ°é€šè¿‡æ•°ç»„çš„ä¸‹æ ‡ï¼Œå°±å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªèŠ‚ç‚¹çš„å·¦å³å­èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹ã€‚æ‰€ä»¥ï¼Œå †é€‚åˆç”¨æ•°ç»„æ¥å­˜å‚¨ã€‚\n\n1. **å¾€å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ **\n\n    å¾€å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ åï¼Œæˆ‘ä»¬éœ€è¦ç»§ç»­æ»¡è¶³å †çš„ä¸¤ä¸ªç‰¹æ€§ã€‚å¦‚æœæˆ‘ä»¬æŠŠæ–°æ’å…¥çš„å…ƒç´ æ”¾åˆ°å †çš„æœ€åï¼Œå°±ä¸ç¬¦åˆå †çš„ç‰¹æ€§äº†ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œè®©å…¶é‡æ–°æ»¡è¶³å †çš„ç‰¹æ€§ï¼Œè¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬èµ·äº†ä¸€ä¸ªåå­—ï¼Œå°±å«åš**å †åŒ–**ï¼ˆheapifyï¼‰ã€‚\n\n    å †åŒ–å®é™…ä¸Šæœ‰ä¸¤ç§ï¼Œä»ä¸‹å¾€ä¸Šå’Œä»ä¸Šå¾€ä¸‹ã€‚è¿™é‡Œæˆ‘å…ˆè®²**ä»ä¸‹å¾€ä¸Š**çš„å †åŒ–æ–¹æ³•ã€‚\n\n    ![Untitled](Extras/Images/alg_33.png)\n\n    å †åŒ–éå¸¸ç®€å•ï¼Œå°±æ˜¯é¡ºç€èŠ‚ç‚¹æ‰€åœ¨çš„è·¯å¾„ï¼Œå‘ä¸Šæˆ–è€…å‘ä¸‹ï¼Œå¯¹æ¯”ï¼Œç„¶åäº¤æ¢ã€‚æˆ‘ä»¬å¯ä»¥è®©æ–°æ’å…¥çš„èŠ‚ç‚¹ä¸çˆ¶èŠ‚ç‚¹å¯¹æ¯”å¤§å°ã€‚å¦‚æœä¸æ»¡è¶³å­èŠ‚ç‚¹å°äºç­‰äºçˆ¶èŠ‚ç‚¹çš„å¤§å°å…³ç³»ï¼Œæˆ‘ä»¬å°±äº’æ¢ä¸¤ä¸ªèŠ‚ç‚¹ã€‚ä¸€ç›´é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°çˆ¶å­èŠ‚ç‚¹ä¹‹é—´æ»¡è¶³åˆšè¯´çš„é‚£ç§å¤§å°å…³ç³»ã€‚\n\n    ![Untitled](Extras/Images/alg_34.png)\n\n    ```java\n    public class Heap {\n      private int[] a; // æ•°ç»„ï¼Œä»ä¸‹æ ‡1å¼€å§‹å­˜å‚¨æ•°æ®\n      private int n;  // å †å¯ä»¥å­˜å‚¨çš„æœ€å¤§æ•°æ®ä¸ªæ•°\n      private int count; // å †ä¸­å·²ç»å­˜å‚¨çš„æ•°æ®ä¸ªæ•°\n\n      public Heap(int capacity) {\n        a = new int[capacity + 1];\n        n = capacity;\n        count = 0;\n      }\n\n      public void insert(int data) {\n        if (count \u003e= n) return; // å †æ»¡äº†\n        ++count;\n        a[count] = data;\n        int i = count;\n        while (i/2 \u003e 0 \u0026\u0026 a[i] \u003e a[i/2]) { // è‡ªä¸‹å¾€ä¸Šå †åŒ–\n          swap(a, i, i/2); // swap()å‡½æ•°ä½œç”¨ï¼šäº¤æ¢ä¸‹æ ‡ä¸ºiå’Œi/2çš„ä¸¤ä¸ªå…ƒç´ \n          i = i/2;\n        }\n      }\n     }\n    ```\n\n2. **åˆ é™¤å †é¡¶å…ƒç´ **\n\n    ä»å †çš„å®šä¹‰çš„ç¬¬äºŒæ¡ä¸­ï¼Œä»»ä½•èŠ‚ç‚¹çš„å€¼éƒ½å¤§äºç­‰äºï¼ˆæˆ–å°äºç­‰äºï¼‰å­æ ‘èŠ‚ç‚¹çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå †é¡¶å…ƒç´ å­˜å‚¨çš„å°±æ˜¯å †ä¸­æ•°æ®çš„æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼ã€‚\n\n    æˆ‘ä»¬æŠŠæœ€åä¸€ä¸ªèŠ‚ç‚¹æ”¾åˆ°å †é¡¶ï¼Œç„¶ååˆ©ç”¨åŒæ ·çš„çˆ¶å­èŠ‚ç‚¹å¯¹æ¯”æ–¹æ³•ã€‚å¯¹äºä¸æ»¡è¶³çˆ¶å­èŠ‚ç‚¹å¤§å°å…³ç³»çš„ï¼Œäº’æ¢ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”é‡å¤è¿›è¡Œè¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°çˆ¶å­èŠ‚ç‚¹ä¹‹é—´æ»¡è¶³å¤§å°å…³ç³»ä¸ºæ­¢ã€‚è¿™å°±æ˜¯**ä»ä¸Šå¾€ä¸‹çš„å †åŒ–æ–¹æ³•**ã€‚\n\n    å› ä¸ºæˆ‘ä»¬ç§»é™¤çš„æ˜¯æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œè€Œåœ¨å †åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½æ˜¯äº¤æ¢æ“ä½œï¼Œä¸ä¼šå‡ºç°æ•°ç»„ä¸­çš„â€œç©ºæ´â€ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•å †åŒ–ä¹‹åçš„ç»“æœï¼Œè‚¯å®šæ»¡è¶³å®Œå…¨äºŒå‰æ ‘çš„ç‰¹æ€§ã€‚\n\n    ![Untitled](Extras/Images/alg_35.png)\n\n    ```java\n    public void removeMax() {\n      if (count == 0) return -1; // å †ä¸­æ²¡æœ‰æ•°æ®\n      a[1] = a[count];\n      --count;\n      heapify(a, count, 1);\n    }\n\n    private void heapify(int[] a, int n, int i) { // è‡ªä¸Šå¾€ä¸‹å †åŒ–\n      while (true) {\n        int maxPos = i;\n        if (i*2 \u003c= n \u0026\u0026 a[i] \u003c a[i*2]) maxPos = i*2;\n        if (i*2+1 \u003c= n \u0026\u0026 a[maxPos] \u003c a[i*2+1]) maxPos = i*2+1;\n        if (maxPos == i) break;\n        swap(a, i, maxPos);\n        i = maxPos;\n      }\n    }\n    ```\n\n    æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªåŒ…å« n ä¸ªèŠ‚ç‚¹çš„å®Œå…¨äºŒå‰æ ‘ï¼Œæ ‘çš„é«˜åº¦ä¸ä¼šè¶…è¿‡ log2nã€‚å †åŒ–çš„è¿‡ç¨‹æ˜¯é¡ºç€èŠ‚ç‚¹æ‰€åœ¨è·¯å¾„æ¯”è¾ƒäº¤æ¢çš„ï¼Œæ‰€ä»¥å †åŒ–çš„æ—¶é—´å¤æ‚åº¦è·Ÿæ ‘çš„é«˜åº¦æˆæ­£æ¯”ï¼Œä¹Ÿå°±æ˜¯ O(logn)ã€‚æ’å…¥æ•°æ®å’Œåˆ é™¤å †é¡¶å…ƒç´ çš„ä¸»è¦é€»è¾‘å°±æ˜¯å †åŒ–ï¼Œæ‰€ä»¥ï¼Œå¾€å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ å’Œåˆ é™¤å †é¡¶å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logn)ã€‚\n\n\n### å¦‚ä½•åŸºäºå †å®ç°æ’åºï¼Ÿ\n\næˆ‘ä»¬å€ŸåŠ©äºå †è¿™ç§æ•°æ®ç»“æ„å®ç°çš„æ’åºç®—æ³•ï¼Œå°±å«åšå †æ’åºã€‚è¿™ç§æ’åºæ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦éå¸¸ç¨³å®šï¼Œæ˜¯ O(nlogn)ï¼Œå¹¶ä¸”å®ƒè¿˜æ˜¯åŸåœ°æ’åºç®—æ³•ã€‚\n\næˆ‘ä»¬å¯ä»¥æŠŠå †æ’åºçš„è¿‡ç¨‹å¤§è‡´åˆ†è§£æˆä¸¤ä¸ªå¤§çš„æ­¥éª¤ï¼Œ**å»ºå †**å’Œ**æ’åº**ã€‚\n\n1. **å»ºå †**\n\n    æˆ‘ä»¬é¦–å…ˆå°†æ•°ç»„åŸåœ°å»ºæˆä¸€ä¸ªå †ã€‚æ‰€è°“â€œåŸåœ°â€å°±æ˜¯ï¼Œä¸å€ŸåŠ©å¦ä¸€ä¸ªæ•°ç»„ï¼Œå°±åœ¨åŸæ•°ç»„ä¸Šæ“ä½œã€‚å»ºå †çš„è¿‡ç¨‹ï¼Œæœ‰ä¸¤ç§æ€è·¯ã€‚\n\n    ç¬¬ä¸€ç§æ˜¯å€ŸåŠ©æˆ‘ä»¬å‰é¢è®²çš„ï¼Œåœ¨å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ çš„æ€è·¯ã€‚å°½ç®¡æ•°ç»„ä¸­åŒ…å« n ä¸ªæ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å‡è®¾ï¼Œèµ·åˆå †ä¸­åªåŒ…å«ä¸€ä¸ªæ•°æ®ï¼Œå°±æ˜¯ä¸‹æ ‡ä¸º 1 çš„æ•°æ®ã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨å‰é¢è®²çš„æ’å…¥æ“ä½œï¼Œå°†ä¸‹æ ‡ä» 2 åˆ° n çš„æ•°æ®ä¾æ¬¡æ’å…¥åˆ°å †ä¸­ã€‚è¿™æ ·æˆ‘ä»¬å°±å°†åŒ…å« n ä¸ªæ•°æ®çš„æ•°ç»„ï¼Œç»„ç»‡æˆäº†å †ã€‚\n\n    ç¬¬äºŒç§å®ç°æ€è·¯ï¼Œè·Ÿç¬¬ä¸€ç§æˆªç„¶ç›¸åï¼Œä¹Ÿæ˜¯æˆ‘è¿™é‡Œè¦è¯¦ç»†è®²çš„ã€‚ç¬¬ä¸€ç§å»ºå †æ€è·¯çš„å¤„ç†è¿‡ç¨‹æ˜¯ä»å‰å¾€åå¤„ç†æ•°ç»„æ•°æ®ï¼Œå¹¶ä¸”æ¯ä¸ªæ•°æ®æ’å…¥å †ä¸­æ—¶ï¼Œéƒ½æ˜¯ä»ä¸‹å¾€ä¸Šå †åŒ–ã€‚è€Œç¬¬äºŒç§å®ç°æ€è·¯ï¼Œæ˜¯ä»åå¾€å‰å¤„ç†æ•°ç»„ï¼Œå¹¶ä¸”æ¯ä¸ªæ•°æ®éƒ½æ˜¯ä»ä¸Šå¾€ä¸‹å †åŒ–ã€‚\n\n    å› ä¸ºå¶å­èŠ‚ç‚¹å¾€ä¸‹å †åŒ–åªèƒ½è‡ªå·±è·Ÿè‡ªå·±æ¯”è¾ƒï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡å †åŒ–å°±è¡Œäº†ã€‚\n\n    ![Untitled](Extras/Images/alg_36.png)\n\n    ![Untitled](Extras/Images/alg_37.png)\n\n    ```java\n    private static void buildHeap(int[] a, int n) {\n      for (int i = n/2; i \u003e= 1; --i) {\n        heapify(a, n, i);\n      }\n    }\n\n    private static void heapify(int[] a, int n, int i) {\n      while (true) {\n        int maxPos = i;\n        if (i*2 \u003c= n \u0026\u0026 a[i] \u003c a[i*2]) maxPos = i*2;\n        if (i*2+1 \u003c= n \u0026\u0026 a[maxPos] \u003c a[i*2+1]) maxPos = i*2+1;\n        if (maxPos == i) break;\n        swap(a, i, maxPos);\n        i = maxPos;\n      }\n    }\n    ```\n\n    åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯¹ä¸‹æ ‡ä» 2n å¼€å§‹åˆ° 1 çš„æ•°æ®è¿›è¡Œå †åŒ–ï¼Œä¸‹æ ‡æ˜¯ 2n+1 åˆ° n çš„èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ï¼Œæˆ‘ä»¬ä¸éœ€è¦å †åŒ–ã€‚å®é™…ä¸Šï¼Œå¯¹äºå®Œå…¨äºŒå‰æ ‘æ¥è¯´ï¼Œä¸‹æ ‡ä» 2n+1 åˆ° n çš„èŠ‚ç‚¹éƒ½æ˜¯å¶å­èŠ‚ç‚¹ã€‚\n\n    **å»ºå †çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚**\n\n2. **æ’åº**\n\n    å»ºå †ç»“æŸä¹‹åï¼Œæ•°ç»„ä¸­çš„æ•°æ®å·²ç»æ˜¯æŒ‰ç…§å¤§é¡¶å †çš„ç‰¹æ€§æ¥ç»„ç»‡çš„ã€‚æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯å †é¡¶ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§çš„å…ƒç´ ã€‚æˆ‘ä»¬æŠŠå®ƒè·Ÿæœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œé‚£æœ€å¤§å…ƒç´ å°±æ”¾åˆ°äº†ä¸‹æ ‡ä¸º n çš„ä½ç½®ã€‚\n\n    è¿™ä¸ªè¿‡ç¨‹æœ‰ç‚¹ç±»ä¼¼ä¸Šé¢è®²çš„â€œåˆ é™¤å †é¡¶å…ƒç´ â€çš„æ“ä½œï¼Œå½“å †é¡¶å…ƒç´ ç§»é™¤ä¹‹åï¼Œæˆ‘ä»¬æŠŠä¸‹æ ‡ä¸º n çš„å…ƒç´ æ”¾åˆ°å †é¡¶ï¼Œç„¶åå†é€šè¿‡å †åŒ–çš„æ–¹æ³•ï¼Œå°†å‰©ä¸‹çš„ nâˆ’1 ä¸ªå…ƒç´ é‡æ–°æ„å»ºæˆå †ã€‚å †åŒ–å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å†å–å †é¡¶çš„å…ƒç´ ï¼Œæ”¾åˆ°ä¸‹æ ‡æ˜¯ nâˆ’1 çš„ä½ç½®ï¼Œä¸€ç›´é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æœ€åå †ä¸­åªå‰©ä¸‹æ ‡ä¸º 1 çš„ä¸€ä¸ªå…ƒç´ ï¼Œæ’åºå·¥ä½œå°±å®Œæˆäº†ã€‚\n\n    ![Untitled](Extras/Images/alg_38.png)\n\n    ```java\n    // nè¡¨ç¤ºæ•°æ®çš„ä¸ªæ•°ï¼Œæ•°ç»„aä¸­çš„æ•°æ®ä»ä¸‹æ ‡1åˆ°nçš„ä½ç½®ã€‚\n    public static void sort(int[] a, int n) {\n      buildHeap(a, n);\n      int k = n;\n      while (k \u003e 1) {\n        swap(a, 1, k);\n        --k;\n        heapify(a, k, 1);\n      }\n    }\n    ```\n\n    æ•´ä¸ªå †æ’åºçš„è¿‡ç¨‹ï¼Œéƒ½åªéœ€è¦æä¸ªåˆ«ä¸´æ—¶å­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥å †æ’åºæ˜¯åŸåœ°æ’åºç®—æ³•**ã€‚å †æ’åºåŒ…æ‹¬å»ºå †å’Œæ’åºä¸¤ä¸ªæ“ä½œï¼Œå»ºå †è¿‡ç¨‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Œæ’åºè¿‡ç¨‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogn)ï¼Œæ‰€ä»¥ï¼Œå †æ’åºæ•´ä½“çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogn)ã€‚**\n\n    å †æ’åºä¸æ˜¯ç¨³å®šçš„æ’åºç®—æ³•ï¼Œå› ä¸ºåœ¨æ’åºçš„è¿‡ç¨‹ï¼Œå­˜åœ¨å°†å †çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹è·Ÿå †é¡¶èŠ‚ç‚¹äº’æ¢çš„æ“ä½œï¼Œæ‰€ä»¥å°±æœ‰å¯èƒ½æ”¹å˜å€¼ç›¸åŒæ•°æ®çš„åŸå§‹ç›¸å¯¹é¡ºåºã€‚\n\n\næˆ‘è¿™é‡Œè¦ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼Œåœ¨å‰é¢çš„è®²è§£ä»¥åŠä»£ç ä¸­ï¼Œæˆ‘éƒ½å‡è®¾ï¼Œå †ä¸­çš„æ•°æ®æ˜¯ä»æ•°ç»„ä¸‹æ ‡ä¸º 1 çš„ä½ç½®å¼€å§‹å­˜å‚¨ã€‚é‚£å¦‚æœä» 0 å¼€å§‹å­˜å‚¨ï¼Œå®é™…ä¸Šå¤„ç†æ€è·¯æ˜¯æ²¡æœ‰ä»»ä½•å˜åŒ–çš„ï¼Œå”¯ä¸€å˜åŒ–çš„ï¼Œå¯èƒ½å°±æ˜¯ï¼Œä»£ç å®ç°çš„æ—¶å€™ï¼Œè®¡ç®—å­èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„ä¸‹æ ‡çš„å…¬å¼æ”¹å˜äº†ã€‚\n\nå¦‚æœèŠ‚ç‚¹çš„ä¸‹æ ‡æ˜¯ iï¼Œé‚£å·¦å­èŠ‚ç‚¹çš„ä¸‹æ ‡å°±æ˜¯ 2âˆ—i+1ï¼Œå³å­èŠ‚ç‚¹çš„ä¸‹æ ‡å°±æ˜¯ 2âˆ—i+2ï¼Œçˆ¶èŠ‚ç‚¹çš„ä¸‹æ ‡å°±æ˜¯ 2iâˆ’1ã€‚\n\n### åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸ºä»€ä¹ˆå¿«é€Ÿæ’åºè¦æ¯”å †æ’åºæ€§èƒ½å¥½ï¼Ÿ\n\n- **ç¬¬ä¸€ç‚¹ï¼Œå †æ’åºæ•°æ®è®¿é—®çš„æ–¹å¼æ²¡æœ‰å¿«é€Ÿæ’åºå‹å¥½ã€‚**\n\n    å¯¹äºå¿«é€Ÿæ’åºæ¥è¯´ï¼Œæ•°æ®æ˜¯é¡ºåºè®¿é—®çš„ã€‚è€Œå¯¹äºå †æ’åºæ¥è¯´ï¼Œæ•°æ®æ˜¯è·³ç€è®¿é—®çš„ã€‚ æ¯”å¦‚ï¼Œå †æ’åºä¸­ï¼Œæœ€é‡è¦çš„ä¸€ä¸ªæ“ä½œå°±æ˜¯æ•°æ®çš„å †åŒ–ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œå¯¹å †é¡¶èŠ‚ç‚¹è¿›è¡Œå †åŒ–ï¼Œä¼šä¾æ¬¡è®¿é—®æ•°ç»„ä¸‹æ ‡æ˜¯ 1ï¼Œ2ï¼Œ4ï¼Œ8 çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯åƒå¿«é€Ÿæ’åºé‚£æ ·ï¼Œå±€éƒ¨é¡ºåºè®¿é—®ï¼Œæ‰€ä»¥ï¼Œè¿™æ ·å¯¹ CPU ç¼“å­˜æ˜¯ä¸å‹å¥½çš„ã€‚\n\n- **ç¬¬äºŒç‚¹ï¼Œå¯¹äºåŒæ ·çš„æ•°æ®ï¼Œåœ¨æ’åºè¿‡ç¨‹ä¸­ï¼Œå †æ’åºç®—æ³•çš„æ•°æ®äº¤æ¢æ¬¡æ•°è¦å¤šäºå¿«é€Ÿæ’åºã€‚**\n\n    æˆ‘ä»¬åœ¨è®²æ’åºçš„æ—¶å€™ï¼Œæè¿‡ä¸¤ä¸ªæ¦‚å¿µï¼Œæœ‰åºåº¦å’Œé€†åºåº¦ã€‚å¯¹äºåŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•æ¥è¯´ï¼Œæ•´ä¸ªæ’åºè¿‡ç¨‹å°±æ˜¯ç”±ä¸¤ä¸ªåŸºæœ¬çš„æ“ä½œç»„æˆçš„ï¼Œæ¯”è¾ƒå’Œäº¤æ¢ï¼ˆæˆ–ç§»åŠ¨ï¼‰ã€‚å¿«é€Ÿæ’åºæ•°æ®äº¤æ¢çš„æ¬¡æ•°ä¸ä¼šæ¯”é€†åºåº¦å¤šã€‚\n\n    ä½†æ˜¯å †æ’åºçš„ç¬¬ä¸€æ­¥æ˜¯å»ºå †ï¼Œå»ºå †çš„è¿‡ç¨‹ä¼šæ‰“ä¹±æ•°æ®åŸæœ‰çš„ç›¸å¯¹å…ˆåé¡ºåºï¼Œå¯¼è‡´åŸæ•°æ®çš„æœ‰åºåº¦é™ä½ã€‚æ¯”å¦‚ï¼Œå¯¹äºä¸€ç»„å·²ç»æœ‰åºçš„æ•°æ®æ¥è¯´ï¼Œç»è¿‡å»ºå †ä¹‹åï¼Œæ•°æ®åè€Œå˜å¾—æ›´æ— åºäº†ã€‚\n\n\n### å †çš„åº”ç”¨\n\nä¼˜å…ˆçº§é˜Ÿåˆ—ã€æ±‚ Top K é—®é¢˜å’Œæ±‚ä¸­ä½æ•°é—®é¢˜ã€‚\n\nä¼˜å…ˆçº§é˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—ï¼Œä¼˜å…ˆçº§é«˜çš„æ•°æ®å…ˆå‡ºé˜Ÿï¼Œè€Œä¸å†åƒæ™®é€šçš„é˜Ÿåˆ—é‚£æ ·ï¼Œå…ˆè¿›å…ˆå‡ºã€‚å®é™…ä¸Šï¼Œå †å°±å¯ä»¥çœ‹ä½œä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œåªæ˜¯ç§°è°“ä¸ä¸€æ ·ç½¢äº†ã€‚æ±‚ Top K é—®é¢˜åˆå¯ä»¥åˆ†ä¸ºé’ˆå¯¹é™æ€æ•°æ®å’Œé’ˆå¯¹åŠ¨æ€æ•°æ®ï¼Œåªéœ€è¦åˆ©ç”¨ä¸€ä¸ªå †ï¼Œå°±å¯ä»¥åšåˆ°éå¸¸é«˜æ•ˆç‡åœ°æŸ¥è¯¢ Top K çš„æ•°æ®ã€‚æ±‚ä¸­ä½æ•°å®é™…ä¸Šè¿˜æœ‰å¾ˆå¤šå˜å½¢ï¼Œæ¯”å¦‚æ±‚ 99 ç™¾åˆ†ä½æ•°æ®ã€90 ç™¾åˆ†ä½æ•°æ®ç­‰ï¼Œå¤„ç†çš„æ€è·¯éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå³åˆ©ç”¨ä¸¤ä¸ªå †ï¼Œä¸€ä¸ªå¤§é¡¶å †ï¼Œä¸€ä¸ªå°é¡¶å †ï¼Œéšç€æ•°æ®çš„åŠ¨æ€æ·»åŠ ï¼ŒåŠ¨æ€è°ƒæ•´ä¸¤ä¸ªå †ä¸­çš„æ•°æ®ï¼Œæœ€åå¤§é¡¶å †çš„å †é¡¶å…ƒç´ å°±æ˜¯è¦æ±‚çš„æ•°æ®ã€‚\n\n## å›¾\n\n### å¦‚ä½•ç†è§£â€œå›¾â€ï¼Ÿ\n\nå›¾ä¸­çš„å…ƒç´ æˆ‘ä»¬å°±å«åš**é¡¶ç‚¹**ï¼ˆvertexï¼‰ã€‚ä»æˆ‘ç”»çš„å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œå›¾ä¸­çš„ä¸€ä¸ªé¡¶ç‚¹å¯ä»¥ä¸ä»»æ„å…¶ä»–é¡¶ç‚¹å»ºç«‹è¿æ¥å…³ç³»ã€‚æˆ‘ä»¬æŠŠè¿™ç§å»ºç«‹çš„å…³ç³»å«åš**è¾¹**ï¼ˆedgeï¼‰ã€‚\n\n![Untitled](Extras/Images/alg_39.png)\n\næˆ‘ä»¬ç”Ÿæ´»ä¸­å°±æœ‰å¾ˆå¤šç¬¦åˆå›¾è¿™ç§ç»“æ„çš„ä¾‹å­ã€‚æ¯”å¦‚ï¼Œå¼€ç¯‡é—®é¢˜ä¸­è®²åˆ°çš„ç¤¾äº¤ç½‘ç»œï¼Œå°±æ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„å›¾ç»“æ„ã€‚\n\næˆ‘ä»¬å°±æ‹¿å¾®ä¿¡ä¸¾ä¾‹å­å§ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸ªç”¨æˆ·çœ‹ä½œä¸€ä¸ªé¡¶ç‚¹ã€‚å¦‚æœä¸¤ä¸ªç”¨æˆ·ä¹‹é—´äº’åŠ å¥½å‹ï¼Œé‚£å°±åœ¨ä¸¤è€…ä¹‹é—´å»ºç«‹ä¸€æ¡è¾¹ã€‚æ‰€ä»¥ï¼Œæ•´ä¸ªå¾®ä¿¡çš„å¥½å‹å…³ç³»å°±å¯ä»¥ç”¨ä¸€å¼ å›¾æ¥è¡¨ç¤ºã€‚å…¶ä¸­ï¼Œæ¯ä¸ªç”¨æˆ·æœ‰å¤šå°‘ä¸ªå¥½å‹ï¼Œå¯¹åº”åˆ°å›¾ä¸­ï¼Œå°±å«åšé¡¶ç‚¹çš„**åº¦**ï¼ˆdegreeï¼‰ï¼Œå°±æ˜¯è·Ÿé¡¶ç‚¹ç›¸è¿æ¥çš„è¾¹çš„æ¡æ•°ã€‚\n\nå®é™…ä¸Šï¼Œå¾®åšçš„ç¤¾äº¤å…³ç³»è·Ÿå¾®ä¿¡è¿˜æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œæˆ–è€…è¯´æ›´åŠ å¤æ‚ä¸€ç‚¹ã€‚å¾®åšå…è®¸å•å‘å…³æ³¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ· A å…³æ³¨äº†ç”¨æˆ· Bï¼Œä½†ç”¨æˆ· B å¯ä»¥ä¸å…³æ³¨ç”¨æˆ· Aã€‚é‚£æˆ‘ä»¬å¦‚ä½•ç”¨å›¾æ¥è¡¨ç¤ºè¿™ç§å•å‘çš„ç¤¾äº¤å…³ç³»å‘¢ï¼Ÿ\n\næˆ‘ä»¬å¯ä»¥æŠŠåˆšåˆšè®²çš„å›¾ç»“æ„ç¨å¾®æ”¹é€ ä¸€ä¸‹ï¼Œå¼•å…¥è¾¹çš„â€œæ–¹å‘â€çš„æ¦‚å¿µã€‚\n\nå¦‚æœç”¨æˆ· A å…³æ³¨äº†ç”¨æˆ· Bï¼Œæˆ‘ä»¬å°±åœ¨å›¾ä¸­ç”»ä¸€æ¡ä» A åˆ° B çš„å¸¦ç®­å¤´çš„è¾¹ï¼Œæ¥è¡¨ç¤ºè¾¹çš„æ–¹å‘ã€‚å¦‚æœç”¨æˆ· A å’Œç”¨æˆ· B äº’ç›¸å…³æ³¨äº†ï¼Œé‚£æˆ‘ä»¬å°±ç”»ä¸€æ¡ä» A æŒ‡å‘ B çš„è¾¹ï¼Œå†ç”»ä¸€æ¡ä» B æŒ‡å‘ A çš„è¾¹ã€‚æˆ‘ä»¬æŠŠè¿™ç§è¾¹æœ‰æ–¹å‘çš„å›¾å«åšâ€œæœ‰å‘å›¾â€ã€‚ä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä»¬æŠŠè¾¹æ²¡æœ‰æ–¹å‘çš„å›¾å°±å«åšâ€œæ— å‘å›¾â€ã€‚\n\n![Untitled](Extras/Images/alg_40.png)\n\næˆ‘ä»¬åˆšåˆšè®²è¿‡ï¼Œæ— å‘å›¾ä¸­æœ‰â€œåº¦â€è¿™ä¸ªæ¦‚å¿µï¼Œè¡¨ç¤ºä¸€ä¸ªé¡¶ç‚¹æœ‰å¤šå°‘æ¡è¾¹ã€‚åœ¨æœ‰å‘å›¾ä¸­ï¼Œæˆ‘ä»¬æŠŠåº¦åˆ†ä¸º**å…¥åº¦**ï¼ˆIn-degreeï¼‰å’Œ**å‡ºåº¦**ï¼ˆOut-degreeï¼‰ã€‚\n\né¡¶ç‚¹çš„å…¥åº¦ï¼Œè¡¨ç¤ºæœ‰å¤šå°‘æ¡è¾¹æŒ‡å‘è¿™ä¸ªé¡¶ç‚¹ï¼›é¡¶ç‚¹çš„å‡ºåº¦ï¼Œè¡¨ç¤ºæœ‰å¤šå°‘æ¡è¾¹æ˜¯ä»¥è¿™ä¸ªé¡¶ç‚¹ä¸ºèµ·ç‚¹æŒ‡å‘å…¶ä»–é¡¶ç‚¹ã€‚å¯¹åº”åˆ°å¾®åšçš„ä¾‹å­ï¼Œå…¥åº¦å°±è¡¨ç¤ºæœ‰å¤šå°‘ç²‰ä¸ï¼Œå‡ºåº¦å°±è¡¨ç¤ºå…³æ³¨äº†å¤šå°‘äººã€‚\n\nå‰é¢è®²åˆ°äº†å¾®ä¿¡ã€å¾®åšã€æ— å‘å›¾ã€æœ‰å‘å›¾ï¼Œç°åœ¨æˆ‘ä»¬å†æ¥çœ‹å¦ä¸€ç§ç¤¾äº¤è½¯ä»¶ï¼šQQã€‚\n\nQQ ä¸­çš„ç¤¾äº¤å…³ç³»è¦æ›´å¤æ‚ä¸€ç‚¹ã€‚ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰ç•™æ„è¿‡ QQ äº²å¯†åº¦è¿™æ ·ä¸€ä¸ªåŠŸèƒ½ã€‚QQ ä¸ä»…è®°å½•äº†ç”¨æˆ·ä¹‹é—´çš„å¥½å‹å…³ç³»ï¼Œè¿˜è®°å½•äº†ä¸¤ä¸ªç”¨æˆ·ä¹‹é—´çš„äº²å¯†åº¦ï¼Œå¦‚æœä¸¤ä¸ªç”¨æˆ·ç»å¸¸å¾€æ¥ï¼Œé‚£äº²å¯†åº¦å°±æ¯”è¾ƒé«˜ï¼›å¦‚æœä¸ç»å¸¸å¾€æ¥ï¼Œäº²å¯†åº¦å°±æ¯”è¾ƒä½ã€‚å¦‚ä½•åœ¨å›¾ä¸­è®°å½•è¿™ç§å¥½å‹å…³ç³»çš„äº²å¯†åº¦å‘¢ï¼Ÿ\n\nè¿™é‡Œå°±è¦ç”¨åˆ°å¦ä¸€ç§å›¾ï¼Œ**å¸¦æƒå›¾**ï¼ˆweighted graphï¼‰ã€‚åœ¨å¸¦æƒå›¾ä¸­ï¼Œæ¯æ¡è¾¹éƒ½æœ‰ä¸€ä¸ªæƒé‡ï¼ˆweightï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæƒé‡æ¥è¡¨ç¤º QQ å¥½å‹é—´çš„äº²å¯†åº¦ã€‚\n\n![Untitled](Extras/Images/alg_41.png)\n\n### é‚»æ¥çŸ©é˜µå­˜å‚¨æ–¹æ³•\n\nå›¾æœ€ç›´è§‚çš„ä¸€ç§å­˜å‚¨æ–¹æ³•å°±æ˜¯ï¼Œ**é‚»æ¥çŸ©é˜µ**ï¼ˆAdjacency Matrixï¼‰ã€‚\n\né‚»æ¥çŸ©é˜µçš„åº•å±‚ä¾èµ–ä¸€ä¸ªäºŒç»´æ•°ç»„ã€‚å¯¹äºæ— å‘å›¾æ¥è¯´ï¼Œå¦‚æœé¡¶ç‚¹ i ä¸é¡¶ç‚¹ j ä¹‹é—´æœ‰è¾¹ï¼Œæˆ‘ä»¬å°±å°† A[i][j]å’Œ A[j][i]æ ‡è®°ä¸º 1ï¼›å¯¹äºæœ‰å‘å›¾æ¥è¯´ï¼Œå¦‚æœé¡¶ç‚¹ i åˆ°é¡¶ç‚¹ j ä¹‹é—´ï¼Œæœ‰ä¸€æ¡ç®­å¤´ä»é¡¶ç‚¹ i æŒ‡å‘é¡¶ç‚¹ j çš„è¾¹ï¼Œé‚£æˆ‘ä»¬å°±å°† A[i][j]æ ‡è®°ä¸º 1ã€‚åŒç†ï¼Œå¦‚æœæœ‰ä¸€æ¡ç®­å¤´ä»é¡¶ç‚¹ j æŒ‡å‘é¡¶ç‚¹ i çš„è¾¹ï¼Œæˆ‘ä»¬å°±å°† A[j][i]æ ‡è®°ä¸º 1ã€‚å¯¹äºå¸¦æƒå›¾ï¼Œæ•°ç»„ä¸­å°±å­˜å‚¨ç›¸åº”çš„æƒé‡ã€‚\n\n![Untitled](Extras/Images/alg_42.png)\n\nç”¨é‚»æ¥çŸ©é˜µæ¥è¡¨ç¤ºä¸€ä¸ªå›¾ï¼Œè™½ç„¶ç®€å•ã€ç›´è§‚ï¼Œä½†æ˜¯æ¯”è¾ƒæµªè´¹å­˜å‚¨ç©ºé—´ã€‚\n\n### é‚»æ¥è¡¨å­˜å‚¨æ–¹æ³•\n\né’ˆå¯¹ä¸Šé¢é‚»æ¥çŸ©é˜µæ¯”è¾ƒæµªè´¹å†…å­˜ç©ºé—´çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ¥çœ‹å¦å¤–ä¸€ç§å›¾çš„å­˜å‚¨æ–¹æ³•ï¼Œ**é‚»æ¥è¡¨**ï¼ˆAdjacency Listï¼‰ã€‚\n\næ¯ä¸ªé¡¶ç‚¹å¯¹åº”ä¸€æ¡é“¾è¡¨ï¼Œé“¾è¡¨ä¸­å­˜å‚¨çš„æ˜¯ä¸è¿™ä¸ªé¡¶ç‚¹ç›¸è¿æ¥çš„å…¶ä»–é¡¶ç‚¹ã€‚å¦å¤–æˆ‘éœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œå›¾ä¸­ç”»çš„æ˜¯ä¸€ä¸ªæœ‰å‘å›¾çš„é‚»æ¥è¡¨å­˜å‚¨æ–¹å¼ï¼Œæ¯ä¸ªé¡¶ç‚¹å¯¹åº”çš„é“¾è¡¨é‡Œé¢ï¼Œå­˜å‚¨çš„æ˜¯æŒ‡å‘çš„é¡¶ç‚¹ã€‚å¯¹äºæ— å‘å›¾æ¥è¯´ï¼Œä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä¸è¿‡ï¼Œæ¯ä¸ªé¡¶ç‚¹çš„é“¾è¡¨ä¸­å­˜å‚¨çš„ï¼Œæ˜¯è·Ÿè¿™ä¸ªé¡¶ç‚¹æœ‰è¾¹ç›¸è¿çš„é¡¶ç‚¹ã€‚\n\n![Untitled](Extras/Images/alg_43.png)\n\né‚»æ¥çŸ©é˜µå­˜å‚¨èµ·æ¥æ¯”è¾ƒæµªè´¹ç©ºé—´ï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥æ¯”è¾ƒèŠ‚çœæ—¶é—´ã€‚ç›¸åï¼Œé‚»æ¥è¡¨å­˜å‚¨èµ·æ¥æ¯”è¾ƒèŠ‚çœç©ºé—´ï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥å°±æ¯”è¾ƒè€—æ—¶é—´ã€‚\n\nå¦‚æœæˆ‘ä»¬è¦ç¡®å®šï¼Œæ˜¯å¦å­˜åœ¨ä¸€æ¡ä»é¡¶ç‚¹ 2 åˆ°é¡¶ç‚¹ 4 çš„è¾¹ï¼Œé‚£æˆ‘ä»¬å°±è¦éå†é¡¶ç‚¹ 2 å¯¹åº”çš„é‚£æ¡é“¾è¡¨ï¼Œçœ‹é“¾è¡¨ä¸­æ˜¯å¦å­˜åœ¨é¡¶ç‚¹ 4ã€‚è€Œä¸”ï¼Œæˆ‘ä»¬å‰é¢ä¹Ÿè®²è¿‡ï¼Œé“¾è¡¨çš„å­˜å‚¨æ–¹å¼å¯¹ç¼“å­˜ä¸å‹å¥½ã€‚æ‰€ä»¥ï¼Œæ¯”èµ·é‚»æ¥çŸ©é˜µçš„å­˜å‚¨æ–¹å¼ï¼Œåœ¨é‚»æ¥è¡¨ä¸­æŸ¥è¯¢ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´çš„å…³ç³»å°±æ²¡é‚£ä¹ˆé«˜æ•ˆäº†ã€‚ä¸è¿‡ï¼Œå¦‚æœé“¾è¿‡é•¿ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†é‚»æ¥è¡¨ä¸­çš„é“¾è¡¨æ”¹æˆå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ã€çº¢é»‘æ ‘ã€è·³è¡¨ç­‰ã€‚\n\n## **Trieæ ‘**\n\n### ä»€ä¹ˆæ˜¯â€œTrie æ ‘â€ï¼Ÿ\n\nTrie æ ‘ï¼Œä¹Ÿå«â€œå­—å…¸æ ‘â€ã€‚é¡¾åæ€ä¹‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ã€‚å®ƒæ˜¯ä¸€ç§ä¸“é—¨å¤„ç†å­—ç¬¦ä¸²åŒ¹é…çš„æ•°æ®ç»“æ„ï¼Œç”¨æ¥è§£å†³åœ¨ä¸€ç»„å­—ç¬¦ä¸²é›†åˆä¸­å¿«é€ŸæŸ¥æ‰¾æŸä¸ªå­—ç¬¦ä¸²çš„é—®é¢˜ã€‚\n\næˆ‘ä»¬æœ‰ 6 ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šhowï¼Œhiï¼Œherï¼Œhelloï¼Œsoï¼Œseeã€‚æˆ‘ä»¬å¸Œæœ›åœ¨é‡Œé¢å¤šæ¬¡æŸ¥æ‰¾æŸä¸ªå­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœæ¯æ¬¡æŸ¥æ‰¾ï¼Œéƒ½æ˜¯æ‹¿è¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²è·Ÿè¿™ 6 ä¸ªå­—ç¬¦ä¸²ä¾æ¬¡è¿›è¡Œå­—ç¬¦ä¸²åŒ¹é…ï¼Œé‚£æ•ˆç‡å°±æ¯”è¾ƒä½ï¼Œæœ‰æ²¡æœ‰æ›´é«˜æ•ˆçš„æ–¹æ³•å‘¢ï¼Ÿ\n\nè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥å…ˆå¯¹è¿™ 6 ä¸ªå­—ç¬¦ä¸²åšä¸€ä¸‹é¢„å¤„ç†ï¼Œç»„ç»‡æˆ Trie æ ‘çš„ç»“æ„ï¼Œä¹‹åæ¯æ¬¡æŸ¥æ‰¾ï¼Œéƒ½æ˜¯åœ¨ Trie æ ‘ä¸­è¿›è¡ŒåŒ¹é…æŸ¥æ‰¾ã€‚**Trie æ ‘çš„æœ¬è´¨ï¼Œå°±æ˜¯åˆ©ç”¨å­—ç¬¦ä¸²ä¹‹é—´çš„å…¬å…±å‰ç¼€ï¼Œå°†é‡å¤çš„å‰ç¼€åˆå¹¶åœ¨ä¸€èµ·ã€‚**æœ€åæ„é€ å‡ºæ¥çš„å°±æ˜¯ä¸‹é¢è¿™ä¸ªå›¾ä¸­çš„æ ·å­ã€‚\n\n![Untitled](Extras/Images/alg_44.png)\n\nå…¶ä¸­ï¼Œæ ¹èŠ‚ç‚¹ä¸åŒ…å«ä»»ä½•ä¿¡æ¯ã€‚æ¯ä¸ªèŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼Œä»æ ¹èŠ‚ç‚¹åˆ°çº¢è‰²èŠ‚ç‚¹çš„ä¸€æ¡è·¯å¾„è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæ³¨æ„ï¼šçº¢è‰²èŠ‚ç‚¹å¹¶ä¸éƒ½æ˜¯å¶å­èŠ‚ç‚¹ï¼‰ã€‚\n\nTrie æ ‘æ„é€ è¿‡ç¨‹çš„æ¯ä¸€æ­¥ï¼Œéƒ½ç›¸å½“äºå¾€ Trie æ ‘ä¸­æ’å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å½“æ‰€æœ‰å­—ç¬¦ä¸²éƒ½æ’å…¥å®Œæˆä¹‹åï¼ŒTrie æ ‘å°±æ„é€ å¥½äº†ã€‚\n\n![Untitled](Extras/Images/alg_45.png)\n\n![Untitled](Extras/Images/alg_46.png)\n\n### Trie æ ‘çœŸçš„å¾ˆè€—å†…å­˜å—ï¼Ÿ\n\nâ€œTrie æ ‘æ˜¯éå¸¸è€—å†…å­˜çš„ï¼Œç”¨çš„æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯â€ã€‚\n\nåˆšåˆšæˆ‘ä»¬åœ¨è®² Trie æ ‘çš„å®ç°çš„æ—¶å€™ï¼Œè®²åˆ°ç”¨æ•°ç»„æ¥å­˜å‚¨ä¸€ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«ä» a åˆ° z è¿™ 26 ä¸ªå­—ç¬¦ï¼Œé‚£æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦å­˜å‚¨ä¸€ä¸ªé•¿åº¦ä¸º 26 çš„æ•°ç»„ï¼Œå¹¶ä¸”æ¯ä¸ªæ•°ç»„å…ƒç´ è¦å­˜å‚¨ä¸€ä¸ª 8 å­—èŠ‚æŒ‡é’ˆï¼ˆæˆ–è€…æ˜¯ 4 å­—èŠ‚ï¼Œè¿™ä¸ªå¤§å°è·Ÿ CPUã€æ“ä½œç³»ç»Ÿã€ç¼–è¯‘å™¨ç­‰æœ‰å…³ï¼‰ã€‚è€Œä¸”ï¼Œå³ä¾¿ä¸€ä¸ªèŠ‚ç‚¹åªæœ‰å¾ˆå°‘çš„å­èŠ‚ç‚¹ï¼Œè¿œå°äº 26 ä¸ªï¼Œæ¯”å¦‚ 3ã€4 ä¸ªï¼Œæˆ‘ä»¬ä¹Ÿè¦ç»´æŠ¤ä¸€ä¸ªé•¿åº¦ä¸º 26 çš„æ•°ç»„ã€‚\n\næˆ‘ä»¬å‰é¢è®²è¿‡ï¼ŒTrie æ ‘çš„æœ¬è´¨æ˜¯é¿å…é‡å¤å­˜å‚¨ä¸€ç»„å­—ç¬¦ä¸²çš„ç›¸åŒå‰ç¼€å­ä¸²ï¼Œä½†æ˜¯ç°åœ¨æ¯ä¸ªå­—ç¬¦ï¼ˆå¯¹åº”ä¸€ä¸ªèŠ‚ç‚¹ï¼‰çš„å­˜å‚¨è¿œè¿œå¤§äº 1 ä¸ªå­—èŠ‚ã€‚æŒ‰ç…§æˆ‘ä»¬ä¸Šé¢ä¸¾çš„ä¾‹å­ï¼Œæ•°ç»„é•¿åº¦ä¸º 26ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ 8 å­—èŠ‚ï¼Œé‚£æ¯ä¸ªèŠ‚ç‚¹å°±ä¼šé¢å¤–éœ€è¦ 26*8=208 ä¸ªå­—èŠ‚ã€‚è€Œä¸”è¿™è¿˜æ˜¯åªåŒ…å« 26 ä¸ªå­—ç¬¦çš„æƒ…å†µã€‚\n\nå¦‚æœå­—ç¬¦ä¸²ä¸­ä¸ä»…åŒ…å«å°å†™å­—æ¯ï¼Œè¿˜åŒ…å«å¤§å†™å­—æ¯ã€æ•°å­—ã€ç”šè‡³æ˜¯ä¸­æ–‡ï¼Œé‚£éœ€è¦çš„å­˜å‚¨ç©ºé—´å°±æ›´å¤šäº†ã€‚æ‰€ä»¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒTrie æ ‘ä¸ä¸€å®šä¼šèŠ‚çœå­˜å‚¨ç©ºé—´ã€‚åœ¨é‡å¤çš„å‰ç¼€å¹¶ä¸å¤šçš„æƒ…å†µä¸‹ï¼ŒTrie æ ‘ä¸ä½†ä¸èƒ½èŠ‚çœå†…å­˜ï¼Œè¿˜æœ‰å¯èƒ½ä¼šæµªè´¹æ›´å¤šçš„å†…å­˜ã€‚\n\næˆ‘ä»¬å¯ä»¥ç¨å¾®ç‰ºç‰²ä¸€ç‚¹æŸ¥è¯¢çš„æ•ˆç‡ï¼Œå°†æ¯ä¸ªèŠ‚ç‚¹ä¸­çš„æ•°ç»„æ¢æˆå…¶ä»–æ•°æ®ç»“æ„ï¼Œæ¥å­˜å‚¨ä¸€ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹æŒ‡é’ˆã€‚ç”¨å“ªç§æ•°æ®ç»“æ„å‘¢ï¼Ÿæˆ‘ä»¬çš„é€‰æ‹©å…¶å®æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚æœ‰åºæ•°ç»„ã€è·³è¡¨ã€æ•£åˆ—è¡¨ã€çº¢é»‘æ ‘ç­‰ã€‚\n\n### Trie æ ‘ä¸æ•£åˆ—è¡¨ã€çº¢é»‘æ ‘çš„æ¯”è¾ƒ\n\nåœ¨ä¸€ç»„å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾å­—ç¬¦ä¸²ï¼ŒTrie æ ‘å®é™…ä¸Šè¡¨ç°å¾—å¹¶ä¸å¥½ã€‚å®ƒå¯¹è¦å¤„ç†çš„å­—ç¬¦ä¸²æœ‰æå…¶ä¸¥è‹›çš„è¦æ±‚ã€‚\n\nç¬¬ä¸€ï¼Œå­—ç¬¦ä¸²ä¸­åŒ…å«çš„å­—ç¬¦é›†ä¸èƒ½å¤ªå¤§ã€‚æˆ‘ä»¬å‰é¢è®²åˆ°ï¼Œå¦‚æœå­—ç¬¦é›†å¤ªå¤§ï¼Œé‚£å­˜å‚¨ç©ºé—´å¯èƒ½å°±ä¼šæµªè´¹å¾ˆå¤šã€‚å³ä¾¿å¯ä»¥ä¼˜åŒ–ï¼Œä½†ä¹Ÿè¦ä»˜å‡ºç‰ºç‰²æŸ¥è¯¢ã€æ’å…¥æ•ˆç‡çš„ä»£ä»·ã€‚\n\nç¬¬äºŒï¼Œè¦æ±‚å­—ç¬¦ä¸²çš„å‰ç¼€é‡åˆæ¯”è¾ƒå¤šï¼Œä¸ç„¶ç©ºé—´æ¶ˆè€—ä¼šå˜å¤§å¾ˆå¤šã€‚\n\nç¬¬ä¸‰ï¼Œå¦‚æœè¦ç”¨ Trie æ ‘è§£å†³é—®é¢˜ï¼Œé‚£æˆ‘ä»¬å°±è¦è‡ªå·±ä»é›¶å¼€å§‹å®ç°ä¸€ä¸ª Trie æ ‘ï¼Œè¿˜è¦ä¿è¯æ²¡æœ‰ bugï¼Œè¿™ä¸ªåœ¨å·¥ç¨‹ä¸Šæ˜¯å°†ç®€å•é—®é¢˜å¤æ‚åŒ–ï¼Œé™¤éå¿…é¡»ï¼Œä¸€èˆ¬ä¸å»ºè®®è¿™æ ·åšã€‚\n\nç¬¬å››ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œé€šè¿‡æŒ‡é’ˆä¸²èµ·æ¥çš„æ•°æ®å—æ˜¯ä¸è¿ç»­çš„ï¼Œè€Œ Trie æ ‘ä¸­ç”¨åˆ°äº†æŒ‡é’ˆï¼Œæ‰€ä»¥ï¼Œå¯¹ç¼“å­˜å¹¶ä¸å‹å¥½ï¼Œæ€§èƒ½ä¸Šä¼šæ‰“ä¸ªæŠ˜æ‰£ã€‚\n\nç»¼åˆè¿™å‡ ç‚¹ï¼Œé’ˆå¯¹åœ¨ä¸€ç»„å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾å­—ç¬¦ä¸²çš„é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨å·¥ç¨‹ä¸­ï¼Œæ›´å€¾å‘äºç”¨æ•£åˆ—è¡¨æˆ–è€…çº¢é»‘æ ‘ã€‚å› ä¸ºè¿™ä¸¤ç§æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬éƒ½ä¸éœ€è¦è‡ªå·±å»å®ç°ï¼Œç›´æ¥åˆ©ç”¨ç¼–ç¨‹è¯­è¨€ä¸­æä¾›çš„ç°æˆç±»åº“å°±è¡Œäº†ã€‚\n\nTrie æ ‘åªæ˜¯ä¸é€‚åˆç²¾ç¡®åŒ¹é…æŸ¥æ‰¾ï¼Œè¿™ç§é—®é¢˜æ›´é€‚åˆç”¨æ•£åˆ—è¡¨æˆ–è€…çº¢é»‘æ ‘æ¥è§£å†³ã€‚Trie æ ‘æ¯”è¾ƒé€‚åˆçš„æ˜¯æŸ¥æ‰¾å‰ç¼€åŒ¹é…çš„å­—ç¬¦ä¸²ã€‚\n\nå¯¹äºç”¨å¤šæ¨¡å¼ä¸²åŒ¹é…å®ç°æ•æ„Ÿè¯è¿‡æ»¤åŠŸèƒ½ï¼Œè¿˜å¯ä»¥ç”¨ACè‡ªåŠ¨æœºå®ç°ã€‚\n\n# ç®—æ³•\n\n## **é€’å½’**\n\nä»æˆ‘è‡ªå·±å­¦ä¹ æ•°æ®ç»“æ„å’Œç®—æ³•çš„ç»å†æ¥çœ‹ï¼Œæˆ‘ä¸ªäººè§‰å¾—ï¼Œæœ‰ä¸¤ä¸ªæœ€éš¾ç†è§£çš„çŸ¥è¯†ç‚¹ï¼Œä¸€ä¸ªæ˜¯åŠ¨æ€è§„åˆ’ï¼Œå¦ä¸€ä¸ªå°±æ˜¯é€’å½’ã€‚\n\nåŸºæœ¬ä¸Šï¼Œæ‰€æœ‰çš„é€’å½’é—®é¢˜éƒ½å¯ä»¥ç”¨é€’æ¨å…¬å¼æ¥è¡¨ç¤ºã€‚æ¯”å¦‚ï¼Œå‘¨æœ«ä½ å¸¦ç€å¥³æœ‹å‹å»ç”µå½±é™¢çœ‹ç”µå½±ï¼Œå¥³æœ‹å‹é—®ä½ ï¼Œå’±ä»¬ç°åœ¨ååœ¨ç¬¬å‡ æ’å•Šï¼Ÿç”µå½±é™¢é‡Œé¢å¤ªé»‘äº†ï¼Œçœ‹ä¸æ¸…ï¼Œæ²¡æ³•æ•°ï¼Œç°åœ¨ä½ æ€ä¹ˆåŠï¼Ÿäºæ˜¯ä½ å°±é—®å‰é¢ä¸€æ’çš„äººä»–æ˜¯ç¬¬å‡ æ’ï¼Œä½ æƒ³åªè¦åœ¨ä»–çš„æ•°å­—ä¸ŠåŠ ä¸€ï¼Œå°±çŸ¥é“è‡ªå·±åœ¨å“ªä¸€æ’äº†ã€‚ä½†æ˜¯ï¼Œå‰é¢çš„äººä¹Ÿçœ‹ä¸æ¸…å•Šï¼Œæ‰€ä»¥ä»–ä¹Ÿé—®ä»–å‰é¢çš„äººã€‚å°±è¿™æ ·ä¸€æ’ä¸€æ’å¾€å‰é—®ï¼Œç›´åˆ°é—®åˆ°ç¬¬ä¸€æ’çš„äººï¼Œè¯´æˆ‘åœ¨ç¬¬ä¸€æ’ï¼Œç„¶åå†è¿™æ ·ä¸€æ’ä¸€æ’å†æŠŠæ•°å­—ä¼ å›æ¥ã€‚ç›´åˆ°ä½ å‰é¢çš„äººå‘Šè¯‰ä½ ä»–åœ¨å“ªä¸€æ’ï¼Œäºæ˜¯ä½ å°±çŸ¥é“ç­”æ¡ˆäº†ã€‚\n\nè¿™å°±æ˜¯ä¸€ä¸ªéå¸¸æ ‡å‡†çš„é€’å½’æ±‚è§£é—®é¢˜çš„åˆ†è§£è¿‡ç¨‹ï¼Œå»çš„è¿‡ç¨‹å«â€œé€’â€ï¼Œå›æ¥çš„è¿‡ç¨‹å«â€œå½’â€ã€‚åŸºæœ¬ä¸Šï¼Œæ‰€æœ‰çš„é€’å½’é—®é¢˜éƒ½å¯ä»¥ç”¨é€’æ¨å…¬å¼æ¥è¡¨ç¤ºã€‚åˆšåˆšè¿™ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼Œæˆ‘ä»¬ç”¨é€’æ¨å…¬å¼å°†å®ƒè¡¨ç¤ºå‡ºæ¥å°±æ˜¯è¿™æ ·çš„ï¼š\n\n```\nf(n)=f(n-1)+1 å…¶ä¸­ï¼Œf(1)=1\n```\n\nf(n) è¡¨ç¤ºä½ æƒ³çŸ¥é“è‡ªå·±åœ¨å“ªä¸€æ’ï¼Œf(n-1) è¡¨ç¤ºå‰é¢ä¸€æ’æ‰€åœ¨çš„æ’æ•°ï¼Œf(1)=1 è¡¨ç¤ºç¬¬ä¸€æ’çš„äººçŸ¥é“è‡ªå·±åœ¨ç¬¬ä¸€æ’ã€‚æœ‰äº†è¿™ä¸ªé€’æ¨å…¬å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆè½»æ¾åœ°å°†å®ƒæ”¹ä¸ºé€’å½’ä»£ç ï¼Œå¦‚ä¸‹ï¼š\n\n```c\nint f(int n) {\n  if (n == 1) return 1;\n  return f(n-1) + 1;\n}\n```\n\n### é€’å½’éœ€è¦æ»¡è¶³çš„ä¸‰ä¸ªæ¡ä»¶\n\n1. **ä¸€ä¸ªé—®é¢˜çš„è§£å¯ä»¥åˆ†è§£ä¸ºå‡ ä¸ªå­é—®é¢˜çš„è§£**\n\n    ä½•ä¸ºå­é—®é¢˜ï¼Ÿå­é—®é¢˜å°±æ˜¯æ•°æ®è§„æ¨¡æ›´å°çš„é—®é¢˜ã€‚\n\n2. **è¿™ä¸ªé—®é¢˜ä¸åˆ†è§£ä¹‹åçš„å­é—®é¢˜ï¼Œé™¤äº†æ•°æ®è§„æ¨¡ä¸åŒï¼Œæ±‚è§£æ€è·¯å®Œå…¨ä¸€æ ·**\n\n    æ¯”å¦‚ç”µå½±é™¢é‚£ä¸ªä¾‹å­ï¼Œä½ æ±‚è§£â€œè‡ªå·±åœ¨å“ªä¸€æ’â€çš„æ€è·¯ï¼Œå’Œå‰é¢ä¸€æ’äººæ±‚è§£â€œè‡ªå·±åœ¨å“ªä¸€æ’â€çš„æ€è·¯ï¼Œæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚\n\n3. **å­˜åœ¨é€’å½’ç»ˆæ­¢æ¡ä»¶**\n\n    æŠŠé—®é¢˜åˆ†è§£ä¸ºå­é—®é¢˜ï¼ŒæŠŠå­é—®é¢˜å†åˆ†è§£ä¸ºå­å­é—®é¢˜ï¼Œä¸€å±‚ä¸€å±‚åˆ†è§£ä¸‹å»ï¼Œä¸èƒ½å­˜åœ¨æ— é™å¾ªç¯ï¼Œè¿™å°±éœ€è¦æœ‰ç»ˆæ­¢æ¡ä»¶ã€‚\n\n\n### å¦‚ä½•ç¼–å†™é€’å½’ä»£ç ï¼Ÿ\n\nå†™é€’å½’ä»£ç æœ€å…³é”®çš„æ˜¯**å†™å‡ºé€’æ¨å…¬å¼ï¼Œæ‰¾åˆ°ç»ˆæ­¢æ¡ä»¶**ï¼Œå‰©ä¸‹å°†é€’æ¨å…¬å¼è½¬åŒ–ä¸ºä»£ç å°±å¾ˆç®€å•äº†ã€‚\n\nå‡å¦‚è¿™é‡Œæœ‰ n ä¸ªå°é˜¶ï¼Œæ¯æ¬¡ä½ å¯ä»¥è·¨ 1 ä¸ªå°é˜¶æˆ–è€… 2 ä¸ªå°é˜¶ï¼Œè¯·é—®èµ°è¿™ n ä¸ªå°é˜¶æœ‰å¤šå°‘ç§èµ°æ³•ï¼Ÿå¦‚æœæœ‰ 7 ä¸ªå°é˜¶ï¼Œä½ å¯ä»¥ 2ï¼Œ2ï¼Œ2ï¼Œ1 è¿™æ ·å­ä¸Šå»ï¼Œä¹Ÿå¯ä»¥ 1ï¼Œ2ï¼Œ1ï¼Œ1ï¼Œ2 è¿™æ ·å­ä¸Šå»ï¼Œæ€»ä¹‹èµ°æ³•æœ‰å¾ˆå¤šï¼Œé‚£å¦‚ä½•ç”¨ç¼–ç¨‹æ±‚å¾—æ€»å…±æœ‰å¤šå°‘ç§èµ°æ³•å‘¢ï¼Ÿ\n\næˆ‘ä»¬ä»”ç»†æƒ³ä¸‹ï¼Œå®é™…ä¸Šï¼Œå¯ä»¥æ ¹æ®ç¬¬ä¸€æ­¥çš„èµ°æ³•æŠŠæ‰€æœ‰èµ°æ³•åˆ†ä¸ºä¸¤ç±»ï¼Œç¬¬ä¸€ç±»æ˜¯ç¬¬ä¸€æ­¥èµ°äº† 1 ä¸ªå°é˜¶ï¼Œå¦ä¸€ç±»æ˜¯ç¬¬ä¸€æ­¥èµ°äº† 2 ä¸ªå°é˜¶ã€‚æ‰€ä»¥ n ä¸ªå°é˜¶çš„èµ°æ³•å°±ç­‰äºå…ˆèµ° 1 é˜¶åï¼Œn-1 ä¸ªå°é˜¶çš„èµ°æ³• åŠ ä¸Šå…ˆèµ° 2 é˜¶åï¼Œn-2 ä¸ªå°é˜¶çš„èµ°æ³•ã€‚ç”¨å…¬å¼è¡¨ç¤ºå°±æ˜¯ï¼š\n\n```c\nf(n) = f(n-1)+f(n-2)\n```\n\næœ‰äº†é€’æ¨å…¬å¼ï¼Œé€’å½’ä»£ç åŸºæœ¬ä¸Šå°±å®Œæˆäº†ä¸€åŠã€‚æˆ‘ä»¬å†æ¥çœ‹ä¸‹ç»ˆæ­¢æ¡ä»¶ã€‚å½“æœ‰ä¸€ä¸ªå°é˜¶æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†ç»§ç»­é€’å½’ï¼Œå°±åªæœ‰ä¸€ç§èµ°æ³•ã€‚æ‰€ä»¥ f(1)=1ã€‚è€Œf(2)=2 è¡¨ç¤ºèµ° 2 ä¸ªå°é˜¶ï¼Œæœ‰ä¸¤ç§èµ°æ³•ï¼Œä¸€æ­¥èµ°å®Œæˆ–è€…åˆ†ä¸¤æ­¥æ¥èµ°ã€‚\n\næ‰€ä»¥ï¼Œé€’å½’ç»ˆæ­¢æ¡ä»¶å°±æ˜¯ f(1)=1ï¼Œf(2)=2ã€‚æˆ‘ä»¬æŠŠé€’å½’ç»ˆæ­¢æ¡ä»¶å’Œåˆšåˆšå¾—åˆ°çš„é€’æ¨å…¬å¼æ”¾åˆ°ä¸€èµ·å°±æ˜¯è¿™æ ·çš„ï¼š\n\n```c\nf(1) = 1;\nf(2) = 2;\nf(n) = f(n-1)+f(n-2)\n```\n\næœ‰äº†è¿™ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬è½¬åŒ–æˆé€’å½’ä»£ç å°±ç®€å•å¤šäº†ã€‚æœ€ç»ˆçš„é€’å½’ä»£ç æ˜¯è¿™æ ·çš„ï¼š\n\n```c\nint f(int n) {\n  if (n == 1) return 1;\n  if (n == 2) return 2;\n  return f(n-1) + f(n-2);\n}\n```\n\n**å†™é€’å½’ä»£ç çš„å…³é”®å°±æ˜¯æ‰¾åˆ°å¦‚ä½•å°†å¤§é—®é¢˜åˆ†è§£ä¸ºå°é—®é¢˜çš„è§„å¾‹ï¼Œå¹¶ä¸”åŸºäºæ­¤å†™å‡ºé€’æ¨å…¬å¼ï¼Œç„¶åå†æ¨æ•²ç»ˆæ­¢æ¡ä»¶ï¼Œæœ€åå°†é€’æ¨å…¬å¼å’Œç»ˆæ­¢æ¡ä»¶ç¿»è¯‘æˆä»£ç ã€‚**\n\n**ç¼–å†™é€’å½’ä»£ç çš„å…³é”®æ˜¯ï¼Œåªè¦é‡åˆ°é€’å½’ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒæŠ½è±¡æˆä¸€ä¸ªé€’æ¨å…¬å¼ï¼Œä¸ç”¨æƒ³ä¸€å±‚å±‚çš„è°ƒç”¨å…³ç³»ï¼Œä¸è¦è¯•å›¾ç”¨äººè„‘å»åˆ†è§£é€’å½’çš„æ¯ä¸ªæ­¥éª¤ã€‚**\n\n### é€’å½’ä»£ç è¦è­¦æƒ•å †æ ˆæº¢å‡º\n\nåœ¨å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œç¼–å†™é€’å½’ä»£ç æ—¶ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚å †æ ˆæº¢å‡ºã€‚è€Œå †æ ˆæº¢å‡ºä¼šé€ æˆç³»ç»Ÿæ€§å´©æºƒï¼Œåæœä¼šéå¸¸ä¸¥é‡ã€‚å¦‚ä½•é¿å…å‡ºç°å †æ ˆæº¢å‡ºå‘¢ï¼Ÿ\n\næˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ä»£ç ä¸­é™åˆ¶é€’å½’è°ƒç”¨çš„æœ€å¤§æ·±åº¦çš„æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚é€’å½’è°ƒç”¨è¶…è¿‡ä¸€å®šæ·±åº¦ï¼ˆæ¯”å¦‚ 1000ï¼‰ä¹‹åï¼Œæˆ‘ä»¬å°±ä¸ç»§ç»­å¾€ä¸‹å†é€’å½’äº†ï¼Œç›´æ¥è¿”å›æŠ¥é”™ã€‚\n\nä½†è¿™ç§åšæ³•å¹¶ä¸èƒ½å®Œå…¨è§£å†³é—®é¢˜ï¼Œå› ä¸ºæœ€å¤§å…è®¸çš„é€’å½’æ·±åº¦è·Ÿå½“å‰çº¿ç¨‹å‰©ä½™çš„æ ˆç©ºé—´å¤§å°æœ‰å…³ï¼Œäº‹å…ˆæ— æ³•è®¡ç®—ã€‚å¦‚æœå®æ—¶è®¡ç®—ï¼Œä»£ç è¿‡äºå¤æ‚ï¼Œå°±ä¼šå½±å“ä»£ç çš„å¯è¯»æ€§ã€‚æ‰€ä»¥ï¼Œå¦‚æœæœ€å¤§æ·±åº¦æ¯”è¾ƒå°ï¼Œæ¯”å¦‚ 10ã€50ï¼Œå°±å¯ä»¥ç”¨è¿™ç§æ–¹æ³•ï¼Œå¦åˆ™è¿™ç§æ–¹æ³•å¹¶ä¸æ˜¯å¾ˆå®ç”¨ã€‚\n\n### é€’å½’ä»£ç è¦è­¦æƒ•é‡å¤è®¡ç®—\n\né™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨é€’å½’æ—¶è¿˜ä¼šå‡ºç°é‡å¤è®¡ç®—çš„é—®é¢˜ã€‚åˆšæ‰æˆ‘è®²çš„ç¬¬äºŒä¸ªé€’å½’ä»£ç çš„ä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æŠŠæ•´ä¸ªé€’å½’è¿‡ç¨‹åˆ†è§£ä¸€ä¸‹çš„è¯ï¼Œé‚£å°±æ˜¯è¿™æ ·çš„ï¼š\n\n![Untitled](Extras/Images/alg_47.png)\n\nä»å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°ï¼Œæƒ³è¦è®¡ç®— f(5)ï¼Œéœ€è¦å…ˆè®¡ç®— f(4) å’Œ f(3)ï¼Œè€Œè®¡ç®— f(4) è¿˜éœ€è¦è®¡ç®— f(3)ï¼Œå› æ­¤ï¼Œf(3) å°±è¢«è®¡ç®—äº†å¾ˆå¤šæ¬¡ï¼Œè¿™å°±æ˜¯é‡å¤è®¡ç®—é—®é¢˜ã€‚\n\nä¸ºäº†é¿å…é‡å¤è®¡ç®—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªæ•°æ®ç»“æ„ï¼ˆæ¯”å¦‚æ•£åˆ—è¡¨ï¼‰æ¥ä¿å­˜å·²ç»æ±‚è§£è¿‡çš„ f(k)ã€‚å½“é€’å½’è°ƒç”¨åˆ° f(k) æ—¶ï¼Œå…ˆçœ‹ä¸‹æ˜¯å¦å·²ç»æ±‚è§£è¿‡äº†ã€‚å¦‚æœæ˜¯ï¼Œåˆ™ç›´æ¥ä»æ•£åˆ—è¡¨ä¸­å–å€¼è¿”å›ï¼Œä¸éœ€è¦é‡å¤è®¡ç®—ï¼Œè¿™æ ·å°±èƒ½é¿å…åˆšè®²çš„é—®é¢˜äº†ã€‚\n\nåœ¨æ—¶é—´æ•ˆç‡ä¸Šï¼Œé€’å½’ä»£ç é‡Œå¤šäº†å¾ˆå¤šå‡½æ•°è°ƒç”¨ï¼Œå½“è¿™äº›å‡½æ•°è°ƒç”¨çš„æ•°é‡è¾ƒå¤§æ—¶ï¼Œå°±ä¼šç§¯èšæˆä¸€ä¸ªå¯è§‚çš„æ—¶é—´æˆæœ¬ã€‚åœ¨ç©ºé—´å¤æ‚åº¦ä¸Šï¼Œå› ä¸ºé€’å½’è°ƒç”¨ä¸€æ¬¡å°±ä¼šåœ¨å†…å­˜æ ˆä¸­ä¿å­˜ä¸€æ¬¡ç°åœºæ•°æ®ï¼Œæ‰€ä»¥åœ¨åˆ†æé€’å½’ä»£ç ç©ºé—´å¤æ‚åº¦æ—¶ï¼Œéœ€è¦é¢å¤–è€ƒè™‘è¿™éƒ¨åˆ†çš„å¼€é”€ï¼Œæ¯”å¦‚æˆ‘ä»¬å‰é¢è®²åˆ°çš„ç”µå½±é™¢é€’å½’ä»£ç ï¼Œç©ºé—´å¤æ‚åº¦å¹¶ä¸æ˜¯ O(1)ï¼Œè€Œæ˜¯ O(n)ã€‚\n\n## **æ’åº**\n\næ’åºç®—æ³•å¤ªå¤šäº†ï¼Œè¿™é‡Œåªè®²ä¼—å¤šæ’åºç®—æ³•ä¸­çš„ä¸€å°æ’®ï¼Œä¹Ÿæ˜¯æœ€ç»å…¸çš„ã€æœ€å¸¸ç”¨çš„ï¼šå†’æ³¡æ’åºã€æ’å…¥æ’åºã€é€‰æ‹©æ’åºã€å½’å¹¶æ’åºã€å¿«é€Ÿæ’åºã€è®¡æ•°æ’åºã€åŸºæ•°æ’åºã€æ¡¶æ’åºã€‚æŒ‰ç…§æ—¶é—´å¤æ‚åº¦æŠŠå®ƒä»¬åˆ†æˆäº†ä¸‰ç±»ã€‚\n\n![Untitled](Extras/Images/alg_48.png)\n\n### å¦‚ä½•åˆ†æä¸€ä¸ªâ€œæ’åºç®—æ³•â€ï¼Ÿ\n\n- **æ’åºç®—æ³•çš„æ‰§è¡Œæ•ˆç‡**\n    1. **æœ€å¥½æƒ…å†µã€æœ€åæƒ…å†µã€å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦**\n\n        æˆ‘ä»¬åœ¨åˆ†ææ’åºç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ—¶ï¼Œè¦åˆ†åˆ«ç»™å‡ºæœ€å¥½æƒ…å†µã€æœ€åæƒ…å†µã€å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜è¦è¯´å‡ºæœ€å¥½ã€æœ€åæ—¶é—´å¤æ‚åº¦å¯¹åº”çš„è¦æ’åºçš„åŸå§‹æ•°æ®æ˜¯ä»€ä¹ˆæ ·çš„ã€‚\n\n        ä¸ºä»€ä¹ˆè¦åŒºåˆ†è¿™ä¸‰ç§æ—¶é—´å¤æ‚åº¦å‘¢ï¼Ÿç¬¬ä¸€ï¼Œæœ‰äº›æ’åºç®—æ³•ä¼šåŒºåˆ†ï¼Œä¸ºäº†å¥½å¯¹æ¯”ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¥½éƒ½åšä¸€ä¸‹åŒºåˆ†ã€‚ç¬¬äºŒï¼Œå¯¹äºè¦æ’åºçš„æ•°æ®ï¼Œæœ‰çš„æ¥è¿‘æœ‰åºï¼Œæœ‰çš„å®Œå…¨æ— åºã€‚æœ‰åºåº¦ä¸åŒçš„æ•°æ®ï¼Œå¯¹äºæ’åºçš„æ‰§è¡Œæ—¶é—´è‚¯å®šæ˜¯æœ‰å½±å“çš„ï¼Œæˆ‘ä»¬è¦çŸ¥é“æ’åºç®—æ³•åœ¨ä¸åŒæ•°æ®ä¸‹çš„æ€§èƒ½è¡¨ç°ã€‚\n\n    2. **æ—¶é—´å¤æ‚åº¦çš„ç³»æ•°ã€å¸¸æ•° ã€ä½é˜¶**\n\n        æˆ‘ä»¬çŸ¥é“ï¼Œæ—¶é—´å¤æ‚åº¦åæ˜ çš„æ˜¯æ•°æ®è§„æ¨¡ n å¾ˆå¤§çš„æ—¶å€™çš„ä¸€ä¸ªå¢é•¿è¶‹åŠ¿ï¼Œæ‰€ä»¥å®ƒè¡¨ç¤ºçš„æ—¶å€™ä¼šå¿½ç•¥ç³»æ•°ã€å¸¸æ•°ã€ä½é˜¶ã€‚ä½†æ˜¯å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ’åºçš„å¯èƒ½æ˜¯ 10 ä¸ªã€100 ä¸ªã€1000 ä¸ªè¿™æ ·è§„æ¨¡å¾ˆå°çš„æ•°æ®ï¼Œæ‰€ä»¥ï¼Œåœ¨å¯¹åŒä¸€é˜¶æ—¶é—´å¤æ‚åº¦çš„æ’åºç®—æ³•æ€§èƒ½å¯¹æ¯”çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è¦æŠŠç³»æ•°ã€å¸¸æ•°ã€ä½é˜¶ä¹Ÿè€ƒè™‘è¿›æ¥ã€‚\n\n    3. **æ¯”è¾ƒæ¬¡æ•°å’Œäº¤æ¢ï¼ˆæˆ–ç§»åŠ¨ï¼‰æ¬¡æ•°**\n\n        åŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä¼šæ¶‰åŠä¸¤ç§æ“ä½œï¼Œä¸€ç§æ˜¯å…ƒç´ æ¯”è¾ƒå¤§å°ï¼Œå¦ä¸€ç§æ˜¯å…ƒç´ äº¤æ¢æˆ–ç§»åŠ¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬åœ¨åˆ†ææ’åºç®—æ³•çš„æ‰§è¡Œæ•ˆç‡çš„æ—¶å€™ï¼Œåº”è¯¥æŠŠæ¯”è¾ƒæ¬¡æ•°å’Œäº¤æ¢ï¼ˆæˆ–ç§»åŠ¨ï¼‰æ¬¡æ•°ä¹Ÿè€ƒè™‘è¿›å»ã€‚\n\n- **æ’åºç®—æ³•çš„å†…å­˜æ¶ˆè€—**\n\n    ç®—æ³•çš„å†…å­˜æ¶ˆè€—å¯ä»¥é€šè¿‡ç©ºé—´å¤æ‚åº¦æ¥è¡¡é‡ï¼Œæ’åºç®—æ³•ä¹Ÿä¸ä¾‹å¤–ã€‚ä¸è¿‡ï¼Œé’ˆå¯¹æ’åºç®—æ³•çš„ç©ºé—´å¤æ‚åº¦ï¼Œæˆ‘ä»¬è¿˜å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼ŒåŸåœ°æ’åºï¼ˆSorted in placeï¼‰ã€‚åŸåœ°æ’åºç®—æ³•ï¼Œå°±æ˜¯ç‰¹æŒ‡ç©ºé—´å¤æ‚åº¦æ˜¯ O(1) çš„æ’åºç®—æ³•ã€‚\n\n- **æ’åºç®—æ³•çš„ç¨³å®šæ€§**\n\n    ä»…ä»…ç”¨æ‰§è¡Œæ•ˆç‡å’Œå†…å­˜æ¶ˆè€—æ¥è¡¡é‡æ’åºç®—æ³•çš„å¥½åæ˜¯ä¸å¤Ÿçš„ã€‚é’ˆå¯¹æ’åºç®—æ³•ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„åº¦é‡æŒ‡æ ‡ï¼Œ**ç¨³å®šæ€§**ã€‚è¿™ä¸ªæ¦‚å¿µæ˜¯è¯´ï¼Œå¦‚æœå¾…æ’åºçš„åºåˆ—ä¸­å­˜åœ¨å€¼ç›¸ç­‰çš„å…ƒç´ ï¼Œç»è¿‡æ’åºä¹‹åï¼Œç›¸ç­‰å…ƒç´ ä¹‹é—´åŸæœ‰çš„å…ˆåé¡ºåºä¸å˜ã€‚\n\n\n### å†’æ³¡æ’åºï¼ˆBubble Sortï¼‰\n\nå†’æ³¡æ’åºåªä¼šæ“ä½œç›¸é‚»çš„ä¸¤ä¸ªæ•°æ®ã€‚æ¯æ¬¡å†’æ³¡æ“ä½œéƒ½ä¼šå¯¹ç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œçœ‹æ˜¯å¦æ»¡è¶³å¤§å°å…³ç³»è¦æ±‚ã€‚å¦‚æœä¸æ»¡è¶³å°±è®©å®ƒä¿©äº’æ¢ã€‚ä¸€æ¬¡å†’æ³¡ä¼šè®©è‡³å°‘ä¸€ä¸ªå…ƒç´ ç§»åŠ¨åˆ°å®ƒåº”è¯¥åœ¨çš„ä½ç½®ï¼Œé‡å¤ n æ¬¡ï¼Œå°±å®Œæˆäº† n ä¸ªæ•°æ®çš„æ’åºå·¥ä½œã€‚\n\nç°åœ¨ï¼Œç»“åˆåˆ†ææ’åºç®—æ³•çš„ä¸‰ä¸ªæ–¹é¢ï¼Œæœ‰ä¸‰ä¸ªé—®é¢˜ã€‚\n\n- **ç¬¬ä¸€ï¼Œå†’æ³¡æ’åºæ˜¯åŸåœ°æ’åºç®—æ³•å—ï¼Ÿ**\n\n    å†’æ³¡çš„è¿‡ç¨‹åªæ¶‰åŠç›¸é‚»æ•°æ®çš„äº¤æ¢æ“ä½œï¼Œåªéœ€è¦å¸¸é‡çº§çš„ä¸´æ—¶ç©ºé—´ï¼Œæ‰€ä»¥å®ƒçš„ç©ºé—´å¤æ‚åº¦ä¸º O(1)ï¼Œæ˜¯ä¸€ä¸ªåŸåœ°æ’åºç®—æ³•ã€‚\n\n- **ç¬¬äºŒï¼Œå†’æ³¡æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å—ï¼Ÿ**\n\n    åœ¨å†’æ³¡æ’åºä¸­ï¼Œåªæœ‰äº¤æ¢æ‰å¯ä»¥æ”¹å˜ä¸¤ä¸ªå…ƒç´ çš„å‰åé¡ºåºã€‚ä¸ºäº†ä¿è¯å†’æ³¡æ’åºç®—æ³•çš„ç¨³å®šæ€§ï¼Œå½“æœ‰ç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ å¤§å°ç›¸ç­‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸åšäº¤æ¢ï¼Œç›¸åŒå¤§å°çš„æ•°æ®åœ¨æ’åºå‰åä¸ä¼šæ”¹å˜é¡ºåºï¼Œæ‰€ä»¥å†’æ³¡æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•ã€‚\n\n- **ç¬¬ä¸‰ï¼Œå†’æ³¡æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ**\n\næœ€å¥½æƒ…å†µä¸‹ï¼Œè¦æ’åºçš„æ•°æ®å·²ç»æ˜¯æœ‰åºçš„äº†ï¼Œæˆ‘ä»¬åªéœ€è¦è¿›è¡Œä¸€æ¬¡å†’æ³¡æ“ä½œï¼Œå°±å¯ä»¥ç»“æŸäº†ï¼Œæ‰€ä»¥æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚è€Œæœ€åçš„æƒ…å†µæ˜¯ï¼Œè¦æ’åºçš„æ•°æ®åˆšå¥½æ˜¯å€’åºæ’åˆ—çš„ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œ n æ¬¡å†’æ³¡æ“ä½œï¼Œæ‰€ä»¥æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸º O(n2)ã€‚\n\n![Untitled](Extras/Images/alg_49.png)\n\næœ€å¥½ã€æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦å¾ˆå®¹æ˜“åˆ†æï¼Œé‚£å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚æ˜¯å¤šå°‘å‘¢ï¼Ÿæˆ‘ä»¬å‰é¢è®²è¿‡ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦å°±æ˜¯åŠ æƒå¹³å‡æœŸæœ›æ—¶é—´å¤æ‚åº¦ï¼Œåˆ†æçš„æ—¶å€™è¦ç»“åˆæ¦‚ç‡è®ºçš„çŸ¥è¯†ã€‚\n\nå¯¹äºåŒ…å« n ä¸ªæ•°æ®çš„æ•°ç»„ï¼Œè¿™ n ä¸ªæ•°æ®å°±æœ‰ n! ç§æ’åˆ—æ–¹å¼ã€‚ä¸åŒçš„æ’åˆ—æ–¹å¼ï¼Œå†’æ³¡æ’åºæ‰§è¡Œçš„æ—¶é—´è‚¯å®šæ˜¯ä¸åŒçš„ã€‚æ¯”å¦‚æˆ‘ä»¬å‰é¢ä¸¾çš„é‚£ä¸¤ä¸ªä¾‹å­ï¼Œå…¶ä¸­ä¸€ä¸ªè¦è¿›è¡Œ 6 æ¬¡å†’æ³¡ï¼Œè€Œå¦ä¸€ä¸ªåªéœ€è¦ 4 æ¬¡ã€‚å¦‚æœç”¨æ¦‚ç‡è®ºæ–¹æ³•å®šé‡åˆ†æå¹³å‡æ—¶é—´å¤æ‚åº¦ï¼Œæ¶‰åŠçš„æ•°å­¦æ¨ç†å’Œè®¡ç®—å°±ä¼šå¾ˆå¤æ‚ã€‚æˆ‘è¿™é‡Œè¿˜æœ‰ä¸€ç§æ€è·¯ï¼Œé€šè¿‡â€œ**æœ‰åºåº¦**â€å’Œâ€œ**é€†åºåº¦**â€è¿™ä¸¤ä¸ªæ¦‚å¿µæ¥è¿›è¡Œåˆ†æã€‚\n\n**æœ‰åºåº¦**æ˜¯æ•°ç»„ä¸­å…·æœ‰æœ‰åºå…³ç³»çš„å…ƒç´ å¯¹çš„ä¸ªæ•°ã€‚æœ‰åºå…ƒç´ å¯¹ç”¨æ•°å­¦è¡¨è¾¾å¼è¡¨ç¤ºå°±æ˜¯è¿™æ ·ï¼š\n\n```c\næœ‰åºå…ƒç´ å¯¹ï¼ša[i] \u003c= a[j], å¦‚æœi \u003c jã€‚\n```\n\n![Untitled](Extras/Images/alg_50.png)\n\nåŒç†ï¼Œå¯¹äºä¸€ä¸ªå€’åºæ’åˆ—çš„æ•°ç»„ï¼Œæ¯”å¦‚ 6ï¼Œ5ï¼Œ4ï¼Œ3ï¼Œ2ï¼Œ1ï¼Œæœ‰åºåº¦æ˜¯ 0ï¼›å¯¹äºä¸€ä¸ªå®Œå…¨æœ‰åºçš„æ•°ç»„ï¼Œæ¯”å¦‚ 1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œæœ‰åºåº¦å°±æ˜¯ **n*(n-1)/2**ï¼Œä¹Ÿå°±æ˜¯ 15ã€‚æˆ‘ä»¬æŠŠè¿™ç§å®Œå…¨æœ‰åºçš„æ•°ç»„çš„æœ‰åºåº¦å«ä½œ**æ»¡æœ‰åºåº¦**ã€‚\n\né€†åºåº¦çš„å®šä¹‰æ­£å¥½è·Ÿæœ‰åºåº¦ç›¸åï¼ˆé»˜è®¤ä»å°åˆ°å¤§ä¸ºæœ‰åºï¼‰ã€‚å…³äºè¿™ä¸‰ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¾—åˆ°ä¸€ä¸ªå…¬å¼ï¼š**é€†åºåº¦ = æ»¡æœ‰åºåº¦ - æœ‰åºåº¦**ã€‚æˆ‘ä»¬æ’åºçš„è¿‡ç¨‹å°±æ˜¯ä¸€ç§å¢åŠ æœ‰åºåº¦ï¼Œå‡å°‘é€†åºåº¦çš„è¿‡ç¨‹ï¼Œæœ€åè¾¾åˆ°æ»¡æœ‰åºåº¦ï¼Œå°±è¯´æ˜æ’åºå®Œæˆäº†ã€‚\n\næˆ‘è¿˜æ˜¯æ‹¿å‰é¢ä¸¾çš„é‚£ä¸ªå†’æ³¡æ’åºçš„ä¾‹å­æ¥è¯´æ˜ã€‚è¦æ’åºçš„æ•°ç»„çš„åˆå§‹çŠ¶æ€æ˜¯ 4ï¼Œ5ï¼Œ6ï¼Œ3ï¼Œ2ï¼Œ1 ï¼Œå…¶ä¸­ï¼Œæœ‰åºå…ƒç´ å¯¹æœ‰ (4ï¼Œ5) (4ï¼Œ6)(5ï¼Œ6)ï¼Œæ‰€ä»¥æœ‰åºåº¦æ˜¯ 3ã€‚n=6ï¼Œæ‰€ä»¥æ’åºå®Œæˆä¹‹åç»ˆæ€çš„æ»¡æœ‰åºåº¦ä¸º n*(n-1)/2=15ã€‚\n\nå†’æ³¡æ’åºåŒ…å«ä¸¤ä¸ªæ“ä½œåŸå­ï¼Œæ¯”è¾ƒå’Œäº¤æ¢ã€‚æ¯äº¤æ¢ä¸€æ¬¡ï¼Œæœ‰åºåº¦å°±åŠ  1ã€‚ä¸ç®¡ç®—æ³•æ€ä¹ˆæ”¹è¿›ï¼Œäº¤æ¢æ¬¡æ•°æ€»æ˜¯ç¡®å®šçš„ï¼Œå³ä¸º**é€†åºåº¦ï¼Œä¹Ÿå°±æ˜¯n*(n-1)/2â€“åˆå§‹æœ‰åºåº¦**ã€‚æ­¤ä¾‹ä¸­å°±æ˜¯ 15â€“3=12ï¼Œè¦è¿›è¡Œ 12 æ¬¡äº¤æ¢æ“ä½œã€‚\n\nå¯¹äºåŒ…å« n ä¸ªæ•°æ®çš„æ•°ç»„è¿›è¡Œå†’æ³¡æ’åºï¼Œå¹³å‡äº¤æ¢æ¬¡æ•°æ˜¯å¤šå°‘å‘¢ï¼Ÿæœ€åæƒ…å†µä¸‹ï¼Œåˆå§‹çŠ¶æ€çš„æœ‰åºåº¦æ˜¯ 0ï¼Œæ‰€ä»¥è¦è¿›è¡Œ n*(n-1)/2 æ¬¡äº¤æ¢ã€‚æœ€å¥½æƒ…å†µä¸‹ï¼Œåˆå§‹çŠ¶æ€çš„æœ‰åºåº¦æ˜¯ n*(n-1)/2ï¼Œå°±ä¸éœ€è¦è¿›è¡Œäº¤æ¢ã€‚æˆ‘ä»¬å¯ä»¥å–ä¸ªä¸­é—´å€¼ n*(n-1)/4ï¼Œæ¥è¡¨ç¤ºåˆå§‹æœ‰åºåº¦æ—¢ä¸æ˜¯å¾ˆé«˜ä¹Ÿä¸æ˜¯å¾ˆä½çš„å¹³å‡æƒ…å†µã€‚\n\næ¢å¥è¯è¯´ï¼Œå¹³å‡æƒ…å†µä¸‹ï¼Œéœ€è¦ n*(n-1)/4 æ¬¡äº¤æ¢æ“ä½œï¼Œæ¯”è¾ƒæ“ä½œè‚¯å®šè¦æ¯”äº¤æ¢æ“ä½œå¤šï¼Œè€Œå¤æ‚åº¦çš„ä¸Šé™æ˜¯ O(n2)ï¼Œæ‰€ä»¥å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(n2)ã€‚\n\n### æ’å…¥æ’åºï¼ˆInsertion Sortï¼‰\n\nä¸€ä¸ªæœ‰åºçš„æ•°ç»„ï¼Œæˆ‘ä»¬å¾€é‡Œé¢æ·»åŠ ä¸€ä¸ªæ–°çš„æ•°æ®åï¼Œå¦‚ä½•ç»§ç»­ä¿æŒæ•°æ®æœ‰åºå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªè¦éå†æ•°ç»„ï¼Œæ‰¾åˆ°æ•°æ®åº”è¯¥æ’å…¥çš„ä½ç½®å°†å…¶æ’å…¥å³å¯ã€‚\n\n![Untitled](Extras/Images/alg_51.png)\n\nè¿™æ˜¯ä¸€ä¸ªåŠ¨æ€æ’åºçš„è¿‡ç¨‹ï¼Œå³åŠ¨æ€åœ°å¾€æœ‰åºé›†åˆä¸­æ·»åŠ æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•ä¿æŒé›†åˆä¸­çš„æ•°æ®ä¸€ç›´æœ‰åºã€‚è€Œå¯¹äºä¸€ç»„é™æ€æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å€Ÿé‰´ä¸Šé¢è®²çš„æ’å…¥æ–¹æ³•ï¼Œæ¥è¿›è¡Œæ’åºï¼Œäºæ˜¯å°±æœ‰äº†æ’å…¥æ’åºç®—æ³•ã€‚\n\né‚£æ’å…¥æ’åºå…·ä½“æ˜¯å¦‚ä½•å€ŸåŠ©ä¸Šé¢çš„æ€æƒ³æ¥å®ç°æ’åºçš„å‘¢ï¼Ÿ\n\né¦–å…ˆï¼Œæˆ‘ä»¬å°†æ•°ç»„ä¸­çš„æ•°æ®åˆ†ä¸ºä¸¤ä¸ªåŒºé—´ï¼Œ**å·²æ’åºåŒºé—´**å’Œ**æœªæ’åºåŒºé—´**ã€‚åˆå§‹å·²æ’åºåŒºé—´åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå°±æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚æ’å…¥ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯å–æœªæ’åºåŒºé—´ä¸­çš„å…ƒç´ ï¼Œåœ¨å·²æ’åºåŒºé—´ä¸­æ‰¾åˆ°åˆé€‚çš„æ’å…¥ä½ç½®å°†å…¶æ’å…¥ï¼Œå¹¶ä¿è¯å·²æ’åºåŒºé—´æ•°æ®ä¸€ç›´æœ‰åºã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æœªæ’åºåŒºé—´ä¸­å…ƒç´ ä¸ºç©ºï¼Œç®—æ³•ç»“æŸã€‚\n\nå¦‚å›¾æ‰€ç¤ºï¼Œè¦æ’åºçš„æ•°æ®æ˜¯ 4ï¼Œ5ï¼Œ6ï¼Œ1ï¼Œ3ï¼Œ2ï¼Œå…¶ä¸­å·¦ä¾§ä¸ºå·²æ’åºåŒºé—´ï¼Œå³ä¾§æ˜¯æœªæ’åºåŒºé—´ã€‚\n\n![Untitled](Extras/Images/alg_52.png)\n\næ’å…¥æ’åºä¹ŸåŒ…å«ä¸¤ç§æ“ä½œï¼Œä¸€ç§æ˜¯å…ƒç´ çš„æ¯”è¾ƒï¼Œä¸€ç§æ˜¯å…ƒç´ çš„ç§»åŠ¨ã€‚å½“æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªæ•°æ® a æ’å…¥åˆ°å·²æ’åºåŒºé—´æ—¶ï¼Œéœ€è¦æ‹¿ a ä¸å·²æ’åºåŒºé—´çš„å…ƒç´ ä¾æ¬¡æ¯”è¾ƒå¤§å°ï¼Œæ‰¾åˆ°åˆé€‚çš„æ’å…¥ä½ç½®ã€‚æ‰¾åˆ°æ’å…¥ç‚¹ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†æ’å…¥ç‚¹ä¹‹åçš„å…ƒç´ é¡ºåºå¾€åç§»åŠ¨ä¸€ä½ï¼Œè¿™æ ·æ‰èƒ½è…¾å‡ºä½ç½®ç»™å…ƒç´  a æ’å…¥ã€‚\n\nå¯¹äºä¸åŒçš„æŸ¥æ‰¾æ’å…¥ç‚¹æ–¹æ³•ï¼ˆä»å¤´åˆ°å°¾ã€ä»å°¾åˆ°å¤´ï¼‰ï¼Œå…ƒç´ çš„æ¯”è¾ƒæ¬¡æ•°æ˜¯æœ‰åŒºåˆ«çš„ã€‚ä½†å¯¹äºä¸€ä¸ªç»™å®šçš„åˆå§‹åºåˆ—ï¼Œç§»åŠ¨æ“ä½œçš„æ¬¡æ•°æ€»æ˜¯å›ºå®šçš„ï¼Œå°±ç­‰äºé€†åºåº¦ã€‚\n\n- **ç¬¬ä¸€ï¼Œæ’å…¥æ’åºæ˜¯åŸåœ°æ’åºç®—æ³•å—ï¼Ÿ**\n\n    ä»å®ç°è¿‡ç¨‹å¯ä»¥å¾ˆæ˜æ˜¾åœ°çœ‹å‡ºï¼Œæ’å…¥æ’åºç®—æ³•çš„è¿è¡Œå¹¶ä¸éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸåœ°æ’åºç®—æ³•ã€‚\n\n- **ç¬¬äºŒï¼Œæ’å…¥æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å—ï¼Ÿ**\n\n    åœ¨æ’å…¥æ’åºä¸­ï¼Œå¯¹äºå€¼ç›¸åŒçš„å…ƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å°†åé¢å‡ºç°çš„å…ƒç´ ï¼Œæ’å…¥åˆ°å‰é¢å‡ºç°å…ƒç´ çš„åé¢ï¼Œè¿™æ ·å°±å¯ä»¥ä¿æŒåŸæœ‰çš„å‰åé¡ºåºä¸å˜ï¼Œæ‰€ä»¥æ’å…¥æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•ã€‚\n\n- **ç¬¬ä¸‰ï¼Œæ’å…¥æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ**\n\n    å¯¹äºæ’å…¥æ’åºæ¥è¯´ï¼Œæ¯æ¬¡æ’å…¥æ“ä½œéƒ½ç›¸å½“äºåœ¨æ•°ç»„ä¸­æ’å…¥ä¸€ä¸ªæ•°æ®ï¼Œå¾ªç¯æ‰§è¡Œ n æ¬¡æ’å…¥æ“ä½œï¼Œæ‰€ä»¥å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(n2)ã€‚\n\n\n### é€‰æ‹©æ’åºï¼ˆSelection Sortï¼‰\n\né€‰æ‹©æ’åºç®—æ³•çš„å®ç°æ€è·¯æœ‰ç‚¹ç±»ä¼¼æ’å…¥æ’åºï¼Œä¹Ÿåˆ†å·²æ’åºåŒºé—´å’Œæœªæ’åºåŒºé—´ã€‚ä½†æ˜¯é€‰æ‹©æ’åºæ¯æ¬¡ä¼šä»æœªæ’åºåŒºé—´ä¸­æ‰¾åˆ°æœ€å°çš„å…ƒç´ ï¼Œå°†å…¶æ”¾åˆ°å·²æ’åºåŒºé—´çš„æœ«å°¾ã€‚\n\n![Untitled](Extras/Images/alg_53.png)\n\né¦–å…ˆï¼Œé€‰æ‹©æ’åºç©ºé—´å¤æ‚åº¦ä¸º O(1)ï¼Œæ˜¯ä¸€ç§åŸåœ°æ’åºç®—æ³•ã€‚é€‰æ‹©æ’åºçš„æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ã€æœ€åæƒ…å†µå’Œå¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦éƒ½ä¸º O(n2)ã€‚\n\né‚£é€‰æ‹©æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œé€‰æ‹©æ’åºæ˜¯ä¸€ç§ä¸ç¨³å®šçš„æ’åºç®—æ³•ã€‚ä»å‰é¢çš„é‚£å¼ å›¾ä¸­ï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œé€‰æ‹©æ’åºæ¯æ¬¡éƒ½è¦æ‰¾å‰©ä½™æœªæ’åºå…ƒç´ ä¸­çš„æœ€å°å€¼ï¼Œå¹¶å’Œå‰é¢çš„å…ƒç´ äº¤æ¢ä½ç½®ï¼Œè¿™æ ·ç ´åäº†ç¨³å®šæ€§ã€‚\n\n### ä¸ºä»€ä¹ˆæ’å…¥æ’åºè¦æ¯”å†’æ³¡æ’åºæ›´å—æ¬¢è¿å‘¢ï¼Ÿ\n\nå†’æ³¡æ’åºä¸ç®¡æ€ä¹ˆä¼˜åŒ–ï¼Œå…ƒç´ äº¤æ¢çš„æ¬¡æ•°æ˜¯ä¸€ä¸ªå›ºå®šå€¼ï¼Œæ˜¯åŸå§‹æ•°æ®çš„é€†åºåº¦ã€‚æ’å…¥æ’åºæ˜¯åŒæ ·çš„ï¼Œä¸ç®¡æ€ä¹ˆä¼˜åŒ–ï¼Œå…ƒç´ ç§»åŠ¨çš„æ¬¡æ•°ä¹Ÿç­‰äºåŸå§‹æ•°æ®çš„é€†åºåº¦ã€‚\n\nä½†æ˜¯ï¼Œä»ä»£ç å®ç°ä¸Šæ¥çœ‹ï¼Œå†’æ³¡æ’åºçš„æ•°æ®äº¤æ¢è¦æ¯”æ’å…¥æ’åºçš„æ•°æ®ç§»åŠ¨è¦å¤æ‚ï¼Œå†’æ³¡æ’åºéœ€è¦ 3 ä¸ªèµ‹å€¼æ“ä½œï¼Œè€Œæ’å…¥æ’åºåªéœ€è¦ 1 ä¸ªã€‚æˆ‘ä»¬æ¥çœ‹è¿™æ®µæ“ä½œï¼š\n\n```c\n// å†’æ³¡æ’åºä¸­æ•°æ®çš„äº¤æ¢æ“ä½œï¼š\nif (a[j] \u003e a[j+1]) { // äº¤æ¢\n   int tmp = a[j];\n   a[j] = a[j+1];\n   a[j+1] = tmp;\n   flag = true;\n}\n\n// æ’å…¥æ’åºä¸­æ•°æ®çš„ç§»åŠ¨æ“ä½œï¼š\nif (a[j] \u003e value) {\n  a[j+1] = a[j];  // æ•°æ®ç§»åŠ¨\n} else {\n  break;\n}\n```\n\næˆ‘ä»¬æŠŠæ‰§è¡Œä¸€ä¸ªèµ‹å€¼è¯­å¥çš„æ—¶é—´ç²—ç•¥åœ°è®¡ä¸ºå•ä½æ—¶é—´ï¼ˆunit_timeï¼‰ï¼Œç„¶ååˆ†åˆ«ç”¨å†’æ³¡æ’åºå’Œæ’å…¥æ’åºå¯¹åŒä¸€ä¸ªé€†åºåº¦æ˜¯ K çš„æ•°ç»„è¿›è¡Œæ’åºã€‚ç”¨å†’æ³¡æ’åºï¼Œéœ€è¦ K æ¬¡äº¤æ¢æ“ä½œï¼Œæ¯æ¬¡éœ€è¦ 3 ä¸ªèµ‹å€¼è¯­å¥ï¼Œæ‰€ä»¥äº¤æ¢æ“ä½œæ€»è€—æ—¶å°±æ˜¯ 3*K å•ä½æ—¶é—´ã€‚è€Œæ’å…¥æ’åºä¸­æ•°æ®ç§»åŠ¨æ“ä½œåªéœ€è¦ K ä¸ªå•ä½æ—¶é—´ã€‚\n\n![Untitled](Extras/Images/alg_54.png)\n\n### å½’å¹¶æ’åº\n\nå½’å¹¶æ’åºçš„æ ¸å¿ƒæ€æƒ³è¿˜æ˜¯è›®ç®€å•çš„ã€‚å¦‚æœè¦æ’åºä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬å…ˆæŠŠæ•°ç»„ä»ä¸­é—´åˆ†æˆå‰åä¸¤éƒ¨åˆ†ï¼Œç„¶åå¯¹å‰åä¸¤éƒ¨åˆ†åˆ†åˆ«æ’åºï¼Œå†å°†æ’å¥½åºçš„ä¸¤éƒ¨åˆ†åˆå¹¶åœ¨ä¸€èµ·ï¼Œè¿™æ ·æ•´ä¸ªæ•°ç»„å°±éƒ½æœ‰åºäº†ã€‚\n\n![Untitled](Extras/Images/alg_55.png)\n\nå½’å¹¶æ’åºä½¿ç”¨çš„å°±æ˜¯**åˆ†æ²»æ€æƒ³**ã€‚åˆ†æ²»ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åˆ†è€Œæ²»ä¹‹ï¼Œå°†ä¸€ä¸ªå¤§é—®é¢˜åˆ†è§£æˆå°çš„å­é—®é¢˜æ¥è§£å†³ã€‚å°çš„å­é—®é¢˜è§£å†³äº†ï¼Œå¤§é—®é¢˜ä¹Ÿå°±è§£å†³äº†ã€‚\n\nåˆ†æ²»æ€æƒ³è·Ÿæˆ‘ä»¬å‰é¢è®²çš„é€’å½’æ€æƒ³å¾ˆåƒã€‚æ˜¯çš„ï¼Œåˆ†æ²»ç®—æ³•ä¸€èˆ¬éƒ½æ˜¯ç”¨é€’å½’æ¥å®ç°çš„ã€‚**åˆ†æ²»æ˜¯ä¸€ç§è§£å†³é—®é¢˜çš„å¤„ç†æ€æƒ³ï¼Œé€’å½’æ˜¯ä¸€ç§ç¼–ç¨‹æŠ€å·§**ï¼Œè¿™ä¸¤è€…å¹¶ä¸å†²çªã€‚\n\nå†™é€’å½’ä»£ç çš„æŠ€å·§å°±æ˜¯ï¼Œåˆ†æå¾—å‡ºé€’æ¨å…¬å¼ï¼Œç„¶åæ‰¾åˆ°ç»ˆæ­¢æ¡ä»¶ï¼Œæœ€åå°†é€’æ¨å…¬å¼ç¿»è¯‘æˆé€’å½’ä»£ç ã€‚æ‰€ä»¥ï¼Œè¦æƒ³å†™å‡ºå½’å¹¶æ’åºçš„ä»£ç ï¼Œæˆ‘ä»¬å…ˆå†™å‡ºå½’å¹¶æ’åºçš„é€’æ¨å…¬å¼ã€‚\n\n```c\né€’æ¨å…¬å¼ï¼š\nmerge_sort(pâ€¦r) = merge(merge_sort(pâ€¦q), merge_sort(q+1â€¦r))\n\nç»ˆæ­¢æ¡ä»¶ï¼š\np \u003e= r ä¸ç”¨å†ç»§ç»­åˆ†è§£\n```\n\n```c\n// å½’å¹¶æ’åºç®—æ³•, Aæ˜¯æ•°ç»„ï¼Œnè¡¨ç¤ºæ•°ç»„å¤§å°\nmerge_sort(A, n) {\n  merge_sort_c(A, 0, n-1)\n}\n\n// é€’å½’è°ƒç”¨å‡½æ•°\nmerge_sort_c(A, p, r) {\n  // é€’å½’ç»ˆæ­¢æ¡ä»¶\n  if p \u003e= r  then return\n\n  // å–påˆ°rä¹‹é—´çš„ä¸­é—´ä½ç½®q\n  q = (p+r) / 2\n  // åˆ†æ²»é€’å½’\n  merge_sort_c(A, p, q)\n  merge_sort_c(A, q+1, r)\n  // å°†A[p...q]å’ŒA[q+1...r]åˆå¹¶ä¸ºA[p...r]\n  merge(A[p...r], A[p...q], A[q+1...r])\n}\n```\n\nä½ å¯èƒ½å·²ç»å‘ç°äº†ï¼Œmerge(A[p...r], A[p...q], A[q+1...r]) è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯ï¼Œå°†å·²ç»æœ‰åºçš„ A[p...q]å’Œ A[q+1....r]åˆå¹¶æˆä¸€ä¸ªæœ‰åºçš„æ•°ç»„ï¼Œå¹¶ä¸”æ”¾å…¥ A[p....r]ã€‚é‚£è¿™ä¸ªè¿‡ç¨‹å…·ä½“è¯¥å¦‚ä½•åšå‘¢ï¼Ÿ\n\nå¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬ç”³è¯·ä¸€ä¸ªä¸´æ—¶æ•°ç»„ tmpï¼Œå¤§å°ä¸ A[p...r]ç›¸åŒã€‚æˆ‘ä»¬ç”¨ä¸¤ä¸ªæ¸¸æ ‡ i å’Œ jï¼Œåˆ†åˆ«æŒ‡å‘ A[p...q]å’Œ A[q+1...r]çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚æ¯”è¾ƒè¿™ä¸¤ä¸ªå…ƒç´  A[i]å’Œ A[j]ï¼Œå¦‚æœ A[i]\u003c=A[j]ï¼Œæˆ‘ä»¬å°±æŠŠ A[i]æ”¾å…¥åˆ°ä¸´æ—¶æ•°ç»„ tmpï¼Œå¹¶ä¸” i åç§»ä¸€ä½ï¼Œå¦åˆ™å°† A[j]æ”¾å…¥åˆ°æ•°ç»„ tmpï¼Œj åç§»ä¸€ä½ã€‚\n\nç»§ç»­ä¸Šè¿°æ¯”è¾ƒè¿‡ç¨‹ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªå­æ•°ç»„ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½æ”¾å…¥ä¸´æ—¶æ•°ç»„ä¸­ï¼Œå†æŠŠå¦ä¸€ä¸ªæ•°ç»„ä¸­çš„æ•°æ®ä¾æ¬¡åŠ å…¥åˆ°ä¸´æ—¶æ•°ç»„çš„æœ«å°¾ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¸´æ—¶æ•°ç»„ä¸­å­˜å‚¨çš„å°±æ˜¯ä¸¤ä¸ªå­æ•°ç»„åˆå¹¶ä¹‹åçš„ç»“æœäº†ã€‚æœ€åå†æŠŠä¸´æ—¶æ•°ç»„ tmp ä¸­çš„æ•°æ®æ‹·è´åˆ°åŸæ•°ç»„ A[p...r]ä¸­ã€‚\n\n![Untitled](Extras/Images/alg_56.png)\n\n```c\nmerge(A[p...r], A[p...q], A[q+1...r]) {\n  var i := pï¼Œj := q+1ï¼Œk := 0 // åˆå§‹åŒ–å˜é‡i, j, k\n  var tmp := new array[0...r-p] // ç”³è¯·ä¸€ä¸ªå¤§å°è·ŸA[p...r]ä¸€æ ·çš„ä¸´æ—¶æ•°ç»„\n  while i\u003c=q AND j\u003c=r do {\n    if A[i] \u003c= A[j] {\n      tmp[k++] = A[i++] // i++ç­‰äºi:=i+1\n    } else {\n      tmp[k++] = A[j++]\n    }\n  }\n\n  // åˆ¤æ–­å“ªä¸ªå­æ•°ç»„ä¸­æœ‰å‰©ä½™çš„æ•°æ®\n  var start := iï¼Œend := q\n  if j\u003c=r then start := j, end:=r\n\n  // å°†å‰©ä½™çš„æ•°æ®æ‹·è´åˆ°ä¸´æ—¶æ•°ç»„tmp\n  while start \u003c= end do {\n    tmp[k++] = A[start++]\n  }\n\n  // å°†tmpä¸­çš„æ•°ç»„æ‹·è´å›A[p...r]\n  for i:=0 to r-p do {\n    A[p+i] = tmp[i]\n  }\n}\n```\n\n- **å½’å¹¶æ’åºçš„æ€§èƒ½åˆ†æ**\n    - **ç¬¬ä¸€ï¼Œå½’å¹¶æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å—ï¼Ÿ**\n\n        ç»“åˆæˆ‘å‰é¢ç”»çš„é‚£å¼ å›¾å’Œå½’å¹¶æ’åºçš„ä¼ªä»£ç ï¼Œä½ åº”è¯¥èƒ½å‘ç°ï¼Œå½’å¹¶æ’åºç¨³ä¸ç¨³å®šå…³é”®è¦çœ‹ merge() å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªæœ‰åºå­æ•°ç»„åˆå¹¶æˆä¸€ä¸ªæœ‰åºæ•°ç»„çš„é‚£éƒ¨åˆ†ä»£ç ã€‚\n\n        åœ¨åˆå¹¶çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœ A[p...q]å’Œ A[q+1...r]ä¹‹é—´æœ‰å€¼ç›¸åŒçš„å…ƒç´ ï¼Œé‚£æˆ‘ä»¬å¯ä»¥åƒä¼ªä»£ç ä¸­é‚£æ ·ï¼Œå…ˆæŠŠ A[p...q]ä¸­çš„å…ƒç´ æ”¾å…¥ tmp æ•°ç»„ã€‚è¿™æ ·å°±ä¿è¯äº†å€¼ç›¸åŒçš„å…ƒç´ ï¼Œåœ¨åˆå¹¶å‰åçš„å…ˆåé¡ºåºä¸å˜ã€‚æ‰€ä»¥ï¼Œå½’å¹¶æ’åºæ˜¯ä¸€ä¸ªç¨³å®šçš„æ’åºç®—æ³•ã€‚\n\n    - **ç¬¬äºŒï¼Œå½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ**\n\n        åœ¨é€’å½’é‚£ä¸€èŠ‚æˆ‘ä»¬è®²è¿‡ï¼Œé€’å½’çš„é€‚ç”¨åœºæ™¯æ˜¯ï¼Œä¸€ä¸ªé—®é¢˜ a å¯ä»¥åˆ†è§£ä¸ºå¤šä¸ªå­é—®é¢˜ bã€cï¼Œé‚£æ±‚è§£é—®é¢˜ a å°±å¯ä»¥åˆ†è§£ä¸ºæ±‚è§£é—®é¢˜ bã€cã€‚é—®é¢˜ bã€c è§£å†³ä¹‹åï¼Œæˆ‘ä»¬å†æŠŠ bã€c çš„ç»“æœåˆå¹¶æˆ a çš„ç»“æœã€‚\n\n        å¦‚æœæˆ‘ä»¬å®šä¹‰æ±‚è§£é—®é¢˜ a çš„æ—¶é—´æ˜¯ T(a)ï¼Œæ±‚è§£é—®é¢˜ bã€c çš„æ—¶é—´åˆ†åˆ«æ˜¯ T(b) å’Œ T( c)ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°è¿™æ ·çš„é€’æ¨å…³ç³»å¼ï¼š\n\n        ```c\n        T(a) = T(b) + T(c) + K\n        ```\n\n        å…¶ä¸­ K ç­‰äºå°†ä¸¤ä¸ªå­é—®é¢˜ bã€c çš„ç»“æœåˆå¹¶æˆé—®é¢˜ a çš„ç»“æœæ‰€æ¶ˆè€—çš„æ—¶é—´ã€‚\n\n        ä»åˆšåˆšçš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªé‡è¦çš„ç»“è®ºï¼š**ä¸ä»…é€’å½’æ±‚è§£çš„é—®é¢˜å¯ä»¥å†™æˆé€’æ¨å…¬å¼ï¼Œé€’å½’ä»£ç çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿå¯ä»¥å†™æˆé€’æ¨å…¬å¼ã€‚**\n\n        å¥—ç”¨è¿™ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ã€‚æˆ‘ä»¬å‡è®¾å¯¹ n ä¸ªå…ƒç´ è¿›è¡Œå½’å¹¶æ’åºéœ€è¦çš„æ—¶é—´æ˜¯ T(n)ï¼Œé‚£åˆ†è§£æˆä¸¤ä¸ªå­æ•°ç»„æ’åºçš„æ—¶é—´éƒ½æ˜¯ T(n/2)ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œmerge() å‡½æ•°åˆå¹¶ä¸¤ä¸ªæœ‰åºå­æ•°ç»„çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚æ‰€ä»¥ï¼Œå¥—ç”¨å‰é¢çš„å…¬å¼ï¼Œå½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦çš„è®¡ç®—å…¬å¼å°±æ˜¯ï¼š\n\n        ```c\n        T(1) = Cï¼›   n=1æ—¶ï¼Œåªéœ€è¦å¸¸é‡çº§çš„æ‰§è¡Œæ—¶é—´ï¼Œæ‰€ä»¥è¡¨ç¤ºä¸ºCã€‚\n        T(n) = 2*T(n/2) + nï¼› n\u003e1\n\n        T(n) = 2*T(n/2) + n\n             = 2*(2*T(n/4) + n/2) + n = 4*T(n/4) + 2*n\n             = 4*(2*T(n/8) + n/4) + 2*n = 8*T(n/8) + 3*n\n             = 8*(2*T(n/16) + n/8) + 3*n = 16*T(n/16) + 4*n\n             ......\n             = 2^k * T(n/2^k) + k * n\n             ......\n        ```\n\n        é€šè¿‡è¿™æ ·ä¸€æ­¥ä¸€æ­¥åˆ†è§£æ¨å¯¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° T(n) = 2^kT(n/2^k)+knã€‚å½“ T(n/2^k)=T(1) æ—¶ï¼Œä¹Ÿå°±æ˜¯ n/2^k=1ï¼Œæˆ‘ä»¬å¾—åˆ° k=log2n ã€‚æˆ‘ä»¬å°† k å€¼ä»£å…¥ä¸Šé¢çš„å…¬å¼ï¼Œå¾—åˆ° T(n)=Cn+nlog2n ã€‚å¦‚æœæˆ‘ä»¬ç”¨å¤§ O æ ‡è®°æ³•æ¥è¡¨ç¤ºçš„è¯ï¼ŒT(n) å°±ç­‰äº O(nlogn)ã€‚**æ‰€ä»¥å½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogn)ã€‚**\n\n        ä»æˆ‘ä»¬çš„åŸç†åˆ†æå’Œä¼ªä»£ç å¯ä»¥çœ‹å‡ºï¼Œå½’å¹¶æ’åºçš„æ‰§è¡Œæ•ˆç‡ä¸è¦æ’åºçš„åŸå§‹æ•°ç»„çš„æœ‰åºç¨‹åº¦æ— å…³ï¼Œæ‰€ä»¥å…¶æ—¶é—´å¤æ‚åº¦æ˜¯éå¸¸ç¨³å®šçš„ï¼Œä¸ç®¡æ˜¯æœ€å¥½æƒ…å†µã€æœ€åæƒ…å†µï¼Œè¿˜æ˜¯å¹³å‡æƒ…å†µï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(nlogn)ã€‚\n\n    - **ç¬¬ä¸‰ï¼Œå½’å¹¶æ’åºçš„ç©ºé—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ**\n\n        å½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ä»»ä½•æƒ…å†µä¸‹éƒ½æ˜¯ O(nlogn)ï¼Œçœ‹èµ·æ¥éå¸¸ä¼˜ç§€ã€‚ï¼ˆå³ä¾¿æ˜¯å¿«é€Ÿæ’åºï¼Œæœ€åæƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(n2)ã€‚ï¼‰ä½†æ˜¯ï¼Œå½’å¹¶æ’åºå¹¶æ²¡æœ‰åƒå¿«æ’é‚£æ ·ï¼Œåº”ç”¨å¹¿æ³›ï¼Œå› ä¸ºå®ƒæœ‰ä¸€ä¸ªè‡´å‘½çš„â€œå¼±ç‚¹â€ï¼Œé‚£å°±æ˜¯å½’å¹¶æ’åºä¸æ˜¯åŸåœ°æ’åºç®—æ³•ã€‚\n\n        åœ¨ä»»æ„æ—¶åˆ»ï¼ŒCPU åªä¼šæœ‰ä¸€ä¸ªå‡½æ•°åœ¨æ‰§è¡Œï¼Œä¹Ÿå°±åªä¼šæœ‰ä¸€ä¸ªä¸´æ—¶çš„å†…å­˜ç©ºé—´åœ¨ä½¿ç”¨ã€‚ä¸´æ—¶å†…å­˜ç©ºé—´æœ€å¤§ä¹Ÿä¸ä¼šè¶…è¿‡ n ä¸ªæ•°æ®çš„å¤§å°ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦æ˜¯ O(n)ã€‚\n\n\n### å¿«é€Ÿæ’åº\n\nå¿«æ’çš„æ€æƒ³æ˜¯è¿™æ ·çš„ï¼šå¦‚æœè¦æ’åºæ•°ç»„ä¸­ä¸‹æ ‡ä» p åˆ° r ä¹‹é—´çš„ä¸€ç»„æ•°æ®ï¼Œæˆ‘ä»¬é€‰æ‹© p åˆ° r ä¹‹é—´çš„ä»»æ„ä¸€ä¸ªæ•°æ®ä½œä¸º pivotï¼ˆåˆ†åŒºç‚¹ï¼‰ã€‚\n\næˆ‘ä»¬éå† p åˆ° r ä¹‹é—´çš„æ•°æ®ï¼Œå°†å°äº pivot çš„æ”¾åˆ°å·¦è¾¹ï¼Œå°†å¤§äº pivot çš„æ”¾åˆ°å³è¾¹ï¼Œå°† pivot æ”¾åˆ°ä¸­é—´ã€‚ç»è¿‡è¿™ä¸€æ­¥éª¤ä¹‹åï¼Œæ•°ç»„ p åˆ° r ä¹‹é—´çš„æ•°æ®å°±è¢«åˆ†æˆäº†ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå‰é¢ p åˆ° q-1 ä¹‹é—´éƒ½æ˜¯å°äº pivot çš„ï¼Œä¸­é—´æ˜¯ pivotï¼Œåé¢çš„ q+1 åˆ° r ä¹‹é—´æ˜¯å¤§äº pivot çš„ã€‚\n\n![Untitled](Extras/Images/alg_57.png)\n\næ ¹æ®åˆ†æ²»ã€é€’å½’çš„å¤„ç†æ€æƒ³ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨é€’å½’æ’åºä¸‹æ ‡ä» p åˆ° q-1 ä¹‹é—´çš„æ•°æ®å’Œä¸‹æ ‡ä» q+1 åˆ° r ä¹‹é—´çš„æ•°æ®ï¼Œç›´åˆ°åŒºé—´ç¼©å°ä¸º 1ï¼Œå°±è¯´æ˜æ‰€æœ‰çš„æ•°æ®éƒ½æœ‰åºäº†ã€‚\n\nå¦‚æœæˆ‘ä»¬ç”¨é€’æ¨å…¬å¼æ¥å°†ä¸Šé¢çš„è¿‡ç¨‹å†™å‡ºæ¥çš„è¯ï¼Œå°±æ˜¯è¿™æ ·ï¼š\n\n```c\né€’æ¨å…¬å¼ï¼š\nquick_sort(pâ€¦r) = quick_sort(pâ€¦q-1) + quick_sort(q+1â€¦ r)\n\nç»ˆæ­¢æ¡ä»¶ï¼š\np \u003e= r\n```\n\næˆ‘å°†é€’æ¨å…¬å¼è½¬åŒ–æˆé€’å½’ä»£ç ã€‚è·Ÿå½’å¹¶æ’åºä¸€æ ·ï¼Œæˆ‘è¿˜æ˜¯ç”¨ä¼ªä»£ç æ¥å®ç°ï¼Œä½ å¯ä»¥ç¿»è¯‘æˆä½ ç†Ÿæ‚‰çš„ä»»ä½•è¯­è¨€ã€‚\n\n```c\n// å¿«é€Ÿæ’åºï¼ŒAæ˜¯æ•°ç»„ï¼Œnè¡¨ç¤ºæ•°ç»„çš„å¤§å°\nquick_sort(A, n) {\n  quick_sort_c(A, 0, n-1)\n}\n// å¿«é€Ÿæ’åºé€’å½’å‡½æ•°ï¼Œp,rä¸ºä¸‹æ ‡\nquick_sort_c(A, p, r) {\n  if p \u003e= r then return\n\n  q = partition(A, p, r) // è·å–åˆ†åŒºç‚¹\n  quick_sort_c(A, p, q-1)\n  quick_sort_c(A, q+1, r)\n}\n```\n\nåŸåœ°åˆ†åŒºå‡½æ•°çš„å®ç°æ€è·¯éå¸¸å·§å¦™ï¼Œæˆ‘å†™æˆäº†ä¼ªä»£ç ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ã€‚\n\n```c\npartition(A, p, r) {\n  pivot := A[r]\n  i := p\n  for j := p to r-1 do {\n    if A[j] \u003c pivot {\n      swap A[i] with A[j]\n      i := i+1\n    }\n  }\n  swap A[i] with A[r]\n  return i\n```\n\næˆ‘ä»¬é€šè¿‡æ¸¸æ ‡ i æŠŠ A[p...r-1]åˆ†æˆä¸¤éƒ¨åˆ†ã€‚A[p...i-1]çš„å…ƒç´ éƒ½æ˜¯å°äº pivot çš„ï¼Œæˆ‘ä»¬æš‚ä¸”å«å®ƒâ€œå·²å¤„ç†åŒºé—´â€ï¼ŒA[i...r-1]æ˜¯â€œæœªå¤„ç†åŒºé—´â€ã€‚æˆ‘ä»¬æ¯æ¬¡éƒ½ä»æœªå¤„ç†çš„åŒºé—´ A[i...r-1]ä¸­å–ä¸€ä¸ªå…ƒç´  A[j]ï¼Œä¸ pivot å¯¹æ¯”ï¼Œå¦‚æœå°äº pivotï¼Œåˆ™å°†å…¶åŠ å…¥åˆ°å·²å¤„ç†åŒºé—´çš„å°¾éƒ¨ï¼Œä¹Ÿå°±æ˜¯ A[i]çš„ä½ç½®ã€‚\n\n![Untitled](Extras/Images/alg_58.png)\n\nå› ä¸ºåˆ†åŒºçš„è¿‡ç¨‹æ¶‰åŠäº¤æ¢æ“ä½œï¼Œå¦‚æœæ•°ç»„ä¸­æœ‰ä¸¤ä¸ªç›¸åŒçš„å…ƒç´ ï¼Œæ¯”å¦‚åºåˆ— 6ï¼Œ8ï¼Œ7ï¼Œ6ï¼Œ3ï¼Œ5ï¼Œ9ï¼Œ4ï¼Œåœ¨ç»è¿‡ç¬¬ä¸€æ¬¡åˆ†åŒºæ“ä½œä¹‹åï¼Œä¸¤ä¸ª 6 çš„ç›¸å¯¹å…ˆåé¡ºåºå°±ä¼šæ”¹å˜ã€‚æ‰€ä»¥ï¼Œ**å¿«é€Ÿæ’åºå¹¶ä¸æ˜¯ä¸€ä¸ªç¨³å®šçš„æ’åºç®—æ³•ã€‚**\n\nåˆ°æ­¤ï¼Œå¿«é€Ÿæ’åºçš„åŸç†ä½ åº”è¯¥ä¹ŸæŒæ¡äº†ã€‚ç°åœ¨ï¼Œæˆ‘å†æ¥çœ‹å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šå¿«æ’å’Œå½’å¹¶ç”¨çš„éƒ½æ˜¯åˆ†æ²»æ€æƒ³ï¼Œé€’æ¨å…¬å¼å’Œé€’å½’ä»£ç ä¹Ÿéå¸¸ç›¸ä¼¼ï¼Œé‚£å®ƒä»¬çš„åŒºåˆ«åœ¨å“ªé‡Œå‘¢ï¼Ÿ\n\n![Untitled](Extras/Images/alg_59.png)\n\nå¯ä»¥å‘ç°ï¼Œå½’å¹¶æ’åºçš„å¤„ç†è¿‡ç¨‹æ˜¯ç”±ä¸‹åˆ°ä¸Šçš„ï¼Œå…ˆå¤„ç†å­é—®é¢˜ï¼Œç„¶åå†åˆå¹¶ã€‚è€Œå¿«æ’æ­£å¥½ç›¸åï¼Œå®ƒçš„å¤„ç†è¿‡ç¨‹æ˜¯ç”±ä¸Šåˆ°ä¸‹çš„ï¼Œå…ˆåˆ†åŒºï¼Œç„¶åå†å¤„ç†å­é—®é¢˜ã€‚\n\n- **å¿«é€Ÿæ’åºçš„æ€§èƒ½åˆ†æ**\n\nå¿«æ’ä¹Ÿæ˜¯ç”¨é€’å½’æ¥å®ç°çš„ã€‚å¯¹äºé€’å½’ä»£ç çš„æ—¶é—´å¤æ‚åº¦ï¼Œæˆ‘å‰é¢æ€»ç»“çš„å…¬å¼ï¼Œè¿™é‡Œä¹Ÿè¿˜æ˜¯é€‚ç”¨çš„ã€‚å¦‚æœæ¯æ¬¡åˆ†åŒºæ“ä½œï¼Œéƒ½èƒ½æ­£å¥½æŠŠæ•°ç»„åˆ†æˆå¤§å°æ¥è¿‘ç›¸ç­‰çš„ä¸¤ä¸ªå°åŒºé—´ï¼Œé‚£å¿«æ’çš„æ—¶é—´å¤æ‚åº¦é€’æ¨æ±‚è§£å…¬å¼è·Ÿå½’å¹¶æ˜¯ç›¸åŒçš„ã€‚æ‰€ä»¥ï¼Œå¿«æ’çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(nlogn)ã€‚\n\n```c\nT(1) = Cï¼›   n=1æ—¶ï¼Œåªéœ€è¦å¸¸é‡çº§çš„æ‰§è¡Œæ—¶é—´ï¼Œæ‰€ä»¥è¡¨ç¤ºä¸ºCã€‚\nT(n) = 2*T(n/2) + nï¼› n\u003e1\n```\n\nä½†æ˜¯ï¼Œå…¬å¼æˆç«‹çš„å‰ææ˜¯æ¯æ¬¡åˆ†åŒºæ“ä½œï¼Œæˆ‘ä»¬é€‰æ‹©çš„ pivot éƒ½å¾ˆåˆé€‚ï¼Œæ­£å¥½èƒ½å°†å¤§åŒºé—´å¯¹ç­‰åœ°ä¸€åˆ†ä¸ºäºŒã€‚ä½†å®é™…ä¸Šè¿™ç§æƒ…å†µæ˜¯å¾ˆéš¾å®ç°çš„ã€‚\n\nä¸¾ä¸€ä¸ªæ¯”è¾ƒæç«¯çš„ä¾‹å­ã€‚å¦‚æœæ•°ç»„ä¸­çš„æ•°æ®åŸæ¥å·²ç»æ˜¯æœ‰åºçš„äº†ï¼Œæ¯”å¦‚ 1ï¼Œ3ï¼Œ5ï¼Œ6ï¼Œ8ã€‚å¦‚æœæˆ‘ä»¬æ¯æ¬¡é€‰æ‹©æœ€åä¸€ä¸ªå…ƒç´ ä½œä¸º pivotï¼Œé‚£æ¯æ¬¡åˆ†åŒºå¾—åˆ°çš„ä¸¤ä¸ªåŒºé—´éƒ½æ˜¯ä¸å‡ç­‰çš„ã€‚æˆ‘ä»¬éœ€è¦è¿›è¡Œå¤§çº¦ n æ¬¡åˆ†åŒºæ“ä½œï¼Œæ‰èƒ½å®Œæˆå¿«æ’çš„æ•´ä¸ªè¿‡ç¨‹ã€‚æ¯æ¬¡åˆ†åŒºæˆ‘ä»¬å¹³å‡è¦æ‰«æå¤§çº¦ n/2 ä¸ªå…ƒç´ ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¿«æ’çš„æ—¶é—´å¤æ‚åº¦å°±ä» O(nlogn) é€€åŒ–æˆäº† O(n2)ã€‚\n\nT(n) åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦éƒ½å¯ä»¥åšåˆ° O(nlogn)ï¼Œåªæœ‰åœ¨æç«¯æƒ…å†µä¸‹ï¼Œæ‰ä¼šé€€åŒ–åˆ° O(n2)ã€‚è€Œä¸”ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰å¾ˆå¤šæ–¹æ³•å°†è¿™ä¸ªæ¦‚ç‡é™åˆ°å¾ˆä½ã€‚\n\n## **çº¿æ€§æ’åº**\n\nä¸‰ç§æ—¶é—´å¤æ‚åº¦æ˜¯ O(n) çš„æ’åºç®—æ³•ï¼šæ¡¶æ’åºã€è®¡æ•°æ’åºã€åŸºæ•°æ’åºã€‚å› ä¸ºè¿™äº›æ’åºç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯çº¿æ€§çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ç±»æ’åºç®—æ³•å«ä½œçº¿æ€§æ’åºï¼ˆLinear sortï¼‰ã€‚ä¹‹æ‰€ä»¥èƒ½åšåˆ°çº¿æ€§çš„æ—¶é—´å¤æ‚åº¦ï¼Œä¸»è¦åŸå› æ˜¯ï¼Œè¿™ä¸‰ä¸ªç®—æ³•æ˜¯éåŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•ï¼Œéƒ½ä¸æ¶‰åŠå…ƒç´ ä¹‹é—´çš„æ¯”è¾ƒæ“ä½œã€‚\n\n### æ¡¶æ’åºï¼ˆBucket sortï¼‰\n\næ¡¶æ’åºï¼Œé¡¾åæ€ä¹‰ï¼Œä¼šç”¨åˆ°â€œæ¡¶â€ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯å°†è¦æ’åºçš„æ•°æ®åˆ†åˆ°å‡ ä¸ªæœ‰åºçš„æ¡¶é‡Œï¼Œæ¯ä¸ªæ¡¶é‡Œçš„æ•°æ®å†å•ç‹¬è¿›è¡Œæ’åºã€‚æ¡¶å†…æ’å®Œåºä¹‹åï¼Œå†æŠŠæ¯ä¸ªæ¡¶é‡Œçš„æ•°æ®æŒ‰ç…§é¡ºåºä¾æ¬¡å–å‡ºï¼Œç»„æˆçš„åºåˆ—å°±æ˜¯æœ‰åºçš„äº†ã€‚\n\n![Untitled](Extras/Images/alg_60.png)\n\nå¦‚æœè¦æ’åºçš„æ•°æ®æœ‰ n ä¸ªï¼Œæˆ‘ä»¬æŠŠå®ƒä»¬å‡åŒ€åœ°åˆ’åˆ†åˆ° m ä¸ªæ¡¶å†…ï¼Œæ¯ä¸ªæ¡¶é‡Œå°±æœ‰ k=n/m ä¸ªå…ƒç´ ã€‚æ¯ä¸ªæ¡¶å†…éƒ¨ä½¿ç”¨å¿«é€Ÿæ’åºï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(k * logk)ã€‚m ä¸ªæ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(m * k * logk)ï¼Œå› ä¸º k=n/mï¼Œæ‰€ä»¥æ•´ä¸ªæ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(n*log(n/m))ã€‚å½“æ¡¶çš„ä¸ªæ•° m æ¥è¿‘æ•°æ®ä¸ªæ•° n æ—¶ï¼Œlog(n/m) å°±æ˜¯ä¸€ä¸ªéå¸¸å°çš„å¸¸é‡ï¼Œè¿™ä¸ªæ—¶å€™æ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦æ¥è¿‘ O(n)ã€‚\n\n**æ¡¶æ’åºçœ‹èµ·æ¥å¾ˆä¼˜ç§€ï¼Œé‚£å®ƒæ˜¯ä¸æ˜¯å¯ä»¥æ›¿ä»£æˆ‘ä»¬ä¹‹å‰è®²çš„æ’åºç®—æ³•å‘¢ï¼Ÿ**\n\nç­”æ¡ˆå½“ç„¶æ˜¯å¦å®šçš„ã€‚å®é™…ä¸Šï¼Œæ¡¶æ’åºå¯¹è¦æ’åºæ•°æ®çš„è¦æ±‚æ˜¯éå¸¸è‹›åˆ»çš„ã€‚\n\né¦–å…ˆï¼Œè¦æ’åºçš„æ•°æ®éœ€è¦å¾ˆå®¹æ˜“å°±èƒ½åˆ’åˆ†æˆ m ä¸ªæ¡¶ï¼Œå¹¶ä¸”ï¼Œæ¡¶ä¸æ¡¶ä¹‹é—´æœ‰ç€å¤©ç„¶çš„å¤§å°é¡ºåºã€‚è¿™æ ·æ¯ä¸ªæ¡¶å†…çš„æ•°æ®éƒ½æ’åºå®Œä¹‹åï¼Œæ¡¶ä¸æ¡¶ä¹‹é—´çš„æ•°æ®ä¸éœ€è¦å†è¿›è¡Œæ’åºã€‚\n\nå…¶æ¬¡ï¼Œæ•°æ®åœ¨å„ä¸ªæ¡¶ä¹‹é—´çš„åˆ†å¸ƒæ˜¯æ¯”è¾ƒå‡åŒ€çš„ã€‚å¦‚æœæ•°æ®ç»è¿‡æ¡¶çš„åˆ’åˆ†ä¹‹åï¼Œæœ‰äº›æ¡¶é‡Œçš„æ•°æ®éå¸¸å¤šï¼Œæœ‰äº›éå¸¸å°‘ï¼Œå¾ˆä¸å¹³å‡ï¼Œé‚£æ¡¶å†…æ•°æ®æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±ä¸æ˜¯å¸¸é‡çº§äº†ã€‚åœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¦‚æœæ•°æ®éƒ½è¢«åˆ’åˆ†åˆ°ä¸€ä¸ªæ¡¶é‡Œï¼Œé‚£å°±é€€åŒ–ä¸º O(nlogn) çš„æ’åºç®—æ³•äº†ã€‚\n\n**æ¡¶æ’åºæ¯”è¾ƒé€‚åˆç”¨åœ¨å¤–éƒ¨æ’åºä¸­ã€‚**æ‰€è°“çš„å¤–éƒ¨æ’åºå°±æ˜¯æ•°æ®å­˜å‚¨åœ¨å¤–éƒ¨ç£ç›˜ä¸­ï¼Œæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œå†…å­˜æœ‰é™ï¼Œæ— æ³•å°†æ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚\n\n### è®¡æ•°æ’åºï¼ˆCounting sortï¼‰\n\n**è®¡æ•°æ’åºå…¶å®æ˜¯æ¡¶æ’åºçš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚**å½“è¦æ’åºçš„ n ä¸ªæ•°æ®ï¼Œæ‰€å¤„çš„èŒƒå›´å¹¶ä¸å¤§çš„æ—¶å€™ï¼Œæ¯”å¦‚æœ€å¤§å€¼æ˜¯ kï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠæ•°æ®åˆ’åˆ†æˆ k ä¸ªæ¡¶ã€‚æ¯ä¸ªæ¡¶å†…çš„æ•°æ®å€¼éƒ½æ˜¯ç›¸åŒçš„ï¼Œçœæ‰äº†æ¡¶å†…æ’åºçš„æ—¶é—´ã€‚å› ä¸ºåªæ¶‰åŠæ‰«æéå†æ“ä½œï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚\n\n**è®¡æ•°æ’åºåªèƒ½ç”¨åœ¨æ•°æ®èŒƒå›´ä¸å¤§çš„åœºæ™¯ä¸­ï¼Œå¦‚æœæ•°æ®èŒƒå›´ k æ¯”è¦æ’åºçš„æ•°æ® n å¤§å¾ˆå¤šï¼Œå°±ä¸é€‚åˆç”¨è®¡æ•°æ’åºäº†ã€‚è€Œä¸”ï¼Œè®¡æ•°æ’åºåªèƒ½ç»™éè´Ÿæ•´æ•°æ’åºï¼Œå¦‚æœè¦æ’åºçš„æ•°æ®æ˜¯å…¶ä»–ç±»å‹çš„ï¼Œè¦å°†å…¶åœ¨ä¸æ”¹å˜ç›¸å¯¹å¤§å°çš„æƒ…å†µä¸‹ï¼Œè½¬åŒ–ä¸ºéè´Ÿæ•´æ•°ã€‚**\n\n### åŸºæ•°æ’åºï¼ˆRadix sortï¼‰\n\nå‡è®¾æˆ‘ä»¬æœ‰ 10 ä¸‡ä¸ªæ‰‹æœºå·ç ï¼Œå¸Œæœ›å°†è¿™ 10 ä¸‡ä¸ªæ‰‹æœºå·ç ä»å°åˆ°å¤§æ’åºï¼Œä½ æœ‰ä»€ä¹ˆæ¯”è¾ƒå¿«é€Ÿçš„æ’åºæ–¹æ³•å‘¢ï¼Ÿ\n\nåˆšåˆšè¿™ä¸ªé—®é¢˜é‡Œæœ‰è¿™æ ·çš„è§„å¾‹ï¼šå‡è®¾è¦æ¯”è¾ƒä¸¤ä¸ªæ‰‹æœºå·ç  aï¼Œb çš„å¤§å°ï¼Œå¦‚æœåœ¨å‰é¢å‡ ä½ä¸­ï¼Œa æ‰‹æœºå·ç å·²ç»æ¯” b æ‰‹æœºå·ç å¤§äº†ï¼Œé‚£åé¢çš„å‡ ä½å°±ä¸ç”¨çœ‹äº†ã€‚\n\nå€ŸåŠ©ç¨³å®šæ’åºç®—æ³•ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå·§å¦™çš„å®ç°æ€è·¯ã€‚å…ˆæŒ‰ç…§æœ€åä¸€ä½æ¥æ’åºæ‰‹æœºå·ç ï¼Œç„¶åï¼Œå†æŒ‰ç…§å€’æ•°ç¬¬äºŒä½é‡æ–°æ’åºï¼Œä»¥æ­¤ç±»æ¨ï¼Œæœ€åæŒ‰ç…§ç¬¬ä¸€ä½é‡æ–°æ’åºã€‚ç»è¿‡ 11 æ¬¡æ’åºä¹‹åï¼Œæ‰‹æœºå·ç å°±éƒ½æœ‰åºäº†ã€‚\n\næ‰‹æœºå·ç ç¨å¾®æœ‰ç‚¹é•¿ï¼Œç”»å›¾æ¯”è¾ƒä¸å®¹æ˜“çœ‹æ¸…æ¥šï¼Œæˆ‘ç”¨å­—ç¬¦ä¸²æ’åºçš„ä¾‹å­ï¼Œç”»äº†ä¸€å¼ åŸºæ•°æ’åºçš„è¿‡ç¨‹åˆ†è§£å›¾ã€‚\n\n![Untitled](Extras/Images/alg_61.png)\n\næ ¹æ®æ¯ä¸€ä½æ¥æ’åºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åˆšè®²è¿‡çš„æ¡¶æ’åºæˆ–è€…è®¡æ•°æ’åºï¼Œå®ƒä»¬çš„æ—¶é—´å¤æ‚åº¦å¯ä»¥åšåˆ° O(n)ã€‚å¦‚æœè¦æ’åºçš„æ•°æ®æœ‰ k ä½ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦ k æ¬¡æ¡¶æ’åºæˆ–è€…è®¡æ•°æ’åºï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(k*n)ã€‚å½“ k ä¸å¤§çš„æ—¶å€™ï¼Œæ¯”å¦‚æ‰‹æœºå·ç æ’åºçš„ä¾‹å­ï¼Œk æœ€å¤§å°±æ˜¯ 11ï¼Œæ‰€ä»¥åŸºæ•°æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±è¿‘ä¼¼äº O(n)ã€‚\n\næœ‰æ—¶å€™è¦æ’åºçš„æ•°æ®å¹¶ä¸éƒ½æ˜¯ç­‰é•¿çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰çš„å•è¯è¡¥é½åˆ°ç›¸åŒé•¿åº¦ï¼Œä½æ•°ä¸å¤Ÿçš„å¯ä»¥åœ¨åé¢è¡¥â€œ0â€ï¼Œå› ä¸ºæ ¹æ®ASCII å€¼ï¼Œæ‰€æœ‰å­—æ¯éƒ½å¤§äºâ€œ0â€ï¼Œæ‰€ä»¥è¡¥â€œ0â€ä¸ä¼šå½±å“åˆ°åŸæœ‰çš„å¤§å°é¡ºåºã€‚è¿™æ ·å°±å¯ä»¥ç»§ç»­ç”¨åŸºæ•°æ’åºäº†ã€‚\n\næ€»ç»“ä¸€ä¸‹ï¼Œ**åŸºæ•°æ’åºå¯¹è¦æ’åºçš„æ•°æ®æ˜¯æœ‰è¦æ±‚çš„ï¼Œéœ€è¦å¯ä»¥åˆ†å‰²å‡ºç‹¬ç«‹çš„â€œä½â€æ¥æ¯”è¾ƒï¼Œè€Œä¸”ä½ä¹‹é—´æœ‰é€’è¿›çš„å…³ç³»ï¼Œå¦‚æœ a æ•°æ®çš„é«˜ä½æ¯” b æ•°æ®å¤§ï¼Œé‚£å‰©ä¸‹çš„ä½ä½å°±ä¸ç”¨æ¯”è¾ƒäº†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ¯ä¸€ä½çš„æ•°æ®èŒƒå›´ä¸èƒ½å¤ªå¤§ï¼Œè¦å¯ä»¥ç”¨çº¿æ€§æ’åºç®—æ³•æ¥æ’åºï¼Œå¦åˆ™ï¼ŒåŸºæ•°æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±æ— æ³•åšåˆ° O(n) äº†ã€‚**\n\n## **æ’åºä¼˜åŒ–**\n\n### **å¦‚ä½•é€‰æ‹©åˆé€‚çš„æ’åºç®—æ³•ï¼Ÿ**\n\n![Untitled](Extras/Images/alg_62.png)\n\nçº¿æ€§æ’åºç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ¯”è¾ƒä½ï¼Œé€‚ç”¨åœºæ™¯æ¯”è¾ƒç‰¹æ®Šã€‚æ‰€ä»¥å¦‚æœè¦å†™ä¸€ä¸ªé€šç”¨çš„æ’åºå‡½æ•°ï¼Œä¸èƒ½é€‰æ‹©çº¿æ€§æ’åºç®—æ³•ã€‚\n\nå¦‚æœå¯¹å°è§„æ¨¡æ•°æ®è¿›è¡Œæ’åºï¼Œå¯ä»¥é€‰æ‹©æ—¶é—´å¤æ‚åº¦æ˜¯ O(n2) çš„ç®—æ³•ï¼›å¦‚æœå¯¹å¤§è§„æ¨¡æ•°æ®è¿›è¡Œæ’åºï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogn) çš„ç®—æ³•æ›´åŠ é«˜æ•ˆã€‚æ‰€ä»¥ï¼Œä¸ºäº†å…¼é¡¾ä»»æ„è§„æ¨¡æ•°æ®çš„æ’åºï¼Œä¸€èˆ¬éƒ½ä¼šé¦–é€‰æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogn) çš„æ’åºç®—æ³•æ¥å®ç°æ’åºå‡½æ•°ã€‚\n\næ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogn) çš„æ’åºç®—æ³•ä¸æ­¢ä¸€ä¸ªï¼Œæˆ‘ä»¬å·²ç»è®²è¿‡çš„æœ‰å½’å¹¶æ’åºã€å¿«é€Ÿæ’åºï¼Œåé¢è®²å †çš„æ—¶å€™æˆ‘ä»¬è¿˜ä¼šè®²åˆ°å †æ’åºã€‚å †æ’åºå’Œå¿«é€Ÿæ’åºéƒ½æœ‰æ¯”è¾ƒå¤šçš„åº”ç”¨ï¼Œæ¯”å¦‚ Java è¯­è¨€é‡‡ç”¨å †æ’åºå®ç°æ’åºå‡½æ•°ï¼ŒC è¯­è¨€ä½¿ç”¨å¿«é€Ÿæ’åºå®ç°æ’åºå‡½æ•°ã€‚\n\n### **å¦‚ä½•ä¼˜åŒ–å¿«é€Ÿæ’åºï¼Ÿ**\n\nå¦‚æœæ•°æ®åŸæ¥å°±æ˜¯æœ‰åºçš„æˆ–è€…æ¥è¿‘æœ‰åºçš„ï¼Œæ¯æ¬¡åˆ†åŒºç‚¹éƒ½é€‰æ‹©æœ€åä¸€ä¸ªæ•°æ®ï¼Œé‚£å¿«é€Ÿæ’åºç®—æ³•å°±ä¼šå˜å¾—éå¸¸ç³Ÿç³•ï¼Œæ—¶é—´å¤æ‚åº¦å°±ä¼šé€€åŒ–ä¸º O(n2)ã€‚å®é™…ä¸Šï¼Œ**è¿™ç§ O(n2) æ—¶é—´å¤æ‚åº¦å‡ºç°çš„ä¸»è¦åŸå› è¿˜æ˜¯å› ä¸ºæˆ‘ä»¬åˆ†åŒºç‚¹é€‰å¾—ä¸å¤Ÿåˆç†ã€‚**\n\næœ€ç†æƒ³çš„åˆ†åŒºç‚¹æ˜¯ï¼š**è¢«åˆ†åŒºç‚¹åˆ†å¼€çš„ä¸¤ä¸ªåˆ†åŒºä¸­ï¼Œæ•°æ®çš„æ•°é‡å·®ä¸å¤šã€‚**\n\nè¿™é‡Œä»‹ç»ä¸¤ä¸ªæ¯”è¾ƒå¸¸ç”¨ã€æ¯”è¾ƒç®€å•çš„åˆ†åŒºç®—æ³•ã€‚\n\n1. **ä¸‰æ•°å–ä¸­æ³•**\n\n    æˆ‘ä»¬ä»åŒºé—´çš„é¦–ã€å°¾ã€ä¸­é—´ï¼Œåˆ†åˆ«å–å‡ºä¸€ä¸ªæ•°ï¼Œç„¶åå¯¹æ¯”å¤§å°ï¼Œå–è¿™ 3 ä¸ªæ•°çš„ä¸­é—´å€¼ä½œä¸ºåˆ†åŒºç‚¹ã€‚è¿™æ ·æ¯é—´éš”æŸä¸ªå›ºå®šçš„é•¿åº¦ï¼Œå–æ•°æ®å‡ºæ¥æ¯”è¾ƒï¼Œå°†ä¸­é—´å€¼ä½œä¸ºåˆ†åŒºç‚¹çš„åˆ†åŒºç®—æ³•ï¼Œè‚¯å®šè¦æ¯”å•çº¯å–æŸä¸€ä¸ªæ•°æ®æ›´å¥½ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦æ’åºçš„æ•°ç»„æ¯”è¾ƒå¤§ï¼Œé‚£â€œä¸‰æ•°å–ä¸­â€å¯èƒ½å°±ä¸å¤Ÿäº†ï¼Œå¯èƒ½è¦â€œäº”æ•°å–ä¸­â€æˆ–è€…â€œåæ•°å–ä¸­â€ã€‚\n\n2. **éšæœºæ³•**\n\n    éšæœºæ³•å°±æ˜¯æ¯æ¬¡ä»è¦æ’åºçš„åŒºé—´ä¸­ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªå…ƒç´ ä½œä¸ºåˆ†åŒºç‚¹ã€‚è¿™ç§æ–¹æ³•å¹¶ä¸èƒ½ä¿è¯æ¯æ¬¡åˆ†åŒºç‚¹éƒ½é€‰çš„æ¯”è¾ƒå¥½ï¼Œä½†æ˜¯ä»æ¦‚ç‡çš„è§’åº¦æ¥çœ‹ï¼Œä¹Ÿä¸å¤§å¯èƒ½ä¼šå‡ºç°æ¯æ¬¡åˆ†åŒºç‚¹éƒ½é€‰å¾—å¾ˆå·®çš„æƒ…å†µï¼Œæ‰€ä»¥å¹³å‡æƒ…å†µä¸‹ï¼Œè¿™æ ·é€‰çš„åˆ†åŒºç‚¹æ˜¯æ¯”è¾ƒå¥½çš„ã€‚æ—¶é—´å¤æ‚åº¦é€€åŒ–ä¸ºæœ€ç³Ÿç³•çš„ O(n2) çš„æƒ…å†µï¼Œå‡ºç°çš„å¯èƒ½æ€§ä¸å¤§ã€‚\n\n\næˆ‘ä»¬çŸ¥é“ï¼Œå¿«é€Ÿæ’åºæ˜¯ç”¨é€’å½’æ¥å®ç°çš„ã€‚æˆ‘ä»¬åœ¨é€’å½’é‚£ä¸€èŠ‚è®²è¿‡ï¼Œé€’å½’è¦è­¦æƒ•å †æ ˆæº¢å‡ºã€‚ä¸ºäº†é¿å…å¿«é€Ÿæ’åºé‡Œï¼Œé€’å½’è¿‡æ·±è€Œå †æ ˆè¿‡å°ï¼Œå¯¼è‡´å †æ ˆæº¢å‡ºï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼šç¬¬ä¸€ç§æ˜¯é™åˆ¶é€’å½’æ·±åº¦ã€‚ä¸€æ—¦é€’å½’è¿‡æ·±ï¼Œè¶…è¿‡äº†æˆ‘ä»¬äº‹å…ˆè®¾å®šçš„é˜ˆå€¼ï¼Œå°±åœæ­¢é€’å½’ã€‚ç¬¬äºŒç§æ˜¯é€šè¿‡åœ¨å †ä¸Šæ¨¡æ‹Ÿå®ç°ä¸€ä¸ªå‡½æ•°è°ƒç”¨æ ˆï¼Œæ‰‹åŠ¨æ¨¡æ‹Ÿé€’å½’å‹æ ˆã€å‡ºæ ˆçš„è¿‡ç¨‹ï¼Œè¿™æ ·å°±æ²¡æœ‰äº†ç³»ç»Ÿæ ˆå¤§å°çš„é™åˆ¶ã€‚\n\n## **äºŒåˆ†æŸ¥æ‰¾**\n\näºŒåˆ†æŸ¥æ‰¾é’ˆå¯¹çš„æ˜¯ä¸€ä¸ªæœ‰åºçš„æ•°æ®é›†åˆï¼ŒæŸ¥æ‰¾æ€æƒ³æœ‰ç‚¹ç±»ä¼¼åˆ†æ²»æ€æƒ³ã€‚æ¯æ¬¡éƒ½é€šè¿‡è·ŸåŒºé—´çš„ä¸­é—´å…ƒç´ å¯¹æ¯”ï¼Œå°†å¾…æŸ¥æ‰¾çš„åŒºé—´ç¼©å°ä¸ºä¹‹å‰çš„ä¸€åŠï¼Œç›´åˆ°æ‰¾åˆ°è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œæˆ–è€…åŒºé—´è¢«ç¼©å°ä¸º 0ã€‚\n\n### **O(logn) æƒŠäººçš„æŸ¥æ‰¾é€Ÿåº¦**\n\næˆ‘ä»¬å‡è®¾æ•°æ®å¤§å°æ˜¯ nï¼Œæ¯æ¬¡æŸ¥æ‰¾åæ•°æ®éƒ½ä¼šç¼©å°ä¸ºåŸæ¥çš„ä¸€åŠï¼Œä¹Ÿå°±æ˜¯ä¼šé™¤ä»¥ 2ã€‚æœ€åæƒ…å†µä¸‹ï¼Œç›´åˆ°æŸ¥æ‰¾åŒºé—´è¢«ç¼©å°ä¸ºç©ºï¼Œæ‰åœæ­¢ã€‚\n\n![Untitled](Extras/Images/alg_63.png)\n\nå¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªç­‰æ¯”æ•°åˆ—ã€‚å…¶ä¸­ n/2k=1 æ—¶ï¼Œk çš„å€¼å°±æ˜¯æ€»å…±ç¼©å°çš„æ¬¡æ•°ã€‚è€Œæ¯ä¸€æ¬¡ç¼©å°æ“ä½œåªæ¶‰åŠä¸¤ä¸ªæ•°æ®çš„å¤§å°æ¯”è¾ƒï¼Œæ‰€ä»¥ï¼Œç»è¿‡äº† k æ¬¡åŒºé—´ç¼©å°æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(k)ã€‚é€šè¿‡ n/2k=1ï¼Œæˆ‘ä»¬å¯ä»¥æ±‚å¾— k=log2nï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(logn)ã€‚\n\n### **äºŒåˆ†æŸ¥æ‰¾çš„é€’å½’ä¸éé€’å½’å®ç°**\n\næœ€ç®€å•çš„æƒ…å†µå°±æ˜¯æœ‰åºæ•°ç»„ä¸­ä¸å­˜åœ¨é‡å¤å…ƒç´ ã€‚\n\n```java\npublic int bsearch(int[] a, int n, int value) {\n  int low = 0;\n  int high = n - 1;\n\n  while (low \u003c= high) {\n    int mid = (low + high) / 2;\n    if (a[mid] == value) {\n      return mid;\n    } else if (a[mid] \u003c value) {\n      low = mid + 1;\n    } else {\n      high = mid - 1;\n    }\n  }\n\n  return -1;\n}\n```\n\nç€é‡å¼ºè°ƒä¸€ä¸‹å®¹æ˜“å‡ºé”™çš„ 3 ä¸ªåœ°æ–¹ã€‚\n\n1. **å¾ªç¯é€€å‡ºæ¡ä»¶**\n\n    æ³¨æ„æ˜¯ low\u003c=highï¼Œè€Œä¸æ˜¯ low\u003chighã€‚\n\n2. **mid çš„å–å€¼**\n\n    å®é™…ä¸Šï¼Œmid=(low+high)/2 è¿™ç§å†™æ³•æ˜¯æœ‰é—®é¢˜çš„ã€‚å› ä¸ºå¦‚æœ low å’Œ high æ¯”è¾ƒå¤§çš„è¯ï¼Œä¸¤è€…ä¹‹å’Œå°±æœ‰å¯èƒ½ä¼šæº¢å‡ºã€‚æ”¹è¿›çš„æ–¹æ³•æ˜¯å°† mid çš„è®¡ç®—æ–¹å¼å†™æˆ low+(high-low)/2ã€‚æ›´è¿›ä¸€æ­¥ï¼Œå¦‚æœè¦å°†æ€§èƒ½ä¼˜åŒ–åˆ°æè‡´çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™é‡Œçš„é™¤ä»¥ 2 æ“ä½œè½¬åŒ–æˆä½è¿ç®— low+((high-low)\u003e\u003e1)ã€‚å› ä¸ºç›¸æ¯”é™¤æ³•è¿ç®—æ¥è¯´ï¼Œè®¡ç®—æœºå¤„ç†ä½è¿ç®—è¦å¿«å¾—å¤šã€‚\n\n3. **low å’Œ high çš„æ›´æ–°**\n\n    low=mid+1ï¼Œhigh=mid-1ã€‚æ³¨æ„è¿™é‡Œçš„ +1 å’Œ -1ï¼Œå¦‚æœç›´æ¥å†™æˆ low=mid æˆ–è€… high=midï¼Œå°±å¯èƒ½ä¼šå‘ç”Ÿæ­»å¾ªç¯ã€‚æ¯”å¦‚ï¼Œå½“ high=3ï¼Œlow=3 æ—¶ï¼Œå¦‚æœ a[3]ä¸ç­‰äº valueï¼Œå°±ä¼šå¯¼è‡´ä¸€ç›´å¾ªç¯ä¸é€€å‡ºã€‚\n\n\n---\n\nå®é™…ä¸Šï¼ŒäºŒåˆ†æŸ¥æ‰¾é™¤äº†ç”¨å¾ªç¯æ¥å®ç°ï¼Œè¿˜å¯ä»¥ç”¨é€’å½’æ¥å®ç°ï¼Œè¿‡ç¨‹ä¹Ÿéå¸¸ç®€å•ã€‚\n\n```java\n// äºŒåˆ†æŸ¥æ‰¾çš„é€’å½’å®ç°\npublic int bsearch(int[] a, int n, int val) {\n  return bsearchInternally(a, 0, n - 1, val);\n}\n\nprivate int bsearchInternally(int[] a, int low, int high, int value) {\n  if (low \u003e high) return -1;\n\n  int mid =  low + ((high - low) \u003e\u003e 1);\n  if (a[mid] == value) {\n    return mid;\n  } else if (a[mid] \u003c value) {\n    return bsearchInternally(a, mid+1, high, value);\n  } else {\n    return bsearchInternally(a, low, mid-1, value);\n  }\n}\n```\n\n### **äºŒåˆ†æŸ¥æ‰¾åº”ç”¨åœºæ™¯çš„å±€é™æ€§**\n\n- é¦–å…ˆï¼ŒäºŒåˆ†æŸ¥æ‰¾ä¾èµ–çš„æ˜¯é¡ºåºè¡¨ç»“æ„ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯æ•°ç»„ï¼Œå¹¶ä¸èƒ½ä¾èµ–é“¾è¡¨ï¼Œå› ä¸ºå…¶ä¸æ”¯æŒéšæœºè®¿é—®ã€‚\n- å…¶æ¬¡ï¼ŒäºŒåˆ†æŸ¥æ‰¾é’ˆå¯¹çš„æ˜¯æœ‰åºæ•°æ®ã€‚\n\n    äºŒåˆ†æŸ¥æ‰¾åªèƒ½ç”¨åœ¨æ’å…¥ã€åˆ é™¤æ“ä½œä¸é¢‘ç¹ï¼Œä¸€æ¬¡æ’åºå¤šæ¬¡æŸ¥æ‰¾çš„åœºæ™¯ä¸­ã€‚é’ˆå¯¹åŠ¨æ€å˜åŒ–çš„æ•°æ®é›†åˆï¼ŒäºŒåˆ†æŸ¥æ‰¾å°†ä¸å†é€‚ç”¨ã€‚å¯¹äºåŠ¨æ€å˜åŒ–çš„æ•°æ®é›†åˆï¼Œæ›´é€‚åˆä½¿ç”¨æ•£åˆ—è¡¨æˆ–äºŒå‰æŸ¥æ‰¾æ ‘ã€‚\n\n- å†æ¬¡ï¼Œæ•°æ®é‡å¤ªå°ä¸é€‚åˆäºŒåˆ†æŸ¥æ‰¾ã€‚\n\n    å¦‚æœè¦å¤„ç†çš„æ•°æ®é‡å¾ˆå°ï¼Œå®Œå…¨æ²¡æœ‰å¿…è¦ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œé¡ºåºéå†å°±è¶³å¤Ÿäº†ã€‚ä¸è¿‡ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å¤–ã€‚å¦‚æœæ•°æ®ä¹‹é—´çš„æ¯”è¾ƒæ“ä½œéå¸¸è€—æ—¶ï¼Œä¸ç®¡æ•°æ®é‡å¤§å°ï¼Œæˆ‘éƒ½æ¨èä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ã€‚æˆ‘ä»¬éœ€è¦å°½å¯èƒ½åœ°å‡å°‘æ¯”è¾ƒæ¬¡æ•°ï¼Œè€Œæ¯”è¾ƒæ¬¡æ•°çš„å‡å°‘ä¼šå¤§å¤§æé«˜æ€§èƒ½ï¼Œè¿™ä¸ªæ—¶å€™äºŒåˆ†æŸ¥æ‰¾å°±æ¯”é¡ºåºéå†æ›´æœ‰ä¼˜åŠ¿ã€‚\n\n- æœ€åï¼Œæ•°æ®é‡å¤ªå¤§ä¹Ÿä¸é€‚åˆäºŒåˆ†æŸ¥æ‰¾ã€‚\n\n    äºŒåˆ†æŸ¥æ‰¾çš„åº•å±‚éœ€è¦ä¾èµ–æ•°ç»„è¿™ç§æ•°æ®ç»“æ„ï¼Œè€Œæ•°ç»„ä¸ºäº†æ”¯æŒéšæœºè®¿é—®çš„ç‰¹æ€§ï¼Œè¦æ±‚å†…å­˜ç©ºé—´è¿ç»­ï¼Œå¯¹å†…å­˜çš„è¦æ±‚æ¯”è¾ƒè‹›åˆ»ã€‚æ³¨æ„è¿™é‡Œçš„â€œè¿ç»­â€äºŒå­—ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä¾¿æœ‰ 2GB çš„å†…å­˜ç©ºé—´å‰©ä½™ï¼Œä½†æ˜¯å¦‚æœè¿™å‰©ä½™çš„ 2GB å†…å­˜ç©ºé—´éƒ½æ˜¯é›¶æ•£çš„ï¼Œæ²¡æœ‰è¿ç»­çš„ 1GB å¤§å°çš„å†…å­˜ç©ºé—´ï¼Œé‚£ç…§æ ·æ— æ³•ç”³è¯·ä¸€ä¸ª 1GB å¤§å°çš„æ•°ç»„ã€‚è€Œæˆ‘ä»¬çš„äºŒåˆ†æŸ¥æ‰¾æ˜¯ä½œç”¨åœ¨æ•°ç»„è¿™ç§æ•°æ®ç»“æ„ä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥å¤ªå¤§çš„æ•°æ®ç”¨æ•°ç»„å­˜å‚¨å°±æ¯”è¾ƒåƒåŠ›äº†ï¼Œä¹Ÿå°±ä¸èƒ½ç”¨äºŒåˆ†æŸ¥æ‰¾äº†ã€‚\n\n\n### **äºŒåˆ†æŸ¥æ‰¾çš„å˜å½¢é—®é¢˜**\n\n![Untitled](Extras/Images/alg_64.png)\n\n- **å˜ä½“ä¸€ï¼šæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ **\n\n    ```java\n    public int bsearch(int[] a, int n, int value) {\n      int low = 0;\n      int high = n - 1;\n      while (low \u003c= high) {\n        int mid =  low + ((high - low) \u003e\u003e 1);\n        if (a[mid] \u003e value) {\n          high = mid - 1;\n        } else if (a[mid] \u003c value) {\n          low = mid + 1;\n        } else {\n          if ((mid == 0) || (a[mid - 1] != value)) return mid;\n          else high = mid - 1;\n        }\n      }\n      return -1;\n    }\n    ```\n\n    a[mid]è·Ÿè¦æŸ¥æ‰¾çš„ value çš„å¤§å°å…³ç³»æœ‰ä¸‰ç§æƒ…å†µï¼šå¤§äºã€å°äºã€ç­‰äºã€‚å¯¹äº a[mid]\u003evalue çš„æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–° high= mid-1ï¼›å¯¹äº a[mid]=value çš„æ—¶å€™åº”è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ\n\n    å¦‚æœæˆ‘ä»¬æŸ¥æ‰¾çš„æ˜¯ä»»æ„ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ï¼Œå½“ a[mid]ç­‰äºè¦æŸ¥æ‰¾çš„å€¼æ—¶ï¼Œa[mid]å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å…ƒç´ ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ±‚è§£çš„æ˜¯ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ï¼Œå½“ a[mid]ç­‰äºè¦æŸ¥æ‰¾çš„å€¼æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦ç¡®è®¤ä¸€ä¸‹è¿™ä¸ª a[mid]æ˜¯ä¸æ˜¯ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚\n\n    æˆ‘ä»¬é‡ç‚¹çœ‹ç¬¬ 11 è¡Œä»£ç ã€‚å¦‚æœ mid ç­‰äº 0ï¼Œé‚£è¿™ä¸ªå…ƒç´ å·²ç»æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œé‚£å®ƒè‚¯å®šæ˜¯æˆ‘ä»¬è¦æ‰¾çš„ï¼›å¦‚æœ mid ä¸ç­‰äº 0ï¼Œä½† a[mid]çš„å‰ä¸€ä¸ªå…ƒç´  a[mid-1]ä¸ç­‰äº valueï¼Œé‚£ä¹Ÿè¯´æ˜ a[mid]å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚\n\n    å¦‚æœç»è¿‡æ£€æŸ¥ä¹‹åå‘ç° a[mid]å‰é¢çš„ä¸€ä¸ªå…ƒç´  a[mid-1]ä¹Ÿç­‰äº valueï¼Œé‚£è¯´æ˜æ­¤æ—¶çš„ a[mid]è‚¯å®šä¸æ˜¯æˆ‘ä»¬è¦æŸ¥æ‰¾çš„ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚é‚£æˆ‘ä»¬å°±æ›´æ–° high=mid-1ï¼Œå› ä¸ºè¦æ‰¾çš„å…ƒç´ è‚¯å®šå‡ºç°åœ¨[low, mid-1]ä¹‹é—´ã€‚\n\n- **å˜ä½“äºŒï¼šæŸ¥æ‰¾æœ€åä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ **\n\n    ```java\n    public int bsearch(int[] a, int n, int value) {\n      int low = 0;\n      int high = n - 1;\n      while (low \u003c= high) {\n        int mid =  low + ((high - low) \u003e\u003e 1);\n        if (a[mid] \u003e value) {\n          high = mid - 1;\n        } else if (a[mid] \u003c value) {\n          low = mid + 1;\n        } else {\n          if ((mid == n - 1) || (a[mid + 1] != value)) return mid;\n          else low = mid + 1;\n        }\n      }\n      return -1;\n    }\n    ```\n\n    æˆ‘ä»¬è¿˜æ˜¯é‡ç‚¹çœ‹ç¬¬ 11 è¡Œä»£ç ã€‚å¦‚æœ a[mid]è¿™ä¸ªå…ƒç´ å·²ç»æ˜¯æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ äº†ï¼Œé‚£å®ƒè‚¯å®šæ˜¯æˆ‘ä»¬è¦æ‰¾çš„ï¼›å¦‚æœ a[mid]çš„åä¸€ä¸ªå…ƒç´  a[mid+1]ä¸ç­‰äº valueï¼Œé‚£ä¹Ÿè¯´æ˜ a[mid]å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æœ€åä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚\n\n    å¦‚æœæˆ‘ä»¬ç»è¿‡æ£€æŸ¥ä¹‹åï¼Œå‘ç° a[mid]åé¢çš„ä¸€ä¸ªå…ƒç´  a[mid+1]ä¹Ÿç­‰äº valueï¼Œé‚£è¯´æ˜å½“å‰çš„è¿™ä¸ª a[mid]å¹¶ä¸æ˜¯æœ€åä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚æˆ‘ä»¬å°±æ›´æ–° low=mid+1ï¼Œå› ä¸ºè¦æ‰¾çš„å…ƒç´ è‚¯å®šå‡ºç°åœ¨[mid+1, high]ä¹‹é—´ã€‚\n\n- **å˜ä½“ä¸‰ï¼šæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºç»™å®šå€¼çš„å…ƒç´ **\n\n    ```java\n    public int bsearch(int[] a, int n, int value) {\n      int low = 0;\n      int high = n - 1;\n      while (low \u003c= high) {\n        int mid =  low + ((high - low) \u003e\u003e 1);\n        if (a[mid] \u003e= value) {\n          if ((mid == 0) || (a[mid - 1] \u003c value)) return mid;\n          else high = mid - 1;\n        } else {\n          low = mid + 1;\n        }\n      }\n      return -1;\n    }\n    ```\n\n    å¦‚æœ a[mid]å°äºè¦æŸ¥æ‰¾çš„å€¼ valueï¼Œé‚£è¦æŸ¥æ‰¾çš„å€¼è‚¯å®šåœ¨[mid+1, high]ä¹‹é—´ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬æ›´æ–° low=mid+1ã€‚\n\n    å¯¹äº a[mid]å¤§äºç­‰äºç»™å®šå€¼ value çš„æƒ…å†µï¼Œæˆ‘ä»¬è¦å…ˆçœ‹ä¸‹è¿™ä¸ª a[mid]æ˜¯ä¸æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç¬¬ä¸€ä¸ªå€¼å¤§äºç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚å¦‚æœ a[mid]å‰é¢å·²ç»æ²¡æœ‰å…ƒç´ ï¼Œæˆ–è€…å‰é¢ä¸€ä¸ªå…ƒç´ å°äºè¦æŸ¥æ‰¾çš„å€¼ valueï¼Œé‚£ a[mid]å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å…ƒç´ ã€‚è¿™æ®µé€»è¾‘å¯¹åº”çš„ä»£ç æ˜¯ç¬¬ 7 è¡Œã€‚\n\n    å¦‚æœ a[mid-1]ä¹Ÿå¤§äºç­‰äºè¦æŸ¥æ‰¾çš„å€¼ valueï¼Œé‚£è¯´æ˜è¦æŸ¥æ‰¾çš„å…ƒç´ åœ¨[low, mid-1]ä¹‹é—´ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°† high æ›´æ–°ä¸º mid-1ã€‚\n\n- **å˜ä½“å››ï¼šæŸ¥æ‰¾æœ€åä¸€ä¸ªå°äºç­‰äºç»™å®šå€¼çš„å…ƒç´ **\n\n    ```java\n    public int bsearch7(int[] a, int n, int value) {\n      int low = 0;\n      int high = n - 1;\n      while (low \u003c= high) {\n        int mid =  low + ((high - low) \u003e\u003e 1);\n        if (a[mid] \u003e value) {\n          high = mid - 1;\n        } else {\n          if ((mid == n - 1) || (a[mid + 1] \u003e value)) return mid;\n          else low = mid + 1;\n        }\n      }\n      return -1;\n    }\n    ```\n\n\nå˜ä½“çš„äºŒåˆ†æŸ¥æ‰¾ç®—æ³•å†™èµ·æ¥éå¸¸çƒ§è„‘ï¼Œå¾ˆå®¹æ˜“å› ä¸ºç»†èŠ‚å¤„ç†ä¸å¥½è€Œäº§ç”Ÿ Bugï¼Œè¿™äº›å®¹æ˜“å‡ºé”™çš„ç»†èŠ‚æœ‰ï¼š**ç»ˆæ­¢æ¡ä»¶ã€åŒºé—´ä¸Šä¸‹ç•Œæ›´æ–°æ–¹æ³•ã€è¿”å›å€¼é€‰æ‹©**ã€‚\n\n## **è·³è¡¨**\n\nRedis ä¸­çš„æœ‰åºé›†åˆï¼ˆSorted Setï¼‰å°±æ˜¯ç”¨è·³è¡¨æ¥å®ç°çš„ã€‚\n\n### **å¦‚ä½•ç†è§£â€œè·³è¡¨â€ï¼Ÿ**\n\nå¯¹äºä¸€ä¸ªå•é“¾è¡¨æ¥è®²ï¼Œå³ä¾¿é“¾è¡¨ä¸­å­˜å‚¨çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œå¦‚æœæˆ‘ä»¬è¦æƒ³åœ¨å…¶ä¸­æŸ¥æ‰¾æŸä¸ªæ•°æ®ï¼Œä¹Ÿåªèƒ½ä»å¤´åˆ°å°¾éå†é“¾è¡¨ã€‚è¿™æ ·æŸ¥æ‰¾æ•ˆç‡å°±ä¼šå¾ˆä½ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šå¾ˆé«˜ï¼Œæ˜¯ O(n)ã€‚\n\né‚£æ€ä¹ˆæ¥æé«˜æŸ¥æ‰¾æ•ˆç‡å‘¢ï¼Ÿå¦‚æœåƒå›¾ä¸­é‚£æ ·ï¼Œå¯¹é“¾è¡¨å»ºç«‹ä¸€çº§â€œç´¢å¼•â€ï¼ŒæŸ¥æ‰¾èµ·æ¥æ˜¯ä¸æ˜¯å°±ä¼šæ›´å¿«ä¸€äº›å‘¢ï¼Ÿæ¯ä¸¤ä¸ªç»“ç‚¹æå–ä¸€ä¸ªç»“ç‚¹åˆ°ä¸Šä¸€çº§ï¼Œæˆ‘ä»¬æŠŠæŠ½å‡ºæ¥çš„é‚£ä¸€çº§å«åšç´¢å¼•æˆ–ç´¢å¼•å±‚ã€‚åŠ æ¥ä¸€å±‚ç´¢å¼•ä¹‹åï¼ŒæŸ¥æ‰¾ä¸€ä¸ªç»“ç‚¹éœ€è¦éå†çš„ç»“ç‚¹ä¸ªæ•°å‡å°‘äº†ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥æ‰¾æ•ˆç‡æé«˜äº†ã€‚\n\n![Untitled](Extras/Images/alg_65.png)\n\nå‰é¢è®²çš„è¿™ç§é“¾è¡¨åŠ å¤šçº§ç´¢å¼•çš„ç»“æ„ï¼Œå°±æ˜¯è·³è¡¨ã€‚\n\n### **ç”¨è·³è¡¨æŸ¥è¯¢åˆ°åº•æœ‰å¤šå¿«ï¼Ÿ**\n\næŒ‰ç…§æˆ‘ä»¬åˆšæ‰è®²çš„ï¼Œæ¯ä¸¤ä¸ªç»“ç‚¹ä¼šæŠ½å‡ºä¸€ä¸ªç»“ç‚¹ä½œä¸ºä¸Šä¸€çº§ç´¢å¼•çš„ç»“ç‚¹ï¼Œé‚£ç¬¬ä¸€çº§ç´¢å¼•çš„ç»“ç‚¹ä¸ªæ•°å¤§çº¦å°±æ˜¯ n/2ï¼Œç¬¬äºŒçº§ç´¢å¼•çš„ç»“ç‚¹ä¸ªæ•°å¤§çº¦å°±æ˜¯ n/4ï¼Œç¬¬ä¸‰çº§ç´¢å¼•çš„ç»“ç‚¹ä¸ªæ•°å¤§çº¦å°±æ˜¯ n/8ï¼Œä¾æ¬¡ç±»æ¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ**ç¬¬ k çº§ç´¢å¼•çš„ç»“ç‚¹ä¸ªæ•°æ˜¯ç¬¬ k-1 çº§ç´¢å¼•çš„ç»“ç‚¹ä¸ªæ•°çš„ 1/2ï¼Œé‚£ç¬¬ kçº§ç´¢å¼•ç»“ç‚¹çš„ä¸ªæ•°å°±æ˜¯ n/(2k)ã€‚**\n\nå‡è®¾ç´¢å¼•æœ‰ h çº§ï¼Œæœ€é«˜çº§çš„ç´¢å¼•æœ‰ 2 ä¸ªç»“ç‚¹ã€‚é€šè¿‡ä¸Šé¢çš„å…¬å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° n/(2h)=2ï¼Œä»è€Œæ±‚å¾— h=log2n-1ã€‚å¦‚æœåŒ…å«åŸå§‹é“¾è¡¨è¿™ä¸€å±‚ï¼Œæ•´ä¸ªè·³è¡¨çš„é«˜åº¦å°±æ˜¯ log2nã€‚æˆ‘ä»¬åœ¨è·³è¡¨ä¸­æŸ¥è¯¢æŸä¸ªæ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœæ¯ä¸€å±‚éƒ½è¦éå† m ä¸ªç»“ç‚¹ï¼Œé‚£åœ¨è·³è¡¨ä¸­æŸ¥è¯¢ä¸€ä¸ªæ•°æ®çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(m*logn)ã€‚\n\né‚£è¿™ä¸ª m çš„å€¼æ˜¯å¤šå°‘å‘¢ï¼ŸæŒ‰ç…§å‰é¢è¿™ç§ç´¢å¼•ç»“æ„ï¼Œæˆ‘ä»¬æ¯ä¸€çº§ç´¢å¼•éƒ½æœ€å¤šåªéœ€è¦éå† 3 ä¸ªç»“ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ m=3ã€‚\n\nå‡è®¾æˆ‘ä»¬è¦æŸ¥æ‰¾çš„æ•°æ®æ˜¯ xï¼Œåœ¨ç¬¬ k çº§ç´¢å¼•ä¸­ï¼Œæˆ‘ä»¬éå†åˆ° y ç»“ç‚¹ä¹‹åï¼Œå‘ç° x å¤§äº yï¼Œå°äºåé¢çš„ç»“ç‚¹ zï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡ y çš„ down æŒ‡é’ˆï¼Œä»ç¬¬ k çº§ç´¢å¼•ä¸‹é™åˆ°ç¬¬ k-1 çº§ç´¢å¼•ã€‚åœ¨ç¬¬ k-1 çº§ç´¢å¼•ä¸­ï¼Œy å’Œ z ä¹‹é—´åªæœ‰ 3 ä¸ªç»“ç‚¹ï¼ˆåŒ…å« y å’Œ zï¼‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ K-1 çº§ç´¢å¼•ä¸­æœ€å¤šåªéœ€è¦éå† 3 ä¸ªç»“ç‚¹ï¼Œä¾æ¬¡ç±»æ¨ï¼Œæ¯ä¸€çº§ç´¢å¼•éƒ½æœ€å¤šåªéœ€è¦éå† 3 ä¸ªç»“ç‚¹ã€‚\n\n![Untitled](Extras/Images/alg_66.png)\n\næ‰€ä»¥åœ¨è·³è¡¨ä¸­æŸ¥è¯¢ä»»æ„æ•°æ®çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(logn)ã€‚è¿™ä¸ªæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦è·ŸäºŒåˆ†æŸ¥æ‰¾æ˜¯ä¸€æ ·çš„ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å…¶å®æ˜¯åŸºäºå•é“¾è¡¨å®ç°äº†äºŒåˆ†æŸ¥æ‰¾ï¼Œæ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ï¼Ÿä¸è¿‡ï¼Œå¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤ï¼Œè¿™ç§æŸ¥è¯¢æ•ˆç‡çš„æå‡ï¼Œå‰ææ˜¯å»ºç«‹äº†å¾ˆå¤šçº§ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰è®²è¿‡çš„ç©ºé—´æ¢æ—¶é—´çš„è®¾è®¡æ€è·¯ã€‚\n\n### **è·³è¡¨æ˜¯ä¸æ˜¯å¾ˆæµªè´¹å†…å­˜ï¼Ÿ**\n\nå‡è®¾åŸå§‹é“¾è¡¨å¤§å°ä¸º nï¼Œé‚£ç¬¬ä¸€çº§ç´¢å¼•å¤§çº¦æœ‰ n/2 ä¸ªç»“ç‚¹ï¼Œç¬¬äºŒçº§ç´¢å¼•å¤§çº¦æœ‰ n/4 ä¸ªç»“ç‚¹ï¼Œä»¥æ­¤ç±»æ¨ï¼Œæ¯ä¸Šå‡ä¸€çº§å°±å‡å°‘ä¸€åŠï¼Œç›´åˆ°å‰©ä¸‹ 2 ä¸ªç»“ç‚¹ã€‚å¦‚æœæˆ‘ä»¬æŠŠæ¯å±‚ç´¢å¼•çš„ç»“ç‚¹æ•°å†™å‡ºæ¥ï¼Œå°±æ˜¯ä¸€ä¸ªç­‰æ¯”æ•°åˆ—ã€‚\n\n![Untitled](Extras/Images/alg_67.png)\n\nè¿™å‡ çº§ç´¢å¼•çš„ç»“ç‚¹æ€»å’Œå°±æ˜¯ n/2+n/4+n/8â€¦+8+4+2=n-2ã€‚æ‰€ä»¥ï¼Œè·³è¡¨çš„ç©ºé—´å¤æ‚åº¦æ˜¯ O(n)ã€‚\n\nå®é™…ä¸Šï¼Œåœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸å¿…å¤ªåœ¨æ„ç´¢å¼•å ç”¨çš„é¢å¤–ç©ºé—´ã€‚åœ¨è®²æ•°æ®ç»“æ„å’Œç®—æ³•æ—¶ï¼Œæˆ‘ä»¬ä¹ æƒ¯æ€§åœ°æŠŠè¦å¤„ç†çš„æ•°æ®çœ‹æˆæ•´æ•°ï¼Œä½†æ˜¯åœ¨å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼ŒåŸå§‹é“¾è¡¨ä¸­å­˜å‚¨çš„æœ‰å¯èƒ½æ˜¯å¾ˆå¤§çš„å¯¹è±¡ï¼Œè€Œç´¢å¼•ç»“ç‚¹åªéœ€è¦å­˜å‚¨å…³é”®å€¼å’Œå‡ ä¸ªæŒ‡é’ˆï¼Œå¹¶ä¸éœ€è¦å­˜å‚¨å¯¹è±¡ï¼Œæ‰€ä»¥å½“å¯¹è±¡æ¯”ç´¢å¼•ç»“ç‚¹å¤§å¾ˆå¤šæ—¶ï¼Œé‚£ç´¢å¼•å ç”¨çš„é¢å¤–ç©ºé—´å°±å¯ä»¥å¿½ç•¥äº†ã€‚\n\n### **é«˜æ•ˆçš„åŠ¨æ€æ’å…¥å’Œåˆ é™¤**\n\nè·³è¡¨è¿™ä¸ªåŠ¨æ€æ•°æ®ç»“æ„ï¼Œä¸ä»…æ”¯æŒæŸ¥æ‰¾æ“ä½œï¼Œè¿˜æ”¯æŒåŠ¨æ€çš„æ’å…¥ã€åˆ é™¤æ“ä½œï¼Œè€Œä¸”æ’å…¥ã€åˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(logn)ã€‚\n\næˆ‘ä»¬çŸ¥é“ï¼Œåœ¨å•é“¾è¡¨ä¸­ï¼Œä¸€æ—¦å®šä½å¥½è¦æ’å…¥çš„ä½ç½®ï¼Œæ’å…¥ç»“ç‚¹çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¾ˆä½çš„ï¼Œå°±æ˜¯ O(1)ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œä¸ºäº†ä¿è¯åŸå§‹é“¾è¡¨ä¸­æ•°æ®çš„æœ‰åºæ€§ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ‰¾åˆ°è¦æ’å…¥çš„ä½ç½®ï¼Œè¿™ä¸ªæŸ¥æ‰¾æ“ä½œå°±ä¼šæ¯”è¾ƒè€—æ—¶ã€‚\n\nå¯¹äºçº¯ç²¹çš„å•é“¾è¡¨ï¼Œéœ€è¦éå†æ¯ä¸ªç»“ç‚¹ï¼Œæ¥æ‰¾åˆ°æ’å…¥çš„ä½ç½®ã€‚ä½†æ˜¯ï¼Œå¯¹äºè·³è¡¨æ¥è¯´ï¼Œæˆ‘ä»¬è®²è¿‡æŸ¥æ‰¾æŸä¸ªç»“ç‚¹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ï¼Œæ‰€ä»¥è¿™é‡ŒæŸ¥æ‰¾æŸä¸ªæ•°æ®åº”è¯¥æ’å…¥çš„ä½ç½®ï¼Œæ–¹æ³•ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(logn)ã€‚\n\n![Untitled](Extras/Images/alg_68.png)\n\nåœ¨åˆ é™¤æ“ä½œä¸­ï¼Œå¦‚æœè¿™ä¸ªç»“ç‚¹åœ¨ç´¢å¼•ä¸­ä¹Ÿæœ‰å‡ºç°ï¼Œæˆ‘ä»¬é™¤äº†è¦åˆ é™¤åŸå§‹é“¾è¡¨ä¸­çš„ç»“ç‚¹ï¼Œè¿˜è¦åˆ é™¤ç´¢å¼•ä¸­çš„ã€‚\n\n### **è·³è¡¨ç´¢å¼•åŠ¨æ€æ›´æ–°**\n\nå½“æˆ‘ä»¬ä¸åœåœ°å¾€è·³è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œå¦‚æœæˆ‘ä»¬ä¸æ›´æ–°ç´¢å¼•ï¼Œå°±æœ‰å¯èƒ½å‡ºç°æŸ 2 ä¸ªç´¢å¼•ç»“ç‚¹ä¹‹é—´æ•°æ®éå¸¸å¤šçš„æƒ…å†µã€‚æç«¯æƒ…å†µä¸‹ï¼Œè·³è¡¨è¿˜ä¼šé€€åŒ–æˆå•é“¾è¡¨ã€‚\n\nä½œä¸ºä¸€ç§åŠ¨æ€æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬éœ€è¦æŸç§æ‰‹æ®µæ¥ç»´æŠ¤ç´¢å¼•ä¸åŸå§‹é“¾è¡¨å¤§å°ä¹‹é—´çš„å¹³è¡¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœé“¾è¡¨ä¸­ç»“ç‚¹å¤šäº†ï¼Œç´¢å¼•ç»“ç‚¹å°±ç›¸åº”åœ°å¢åŠ ä¸€äº›ï¼Œé¿å…å¤æ‚åº¦é€€åŒ–ï¼Œä»¥åŠæŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤æ“ä½œæ€§èƒ½ä¸‹é™ã€‚\n\nè·³è¡¨æ˜¯é€šè¿‡éšæœºå‡½æ•°æ¥ç»´æŠ¤å‰é¢æåˆ°çš„â€œå¹³è¡¡æ€§â€ã€‚å½“æˆ‘ä»¬å¾€è·³è¡¨ä¸­æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åŒæ—¶å°†è¿™ä¸ªæ•°æ®æ’å…¥åˆ°éƒ¨åˆ†ç´¢å¼•å±‚ä¸­ã€‚å¦‚ä½•é€‰æ‹©åŠ å…¥å“ªäº›ç´¢å¼•å±‚å‘¢ï¼Ÿ\n\næˆ‘ä»¬é€šè¿‡ä¸€ä¸ªéšæœºå‡½æ•°ï¼Œæ¥å†³å®šå°†è¿™ä¸ªç»“ç‚¹æ’å…¥åˆ°å“ªå‡ çº§ç´¢å¼•ä¸­ï¼Œæ¯”å¦‚éšæœºå‡½æ•°ç”Ÿæˆäº†å€¼ Kï¼Œé‚£æˆ‘ä»¬å°±å°†è¿™ä¸ªç»“ç‚¹æ·»åŠ åˆ°ç¬¬ä¸€çº§åˆ°ç¬¬ K çº§è¿™ K çº§ç´¢å¼•ä¸­ã€‚\n\n![Untitled](Extras/Images/alg_69.png)\n\n## æ•£åˆ—è¡¨\n\n**æ•£åˆ—è¡¨ç”¨çš„æ˜¯æ•°ç»„æ”¯æŒæŒ‰ç…§ä¸‹æ ‡éšæœºè®¿é—®æ•°æ®çš„ç‰¹æ€§ï¼Œæ‰€ä»¥æ•£åˆ—è¡¨å…¶å®å°±æ˜¯æ•°ç»„çš„ä¸€ç§æ‰©å±•ï¼Œç”±æ•°ç»„æ¼”åŒ–è€Œæ¥ã€‚å¯ä»¥è¯´ï¼Œå¦‚æœæ²¡æœ‰æ•°ç»„ï¼Œå°±æ²¡æœ‰æ•£åˆ—è¡¨ã€‚**\n\n![Untitled](Extras/Images/alg_70.png)\n\næ•£åˆ—è¡¨ç”¨çš„å°±æ˜¯æ•°ç»„æ”¯æŒæŒ‰ç…§ä¸‹æ ‡éšæœºè®¿é—®çš„æ—¶å€™ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1) çš„ç‰¹æ€§ã€‚æˆ‘ä»¬é€šè¿‡æ•£åˆ—å‡½æ•°æŠŠå…ƒç´ çš„é”®å€¼æ˜ å°„ä¸ºä¸‹æ ‡ï¼Œç„¶åå°†æ•°æ®å­˜å‚¨åœ¨æ•°ç»„ä¸­å¯¹åº”ä¸‹æ ‡çš„ä½ç½®ã€‚å½“æˆ‘ä»¬æŒ‰ç…§é”®å€¼æŸ¥è¯¢å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬ç”¨åŒæ ·çš„æ•£åˆ—å‡½æ•°ï¼Œå°†é”®å€¼è½¬åŒ–æ•°ç»„ä¸‹æ ‡ï¼Œä»å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡çš„ä½ç½®å–æ•°æ®ã€‚\n\n### **æ•£åˆ—å†²çª**\n\n- **å¼€æ”¾å¯»å€æ³•**\n\n    å¼€æ”¾å¯»å€æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå¦‚æœå‡ºç°äº†æ•£åˆ—å†²çªï¼Œæˆ‘ä»¬å°±é‡æ–°æ¢æµ‹ä¸€ä¸ªç©ºé—²ä½ç½®ï¼Œå°†å…¶æ’å…¥ã€‚é‚£å¦‚ä½•é‡æ–°æ¢æµ‹æ–°çš„ä½ç½®å‘¢ï¼Ÿæˆ‘å…ˆè®²ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„æ¢æµ‹æ–¹æ³•ï¼Œ**çº¿æ€§æ¢æµ‹**ï¼ˆLinear Probingï¼‰ã€‚\n\n    å½“æˆ‘ä»¬å¾€æ•£åˆ—è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œå¦‚æœæŸä¸ªæ•°æ®ç»è¿‡æ•£åˆ—å‡½æ•°æ•£åˆ—ä¹‹åï¼Œå­˜å‚¨ä½ç½®å·²ç»è¢«å ç”¨äº†ï¼Œæˆ‘ä»¬å°±ä»å½“å‰ä½ç½®å¼€å§‹ï¼Œä¾æ¬¡å¾€åæŸ¥æ‰¾ï¼Œçœ‹æ˜¯å¦æœ‰ç©ºé—²ä½ç½®ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ã€‚\n\n    ![Untitled](Extras/Images/alg_71.png)\n\n    åœ¨æ•£åˆ—è¡¨ä¸­æŸ¥æ‰¾å…ƒç´ çš„è¿‡ç¨‹æœ‰ç‚¹å„¿ç±»ä¼¼æ’å…¥è¿‡ç¨‹ã€‚æˆ‘ä»¬é€šè¿‡æ•£åˆ—å‡½æ•°æ±‚å‡ºè¦æŸ¥æ‰¾å…ƒç´ çš„é”®å€¼å¯¹åº”çš„æ•£åˆ—å€¼ï¼Œç„¶åæ¯”è¾ƒæ•°ç»„ä¸­ä¸‹æ ‡ä¸ºæ•£åˆ—å€¼çš„å…ƒç´ å’Œè¦æŸ¥æ‰¾çš„å…ƒç´ ã€‚å¦‚æœç›¸ç­‰ï¼Œåˆ™è¯´æ˜å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å…ƒç´ ï¼›å¦åˆ™å°±é¡ºåºå¾€åä¾æ¬¡æŸ¥æ‰¾ã€‚å¦‚æœéå†åˆ°æ•°ç»„ä¸­çš„ç©ºé—²ä½ç½®ï¼Œè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±è¯´æ˜è¦æŸ¥æ‰¾çš„å…ƒç´ å¹¶æ²¡æœ‰åœ¨æ•£åˆ—è¡¨ä¸­ã€‚\n\n    ![Untitled](Extras/Images/alg_72.png)\n\n    æ•£åˆ—è¡¨è·Ÿæ•°ç»„ä¸€æ ·ï¼Œä¸ä»…æ”¯æŒæ’å…¥ã€æŸ¥æ‰¾æ“ä½œï¼Œè¿˜æ”¯æŒåˆ é™¤æ“ä½œã€‚å¯¹äºä½¿ç”¨çº¿æ€§æ¢æµ‹æ³•è§£å†³å†²çªçš„æ•£åˆ—è¡¨ï¼Œåˆ é™¤æ“ä½œç¨å¾®æœ‰äº›ç‰¹åˆ«ã€‚æˆ‘ä»¬ä¸èƒ½å•çº¯åœ°æŠŠè¦åˆ é™¤çš„å…ƒç´ è®¾ç½®ä¸ºç©ºã€‚\n\n    åœ¨æŸ¥æ‰¾çš„æ—¶å€™ï¼Œä¸€æ—¦æˆ‘ä»¬é€šè¿‡çº¿æ€§æ¢æµ‹æ–¹æ³•ï¼Œæ‰¾åˆ°ä¸€ä¸ªç©ºé—²ä½ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¤å®šæ•£åˆ—è¡¨ä¸­ä¸å­˜åœ¨è¿™ä¸ªæ•°æ®ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿™ä¸ªç©ºé—²ä½ç½®æ˜¯æˆ‘ä»¬åæ¥åˆ é™¤çš„ï¼Œå°±ä¼šå¯¼è‡´åŸæ¥çš„æŸ¥æ‰¾ç®—æ³•å¤±æ•ˆã€‚\n\n    æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†åˆ é™¤çš„å…ƒç´ ï¼Œç‰¹æ®Šæ ‡è®°ä¸º deletedã€‚å½“çº¿æ€§æ¢æµ‹æŸ¥æ‰¾çš„æ—¶å€™ï¼Œé‡åˆ°æ ‡è®°ä¸º deleted çš„ç©ºé—´ï¼Œå¹¶ä¸æ˜¯åœä¸‹æ¥ï¼Œè€Œæ˜¯ç»§ç»­å¾€ä¸‹æ¢æµ‹ã€‚\n\n    ![Untitled](Extras/Images/alg_73.png)\n\n    çº¿æ€§æ¢æµ‹æ³•å…¶å®å­˜åœ¨å¾ˆå¤§é—®é¢˜ã€‚å½“æ•£åˆ—è¡¨ä¸­æ’å…¥çš„æ•°æ®è¶Šæ¥è¶Šå¤šæ—¶ï¼Œæ•£åˆ—å†²çªå‘ç”Ÿçš„å¯èƒ½æ€§å°±ä¼šè¶Šæ¥è¶Šå¤§ï¼Œç©ºé—²ä½ç½®ä¼šè¶Šæ¥è¶Šå°‘ï¼Œçº¿æ€§æ¢æµ‹çš„æ—¶é—´å°±ä¼šè¶Šæ¥è¶Šä¹…ã€‚æç«¯æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ¢æµ‹æ•´ä¸ªæ•£åˆ—è¡¨ï¼Œæ‰€ä»¥æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚åŒç†ï¼Œåœ¨åˆ é™¤å’ŒæŸ¥æ‰¾æ—¶ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šçº¿æ€§æ¢æµ‹æ•´å¼ æ•£åˆ—è¡¨ï¼Œæ‰èƒ½æ‰¾åˆ°è¦æŸ¥æ‰¾æˆ–è€…åˆ é™¤çš„æ•°æ®ã€‚\n\n    ---\n\n    å¯¹äºå¼€æ”¾å¯»å€å†²çªè§£å†³æ–¹æ³•ï¼Œé™¤äº†çº¿æ€§æ¢æµ‹æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸¤ç§æ¯”è¾ƒç»å…¸çš„æ¢æµ‹æ–¹æ³•ï¼Œ**äºŒæ¬¡æ¢æµ‹**ï¼ˆQuadratic probingï¼‰å’Œ**åŒé‡æ•£åˆ—**ï¼ˆDouble hashingï¼‰ã€‚\n\n    æ‰€è°“äºŒæ¬¡æ¢æµ‹ï¼Œè·Ÿçº¿æ€§æ¢æµ‹å¾ˆåƒï¼Œçº¿æ€§æ¢æµ‹æ¯æ¬¡æ¢æµ‹çš„æ­¥é•¿æ˜¯ 1ï¼Œé‚£å®ƒæ¢æµ‹çš„ä¸‹æ ‡åºåˆ—å°±æ˜¯ hash(key)+0ï¼Œhash(key)+1ï¼Œhash(key)+2â€¦â€¦è€ŒäºŒæ¬¡æ¢æµ‹æ¢æµ‹çš„æ­¥é•¿å°±å˜æˆäº†åŸæ¥çš„â€œäºŒæ¬¡æ–¹â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ¢æµ‹çš„ä¸‹æ ‡åºåˆ—å°±æ˜¯ hash(key)+0ï¼Œhash(key)+12ï¼Œhash(key)+22â€¦â€¦\n\n    æ‰€è°“åŒé‡æ•£åˆ—ï¼Œæ„æ€å°±æ˜¯ä¸ä»…è¦ä½¿ç”¨ä¸€ä¸ªæ•£åˆ—å‡½æ•°ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ç»„æ•£åˆ—å‡½æ•° hash1(key)ï¼Œhash2(key)ï¼Œhash3(key)â€¦â€¦æˆ‘ä»¬å…ˆç”¨ç¬¬ä¸€ä¸ªæ•£åˆ—å‡½æ•°ï¼Œå¦‚æœè®¡ç®—å¾—åˆ°çš„å­˜å‚¨ä½ç½®å·²ç»è¢«å ç”¨ï¼Œå†ç”¨ç¬¬äºŒä¸ªæ•£åˆ—å‡½æ•°ï¼Œä¾æ¬¡ç±»æ¨ï¼Œç›´åˆ°æ‰¾åˆ°ç©ºé—²çš„å­˜å‚¨ä½ç½®ã€‚\n\n    ä¸ç®¡é‡‡ç”¨å“ªç§æ¢æµ‹æ–¹æ³•ï¼Œå½“æ•£åˆ—è¡¨ä¸­ç©ºé—²ä½ç½®ä¸å¤šçš„æ—¶å€™ï¼Œæ•£åˆ—å†²çªçš„æ¦‚ç‡å°±ä¼šå¤§å¤§æé«˜ã€‚ä¸ºäº†å°½å¯èƒ½ä¿è¯æ•£åˆ—è¡¨çš„æ“ä½œæ•ˆç‡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå°½å¯èƒ½ä¿è¯æ•£åˆ—è¡¨ä¸­æœ‰ä¸€å®šæ¯”ä¾‹çš„ç©ºé—²æ§½ä½ã€‚æˆ‘ä»¬ç”¨**è£…è½½å› å­**ï¼ˆload factorï¼‰æ¥è¡¨ç¤ºç©ºä½çš„å¤šå°‘ã€‚\n\n    è£…è½½å› å­çš„è®¡ç®—å…¬å¼æ˜¯ï¼š\n\n    ```java\n    æ•£åˆ—è¡¨çš„è£…è½½å› å­=å¡«å…¥è¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°/æ•£åˆ—è¡¨çš„é•¿åº¦\n    ```\n\n    è£…è½½å› å­è¶Šå¤§ï¼Œè¯´æ˜ç©ºé—²ä½ç½®è¶Šå°‘ï¼Œå†²çªè¶Šå¤šï¼Œæ•£åˆ—è¡¨çš„æ€§èƒ½ä¼šä¸‹é™ã€‚\n\n- **é“¾è¡¨æ³•**\n\n    é“¾è¡¨æ³•æ˜¯ä¸€ç§æ›´åŠ å¸¸ç”¨çš„æ•£åˆ—å†²çªè§£å†³åŠæ³•ï¼Œåœ¨æ•£åˆ—è¡¨ä¸­ï¼Œæ¯ä¸ªâ€œæ¡¶ï¼ˆbucketï¼‰â€æˆ–è€…â€œæ§½ï¼ˆslotï¼‰â€ä¼šå¯¹åº”ä¸€æ¡é“¾è¡¨ï¼Œæ‰€æœ‰æ•£åˆ—å€¼ç›¸åŒçš„å…ƒç´ æˆ‘ä»¬éƒ½æ”¾åˆ°ç›¸åŒæ§½ä½å¯¹åº”çš„é“¾è¡¨ä¸­ã€‚\n\n    ![Untitled](Extras/Images/alg_74.png)\n\n    å½“æ’å…¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡æ•£åˆ—å‡½æ•°è®¡ç®—å‡ºå¯¹åº”çš„æ•£åˆ—æ§½ä½ï¼Œå°†å…¶æ’å…¥åˆ°å¯¹åº”é“¾è¡¨ä¸­å³å¯ï¼Œæ‰€ä»¥æ’å…¥çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚å½“æŸ¥æ‰¾ã€åˆ é™¤ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæˆ‘ä»¬åŒæ ·é€šè¿‡æ•£åˆ—å‡½æ•°è®¡ç®—å‡ºå¯¹åº”çš„æ§½ï¼Œç„¶åéå†é“¾è¡¨æŸ¥æ‰¾æˆ–è€…åˆ é™¤ã€‚é‚£æŸ¥æ‰¾æˆ–åˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿ\n\n    å®é™…ä¸Šï¼Œè¿™ä¸¤ä¸ªæ“ä½œçš„æ—¶é—´å¤æ‚åº¦è·Ÿé“¾è¡¨çš„é•¿åº¦ k æˆæ­£æ¯”ï¼Œä¹Ÿå°±æ˜¯ O(k)ã€‚å¯¹äºæ•£åˆ—æ¯”è¾ƒå‡åŒ€çš„æ•£åˆ—å‡½æ•°æ¥è¯´ï¼Œç†è®ºä¸Šè®²ï¼Œk=n/mï¼Œå…¶ä¸­ n è¡¨ç¤ºæ•£åˆ—ä¸­æ•°æ®çš„ä¸ªæ•°ï¼Œm è¡¨ç¤ºæ•£åˆ—è¡¨ä¸­â€œæ§½â€çš„ä¸ªæ•°ã€‚\n\n\n### **å¦‚ä½•è®¾è®¡æ•£åˆ—å‡½æ•°ï¼Ÿ**\n\né¦–å…ˆï¼Œ**æ•£åˆ—å‡½æ•°çš„è®¾è®¡ä¸èƒ½å¤ªå¤æ‚**ã€‚è¿‡äºå¤æ‚çš„æ•£åˆ—å‡½æ•°ï¼ŒåŠ¿å¿…ä¼šæ¶ˆè€—å¾ˆå¤šè®¡ç®—æ—¶é—´ï¼Œä¹Ÿå°±é—´æ¥åœ°å½±å“åˆ°æ•£åˆ—è¡¨çš„æ€§èƒ½ã€‚å…¶æ¬¡ï¼Œ**æ•£åˆ—å‡½æ•°ç”Ÿæˆçš„å€¼è¦å°½å¯èƒ½éšæœºå¹¶ä¸”å‡åŒ€åˆ†å¸ƒ**ï¼Œè¿™æ ·æ‰èƒ½é¿å…æˆ–è€…æœ€å°åŒ–æ•£åˆ—å†²çªï¼Œè€Œä¸”å³ä¾¿å‡ºç°å†²çªï¼Œæ•£åˆ—åˆ°æ¯ä¸ªæ§½é‡Œçš„æ•°æ®ä¹Ÿä¼šæ¯”è¾ƒå¹³å‡ï¼Œä¸ä¼šå‡ºç°æŸä¸ªæ§½å†…æ•°æ®ç‰¹åˆ«å¤šçš„æƒ…å†µã€‚\n\nå®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç»¼åˆè€ƒè™‘å„ç§å› ç´ ã€‚è¿™äº›å› ç´ æœ‰å…³é”®å­—çš„é•¿åº¦ã€ç‰¹ç‚¹ã€åˆ†å¸ƒã€è¿˜æœ‰æ•£åˆ—è¡¨çš„å¤§å°ç­‰ã€‚\n\nç¬¬ä¸€ä¸ªä¾‹å­æ˜¯å­¦ç”Ÿè¿åŠ¨ä¼šçš„ä¾‹å­ï¼Œæˆ‘ä»¬é€šè¿‡åˆ†æå‚èµ›ç¼–å·çš„ç‰¹å¾ï¼ŒæŠŠç¼–å·ä¸­çš„åä¸¤ä½ä½œä¸ºæ•£åˆ—å€¼ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ç”¨ç±»ä¼¼çš„æ•£åˆ—å‡½æ•°å¤„ç†æ‰‹æœºå·ç ï¼Œå› ä¸ºæ‰‹æœºå·ç å‰å‡ ä½é‡å¤çš„å¯èƒ½æ€§å¾ˆå¤§ï¼Œä½†æ˜¯åé¢å‡ ä½å°±æ¯”è¾ƒéšæœºï¼Œæˆ‘ä»¬å¯ä»¥å–æ‰‹æœºå·çš„åå››ä½ä½œä¸ºæ•£åˆ—å€¼ã€‚è¿™ç§æ•£åˆ—å‡½æ•°çš„è®¾è®¡æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸€èˆ¬å«åšâ€œæ•°æ®åˆ†ææ³•â€ã€‚\n\nç¬¬äºŒä¸ªä¾‹å­æ˜¯å¦‚ä½•å®ç° Word æ‹¼å†™æ£€æŸ¥åŠŸèƒ½ã€‚è¿™é‡Œé¢çš„æ•£åˆ—å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿™æ ·è®¾è®¡ï¼šå°†å•è¯ä¸­æ¯ä¸ªå­—æ¯çš„ASCll ç å€¼â€œè¿›ä½â€ç›¸åŠ ï¼Œç„¶åå†è·Ÿæ•£åˆ—è¡¨çš„å¤§å°æ±‚ä½™ã€å–æ¨¡ï¼Œä½œä¸ºæ•£åˆ—å€¼ã€‚æ¯”å¦‚ï¼Œè‹±æ–‡å•è¯ niceï¼Œæˆ‘ä»¬è½¬åŒ–å‡ºæ¥çš„æ•£åˆ—å€¼å°±æ˜¯ä¸‹é¢è¿™æ ·ï¼š\n\n```java\nhash(\"nice\")=((\"n\" - \"a\") * 26*26*26 + (\"i\" - \"a\")*26*26 + (\"c\" - \"a\")*26+ (\"e\"-\"a\")) / 78978\n```\n\nå®é™…ä¸Šï¼Œæ•£åˆ—å‡½æ•°çš„è®¾è®¡æ–¹æ³•è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ç›´æ¥å¯»å€æ³•ã€å¹³æ–¹å–ä¸­æ³•ã€æŠ˜å æ³•ã€éšæœºæ•°æ³•ç­‰ï¼Œè¿™äº›åªè¦äº†è§£å°±è¡Œäº†ï¼Œä¸éœ€è¦å…¨éƒ½æŒæ¡ã€‚\n\n### **è£…è½½å› å­è¿‡å¤§äº†æ€ä¹ˆåŠï¼Ÿ**\n\né’ˆå¯¹æ•£åˆ—è¡¨ï¼Œå½“è£…è½½å› å­è¿‡å¤§æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿›è¡ŒåŠ¨æ€æ‰©å®¹ï¼Œé‡æ–°ç”³è¯·ä¸€ä¸ªæ›´å¤§çš„æ•£åˆ—è¡¨ï¼Œå°†æ•°æ®æ¬ç§»åˆ°è¿™ä¸ªæ–°æ•£åˆ—è¡¨ä¸­ã€‚\n\né’ˆå¯¹æ•£åˆ—è¡¨çš„æ‰©å®¹ï¼Œæ•°æ®æ¬ç§»æ“ä½œè¦å¤æ‚å¾ˆå¤šã€‚å› ä¸ºæ•£åˆ—è¡¨çš„å¤§å°å˜äº†ï¼Œæ•°æ®çš„å­˜å‚¨ä½ç½®ä¹Ÿå˜äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡æ•£åˆ—å‡½æ•°é‡æ–°è®¡ç®—æ¯ä¸ªæ•°æ®çš„å­˜å‚¨ä½ç½®ã€‚\n\næ¯”å¦‚ä¸‹å›¾ä¸­ï¼Œåœ¨åŸæ¥çš„æ•£åˆ—è¡¨ä¸­ï¼Œ21 è¿™ä¸ªå…ƒç´ åŸæ¥å­˜å‚¨åœ¨ä¸‹æ ‡ä¸º 0 çš„ä½ç½®ï¼Œæ¬ç§»åˆ°æ–°çš„æ•£åˆ—è¡¨ä¸­ï¼Œå­˜å‚¨åœ¨ä¸‹æ ‡ä¸º 7 çš„ä½ç½®ã€‚\n\n![Untitled](Extras/Images/alg_75.png)\n\næ’å…¥ä¸€ä¸ªæ•°æ®ï¼Œæœ€å¥½æƒ…å†µä¸‹ï¼Œä¸éœ€è¦æ‰©å®¹ï¼Œæœ€å¥½æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚æœ€åæƒ…å†µä¸‹ï¼Œæ•£åˆ—è¡¨è£…è½½å› å­è¿‡é«˜ï¼Œå¯åŠ¨æ‰©å®¹ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°ç”³è¯·å†…å­˜ç©ºé—´ï¼Œé‡æ–°è®¡ç®—å“ˆå¸Œä½ç½®ï¼Œå¹¶ä¸”æ¬ç§»æ•°æ®ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚ç”¨æ‘Šè¿˜åˆ†ææ³•ï¼Œå‡æ‘Šæƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦æ¥è¿‘æœ€å¥½æƒ…å†µï¼Œå°±æ˜¯ O(1)ã€‚\n\nå®é™…ä¸Šï¼Œå¯¹äºåŠ¨æ€æ•£åˆ—è¡¨ï¼Œéšç€æ•°æ®çš„åˆ é™¤ï¼Œæ•£åˆ—è¡¨ä¸­çš„æ•°æ®ä¼šè¶Šæ¥è¶Šå°‘ï¼Œç©ºé—²ç©ºé—´ä¼šè¶Šæ¥è¶Šå¤šã€‚å¦‚æœæˆ‘ä»¬å¯¹ç©ºé—´æ¶ˆè€—éå¸¸æ•æ„Ÿï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è£…è½½å› å­å°äºæŸä¸ªå€¼ä¹‹åï¼Œå¯åŠ¨åŠ¨æ€ç¼©å®¹ã€‚å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬æ›´åŠ åœ¨æ„æ‰§è¡Œæ•ˆç‡ï¼Œèƒ½å¤Ÿå®¹å¿å¤šæ¶ˆè€—ä¸€ç‚¹å†…å­˜ç©ºé—´ï¼Œé‚£å°±å¯ä»¥ä¸ç”¨è´¹åŠ²æ¥ç¼©å®¹äº†ã€‚\n\n### **å¦‚ä½•é¿å…ä½æ•ˆçš„æ‰©å®¹ï¼Ÿ**\n\nå½“è£…è½½å› å­å·²ç»åˆ°è¾¾é˜ˆå€¼ï¼Œéœ€è¦å…ˆè¿›è¡Œæ‰©å®¹ï¼Œå†æ’å…¥æ•°æ®ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæ’å…¥æ•°æ®å°±ä¼šå˜å¾—å¾ˆæ…¢ï¼Œç”šè‡³ä¼šæ— æ³•æ¥å—ã€‚\n\nå¦‚æœæˆ‘ä»¬çš„ä¸šåŠ¡ä»£ç ç›´æ¥æœåŠ¡äºç”¨æˆ·ï¼Œå°½ç®¡å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ’å…¥ä¸€ä¸ªæ•°æ®çš„æ“ä½œéƒ½å¾ˆå¿«ï¼Œä½†æ˜¯ï¼Œæä¸ªåˆ«éå¸¸æ…¢çš„æ’å…¥æ“ä½œï¼Œä¹Ÿä¼šè®©ç”¨æˆ·å´©æºƒã€‚è¿™ä¸ªæ—¶å€™ï¼Œâ€œä¸€æ¬¡æ€§â€æ‰©å®¹çš„æœºåˆ¶å°±ä¸åˆé€‚äº†ã€‚\n\nä¸ºäº†è§£å†³ä¸€æ¬¡æ€§æ‰©å®¹è€—æ—¶è¿‡å¤šçš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰©å®¹æ“ä½œç©¿æ’åœ¨æ’å…¥æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œåˆ†æ‰¹å®Œæˆã€‚å½“è£…è½½å› å­è§¦è¾¾é˜ˆå€¼ä¹‹åï¼Œæˆ‘ä»¬åªç”³è¯·æ–°ç©ºé—´ï¼Œä½†å¹¶ä¸å°†è€çš„æ•°æ®æ¬ç§»åˆ°æ–°æ•£åˆ—è¡¨ä¸­ã€‚\n\nå½“æœ‰æ–°æ•°æ®è¦æ’å…¥æ—¶ï¼Œæˆ‘ä»¬å°†æ–°æ•°æ®æ’å…¥æ–°æ•£åˆ—è¡¨ä¸­ï¼Œå¹¶ä¸”ä»è€çš„æ•£åˆ—è¡¨ä¸­æ‹¿å‡ºä¸€ä¸ªæ•°æ®æ”¾å…¥åˆ°æ–°æ•£åˆ—è¡¨ã€‚æ¯æ¬¡æ’å…¥ä¸€ä¸ªæ•°æ®åˆ°æ•£åˆ—è¡¨ï¼Œæˆ‘ä»¬éƒ½é‡å¤ä¸Šé¢çš„è¿‡ç¨‹ã€‚ç»è¿‡å¤šæ¬¡æ’å…¥æ“ä½œä¹‹åï¼Œè€çš„æ•£åˆ—è¡¨ä¸­çš„æ•°æ®å°±ä¸€ç‚¹ä¸€ç‚¹å…¨éƒ¨æ¬ç§»åˆ°æ–°æ•£åˆ—è¡¨ä¸­äº†ã€‚è¿™æ ·æ²¡æœ‰äº†é›†ä¸­çš„ä¸€æ¬¡æ€§æ•°æ®æ¬ç§»ï¼Œæ’å…¥æ“ä½œå°±éƒ½å˜å¾—å¾ˆå¿«äº†ã€‚\n\n![Untitled](Extras/Images/alg_76.png)\n\nå¯¹äºæŸ¥è¯¢æ“ä½œï¼Œä¸ºäº†å…¼å®¹äº†æ–°ã€è€æ•£åˆ—è¡¨ä¸­çš„æ•°æ®ï¼Œæˆ‘ä»¬å…ˆä»æ–°æ•£åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå†å»è€çš„æ•£åˆ—è¡¨ä¸­æŸ¥æ‰¾ã€‚\n\né€šè¿‡è¿™æ ·å‡æ‘Šçš„æ–¹æ³•ï¼Œå°†ä¸€æ¬¡æ€§æ‰©å®¹çš„ä»£ä»·ï¼Œå‡æ‘Šåˆ°å¤šæ¬¡æ’å…¥æ“ä½œä¸­ï¼Œå°±é¿å…äº†ä¸€æ¬¡æ€§æ‰©å®¹è€—æ—¶è¿‡å¤šçš„æƒ…å†µã€‚è¿™ç§å®ç°æ–¹å¼ï¼Œä»»ä½•æƒ…å†µä¸‹ï¼Œæ’å…¥ä¸€ä¸ªæ•°æ®çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(1)ã€‚\n\n### **å¦‚ä½•é€‰æ‹©å†²çªè§£å†³æ–¹æ³•ï¼Ÿ**\n\n- **å¼€æ”¾å¯»å€æ³•**\n    - ä¼˜ç‚¹\n\n        å¼€æ”¾å¯»å€æ³•ä¸åƒé“¾è¡¨æ³•ï¼Œéœ€è¦æ‹‰å¾ˆå¤šé“¾è¡¨ã€‚æ•£åˆ—è¡¨ä¸­çš„æ•°æ®éƒ½å­˜å‚¨åœ¨æ•°ç»„ä¸­ï¼Œå¯ä»¥æœ‰æ•ˆåœ°åˆ©ç”¨ CPU ç¼“å­˜åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚è€Œä¸”ï¼Œè¿™ç§æ–¹æ³•å®ç°çš„æ•£åˆ—è¡¨ï¼Œåºåˆ—åŒ–èµ·æ¥æ¯”è¾ƒç®€å•ã€‚é“¾è¡¨æ³•åŒ…å«æŒ‡é’ˆï¼Œåºåˆ—åŒ–èµ·æ¥å°±æ²¡é‚£ä¹ˆå®¹æ˜“ã€‚\n\n    - ç¼ºç‚¹\n\n        ç”¨å¼€æ”¾å¯»å€æ³•è§£å†³å†²çªçš„æ•£åˆ—è¡¨ï¼Œåˆ é™¤æ•°æ®çš„æ—¶å€™æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦ç‰¹æ®Šæ ‡è®°å·²ç»åˆ é™¤æ‰çš„æ•°æ®ã€‚è€Œä¸”ï¼Œåœ¨å¼€æ”¾å¯»å€æ³•ä¸­ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œæ¯”èµ·é“¾è¡¨æ³•æ¥è¯´ï¼Œå†²çªçš„ä»£ä»·æ›´é«˜ã€‚æ‰€ä»¥ï¼Œä½¿ç”¨å¼€æ”¾å¯»å€æ³•è§£å†³å†²çªçš„æ•£åˆ—è¡¨ï¼Œè£…è½½å› å­çš„ä¸Šé™ä¸èƒ½å¤ªå¤§ã€‚è¿™ä¹Ÿå¯¼è‡´è¿™ç§æ–¹æ³•æ¯”é“¾è¡¨æ³•æ›´æµªè´¹å†…å­˜ç©ºé—´ã€‚\n\n\n    **æ€»ç»“ä¸€ä¸‹ï¼Œå½“æ•°æ®é‡æ¯”è¾ƒå°ã€è£…è½½å› å­å°çš„æ—¶å€™ï¼Œé€‚åˆé‡‡ç”¨å¼€æ”¾å¯»å€æ³•ã€‚**\n\n- **é“¾è¡¨æ³•**\n\n    é“¾è¡¨æ³•å¯¹å†…å­˜çš„åˆ©ç”¨ç‡æ¯”å¼€æ”¾å¯»å€æ³•è¦é«˜ã€‚å› ä¸ºé“¾è¡¨ç»“ç‚¹å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™å†åˆ›å»ºï¼Œå¹¶ä¸éœ€è¦åƒå¼€æ”¾å¯»å€æ³•é‚£æ ·äº‹å…ˆç”³è¯·å¥½ã€‚\n\n    é“¾è¡¨æ³•æ¯”èµ·å¼€æ”¾å¯»å€æ³•ï¼Œå¯¹å¤§è£…è½½å› å­çš„å®¹å¿åº¦æ›´é«˜ã€‚å¼€æ”¾å¯»å€æ³•åªèƒ½é€‚ç”¨è£…è½½å› å­å°äº 1 çš„æƒ…å†µã€‚æ¥è¿‘ 1 æ—¶ï¼Œå°±å¯èƒ½ä¼šæœ‰å¤§é‡çš„æ•£åˆ—å†²çªï¼Œå¯¼è‡´å¤§é‡çš„æ¢æµ‹ã€å†æ•£åˆ—ç­‰ï¼Œæ€§èƒ½ä¼šä¸‹é™å¾ˆå¤šã€‚ä½†æ˜¯å¯¹äºé“¾è¡¨æ³•æ¥è¯´ï¼Œåªè¦æ•£åˆ—å‡½æ•°çš„å€¼éšæœºå‡åŒ€ï¼Œå³ä¾¿è£…è½½å› å­å˜æˆ 10ï¼Œä¹Ÿå°±æ˜¯é“¾è¡¨çš„é•¿åº¦å˜é•¿äº†è€Œå·²ï¼Œè™½ç„¶æŸ¥æ‰¾æ•ˆç‡æœ‰æ‰€ä¸‹é™ï¼Œä½†æ˜¯æ¯”èµ·é¡ºåºæŸ¥æ‰¾è¿˜æ˜¯å¿«å¾ˆå¤šã€‚\n\n    é“¾è¡¨å› ä¸ºè¦å­˜å‚¨æŒ‡é’ˆï¼Œæ‰€ä»¥å¯¹äºæ¯”è¾ƒå°çš„å¯¹è±¡çš„å­˜å‚¨ï¼Œæ˜¯æ¯”è¾ƒæ¶ˆè€—å†…å­˜çš„ï¼Œè¿˜æœ‰å¯èƒ½ä¼šè®©å†…å­˜çš„æ¶ˆè€—ç¿»å€ã€‚è€Œä¸”ï¼Œå› ä¸ºé“¾è¡¨ä¸­çš„ç»“ç‚¹æ˜¯é›¶æ•£åˆ†å¸ƒåœ¨å†…å­˜ä¸­çš„ï¼Œä¸æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥å¯¹ CPU ç¼“å­˜æ˜¯ä¸å‹å¥½çš„ï¼Œè¿™æ–¹é¢å¯¹äºæ‰§è¡Œæ•ˆç‡ä¹Ÿæœ‰ä¸€å®šçš„å½±å“ã€‚\n\n    å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬å­˜å‚¨çš„æ˜¯å¤§å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´è¦å­˜å‚¨çš„å¯¹è±¡çš„å¤§å°è¿œè¿œå¤§äºä¸€ä¸ªæŒ‡é’ˆçš„å¤§å°ï¼ˆ4 ä¸ªå­—èŠ‚æˆ–è€… 8 ä¸ªå­—èŠ‚ï¼‰ï¼Œé‚£é“¾è¡¨ä¸­æŒ‡é’ˆçš„å†…å­˜æ¶ˆè€—åœ¨å¤§å¯¹è±¡é¢å‰å°±å¯ä»¥å¿½ç•¥äº†ã€‚\n\n    å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯¹é“¾è¡¨æ³•ç¨åŠ æ”¹é€ ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªæ›´åŠ é«˜æ•ˆçš„æ•£åˆ—è¡¨ã€‚é‚£å°±æ˜¯ï¼Œæˆ‘ä»¬å°†é“¾è¡¨æ³•ä¸­çš„é“¾è¡¨æ”¹é€ ä¸ºå…¶ä»–é«˜æ•ˆçš„åŠ¨æ€æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚è·³è¡¨ã€çº¢é»‘æ ‘ã€‚è¿™æ ·ï¼Œå³ä¾¿å‡ºç°æ•£åˆ—å†²çªï¼Œæç«¯æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ•£åˆ—åˆ°åŒä¸€ä¸ªæ¡¶å†…ï¼Œé‚£æœ€ç»ˆé€€åŒ–æˆçš„æ•£åˆ—è¡¨çš„æŸ¥æ‰¾æ—¶é—´ä¹Ÿåªä¸è¿‡æ˜¯ O(logn)ã€‚è¿™æ ·ä¹Ÿå°±æœ‰æ•ˆé¿å…äº†å‰é¢è®²åˆ°çš„æ•£åˆ—ç¢°æ’æ”»å‡»ã€‚\n\n    ![Untitled](Extras/Images/alg_77.png)\n\n    **æ€»ç»“ä¸€ä¸‹ï¼ŒåŸºäºé“¾è¡¨çš„æ•£åˆ—å†²çªå¤„ç†æ–¹æ³•æ¯”è¾ƒé€‚åˆå­˜å‚¨å¤§å¯¹è±¡ã€å¤§æ•°æ®é‡çš„æ•£åˆ—è¡¨ï¼Œè€Œä¸”ï¼Œæ¯”èµ·å¼€æ”¾å¯»å€æ³•ï¼Œå®ƒæ›´åŠ çµæ´»ï¼Œæ”¯æŒæ›´å¤šçš„ä¼˜åŒ–ç­–ç•¥ï¼Œæ¯”å¦‚ç”¨çº¢é»‘æ ‘ä»£æ›¿é“¾è¡¨ã€‚**\n\n\n### **ä¸ºä»€ä¹ˆæ•£åˆ—è¡¨å’Œé“¾è¡¨ç»å¸¸ä¼šä¸€èµ·ä½¿ç”¨ï¼Ÿ**\n\n- **LRU ç¼“å­˜æ·˜æ±°ç®—æ³•**\n\n    ![Untitled](Extras/Images/alg_78.png)\n\n    ä½¿ç”¨åŒå‘é“¾è¡¨å­˜å‚¨æ•°æ®ï¼Œé“¾è¡¨ä¸­çš„æ¯ä¸ªç»“ç‚¹å¤„ç†å­˜å‚¨æ•°æ®ï¼ˆdataï¼‰ã€å‰é©±æŒ‡é’ˆï¼ˆprevï¼‰ã€åç»§æŒ‡é’ˆï¼ˆnextï¼‰ä¹‹å¤–ï¼Œè¿˜æ–°å¢äº†ä¸€ä¸ªç‰¹æ®Šçš„å­—æ®µ hnextã€‚\n\n    å› ä¸ºæˆ‘ä»¬çš„æ•£åˆ—è¡¨æ˜¯é€šè¿‡é“¾è¡¨æ³•è§£å†³æ•£åˆ—å†²çªçš„ï¼Œæ‰€ä»¥æ¯ä¸ªç»“ç‚¹ä¼šåœ¨ä¸¤æ¡é“¾ä¸­ã€‚ä¸€ä¸ªé“¾æ˜¯åˆšåˆšæˆ‘ä»¬æåˆ°çš„åŒå‘é“¾è¡¨ï¼Œå¦ä¸€ä¸ªé“¾æ˜¯æ•£åˆ—è¡¨ä¸­çš„æ‹‰é“¾ã€‚å‰é©±å’Œåç»§æŒ‡é’ˆæ˜¯ä¸ºäº†å°†ç»“ç‚¹ä¸²åœ¨åŒå‘é“¾è¡¨ä¸­ï¼Œhnext æŒ‡é’ˆæ˜¯ä¸ºäº†å°†ç»“ç‚¹ä¸²åœ¨æ•£åˆ—è¡¨çš„æ‹‰é“¾ä¸­ã€‚\n\n    é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹**å¦‚ä½•æŸ¥æ‰¾ä¸€ä¸ªæ•°æ®**ã€‚æˆ‘ä»¬å‰é¢è®²è¿‡ï¼Œæ•£åˆ—è¡¨ä¸­æŸ¥æ‰¾æ•°æ®çš„æ—¶é—´å¤æ‚åº¦æ¥è¿‘ O(1)ï¼Œæ‰€ä»¥é€šè¿‡æ•£åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå¿«åœ°åœ¨ç¼“å­˜ä¸­æ‰¾åˆ°ä¸€ä¸ªæ•°æ®ã€‚å½“æ‰¾åˆ°æ•°æ®ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å®ƒç§»åŠ¨åˆ°åŒå‘é“¾è¡¨çš„å°¾éƒ¨ã€‚\n\n    å…¶æ¬¡ï¼Œæˆ‘ä»¬æ¥çœ‹**å¦‚ä½•åˆ é™¤ä¸€ä¸ªæ•°æ®**ã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ•°æ®æ‰€åœ¨çš„ç»“ç‚¹ï¼Œç„¶åå°†ç»“ç‚¹åˆ é™¤ã€‚å€ŸåŠ©æ•£åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ O(1) æ—¶é—´å¤æ‚åº¦é‡Œæ‰¾åˆ°è¦åˆ é™¤çš„ç»“ç‚¹ã€‚å› ä¸ºæˆ‘ä»¬çš„é“¾è¡¨æ˜¯åŒå‘é“¾è¡¨ï¼ŒåŒå‘é“¾è¡¨å¯ä»¥é€šè¿‡å‰é©±æŒ‡é’ˆ O(1) æ—¶é—´å¤æ‚åº¦è·å–å‰é©±ç»“ç‚¹ï¼Œæ‰€ä»¥åœ¨åŒå‘é“¾è¡¨ä¸­ï¼Œåˆ é™¤ç»“ç‚¹åªéœ€è¦ O(1) çš„æ—¶é—´å¤æ‚åº¦ã€‚\n\n    æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹**å¦‚ä½•æ·»åŠ ä¸€ä¸ªæ•°æ®**ã€‚æ·»åŠ æ•°æ®åˆ°ç¼“å­˜ç¨å¾®æœ‰ç‚¹éº»çƒ¦ï¼Œæˆ‘ä»¬éœ€è¦å…ˆçœ‹è¿™ä¸ªæ•°æ®æ˜¯å¦å·²ç»åœ¨ç¼“å­˜ä¸­ã€‚å¦‚æœå·²ç»åœ¨å…¶ä¸­ï¼Œéœ€è¦å°†å…¶ç§»åŠ¨åˆ°åŒå‘é“¾è¡¨çš„å°¾éƒ¨ï¼›å¦‚æœä¸åœ¨å…¶ä¸­ï¼Œè¿˜è¦çœ‹ç¼“å­˜æœ‰æ²¡æœ‰æ»¡ã€‚å¦‚æœæ»¡äº†ï¼Œåˆ™å°†åŒå‘é“¾è¡¨å¤´éƒ¨çš„ç»“ç‚¹åˆ é™¤ï¼Œç„¶åå†å°†æ•°æ®æ”¾åˆ°é“¾è¡¨çš„å°¾éƒ¨ï¼›å¦‚æœæ²¡æœ‰æ»¡ï¼Œå°±ç›´æ¥å°†æ•°æ®æ”¾åˆ°é“¾è¡¨çš„å°¾éƒ¨ã€‚\n\n    è¿™æ•´ä¸ªè¿‡ç¨‹æ¶‰åŠçš„æŸ¥æ‰¾æ“ä½œéƒ½å¯ä»¥é€šè¿‡æ•£åˆ—è¡¨æ¥å®Œæˆã€‚å…¶ä»–çš„æ“ä½œï¼Œæ¯”å¦‚åˆ é™¤å¤´ç»“ç‚¹ã€é“¾è¡¨å°¾éƒ¨æ’å…¥æ•°æ®ç­‰ï¼Œéƒ½å¯ä»¥åœ¨ O(1) çš„æ—¶é—´å¤æ‚åº¦å†…å®Œæˆã€‚æ‰€ä»¥ï¼Œè¿™ä¸‰ä¸ªæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(1)ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å°±é€šè¿‡æ•£åˆ—è¡¨å’ŒåŒå‘é“¾è¡¨çš„ç»„åˆä½¿ç”¨ï¼Œå®ç°äº†ä¸€ä¸ªé«˜æ•ˆçš„ã€æ”¯æŒ LRU ç¼“å­˜æ·˜æ±°ç®—æ³•çš„ç¼“å­˜ç³»ç»ŸåŸå‹ã€‚\n\n- **Redis æœ‰åºé›†åˆ**\n\n    åœ¨æœ‰åºé›†åˆä¸­ï¼Œæ¯ä¸ªæˆå‘˜å¯¹è±¡æœ‰ä¸¤ä¸ªé‡è¦çš„å±æ€§ï¼Œkeyï¼ˆé”®å€¼ï¼‰å’Œ scoreï¼ˆåˆ†å€¼ï¼‰ã€‚æˆ‘ä»¬ä¸ä»…ä¼šé€šè¿‡ score æ¥æŸ¥æ‰¾æ•°æ®ï¼Œè¿˜ä¼šé€šè¿‡ key æ¥æŸ¥æ‰¾æ•°æ®ã€‚\n\n    ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ç”¨æˆ·ç§¯åˆ†æ’è¡Œæ¦œæœ‰è¿™æ ·ä¸€ä¸ªåŠŸèƒ½ï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡ç”¨æˆ·çš„ ID æ¥æŸ¥æ‰¾ç§¯åˆ†ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç§¯åˆ†åŒºé—´æ¥æŸ¥æ‰¾ç”¨æˆ· ID æˆ–è€…å§“åä¿¡æ¯ã€‚è¿™é‡ŒåŒ…å« IDã€å§“åå’Œç§¯åˆ†çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå°±æ˜¯æˆå‘˜å¯¹è±¡ï¼Œç”¨æˆ· ID å°±æ˜¯ keyï¼Œç§¯åˆ†å°±æ˜¯ scoreã€‚\n\n    æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬ç»†åŒ–ä¸€ä¸‹ Redis æœ‰åºé›†åˆçš„æ“ä½œï¼Œé‚£å°±æ˜¯ä¸‹é¢è¿™æ ·ï¼š\n\n    - æ·»åŠ ä¸€ä¸ªæˆå‘˜å¯¹è±¡ï¼›\n    - æŒ‰ç…§é”®å€¼æ¥åˆ é™¤ä¸€ä¸ªæˆå‘˜å¯¹è±¡ï¼›\n    - æŒ‰ç…§é”®å€¼æ¥æŸ¥æ‰¾ä¸€ä¸ªæˆå‘˜å¯¹è±¡ï¼›\n    - æŒ‰ç…§åˆ†å€¼åŒºé—´æŸ¥æ‰¾æ•°æ®ï¼Œæ¯”å¦‚æŸ¥æ‰¾ç§¯åˆ†åœ¨[100, 356]ä¹‹é—´çš„æˆå‘˜å¯¹è±¡ï¼›\n    - æŒ‰ç…§åˆ†å€¼ä»å°åˆ°å¤§æ’åºæˆå‘˜å˜é‡ï¼›\n\n    å¦‚æœæˆ‘ä»¬ä»…ä»…æŒ‰ç…§åˆ†å€¼å°†æˆå‘˜å¯¹è±¡ç»„ç»‡æˆè·³è¡¨çš„ç»“æ„ï¼Œé‚£æŒ‰ç…§é”®å€¼æ¥åˆ é™¤ã€æŸ¥è¯¢æˆå‘˜å¯¹è±¡å°±ä¼šå¾ˆæ…¢ï¼Œè§£å†³æ–¹æ³•ä¸ LRU ç¼“å­˜æ·˜æ±°ç®—æ³•çš„è§£å†³æ–¹æ³•ç±»ä¼¼ã€‚æˆ‘ä»¬å¯ä»¥å†æŒ‰ç…§é”®å€¼æ„å»ºä¸€ä¸ªæ•£åˆ—è¡¨ï¼Œè¿™æ ·æŒ‰ç…§ key æ¥åˆ é™¤ã€æŸ¥æ‰¾ä¸€ä¸ªæˆå‘˜å¯¹è±¡çš„æ—¶é—´å¤æ‚åº¦å°±å˜æˆäº† O(1)ã€‚åŒæ—¶ï¼Œå€ŸåŠ©è·³è¡¨ç»“æ„ï¼Œå…¶ä»–æ“ä½œä¹Ÿéå¸¸é«˜æ•ˆã€‚\n\n- **Java LinkedHashMap**\n\n    LinkedHashMap æ˜¯é€šè¿‡åŒå‘é“¾è¡¨å’Œæ•£åˆ—è¡¨è¿™ä¸¤ç§æ•°æ®ç»“æ„ç»„åˆå®ç°çš„ã€‚LinkedHashMap ä¸­çš„â€œLinkedâ€å®é™…ä¸Šæ˜¯æŒ‡çš„æ˜¯åŒå‘é“¾è¡¨ï¼Œå¹¶éæŒ‡ç”¨é“¾è¡¨æ³•è§£å†³æ•£åˆ—å†²çªã€‚\n\n\n## **å“ˆå¸Œç®—æ³•**\n\n### ä»€ä¹ˆæ˜¯å“ˆå¸Œç®—æ³•\n\nå°†ä»»æ„é•¿åº¦çš„äºŒè¿›åˆ¶å€¼ä¸²æ˜ å°„ä¸ºå›ºå®šé•¿åº¦çš„äºŒè¿›åˆ¶å€¼ä¸²ï¼Œè¿™ä¸ªæ˜ å°„çš„è§„åˆ™å°±æ˜¯**å“ˆå¸Œç®—æ³•**ï¼Œè€Œé€šè¿‡åŸå§‹æ•°æ®æ˜ å°„ä¹‹åå¾—åˆ°çš„äºŒè¿›åˆ¶å€¼ä¸²å°±æ˜¯**å“ˆå¸Œå€¼**ã€‚ä½†æ˜¯ï¼Œè¦æƒ³è®¾è®¡ä¸€ä¸ªä¼˜ç§€çš„å“ˆå¸Œç®—æ³•å¹¶ä¸å®¹æ˜“ï¼Œæ ¹æ®æˆ‘çš„ç»éªŒï¼Œæˆ‘æ€»ç»“äº†éœ€è¦æ»¡è¶³çš„å‡ ç‚¹è¦æ±‚ï¼š\n\n- ä»å“ˆå¸Œå€¼ä¸èƒ½åå‘æ¨å¯¼å‡ºåŸå§‹æ•°æ®ï¼ˆæ‰€ä»¥å“ˆå¸Œç®—æ³•ä¹Ÿå«å•å‘å“ˆå¸Œç®—æ³•ï¼‰ï¼›\n- å¯¹è¾“å…¥æ•°æ®éå¸¸æ•æ„Ÿï¼Œå“ªæ€•åŸå§‹æ•°æ®åªä¿®æ”¹äº†ä¸€ä¸ª Bitï¼Œæœ€åå¾—åˆ°çš„å“ˆå¸Œå€¼ä¹Ÿå¤§ä¸ç›¸åŒï¼›\n- æ•£åˆ—å†²çªçš„æ¦‚ç‡è¦å¾ˆå°ï¼Œå¯¹äºä¸åŒçš„åŸå§‹æ•°æ®ï¼Œå“ˆå¸Œå€¼ç›¸åŒçš„æ¦‚ç‡éå¸¸å°ï¼›\n- å“ˆå¸Œç®—æ³•çš„æ‰§è¡Œæ•ˆç‡è¦å°½é‡é«˜æ•ˆï¼Œé’ˆå¯¹è¾ƒé•¿çš„æ–‡æœ¬ï¼Œä¹Ÿèƒ½å¿«é€Ÿåœ°è®¡ç®—å‡ºå“ˆå¸Œå€¼ã€‚\n\nå“ˆå¸Œç®—æ³•çš„åº”ç”¨éå¸¸éå¸¸å¤šï¼Œæœ€å¸¸è§çš„æœ‰ä¸ƒä¸ªï¼Œåˆ†åˆ«æ˜¯å®‰å…¨åŠ å¯†ã€å”¯ä¸€æ ‡è¯†ã€æ•°æ®æ ¡éªŒã€æ•£åˆ—å‡½æ•°ã€è´Ÿè½½å‡è¡¡ã€æ•°æ®åˆ†ç‰‡ã€åˆ†å¸ƒå¼å­˜å‚¨ã€‚\n\n### åº”ç”¨ä¸€ï¼šå®‰å…¨åŠ å¯†\n\næœ€å¸¸ç”¨äºåŠ å¯†çš„å“ˆå¸Œç®—æ³•æ˜¯ MD5ï¼ˆMD5 Message-Digest Algorithmï¼ŒMD5 æ¶ˆæ¯æ‘˜è¦ç®—æ³•ï¼‰å’Œ SHAï¼ˆSecure Hash Algorithmï¼Œå®‰å…¨æ•£åˆ—ç®—æ³•ï¼‰ã€‚é™¤äº†è¿™ä¸¤ä¸ªä¹‹å¤–ï¼Œå½“ç„¶è¿˜æœ‰å¾ˆå¤šå…¶ä»–åŠ å¯†ç®—æ³•ï¼Œæ¯”å¦‚ DESï¼ˆData Encryption Standardï¼Œæ•°æ®åŠ å¯†æ ‡å‡†ï¼‰ã€AESï¼ˆAdvanced Encryption Standardï¼Œé«˜çº§åŠ å¯†æ ‡å‡†ï¼‰ã€‚\n\nå‰é¢æˆ‘è®²åˆ°çš„å“ˆå¸Œç®—æ³•å››ç‚¹è¦æ±‚ï¼Œå¯¹ç”¨äºåŠ å¯†çš„å“ˆå¸Œç®—æ³•æ¥è¯´ï¼Œæœ‰ä¸¤ç‚¹æ ¼å¤–é‡è¦ã€‚ç¬¬ä¸€ç‚¹æ˜¯å¾ˆéš¾æ ¹æ®å“ˆå¸Œå€¼åå‘æ¨å¯¼å‡ºåŸå§‹æ•°æ®ï¼Œç¬¬äºŒç‚¹æ˜¯æ•£åˆ—å†²çªçš„æ¦‚ç‡è¦å¾ˆå°ã€‚\n\næœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œå“ˆå¸Œç®—æ³•æ— æ³•åšåˆ°é›¶å†²çªã€‚å“ˆå¸Œç®—æ³•äº§ç”Ÿçš„å“ˆå¸Œå€¼çš„é•¿åº¦æ˜¯å›ºå®šä¸”æœ‰é™çš„ã€‚æ¯”å¦‚å‰é¢ä¸¾çš„ MD5 çš„ä¾‹å­ï¼Œå“ˆå¸Œå€¼æ˜¯å›ºå®šçš„ 128 ä½äºŒè¿›åˆ¶ä¸²ï¼Œèƒ½è¡¨ç¤ºçš„æ•°æ®æ˜¯æœ‰é™çš„ï¼Œæœ€å¤šèƒ½è¡¨ç¤º 2^128 ä¸ªæ•°æ®ï¼Œè€Œæˆ‘ä»¬è¦å“ˆå¸Œçš„æ•°æ®æ˜¯æ— ç©·çš„ã€‚åŸºäºé¸½å·¢åŸç†ï¼Œå¦‚æœæˆ‘ä»¬å¯¹ 2^128+1 ä¸ªæ•°æ®æ±‚å“ˆå¸Œå€¼ï¼Œå°±å¿…ç„¶ä¼šå­˜åœ¨å“ˆå¸Œå€¼ç›¸åŒçš„æƒ…å†µã€‚è¿™é‡Œä½ åº”è¯¥èƒ½æƒ³åˆ°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå“ˆå¸Œå€¼è¶Šé•¿çš„å“ˆå¸Œç®—æ³•ï¼Œæ•£åˆ—å†²çªçš„æ¦‚ç‡è¶Šä½ã€‚\n\nä¸è¿‡ï¼Œå³ä¾¿å“ˆå¸Œç®—æ³•å­˜åœ¨æ•£åˆ—å†²çªçš„æƒ…å†µï¼Œä½†æ˜¯å› ä¸ºå“ˆå¸Œå€¼çš„èŒƒå›´å¾ˆå¤§ï¼Œå†²çªçš„æ¦‚ç‡æä½ï¼Œæ‰€ä»¥ç›¸å¯¹æ¥è¯´è¿˜æ˜¯å¾ˆéš¾ç ´è§£çš„ã€‚åƒ MD5ï¼Œæœ‰ 2^128 ä¸ªä¸åŒçš„å“ˆå¸Œå€¼ï¼Œè¿™ä¸ªæ•°æ®å·²ç»æ˜¯ä¸€ä¸ªå¤©æ–‡æ•°å­—äº†ï¼Œæ‰€ä»¥æ•£åˆ—å†²çªçš„æ¦‚ç‡è¦å°äº 1/2^128ã€‚\n\n### åº”ç”¨äºŒï¼šå”¯ä¸€æ ‡è¯†\n\nå¦‚æœè¦åœ¨æµ·é‡çš„å›¾åº“ä¸­ï¼Œæœç´¢ä¸€å¼ å›¾æ˜¯å¦å­˜åœ¨ï¼Œæˆ‘ä»¬ä¸èƒ½å•çº¯åœ°ç”¨å›¾ç‰‡çš„å…ƒä¿¡æ¯ï¼ˆæ¯”å¦‚å›¾ç‰‡åç§°ï¼‰æ¥æ¯”å¯¹ï¼Œå› ä¸ºæœ‰å¯èƒ½å­˜åœ¨åç§°ç›¸åŒä½†å›¾ç‰‡å†…å®¹ä¸åŒï¼Œæˆ–è€…åç§°ä¸åŒå›¾ç‰‡å†…å®¹ç›¸åŒçš„æƒ…å†µã€‚é‚£æˆ‘ä»¬è¯¥å¦‚ä½•æœç´¢å‘¢ï¼Ÿ\n\næˆ‘ä»¬å¯ä»¥ç»™æ¯ä¸€ä¸ªå›¾ç‰‡å–ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ï¼Œæˆ–è€…è¯´ä¿¡æ¯æ‘˜è¦ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä»å›¾ç‰‡çš„äºŒè¿›åˆ¶ç ä¸²å¼€å¤´å– 100 ä¸ªå­—èŠ‚ï¼Œä»ä¸­é—´å– 100 ä¸ªå­—èŠ‚ï¼Œä»æœ€åå†å– 100 ä¸ªå­—èŠ‚ï¼Œç„¶åå°†è¿™ 300 ä¸ªå­—èŠ‚æ”¾åˆ°ä¸€å—ï¼Œé€šè¿‡å“ˆå¸Œç®—æ³•ï¼ˆæ¯”å¦‚ MD5ï¼‰ï¼Œå¾—åˆ°ä¸€ä¸ªå“ˆå¸Œå­—ç¬¦ä¸²ï¼Œç”¨å®ƒä½œä¸ºå›¾ç‰‡çš„å”¯ä¸€æ ‡è¯†ã€‚é€šè¿‡è¿™ä¸ªå”¯ä¸€æ ‡è¯†æ¥åˆ¤å®šå›¾ç‰‡æ˜¯å¦åœ¨å›¾åº“ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘å¾ˆå¤šå·¥ä½œé‡ã€‚\n\n### åº”ç”¨ä¸‰ï¼šæ•°æ®æ ¡éªŒ\n\nç½‘ç»œä¼ è¾“æ˜¯ä¸å®‰å…¨çš„ï¼Œä¸‹è½½çš„æ–‡ä»¶å—æœ‰å¯èƒ½æ˜¯è¢«å®¿ä¸»æœºå™¨æ¶æ„ä¿®æ”¹è¿‡çš„ï¼Œåˆæˆ–è€…ä¸‹è½½è¿‡ç¨‹ä¸­å‡ºç°äº†é”™è¯¯ï¼Œæ‰€ä»¥ä¸‹è½½çš„æ–‡ä»¶å—å¯èƒ½ä¸æ˜¯å®Œæ•´çš„ã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰èƒ½åŠ›æ£€æµ‹è¿™ç§æ¶æ„ä¿®æ”¹æˆ–è€…æ–‡ä»¶ä¸‹è½½å‡ºé”™ï¼Œå°±ä¼šå¯¼è‡´æœ€ç»ˆåˆå¹¶åçš„ç”µå½±æ— æ³•è§‚çœ‹ï¼Œç”šè‡³å¯¼è‡´ç”µè„‘ä¸­æ¯’ã€‚ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•æ¥æ ¡éªŒæ–‡ä»¶å—çš„å®‰å…¨ã€æ­£ç¡®ã€å®Œæ•´å‘¢ï¼Ÿ\n\næˆ‘ä»¬é€šè¿‡å“ˆå¸Œç®—æ³•ï¼Œå¯¹ 100 ä¸ªæ–‡ä»¶å—åˆ†åˆ«å–å“ˆå¸Œå€¼ï¼Œå¹¶ä¸”ä¿å­˜åœ¨ç§å­æ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬åœ¨å‰é¢è®²è¿‡ï¼Œå“ˆå¸Œç®—æ³•æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå¯¹æ•°æ®å¾ˆæ•æ„Ÿã€‚åªè¦æ–‡ä»¶å—çš„å†…å®¹æœ‰ä¸€ä¸ç‚¹å„¿çš„æ”¹å˜ï¼Œæœ€åè®¡ç®—å‡ºçš„å“ˆå¸Œå€¼å°±ä¼šå®Œå…¨ä¸åŒã€‚æ‰€ä»¥ï¼Œå½“æ–‡ä»¶å—ä¸‹è½½å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›¸åŒçš„å“ˆå¸Œç®—æ³•ï¼Œå¯¹ä¸‹è½½å¥½çš„æ–‡ä»¶å—é€ä¸€æ±‚å“ˆå¸Œå€¼ï¼Œç„¶åè·Ÿç§å­æ–‡ä»¶ä¸­ä¿å­˜çš„å“ˆå¸Œå€¼æ¯”å¯¹ã€‚å¦‚æœä¸åŒï¼Œè¯´æ˜è¿™ä¸ªæ–‡ä»¶å—ä¸å®Œæ•´æˆ–è€…è¢«ç¯¡æ”¹äº†ï¼Œéœ€è¦å†é‡æ–°ä»å…¶ä»–å®¿ä¸»æœºå™¨ä¸Šä¸‹è½½è¿™ä¸ªæ–‡ä»¶å—ã€‚\n\n### åº”ç”¨å››ï¼šæ•£åˆ—å‡½æ•°\n\næ•£åˆ—å‡½æ•°æ˜¯è®¾è®¡ä¸€ä¸ªæ•£åˆ—è¡¨çš„å…³é”®ã€‚å®ƒç›´æ¥å†³å®šäº†æ•£åˆ—å†²çªçš„æ¦‚ç‡å’Œæ•£åˆ—è¡¨çš„æ€§èƒ½ã€‚ä¸è¿‡ï¼Œç›¸å¯¹å“ˆå¸Œç®—æ³•çš„å…¶ä»–åº”ç”¨ï¼Œæ•£åˆ—å‡½æ•°å¯¹äºæ•£åˆ—ç®—æ³•å†²çªçš„è¦æ±‚è¦ä½å¾ˆå¤šã€‚å³ä¾¿å‡ºç°ä¸ªåˆ«æ•£åˆ—å†²çªï¼Œåªè¦ä¸æ˜¯è¿‡äºä¸¥é‡ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡å¼€æ”¾å¯»å€æ³•æˆ–è€…é“¾è¡¨æ³•è§£å†³ã€‚\n\nä¸ä»…å¦‚æ­¤ï¼Œæ•£åˆ—å‡½æ•°å¯¹äºæ•£åˆ—ç®—æ³•è®¡ç®—å¾—åˆ°çš„å€¼ï¼Œæ˜¯å¦èƒ½åå‘è§£å¯†ä¹Ÿå¹¶ä¸å…³å¿ƒã€‚æ•£åˆ—å‡½æ•°ä¸­ç”¨åˆ°çš„æ•£åˆ—ç®—æ³•ï¼Œæ›´åŠ å…³æ³¨æ•£åˆ—åçš„å€¼æ˜¯å¦èƒ½å¹³å‡åˆ†å¸ƒï¼Œä¹Ÿå°±æ˜¯ï¼Œä¸€ç»„æ•°æ®æ˜¯å¦èƒ½å‡åŒ€åœ°æ•£åˆ—åœ¨å„ä¸ªæ§½ä¸­ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ•£åˆ—å‡½æ•°æ‰§è¡Œçš„å¿«æ…¢ï¼Œä¹Ÿä¼šå½±å“æ•£åˆ—è¡¨çš„æ€§èƒ½ï¼Œæ‰€ä»¥ï¼Œæ•£åˆ—å‡½æ•°ç”¨çš„æ•£åˆ—ç®—æ³•ä¸€èˆ¬éƒ½æ¯”è¾ƒç®€å•ï¼Œæ¯”è¾ƒè¿½æ±‚æ•ˆç‡ã€‚\n\n### åº”ç”¨äº”ï¼šè´Ÿè½½å‡è¡¡\n\næˆ‘ä»¬å¯ä»¥é€šè¿‡å“ˆå¸Œç®—æ³•ï¼Œå¯¹å®¢æˆ·ç«¯ IP åœ°å€æˆ–è€…ä¼šè¯ ID è®¡ç®—å“ˆå¸Œå€¼ï¼Œå°†å–å¾—çš„å“ˆå¸Œå€¼ä¸æœåŠ¡å™¨åˆ—è¡¨çš„å¤§å°è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œæœ€ç»ˆå¾—åˆ°çš„å€¼å°±æ˜¯åº”è¯¥è¢«è·¯ç”±åˆ°çš„æœåŠ¡å™¨ç¼–å·ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠåŒä¸€ä¸ª IP è¿‡æ¥çš„æ‰€æœ‰è¯·æ±‚ï¼Œéƒ½è·¯ç”±åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ä¸Šã€‚\n\n### åº”ç”¨å…­ï¼šæ•°æ®åˆ†ç‰‡\n\n1. **å¦‚ä½•ç»Ÿè®¡â€œæœç´¢å…³é”®è¯â€å‡ºç°çš„æ¬¡æ•°ï¼Ÿ**\n\n    å‡å¦‚æˆ‘ä»¬æœ‰ 1T çš„æ—¥å¿—æ–‡ä»¶ï¼Œè¿™é‡Œé¢è®°å½•äº†ç”¨æˆ·çš„æœç´¢å…³é”®è¯ï¼Œæˆ‘ä»¬æƒ³è¦å¿«é€Ÿç»Ÿè®¡å‡ºæ¯ä¸ªå…³é”®è¯è¢«æœç´¢çš„æ¬¡æ•°ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜æœ‰ä¸¤ä¸ªéš¾ç‚¹ï¼Œç¬¬ä¸€ä¸ªæ˜¯æœç´¢æ—¥å¿—å¾ˆå¤§ï¼Œæ²¡åŠæ³•æ”¾åˆ°ä¸€å°æœºå™¨çš„å†…å­˜ä¸­ã€‚ç¬¬äºŒä¸ªéš¾ç‚¹æ˜¯ï¼Œå¦‚æœåªç”¨ä¸€å°æœºå™¨æ¥å¤„ç†è¿™ä¹ˆå·¨å¤§çš„æ•°æ®ï¼Œå¤„ç†æ—¶é—´ä¼šå¾ˆé•¿ã€‚\n\n    é’ˆå¯¹è¿™ä¸¤ä¸ªéš¾ç‚¹ï¼Œ**æˆ‘ä»¬å¯ä»¥å…ˆå¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œç„¶åé‡‡ç”¨å¤šå°æœºå™¨å¤„ç†çš„æ–¹æ³•ï¼Œæ¥æé«˜å¤„ç†é€Ÿåº¦ã€‚**å…·ä½“çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼šä¸ºäº†æé«˜å¤„ç†çš„é€Ÿåº¦ï¼Œæˆ‘ä»¬ç”¨ n å°æœºå™¨å¹¶è¡Œå¤„ç†ã€‚æˆ‘ä»¬ä»æœç´¢è®°å½•çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œä¾æ¬¡è¯»å‡ºæ¯ä¸ªæœç´¢å…³é”®è¯ï¼Œå¹¶ä¸”é€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—å“ˆå¸Œå€¼ï¼Œç„¶åå†è·Ÿ n å–æ¨¡ï¼Œæœ€ç»ˆå¾—åˆ°çš„å€¼ï¼Œå°±æ˜¯åº”è¯¥è¢«åˆ†é…åˆ°çš„æœºå™¨ç¼–å·ã€‚\n\n    è¿™æ ·ï¼Œå“ˆå¸Œå€¼ç›¸åŒçš„æœç´¢å…³é”®è¯å°±è¢«åˆ†é…åˆ°äº†åŒä¸€ä¸ªæœºå™¨ä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒä¸€ä¸ªæœç´¢å…³é”®è¯ä¼šè¢«åˆ†é…åˆ°åŒä¸€ä¸ªæœºå™¨ä¸Šã€‚æ¯ä¸ªæœºå™¨ä¼šåˆ†åˆ«è®¡ç®—å…³é”®è¯å‡ºç°çš„æ¬¡æ•°ï¼Œæœ€ååˆå¹¶èµ·æ¥å°±æ˜¯æœ€ç»ˆçš„ç»“æœã€‚\n\n2. **å¦‚ä½•å¿«é€Ÿåˆ¤æ–­å›¾ç‰‡æ˜¯å¦åœ¨å›¾åº“ä¸­ï¼Ÿ**\n\n    å‡è®¾ç°åœ¨æˆ‘ä»¬çš„å›¾åº“ä¸­æœ‰ 1 äº¿å¼ å›¾ç‰‡ï¼Œå¾ˆæ˜¾ç„¶ï¼Œåœ¨å•å°æœºå™¨ä¸Šæ„å»ºæ•£åˆ—è¡¨æ˜¯è¡Œä¸é€šçš„ã€‚å› ä¸ºå•å°æœºå™¨çš„å†…å­˜æœ‰é™ï¼Œè€Œ 1 äº¿å¼ å›¾ç‰‡æ„å»ºæ•£åˆ—è¡¨æ˜¾ç„¶è¿œè¿œè¶…è¿‡äº†å•å°æœºå™¨çš„å†…å­˜ä¸Šé™ã€‚\n\n    æˆ‘ä»¬åŒæ ·å¯ä»¥å¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œç„¶åé‡‡ç”¨å¤šæœºå¤„ç†ã€‚æˆ‘ä»¬å‡†å¤‡ n å°æœºå™¨ï¼Œè®©æ¯å°æœºå™¨åªç»´æŠ¤æŸä¸€éƒ¨åˆ†å›¾ç‰‡å¯¹åº”çš„æ•£åˆ—è¡¨ã€‚æˆ‘ä»¬æ¯æ¬¡ä»å›¾åº“ä¸­è¯»å–ä¸€ä¸ªå›¾ç‰‡ï¼Œè®¡ç®—å”¯ä¸€æ ‡è¯†ï¼Œç„¶åä¸æœºå™¨ä¸ªæ•° n æ±‚ä½™å–æ¨¡ï¼Œå¾—åˆ°çš„å€¼å°±å¯¹åº”è¦åˆ†é…çš„æœºå™¨ç¼–å·ï¼Œç„¶åå°†è¿™ä¸ªå›¾ç‰‡çš„å”¯ä¸€æ ‡è¯†å’Œå›¾ç‰‡è·¯å¾„å‘å¾€å¯¹åº”çš„æœºå™¨æ„å»ºæ•£åˆ—è¡¨ã€‚\n\n    å½“æˆ‘ä»¬è¦åˆ¤æ–­ä¸€ä¸ªå›¾ç‰‡æ˜¯å¦åœ¨å›¾åº“ä¸­çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šè¿‡åŒæ ·çš„å“ˆå¸Œç®—æ³•ï¼Œè®¡ç®—è¿™ä¸ªå›¾ç‰‡çš„å”¯ä¸€æ ‡è¯†ï¼Œç„¶åä¸æœºå™¨ä¸ªæ•° n æ±‚ä½™å–æ¨¡ã€‚å‡è®¾å¾—åˆ°çš„å€¼æ˜¯ kï¼Œé‚£å°±å»ç¼–å· k çš„æœºå™¨æ„å»ºçš„æ•£åˆ—è¡¨ä¸­æŸ¥æ‰¾ã€‚\n\n\n### åº”ç”¨ä¸ƒï¼šåˆ†å¸ƒå¼å­˜å‚¨\n\nç°åœ¨äº’è”ç½‘é¢å¯¹çš„éƒ½æ˜¯æµ·é‡çš„æ•°æ®ã€æµ·é‡çš„ç”¨æˆ·ã€‚æˆ‘ä»¬ä¸ºäº†æé«˜æ•°æ®çš„è¯»å–ã€å†™å…¥èƒ½åŠ›ï¼Œä¸€èˆ¬éƒ½é‡‡ç”¨åˆ†å¸ƒå¼çš„æ–¹å¼æ¥å­˜å‚¨æ•°æ®ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼ç¼“å­˜ã€‚æˆ‘ä»¬æœ‰æµ·é‡çš„æ•°æ®éœ€è¦ç¼“å­˜ï¼Œæ‰€ä»¥ä¸€ä¸ªç¼“å­˜æœºå™¨è‚¯å®šæ˜¯ä¸å¤Ÿçš„ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å°±éœ€è¦å°†æ•°æ®åˆ†å¸ƒåœ¨å¤šå°æœºå™¨ä¸Šã€‚\n\nè¯¥å¦‚ä½•å†³å®šå°†å“ªä¸ªæ•°æ®æ”¾åˆ°å“ªä¸ªæœºå™¨ä¸Šå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å€Ÿç”¨å‰é¢æ•°æ®åˆ†ç‰‡çš„æ€æƒ³ï¼Œå³é€šè¿‡å“ˆå¸Œç®—æ³•å¯¹æ•°æ®å–å“ˆå¸Œå€¼ï¼Œç„¶åå¯¹æœºå™¨ä¸ªæ•°å–æ¨¡ï¼Œè¿™ä¸ªæœ€ç»ˆå€¼å°±æ˜¯åº”è¯¥å­˜å‚¨çš„ç¼“å­˜æœºå™¨ç¼–å·ã€‚\n\nä½†æ·»åŠ æ–°çš„æœºå™¨ä¼šå¯¼è‡´æ‰€æœ‰çš„æ•°æ®éƒ½è¦é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼Œç„¶åé‡æ–°æ¬ç§»åˆ°æ­£ç¡®çš„æœºå™¨ä¸Šã€‚è¿™æ ·å°±ç›¸å½“äºï¼Œç¼“å­˜ä¸­çš„æ•°æ®ä¸€ä¸‹å­å°±éƒ½å¤±æ•ˆäº†ã€‚æ‰€æœ‰çš„æ•°æ®è¯·æ±‚éƒ½ä¼šç©¿é€ç¼“å­˜ï¼Œç›´æ¥å»è¯·æ±‚æ•°æ®åº“ã€‚è¿™æ ·å°±å¯èƒ½å‘ç”Ÿé›ªå´©æ•ˆåº”ï¼Œå‹å®æ•°æ®åº“ã€‚\n\næ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•ï¼Œä½¿å¾—åœ¨æ–°åŠ å…¥ä¸€ä¸ªæœºå™¨åï¼Œå¹¶ä¸éœ€è¦åšå¤§é‡çš„æ•°æ®æ¬ç§»ã€‚è¿™æ—¶å€™ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å°±è¦ç™»åœºäº†ã€‚\n\n## æ·±åº¦å’Œå¹¿åº¦ä¼˜å…ˆæœç´¢\n\n### ä»€ä¹ˆæ˜¯â€œæœç´¢â€ç®—æ³•ï¼Ÿ\n\nç®—æ³•æ˜¯ä½œç”¨äºå…·ä½“æ•°æ®ç»“æ„ä¹‹ä¸Šçš„ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•å’Œå¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³•éƒ½æ˜¯åŸºäºâ€œå›¾â€è¿™ç§æ•°æ®ç»“æ„çš„ã€‚è¿™æ˜¯å› ä¸ºï¼Œå›¾è¿™ç§æ•°æ®ç»“æ„çš„è¡¨è¾¾èƒ½åŠ›å¾ˆå¼ºï¼Œå¤§éƒ¨åˆ†æ¶‰åŠæœç´¢çš„åœºæ™¯éƒ½å¯ä»¥æŠ½è±¡æˆâ€œå›¾â€ã€‚\n\n### å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰\n\nå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBreadth-First-Searchï¼‰ï¼Œæˆ‘ä»¬å¹³å¸¸éƒ½ç®€ç§° BFSã€‚ç›´è§‚åœ°è®²ï¼Œå®ƒå…¶å®å°±æ˜¯ä¸€ç§â€œåœ°æ¯¯å¼â€å±‚å±‚æ¨è¿›çš„æœç´¢ç­–ç•¥ï¼Œå³å…ˆæŸ¥æ‰¾ç¦»èµ·å§‹é¡¶ç‚¹æœ€è¿‘çš„ï¼Œç„¶åæ˜¯æ¬¡è¿‘çš„ï¼Œä¾æ¬¡å¾€å¤–æœç´¢ã€‚\n\n![Untitled](Extras/Images/alg_79.png)\n\n### æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰\n\næ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDepth-First-Searchï¼‰ï¼Œç®€ç§° DFSã€‚æœ€ç›´è§‚çš„ä¾‹å­å°±æ˜¯â€œèµ°è¿·å®«â€ã€‚\n\nå‡è®¾ä½ ç«™åœ¨è¿·å®«çš„æŸä¸ªå²”è·¯å£ï¼Œç„¶åæƒ³æ‰¾åˆ°å‡ºå£ã€‚ä½ éšæ„é€‰æ‹©ä¸€ä¸ªå²”è·¯å£æ¥èµ°ï¼Œèµ°ç€èµ°ç€å‘ç°èµ°ä¸é€šçš„æ—¶å€™ï¼Œä½ å°±å›é€€åˆ°ä¸Šä¸€ä¸ªå²”è·¯å£ï¼Œé‡æ–°é€‰æ‹©ä¸€æ¡è·¯ç»§ç»­èµ°ï¼Œç›´åˆ°æœ€ç»ˆæ‰¾åˆ°å‡ºå£ã€‚è¿™ç§èµ°æ³•å°±æ˜¯ä¸€ç§æ·±åº¦ä¼˜å…ˆæœç´¢ç­–ç•¥ã€‚\n\næœç´¢çš„èµ·å§‹é¡¶ç‚¹æ˜¯ sï¼Œç»ˆæ­¢é¡¶ç‚¹æ˜¯ tï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨å›¾ä¸­å¯»æ‰¾ä¸€æ¡ä»é¡¶ç‚¹ s åˆ°é¡¶ç‚¹ t çš„è·¯å¾„ã€‚è¿™é‡Œé¢å®çº¿ç®­å¤´è¡¨ç¤ºéå†ï¼Œè™šçº¿ç®­å¤´è¡¨ç¤ºå›é€€ã€‚ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢æ‰¾å‡ºæ¥çš„è·¯å¾„ï¼Œå¹¶ä¸æ˜¯é¡¶ç‚¹ s åˆ°é¡¶ç‚¹ t çš„æœ€çŸ­è·¯å¾„ã€‚\n\n![Untitled](Extras/Images/alg_80.png)\n\n## **è´ªå¿ƒç®—æ³•**\n\n### å¦‚ä½•ç†è§£â€œè´ªå¿ƒç®—æ³•â€ï¼Ÿ\n\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¯ä»¥å®¹çº³ 100kg ç‰©å“çš„èƒŒåŒ…ï¼Œå¯ä»¥è£…å„ç§ç‰©å“ã€‚æˆ‘ä»¬æœ‰ä»¥ä¸‹ 5 ç§è±†å­ï¼Œæ¯ç§è±†å­çš„æ€»é‡å’Œæ€»ä»·å€¼éƒ½å„ä¸ç›¸åŒã€‚ä¸ºäº†è®©èƒŒåŒ…ä¸­æ‰€è£…ç‰©å“çš„æ€»ä»·å€¼æœ€å¤§ï¼Œæˆ‘ä»¬å¦‚ä½•é€‰æ‹©åœ¨èƒŒåŒ…ä¸­è£…å“ªäº›è±†å­ï¼Ÿæ¯ç§è±†å­åˆè¯¥è£…å¤šå°‘å‘¢ï¼Ÿ\n\n![Untitled](Extras/Images/alg_81.png)\n\nå®é™…ä¸Šï¼Œè¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œæˆ‘ä¼°è®¡ä½ ä¸€ä¸‹å­å°±èƒ½æƒ³å‡ºæ¥ï¼Œæ²¡é”™ï¼Œæˆ‘ä»¬åªè¦å…ˆç®—ä¸€ç®—æ¯ä¸ªç‰©å“çš„å•ä»·ï¼ŒæŒ‰ç…§å•ä»·ç”±é«˜åˆ°ä½ä¾æ¬¡æ¥è£…å°±å¥½äº†ã€‚å•ä»·ä»é«˜åˆ°ä½æ’åˆ—ï¼Œä¾æ¬¡æ˜¯ï¼šé»‘è±†ã€ç»¿è±†ã€çº¢è±†ã€é’è±†ã€é»„è±†ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å¾€èƒŒåŒ…é‡Œè£… 20kg é»‘è±†ã€30kg ç»¿è±†ã€50kg çº¢è±†ã€‚\n\nè¿™ä¸ªé—®é¢˜çš„è§£å†³æ€è·¯æ˜¾è€Œæ˜“è§ï¼Œå®ƒæœ¬è´¨ä¸Šå€ŸåŠ©çš„å°±æ˜¯è´ªå¿ƒç®—æ³•ã€‚ç„¶è€Œï¼Œç”¨è´ªå¿ƒç®—æ³•è§£å†³é—®é¢˜çš„æ€è·¯ï¼Œå¹¶ä¸æ€»èƒ½ç»™å‡ºæœ€ä¼˜è§£ã€‚\n\næˆ‘æ¥ä¸¾ä¸€ä¸ªä¾‹å­ã€‚åœ¨ä¸€ä¸ªæœ‰æƒå›¾ä¸­ï¼Œæˆ‘ä»¬ä»é¡¶ç‚¹ S å¼€å§‹ï¼Œæ‰¾ä¸€æ¡åˆ°é¡¶ç‚¹ T çš„æœ€çŸ­è·¯å¾„ï¼ˆè·¯å¾„ä¸­è¾¹çš„æƒå€¼å’Œæœ€å°ï¼‰ã€‚è´ªå¿ƒç®—æ³•çš„è§£å†³æ€è·¯æ˜¯ï¼Œæ¯æ¬¡éƒ½é€‰æ‹©ä¸€æ¡è·Ÿå½“å‰é¡¶ç‚¹ç›¸è¿çš„æƒæœ€å°çš„è¾¹ï¼Œç›´åˆ°æ‰¾åˆ°é¡¶ç‚¹ Tã€‚æŒ‰ç…§è¿™ç§æ€è·¯ï¼Œæˆ‘ä»¬æ±‚å‡ºçš„æœ€çŸ­è·¯å¾„æ˜¯ S-\u003eA-\u003eE-\u003eTï¼Œè·¯å¾„é•¿åº¦æ˜¯ 1+4+4=9ã€‚\n\n![Untitled](Extras/Images/alg_82.png)\n\nä½†æ˜¯ï¼Œè¿™ç§è´ªå¿ƒçš„é€‰æ‹©æ–¹å¼ï¼Œæœ€ç»ˆæ±‚çš„è·¯å¾„å¹¶ä¸æ˜¯æœ€çŸ­è·¯å¾„ï¼Œå› ä¸ºè·¯å¾„ S-\u003eB-\u003eD-\u003eT æ‰æ˜¯æœ€çŸ­è·¯å¾„ï¼Œå› ä¸ºè¿™æ¡è·¯å¾„çš„é•¿åº¦æ˜¯ 2+2+2=6ã€‚ä¸ºä»€ä¹ˆè´ªå¿ƒç®—æ³•åœ¨è¿™ä¸ªé—®é¢˜ä¸Šä¸å·¥ä½œäº†å‘¢ï¼Ÿ\n\nåœ¨è¿™ä¸ªé—®é¢˜ä¸Šï¼Œè´ªå¿ƒç®—æ³•ä¸å·¥ä½œçš„ä¸»è¦åŸå› æ˜¯ï¼Œå‰é¢çš„é€‰æ‹©ï¼Œä¼šå½±å“åé¢çš„é€‰æ‹©ã€‚å¦‚æœæˆ‘ä»¬ç¬¬ä¸€æ­¥ä»é¡¶ç‚¹ S èµ°åˆ°é¡¶ç‚¹ Aï¼Œé‚£æ¥ä¸‹æ¥é¢å¯¹çš„é¡¶ç‚¹å’Œè¾¹ï¼Œè·Ÿç¬¬ä¸€æ­¥ä»é¡¶ç‚¹ S èµ°åˆ°é¡¶ç‚¹ Bï¼Œæ˜¯å®Œå…¨ä¸åŒçš„ã€‚æ‰€ä»¥ï¼Œå³ä¾¿æˆ‘ä»¬ç¬¬ä¸€æ­¥é€‰æ‹©æœ€ä¼˜çš„èµ°æ³•ï¼ˆè¾¹æœ€çŸ­ï¼‰ï¼Œä½†æœ‰å¯èƒ½å› ä¸ºè¿™ä¸€æ­¥é€‰æ‹©ï¼Œå¯¼è‡´åé¢æ¯ä¸€æ­¥çš„é€‰æ‹©éƒ½å¾ˆç³Ÿç³•ï¼Œæœ€ç»ˆä¹Ÿå°±æ— ç¼˜å…¨å±€æœ€ä¼˜è§£äº†ã€‚\n\n### **åˆ†æ²»ç®—æ³•**\n\n### å¦‚ä½•ç†è§£åˆ†æ²»ç®—æ³•ï¼Ÿ\n\nMapRedue çš„æœ¬è´¨å°±æ˜¯åˆ†æ²»ç®—æ³•ã€‚\n\nåˆ†æ²»ç®—æ³•ï¼ˆdivide and conquerï¼‰çš„æ ¸å¿ƒæ€æƒ³å…¶å®å°±æ˜¯å››ä¸ªå­—ï¼Œåˆ†è€Œæ²»ä¹‹ ï¼Œä¹Ÿå°±æ˜¯å°†åŸé—®é¢˜åˆ’åˆ†æˆ n ä¸ªè§„æ¨¡è¾ƒå°ï¼Œå¹¶ä¸”ç»“æ„ä¸åŸé—®é¢˜ç›¸ä¼¼çš„å­é—®é¢˜ï¼Œé€’å½’åœ°è§£å†³è¿™äº›å­é—®é¢˜ï¼Œç„¶åå†åˆå¹¶å…¶ç»“æœï¼Œå°±å¾—åˆ°åŸé—®é¢˜çš„è§£ã€‚\n\nè¿™ä¸ªå®šä¹‰çœ‹èµ·æ¥æœ‰ç‚¹ç±»ä¼¼é€’å½’çš„å®šä¹‰ã€‚å…³äºåˆ†æ²»å’Œé€’å½’çš„åŒºåˆ«ï¼Œæˆ‘ä»¬åœ¨æ’åºçš„æ—¶å€™è®²è¿‡ï¼Œ**åˆ†æ²»ç®—æ³•æ˜¯ä¸€ç§å¤„ç†é—®é¢˜çš„æ€æƒ³ï¼Œé€’å½’æ˜¯ä¸€ç§ç¼–ç¨‹æŠ€å·§**ã€‚å®é™…ä¸Šï¼Œåˆ†æ²»ç®—æ³•ä¸€èˆ¬éƒ½æ¯”è¾ƒé€‚åˆç”¨é€’å½’æ¥å®ç°ã€‚åˆ†æ²»ç®—æ³•çš„é€’å½’å®ç°ä¸­ï¼Œæ¯ä¸€å±‚é€’å½’éƒ½ä¼šæ¶‰åŠè¿™æ ·ä¸‰ä¸ªæ“ä½œï¼š\n\n- åˆ†è§£ï¼šå°†åŸé—®é¢˜åˆ†è§£æˆä¸€ç³»åˆ—å­é—®é¢˜ï¼›\n- è§£å†³ï¼šé€’å½’åœ°æ±‚è§£å„ä¸ªå­é—®é¢˜ï¼Œè‹¥å­é—®é¢˜è¶³å¤Ÿå°ï¼Œåˆ™ç›´æ¥æ±‚è§£ï¼›\n- åˆå¹¶ï¼šå°†å­é—®é¢˜çš„ç»“æœåˆå¹¶æˆåŸé—®é¢˜ã€‚\n\nåˆ†æ²»ç®—æ³•èƒ½è§£å†³çš„é—®é¢˜ï¼Œä¸€èˆ¬éœ€è¦æ»¡è¶³ä¸‹é¢è¿™å‡ ä¸ªæ¡ä»¶ï¼š\n\n- åŸé—®é¢˜ä¸åˆ†è§£æˆçš„å°é—®é¢˜å…·æœ‰ç›¸åŒçš„æ¨¡å¼ï¼›\n- åŸé—®é¢˜åˆ†è§£æˆçš„å­é—®é¢˜å¯ä»¥ç‹¬ç«‹æ±‚è§£ï¼Œå­é—®é¢˜ä¹‹é—´æ²¡æœ‰ç›¸å…³æ€§ï¼Œè¿™ä¸€ç‚¹æ˜¯åˆ†æ²»ç®—æ³•è·ŸåŠ¨æ€è§„åˆ’çš„æ˜æ˜¾åŒºåˆ«ï¼Œç­‰æˆ‘ä»¬è®²åˆ°åŠ¨æ€è§„åˆ’çš„æ—¶å€™ï¼Œä¼šè¯¦ç»†å¯¹æ¯”è¿™ä¸¤ç§ç®—æ³•ï¼›\n- å…·æœ‰åˆ†è§£ç»ˆæ­¢æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“é—®é¢˜è¶³å¤Ÿå°æ—¶ï¼Œå¯ä»¥ç›´æ¥æ±‚è§£ï¼›\n- å¯ä»¥å°†å­é—®é¢˜åˆå¹¶æˆåŸé—®é¢˜ï¼Œè€Œè¿™ä¸ªåˆå¹¶æ“ä½œçš„å¤æ‚åº¦ä¸èƒ½å¤ªé«˜ï¼Œå¦åˆ™å°±èµ·ä¸åˆ°å‡å°ç®—æ³•æ€»ä½“å¤æ‚åº¦çš„æ•ˆæœäº†ã€‚\n\n### åˆ†æ²»æ€æƒ³åœ¨æµ·é‡æ•°æ®å¤„ç†ä¸­çš„åº”ç”¨\n\næ¯”å¦‚ï¼Œç»™ 10GB çš„è®¢å•æ–‡ä»¶æŒ‰ç…§é‡‘é¢æ’åºè¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼Œçœ‹ä¼¼æ˜¯ä¸€ä¸ªç®€å•çš„æ’åºé—®é¢˜ï¼Œä½†æ˜¯å› ä¸ºæ•°æ®é‡å¤§ï¼Œæœ‰ 10GBï¼Œè€Œæˆ‘ä»¬çš„æœºå™¨çš„å†…å­˜å¯èƒ½åªæœ‰ 2ã€3GB è¿™æ ·å­ï¼Œæ— æ³•ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ï¼Œä¹Ÿå°±æ— æ³•é€šè¿‡å•çº¯åœ°ä½¿ç”¨å¿«æ’ã€å½’å¹¶ç­‰åŸºç¡€ç®—æ³•æ¥è§£å†³äº†ã€‚\n\nè¦è§£å†³è¿™ç§æ•°æ®é‡å¤§åˆ°å†…å­˜è£…ä¸ä¸‹çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨åˆ†æ²»çš„æ€æƒ³ã€‚æˆ‘ä»¬å¯ä»¥å°†æµ·é‡çš„æ•°æ®é›†åˆæ ¹æ®æŸç§æ–¹æ³•ï¼Œåˆ’åˆ†ä¸ºå‡ ä¸ªå°çš„æ•°æ®é›†åˆï¼Œæ¯ä¸ªå°çš„æ•°æ®é›†åˆå•ç‹¬åŠ è½½åˆ°å†…å­˜æ¥è§£å†³ï¼Œç„¶åå†å°†å°æ•°æ®é›†åˆåˆå¹¶æˆå¤§æ•°æ®é›†åˆã€‚å®é™…ä¸Šï¼Œåˆ©ç”¨è¿™ç§åˆ†æ²»çš„å¤„ç†æ€è·¯ï¼Œä¸ä»…ä»…èƒ½å…‹æœå†…å­˜çš„é™åˆ¶ï¼Œè¿˜èƒ½åˆ©ç”¨å¤šçº¿ç¨‹æˆ–è€…å¤šæœºå¤„ç†ï¼ŒåŠ å¿«å¤„ç†çš„é€Ÿåº¦ã€‚\n\n## **å›æº¯ç®—æ³•**\n\n### å¦‚ä½•ç†è§£â€œå›æº¯ç®—æ³•â€ï¼Ÿ\n\nç¬¼ç»Ÿåœ°è®²ï¼Œå›æº¯ç®—æ³•å¾ˆå¤šæ—¶å€™éƒ½åº”ç”¨åœ¨â€œæœç´¢â€è¿™ç±»é—®é¢˜ä¸Šã€‚ä¸è¿‡è¿™é‡Œè¯´çš„æœç´¢ï¼Œå¹¶ä¸æ˜¯ç‹­ä¹‰çš„æŒ‡æˆ‘ä»¬å‰é¢è®²è¿‡çš„å›¾çš„æœç´¢ç®—æ³•ï¼Œè€Œæ˜¯åœ¨ä¸€ç»„å¯èƒ½çš„è§£ä¸­ï¼Œæœç´¢æ»¡è¶³æœŸæœ›çš„è§£ã€‚\n\nå›æº¯çš„å¤„ç†æ€æƒ³ï¼Œæœ‰ç‚¹ç±»ä¼¼æšä¸¾æœç´¢ã€‚æˆ‘ä»¬æšä¸¾æ‰€æœ‰çš„è§£ï¼Œæ‰¾åˆ°æ»¡è¶³æœŸæœ›çš„è§£ã€‚ä¸ºäº†æœ‰è§„å¾‹åœ°æšä¸¾æ‰€æœ‰å¯èƒ½çš„è§£ï¼Œé¿å…é—æ¼å’Œé‡å¤ï¼Œæˆ‘ä»¬æŠŠé—®é¢˜æ±‚è§£çš„è¿‡ç¨‹åˆ†ä¸ºå¤šä¸ªé˜¶æ®µã€‚æ¯ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬éƒ½ä¼šé¢å¯¹ä¸€ä¸ªå²”è·¯å£ï¼Œæˆ‘ä»¬å…ˆéšæ„é€‰ä¸€æ¡è·¯èµ°ï¼Œå½“å‘ç°è¿™æ¡è·¯èµ°ä¸é€šçš„æ—¶å€™ï¼ˆä¸ç¬¦åˆæœŸæœ›çš„è§£ï¼‰ï¼Œå°±å›é€€åˆ°ä¸Šä¸€ä¸ªå²”è·¯å£ï¼Œå¦é€‰ä¸€ç§èµ°æ³•ç»§ç»­èµ°ã€‚\n\nå›æº¯ç®—æ³•çš„æ€æƒ³éå¸¸ç®€å•ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ç”¨æ¥è§£å†³å¹¿ä¹‰çš„æœç´¢é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ï¼Œä»ä¸€ç»„å¯èƒ½çš„è§£ä¸­ï¼Œé€‰æ‹©å‡ºä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„è§£ã€‚å›æº¯ç®—æ³•éå¸¸é€‚åˆç”¨é€’å½’æ¥å®ç°ï¼Œåœ¨å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œå‰ªææ“ä½œæ˜¯æé«˜å›æº¯æ•ˆç‡çš„ä¸€ç§æŠ€å·§ã€‚åˆ©ç”¨å‰ªæï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ç©·ä¸¾æœç´¢æ‰€æœ‰çš„æƒ…å†µï¼Œä»è€Œæé«˜æœç´¢æ•ˆç‡ã€‚\n\n## **åŠ¨æ€è§„åˆ’**\n\n### åˆè¯†åŠ¨æ€è§„åˆ’\n\nåŠ¨æ€è§„åˆ’æ¯”è¾ƒé€‚åˆç”¨æ¥æ±‚è§£æœ€ä¼˜é—®é¢˜ï¼Œæ¯”å¦‚æ±‚æœ€å¤§å€¼ã€æœ€å°å€¼ç­‰ç­‰ã€‚å®ƒå¯ä»¥éå¸¸æ˜¾è‘—åœ°é™ä½æ—¶é—´å¤æ‚åº¦ï¼Œæé«˜ä»£ç çš„æ‰§è¡Œæ•ˆç‡ã€‚ä¸è¿‡ï¼Œå®ƒä¹Ÿæ˜¯å‡ºäº†åçš„éš¾å­¦ã€‚å®ƒçš„ä¸»è¦å­¦ä¹ éš¾ç‚¹è·Ÿé€’å½’ç±»ä¼¼ï¼Œé‚£å°±æ˜¯ï¼Œæ±‚è§£é—®é¢˜çš„è¿‡ç¨‹ä¸å¤ªç¬¦åˆäººç±»å¸¸è§„çš„æ€ç»´æ–¹å¼ã€‚\n\næˆ‘ä»¬æŠŠé—®é¢˜åˆ†è§£ä¸ºå¤šä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µå¯¹åº”ä¸€ä¸ªå†³ç­–ã€‚æˆ‘ä»¬è®°å½•æ¯ä¸€ä¸ªé˜¶æ®µå¯è¾¾çš„çŠ¶æ€é›†åˆï¼ˆå»æ‰é‡å¤çš„ï¼‰ï¼Œç„¶åé€šè¿‡å½“å‰é˜¶æ®µçš„çŠ¶æ€é›†åˆï¼Œæ¥æ¨å¯¼ä¸‹ä¸€ä¸ªé˜¶æ®µçš„çŠ¶æ€é›†åˆï¼ŒåŠ¨æ€åœ°å¾€å‰æ¨è¿›ã€‚è¿™ä¹Ÿæ˜¯åŠ¨æ€è§„åˆ’è¿™ä¸ªåå­—çš„ç”±æ¥ã€‚\n\nå°½ç®¡åŠ¨æ€è§„åˆ’çš„æ‰§è¡Œæ•ˆç‡æ¯”è¾ƒé«˜ï¼Œä½†å¯¹ç©ºé—´çš„æ¶ˆè€—æ¯”è¾ƒå¤šã€‚æ‰€ä»¥ï¼Œæœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šè¯´ï¼ŒåŠ¨æ€è§„åˆ’æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„è§£å†³æ€è·¯ã€‚\n\n### â€œä¸€ä¸ªæ¨¡å‹ä¸‰ä¸ªç‰¹å¾â€ç†è®ºè®²è§£\n\nä»€ä¹ˆæ ·çš„é—®é¢˜é€‚åˆç”¨åŠ¨æ€è§„åˆ’æ¥è§£å†³å‘¢ï¼Ÿæ¢å¥è¯è¯´ï¼ŒåŠ¨æ€è§„åˆ’èƒ½è§£å†³çš„é—®é¢˜æœ‰ä»€ä¹ˆè§„å¾‹å¯å¾ªå‘¢ï¼Ÿå®é™…ä¸Šï¼ŒåŠ¨æ€è§„åˆ’ä½œä¸ºä¸€ä¸ªéå¸¸æˆç†Ÿçš„ç®—æ³•æ€æƒ³ï¼Œå¾ˆå¤šäººå¯¹æ­¤å·²ç»åšäº†éå¸¸å…¨é¢çš„æ€»ç»“ã€‚æˆ‘æŠŠè¿™éƒ¨åˆ†ç†è®ºæ€»ç»“ä¸ºâ€œä¸€ä¸ªæ¨¡å‹ä¸‰ä¸ªç‰¹å¾â€ã€‚\n\né¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ï¼Œä»€ä¹ˆæ˜¯â€œ**ä¸€ä¸ªæ¨¡å‹**â€ï¼Ÿå®ƒæŒ‡çš„æ˜¯åŠ¨æ€è§„åˆ’é€‚åˆè§£å†³çš„é—®é¢˜çš„æ¨¡å‹ã€‚æˆ‘æŠŠè¿™ä¸ªæ¨¡å‹å®šä¹‰ä¸ºâ€œ**å¤šé˜¶æ®µå†³ç­–æœ€ä¼˜è§£æ¨¡å‹**â€ã€‚ä¸‹é¢æˆ‘å…·ä½“æ¥ç»™ä½ è®²è®²ã€‚\n\næˆ‘ä»¬ä¸€èˆ¬æ˜¯ç”¨åŠ¨æ€è§„åˆ’æ¥è§£å†³æœ€ä¼˜é—®é¢˜ã€‚è€Œè§£å†³é—®é¢˜çš„è¿‡ç¨‹ï¼Œéœ€è¦ç»å†å¤šä¸ªå†³ç­–é˜¶æ®µã€‚æ¯ä¸ªå†³ç­–é˜¶æ®µéƒ½å¯¹åº”ç€ä¸€ç»„çŠ¶æ€ã€‚ç„¶åæˆ‘ä»¬å¯»æ‰¾ä¸€ç»„å†³ç­–åºåˆ—ï¼Œç»è¿‡è¿™ç»„å†³ç­–åºåˆ—ï¼Œèƒ½å¤Ÿäº§ç”Ÿæœ€ç»ˆæœŸæœ›æ±‚è§£çš„æœ€ä¼˜å€¼ã€‚\n\næˆ‘ä»¬å†æ¥çœ‹ï¼Œä»€ä¹ˆæ˜¯â€œ**ä¸‰ä¸ªç‰¹å¾**â€ï¼Ÿå®ƒä»¬åˆ†åˆ«æ˜¯**æœ€ä¼˜å­ç»“æ„**ã€**æ— åæ•ˆæ€§**å’Œ**é‡å¤å­é—®é¢˜**ã€‚\n\n1. **æœ€ä¼˜å­ç»“æ„**\n\n    æœ€ä¼˜å­ç»“æ„æŒ‡çš„æ˜¯ï¼Œé—®é¢˜çš„æœ€ä¼˜è§£åŒ…å«å­é—®é¢˜çš„æœ€ä¼˜è§£ã€‚åè¿‡æ¥è¯´å°±æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å­é—®é¢˜çš„æœ€ä¼˜è§£ï¼Œæ¨å¯¼å‡ºé—®é¢˜çš„æœ€ä¼˜è§£ã€‚å¦‚æœæˆ‘ä»¬æŠŠæœ€ä¼˜å­ç»“æ„ï¼Œå¯¹åº”åˆ°æˆ‘ä»¬å‰é¢å®šä¹‰çš„åŠ¨æ€è§„åˆ’é—®é¢˜æ¨¡å‹ä¸Šï¼Œé‚£æˆ‘ä»¬ä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼Œåé¢é˜¶æ®µçš„çŠ¶æ€å¯ä»¥é€šè¿‡å‰é¢é˜¶æ®µçš„çŠ¶æ€æ¨å¯¼å‡ºæ¥ã€‚\n\n2. **æ— åæ•ˆæ€§**\n\n    æ— åæ•ˆæ€§æœ‰ä¸¤å±‚å«ä¹‰ï¼Œç¬¬ä¸€å±‚å«ä¹‰æ˜¯ï¼Œåœ¨æ¨å¯¼åé¢é˜¶æ®µçš„çŠ¶æ€çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªå…³å¿ƒå‰é¢é˜¶æ®µçš„çŠ¶æ€å€¼ï¼Œä¸å…³å¿ƒè¿™ä¸ªçŠ¶æ€æ˜¯æ€ä¹ˆä¸€æ­¥ä¸€æ­¥æ¨å¯¼å‡ºæ¥çš„ã€‚ç¬¬äºŒå±‚å«ä¹‰æ˜¯ï¼ŒæŸé˜¶æ®µçŠ¶æ€ä¸€æ—¦ç¡®å®šï¼Œå°±ä¸å—ä¹‹åé˜¶æ®µçš„å†³ç­–å½±å“ã€‚æ— åæ•ˆæ€§æ˜¯ä¸€ä¸ªéå¸¸â€œå®½æ¾â€çš„è¦æ±‚ã€‚åªè¦æ»¡è¶³å‰é¢æåˆ°çš„åŠ¨æ€è§„åˆ’é—®é¢˜æ¨¡å‹ï¼Œå…¶å®åŸºæœ¬ä¸Šéƒ½ä¼šæ»¡è¶³æ— åæ•ˆæ€§ã€‚\n\n3. **é‡å¤å­é—®é¢˜**\n\n    è¿™ä¸ªæ¦‚å¿µæ¯”è¾ƒå¥½ç†è§£ã€‚å‰é¢ä¸€èŠ‚ï¼Œæˆ‘å·²ç»å¤šæ¬¡æè¿‡ã€‚å¦‚æœç”¨ä¸€å¥è¯æ¦‚æ‹¬ä¸€ä¸‹ï¼Œé‚£å°±æ˜¯ï¼Œä¸åŒçš„å†³ç­–åºåˆ—ï¼Œåˆ°è¾¾æŸä¸ªç›¸åŒçš„é˜¶æ®µæ—¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿé‡å¤çš„çŠ¶æ€ã€‚\n\n\n### ä¸¤ç§åŠ¨æ€è§„åˆ’è§£é¢˜æ€è·¯æ€»ç»“\n\n1. **çŠ¶æ€è½¬ç§»è¡¨æ³•**\n\n    ä¸€èˆ¬èƒ½ç”¨åŠ¨æ€è§„åˆ’è§£å†³çš„é—®é¢˜ï¼Œéƒ½å¯ä»¥ä½¿ç”¨å›æº¯ç®—æ³•çš„æš´åŠ›æœç´¢è§£å†³ã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬æ‹¿åˆ°é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆç”¨ç®€å•çš„å›æº¯ç®—æ³•è§£å†³ï¼Œç„¶åå®šä¹‰çŠ¶æ€ï¼Œæ¯ä¸ªçŠ¶æ€è¡¨ç¤ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶åå¯¹åº”ç”»å‡ºé€’å½’æ ‘ã€‚ä»é€’å½’æ ‘ä¸­ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ˜¯å¦å­˜åœ¨é‡å¤å­é—®é¢˜ï¼Œä»¥åŠé‡å¤å­é—®é¢˜æ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚ä»¥æ­¤æ¥å¯»æ‰¾è§„å¾‹ï¼Œçœ‹æ˜¯å¦èƒ½ç”¨åŠ¨æ€è§„åˆ’è§£å†³ã€‚\n\n    æ‰¾åˆ°é‡å¤å­é—®é¢˜ä¹‹åï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§å¤„ç†æ€è·¯ï¼Œç¬¬ä¸€ç§æ˜¯ç›´æ¥ç”¨**å›æº¯åŠ â€œå¤‡å¿˜å½•â€**çš„æ–¹æ³•ï¼Œæ¥é¿å…é‡å¤å­é—®é¢˜ã€‚ä»æ‰§è¡Œæ•ˆç‡ä¸Šæ¥è®²ï¼Œè¿™è·ŸåŠ¨æ€è§„åˆ’çš„è§£å†³æ€è·¯æ²¡æœ‰å·®åˆ«ã€‚ç¬¬äºŒç§æ˜¯ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„è§£å†³æ–¹æ³•ï¼Œ**çŠ¶æ€è½¬ç§»è¡¨æ³•**ã€‚\n\n    æˆ‘ä»¬å…ˆç”»å‡ºä¸€ä¸ªçŠ¶æ€è¡¨ã€‚çŠ¶æ€è¡¨ä¸€èˆ¬éƒ½æ˜¯äºŒç»´çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆäºŒç»´æ•°ç»„ã€‚å…¶ä¸­ï¼Œæ¯ä¸ªçŠ¶æ€åŒ…å«ä¸‰ä¸ªå˜é‡ï¼Œè¡Œã€åˆ—ã€æ•°ç»„å€¼ã€‚æˆ‘ä»¬æ ¹æ®å†³ç­–çš„å…ˆåè¿‡ç¨‹ï¼Œä»å‰å¾€åï¼Œæ ¹æ®é€’æ¨å…³ç³»ï¼Œåˆ†é˜¶æ®µå¡«å……çŠ¶æ€è¡¨ä¸­çš„æ¯ä¸ªçŠ¶æ€ã€‚æœ€åï¼Œæˆ‘ä»¬å°†è¿™ä¸ªé€’æ¨å¡«è¡¨çš„è¿‡ç¨‹ï¼Œç¿»è¯‘æˆä»£ç ï¼Œå°±æ˜¯åŠ¨æ€è§„åˆ’ä»£ç äº†ã€‚\n\n    å°½ç®¡å¤§éƒ¨åˆ†çŠ¶æ€è¡¨éƒ½æ˜¯äºŒç»´çš„ï¼Œä½†æ˜¯å¦‚æœé—®é¢˜çš„çŠ¶æ€æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å¾ˆå¤šå˜é‡æ¥è¡¨ç¤ºï¼Œé‚£å¯¹åº”çš„çŠ¶æ€è¡¨å¯èƒ½å°±æ˜¯é«˜ç»´çš„ï¼Œæ¯”å¦‚ä¸‰ç»´ã€å››ç»´ã€‚é‚£è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¸é€‚åˆç”¨çŠ¶æ€è½¬ç§»è¡¨æ³•æ¥è§£å†³äº†ã€‚ä¸€æ–¹é¢æ˜¯å› ä¸ºé«˜ç»´çŠ¶æ€è½¬ç§»è¡¨ä¸å¥½ç”»å›¾è¡¨ç¤ºï¼Œå¦ä¸€æ–¹é¢æ˜¯å› ä¸ºäººè„‘ç¡®å®å¾ˆä¸æ“…é•¿æ€è€ƒé«˜ç»´çš„ä¸œè¥¿ã€‚\n\n2. **çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ³•**\n\n    çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ³•æœ‰ç‚¹ç±»ä¼¼é€’å½’çš„è§£é¢˜æ€è·¯ã€‚æˆ‘ä»¬éœ€è¦åˆ†æï¼ŒæŸä¸ªé—®é¢˜å¦‚ä½•é€šè¿‡å­é—®é¢˜æ¥é€’å½’æ±‚è§£ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„æœ€ä¼˜å­ç»“æ„ã€‚æ ¹æ®æœ€ä¼˜å­ç»“æ„ï¼Œå†™å‡ºé€’å½’å…¬å¼ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚æœ‰äº†çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œä»£ç å®ç°å°±éå¸¸ç®€å•äº†ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§ä»£ç å®ç°æ–¹æ³•ï¼Œä¸€ç§æ˜¯**é€’å½’åŠ â€œå¤‡å¿˜å½•â€**ï¼Œå¦ä¸€ç§æ˜¯**è¿­ä»£é€’æ¨**ã€‚\n\n    å¼ºè°ƒä¸€ä¸‹ï¼Œ**çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ˜¯è§£å†³åŠ¨æ€è§„åˆ’çš„å…³é”®**ã€‚å¦‚æœæˆ‘ä»¬èƒ½å†™å‡ºçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œé‚£åŠ¨æ€è§„åˆ’é—®é¢˜åŸºæœ¬ä¸Šå°±è§£å†³ä¸€å¤§åŠäº†ï¼Œè€Œç¿»è¯‘æˆä»£ç éå¸¸ç®€å•ã€‚ä½†æ˜¯å¾ˆå¤šåŠ¨æ€è§„åˆ’é—®é¢˜çš„çŠ¶æ€æœ¬èº«å°±ä¸å¥½å®šä¹‰ï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¹Ÿå°±æ›´ä¸å¥½æƒ³åˆ°ã€‚\n\n\nä¸æ˜¯æ¯ä¸ªé—®é¢˜éƒ½åŒæ—¶é€‚åˆè¿™ä¸¤ç§è§£é¢˜æ€è·¯ã€‚æœ‰çš„é—®é¢˜å¯èƒ½ç”¨ç¬¬ä¸€ç§æ€è·¯æ›´æ¸…æ™°ï¼Œè€Œæœ‰çš„é—®é¢˜å¯èƒ½ç”¨ç¬¬äºŒç§æ€è·¯æ›´æ¸…æ™°ï¼Œæ‰€ä»¥ï¼Œä½ è¦ç»“åˆå…·ä½“çš„é¢˜ç›®æ¥çœ‹ï¼Œåˆ°åº•é€‰æ‹©ç”¨å“ªç§è§£é¢˜æ€è·¯ã€‚\n\nçŠ¶æ€è½¬ç§»è¡¨æ³•è§£é¢˜æ€è·¯å¤§è‡´å¯ä»¥æ¦‚æ‹¬ä¸ºï¼Œ**å›æº¯ç®—æ³•å®ç° - å®šä¹‰çŠ¶æ€ - ç”»é€’å½’æ ‘ - æ‰¾é‡å¤å­é—®é¢˜ - ç”»çŠ¶æ€è½¬ç§»è¡¨ - æ ¹æ®é€’æ¨å…³ç³»å¡«è¡¨ - å°†å¡«è¡¨è¿‡ç¨‹ç¿»è¯‘æˆä»£ç **ã€‚çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ³•çš„å¤§è‡´æ€è·¯å¯ä»¥æ¦‚æ‹¬ä¸ºï¼Œ**æ‰¾æœ€ä¼˜å­ç»“æ„ - å†™çŠ¶æ€è½¬ç§»æ–¹ç¨‹ - å°†çŠ¶æ€è½¬ç§»æ–¹ç¨‹ç¿»è¯‘æˆä»£ç **\n\n### å››ç§ç®—æ³•æ€æƒ³æ¯”è¾ƒåˆ†æ\n\nè´ªå¿ƒã€åˆ†æ²»ã€å›æº¯å’ŒåŠ¨æ€è§„åˆ’åˆ†æä¸€ä¸‹è¿™å››ç§ç®—æ³•ï¼Œçœ‹çœ‹å®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å’Œè”ç³»ã€‚\n\nå¦‚æœæˆ‘ä»¬å°†è¿™å››ç§ç®—æ³•æ€æƒ³åˆ†ä¸€ä¸‹ç±»ï¼Œé‚£è´ªå¿ƒã€å›æº¯ã€åŠ¨æ€è§„åˆ’å¯ä»¥å½’ä¸ºä¸€ç±»ï¼Œè€Œåˆ†æ²»å•ç‹¬å¯ä»¥ä½œä¸ºä¸€ç±»ï¼Œå› ä¸ºå®ƒè·Ÿå…¶ä»–ä¸‰ä¸ªéƒ½ä¸å¤§ä¸€æ ·ã€‚å‰ä¸‰ä¸ªç®—æ³•è§£å†³é—®é¢˜çš„æ¨¡å‹ï¼Œéƒ½å¯ä»¥æŠ½è±¡æˆæˆ‘ä»¬ä»Šå¤©è®²çš„é‚£ä¸ªå¤šé˜¶æ®µå†³ç­–æœ€ä¼˜è§£æ¨¡å‹ï¼Œè€Œåˆ†æ²»ç®—æ³•è§£å†³çš„é—®é¢˜å°½ç®¡å¤§éƒ¨åˆ†ä¹Ÿæ˜¯æœ€ä¼˜è§£é—®é¢˜ï¼Œä½†æ˜¯ï¼Œå¤§éƒ¨åˆ†éƒ½ä¸èƒ½æŠ½è±¡æˆå¤šé˜¶æ®µå†³ç­–æ¨¡å‹ã€‚\n\nå›æº¯ç®—æ³•æ˜¯ä¸ªâ€œä¸‡é‡‘æ²¹â€ã€‚åŸºæœ¬ä¸Šèƒ½ç”¨çš„åŠ¨æ€è§„åˆ’ã€è´ªå¿ƒè§£å†³çš„é—®é¢˜ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç”¨å›æº¯ç®—æ³•è§£å†³ã€‚å›æº¯ç®—æ³•ç›¸å½“äºç©·ä¸¾æœç´¢ã€‚ç©·ä¸¾æ‰€æœ‰çš„æƒ…å†µï¼Œç„¶åå¯¹æ¯”å¾—åˆ°æœ€ä¼˜è§£ã€‚ä¸è¿‡ï¼Œå›æº¯ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦éå¸¸é«˜ï¼Œæ˜¯æŒ‡æ•°çº§åˆ«çš„ï¼Œåªèƒ½ç”¨æ¥è§£å†³å°è§„æ¨¡æ•°æ®çš„é—®é¢˜ã€‚å¯¹äºå¤§è§„æ¨¡æ•°æ®çš„é—®é¢˜ï¼Œç”¨å›æº¯ç®—æ³•è§£å†³çš„æ‰§è¡Œæ•ˆç‡å°±å¾ˆä½äº†ã€‚\n\nå°½ç®¡åŠ¨æ€è§„åˆ’æ¯”å›æº¯ç®—æ³•é«˜æ•ˆï¼Œä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰é—®é¢˜ï¼Œéƒ½å¯ä»¥ç”¨åŠ¨æ€è§„åˆ’æ¥è§£å†³ã€‚èƒ½ç”¨åŠ¨æ€è§„åˆ’è§£å†³çš„é—®é¢˜ï¼Œéœ€è¦æ»¡è¶³ä¸‰ä¸ªç‰¹å¾ï¼Œæœ€ä¼˜å­ç»“æ„ã€æ— åæ•ˆæ€§å’Œé‡å¤å­é—®é¢˜ã€‚åœ¨é‡å¤å­é—®é¢˜è¿™ä¸€ç‚¹ä¸Šï¼ŒåŠ¨æ€è§„åˆ’å’Œåˆ†æ²»ç®—æ³•çš„åŒºåˆ†éå¸¸æ˜æ˜¾ã€‚åˆ†æ²»ç®—æ³•è¦æ±‚åˆ†å‰²æˆçš„å­é—®é¢˜ï¼Œä¸èƒ½æœ‰é‡å¤å­é—®é¢˜ï¼Œè€ŒåŠ¨æ€è§„åˆ’æ­£å¥½ç›¸åï¼ŒåŠ¨æ€è§„åˆ’ä¹‹æ‰€ä»¥é«˜æ•ˆï¼Œå°±æ˜¯å› ä¸ºå›æº¯ç®—æ³•å®ç°ä¸­å­˜åœ¨å¤§é‡çš„é‡å¤å­é—®é¢˜ã€‚\n\nè´ªå¿ƒç®—æ³•å®é™…ä¸Šæ˜¯åŠ¨æ€è§„åˆ’ç®—æ³•çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚å®ƒè§£å†³é—®é¢˜èµ·æ¥æ›´åŠ é«˜æ•ˆï¼Œä»£ç å®ç°ä¹Ÿæ›´åŠ ç®€æ´ã€‚ä¸è¿‡ï¼Œå®ƒå¯ä»¥è§£å†³çš„é—®é¢˜ä¹Ÿæ›´åŠ æœ‰é™ã€‚å®ƒèƒ½è§£å†³çš„é—®é¢˜éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼Œæœ€ä¼˜å­ç»“æ„ã€æ— åæ•ˆæ€§å’Œè´ªå¿ƒé€‰æ‹©æ€§ï¼ˆè¿™é‡Œæˆ‘ä»¬ä¸æ€ä¹ˆå¼ºè°ƒé‡å¤å­é—®é¢˜ï¼‰ã€‚\n\nå…¶ä¸­ï¼Œæœ€ä¼˜å­ç»“æ„ã€æ— åæ•ˆæ€§è·ŸåŠ¨æ€è§„åˆ’ä¸­çš„æ— å¼‚ã€‚â€œè´ªå¿ƒé€‰æ‹©æ€§â€çš„æ„æ€æ˜¯ï¼Œé€šè¿‡å±€éƒ¨æœ€ä¼˜çš„é€‰æ‹©ï¼Œèƒ½äº§ç”Ÿå…¨å±€çš„æœ€ä¼˜é€‰æ‹©ã€‚æ¯ä¸€ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬éƒ½é€‰æ‹©å½“å‰çœ‹èµ·æ¥æœ€ä¼˜çš„å†³ç­–ï¼Œæ‰€æœ‰é˜¶æ®µçš„å†³ç­–å®Œæˆä¹‹åï¼Œæœ€ç»ˆç”±è¿™äº›å±€éƒ¨æœ€ä¼˜è§£æ„æˆå…¨å±€æœ€ä¼˜è§£ã€‚\n\n# Note\n\næ•°ç»„ã€é“¾è¡¨ã€æ ˆã€é˜Ÿåˆ—ã€æ•£åˆ—è¡¨ã€äºŒå‰æ ‘ã€å †ã€è·³è¡¨ã€å›¾ã€Trie æ ‘\n\né€’å½’ã€æ’åºã€äºŒåˆ†æŸ¥æ‰¾ã€æœç´¢ã€å“ˆå¸Œç®—æ³•ã€è´ªå¿ƒç®—æ³•ã€åˆ†æ²»ç®—æ³•ã€å›æº¯ç®—æ³•ã€åŠ¨æ€è§„åˆ’ã€å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ã€‚\n\né€’å½’ï¼ˆå›æº¯ï¼‰+å¤‡å¿˜å½• VS åŠ¨æ€è§„åˆ’","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS"]},"/Cards/CS/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84":{"title":"ç³»ç»Ÿæ¶æ„","content":"\n# ä¼ ç»Ÿåˆ†å±‚æ¶æ„ vs å¾®æœåŠ¡\n\n![image.png](Extras/Images/image_1665669921442_0.png)\n\n![image.png](Extras/Images/image_1665669944183_0.png)\n\n# å¾®æœåŠ¡æ”¹é€ \n\n* åˆ†ç¦»å¾®æœåŠ¡çš„æ–¹æ³•å»ºè®®ï¼š\n\t* å®¡è§†å¹¶å‘ç°å¯ä»¥åˆ†ç¦»çš„ä¸šåŠ¡é€»è¾‘ä¸šåŠ¡é€»è¾‘\n\t* å¯»æ‰¾å¤©ç”Ÿéš”ç¦»çš„ä»£ç æ¨¡å—ï¼Œå¯ä»¥å€ŸåŠ©äºé™æ€ä»£ç åˆ†æå·¥å…·\n\t* ä¸åŒå¹¶å‘è§„æ¨¡ï¼Œä¸åŒå†…å­˜éœ€æ±‚çš„æ¨¡å—éƒ½å¯ä»¥åˆ†ç¦»å‡ºä¸åŒçš„å¾®æœåŠ¡ï¼Œæ­¤æ–¹æ³•å¯æé«˜èµ„æºåˆ©ç”¨ç‡ï¼ŒèŠ‚çœæˆæœ¬\n* ä¸€äº›å¸¸ç”¨çš„å¯å¾®æœåŠ¡åŒ–çš„ç»„ä»¶ï¼š\n\t* ç”¨æˆ·å’Œè´¦æˆ·ç®¡ç†\n\t* æˆæƒå’Œä¼šè¯ç®¡ç†\n\t* ç³»ç»Ÿé…ç½®\n\t* é€šçŸ¥å’Œé€šè®¯æœåŠ¡\n\t* ç…§ç‰‡ï¼Œå¤šåª’ä½“ï¼Œå…ƒæ•°æ®ç­‰\n* **åˆ†è§£åŸåˆ™ï¼šåŸºäº size, scope and capabilities**\n\n# å¾®æœåŠ¡é€šä¿¡\n\n## ç‚¹å¯¹ç‚¹\n\nå¤šç”¨äºç³»ç»Ÿå†…éƒ¨å¤šç»„ä»¶ä¹‹é—´é€šè®¯ï¼›\n\næœ‰å¤§é‡çš„é‡å¤æ¨¡å—å¦‚è®¤è¯æˆæƒï¼›\n\nç¼ºå°‘ç»Ÿä¸€è§„èŒƒï¼Œå¦‚ç›‘æ§ï¼Œå®¡è®¡ç­‰åŠŸèƒ½ï¼›\n\nåæœŸç»´æŠ¤æˆæœ¬é«˜ï¼ŒæœåŠ¡å’ŒæœåŠ¡çš„ä¾èµ–å…³ç³»é”™ç»¼å¤æ‚éš¾ä»¥ç®¡ç†ã€‚\n\n![image.png](Extras/Images/image_1665670881178_0.png)\n\n## APIç½‘å…³\n\nåŸºäºä¸€ä¸ªè½»é‡çº§çš„ message gateway\n\næ–° API é€šè¿‡æ³¨å†Œè‡³ Gateway å®ç°\n\næ•´åˆå®ç° Common function\n\n![image.png](Extras/Images/image_1665670938591_0.png)\n\n# å¾®æœåŠ¡æ‹†åˆ†\n\nå¾®æœåŠ¡æ‹†åˆ†å¹¶æ²¡æœ‰ç»Ÿä¸€çš„æ ‡å‡†ï¼Œç›¸åŒçš„ä¸šåŠ¡åœ¨ä¸åŒçš„å…¬å¸å¾ˆå¯èƒ½æ‹†åˆ†æ–¹å¼ä¼šæœ‰æ‰€åŒºåˆ«ï¼Œç”¨æˆ·è§„æ¨¡ã€å›¢é˜Ÿå¤§å°ã€ç»„å‘˜èƒ½åŠ›ç­‰éƒ½ä¼šæ˜¯è€ƒè™‘å› ç´ ã€‚ä½†æˆ‘ä»¬è¿˜æ˜¯æœ‰ä¸€äº›åŸºæœ¬åŸåˆ™å¯ä»¥éµå¾ªï¼š\n\nç”±ç²—åˆ°ç»†ï¼Œé¿å…è¿‡åº¦æ‹†åˆ†ï¼Œéµå¾ªæ¸è¿›å¼æ¼”è¿›çš„åŸåˆ™\n\nä¸åŒæœåŠ¡ä¹‹é—´åº”è¯¥æ˜¯æ­£äº¤çš„ï¼Œä¸è¦ä½ ä¸­æœ‰æˆ‘æˆ‘ä¸­æœ‰ä½ \n\né¿å…ç¯å½¢ä¾èµ–ï¼ŒæœåŠ¡ä¾èµ–å…³ç³»åº”è¯¥æ˜¯æœ‰å‘æ— ç¯å›¾\n\né¿å…ä¸åŒæœåŠ¡ä¹‹é—´å…±äº«åŒä¸€ä¸ªæ•°æ®åº“\n\n# 12 factors\n\n* I. åŸºå‡†ä»£ç \n\t* ä¸€ä»½åŸºå‡†ä»£ç ï¼Œå¤šä»½éƒ¨ç½²\n* II. ä¾èµ–\n\t* æ˜¾å¼å£°æ˜ä¾èµ–å…³ç³»\n* III. é…ç½®\n\t* åœ¨ç¯å¢ƒä¸­å­˜å‚¨é…ç½®\n* IV. åç«¯æœåŠ¡\n\t* æŠŠåç«¯æœåŠ¡å½“ä½œé™„åŠ èµ„æº\n* V. æ„å»ºï¼Œå‘å¸ƒï¼Œè¿è¡Œ\n\t* ä¸¥æ ¼åˆ†ç¦»æ„å»ºå’Œè¿è¡Œ\n* VI. è¿›ç¨‹\n\t* ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªæ— çŠ¶æ€è¿›ç¨‹è¿è¡Œåº”ç”¨\n* VII. ç«¯å£ç»‘å®š\n\t* é€šè¿‡ç«¯å£ç»‘å®šæä¾›æœåŠ¡\n* VIII. å¹¶å‘\n\t* é€šè¿‡è¿›ç¨‹æ¨¡å‹è¿›è¡Œæ‰©å±•\n* IX. æ˜“å¤„ç†\n\t* å¿«é€Ÿå¯åŠ¨å’Œä¼˜é›…ç»ˆæ­¢å¯æœ€å¤§åŒ–å¥å£®æ€§\n* X. å¼€å‘ç¯å¢ƒä¸çº¿ä¸Šç¯å¢ƒç­‰ä»·\n\t* å°½å¯èƒ½çš„ä¿æŒå¼€å‘ï¼Œé¢„å‘å¸ƒï¼Œçº¿ä¸Šç¯å¢ƒç›¸åŒ\n* XI. æ—¥å¿—\n\t* æŠŠæ—¥å¿—å½“ä½œäº‹ä»¶æµ\n* XII. ç®¡ç†è¿›ç¨‹\n\t* åå°ç®¡ç†ä»»åŠ¡å½“ä½œä¸€æ¬¡æ€§è¿›ç¨‹è¿è¡Œ","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS"]},"/Cards/CS/%E7%BC%96%E8%BE%91%E5%99%A8/VSCode":{"title":"VSCode","content":"\n# å¤šå…‰æ ‡\n\n1. æŒ‰ä½Altï¼Œç”¨é¼ æ ‡å·¦é”®ç‚¹å‡»ï¼Œå¯ä»¥å‡ºç°å¤šä¸ªå…‰æ ‡ï¼Œè¾“å…¥çš„ä»£ç å¯ä»¥åœ¨å…‰æ ‡å¤„åŒæ—¶å¢åŠ ã€‚\n2. æŒ‰ä½Ctrl+Altï¼Œå†æŒ‰é”®ç›˜ä¸Šå‘ä¸Šæˆ–è€…å‘ä¸‹çš„é”®ï¼Œå¯ä»¥ä½¿ä¸€åˆ—ä¸Šå‡ºç°å¤šä¸ªå…‰æ ‡ã€‚\n3. é€‰ä¸­ä¸€æ®µæ–‡å­—ï¼ŒæŒ‰Shift+Alt+iï¼Œå¯ä»¥åœ¨æ¯è¡Œæœ«å°¾å‡ºç°å…‰æ ‡\n4. å…‰æ ‡æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹ï¼ŒæŒ‰Ctrl+Shift+læˆ–è€…ctrl+F2ï¼Œå¯ä»¥åœ¨é¡µé¢ä¸­å‡ºç°è¿™ä¸ªè¯çš„ä¸åŒåœ°æ–¹éƒ½å‡ºç°å…‰æ ‡ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ã€‚æœ‰æ—¶å€™è¿™ä¸ªå¿«æ·é”®çš„ä½œç”¨å’ŒF2é‡å‘½åå˜é‡ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒæ›´åŠ å¹¿æ³›ï¼Œå› ä¸ºè¿˜å¯ä»¥å¯¹æ¯”å¦‚å­—ç¬¦ä¸²ç›¸åŒçš„éåŒä¸€å˜é‡æˆ–å‡½æ•°ç±»çš„ä¸œè¥¿ä¿®æ”¹ã€‚\n5. Ctrl+dï¼Œç¬¬ä¸€æ¬¡æŒ‰ä¸‹æ—¶ï¼Œå®ƒä¼šé€‰ä¸­å…‰æ ‡é™„è¿‘çš„å•è¯ï¼›ç¬¬äºŒæ¬¡æŒ‰ä¸‹æ—¶ï¼Œå®ƒä¼šæ‰¾åˆ°è¿™ä¸ªå•è¯ç¬¬äºŒæ¬¡å‡ºç°çš„ä½ç½®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å…‰æ ‡ï¼Œå¹¶ä¸”é€‰ä¸­å®ƒ\n6. æŒ‰Shift+Altï¼Œå†ä½¿ç”¨é¼ æ ‡æ‹–åŠ¨ï¼Œä¹Ÿå¯ä»¥å‡ºç°ç«–ç›´çš„åˆ—å…‰æ ‡ï¼ŒåŒæ—¶å¯ä»¥é€‰ä¸­å¤šåˆ—ã€‚\n7. ä»»ä½•å…‰æ ‡æ“ä½œï¼Œå¯ä»¥æŒ‰Ctrl + Uå–æ¶ˆ\n\n## å‚è€ƒèµ„æ–™\n\n1.  [VSCode åˆé…·åˆå®ç”¨çš„å¤šå…‰æ ‡ç¼–è¾‘](https://juejin.cn/post/7079693787328921637)\n3.  [VS Code å¤šå…‰æ ‡æ¨¡å¼](https://wangxiz.github.io/blog/posts/vscode-multi-cursor/)\n4.  [æ‹’ç»é‡å¤ï¼Œä½ ä¸€å®šè¦å­¦ä¼šçš„å¤šå…‰æ ‡ç‰¹æ€§](https://ppambler.github.io/time-geekbang/01-VS-Code/06-%E6%8B%92%E7%BB%9D%E9%87%8D%E5%A4%8D-%E4%BD%A0%E4%B8%80%E5%AE%9A%E8%A6%81%E5%AD%A6%E4%BC%9A%E7%9A%84%E5%A4%9A%E5%85%89%E6%A0%87%E7%89%B9%E6%80%A7.html)\n\n# Tips\n1.  è§¦å‘å‚æ•°æç¤ºï¼šShift+Cmd+Space\n\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/ç¼–è¾‘å™¨"]},"/Cards/CS/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/DDD%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1":{"title":"DDDé¢†åŸŸé©±åŠ¨è®¾è®¡","content":"\n# åŸºç¡€\n\n## Domain-Driven Design\n\nDomain-Driven Designï¼šåŸºäº **é¢†åŸŸ** çš„å·¥ç¨‹è®¾è®¡ã€‚\n\né¢†åŸŸæš‚æ—¶å¯ä»¥å°†å…¶ç†è§£ä¸ºâ€œä¸šåŠ¡é—®é¢˜çš„èŒƒç•´â€œã€‚\n\né¢†åŸŸå¯å¤§å¯å°ï¼Œå¯¹åº”ç€å¤§å°ä¸šåŠ¡é—®é¢˜çš„è¾¹ç•Œã€‚ç®€å•æ¥è¯´ï¼Œé¢†åŸŸé©±åŠ¨è®¾è®¡å°±æ˜¯å°†ä¸šåŠ¡ä¸Šè¦åšçš„ä¸€ä»¶å¤§äº‹ï¼Œé€šè¿‡æ¨æ¼”å’ŒæŠ½è±¡ï¼Œæ‹†åˆ†æˆå¤šä¸ªå†…èšçš„é¢†åŸŸã€‚\n\né¢å‘æ¥å£ç¼–ç¨‹ï¼Œé«˜å†…èšã€ä½è€¦åˆã€‚\n\n## DP(Domain Primitive)\n\næ„å»ºé¢†åŸŸçš„åŸºç¡€ç±»å‹ã€‚ä½œç”¨ï¼šæ˜ç¡®æ¥å£è¯­ä¹‰ã€å†…èšéšæ€§é€»è¾‘ã€ç®€åŒ–å•å…ƒæµ‹è¯•ã€‚\n\n**å®šä¹‰**ï¼šåœ¨ DDDé‡Œï¼ŒDP å¯ä»¥è¯´æ˜¯ä¸€åˆ‡æ¨¡å‹ã€æ–¹æ³•ã€æ¶æ„çš„åŸºç¡€ã€‚å®ƒæ˜¯åœ¨ç‰¹å®šé¢†åŸŸã€æ‹¥æœ‰ç²¾å‡†å®šä¹‰ã€å¯ä»¥è‡ªæˆ‘éªŒè¯ã€æ‹¥æœ‰è¡Œä¸ºçš„å¯¹è±¡ã€‚å¯ä»¥è®¤ä¸ºæ˜¯é¢†åŸŸçš„æœ€å°ç»„æˆéƒ¨åˆ†ã€‚\n\n**DPä¸‰æ¡åŸåˆ™ï¼š**\n\nè®©éšæ€§çš„æ¦‚å¿µæ˜¾æ€§åŒ–\n\nè®©éšæ€§çš„ä¸Šä¸‹æ–‡æ˜¾æ€§åŒ–\n\nå°è£…å¤šå¯¹è±¡è¡Œä¸º\n\n## Entity\n\nä¸DPçš„åœ¨æœ¬è´¨ä¸Šçš„å·®å¼‚åœ¨äºï¼šåœ¨è¯­ä¹‰ä¸Šèƒ½å¦æ‹¥æœ‰æ•°æ®çŠ¶æ€\n\nDPï¼šæ— çŠ¶æ€ï¼Œç»„æˆå®ä½“çš„åŸºç¡€ç±»å‹\n\nEntityï¼šæœ‰çŠ¶æ€ï¼Œé¢†åŸŸå®ä½“\n\n## Domain Service\n\næ¶‰åŠåˆ°äº†å¤šä¸ªEntityçŠ¶æ€æ”¹å˜çš„æœåŠ¡ï¼Œè¢«ç§°ä¸ºDomain Serviceã€‚\n\nDomain Serviceä¸»è¦ç”¨äºå°è£…å¤šEntityæˆ–è·¨ä¸šåŠ¡åŸŸçš„é€»è¾‘ã€‚\n\n## Repository\n\n# æ¦‚å¿µå½’çº³\n\nDPï¼šæŠ½è±¡å¹¶å°è£…è‡ªæ£€å’Œä¸€äº›éšå½¢å±æ€§çš„è®¡ç®—é€»è¾‘ï¼Œä¸”è¿™äº›å±æ€§æ˜¯æ— çŠ¶æ€çš„ã€‚\n\nEntityï¼šæŠ½è±¡å¹¶å°è£…å•å¯¹è±¡æœ‰çŠ¶æ€çš„é€»è¾‘\n\nDomain Serviceï¼šæŠ½è±¡å¹¶å°è£…å¤šå¯¹è±¡çš„æœ‰çŠ¶æ€é€»è¾‘ã€‚\n\nRepositoryï¼šæŠ½è±¡å¹¶å°è£…å¤–éƒ¨æ•°æ®è®¿é—®é€»è¾‘ã€‚\n\n---\n\n1. é¦–å…ˆå¯¹éœ€è¦å¤„ç†çš„ä¸šåŠ¡é—®é¢˜è¿›è¡Œæ€»è§ˆã€‚\n2. ç„¶åé¢†åŸŸå¯¹è±¡ï¼ˆEntityï¼‰è¿›è¡Œåˆ’åˆ†ï¼Œæ˜ç¡®æ¯ä¸ªé¢†åŸŸå¯¹è±¡çš„åŒ…å«çš„ä¿¡æ¯å’ŒèŒè´£è¾¹ç•Œã€‚å¹¶è¿›è¡Œè·¨å¯¹è±¡ï¼Œå¤šå¯¹è±¡çš„é€»è¾‘ç»„ç»‡ï¼ˆDomain Serviceï¼‰ã€‚\n3. æ¥ç€åœ¨ä¸Šå±‚åº”ç”¨ä¸­æ ¹æ®ä¸šåŠ¡æè¿°å»ç¼–æ’Entityå’ŒDomain Serviceã€‚\n4. æœ€åå†åšä¸€äº›ä¸‹æ°´é“å·¥ä½œï¼Œå»å¯¹ä¸‹å±‚çš„æ•°æ®è®¿é—®ï¼ŒRPCè°ƒç”¨å»åšä¸€äº›å…·ä½“å®ç°ã€‚\n\n# Aggregate\n\nå­˜åœ¨å¼•ç”¨å…³ç³»çš„å¯¹è±¡é›†åˆã€‚èšåˆæ˜¯å¯¹å­˜åœ¨å¼•ç”¨å…³ç³»çš„ä¸€ç»„å¯¹è±¡çš„å°è£…ï¼Œå®ƒçš„ç›®çš„å°±æ˜¯å±è”½æ‰å†…éƒ¨å¯¹è±¡ä¹‹é—´å¤æ‚çš„å…³è”å…³ç³»ï¼Œåªå¯¹å¤–æš´éœ²ç»Ÿä¸€æ¥å£ã€‚\n\nå…³äºèšåˆï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨å®ƒçš„ä¸¤ä¸ªå±æ€§ï¼Œæ ¹å¯¹è±¡ï¼ˆrootï¼‰å’Œè¾¹ç•Œï¼ˆBoundaryï¼‰ã€‚\n\n**æ ¹å¯¹è±¡**æ˜¯æ•´ä¸ªèšåˆä¸­å”¯ä¸€èƒ½å¤Ÿè¢«å¤–éƒ¨å¼•ç”¨çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´èšåˆæ‰€æš´éœ²çš„æ¥å£åªå…è®¸æ“ä½œæ ¹å¯¹è±¡ã€‚æ ¹å¯¹è±¡æ˜¯ä¸€ä¸ªEntityï¼Œå› ä¸ºæ¯ä¸ªèšåˆéœ€è¦IDå’ŒçŠ¶æ€æ¥åŒºåˆ†å…¶ä»–èšåˆï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿå°±æ˜¯é€šè¿‡æ ¹å¯¹è±¡çš„IDæ¥ä½œä¸ºæ•´ä¸ªèšåˆçš„IDã€‚\n\n**è¾¹ç•Œ**ï¼Œç®€å•æ¥è¯´ï¼Œèšåˆçš„è¾¹ç•Œå°±æ˜¯ä½ åˆ¤æ–­å“ªäº›å¯¹è±¡å¯ä»¥è¢«æ”¾å…¥å½“å‰èšåˆçš„æ¡ä»¶ã€‚\n\n![CleanShot 2022-11-22 at 21.34.16-2x.png](Extras/Images/CleanShot_2022-11-22_at_21.34.16-2x_1669124064817_0.png)\n\n---\n\n![CleanShot 2022-11-22 at 21.38.19-2x.png](Extras/Images/CleanShot_2022-11-22_at_21.38.19-2x_1669124432651_0.png)\n\n![CleanShot 2022-11-22 at 21.40.42-2x.png](Extras/Images/CleanShot_2022-11-22_at_21.40.42-2x_1669124449935_0.png)\n\næ¯ä¸ªEntityéƒ½æ˜¯å­˜åœ¨æ ‡è¯†çš„ï¼Œæ ‡è¯†ä¸€èˆ¬æ˜¯ä¸å¯å˜ç±»å‹ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªIdentifieræ¥å£ï¼Œç”¨äºæ‰€æœ‰ä½œä¸ºæ ‡è¯†çš„DPçš„å…¬å…±çˆ¶æ¥å£ã€‚è¿™é‡Œä¸æ¨èç›´æ¥ä½¿ç”¨stringä½œä¸ºEntityçš„æ ‡è¯†ï¼Œå»ºè®®ä½¿ç”¨DPæ¥ä½œä¸ºEntityçš„æ ‡è¯†ã€‚\n\næ¥ä¸‹æ¥å®šä¹‰äº†Entityæ¥å£ï¼Œå®ƒçš„èŒƒå‹æ˜¯IDentitiferçš„å­ç±»ï¼Œè¯¥èŒƒå‹æŒ‡å®šäº†Entityçš„æ ‡è¯†ç±»å‹ï¼Œä¹Ÿå°±æ˜¯åˆšæ‰è¯´å®ç°äº†Identifieræ¥å£çš„DPã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒPhoneNumberç±»ï¼Œæ‰‹æœºå·å¯ä»¥ä½œä¸ºä¸€äº›è´¦å·çš„æ ‡è¯†ï¼Œæ‰€ä»¥è¿™é‡ŒPhoneNumberå®ç°äº†Identifieræ¥å£ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„DPéƒ½æ˜¯ç”¨æ¥ä½œä¸ºæ ‡è¯†çš„ï¼Œæ¯”å¦‚è¿™é‡Œçš„DP Redå°±ä¸é€‚åˆä½œä¸ºEntityçš„æ ‡è¯†ã€‚\n\næ¥ä¸‹æ¥å°±æ˜¯ä¸»è§’èšåˆæ ¹ï¼Œèšåˆæ ¹æ˜¯Entityï¼Œæ‰€ä»¥AggrateRootç»§æ‰¿äº†Entityã€‚å’ŒEntityä¸€æ ·ï¼Œèšåˆæ ¹ä¹Ÿéœ€è¦ä¸€ä¸ªæ ‡è¯†ï¼Œæ‰€ä»¥è¿™é‡ŒæŒ‡å®šæ³›å‹ä¸ºIdentiiferçš„å­ç±»ã€‚\n\nç»“åˆä¸Šæ–‡çš„ä¾‹å­ï¼Œè¿™é‡Œå…ˆå®šä¹‰è´¦å·ç±»WechatAccountï¼Œå®ƒæ˜¯ä¸€ä¸ªEntityã€‚WechatAccountçš„æ³›å‹ä¸ºPhoneNumberï¼Œæ„å‘³ç€æ‰‹æœºå·æ˜¯æ¯ä¸ªå¾®ä¿¡å·çš„å…¨å±€æ ‡è¯†ï¼Œåœ¨è´¦å·æ“ä½œè¿™ä¸ªä¸šåŠ¡èšåˆä¸­å®ƒèƒ½å¤Ÿå……å½“è¢«å¤–éƒ¨å¼•ç”¨çš„æ ¹ã€‚\n\n---\n\n**æ€»ç»“ï¼š**\n\nåœ¨å¤æ‚çš„è½¯ä»¶ä¸­ï¼Œä¸€ä¸ªä¸šåŠ¡åŠ¨ä½œä¼šæ¶‰åŠå¤§é‡å­˜åœ¨å…³è”çš„å¯¹è±¡ã€‚èšåˆçš„ä»·å€¼å°±æ˜¯é€šè¿‡å°è£…ï¼Œä¿æŒæ‰€æœ‰å…³è”å¯¹è±¡çš„çŠ¶æ€ä¸€è‡´ã€‚æ­¤å¤–èšåˆå­˜åœ¨ä¸¤ä¸ªå¿…é¡»å…³æ³¨çš„å±æ€§ï¼Œæ ¹å¯¹è±¡å’Œè¾¹ç•Œï¼Œæ˜ç¡®äº†è¿™ä¸¤ä¸ªå±æ€§ï¼Œæ•´ä¸ªèšåˆçš„é¢è²Œå°±æ¸…æ™°äº†ã€‚\n\nåœ¨è¿è¡Œæ—¶ï¼Œé¢†åŸŸæ–¹æ³•é€šè¿‡æŒæœ‰èšåˆæ ¹ï¼Œç»´æŠ¤äº†å¯¹è±¡çš„çŠ¶æ€ä¸€è‡´ã€‚åœ¨æŒä¹…åŒ–æ—¶ï¼Œrepositoryé€šè¿‡æŒæœ‰èšåˆæ ¹ï¼Œæ¥å¤„ç†æ•°æ®ä¸€è‡´ã€‚æœ€åï¼Œå› ä¸ºèšåˆä¸­å­˜åœ¨å¤§é‡å¯¹è±¡æŒä¹…åŒ–æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›æ¯æ¬¡æ•°æ®æ›´æ–°ä¿æŒæœ€å°åŒ–åŸåˆ™ï¼ˆchange trackingï¼‰\n\n# å‚è€ƒèµ„æ–™\n\n1.  [ã€ã€é¢†åŸŸé©±åŠ¨è®¾è®¡ã€‘DDDå…¥é—¨äº”æ¿æ–§ä¹‹ä¸€ï¼šDomain Primitiveã€‘](https://www.bilibili.com/video/BV11q4y1q74f?vd_source=95893bf3c956973d41f5d92572ef8a93)\n\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/è½¯ä»¶è®¾è®¡"]},"/Cards/CS/Docker/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4":{"title":"å¸¸ç”¨å‘½ä»¤","content":"\n# è¿œç¨‹æ„å»ºimage\n\n## ä½¿ç”¨buildæ„å»º\n\n```bash\nDOCKER_HOST=\"ssh://user@docker-build.dev\" docker build -t {tag} .\ndocker use context remote-build-host \u0026\u0026 docker build -t {tag} .\ndocker -H ssh://user@docker-build.dev:22 build -t {tag} .\n```\n\n## ä½¿ç”¨buildxæ„å»º\n\n### ä½¿ç”¨æ–¹æ³•\n\n\u003e https://dustinrue.com/2021/12/using-a-remote-docker-engine-with-buildx/\n\n\u003e https://docs.docker.com/engine/context/working-with-contexts/\n\n\u003e https://docs.docker.com/engine/reference/commandline/buildx_create/\n\n### é¦–å…ˆåˆ›å»ºcontextï¼ˆç›®å‰æŒ‡å®šçš„kubeconfigæ²¡æœ‰ç”Ÿæ•ˆï¼‰\n\n```bash\ndocker context create deskmini --default-stack-orchestrator=kubernetes --docker host=ssh://192.168.3.10 --kubernetes config-file=/Users/petrus/.kube/k0s.config\ndocker context use deskmini\n```\n\n### å†åˆ›å»ºbuildx\n\n```bash\ndocker buildx create --bootstrap --name=kube --driver=kubernetes --driver-opt=namespace=applications,qemu.install=true,rootless=true\ndocker buildx use kube\n```\n\n### ä¹‹åå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨docker buildxè¿›è¡Œè¿œç¨‹æ„å»ºäº†\n\n```bash\nKUBECONFIG=~/.kube/k0s.config docker buildx build --load -f build/package/Dockerfile --platform linux/amd64 -t remote-multi-arch-test .\n```\n\n### é—®é¢˜\n\n\u003e https://suyuying.github.io/docs/Docker/2023-03-10-docker-muiltiplatform\n\n\u003e [https://github.com/docker/buildx/issues/59](https://github.com/docker/buildx/issues/59)\n\nä½¿ç”¨--platform é…åˆ--loadï¼Œä¸èƒ½æ”¯æŒå¤šå¹³å°ï¼Œä¸€æ¬¡ä¸€ä¸ªå¹³å°ï¼Œä¸åˆ™ä¼šæŠ¥é”™ã€‚--push æ”¯æŒä¸€æ¬¡å¤šå¹³å° image\n\n# æ£€æŸ¥dockeré•œåƒå†…å®¹\n\n```bash\ndocker run -it --rm --name \u003cdocker name\u003eÂ  --entrypoint=/bin/sh \u003cdocker image\u003e:\u003ctag\u003e\n```\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Docker"]},"/Cards/CS/Docker/%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF":{"title":"æ ¸å¿ƒæŠ€æœ¯","content":"\n# Docker\n\nåŸºäº Linux å†…æ ¸çš„ Cgroupï¼ŒNamespaceï¼Œä»¥åŠ Union FS ç­‰æŠ€æœ¯ï¼Œå¯¹è¿›ç¨‹è¿›è¡Œå°è£…éš”ç¦»ï¼Œå±äºæ“ä½œç³»ç»Ÿå±‚é¢çš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œç”±äºéš”ç¦»çš„è¿›ç¨‹ç‹¬ç«‹äºå®¿ä¸»å’Œå…¶å®ƒçš„éš”ç¦»çš„è¿›ç¨‹ï¼Œå› æ­¤ä¹Ÿç§°å…¶ä¸ºå®¹å™¨ã€‚\n\næœ€åˆå®ç°æ˜¯åŸºäº LXCï¼Œä» 0.7 ä»¥åå¼€å§‹å»é™¤ LXCï¼Œè½¬è€Œä½¿ç”¨è‡ªè¡Œå¼€å‘çš„ Libcontainerï¼Œä» 1.11 å¼€å§‹ï¼Œåˆ™è¿›ä¸€æ­¥æ¼”è¿›ä¸ºä½¿ç”¨ runC å’Œ Containerdã€‚\n\nDocker åœ¨å®¹å™¨çš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œäº†è¿›ä¸€æ­¥çš„å°è£…ï¼Œä»æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œäº’è”åˆ°è¿›ç¨‹éš”ç¦»ç­‰ç­‰ï¼Œæå¤§çš„ç®€åŒ–äº†å®¹å™¨çš„åˆ›å»ºå’Œç»´æŠ¤ï¼Œä½¿å¾— Docker æŠ€æœ¯æ¯”è™šæ‹ŸæœºæŠ€æœ¯æ›´ä¸ºè½»ä¾¿ã€å¿«æ·ã€‚\n\n# OCI å®¹å™¨æ ‡å‡†\n\n* Open Container Initiative\n\t* OCI ç»„ç»‡äº 2015 å¹´åˆ›å»ºï¼Œæ˜¯ä¸€ä¸ªè‡´åŠ›äºå®šä¹‰å®¹å™¨é•œåƒæ ‡å‡†å’Œè¿è¡Œæ—¶æ ‡å‡†çš„å¼€æ”¾å¼ç»„ç»‡ã€‚\n\t* OCI å®šä¹‰äº†é•œåƒæ ‡å‡†ï¼ˆRuntime Specificationï¼‰ã€è¿è¡Œæ—¶æ ‡å‡†ï¼ˆImage Specificationï¼‰å’Œåˆ†å‘æ ‡å‡†ï¼ˆDistribution Specificationï¼‰\n\t\t* é•œåƒæ ‡å‡†å®šä¹‰åº”ç”¨å¦‚ä½•æ‰“åŒ…\n\t\t* è¿è¡Œæ—¶æ ‡å‡†å®šä¹‰å¦‚ä½•è§£å‹åº”ç”¨åŒ…å¹¶è¿è¡Œ\n\t\t* åˆ†å‘æ ‡å‡†å®šä¹‰å¦‚ä½•åˆ†å‘å®¹å™¨é•œåƒ\n\n# Docker å¼•æ“æ¶æ„\n\n![image.png](Extras/Images/image_1665734926295_0.png)\n\n# Namespace\n\n* Linux Namespace æ˜¯ä¸€ç§ Linux Kernel æä¾›çš„èµ„æºéš”ç¦»æ–¹æ¡ˆï¼š\n\t* ç³»ç»Ÿå¯ä»¥ä¸ºè¿›ç¨‹åˆ†é…ä¸åŒçš„ Namespaceï¼›\n\t* å¹¶ä¿è¯ä¸åŒçš„ Namespace èµ„æºç‹¬ç«‹åˆ†é…ã€è¿›ç¨‹å½¼æ­¤éš”ç¦»ï¼Œå³ä¸åŒçš„ Namespace ä¸‹çš„è¿›ç¨‹äº’ä¸å¹²æ‰°ã€‚\n\n## pid namespace\n\nä¸åŒç”¨æˆ·çš„è¿›ç¨‹å°±æ˜¯é€šè¿‡ Pid namespace éš”ç¦»å¼€çš„ï¼Œä¸”ä¸åŒ namespace ä¸­å¯ä»¥æœ‰ç›¸åŒ Pidã€‚\n\næœ‰äº† Pid namespace, æ¯ä¸ª namespace ä¸­çš„ Pid èƒ½å¤Ÿç›¸äº’éš”ç¦»ã€‚\n\n## net namespace\n\nç½‘ç»œéš”ç¦»æ˜¯é€šè¿‡ net namespace å®ç°çš„ï¼Œ æ¯ä¸ª net namespace æœ‰ç‹¬ç«‹çš„ network devices, IP addresses, IP routing tables, /proc/net ç›®å½•ã€‚\n\nDocker é»˜è®¤é‡‡ç”¨ veth çš„æ–¹å¼å°† container ä¸­çš„è™šæ‹Ÿç½‘å¡åŒ host ä¸Šçš„ä¸€ä¸ª docker bridge: docker0 è¿æ¥åœ¨ä¸€èµ·ã€‚\n\n## ipc namespace\n\nContainer ä¸­è¿›ç¨‹äº¤äº’è¿˜æ˜¯é‡‡ç”¨ linux å¸¸è§çš„è¿›ç¨‹é—´äº¤äº’æ–¹æ³• ï¼ˆinterprocess communication â€“ IPCï¼‰, åŒ…æ‹¬å¸¸è§çš„ä¿¡å·é‡ã€æ¶ˆæ¯é˜Ÿåˆ—å’Œå…±äº«å†…å­˜ã€‚\n\nContainer çš„è¿›ç¨‹é—´äº¤äº’å®é™…ä¸Šè¿˜æ˜¯ hostä¸Š å…·æœ‰ç›¸åŒ Pid namespace ä¸­çš„è¿›ç¨‹é—´äº¤äº’ï¼Œå› æ­¤éœ€è¦åœ¨ IPCèµ„æºç”³è¯·æ—¶åŠ å…¥ namespace ä¿¡æ¯ - æ¯ä¸ª IPC èµ„æºæœ‰ä¸€ä¸ªå”¯ä¸€çš„ 32 ä½ IDã€‚\n\n## mnt namespace\n\nmnt namespace å…è®¸ä¸åŒ namespace çš„è¿›ç¨‹çœ‹åˆ°çš„æ–‡ä»¶ç»“æ„ä¸åŒï¼Œè¿™æ ·æ¯ä¸ª namespace ä¸­çš„è¿›ç¨‹æ‰€çœ‹åˆ°çš„æ–‡ä»¶ç›®å½•å°±è¢«éš”ç¦»å¼€äº†ã€‚\n\n## uts namespace\n\nUTS(â€œUNIX Time-sharing Systemâ€) namespaceå…è®¸æ¯ä¸ª container æ‹¥æœ‰ç‹¬ç«‹çš„ hostname å’Œdomain name, ä½¿å…¶åœ¨ç½‘ç»œä¸Šå¯ä»¥è¢«è§†ä½œä¸€ä¸ªç‹¬ç«‹çš„èŠ‚ç‚¹è€Œé Host ä¸Šçš„ä¸€ä¸ªè¿›ç¨‹ã€‚\n\n## user namespace\n\næ¯ä¸ª container å¯ä»¥æœ‰ä¸åŒçš„ user å’Œ group id, ä¹Ÿå°±æ˜¯è¯´å¯ä»¥åœ¨ container å†…éƒ¨ç”¨ container å†…éƒ¨çš„ç”¨æˆ·æ‰§è¡Œç¨‹åºè€Œé Host ä¸Šçš„ç”¨æˆ·ã€‚\n\n## å…³äº namespace çš„å¸¸ç”¨æ“ä½œ\n\n* æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„ namespaceï¼š\n\t* `lsns â€“t \u003ctype\u003e`\n* æŸ¥çœ‹æŸè¿›ç¨‹çš„ namespaceï¼š\n\t* `ls -la /proc/\u003cpid\u003e/ns/`\n* è¿›å…¥æŸ namespace è¿è¡Œå‘½ä»¤ï¼š\n\t* `nsenter -t \u003cpid\u003e -n ip addr`\n\n# Cgroups\n\nCgroups ï¼ˆControl Groupsï¼‰æ˜¯ Linux ä¸‹ç”¨äºå¯¹ä¸€ä¸ªæˆ–ä¸€ç»„è¿›ç¨‹è¿›è¡Œèµ„æºæ§åˆ¶å’Œç›‘æ§çš„æœºåˆ¶ï¼›\n\nå¯ä»¥å¯¹è¯¸å¦‚ CPU ä½¿ç”¨æ—¶é—´ã€å†…å­˜ã€ç£ç›˜ I/O ç­‰è¿›ç¨‹æ‰€éœ€çš„èµ„æºè¿›è¡Œé™åˆ¶ï¼›\n\nä¸åŒèµ„æºçš„å…·ä½“ç®¡ç†å·¥ä½œç”±ç›¸åº”çš„ Cgroup å­ç³»ç»Ÿï¼ˆSubsystemï¼‰æ¥å®ç° ï¼›\n\né’ˆå¯¹ä¸åŒç±»å‹çš„èµ„æºé™åˆ¶ï¼Œåªè¦å°†é™åˆ¶ç­–ç•¥åœ¨ä¸åŒçš„çš„å­ç³»ç»Ÿä¸Šè¿›è¡Œå…³è”å³å¯ ï¼›\n\nCgroups åœ¨ä¸åŒçš„ç³»ç»Ÿèµ„æºç®¡ç†å­ç³»ç»Ÿä¸­ä»¥å±‚çº§æ ‘ï¼ˆHierarchyï¼‰çš„æ–¹å¼æ¥ç»„ç»‡ç®¡ç†ï¼šæ¯ä¸ª Cgroup éƒ½å¯ä»¥åŒ…å«å…¶ä»–çš„å­ Cgroupï¼Œå› æ­¤å­ Cgroup èƒ½ä½¿ç”¨çš„èµ„æºé™¤äº†å—æœ¬ Cgroup é…ç½®çš„èµ„æºå‚æ•°é™åˆ¶ï¼Œè¿˜å—åˆ°çˆ¶Cgroup è®¾ç½®çš„èµ„æºé™åˆ¶ã€‚\n\n## å¯é…é¢/å¯åº¦é‡\n\ncgroups å®ç°äº†å¯¹èµ„æºçš„é…é¢å’Œåº¦é‡\n\n**blkio**ï¼šè¿™ä¸ªå­ç³»ç»Ÿè®¾ç½®é™åˆ¶æ¯ä¸ªå—è®¾å¤‡çš„è¾“å…¥è¾“å‡ºæ§åˆ¶ã€‚ä¾‹å¦‚:ç£ç›˜ï¼Œå…‰ç›˜ä»¥åŠ USB ç­‰ç­‰ã€‚\n\n**CPU**ï¼šè¿™ä¸ªå­ç³»ç»Ÿä½¿ç”¨è°ƒåº¦ç¨‹åºä¸º cgroup ä»»åŠ¡æä¾› CPU çš„è®¿é—®ã€‚\n\n**cpuacct**ï¼š äº§ç”Ÿ cgroup ä»»åŠ¡çš„ CPU èµ„æºæŠ¥å‘Šã€‚\n\n**cpuset**ï¼š å¦‚æœæ˜¯å¤šæ ¸å¿ƒçš„ CPUï¼Œè¿™ä¸ªå­ç³»ç»Ÿä¼šä¸º cgroup ä»»åŠ¡åˆ†é…å•ç‹¬çš„ CPU å’Œå†…å­˜ã€‚\n\n**devices**ï¼š å…è®¸æˆ–æ‹’ç» cgroup\n\n**freezer**ï¼š æš‚åœå’Œæ¢å¤ cgroup ä»»åŠ¡ã€‚\n\n**memory**ï¼š è®¾ç½®æ¯ä¸ª cgroup çš„å†…å­˜é™åˆ¶ä»¥åŠäº§ç”Ÿå†…å­˜èµ„æºæŠ¥å‘Šã€‚\n\n**net_cls**ï¼š æ ‡è®°æ¯ä¸ªç½‘ç»œåŒ…ä»¥ä¾› cgroup æ–¹ä¾¿ä½¿ç”¨ã€‚\n\n**ns**ï¼šåç§°ç©ºé—´å­ç³»ç»Ÿã€‚\n\n**pid**ï¼šè¿›ç¨‹æ ‡è¯†å­ç³»ç»Ÿã€‚\n\n## CPUå­ç³»ç»Ÿ\n\ncpu.sharesï¼šå¯å‡ºè®©çš„èƒ½è·å¾— CPU ä½¿ç”¨æ—¶é—´çš„ç›¸å¯¹å€¼ã€‚\n\n![image.png](Extras/Images/image_1665679422886_0.png){:height 118, :width 245}\n\ncpu.cfs_period_usï¼šcfs_period_us ç”¨æ¥é…ç½®æ—¶é—´å‘¨æœŸé•¿åº¦ï¼Œå•ä½ä¸º usï¼ˆå¾®ç§’ï¼‰ã€‚\n\ncpu.cfs_quota_usï¼šcfs_quota_us ç”¨æ¥é…ç½®å½“å‰ Cgroup åœ¨ cfs_period_us æ—¶é—´å†…æœ€å¤šèƒ½ä½¿ç”¨çš„ CPU æ—¶é—´æ•°ï¼Œå•ä½ä¸º usï¼ˆå¾®ç§’ï¼‰ã€‚\n\n![image.png](Extras/Images/image_1665679444552_0.png){:height 153, :width 251}\n\ncpu.stat ï¼šCgroup å†…çš„è¿›ç¨‹ä½¿ç”¨çš„ CPU æ—¶é—´ç»Ÿè®¡ã€‚\n\nnr_periods ï¼šç»è¿‡ cpu.cfs_period_us çš„æ—¶é—´å‘¨æœŸæ•°é‡ã€‚\n\nnr_throttled ï¼šåœ¨ç»è¿‡çš„å‘¨æœŸå†…ï¼Œæœ‰å¤šå°‘æ¬¡å› ä¸ºè¿›ç¨‹åœ¨æŒ‡å®šçš„æ—¶é—´å‘¨æœŸå†…ç”¨å…‰äº†é…é¢æ—¶é—´è€Œå—åˆ°é™åˆ¶ã€‚\n\nthrottled_time ï¼šCgroup ä¸­çš„è¿›ç¨‹è¢«é™åˆ¶ä½¿ç”¨ CPU çš„æ€»ç”¨æ—¶ï¼Œå•ä½æ˜¯ nsï¼ˆçº³ç§’ï¼‰ã€‚\n\n### Linux è°ƒåº¦å™¨\n\nå†…æ ¸é»˜è®¤æä¾›äº†5ä¸ªè°ƒåº¦å™¨ï¼ŒLinux å†…æ ¸ä½¿ç”¨ struct sched_class æ¥å¯¹è°ƒåº¦å™¨è¿›è¡ŒæŠ½è±¡ï¼š\n\nStop è°ƒåº¦å™¨ï¼Œstop_sched_classï¼šä¼˜å…ˆçº§æœ€é«˜çš„è°ƒåº¦ç±»ï¼Œå¯ä»¥æŠ¢å å…¶ä»–æ‰€æœ‰è¿›ç¨‹ï¼Œä¸èƒ½è¢«å…¶ä»–è¿›ç¨‹æŠ¢å ï¼›\n\nDeadline è°ƒåº¦å™¨ï¼Œdl_sched_classï¼šä½¿ç”¨çº¢é»‘æ ‘ï¼ŒæŠŠè¿›ç¨‹æŒ‰ç…§ç»å¯¹æˆªæ­¢æœŸé™è¿›è¡Œæ’åºï¼Œé€‰æ‹©æœ€å°è¿›ç¨‹è¿›è¡Œè°ƒåº¦è¿è¡Œï¼›\n\nRT è°ƒåº¦å™¨ï¼Œ rt_sched_classï¼šå®æ—¶è°ƒåº¦å™¨ï¼Œä¸ºæ¯ä¸ªä¼˜å…ˆçº§ç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—ï¼›\n\n**CFS è°ƒåº¦å™¨ï¼Œ cfs_sched_classï¼šå®Œå…¨å…¬å¹³è°ƒåº¦å™¨ï¼Œé‡‡ç”¨å®Œå…¨å…¬å¹³è°ƒåº¦ç®—æ³•ï¼Œå¼•å…¥è™šæ‹Ÿè¿è¡Œæ—¶é—´æ¦‚å¿µï¼›**\n\nIDLE-Task è°ƒåº¦å™¨ï¼Œ idle_sched_classï¼šç©ºé—²è°ƒåº¦å™¨ï¼Œæ¯ä¸ª CPU éƒ½ä¼šæœ‰ä¸€ä¸ª idle çº¿ç¨‹ï¼Œå½“æ²¡æœ‰å…¶ä»–è¿›ç¨‹å¯ä»¥è°ƒåº¦æ—¶ï¼Œè°ƒåº¦è¿è¡Œ idle çº¿ç¨‹ã€‚\n\n### CFS è°ƒåº¦å™¨\n\nCFS æ˜¯ Completely Fair Scheduler ç®€ç§°ï¼Œå³å®Œå…¨å…¬å¹³è°ƒåº¦å™¨ã€‚\n\nCFS å®ç°çš„ä¸»è¦æ€æƒ³æ˜¯ç»´æŠ¤ä¸ºä»»åŠ¡æä¾›å¤„ç†å™¨æ—¶é—´æ–¹é¢çš„å¹³è¡¡ï¼Œè¿™æ„å‘³ç€åº”ç»™è¿›ç¨‹åˆ†é…ç›¸å½“æ•°é‡çš„å¤„ç†å™¨ã€‚\n\nåˆ†ç»™æŸä¸ªä»»åŠ¡çš„æ—¶é—´å¤±å»å¹³è¡¡æ—¶ï¼Œåº”ç»™å¤±å»å¹³è¡¡çš„ä»»åŠ¡åˆ†é…æ—¶é—´ï¼Œè®©å…¶æ‰§è¡Œã€‚\n\nCFS é€šè¿‡è™šæ‹Ÿè¿è¡Œæ—¶é—´ï¼ˆvruntimeï¼‰æ¥å®ç°å¹³è¡¡ï¼Œç»´æŠ¤æä¾›ç»™æŸä¸ªä»»åŠ¡çš„æ—¶é—´é‡ã€‚\n\n`vruntime = å®é™…è¿è¡Œæ—¶é—´*1024 / è¿›ç¨‹æƒé‡`\n\nè¿›ç¨‹æŒ‰ç…§å„è‡ªä¸åŒçš„é€Ÿç‡åœ¨ç‰©ç†æ—¶é’ŸèŠ‚æ‹å†…å‰è¿›ï¼Œä¼˜å…ˆçº§é«˜åˆ™æƒé‡å¤§ï¼Œå…¶è™šæ‹Ÿæ—¶é’Ÿæ¯”çœŸå®æ—¶é’Ÿè·‘å¾—æ…¢ï¼Œä½†è·å¾—æ¯”è¾ƒå¤šçš„è¿è¡Œæ—¶é—´ã€‚\n\n### vruntime çº¢é»‘æ ‘\n\nCFS è°ƒåº¦å™¨æ²¡æœ‰å°†è¿›ç¨‹ç»´æŠ¤åœ¨è¿è¡Œé˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯ç»´æŠ¤äº†ä¸€ä¸ªä»¥è™šæ‹Ÿè¿è¡Œæ—¶é—´ä¸ºé¡ºåºçš„çº¢é»‘æ ‘ã€‚ çº¢é»‘æ ‘çš„ä¸»è¦ç‰¹ç‚¹æœ‰ï¼š\n\n1. è‡ªå¹³è¡¡ï¼Œæ ‘ä¸Šæ²¡æœ‰ä¸€æ¡è·¯å¾„ä¼šæ¯”å…¶ä»–è·¯å¾„é•¿å‡ºä¿©å€ã€‚\n\n2. O(log n) æ—¶é—´å¤æ‚åº¦ï¼Œèƒ½å¤Ÿåœ¨æ ‘ä¸Šè¿›è¡Œå¿«é€Ÿé«˜æ•ˆåœ°æ’å…¥æˆ–åˆ é™¤è¿›ç¨‹ã€‚\n\n![image.png](Extras/Images/image_1665679904583_0.png)\n\n## cpuacct å­ç³»ç»Ÿ\n\n* ç”¨äºç»Ÿè®¡ Cgroup åŠå…¶å­ Cgroup ä¸‹è¿›ç¨‹çš„ CPU çš„ä½¿ç”¨æƒ…å†µã€‚\n\t* cpuacct.usage\n\t\t* åŒ…å«è¯¥ Cgroup åŠå…¶å­ Cgroup ä¸‹è¿›ç¨‹ä½¿ç”¨ CPU çš„æ—¶é—´ï¼Œå•ä½æ˜¯ nsï¼ˆçº³ç§’ï¼‰ã€‚\n\t* cpuacct.stat\n\t\t* åŒ…å«è¯¥ Cgroup åŠå…¶å­ Cgroup ä¸‹è¿›ç¨‹ä½¿ç”¨çš„ CPU æ—¶é—´ï¼Œä»¥åŠç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„æ—¶é—´ã€‚\n\n## Memory å­ç³»ç»Ÿ\n\n* memory.usage_in_bytes\n\t* cgroup ä¸‹è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜ï¼ŒåŒ…å« cgroup åŠå…¶å­ cgroup ä¸‹çš„è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜\n* memory.max_usage_in_bytes\n\t* cgroup ä¸‹è¿›ç¨‹ä½¿ç”¨å†…å­˜çš„æœ€å¤§å€¼ï¼ŒåŒ…å«å­ cgroup çš„å†…å­˜ä½¿ç”¨é‡ã€‚\n* memory.limit_in_bytes\n\t* è®¾ç½® cgroup ä¸‹è¿›ç¨‹æœ€å¤šèƒ½ä½¿ç”¨çš„å†…å­˜ã€‚å¦‚æœè®¾ç½®ä¸º -1ï¼Œè¡¨ç¤ºå¯¹è¯¥ cgroup çš„å†…å­˜ä½¿ç”¨ä¸åšé™åˆ¶ã€‚\n* memory.soft_limit_in_bytes\n\t* è¿™ä¸ªé™åˆ¶å¹¶ä¸ä¼šé˜»æ­¢è¿›ç¨‹ä½¿ç”¨è¶…è¿‡é™é¢çš„å†…å­˜ï¼Œåªæ˜¯åœ¨ç³»ç»Ÿå†…å­˜è¶³å¤Ÿæ—¶ï¼Œä¼šä¼˜å…ˆå›æ”¶è¶…è¿‡é™é¢çš„å†…å­˜ï¼Œä½¿ä¹‹å‘é™å®šå€¼é æ‹¢ã€‚\n* memory.oom_control\n\t* **è®¾ç½®æ˜¯å¦åœ¨ Cgroup ä¸­ä½¿ç”¨ OOMï¼ˆOut of Memoryï¼‰Killerï¼Œé»˜è®¤ä¸ºä½¿ç”¨ã€‚å½“å±äºè¯¥ cgroup çš„è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜è¶…è¿‡æœ€å¤§çš„é™å®šå€¼æ—¶ï¼Œä¼šç«‹åˆ»è¢« OOM Killer å¤„ç†ã€‚**\n\n## Cgroup driver\n\n* systemd:\n\t* å½“æ“ä½œç³»ç»Ÿä½¿ç”¨ systemd ä½œä¸º init system æ—¶ï¼Œåˆå§‹åŒ–è¿›ç¨‹ç”Ÿæˆä¸€ä¸ªæ ¹ cgroup ç›®å½•ç»“æ„å¹¶ä½œä¸º cgroupç®¡ç†å™¨ã€‚\n\t* systemd ä¸ cgroup ç´§å¯†ç»“åˆï¼Œå¹¶ä¸”ä¸ºæ¯ä¸ª systemd unit åˆ†é… cgroupã€‚\n* cgroupfs:\n\t* docker é»˜è®¤ç”¨ cgroupfs ä½œä¸º cgroup é©±åŠ¨ã€‚\n* å­˜åœ¨é—®é¢˜ï¼š\n\t* åœ¨ systemd ä½œä¸º init system çš„ç³»ç»Ÿä¸­ï¼Œé»˜è®¤å¹¶å­˜ç€ä¸¤å¥— groupdriverã€‚\n\t* è¿™ä¼šä½¿å¾—ç³»ç»Ÿä¸­ Docker å’Œ kubelet ç®¡ç†çš„è¿›ç¨‹è¢« cgroupfs é©±åŠ¨ç®¡ï¼Œè€Œ systemd æ‹‰èµ·çš„æœåŠ¡ç”±systemd é©±åŠ¨ç®¡ï¼Œè®© cgroup ç®¡ç†æ··ä¹±ä¸”å®¹æ˜“åœ¨èµ„æºç´§å¼ æ—¶å¼•å‘é—®é¢˜ã€‚\n\t* **å› æ­¤ kubelet ä¼šé»˜è®¤--cgroup-driver=systemdï¼Œè‹¥è¿è¡Œæ—¶ cgroup ä¸ä¸€è‡´æ—¶ï¼Œkubelet ä¼šæŠ¥é”™**\n\n# æ–‡ä»¶ç³»ç»Ÿ\n\n## Union FS\n\nå°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹ ï¼ˆunite several directories into a single virtual filesystemï¼‰çš„æ–‡ä»¶ç³»ç»Ÿ\n\næ”¯æŒä¸ºæ¯ä¸€ä¸ªæˆå‘˜ç›®å½•ï¼ˆç±»ä¼¼Git Branchï¼‰è®¾å®š readonlyã€readwrite å’Œ whiteout-able æƒé™\n\næ–‡ä»¶ç³»ç»Ÿåˆ†å±‚, å¯¹ readonly æƒé™çš„ branch å¯ä»¥é€»è¾‘ä¸Šè¿›è¡Œä¿®æ”¹(å¢é‡åœ°, ä¸å½±å“ readonly éƒ¨åˆ†çš„)ã€‚\n\né€šå¸¸ Union FS æœ‰ä¸¤ä¸ªç”¨é€”, ä¸€æ–¹é¢å¯ä»¥å°†å¤šä¸ª disk æŒ‚åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹, å¦ä¸€ä¸ªæ›´å¸¸ç”¨çš„å°±æ˜¯å°†ä¸€ä¸ªreadonly çš„ branch å’Œä¸€ä¸ª writeable çš„ branch è”åˆåœ¨ä¸€èµ·ã€‚\n\n## å®¹å™¨é•œåƒ\n\n![image.png](Extras/Images/image_1665732577611_0.png)\n\n## Overlay FS\n\nOverlayFS ä¹Ÿæ˜¯ä¸€ç§ä¸ AUFS ç±»ä¼¼çš„è”åˆæ–‡ä»¶ç³»ç»Ÿï¼ŒåŒæ ·å±äºæ–‡ä»¶çº§çš„å­˜å‚¨é©±åŠ¨ï¼ŒåŒ…å«äº†æœ€åˆçš„ Overlay å’Œæ›´æ–°æ›´ç¨³å®šçš„ overlay2ã€‚\n\n**Overlay åªæœ‰ä¸¤å±‚ï¼šupper å±‚å’Œ lower å±‚ï¼ŒLower å±‚ä»£è¡¨é•œåƒå±‚ï¼Œupper å±‚ä»£è¡¨å®¹å™¨å¯å†™å±‚ã€‚**\n\n![image.png](Extras/Images/image_1665733112134_0.png)\n\n# ç½‘ç»œ\n\n## Dockerçš„ç½‘ç»œæ¨¡å¼\n\n* Null(--net=None)\n\t* æŠŠå®¹å™¨æ”¾å…¥ç‹¬ç«‹çš„ç½‘ç»œç©ºé—´ä½†ä¸åšä»»ä½•ç½‘ç»œé…ç½®ï¼›\n\t* ç”¨æˆ·éœ€è¦é€šè¿‡è¿è¡Œ docker network å‘½ä»¤æ¥å®Œæˆç½‘ç»œé…ç½®ã€‚\n* Host\n\t* ä½¿ç”¨ä¸»æœºç½‘ç»œåç©ºé—´ï¼Œå¤ç”¨ä¸»æœºç½‘ç»œã€‚\n* Container\n\t* é‡ç”¨å…¶ä»–å®¹å™¨çš„ç½‘ç»œã€‚\n* Bridge(--net=bridge)\n\t* ä½¿ç”¨ Linux ç½‘æ¡¥å’Œ iptables æä¾›å®¹å™¨äº’è”ï¼ŒDocker åœ¨æ¯å°ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåå« docker0çš„ç½‘æ¡¥ï¼Œé€šè¿‡ veth p\n* Overlay(libnetwork, libkv)\n\t* é€šè¿‡ç½‘ç»œå°åŒ…å®ç°ã€‚\n* Remote(work with remote drivers)\n\t* Underlayï¼š\n\t\t* ä½¿ç”¨ç°æœ‰åº•å±‚ç½‘ç»œï¼Œä¸ºæ¯ä¸€ä¸ªå®¹å™¨é…ç½®å¯è·¯ç”±çš„ç½‘ç»œ IPã€‚\n\t* Overlayï¼š\n\t\t* é€šè¿‡ç½‘ç»œå°åŒ…å®ç°\n\n## é»˜è®¤æ¨¡å¼â€“ ç½‘æ¡¥å’Œ NAT\n\n* ä¸ºä¸»æœº eth0 åˆ†é… IP 192.168.0.101ï¼›\n* å¯åŠ¨ docker daemonï¼ŒæŸ¥çœ‹ä¸»æœº iptablesï¼›\n\t* POSTROUTING -A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE\n* åœ¨ä¸»æœºå¯åŠ¨å®¹å™¨ï¼š\n\t* docker run -d --name ssh -p 2333:22 centos-ssh\n\t* Docker ä¼šä»¥æ ‡å‡†æ¨¡å¼é…ç½®ç½‘ç»œï¼š\n\t\t* åˆ›å»º veth pairï¼›\n\t\t* å°† veth pairçš„ä¸€ç«¯è¿æ¥åˆ° docker0 ç½‘æ¡¥ï¼›\n\t\t* veth pair çš„å¦å¤–ä¸€ç«¯è®¾ç½®ä¸ºå®¹å™¨åç©ºé—´çš„ eth0ï¼›\n\t\t* ä¸ºå®¹å™¨åç©ºé—´çš„ eth0 åˆ†é… ipï¼›\n\t\t* ä¸»æœºä¸Šçš„ Iptables è§„åˆ™ï¼šPREROUTING -A DOCKER ! -i docker0 -p tcp -m tcp --dport 2333 -j DNAT --to\u0002destination 172.17.0.2:22ã€‚\n\n![image.png](Extras/Images/image_1665738983058_0.png)\n\n## Underlay\n\né‡‡ç”¨ Linux ç½‘æ¡¥è®¾å¤‡ï¼ˆsbrctlï¼‰ï¼Œé€šè¿‡ç‰©ç†ç½‘ç»œè¿é€šå®¹å™¨ï¼›\n\nåˆ›å»ºæ–°çš„ç½‘æ¡¥è®¾å¤‡ mydr0ï¼›\n\nå°†ä¸»æœºç½‘å¡åŠ å…¥ç½‘æ¡¥ï¼›\n\næŠŠä¸»æœºç½‘å¡çš„åœ°å€é…ç½®åˆ°ç½‘æ¡¥ï¼Œå¹¶æŠŠé»˜è®¤è·¯ç”±è§„åˆ™è½¬ç§»åˆ°ç½‘æ¡¥ mydr0ï¼›\n\nå¯åŠ¨å®¹å™¨ï¼›\n\nåˆ›å»º veth å¯¹ï¼Œå¹¶ä¸”æŠŠä¸€ä¸ª peer æ·»åŠ åˆ°ç½‘æ¡¥ mydr0ï¼›\n\né…ç½®å®¹å™¨æŠŠ veth çš„å¦ä¸€ä¸ª peer åˆ†é…ç»™å®¹å™¨ç½‘å¡ï¼›\n\n![image.png](Extras/Images/image_1665739288260_0.png)\n\n## Docker Libnetwork Overlay\n\nDocker overlay ç½‘ç»œé©±åŠ¨åŸç”Ÿæ”¯æŒå¤šä¸»æœºç½‘ç»œï¼›\n\nLibnetwork æ˜¯ä¸€ä¸ªå†…ç½®çš„åŸºäº VXLAN çš„ç½‘ç»œé©±åŠ¨ã€‚\n\n## VXLAN\n\n![image.png](Extras/Images/image_1665739423844_0.png){:height 580, :width 714}\n\n## Overlay network sample â€“ Flannel\n\nåŒä¸€ä¸»æœºå†…çš„ Pod å¯ä»¥ä½¿ç”¨ç½‘æ¡¥è¿›è¡Œé€šä¿¡ã€‚\n\nä¸åŒä¸»æœºä¸Šçš„ Pod å°†é€šè¿‡flanneld å°†å…¶æµé‡å°è£…åœ¨ UDPæ•°æ®åŒ…ä¸­ ã€‚\n\n![image.png](Extras/Images/image_1665739505611_0.png)","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Docker"]},"/Cards/CS/Docker/Dockerfile":{"title":"Dockerfile","content":"\n# å›é¡¾ 12 Factor ä¹‹è¿›ç¨‹\n\n[[Cards/CS/ç³»ç»Ÿæ¶æ„#12 factors|12 factors]]\n\n* è¿è¡Œç¯å¢ƒä¸­ï¼Œåº”ç”¨ç¨‹åºé€šå¸¸æ˜¯ä»¥ä¸€ä¸ªå’Œå¤šä¸ªè¿›ç¨‹è¿è¡Œçš„ã€‚\n\t* 12-Factor åº”ç”¨çš„è¿›ç¨‹å¿…é¡»æ— çŠ¶æ€ï¼ˆStatelessï¼‰ä¸”æ— å…±äº«ï¼ˆShare nothingï¼‰ã€‚\n* ä»»ä½•éœ€è¦æŒä¹…åŒ–çš„æ•°æ®éƒ½è¦å­˜å‚¨åœ¨åç«¯æœåŠ¡å†…ï¼Œæ¯”å¦‚æ•°æ®åº“ã€‚\n\t* åº”åœ¨æ„å»ºé˜¶æ®µå°†æºä»£ç ç¼–è¯‘æˆå¾…æ‰§è¡Œåº”ç”¨ã€‚\n* Session Sticky æ˜¯ 12-Factor æåŠ›åå¯¹çš„ã€‚\n\t* Session ä¸­çš„æ•°æ®åº”è¯¥ä¿å­˜åœ¨è¯¸å¦‚ Memcached æˆ– Redis è¿™æ ·çš„å¸¦æœ‰è¿‡æœŸæ—¶é—´çš„ç¼“å­˜ä¸­\n* **Docker éµå¾ªä»¥ä¸ŠåŸåˆ™ç®¡ç†å’Œæ„å»ºåº”ç”¨ã€‚**\n\n# ç†è§£æ„å»ºä¸Šä¸‹æ–‡ï¼ˆBuild Contextï¼‰\n\n* å½“è¿è¡Œ docker build å‘½ä»¤æ—¶ï¼Œå½“å‰å·¥ä½œç›®å½•è¢«ç§°ä¸ºæ„å»ºä¸Šä¸‹æ–‡ã€‚\n* docker build é»˜è®¤æŸ¥æ‰¾å½“å‰ç›®å½•çš„ Dockerfile ä½œä¸ºæ„å»ºè¾“å…¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ â€“f æŒ‡å®š Dockerfileã€‚\n\t* `docker build â€“f ./Dockerfile`\n* å½“ docker build è¿è¡Œæ—¶ï¼Œé¦–å…ˆä¼šæŠŠæ„å»ºä¸Šä¸‹æ–‡ä¼ è¾“ç»™ docker daemonï¼ŒæŠŠæ²¡ç”¨çš„æ–‡ä»¶åŒ…å«åœ¨æ„å»ºä¸Šä¸‹æ–‡æ—¶ï¼Œä¼šå¯¼è‡´ä¼ è¾“æ—¶é—´é•¿ï¼Œæ„å»ºéœ€è¦çš„èµ„æºå¤šï¼Œæ„å»ºå‡ºçš„é•œåƒå¤§ç­‰é—®é¢˜ã€‚\n\t* è¯•ç€åˆ°ä¸€ä¸ªåŒ…å«æ–‡ä»¶å¾ˆå¤šçš„ç›®å½•è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä¼šæ„Ÿå—åˆ°å·®å¼‚ï¼›\n\t* `docker build -f $GOPATH/src/github.com/cncamp/golang/httpserver/Dockerfile`\n\t* `docker build $GOPATH/src/github.com/cncamp/golang/httpserver/`\n\t* å¯ä»¥é€šè¿‡.dockerignoreæ–‡ä»¶ä»ç¼–è¯‘ä¸Šä¸‹æ–‡æ’é™¤æŸäº›æ–‡ä»¶ã€‚\n* å› æ­¤éœ€è¦ç¡®ä¿æ„å»ºä¸Šä¸‹æ–‡æ¸…æ™°ï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„ç›®å½•æ”¾ç½® Dockerfileï¼Œå¹¶åœ¨ç›®å½•ä¸­è¿è¡Œ docker buildã€‚\n\n# Build Cache\n\n* æ„å»ºå®¹å™¨é•œåƒæ—¶ï¼ŒDocker ä¾æ¬¡è¯»å– Dockerfile ä¸­çš„æŒ‡ä»¤ï¼Œå¹¶æŒ‰é¡ºåºä¾æ¬¡æ‰§è¡Œæ„å»ºæŒ‡ä»¤ã€‚\n* Docker è¯»å–æŒ‡ä»¤åï¼Œä¼šå…ˆåˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦æœ‰å¯ç”¨çš„å·²å­˜é•œåƒï¼Œåªæœ‰å·²å­˜é•œåƒä¸å­˜åœ¨æ—¶æ‰ä¼šé‡æ–°æ„å»ºã€‚\n\t* é€šå¸¸ Docker ç®€å•åˆ¤æ–­ Dockerfile ä¸­çš„æŒ‡ä»¤ä¸é•œåƒã€‚\n\t* é’ˆå¯¹ ADD å’Œ COPY æŒ‡ä»¤ï¼ŒDocker åˆ¤æ–­è¯¥é•œåƒå±‚æ¯ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹å¹¶ç”Ÿæˆä¸€ä¸ª checksumï¼Œä¸ç°å­˜é•œåƒæ¯”è¾ƒæ—¶ï¼ŒDocker æ¯”è¾ƒçš„æ˜¯äºŒè€…çš„ checksumã€‚\n\t* å…¶ä»–æŒ‡ä»¤ï¼Œæ¯”å¦‚ RUN apt-get -y updateï¼ŒDocker ç®€å•æ¯”è¾ƒä¸ç°å­˜é•œåƒä¸­çš„æŒ‡ä»¤å­—ä¸²æ˜¯å¦ä¸€è‡´ã€‚\n\t* å½“æŸä¸€å±‚ cache å¤±æ•ˆä»¥åï¼Œå‰©ä¸‹æ‰€æœ‰å±‚çº§çš„ cache å‡ä¸€å¹¶å¤±æ•ˆï¼Œåç»­æŒ‡ä»¤éƒ½é‡æ–°æ„å»ºé•œåƒã€‚\n\n# å¤šæ®µæ„å»ºï¼ˆMulti-stage buildï¼‰\n\næœ‰æ•ˆå‡å°‘é•œåƒå±‚çº§çš„æ–¹å¼\n\n``` Dockerfile\nFROM golang:1.16-alpine AS build\nRUN apk add --no-cache git\nRUN go get github.com/golang/dep/cmd/dep\nCOPY Gopkg.lock Gopkg.toml /go/src/project/\nWORKDIR /go/src/project/\nRUN dep ensure -vendor-only\nCOPY . /go/src/project/\nRUN go build -o /bin/projectï¼ˆåªæœ‰è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯äº§çº¿éœ€è¦çš„ï¼Œå…¶ä»–éƒ½æ˜¯wasteï¼‰\nFROM scratch\nCOPY --from=build /bin/project /bin/project\nENTRYPOINT [\"/bin/project\"]\nCMD [\"--help\"]\n```\n\n# Dockerfile æœ€ä½³å®è·µ\n\n* ä¸è¦å®‰è£…æ— æ•ˆè½¯ä»¶åŒ…ã€‚\n* åº”ç®€åŒ–é•œåƒä¸­åŒæ—¶è¿è¡Œçš„è¿›ç¨‹æ•°ï¼Œç†æƒ³çŠ¶å†µä¸‹ï¼Œæ¯ä¸ªé•œåƒåº”è¯¥åªæœ‰ä¸€ä¸ªè¿›ç¨‹ã€‚\n* å½“æ— æ³•é¿å…åŒä¸€é•œåƒè¿è¡Œå¤šè¿›ç¨‹æ—¶ï¼Œåº”é€‰æ‹©åˆç†çš„åˆå§‹åŒ–è¿›ç¨‹ï¼ˆinit processï¼‰ã€‚\n* æœ€å°åŒ–å±‚çº§æ•°\n\t* æœ€æ–°çš„ docker åªæœ‰ RUNï¼Œ COPYï¼ŒADD åˆ›å»ºæ–°å±‚ï¼Œå…¶ä»–æŒ‡ä»¤åˆ›å»ºä¸´æ—¶å±‚ï¼Œä¸ä¼šå¢åŠ é•œåƒå¤§å°ã€‚\n\t\t* æ¯”å¦‚ EXPOSE æŒ‡ä»¤å°±ä¸ä¼šç”Ÿæˆæ–°å±‚ã€‚\n\t* å¤šæ¡ RUN å‘½ä»¤å¯é€šè¿‡è¿æ¥ç¬¦è¿æ¥æˆä¸€æ¡æŒ‡ä»¤é›†ä»¥å‡å°‘å±‚æ•°ã€‚\n\t* é€šè¿‡å¤šæ®µæ„å»ºå‡å°‘é•œåƒå±‚æ•°ã€‚\n* æŠŠå¤šè¡Œå‚æ•°æŒ‰å­—æ¯æ’åºï¼Œå¯ä»¥å‡å°‘å¯èƒ½å‡ºç°çš„é‡å¤å‚æ•°ï¼Œå¹¶ä¸”æé«˜å¯è¯»æ€§ã€‚\n* ç¼–å†™ dockerfile çš„æ—¶å€™ï¼Œåº”è¯¥æŠŠå˜æ›´é¢‘ç‡ä½çš„ç¼–è¯‘æŒ‡ä»¤ä¼˜å…ˆæ„å»ºä»¥ä¾¿æ”¾åœ¨é•œåƒåº•å±‚ä»¥æœ‰æ•ˆåˆ©ç”¨ build cacheã€‚\n* å¤åˆ¶æ–‡ä»¶æ—¶ï¼Œæ¯ä¸ªæ–‡ä»¶åº”ç‹¬ç«‹å¤åˆ¶ï¼Œè¿™ç¡®ä¿æŸä¸ªæ–‡ä»¶å˜æ›´æ—¶ï¼Œåªå½±å“æ”¹æ–‡ä»¶å¯¹åº”çš„ç¼“å­˜ã€‚\n\n**ç›®æ ‡ï¼šæ˜“ç®¡ç†ã€å°‘æ¼æ´ã€é•œåƒå°ã€å±‚çº§å°‘ã€åˆ©ç”¨ç¼“å­˜ã€‚** ^bb5784\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Docker"]},"/Cards/CS/ElasticSearch/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98":{"title":"å¸¸è§é—®é¢˜","content":"\n## SearchåŠ .keywordä¸ä¸åŠ .keywordçš„åŒºåˆ«ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰ç»“æœ\n\n\u003e [https://segmentfault.com/q/1010000017312707](https://segmentfault.com/q/1010000017312707)\n\n```bash\nGET production-index-info/index_info/_search\n{\n  \"query\": {\n    \"bool\": {\n      \"minimum_should_match\": 0,\n      \"must\": [\n        {\n          \"term\": {\n            \"is_resolved.keyword\": \"è§£å†³\"\n          }\n        }\n      ],\n      \"should\": []\n    }\n  }\n}\n```\n\n1. ES5.0åŠä»¥åçš„ç‰ˆæœ¬å–æ¶ˆäº†stringç±»å‹ï¼Œå°†åŸå…ˆçš„stringç±»å‹æ‹†åˆ†ä¸ºtextå’Œkeywordä¸¤ç§ç±»å‹ã€‚å®ƒä»¬çš„åŒºåˆ«åœ¨äºtextä¼šå¯¹å­—æ®µè¿›è¡Œåˆ†è¯å¤„ç†è€Œkeywordåˆ™ä¸ä¼šã€‚\n\n2. å½“ä½ æ²¡æœ‰ä»¥IndexTemplateç­‰å½¢å¼ä¸ºä½ çš„ç´¢å¼•å­—æ®µé¢„å…ˆæŒ‡å®šmappingçš„è¯ï¼ŒESå°±ä¼šä½¿ç”¨Dynamic Mappingï¼Œé€šè¿‡æ¨æ–­ä½ ä¼ å…¥çš„æ–‡æ¡£ä¸­å­—æ®µçš„å€¼å¯¹å­—æ®µè¿›è¡ŒåŠ¨æ€æ˜ å°„ã€‚ä¾‹å¦‚ä¼ å…¥çš„æ–‡æ¡£ä¸­å­—æ®µpriceçš„å€¼ä¸º12ï¼Œé‚£ä¹ˆpriceå°†è¢«æ˜ å°„ä¸ºlongç±»å‹ï¼›å­—æ®µaddrçš„å€¼ä¸º\"192.168.0.1\"ï¼Œé‚£ä¹ˆaddrå°†è¢«æ˜ å°„ä¸ºipç±»å‹ã€‚ç„¶è€Œå¯¹äºä¸æ»¡è¶³ipå’Œdateæ ¼å¼çš„æ™®é€šå­—ç¬¦ä¸²æ¥è¯´ï¼Œæƒ…å†µæœ‰äº›ä¸åŒï¼šESä¼šå°†å®ƒä»¬æ˜ å°„ä¸ºtextç±»å‹ï¼Œä½†ä¸ºäº†ä¿ç•™å¯¹è¿™äº›å­—æ®µåšç²¾ç¡®æŸ¥è¯¢ä»¥åŠèšåˆçš„èƒ½åŠ›ï¼ŒåˆåŒæ—¶å¯¹å®ƒä»¬åšäº†keywordç±»å‹çš„æ˜ å°„ï¼Œä½œä¸ºè¯¥å­—æ®µçš„fieldså±æ€§å†™åˆ°_mappingä¸­ã€‚ä¾‹å¦‚ï¼Œå½“ESé‡åˆ°ä¸€ä¸ªæ–°çš„å­—æ®µ\"foobar\": \"some string\"æ—¶ï¼Œä¼šå¯¹å®ƒåšå¦‚ä¸‹çš„Dynamic Mappingï¼š\n\n```bash\n{\n    \"foobar\": {\n        \"type\" \"text\",\n        \"fields\": {\n            \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n            }\n        }\n    }\n}\n```\n\nåœ¨ä¹‹åçš„æŸ¥è¯¢ä¸­ä½¿ç”¨foobaræ˜¯å°†foobarä½œä¸ºtextç±»å‹æŸ¥è¯¢ï¼Œè€Œä½¿ç”¨foobar.keywordåˆ™æ˜¯å°†foobarä½œä¸ºkeywordç±»å‹æŸ¥è¯¢ã€‚å‰è€…ä¼šå¯¹æŸ¥è¯¢å†…å®¹åšåˆ†è¯å¤„ç†ä¹‹åå†åŒ¹é…ï¼Œè€Œåè€…åˆ™æ˜¯ç›´æ¥å¯¹æŸ¥è¯¢ç»“æœåšç²¾ç¡®åŒ¹é…ã€‚\n\n3. ESçš„term queryåšçš„æ˜¯ç²¾ç¡®åŒ¹é…è€Œä¸æ˜¯åˆ†è¯æŸ¥è¯¢ï¼Œå› æ­¤å¯¹textç±»å‹çš„å­—æ®µåštermæŸ¥è¯¢å°†æ˜¯æŸ¥ä¸åˆ°ç»“æœçš„ï¼ˆé™¤éå­—æ®µæœ¬èº«ç»è¿‡åˆ†è¯å™¨å¤„ç†åä¸å˜ï¼Œæœªè¢«è½¬æ¢æˆ–åˆ†è¯ï¼‰ã€‚æ­¤æ—¶ï¼Œå¿…é¡»ä½¿ç”¨foobar.keywordæ¥å¯¹foobarå­—æ®µä»¥keywordç±»å‹è¿›è¡Œç²¾ç¡®åŒ¹é…ã€‚\n\n**å‚è€ƒèµ„æ–™**\n\n1. [Elasticsearchä¸­Textå’ŒKeywordç±»å‹çš„åŒºåˆ«](https://www.jianshu.com/p/f5d548559791)\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/ElasticSearch"]},"/Cards/CS/ElasticSearch/%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB":{"title":"æ•°æ®è¿ç§»","content":"\n# Elasticdump\n\né€‚åˆæ•°æ®é‡è¾ƒå°â€‹â€‹çš„åœºæ™¯\n\n`elasticdump --input=${SOURCE_ES}/$index --output=${DESTINATION_ES}/$index --type data --limit 1000 --overwrite true`\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/ElasticSearch"]},"/Cards/CS/ElasticSearch/%E6%9F%A5%E8%AF%A2%E4%B8%8E%E8%81%9A%E5%90%88":{"title":"æŸ¥è¯¢ä¸èšåˆ","content":"\n# æŸ¥è¯¢å’Œèšåˆçš„åŸºç¡€ä½¿ç”¨\n\n## æŸ¥è¯¢æ•°æ®\n\n### æŸ¥è¯¢æ‰€æœ‰\n\n`match_all`è¡¨ç¤ºæŸ¥è¯¢æ‰€æœ‰çš„æ•°æ®ï¼Œ`sort`å³æŒ‰ç…§ä»€ä¹ˆå­—æ®µæ’åº\n\n```bash\nGET /bank/_search\n{\n\"query\": { \"match_all\": {} },\n\"sort\": [\n  { \"account_number\": \"asc\" }\n]\n}\n```\n\nç»“æœ\n\n![Untitled.png](Extras/Images/Untitled_1669983783135_0.png)\n\nç›¸å…³å­—æ®µè§£é‡Š\n\n`took` â€“ Elasticsearchè¿è¡ŒæŸ¥è¯¢æ‰€èŠ±è´¹çš„æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰\n\n`timed_out` â€“æœç´¢è¯·æ±‚æ˜¯å¦è¶…æ—¶\n\n`_shards` - æœç´¢äº†å¤šå°‘ä¸ªç¢ç‰‡ï¼Œä»¥åŠæˆåŠŸï¼Œå¤±è´¥æˆ–è·³è¿‡äº†å¤šå°‘ä¸ªç¢ç‰‡çš„ç»†ç›®åˆ†ç±»ã€‚\n\n`max_score` â€“ æ‰¾åˆ°çš„æœ€ç›¸å…³æ–‡æ¡£çš„åˆ†æ•°\n\n`hits.total.value` - æ‰¾åˆ°äº†å¤šå°‘ä¸ªåŒ¹é…çš„æ–‡æ¡£\n\n`hits.sort` - æ–‡æ¡£çš„æ’åºä½ç½®ï¼ˆä¸æŒ‰ç›¸å…³æ€§å¾—åˆ†æ’åºæ—¶ï¼‰\n\n`hits._score` - æ–‡æ¡£çš„ç›¸å…³æ€§å¾—åˆ†ï¼ˆä½¿ç”¨match_allæ—¶ä¸é€‚ç”¨ï¼‰\n\n### åˆ†é¡µæŸ¥è¯¢(from+size)\n\næœ¬è´¨ä¸Šå°±æ˜¯fromå’Œsizeä¸¤ä¸ªå­—æ®µ\n\n```bash\nGET /bank/_search\n{\n\"query\": { \"match_all\": {} },\n\"sort\": [\n  { \"account_number\": \"asc\" }\n],\n\"from\": 10,\n\"size\": 10\n}\n```\n\n### æŒ‡å®šå­—æ®µæŸ¥è¯¢ï¼šmatch\n\nå¦‚æœè¦åœ¨å­—æ®µä¸­æœç´¢ç‰¹å®šå­—è¯ï¼Œå¯ä»¥ä½¿ç”¨`match`; å¦‚ä¸‹è¯­å¥å°†æŸ¥è¯¢address å­—æ®µä¸­åŒ…å« mill æˆ–è€… laneçš„æ•°æ®\n\n```bash\nGET /bank/_search\n{\n\"query\": { \"match\": { \"address\": \"mill lane\" } }\n}\n```\n\n### æŸ¥è¯¢æ®µè½åŒ¹é…ï¼šmatch_phrase\n\nå¦‚æœæˆ‘ä»¬å¸Œæœ›æŸ¥è¯¢çš„æ¡ä»¶æ˜¯ addresså­—æ®µä¸­åŒ…å« \"mill lane\"ï¼Œåˆ™å¯ä»¥ä½¿ç”¨`match_phrase`\n\n```bash\nGET /bank/_search\n{\n\"query\": { \"match_phrase\": { \"address\": \"mill lane\" } }\n}\n```\n\n### å¤šæ¡ä»¶æŸ¥è¯¢: bool\n\nå¦‚æœè¦æ„é€ æ›´å¤æ‚çš„æŸ¥è¯¢ï¼Œå¯ä»¥ä½¿ç”¨`bool`æŸ¥è¯¢æ¥ç»„åˆå¤šä¸ªæŸ¥è¯¢æ¡ä»¶ã€‚\n\nä¾‹å¦‚ï¼Œä»¥ä¸‹è¯·æ±‚åœ¨bankç´¢å¼•ä¸­æœç´¢40å²å®¢æˆ·çš„å¸æˆ·ï¼Œä½†ä¸åŒ…æ‹¬å±…ä½åœ¨çˆ±è¾¾è·å·ï¼ˆIDï¼‰çš„ä»»ä½•äºº\n\n```bash\nGET /bank/_search\n{\n\"query\": {\n  \"bool\": {\n    \"must\": [\n      { \"match\": { \"age\": \"40\" } }\n    ],\n    \"must_not\": [\n      { \"match\": { \"state\": \"ID\" } }\n    ]\n  }\n}\n}\n```\n\n### æŸ¥è¯¢æ¡ä»¶ï¼šquery or filter\n\nå…ˆçœ‹ä¸‹å¦‚ä¸‹æŸ¥è¯¢, åœ¨`bool`æŸ¥è¯¢çš„å­å¥ä¸­åŒæ—¶å…·å¤‡query/must å’Œ filter\n\n```bash\nGET /bank/_search\n{\n\"query\": {\n  \"bool\": {\n    \"must\": [\n      {\n        \"match\": {\n          \"state\": \"ND\"\n        }\n      }\n    ],\n    \"filter\": [\n      {\n        \"term\": {\n          \"age\": \"40\"\n        }\n      },\n      {\n        \"range\": {\n          \"balance\": {\n            \"gte\": 20000,\n            \"lte\": 30000\n          }\n        }\n      }\n    ]\n  }\n}\n}\n```\n\nä¸¤è€…éƒ½å¯ä»¥å†™æŸ¥è¯¢æ¡ä»¶ï¼Œè€Œä¸”è¯­æ³•ä¹Ÿç±»ä¼¼ã€‚åŒºåˆ«åœ¨äºï¼Œ**query ä¸Šä¸‹æ–‡çš„æ¡ä»¶æ˜¯ç”¨æ¥ç»™æ–‡æ¡£æ‰“åˆ†çš„ï¼ŒåŒ¹é…è¶Šå¥½ \\_score è¶Šé«˜ï¼›filter çš„æ¡ä»¶åªäº§ç”Ÿä¸¤ç§ç»“æœï¼šç¬¦åˆä¸ä¸ç¬¦åˆï¼Œåè€…è¢«è¿‡æ»¤æ‰**ã€‚\n\n## èšåˆæŸ¥è¯¢ï¼šAggregation\n\n\u003e æˆ‘ä»¬çŸ¥é“SQLä¸­æœ‰group byï¼Œåœ¨ESä¸­å®ƒå«Aggregationï¼Œå³èšåˆè¿ç®—ã€‚\n\n### ç®€å•èšåˆ\n\næ¯”å¦‚æˆ‘ä»¬å¸Œæœ›è®¡ç®—å‡ºaccountæ¯ä¸ªå·çš„ç»Ÿè®¡æ•°é‡ï¼Œ ä½¿ç”¨`aggs`å…³é”®å­—å¯¹`state`å­—æ®µèšåˆï¼Œè¢«èšåˆçš„å­—æ®µæ— éœ€å¯¹åˆ†è¯ç»Ÿè®¡ï¼Œæ‰€ä»¥ä½¿ç”¨`state.keyword`å¯¹æ•´ä¸ªå­—æ®µç»Ÿè®¡\n\n```bash\nGET /bank/_search\n{\n\"size\": 0,\n\"aggs\": {\n  \"group_by_state\": {\n    \"terms\": {\n      \"field\": \"state.keyword\"\n    }\n  }\n}\n}\n```\n\n![Untitled 1.png](Extras/Images/Untitled_1_1669984087231_0.png)\n\nå› ä¸ºæ— éœ€è¿”å›æ¡ä»¶çš„å…·ä½“æ•°æ®, æ‰€ä»¥è®¾ç½®size=0ï¼Œè¿”å›hitsä¸ºç©ºã€‚\n\n`doc_count`è¡¨ç¤ºbucketä¸­æ¯ä¸ªå·çš„æ•°æ®æ¡æ•°ã€‚\n\n### åµŒå¥—èšåˆ\n\nESè¿˜å¯ä»¥å¤„ç†ä¸ªèšåˆæ¡ä»¶çš„åµŒå¥—ã€‚\n\næ¯”å¦‚æ‰¿æ¥ä¸Šä¸ªä¾‹å­ï¼Œ è®¡ç®—æ¯ä¸ªå·çš„å¹³å‡ç»“ä½™ã€‚æ¶‰åŠåˆ°çš„å°±æ˜¯åœ¨å¯¹stateåˆ†ç»„çš„åŸºç¡€ä¸Šï¼ŒåµŒå¥—è®¡ç®—avg(balance):\n\n```bash\nGET /bank/_search\n{\n\"size\": 0,\n\"aggs\": {\n  \"group_by_state\": {\n    \"terms\": {\n      \"field\": \"state.keyword\"\n    },\n    \"aggs\": {\n      \"average_balance\": {\n        \"avg\": {\n          \"field\": \"balance\"\n        }\n      }\n    }\n  }\n}\n}\n```\n\n### å¯¹èšåˆç»“æœæ’åº\n\nå¯ä»¥é€šè¿‡åœ¨aggsä¸­å¯¹åµŒå¥—èšåˆçš„ç»“æœè¿›è¡Œæ’åº\n\næ¯”å¦‚æ‰¿æ¥ä¸Šä¸ªä¾‹å­ï¼Œ å¯¹åµŒå¥—è®¡ç®—å‡ºçš„avg(balance)ï¼Œè¿™é‡Œæ˜¯average_balanceï¼Œè¿›è¡Œæ’åº\n\n```bash\nGET /bank/_search\n{\n\"size\": 0,\n\"aggs\": {\n  \"group_by_state\": {\n    \"terms\": {\n      \"field\": \"state.keyword\",\n      \"order\": {\n        \"average_balance\": \"desc\"\n      }\n    },\n    \"aggs\": {\n      \"average_balance\": {\n        \"avg\": {\n          \"field\": \"balance\"\n        }\n      }\n    }\n  }\n}\n}\n```\n\n![Untitled 2.png](Extras/Images/Untitled_2_1669984227451_0.png)\n\n# DSLæŸ¥è¯¢\n\n## å¤åˆæŸ¥è¯¢è¯¦è§£\n\n### å¤åˆæŸ¥è¯¢å¼•å…¥\n\nä½¿ç”¨`bool`æŸ¥è¯¢æ¥ç»„åˆå¤šä¸ªæŸ¥è¯¢æ¡ä»¶ã€‚\n\næ¯”å¦‚ä¹‹å‰ä»‹ç»çš„è¯­å¥\n\n```bash\nGET /bank/_search\n{\n\"query\": {\n  \"bool\": {\n    \"must\": [\n      { \"match\": { \"age\": \"40\" } }\n    ],\n    \"must_not\": [\n      { \"match\": { \"state\": \"ID\" } }\n    ]\n  }\n}\n}\n```\nè¿™ç§æŸ¥è¯¢å°±æ˜¯æœ¬æ–‡è¦ä»‹ç»çš„**å¤åˆæŸ¥è¯¢**ï¼Œå¹¶ä¸”boolæŸ¥è¯¢åªæ˜¯å¤åˆæŸ¥è¯¢ä¸€ç§ã€‚\n\n### bool query(å¸ƒå°”æŸ¥è¯¢)\n\n\u003e é€šè¿‡å¸ƒå°”é€»è¾‘å°†è¾ƒå°çš„æŸ¥è¯¢ç»„åˆæˆè¾ƒå¤§çš„æŸ¥è¯¢ã€‚\n\n#### æ¦‚å¿µ\n\nBoolæŸ¥è¯¢è¯­æ³•æœ‰ä»¥ä¸‹ç‰¹ç‚¹\n\nå­æŸ¥è¯¢å¯ä»¥ä»»æ„é¡ºåºå‡ºç°\n\nå¯ä»¥åµŒå¥—å¤šä¸ªæŸ¥è¯¢ï¼ŒåŒ…æ‹¬boolæŸ¥è¯¢\n\nå¦‚æœboolæŸ¥è¯¢ä¸­æ²¡æœ‰mustæ¡ä»¶ï¼Œshouldä¸­å¿…é¡»è‡³å°‘æ»¡è¶³ä¸€æ¡æ‰ä¼šè¿”å›ç»“æœã€‚\n\nboolæŸ¥è¯¢åŒ…å«å››ç§æ“ä½œç¬¦ï¼Œåˆ†åˆ«æ˜¯must,should,must_not,filterã€‚ä»–ä»¬å‡æ˜¯ä¸€ç§æ•°ç»„ï¼Œæ•°ç»„é‡Œé¢æ˜¯å¯¹åº”çš„åˆ¤æ–­æ¡ä»¶ã€‚\n\n`must`ï¼š å¿…é¡»åŒ¹é…ã€‚è´¡çŒ®ç®—åˆ†\n\n`must_not`ï¼šè¿‡æ»¤å­å¥ï¼Œå¿…é¡»ä¸èƒ½åŒ¹é…ï¼Œä½†ä¸è´¡çŒ®ç®—åˆ†\n\n`should`ï¼š é€‰æ‹©æ€§åŒ¹é…ï¼Œè‡³å°‘æ»¡è¶³ä¸€æ¡ã€‚è´¡çŒ®ç®—åˆ†\n\n`filter`ï¼š è¿‡æ»¤å­å¥ï¼Œå¿…é¡»åŒ¹é…ï¼Œä½†ä¸è´¡çŒ®ç®—åˆ†\n\n#### ä¾‹å­\n\n```bash\nPOST _search\n{\n\"query\": {\n  \"bool\" : {\n    \"must\" : {\n      \"term\" : { \"user.id\" : \"kimchy\" }\n    },\n    \"filter\": {\n      \"term\" : { \"tags\" : \"production\" }\n    },\n    \"must_not\" : {\n      \"range\" : {\n        \"age\" : { \"gte\" : 10, \"lte\" : 20 }\n      }\n    },\n    \"should\" : [\n      { \"term\" : { \"tags\" : \"env1\" } },\n      { \"term\" : { \"tags\" : \"deployed\" } }\n    ],\n    \"minimum_should_match\" : 1,\n    \"boost\" : 1.0\n  }\n}\n}\n```\n\n### boosting query(æé«˜æŸ¥è¯¢)\n\n\u003e ä¸åŒäºboolæŸ¥è¯¢ï¼ŒboolæŸ¥è¯¢ä¸­åªè¦ä¸€ä¸ªå­æŸ¥è¯¢æ¡ä»¶ä¸åŒ¹é…é‚£ä¹ˆæœç´¢çš„æ•°æ®å°±ä¸ä¼šå‡ºç°ã€‚è€Œboosting queryåˆ™æ˜¯é™ä½æ˜¾ç¤ºçš„æƒé‡/ä¼˜å…ˆçº§ï¼ˆå³score)ã€‚\n\n#### æ¦‚å¿µ\n\næ¯”å¦‚æœç´¢é€»è¾‘æ˜¯ name = 'apple' and type ='fruit'ï¼Œå¯¹äºåªæ»¡è¶³éƒ¨åˆ†æ¡ä»¶çš„æ•°æ®ï¼Œä¸æ˜¯ä¸æ˜¾ç¤ºï¼Œè€Œæ˜¯é™ä½æ˜¾ç¤ºçš„ä¼˜å…ˆçº§ï¼ˆå³score)\n\n#### ä¾‹å­\n\né¦–å…ˆåˆ›å»ºæ•°æ®\n\n```bash\nPOST /test-dsl-boosting/_bulk\n{ \"index\": { \"_id\": 1 }}\n{ \"content\":\"Apple Mac\" }\n{ \"index\": { \"_id\": 2 }}\n{ \"content\":\"Apple Fruit\" }\n{ \"index\": { \"_id\": 3 }}\n{ \"content\":\"Apple employee like Apple Pie and Apple Juice\" }\n```\n\nå¯¹åŒ¹é…`pie`çš„åšé™çº§æ˜¾ç¤ºå¤„ç†\n\n```bash\nGET /test-dsl-boosting/_search\n{\n\"query\": {\n  \"boosting\": {\n    \"positive\": {\n      \"term\": {\n        \"content\": \"apple\"\n      }\n    },\n    \"negative\": {\n      \"term\": {\n        \"content\": \"pie\"\n      }\n    },\n    \"negative_boost\": 0.5\n  }\n}\n}\n```\n\næ‰§è¡Œç»“æœå¦‚ä¸‹\n\n![Untitled 3.png](Extras/Images/Untitled_3_1669984452609_0.png)\n\n### constant_scoreï¼ˆå›ºå®šåˆ†æ•°æŸ¥è¯¢ï¼‰\n\n\u003e æŸ¥è¯¢æŸä¸ªæ¡ä»¶æ—¶ï¼Œå›ºå®šçš„è¿”å›æŒ‡å®šçš„scoreï¼›æ˜¾ç„¶å½“ä¸éœ€è¦è®¡ç®—scoreæ—¶ï¼Œåªéœ€è¦filteræ¡ä»¶å³å¯ï¼Œå› ä¸ºfilter contextå¿½ç•¥scoreã€‚\n\n#### ä¾‹å­\n\né¦–å…ˆåˆ›å»ºæ•°æ®\n\n```bash\nPOST /test-dsl-constant/_bulk\n{ \"index\": { \"_id\": 1 }}\n{ \"content\":\"Apple Mac\" }\n{ \"index\": { \"_id\": 2 }}\n{ \"content\":\"Apple Fruit\" }\n```\n\næŸ¥è¯¢apple\n\n```bash\nGET /test-dsl-constant/_search\n{\n\"query\": {\n  \"constant_score\": {\n    \"filter\": {\n      \"term\": { \"content\": \"apple\" }\n    },\n    \"boost\": 1.2\n  }\n}\n}\n```\n\n![Untitled 4.png](Extras/Images/Untitled_4_1669984505827_0.png)\n\n### dis_max(æœ€ä½³åŒ¹é…æŸ¥è¯¢ï¼‰\n\n\u003e åˆ†ç¦»æœ€å¤§åŒ–æŸ¥è¯¢ï¼ˆDisjunction Max Queryï¼‰æŒ‡çš„æ˜¯ï¼š å°†ä»»ä½•ä¸ä»»ä¸€æŸ¥è¯¢åŒ¹é…çš„æ–‡æ¡£ä½œä¸ºç»“æœè¿”å›ï¼Œä½†åªå°†æœ€ä½³åŒ¹é…çš„è¯„åˆ†ä½œä¸ºæŸ¥è¯¢çš„è¯„åˆ†ç»“æœè¿”å› ã€‚\n\n#### ä¾‹å­\n\nå‡è®¾æœ‰ä¸ªç½‘ç«™å…è®¸ç”¨æˆ·æœç´¢åšå®¢çš„å†…å®¹ï¼Œä»¥ä¸‹é¢ä¸¤ç¯‡åšå®¢å†…å®¹æ–‡æ¡£ä¸ºä¾‹ï¼š\n\n```bash\nPOST /test-dsl-dis-max/_bulk\n{ \"index\": { \"_id\": 1 }}\n{\"title\": \"Quick brown rabbits\",\"body\":  \"Brown rabbits are commonly seen.\"}\n{ \"index\": { \"_id\": 2 }}\n{\"title\": \"Keeping pets healthy\",\"body\":  \"My quick brown fox eats rabbits on a regular basis.\"}\n```\n\nç”¨æˆ·è¾“å…¥è¯ç»„ â€œBrown foxâ€ ç„¶åç‚¹å‡»æœç´¢æŒ‰é’®ã€‚äº‹å…ˆï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“ç”¨æˆ·çš„æœç´¢é¡¹æ˜¯ä¼šåœ¨ title è¿˜æ˜¯åœ¨ body å­—æ®µä¸­è¢«æ‰¾åˆ°ï¼Œä½†æ˜¯ï¼Œç”¨æˆ·å¾ˆæœ‰å¯èƒ½æ˜¯æƒ³æœç´¢ç›¸å…³çš„è¯ç»„ã€‚ç”¨è‚‰çœ¼åˆ¤æ–­ï¼Œæ–‡æ¡£ 2 çš„åŒ¹é…åº¦æ›´é«˜ï¼Œå› ä¸ºå®ƒåŒæ—¶åŒ…æ‹¬è¦æŸ¥æ‰¾çš„ä¸¤ä¸ªè¯ï¼š\n\nç°åœ¨è¿è¡Œä»¥ä¸‹ bool æŸ¥è¯¢ï¼š\n\n```bash\nGET /test-dsl-dis-max/_search\n{\n  \"query\": {\n      \"bool\": {\n          \"should\": [\n              { \"match\": { \"title\": \"Brown fox\" }},\n              { \"match\": { \"body\":  \"Brown fox\" }}\n          ]\n      }\n  }\n}\n```\n\n![Untitled 5.png](Extras/Images/Untitled_5_1669984671810_0.png)\n\n**å¼•å…¥äº†dis_max**\n\nä¸ä½¿ç”¨ bool æŸ¥è¯¢ï¼Œå¯ä»¥ä½¿ç”¨ dis_max å³åˆ†ç¦» æœ€å¤§åŒ–æŸ¥è¯¢ï¼ˆDisjunction Max Queryï¼‰ ã€‚åˆ†ç¦»ï¼ˆDisjunctionï¼‰çš„æ„æ€æ˜¯ æˆ–ï¼ˆorï¼‰ ï¼Œè¿™ä¸å¯ä»¥æŠŠç»“åˆï¼ˆconjunctionï¼‰ç†è§£æˆ ä¸ï¼ˆandï¼‰ ç›¸å¯¹åº”ã€‚åˆ†ç¦»æœ€å¤§åŒ–æŸ¥è¯¢ï¼ˆDisjunction Max Queryï¼‰æŒ‡çš„æ˜¯ï¼š å°†ä»»ä½•ä¸ä»»ä¸€æŸ¥è¯¢åŒ¹é…çš„æ–‡æ¡£ä½œä¸ºç»“æœè¿”å›ï¼Œä½†åªå°†æœ€ä½³åŒ¹é…çš„è¯„åˆ†ä½œä¸ºæŸ¥è¯¢çš„è¯„åˆ†ç»“æœè¿”å› ï¼š\n\n```bash\nGET /test-dsl-dis-max/_search\n{\n  \"query\": {\n      \"dis_max\": {\n          \"queries\": [\n              { \"match\": { \"title\": \"Brown fox\" }},\n              { \"match\": { \"body\":  \"Brown fox\" }}\n          ],\n          \"tie_breaker\": 0\n      }\n  }\n}\n```\n\n![Untitled 6.png](Extras/Images/Untitled_6_1669984695930_0.png)\n\n### function_score(å‡½æ•°æŸ¥è¯¢ï¼‰\n\n\u003e ç®€è€Œè¨€ä¹‹å°±æ˜¯ç”¨è‡ªå®šä¹‰functionçš„æ–¹å¼æ¥è®¡ç®—_scoreã€‚\n\nå¯ä»¥ESæœ‰å“ªäº›è‡ªå®šä¹‰functionå‘¢ï¼Ÿ\n\n`script_score` ä½¿ç”¨è‡ªå®šä¹‰çš„è„šæœ¬æ¥å®Œå…¨æ§åˆ¶åˆ†å€¼è®¡ç®—é€»è¾‘ã€‚å¦‚æœä½ éœ€è¦ä»¥ä¸Šé¢„å®šä¹‰å‡½æ•°ä¹‹å¤–çš„åŠŸèƒ½ï¼Œå¯ä»¥æ ¹æ®éœ€è¦é€šè¿‡è„šæœ¬è¿›è¡Œå®ç°ã€‚\n\n`weight` å¯¹æ¯ä»½æ–‡æ¡£é€‚ç”¨ä¸€ä¸ªç®€å•çš„æå‡ï¼Œä¸”è¯¥æå‡ä¸ä¼šè¢«å½’çº¦ï¼šå½“weightä¸º2æ—¶ï¼Œç»“æœä¸º2 * _scoreã€‚\n\n`random_score` ä½¿ç”¨ä¸€è‡´æ€§éšæœºåˆ†å€¼è®¡ç®—æ¥å¯¹æ¯ä¸ªç”¨æˆ·é‡‡ç”¨ä¸åŒçš„ç»“æœæ’åºæ–¹å¼ï¼Œå¯¹ç›¸åŒç”¨æˆ·ä»ç„¶ä½¿ç”¨ç›¸åŒçš„æ’åºæ–¹å¼ã€‚\n\n`field_value_factor` ä½¿ç”¨æ–‡æ¡£ä¸­æŸä¸ªå­—æ®µçš„å€¼æ¥æ”¹å˜_scoreï¼Œæ¯”å¦‚å°†å—æ¬¢è¿ç¨‹åº¦æˆ–è€…æŠ•ç¥¨æ•°é‡è€ƒè™‘åœ¨å†…ã€‚\n\n`è¡°å‡å‡½æ•°(Decay Function)` - `linear`ï¼Œ`exp`ï¼Œ`gauss`\n\n## å…¨æ–‡æœç´¢è¯¦è§£\n\n\u003e DSLæŸ¥è¯¢æä¸ºå¸¸ç”¨çš„æ˜¯å¯¹æ–‡æœ¬è¿›è¡Œæœç´¢ï¼Œæˆ‘ä»¬å«å…¨æ–‡æœç´¢ï¼Œæœ¬æ–‡ä¸»è¦å¯¹å…¨æ–‡æœç´¢è¿›è¡Œè¯¦è§£ã€‚\n\n### Matchç±»å‹\n\n#### match æŸ¥è¯¢çš„æ­¥éª¤\n\n**å‡†å¤‡ä¸€äº›æ•°æ®**\n\nè¿™é‡Œæˆ‘ä»¬å‡†å¤‡ä¸€äº›æ•°æ®ï¼Œé€šè¿‡å®ä¾‹çœ‹match æŸ¥è¯¢çš„æ­¥éª¤\n\n```bash\nPUT /test-dsl-match\n{ \"settings\": { \"number_of_shards\": 1 }}\n\nPOST /test-dsl-match/_bulk\n{ \"index\": { \"_id\": 1 }}\n{ \"title\": \"The quick brown fox\" }\n{ \"index\": { \"_id\": 2 }}\n{ \"title\": \"The quick brown fox jumps over the lazy dog\" }\n{ \"index\": { \"_id\": 3 }}\n{ \"title\": \"The quick brown fox jumps over the quick dog\" }\n{ \"index\": { \"_id\": 4 }}\n{ \"title\": \"Brown fox brown dog\" }\n\n```\n\n**æŸ¥è¯¢æ•°æ®**\n\n```bash\nGET /test-dsl-match/_search\n{\n  \"query\": {\n      \"match\": {\n          \"title\": \"QUICK!\"\n      }\n  }\n}\n\n```\n\nElasticsearch æ‰§è¡Œä¸Šé¢è¿™ä¸ª match æŸ¥è¯¢çš„æ­¥éª¤æ˜¯ï¼š\n\n1.  **æ£€æŸ¥å­—æ®µç±»å‹** ã€‚\næ ‡é¢˜ title å­—æ®µæ˜¯ä¸€ä¸ª string ç±»å‹ï¼ˆ analyzed ï¼‰å·²åˆ†æçš„å…¨æ–‡å­—æ®µï¼Œè¿™æ„å‘³ç€æŸ¥è¯¢å­—ç¬¦ä¸²æœ¬èº«ä¹Ÿåº”è¯¥è¢«åˆ†æã€‚\n\n2. **åˆ†ææŸ¥è¯¢å­—ç¬¦ä¸²** ã€‚\nå°†æŸ¥è¯¢çš„å­—ç¬¦ä¸² QUICK! ä¼ å…¥æ ‡å‡†åˆ†æå™¨ä¸­ï¼Œè¾“å‡ºçš„ç»“æœæ˜¯å•ä¸ªé¡¹ quick ã€‚å› ä¸ºåªæœ‰ä¸€ä¸ªå•è¯é¡¹ï¼Œæ‰€ä»¥ match æŸ¥è¯¢æ‰§è¡Œçš„æ˜¯å•ä¸ªåº•å±‚ term æŸ¥è¯¢ã€‚\n\n3. **æŸ¥æ‰¾åŒ¹é…æ–‡æ¡£** ã€‚\nç”¨ term æŸ¥è¯¢åœ¨å€’æ’ç´¢å¼•ä¸­æŸ¥æ‰¾ quick ç„¶åè·å–ä¸€ç»„åŒ…å«è¯¥é¡¹çš„æ–‡æ¡£ï¼Œæœ¬ä¾‹çš„ç»“æœæ˜¯æ–‡æ¡£ï¼š1ã€2 å’Œ 3 ã€‚\n\n4. **ä¸ºæ¯ä¸ªæ–‡æ¡£è¯„åˆ†** ã€‚\nç”¨ term æŸ¥è¯¢è®¡ç®—æ¯ä¸ªæ–‡æ¡£ç›¸å…³åº¦è¯„åˆ† \\_score ï¼Œè¿™æ˜¯ç§å°†è¯é¢‘ï¼ˆterm frequencyï¼Œå³è¯ quick åœ¨ç›¸å…³æ–‡æ¡£çš„ title å­—æ®µä¸­å‡ºç°çš„é¢‘ç‡ï¼‰å’Œåå‘æ–‡æ¡£é¢‘ç‡ï¼ˆinverse document frequencyï¼Œå³è¯ quick åœ¨æ‰€æœ‰æ–‡æ¡£çš„ title å­—æ®µä¸­å‡ºç°çš„é¢‘ç‡ï¼‰ï¼Œä»¥åŠå­—æ®µçš„é•¿åº¦ï¼ˆå³å­—æ®µè¶ŠçŸ­ç›¸å…³åº¦è¶Šé«˜ï¼‰ç›¸ç»“åˆçš„è®¡ç®—æ–¹å¼ã€‚\n\n**éªŒè¯ç»“æœ**\n\n![Untitled 7.png](Extras/Images/Untitled_7_1669985231196_0.png)\n\n#### matchå¤šä¸ªè¯æ·±å…¥\n\næˆ‘ä»¬åœ¨ä¸Šæ–‡ä¸­å¤åˆæŸ¥è¯¢ä¸­å·²ç»ä½¿ç”¨äº†matchå¤šä¸ªè¯ï¼Œæ¯”å¦‚â€œQuick petsâ€ï¼› è¿™é‡Œæˆ‘ä»¬é€šè¿‡ä¾‹å­å¸¦ä½ æ›´æ·±å…¥ç†è§£matchå¤šä¸ªè¯\n\n**matchå¤šä¸ªè¯çš„æœ¬è´¨**\n\næŸ¥è¯¢å¤šä¸ªè¯\"BROWN DOG!\"\n\n```bash\nGET /test-dsl-match/_search\n{\n    \"query\": {\n        \"match\": {\n            \"title\": \"BROWN DOG\"\n        }\n    }\n}\n```\n\n![](https://pdai.tech/images/db/es/es-dsl-full-text-5.png)\n\nå› ä¸º match æŸ¥è¯¢å¿…é¡»æŸ¥æ‰¾ä¸¤ä¸ªè¯ï¼ˆ [\"brown\",\"dog\"] ï¼‰ï¼Œå®ƒåœ¨å†…éƒ¨å®é™…ä¸Šå…ˆæ‰§è¡Œä¸¤æ¬¡ term æŸ¥è¯¢ï¼Œç„¶åå°†ä¸¤æ¬¡æŸ¥è¯¢çš„ç»“æœåˆå¹¶ä½œä¸ºæœ€ç»ˆç»“æœè¾“å‡ºã€‚ä¸ºäº†åšåˆ°è¿™ç‚¹ï¼Œå®ƒå°†ä¸¤ä¸ª term æŸ¥è¯¢åŒ…å…¥ä¸€ä¸ª bool æŸ¥è¯¢ä¸­ï¼Œ\n\næ‰€ä»¥ä¸Šè¿°æŸ¥è¯¢çš„ç»“æœï¼Œå’Œå¦‚ä¸‹è¯­å¥æŸ¥è¯¢ç»“æœæ˜¯ç­‰åŒçš„\n\n```bash\nGET /test-dsl-match/_search\n{\n  \"query\": {\n    \"bool\": {\n      \"should\": [\n        {\n          \"term\": {\n            \"title\": \"brown\"\n          }\n        },\n        {\n          \"term\": {\n            \"title\": \"dog\"\n          }\n        }\n      ]\n    }\n  }\n}\n```\n\n**matchå¤šä¸ªè¯çš„é€»è¾‘**\n\nä¸Šé¢ç­‰åŒäºshouldï¼ˆä»»æ„ä¸€ä¸ªæ»¡è¶³ï¼‰ï¼Œæ˜¯å› ä¸º matchè¿˜æœ‰ä¸€ä¸ªoperatorå‚æ•°ï¼Œé»˜è®¤æ˜¯or, æ‰€ä»¥å¯¹åº”çš„æ˜¯shouldã€‚\n\næ‰€ä»¥ä¸Šè¿°æŸ¥è¯¢ä¹Ÿç­‰åŒäº\n\n```bash\nGET /test-dsl-match/_search\n{\n  \"query\": {\n    \"match\": {\n      \"title\": {\n        \"query\": \"BROWN DOG\",\n        \"operator\": \"or\"\n      }\n    }\n  }\n}\n```\n\né‚£ä¹ˆæˆ‘ä»¬å¦‚æœæ˜¯éœ€è¦andæ“ä½œå‘¢ï¼Œå³åŒæ—¶æ»¡è¶³å‘¢ï¼Ÿ\n\n```bash\nGET /test-dsl-match/_search\n{\n  \"query\": {\n    \"match\": {\n      \"title\": {\n        \"query\": \"BROWN DOG\",\n        \"operator\": \"and\"\n      }\n    }\n  }\n}\n```\n\nç­‰åŒäº\n\n```bash\nGET /test-dsl-match/_search\n{\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"term\": {\n            \"title\": \"brown\"\n          }\n        },\n        {\n          \"term\": {\n            \"title\": \"dog\"\n          }\n        }\n      ]\n    }\n  }\n}\n```\n\n![](https://pdai.tech/images/db/es/es-dsl-full-text-7.png)\n\n#### æ§åˆ¶matchçš„åŒ¹é…ç²¾åº¦\n\nå¦‚æœç”¨æˆ·ç»™å®š 3 ä¸ªæŸ¥è¯¢è¯ï¼Œæƒ³æŸ¥æ‰¾è‡³å°‘åŒ…å«å…¶ä¸­ 2 ä¸ªçš„æ–‡æ¡£ï¼Œè¯¥å¦‚ä½•å¤„ç†ï¼Ÿå°† operator æ“ä½œç¬¦å‚æ•°è®¾ç½®æˆ and æˆ–è€… or éƒ½æ˜¯ä¸åˆé€‚çš„ã€‚\n\nmatch æŸ¥è¯¢æ”¯æŒ minimum_should_match æœ€å°åŒ¹é…å‚æ•°ï¼Œè¿™è®©æˆ‘ä»¬å¯ä»¥æŒ‡å®šå¿…é¡»åŒ¹é…çš„è¯é¡¹æ•°ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªæ–‡æ¡£æ˜¯å¦ç›¸å…³ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶è®¾ç½®ä¸ºæŸä¸ªå…·ä½“æ•°å­—ï¼Œæ›´å¸¸ç”¨çš„åšæ³•æ˜¯å°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªç™¾åˆ†æ•°ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•æ§åˆ¶ç”¨æˆ·æœç´¢æ—¶è¾“å…¥çš„å•è¯æ•°é‡ï¼š\n\n```bash\nGET /test-dsl-match/_search\n{\n  \"query\": {\n    \"match\": {\n      \"title\": {\n        \"query\":                \"quick brown dog\",\n        \"minimum_should_match\": \"75%\"\n      }\n    }\n  }\n}\n```\n\nå½“ç»™å®šç™¾åˆ†æ¯”çš„æ—¶å€™ï¼Œ minimum_should_match ä¼šåšåˆé€‚çš„äº‹æƒ…ï¼šåœ¨ä¹‹å‰ä¸‰è¯é¡¹çš„ç¤ºä¾‹ä¸­ï¼Œ 75% ä¼šè‡ªåŠ¨è¢«æˆªæ–­æˆ 66.6% ï¼Œå³ä¸‰ä¸ªé‡Œé¢ä¸¤ä¸ªè¯ã€‚æ— è®ºè¿™ä¸ªå€¼è®¾ç½®æˆä»€ä¹ˆï¼Œè‡³å°‘åŒ…å«ä¸¤ä¸ªè¯é¡¹çš„æ–‡æ¡£æ‰ä¼šè¢«è®¤ä¸ºæ˜¯åŒ¹é…çš„ã€‚\n\nå½“ç„¶ä¹Ÿç­‰åŒäº\n\n```bash\nGET /test-dsl-match/_search\n{\n  \"query\": {\n    \"bool\": {\n      \"should\": [\n        { \"match\": { \"title\": \"quick\" }},\n        { \"match\": { \"title\": \"brown\"   }},\n        { \"match\": { \"title\": \"dog\"   }}\n      ],\n      \"minimum_should_match\": 2\n    }\n  }\n}\n```\n\n#### å…¶å®ƒmatchç±»å‹\n\n##### match_pharse\n\nmatch_phraseåœ¨å‰æ–‡ä¸­æˆ‘ä»¬å·²ç»æœ‰äº†è§£ï¼Œæˆ‘ä»¬å†çœ‹ä¸‹å¦å¤–ä¸€ä¸ªä¾‹å­ã€‚\n\n```bash\nGET /test-dsl-match/_search\n{\n  \"query\": {\n    \"match_phrase\": {\n      \"title\": {\n        \"query\": \"quick brown\"\n      }\n    }\n  }\n}\n```\n\n![](https://pdai.tech/images/db/es/es-dsl-full-text-11.png)\n\nå¾ˆå¤šäººå¯¹å®ƒä»ç„¶æœ‰è¯¯è§£çš„ï¼Œæ¯”å¦‚å¦‚ä¸‹ä¾‹å­ï¼š\n\n```bash\nGET /test-dsl-match/_search\n{\n  \"query\": {\n    \"match_phrase\": {\n      \"title\": {\n        \"query\": \"quick brown f\"\n      }\n    }\n  }\n}\n```\n\nè¿™æ ·çš„æŸ¥è¯¢æ˜¯æŸ¥ä¸å‡ºä»»ä½•æ•°æ®çš„ï¼Œå› ä¸ºå‰æ–‡ä¸­æˆ‘ä»¬çŸ¥é“äº†matchæœ¬è´¨ä¸Šæ˜¯å¯¹termç»„åˆï¼Œmatch_phraseæœ¬è´¨æ˜¯è¿ç»­çš„termçš„æŸ¥è¯¢ï¼Œæ‰€ä»¥få¹¶ä¸æ˜¯ä¸€ä¸ªåˆ†è¯ï¼Œä¸æ»¡è¶³termæŸ¥è¯¢ï¼Œæ‰€ä»¥æœ€ç»ˆæŸ¥ä¸å‡ºä»»ä½•å†…å®¹äº†ã€‚\n\n![](https://pdai.tech/images/db/es/es-dsl-full-text-12.png)\n\n##### match_pharse_prefix\n\né‚£æœ‰æ²¡æœ‰å¯ä»¥æŸ¥è¯¢å‡º`quick brown f`çš„æ–¹å¼å‘¢ï¼ŸELasticSearchåœ¨match_phraseåŸºç¡€ä¸Šæä¾›äº†ä¸€ç§å¯ä»¥æŸ¥æœ€åä¸€ä¸ªè¯é¡¹æ˜¯å‰ç¼€çš„æ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥æŸ¥è¯¢`quick brown f`äº†\n\n```bash\nGET /test-dsl-match/_search\n{\n  \"query\": {\n    \"match_phrase_prefix\": {\n      \"title\": {\n        \"query\": \"quick brown f\"\n      }\n    }\n  }\n}\n```\n\n![](https://pdai.tech/images/db/es/es-dsl-full-text-13.png)\n\n(ps: prefixçš„æ„æ€ä¸æ˜¯æ•´ä¸ªtextçš„å¼€å§‹åŒ¹é…ï¼Œè€Œæ˜¯æœ€åä¸€ä¸ªè¯é¡¹æ»¡è¶³termçš„prefixæŸ¥è¯¢è€Œå·²)\n\n##### match_bool_prefix\n\né™¤äº†match_phrase_prefixï¼ŒElasticSearchè¿˜æä¾›äº†match_bool_prefixæŸ¥è¯¢\n\n```bash\nGET /test-dsl-match/_search\n{\n  \"query\": {\n    \"match_bool_prefix\": {\n      \"title\": {\n        \"query\": \"quick brown f\"\n      }\n    }\n  }\n}\n```\n\n![](https://pdai.tech/images/db/es/es-dsl-full-text-14.png)\n\nå®ƒä»¬ä¸¤ç§æ–¹å¼æœ‰å•¥åŒºåˆ«å‘¢ï¼Ÿmatch_bool_prefixæœ¬è´¨ä¸Šå¯ä»¥è½¬æ¢ä¸ºï¼š\n\n```bash\nGET /test-dsl-match/_search\n{\n  \"query\": {\n    \"bool\" : {\n      \"should\": [\n        { \"term\": { \"title\": \"quick\" }},\n        { \"term\": { \"title\": \"brown\" }},\n        { \"prefix\": { \"title\": \"f\"}}\n      ]\n    }\n  }\n}\n```\n\næ‰€ä»¥è¿™æ ·ä½ å°±èƒ½ç†è§£ï¼Œmatch_bool_prefixæŸ¥è¯¢ä¸­çš„quick,brown,fæ˜¯æ— åºçš„ã€‚\n\n##### multi_match\n\nå¦‚æœæˆ‘ä»¬æœŸæœ›ä¸€æ¬¡å¯¹å¤šä¸ªå­—æ®µæŸ¥è¯¢ï¼Œæ€ä¹ˆåŠå‘¢ï¼ŸElasticSearchæä¾›äº†multi_matchæŸ¥è¯¢çš„æ–¹å¼\n\n```bash\n{\n  \"query\": {\n    \"multi_match\" : {\n      \"query\":    \"Will Smith\",\n      \"fields\": [ \"title\", \"*_name\" ]\n    }\n  }\n}\n```\n\n`*`è¡¨ç¤ºå‰ç¼€åŒ¹é…å­—æ®µã€‚\n\n### query stringç±»å‹\n\n#### query_string\n\næ­¤æŸ¥è¯¢ä½¿ç”¨è¯­æ³•æ ¹æ®è¿ç®—ç¬¦ï¼ˆä¾‹å¦‚ANDæˆ–ï¼‰æ¥è§£æå’Œæ‹†åˆ†æä¾›çš„æŸ¥è¯¢å­—ç¬¦ä¸²NOTã€‚ç„¶åæŸ¥è¯¢åœ¨è¿”å›åŒ¹é…çš„æ–‡æ¡£ä¹‹å‰ç‹¬ç«‹åˆ†ææ¯ä¸ªæ‹†åˆ†çš„æ–‡æœ¬ã€‚\n\nå¯ä»¥ä½¿ç”¨è¯¥query_stringæŸ¥è¯¢åˆ›å»ºä¸€ä¸ªå¤æ‚çš„æœç´¢ï¼Œå…¶ä¸­åŒ…æ‹¬é€šé…ç¬¦ï¼Œè·¨å¤šä¸ªå­—æ®µçš„æœç´¢ç­‰ç­‰ã€‚å°½ç®¡ç”¨é€”å¹¿æ³›ï¼Œä½†æŸ¥è¯¢æ˜¯ä¸¥æ ¼çš„ï¼Œå¦‚æœæŸ¥è¯¢å­—ç¬¦ä¸²åŒ…å«ä»»ä½•æ— æ•ˆè¯­æ³•ï¼Œåˆ™è¿”å›é”™è¯¯ã€‚\n\nä¾‹å¦‚ï¼š\n\n```bash\nGET /test-dsl-match/_search\n{\n  \"query\": {\n    \"query_string\": {\n      \"query\": \"(lazy dog) OR (brown dog)\",\n      \"default_field\": \"title\"\n    }\n  }\n}\n```\n\nè¿™é‡ŒæŸ¥è¯¢ç»“æœï¼Œä½ éœ€è¦ç†è§£æœ¬è´¨ä¸ŠæŸ¥è¯¢è¿™å››ä¸ªåˆ†è¯ï¼ˆtermï¼‰orçš„ç»“æœè€Œå·²ï¼Œæ‰€ä»¥doc 3å’Œ4ä¹Ÿåœ¨å…¶ä¸­\n\n![](https://pdai.tech/images/db/es/es-dsl-full-text-15.png)\n\n#### query_string_simple\n\nè¯¥æŸ¥è¯¢ä½¿ç”¨ä¸€ç§ç®€å•çš„è¯­æ³•æ¥è§£ææä¾›çš„æŸ¥è¯¢å­—ç¬¦ä¸²å¹¶å°†å…¶æ‹†åˆ†ä¸ºåŸºäºç‰¹æ®Šè¿ç®—ç¬¦çš„æœ¯è¯­ã€‚ç„¶åæŸ¥è¯¢åœ¨è¿”å›åŒ¹é…çš„æ–‡æ¡£ä¹‹å‰ç‹¬ç«‹åˆ†ææ¯ä¸ªæœ¯è¯­ã€‚\n\nå°½ç®¡å…¶è¯­æ³•æ¯”query_stringæŸ¥è¯¢æ›´å—é™åˆ¶ ï¼Œä½†**simple_query_string æŸ¥è¯¢ä¸ä¼šé’ˆå¯¹æ— æ•ˆè¯­æ³•è¿”å›é”™è¯¯ã€‚è€Œæ˜¯ï¼Œå®ƒå°†å¿½ç•¥æŸ¥è¯¢å­—ç¬¦ä¸²çš„ä»»ä½•æ— æ•ˆéƒ¨åˆ†**ã€‚\n\nä¸¾ä¾‹ï¼š\n\n```bash\nGET /test-dsl-match/_search\n{\n  \"query\": {\n    \"simple_query_string\" : {\n        \"query\": \"\\\"over the\\\" + (lazy | quick) + dog\",\n        \"fields\": [\"title\"],\n        \"default_operator\": \"and\"\n    }\n  }\n}\n```\n\n![](https://pdai.tech/images/db/es/es-dsl-full-text-16.png)\n\n### Intervalç±»å‹\n\nIntervalsæ˜¯æ—¶é—´é—´éš”çš„æ„æ€ï¼Œæœ¬è´¨ä¸Šå°†å¤šä¸ªè§„åˆ™æŒ‰ç…§é¡ºåºåŒ¹é…ã€‚\n\n```bash\nGET /test-dsl-match/_search\n{\n  \"query\": {\n    \"intervals\" : {\n      \"title\" : {\n        \"all_of\" : {\n          \"ordered\" : true,\n          \"intervals\" : [\n            {\n              \"match\" : {\n                \"query\" : \"quick\",\n                \"max_gaps\" : 0,\n                \"ordered\" : true\n              }\n            },\n            {\n              \"any_of\" : {\n                \"intervals\" : [\n                  { \"match\" : { \"query\" : \"jump over\" } },\n                  { \"match\" : { \"query\" : \"quick dog\" } }\n                ]\n              }\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n```\n\n![](https://pdai.tech/images/db/es/es-dsl-full-text-17.png)\n\nå› ä¸ºintervalä¹‹é—´æ˜¯å¯ä»¥ç»„åˆçš„ï¼Œæ‰€ä»¥å®ƒå¯ä»¥è¡¨ç°çš„å¾ˆå¤æ‚ã€‚\n\n## Termè¯¦è§£\n\n### å‡†å¤‡æ•°æ®\n\n```bash\nPUT /test-dsl-term-level\n{\n  \"mappings\": {\n    \"properties\": {\n      \"name\": {\n        \"type\": \"keyword\"\n      },\n      \"programming_languages\": {\n        \"type\": \"keyword\"\n      },\n      \"required_matches\": {\n        \"type\": \"long\"\n      }\n    }\n  }\n}\n\nPOST /test-dsl-term-level/_bulk\n{ \"index\": { \"_id\": 1 }}\n{\"name\": \"Jane Smith\", \"programming_languages\": [ \"c++\", \"java\" ], \"required_matches\": 2}\n{ \"index\": { \"_id\": 2 }}\n{\"name\": \"Jason Response\", \"programming_languages\": [ \"java\", \"php\" ], \"required_matches\": 2}\n{ \"index\": { \"_id\": 3 }}\n{\"name\": \"Dave Pdai\", \"programming_languages\": [ \"java\", \"c++\", \"php\" ], \"required_matches\": 3, \"remarks\": \"hello world\"}\n```\n\n### å­—æ®µæ˜¯å¦å­˜åœ¨:exist\n\nç”±äºå¤šç§åŸå› ï¼Œæ–‡æ¡£å­—æ®µçš„ç´¢å¼•å€¼å¯èƒ½ä¸å­˜åœ¨ï¼š\n\næºJSONä¸­çš„å­—æ®µæ˜¯nullæˆ–[]\n\nè¯¥å­—æ®µå·²\"index\" : falseåœ¨æ˜ å°„ä¸­è®¾ç½®\n\nå­—æ®µå€¼çš„é•¿åº¦è¶…å‡ºignore_aboveäº†æ˜ å°„ä¸­çš„è®¾ç½®\n\nå­—æ®µå€¼æ ¼å¼é”™è¯¯ï¼Œå¹¶ä¸”ignore_malformedå·²åœ¨æ˜ å°„ä¸­å®šä¹‰\n\næ‰€ä»¥existè¡¨ç¤ºæŸ¥æ‰¾æ˜¯å¦å­˜åœ¨å­—æ®µã€‚\n\n![](https://pdai.tech/images/db/es/es-dsl-term-2.png)\n\n### idæŸ¥è¯¢:ids\n\nids å³å¯¹idæŸ¥æ‰¾\n\n```bash\nGET /test-dsl-term-level/_search\n{\n  \"query\": {\n    \"ids\": {\n      \"values\": [3, 1]\n    }\n  }\n}\n```\n\n![](https://pdai.tech/images/db/es/es-dsl-term-3.png)\n\n### å‰ç¼€:prefix\n\né€šè¿‡å‰ç¼€æŸ¥æ‰¾æŸä¸ªå­—æ®µ\n\n```bash\nGET /test-dsl-term-level/_search\n{\n  \"query\": {\n    \"prefix\": {\n      \"name\": {\n        \"value\": \"Jan\"\n      }\n    }\n  }\n}\n```\n\n![](https://pdai.tech/images/db/es/es-dsl-term-4.png)\n\n### åˆ†è¯åŒ¹é…:term\n\nå‰æ–‡æœ€å¸¸è§çš„æ ¹æ®åˆ†è¯æŸ¥è¯¢\n\n```bash\nGET /test-dsl-term-level/_search\n{\n\"query\": {\n  \"term\": {\n    \"programming_languages\": \"php\"\n  }\n}\n}\n```\n\n![](https://pdai.tech/images/db/es/es-dsl-term-5.png)\n\n### å¤šä¸ªåˆ†è¯åŒ¹é…:terms\n\næŒ‰ç…§å¤šä¸ªåˆ†è¯termåŒ¹é…ï¼Œå®ƒä»¬æ˜¯orçš„å…³ç³»\n\n```bash\nGET /test-dsl-term-level/_search\n{\n  \"query\": {\n    \"terms\": {\n      \"programming_languages\": [\"php\",\"c++\"]\n    }\n  }\n}\n```\n\n![](https://pdai.tech/images/db/es/es-dsl-term-6.png)\n\n### æŒ‰æŸä¸ªæ•°å­—å­—æ®µåˆ†è¯åŒ¹é…:term set\n\nè®¾è®¡è¿™ç§æ–¹å¼æŸ¥è¯¢çš„åˆè¡·æ˜¯ç”¨æ–‡æ¡£ä¸­çš„æ•°å­—å­—æ®µåŠ¨æ€åŒ¹é…æŸ¥è¯¢æ»¡è¶³termçš„ä¸ªæ•°\n\n```bash\nGET /test-dsl-term-level/_search\n{\n  \"query\": {\n    \"terms_set\": {\n      \"programming_languages\": {\n        \"terms\": [ \"java\", \"php\" ],\n        \"minimum_should_match_field\": \"required_matches\"\n      }\n    }\n  }\n}\n```\n\n![](https://pdai.tech/images/db/es/es-dsl-term-7.png)\n\n### é€šé…ç¬¦:wildcard\n\né€šé…ç¬¦åŒ¹é…ï¼Œæ¯”å¦‚`*`\n\n```bash\nGET /test-dsl-term-level/_search\n{\n  \"query\": {\n    \"wildcard\": {\n      \"name\": {\n        \"value\": \"D*ai\",\n        \"boost\": 1.0,\n        \"rewrite\": \"constant_score\"\n      }\n    }\n  }\n}\n```\n\n![](https://pdai.tech/images/db/es/es-dsl-term-8.png)\n\n### èŒƒå›´:range\n\nå¸¸å¸¸è¢«ç”¨åœ¨æ•°å­—æˆ–è€…æ—¥æœŸèŒƒå›´çš„æŸ¥è¯¢\n\n```bash\nGET /test-dsl-term-level/_search\n{\n  \"query\": {\n    \"range\": {\n      \"required_matches\": {\n        \"gte\": 3,\n        \"lte\": 4\n      }\n    }\n  }\n}\n```\n\n![](https://pdai.tech/images/db/es/es-dsl-term-9.png)\n\n### æ­£åˆ™:regexp\n\né€šè¿‡[æ­£åˆ™è¡¨è¾¾å¼](https://pdai.tech/md/develop/regex/dev-regex-all.html)æŸ¥è¯¢\n\nä»¥\"Jan\"å¼€å¤´çš„nameå­—æ®µ\n\n```bash\nGET /test-dsl-term-level/_search\n{\n  \"query\": {\n    \"regexp\": {\n      \"name\": {\n        \"value\": \"Ja.*\",\n        \"case_insensitive\": true\n      }\n    }\n  }\n}\n```\n\n![](https://pdai.tech/images/db/es/es-dsl-term-10.png)\n\n### æ¨¡ç³ŠåŒ¹é…:fuzzy\n\nå®˜æ–¹æ–‡æ¡£å¯¹æ¨¡ç³ŠåŒ¹é…ï¼šç¼–è¾‘è·ç¦»æ˜¯å°†ä¸€ä¸ªæœ¯è¯­è½¬æ¢ä¸ºå¦ä¸€ä¸ªæœ¯è¯­æ‰€éœ€çš„ä¸€ä¸ªå­—ç¬¦æ›´æ”¹çš„æ¬¡æ•°ã€‚è¿™äº›æ›´æ”¹å¯ä»¥åŒ…æ‹¬ï¼š\n\næ›´æ”¹å­—ç¬¦ï¼ˆboxâ†’ foxï¼‰\n\nåˆ é™¤å­—ç¬¦ï¼ˆblackâ†’ lackï¼‰\n\næ’å…¥å­—ç¬¦ï¼ˆsicâ†’ sickï¼‰\n\nè½¬ç½®ä¸¤ä¸ªç›¸é‚»å­—ç¬¦ï¼ˆactâ†’ catï¼‰\n\n```bash\nGET /test-dsl-term-level/_search\n{\n  \"query\": {\n    \"fuzzy\": {\n      \"remarks\": {\n        \"value\": \"hell\"\n      }\n    }\n  }\n}\n```\n\n![](https://pdai.tech/images/db/es/es-dsl-term-11.png)\nèšåˆæŸ¥è¯¢\n\n## Bucketèšåˆè¯¦è§£\n\n### èšåˆçš„å¼•å…¥\n\næˆ‘ä»¬åœ¨SQLç»“æœä¸­å¸¸æœ‰ï¼š\n\n```\nSELECT COUNT(color)\nFROM table\nGROUP BY color\n```\n\nElasticSearchä¸­**æ¡¶**åœ¨æ¦‚å¿µä¸Šç±»ä¼¼äº SQL çš„åˆ†ç»„ï¼ˆ`GROUP BY`ï¼‰ï¼Œè€Œ**æŒ‡æ ‡**åˆ™ç±»ä¼¼äº `COUNT()` ã€ `SUM()` ã€ `MAX()` ç­‰ç»Ÿè®¡æ–¹æ³•ã€‚\n\nè¿›è€Œå¼•å…¥äº†ä¸¤ä¸ªæ¦‚å¿µï¼š\n\n**æ¡¶ï¼ˆBucketsï¼‰** æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æ–‡æ¡£çš„é›†åˆ\n\n**æŒ‡æ ‡ï¼ˆMetricsï¼‰** å¯¹æ¡¶å†…çš„æ–‡æ¡£è¿›è¡Œç»Ÿè®¡è®¡ç®—\n\næ‰€ä»¥ElasticSearchåŒ…å«3ç§èšåˆï¼ˆAggregation)æ–¹å¼\n\n**æ¡¶èšåˆï¼ˆBucket Aggregation)** - æœ¬æ–‡ä¸­è¯¦è§£\n\n**æŒ‡æ ‡èšåˆï¼ˆMetric Aggregation)** - ä¸‹æ–‡ä¸­è®²è§£\n\n**ç®¡é“èšåˆï¼ˆPipline Aggregation)** - å†ä¸‹ä¸€ç¯‡è®²è§£\n\nèšåˆç®¡é“åŒ–ï¼Œç®€å•è€Œè¨€å°±æ˜¯ä¸Šä¸€ä¸ªèšåˆçš„ç»“æœæˆä¸ºä¸‹ä¸ªèšåˆçš„è¾“å…¥ï¼›\n\nï¼ˆPS:æŒ‡æ ‡èšåˆå’Œæ¡¶èšåˆå¾ˆå¤šæƒ…å†µä¸‹æ˜¯ç»„åˆåœ¨ä¸€èµ·ä½¿ç”¨çš„ï¼Œå…¶å®ä½ ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œæ¡¶èšåˆæœ¬è´¨ä¸Šæ˜¯ä¸€ç§ç‰¹æ®Šçš„æŒ‡æ ‡èšåˆï¼Œå®ƒçš„èšåˆæŒ‡æ ‡å°±æ˜¯æ•°æ®çš„æ¡æ•°count)\n\n### æŒ‰çŸ¥è¯†ç‚¹å­¦ä¹ èšåˆ\n\n#### å‡†å¤‡æ•°æ®\n\nè®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªä¾‹å­ã€‚æˆ‘ä»¬å°†ä¼šåˆ›å»ºä¸€äº›å¯¹æ±½è½¦ç»é”€å•†æœ‰ç”¨çš„èšåˆï¼Œæ•°æ®æ˜¯å…³äºæ±½è½¦äº¤æ˜“çš„ä¿¡æ¯ï¼šè½¦å‹ã€åˆ¶é€ å•†ã€å”®ä»·ã€ä½•æ—¶è¢«å‡ºå”®ç­‰ã€‚\n\né¦–å…ˆæˆ‘ä»¬æ‰¹é‡ç´¢å¼•ä¸€äº›æ•°æ®ï¼š\n\n```bash\nPOST /test-agg-cars/_bulk\n{ \"index\": {}}\n{ \"price\" : 10000, \"color\" : \"red\", \"make\" : \"honda\", \"sold\" : \"2014-10-28\" }\n{ \"index\": {}}\n{ \"price\" : 20000, \"color\" : \"red\", \"make\" : \"honda\", \"sold\" : \"2014-11-05\" }\n{ \"index\": {}}\n{ \"price\" : 30000, \"color\" : \"green\", \"make\" : \"ford\", \"sold\" : \"2014-05-18\" }\n{ \"index\": {}}\n{ \"price\" : 15000, \"color\" : \"blue\", \"make\" : \"toyota\", \"sold\" : \"2014-07-02\" }\n{ \"index\": {}}\n{ \"price\" : 12000, \"color\" : \"green\", \"make\" : \"toyota\", \"sold\" : \"2014-08-19\" }\n{ \"index\": {}}\n{ \"price\" : 20000, \"color\" : \"red\", \"make\" : \"honda\", \"sold\" : \"2014-11-05\" }\n{ \"index\": {}}\n{ \"price\" : 80000, \"color\" : \"red\", \"make\" : \"bmw\", \"sold\" : \"2014-01-01\" }\n{ \"index\": {}}\n{ \"price\" : 25000, \"color\" : \"blue\", \"make\" : \"ford\", \"sold\" : \"2014-02-12\" }\n```\n\n#### æ ‡å‡†çš„èšåˆ\n\næœ‰äº†æ•°æ®ï¼Œå¼€å§‹æ„å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªèšåˆã€‚æ±½è½¦ç»é”€å•†å¯èƒ½ä¼šæƒ³çŸ¥é“å“ªä¸ªé¢œè‰²çš„æ±½è½¦é”€é‡æœ€å¥½ï¼Œç”¨èšåˆå¯ä»¥è½»æ˜“å¾—åˆ°ç»“æœï¼Œç”¨ terms æ¡¶æ“ä½œï¼š\n\n```bash\nGET /test-agg-cars/_search\n{\n    \"size\" : 0,\n    \"aggs\" : {\n        \"popular_colors\" : {\n            \"terms\" : {\n              \"field\" : \"color.keyword\"\n            }\n        }\n    }\n}\n```\n\n1. èšåˆæ“ä½œè¢«ç½®äºé¡¶å±‚å‚æ•° aggs ä¹‹ä¸‹ï¼ˆå¦‚æœä½ æ„¿æ„ï¼Œå®Œæ•´å½¢å¼ aggregations åŒæ ·æœ‰æ•ˆï¼‰ã€‚\n2. ç„¶åï¼Œå¯ä»¥ä¸ºèšåˆæŒ‡å®šä¸€ä¸ªæˆ‘ä»¬æƒ³è¦åç§°ï¼Œæœ¬ä¾‹ä¸­æ˜¯ï¼š popular_colors ã€‚\n3. æœ€åï¼Œå®šä¹‰å•ä¸ªæ¡¶çš„ç±»å‹ terms ã€‚\n\nç»“æœå¦‚ä¸‹ï¼š\n\n![](https://pdai.tech/images/db/es/es-agg-bucket-3.png)\n\nå› ä¸ºæˆ‘ä»¬è®¾ç½®äº† size å‚æ•°ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ hits æœç´¢ç»“æœè¿”å›ã€‚\n\npopular_colors èšåˆæ˜¯ä½œä¸º aggregations å­—æ®µçš„ä¸€éƒ¨åˆ†è¢«è¿”å›çš„ã€‚\n\næ¯ä¸ªæ¡¶çš„ key éƒ½ä¸ color å­—æ®µé‡Œæ‰¾åˆ°çš„å”¯ä¸€è¯å¯¹åº”ã€‚å®ƒæ€»ä¼šåŒ…å« doc_count å­—æ®µï¼Œå‘Šè¯‰æˆ‘ä»¬åŒ…å«è¯¥è¯é¡¹çš„æ–‡æ¡£æ•°é‡ã€‚\n\næ¯ä¸ªæ¡¶çš„æ•°é‡ä»£è¡¨è¯¥é¢œè‰²çš„æ–‡æ¡£æ•°é‡ã€‚\n\n#### å¤šä¸ªèšåˆ\n\nåŒæ—¶è®¡ç®—ä¸¤ç§æ¡¶çš„ç»“æœï¼šå¯¹colorå’Œå¯¹makeã€‚\n\n```bash\nGET /test-agg-cars/_search\n{\n    \"size\" : 0,\n    \"aggs\" : {\n        \"popular_colors\" : {\n            \"terms\" : {\n              \"field\" : \"color.keyword\"\n            }\n        },\n        \"make_by\" : {\n            \"terms\" : {\n              \"field\" : \"make.keyword\"\n            }\n        }\n    }\n}\n```\n\nç»“æœå¦‚ä¸‹ï¼š\n\n![](https://pdai.tech/images/db/es/es-agg-bucket-4.png)\n\n#### èšåˆçš„åµŒå¥—\n\nè¿™ä¸ªæ–°çš„èšåˆå±‚è®©æˆ‘ä»¬å¯ä»¥å°† avg åº¦é‡åµŒå¥—ç½®äº terms æ¡¶å†…ã€‚å®é™…ä¸Šï¼Œè¿™å°±ä¸ºæ¯ä¸ªé¢œè‰²ç”Ÿæˆäº†å¹³å‡ä»·æ ¼ã€‚\n\n```bash\nGET /test-agg-cars/_search\n{\n   \"size\" : 0,\n   \"aggs\": {\n      \"colors\": {\n         \"terms\": {\n            \"field\": \"color.keyword\"\n         },\n         \"aggs\": {\n            \"avg_price\": {\n               \"avg\": {\n                  \"field\": \"price\"\n               }\n            }\n         }\n      }\n   }\n}\n```\n\nç»“æœå¦‚ä¸‹ï¼š\n\n![](https://pdai.tech/images/db/es/es-agg-bucket-5.png)\n\næ­£å¦‚ é¢œè‰² çš„ä¾‹å­ï¼Œæˆ‘ä»¬éœ€è¦ç»™åº¦é‡èµ·ä¸€ä¸ªåå­—ï¼ˆ avg_price ï¼‰è¿™æ ·å¯ä»¥ç¨åæ ¹æ®åå­—è·å–å®ƒçš„å€¼ã€‚æœ€åï¼Œæˆ‘ä»¬æŒ‡å®šåº¦é‡æœ¬èº«ï¼ˆ avg ï¼‰ä»¥åŠæˆ‘ä»¬æƒ³è¦è®¡ç®—å¹³å‡å€¼çš„å­—æ®µï¼ˆ price ï¼‰\n\n#### åŠ¨æ€è„šæœ¬çš„èšåˆ\n\nè¿™ä¸ªä¾‹å­å‘Šè¯‰ä½ ï¼ŒElasticSearchè¿˜æ”¯æŒä¸€äº›åŸºäºè„šæœ¬ï¼ˆç”Ÿæˆè¿è¡Œæ—¶çš„å­—æ®µï¼‰çš„å¤æ‚çš„åŠ¨æ€èšåˆã€‚\n\n```bash\nGET /test-agg-cars/_search\n{\n  \"runtime_mappings\": {\n    \"make.length\": {\n      \"type\": \"long\",\n      \"script\": \"emit(doc['make.keyword'].value.length())\"\n    }\n  },\n  \"size\" : 0,\n  \"aggs\": {\n    \"make_length\": {\n      \"histogram\": {\n        \"interval\": 1,\n        \"field\": \"make.length\"\n      }\n    }\n  }\n}\n```\n\nç»“æœå¦‚ä¸‹ï¼š\n\n![](https://pdai.tech/images/db/es/es-agg-bucket-6.png)\n\n### æŒ‰åˆ†ç±»å­¦ä¹ Bucketèšåˆ\n\n\u003e æˆ‘ä»¬åœ¨å…·ä½“å­¦ä¹ æ—¶ï¼Œä¹Ÿæ— éœ€å­¦ä¹ æ¯ä¸€ä¸ªç‚¹ï¼ŒåŸºäºä¸Šé¢å›¾çš„è®¤çŸ¥ï¼Œæˆ‘ä»¬åªéœ€ç”¨20%çš„æ—¶é—´å­¦ä¹ æœ€ä¸ºå¸¸ç”¨çš„80%åŠŸèƒ½å³å¯ï¼Œå…¶å®ƒæŸ¥æŸ¥æ–‡æ¡£è€Œå·²ã€‚@pdai\n\n#### å‰ç½®æ¡ä»¶çš„è¿‡æ»¤ï¼šfilter\n\nåœ¨å½“å‰æ–‡æ¡£é›†ä¸Šä¸‹æ–‡ä¸­å®šä¹‰ä¸æŒ‡å®šè¿‡æ»¤å™¨(Filter)åŒ¹é…çš„æ‰€æœ‰æ–‡æ¡£çš„å•ä¸ªå­˜å‚¨æ¡¶ã€‚é€šå¸¸ï¼Œè¿™å°†ç”¨äºå°†å½“å‰èšåˆä¸Šä¸‹æ–‡ç¼©å°åˆ°ä¸€ç»„ç‰¹å®šçš„æ–‡æ¡£ã€‚\n\n```bash\nGET /test-agg-cars/_search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"make_by\": {\n      \"filter\": { \"term\": { \"type\": \"honda\" } },\n      \"aggs\": {\n        \"avg_price\": { \"avg\": { \"field\": \"price\" } }\n      }\n    }\n  }\n}\n```\n\nç»“æœå¦‚ä¸‹ï¼š\n\n![](https://pdai.tech/images/db/es/es-agg-bucket-7.png)\n\n#### å¯¹filterè¿›è¡Œåˆ†ç»„èšåˆï¼šfilters\n\nè®¾è®¡ä¸€ä¸ªæ–°çš„ä¾‹å­, æ—¥å¿—ç³»ç»Ÿä¸­ï¼Œæ¯æ¡æ—¥å¿—éƒ½æ˜¯åœ¨æ–‡æœ¬ä¸­ï¼ŒåŒ…å«warning/infoç­‰ä¿¡æ¯ã€‚\n\n```bash\nPUT /test-agg-logs/_bulk?refresh\n{ \"index\" : { \"_id\" : 1 } }\n{ \"body\" : \"warning: page could not be rendered\" }\n{ \"index\" : { \"_id\" : 2 } }\n{ \"body\" : \"authentication error\" }\n{ \"index\" : { \"_id\" : 3 } }\n{ \"body\" : \"warning: connection timed out\" }\n{ \"index\" : { \"_id\" : 4 } }\n{ \"body\" : \"info: hello pdai\" }\n```\n\næˆ‘ä»¬éœ€è¦å¯¹åŒ…å«ä¸åŒæ—¥å¿—ç±»å‹çš„æ—¥å¿—è¿›è¡Œåˆ†ç»„ï¼Œè¿™å°±éœ€è¦filters:\n\n```bash\nGET /test-agg-logs/_search\n{\n  \"size\": 0,\n  \"aggs\" : {\n    \"messages\" : {\n      \"filters\" : {\n        \"other_bucket_key\": \"other_messages\",\n        \"filters\" : {\n          \"infos\" :   { \"match\" : { \"body\" : \"info\"   }},\n          \"warnings\" : { \"match\" : { \"body\" : \"warning\" }}\n        }\n      }\n    }\n  }\n}\n```\n\nç»“æœå¦‚ä¸‹ï¼š\n\n![](https://pdai.tech/images/db/es/es-agg-bucket-8.png)\n\n#### å¯¹numberç±»å‹èšåˆï¼šRange\n\nåŸºäºå¤šæ¡¶å€¼æºçš„èšåˆï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿå®šä¹‰ä¸€ç»„èŒƒå›´-æ¯ä¸ªèŒƒå›´ä»£è¡¨ä¸€ä¸ªæ¡¶ã€‚åœ¨èšåˆè¿‡ç¨‹ä¸­ï¼Œå°†ä»æ¯ä¸ªå­˜å‚¨åŒºèŒƒå›´ä¸­æ£€æŸ¥ä»æ¯ä¸ªæ–‡æ¡£ä¸­æå–çš„å€¼ï¼Œå¹¶â€œå­˜å‚¨â€ç›¸å…³/åŒ¹é…çš„æ–‡æ¡£ã€‚è¯·æ³¨æ„ï¼Œæ­¤èšåˆåŒ…æ‹¬fromå€¼ï¼Œä½†ä¸åŒ…æ‹¬toæ¯ä¸ªèŒƒå›´çš„å€¼ã€‚\n\n```bash\nGET /test-agg-cars/_search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"price_ranges\": {\n      \"range\": {\n        \"field\": \"price\",\n        \"ranges\": [\n          { \"to\": 20000 },\n          { \"from\": 20000, \"to\": 40000 },\n          { \"from\": 40000 }\n        ]\n      }\n    }\n  }\n}\n```\n\nç»“æœå¦‚ä¸‹ï¼š\n\n![](https://pdai.tech/images/db/es/es-agg-bucket-9.png){:height 452, :width 654}\n\n#### å¯¹IPç±»å‹èšåˆï¼šIP Range\n\nä¸“ç”¨äºIPå€¼çš„èŒƒå›´èšåˆã€‚\n\n```bash\nGET /ip_addresses/_search\n{\n  \"size\": 10,\n  \"aggs\": {\n    \"ip_ranges\": {\n      \"ip_range\": {\n        \"field\": \"ip\",\n        \"ranges\": [\n          { \"to\": \"10.0.0.5\" },\n          { \"from\": \"10.0.0.5\" }\n        ]\n      }\n    }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  ...\n\n  \"aggregations\": {\n    \"ip_ranges\": {\n      \"buckets\": [\n        {\n          \"key\": \"*-10.0.0.5\",\n          \"to\": \"10.0.0.5\",\n          \"doc_count\": 10\n        },\n        {\n          \"key\": \"10.0.0.5-*\",\n          \"from\": \"10.0.0.5\",\n          \"doc_count\": 260\n        }\n      ]\n    }\n  }\n}\n```\n\n**CIDR Maskåˆ†ç»„**\n\næ­¤å¤–è¿˜å¯ä»¥ç”¨CIDR Maskåˆ†ç»„\n\n```bash\nGET /ip_addresses/_search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"ip_ranges\": {\n      \"ip_range\": {\n        \"field\": \"ip\",\n        \"ranges\": [\n          { \"mask\": \"10.0.0.0/25\" },\n          { \"mask\": \"10.0.0.127/25\" }\n        ]\n      }\n    }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  ...\n\n  \"aggregations\": {\n    \"ip_ranges\": {\n      \"buckets\": [\n        {\n          \"key\": \"10.0.0.0/25\",\n          \"from\": \"10.0.0.0\",\n          \"to\": \"10.0.0.128\",\n          \"doc_count\": 128\n        },\n        {\n          \"key\": \"10.0.0.127/25\",\n          \"from\": \"10.0.0.0\",\n          \"to\": \"10.0.0.128\",\n          \"doc_count\": 128\n        }\n      ]\n    }\n  }\n}\n```\n\n**å¢åŠ keyæ˜¾ç¤º**\n\n```bash\nGET /ip_addresses/_search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"ip_ranges\": {\n      \"ip_range\": {\n        \"field\": \"ip\",\n        \"ranges\": [\n          { \"to\": \"10.0.0.5\" },\n          { \"from\": \"10.0.0.5\" }\n        ],\n        \"keyed\": true // here\n      }\n    }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  ...\n\n  \"aggregations\": {\n    \"ip_ranges\": {\n      \"buckets\": {\n        \"*-10.0.0.5\": {\n          \"to\": \"10.0.0.5\",\n          \"doc_count\": 10\n        },\n        \"10.0.0.5-*\": {\n          \"from\": \"10.0.0.5\",\n          \"doc_count\": 260\n        }\n      }\n    }\n  }\n}\n```\n\n**è‡ªå®šä¹‰keyæ˜¾ç¤º**\n\n```bash\nGET /ip_addresses/_search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"ip_ranges\": {\n      \"ip_range\": {\n        \"field\": \"ip\",\n        \"ranges\": [\n          { \"key\": \"infinity\", \"to\": \"10.0.0.5\" },\n          { \"key\": \"and-beyond\", \"from\": \"10.0.0.5\" }\n        ],\n        \"keyed\": true\n      }\n    }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  ...\n\n  \"aggregations\": {\n    \"ip_ranges\": {\n      \"buckets\": {\n        \"infinity\": {\n          \"to\": \"10.0.0.5\",\n          \"doc_count\": 10\n        },\n        \"and-beyond\": {\n          \"from\": \"10.0.0.5\",\n          \"doc_count\": 260\n        }\n      }\n    }\n  }\n}\n```\n\n#### å¯¹æ—¥æœŸç±»å‹èšåˆï¼šDate Range\n\nä¸“ç”¨äºæ—¥æœŸå€¼çš„èŒƒå›´èšåˆã€‚\n\n```bash\nGET /test-agg-cars/_search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"range\": {\n      \"date_range\": {\n        \"field\": \"sold\",\n        \"format\": \"yyyy-MM\",\n        \"ranges\": [\n          { \"from\": \"2014-01-01\" },\n          { \"to\": \"2014-12-31\" }\n        ]\n      }\n    }\n  }\n}\n```\n\nç»“æœå¦‚ä¸‹ï¼š\n\n![](https://pdai.tech/images/db/es/es-agg-bucket-10.png)\n\næ­¤èšåˆä¸Rangeèšåˆä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äº fromå’Œtoå€¼å¯ä»¥åœ¨[Date Mathè¡¨è¾¾å¼](https://www.elastic.co/guide/en/elasticsearch/reference/7.12/search-aggregations-bucket-daterange-aggregation.html#date-format-pattern)ä¸­è¡¨ç¤ºï¼Œå¹¶ä¸”è¿˜å¯ä»¥æŒ‡å®šæ—¥æœŸæ ¼å¼ï¼Œé€šè¿‡è¯¥æ—¥æœŸæ ¼å¼å°†è¿”å›from and toå“åº”å­—æ®µã€‚è¯·æ³¨æ„ï¼Œæ­¤èšåˆåŒ…æ‹¬fromå€¼ï¼Œä½†**ä¸åŒ…æ‹¬toæ¯ä¸ªèŒƒå›´çš„å€¼**ã€‚\n\n#### å¯¹æŸ±çŠ¶å›¾åŠŸèƒ½ï¼šHistrogram\n\nç›´æ–¹å›¾ histogram æœ¬è´¨ä¸Šæ˜¯å°±æ˜¯ä¸ºæŸ±çŠ¶å›¾åŠŸèƒ½è®¾è®¡çš„ã€‚\n\nåˆ›å»ºç›´æ–¹å›¾éœ€è¦æŒ‡å®šä¸€ä¸ªåŒºé—´ï¼Œå¦‚æœæˆ‘ä»¬è¦ä¸ºå”®ä»·åˆ›å»ºä¸€ä¸ªç›´æ–¹å›¾ï¼Œå¯ä»¥å°†é—´éš”è®¾ä¸º 20,000ã€‚è¿™æ ·åšå°†ä¼šåœ¨æ¯ä¸ª $20,000 æ¡£åˆ›å»ºä¸€ä¸ªæ–°æ¡¶ï¼Œç„¶åæ–‡æ¡£ä¼šè¢«åˆ†åˆ°å¯¹åº”çš„æ¡¶ä¸­ã€‚\n\nå¯¹äºä»ªè¡¨ç›˜æ¥è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›çŸ¥é“æ¯ä¸ªå”®ä»·åŒºé—´å†…æ±½è½¦çš„é”€é‡ã€‚æˆ‘ä»¬è¿˜ä¼šæƒ³çŸ¥é“æ¯ä¸ªå”®ä»·åŒºé—´å†…æ±½è½¦æ‰€å¸¦æ¥çš„æ”¶å…¥ï¼Œå¯ä»¥é€šè¿‡å¯¹æ¯ä¸ªåŒºé—´å†…å·²å”®æ±½è½¦çš„å”®ä»·æ±‚å’Œå¾—åˆ°ã€‚\n\nå¯ä»¥ç”¨ histogram å’Œä¸€ä¸ªåµŒå¥—çš„ sum åº¦é‡å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç­”æ¡ˆï¼š\n\n```bash\nGET /test-agg-cars/_search\n{\n   \"size\" : 0,\n   \"aggs\":{\n      \"price\":{\n         \"histogram\":{\n            \"field\": \"price.keyword\",\n            \"interval\": 20000\n         },\n         \"aggs\":{\n            \"revenue\": {\n               \"sum\": {\n                 \"field\" : \"price\"\n               }\n             }\n         }\n      }\n   }\n}\n```\n\n1. histogram æ¡¶è¦æ±‚ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ•°å€¼å­—æ®µä»¥åŠä¸€ä¸ªå®šä¹‰æ¡¶å¤§å°é—´éš”ã€‚\n2. sum åº¦é‡åµŒå¥—åœ¨æ¯ä¸ªå”®ä»·åŒºé—´å†…ï¼Œç”¨æ¥æ˜¾ç¤ºæ¯ä¸ªåŒºé—´å†…çš„æ€»æ”¶å…¥ã€‚\n\nå¦‚æˆ‘ä»¬æ‰€è§ï¼ŒæŸ¥è¯¢æ˜¯å›´ç»• price èšåˆæ„å»ºçš„ï¼Œå®ƒåŒ…å«ä¸€ä¸ª histogram æ¡¶ã€‚å®ƒè¦æ±‚å­—æ®µçš„ç±»å‹å¿…é¡»æ˜¯æ•°å€¼å‹çš„åŒæ—¶éœ€è¦è®¾å®šåˆ†ç»„çš„é—´éš”èŒƒå›´ã€‚ é—´éš”è®¾ç½®ä¸º 20,000 æ„å‘³ç€æˆ‘ä»¬å°†ä¼šå¾—åˆ°å¦‚ [0-19999, 20000-39999, ...] è¿™æ ·çš„åŒºé—´ã€‚\n\næ¥ç€ï¼Œæˆ‘ä»¬åœ¨ç›´æ–¹å›¾å†…å®šä¹‰åµŒå¥—çš„åº¦é‡ï¼Œè¿™ä¸ª sum åº¦é‡ï¼Œå®ƒä¼šå¯¹è½å…¥æŸä¸€å…·ä½“å”®ä»·åŒºé—´çš„æ–‡æ¡£ä¸­ price å­—æ®µçš„å€¼è¿›è¡Œæ±‚å’Œã€‚ è¿™å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›æ¯ä¸ªå”®ä»·åŒºé—´çš„æ”¶å…¥ï¼Œä»è€Œå¯ä»¥å‘ç°åˆ°åº•æ˜¯æ™®é€šå®¶ç”¨è½¦èµšé’±è¿˜æ˜¯å¥¢ä¾ˆè½¦èµšé’±ã€‚\n\nå“åº”ç»“æœå¦‚ä¸‹ï¼š\n\n![](https://pdai.tech/images/db/es/es-agg-bucket-11.png)\n\nç»“æœå¾ˆå®¹æ˜“ç†è§£ï¼Œä¸è¿‡åº”è¯¥æ³¨æ„åˆ°ç›´æ–¹å›¾çš„é”®å€¼æ˜¯åŒºé—´çš„ä¸‹é™ã€‚é”® 0 ä»£è¡¨åŒºé—´ 0-19ï¼Œ999 ï¼Œé”® 20000 ä»£è¡¨åŒºé—´ 20ï¼Œ000-39ï¼Œ999 ï¼Œç­‰ç­‰ã€‚\n\n![](https://pdai.tech/images/db/es/es-agg-bucket-33.png)\n\nå½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä»»ä½•èšåˆè¾“å‡ºçš„åˆ†ç±»å’Œç»Ÿè®¡ç»“æœåˆ›å»ºæ¡å½¢å›¾ï¼Œè€Œä¸åªæ˜¯ ç›´æ–¹å›¾ æ¡¶ã€‚è®©æˆ‘ä»¬ä»¥æœ€å—æ¬¢è¿ 10 ç§æ±½è½¦ä»¥åŠå®ƒä»¬çš„å¹³å‡å”®ä»·ã€æ ‡å‡†å·®è¿™äº›ä¿¡æ¯åˆ›å»ºä¸€ä¸ªæ¡å½¢å›¾ã€‚ æˆ‘ä»¬ä¼šç”¨åˆ° terms æ¡¶å’Œ extended_stats åº¦é‡ï¼š\n\n```bash\nGET /test-agg-cars/_search\n{\n  \"size\" : 0,\n  \"aggs\": {\n    \"makes\": {\n      \"terms\": {\n        \"field\": \"make.keyword\",\n        \"size\": 10\n      },\n      \"aggs\": {\n        \"stats\": {\n          \"extended_stats\": {\n            \"field\": \"price\"\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nä¸Šè¿°ä»£ç ä¼šæŒ‰å—æ¬¢è¿åº¦è¿”å›åˆ¶é€ å•†åˆ—è¡¨ä»¥åŠå®ƒä»¬å„è‡ªçš„ç»Ÿè®¡ä¿¡æ¯ã€‚æˆ‘ä»¬å¯¹å…¶ä¸­çš„ stats.avg ã€ stats.count å’Œ stats.std_deviation ä¿¡æ¯ç‰¹åˆ«æ„Ÿå…´è¶£ï¼Œå¹¶ç”¨ å®ƒä»¬è®¡ç®—å‡ºæ ‡å‡†å·®ï¼š\n\n```bash\nstd_err = std_deviation / count\n```\n\n![](https://pdai.tech/images/db/es/es-agg-bucket-12.png)\n\n![](https://pdai.tech/images/db/es/es-agg-bucket-34.png)\n\n## Metricèšåˆè¯¦è§£\n\n### å¦‚ä½•ç†è§£metricèšåˆ\n\n\u003e  metricèšåˆåˆå¦‚ä½•ç†è§£å‘¢ï¼Ÿæˆ‘è®¤ä¸ºä»ä¸¤ä¸ªè§’åº¦ï¼š\n\n**ä»åˆ†ç±»çœ‹**ï¼šMetricèšåˆåˆ†æåˆ†ä¸º**å•å€¼åˆ†æ**å’Œ**å¤šå€¼åˆ†æ**ä¸¤ç±»\n\n**ä»åŠŸèƒ½çœ‹**ï¼šæ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯è®¾è®¡äº†ä¸€äº›åˆ†æapi, æ¯”å¦‚åœ°ç†ä½ç½®ï¼Œç™¾åˆ†æ•°ç­‰ç­‰\n\n\u003e  èåˆä¸Šè¿°ä¸¤ä¸ªæ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥æ¢³ç†å‡ºå¤§è‡´çš„ä¸€ä¸ªmindå›¾ï¼š\n\n* **å•å€¼åˆ†æ**: åªè¾“å‡ºä¸€ä¸ªåˆ†æç»“æœ\n\t* æ ‡å‡†statå‹\n\t\t* `avg` å¹³å‡å€¼\n\t\t* `max` æœ€å¤§å€¼\n\t\t* `min` æœ€å°å€¼\n\t\t* `sum` å’Œ\n\t\t* `value_count` æ•°é‡\n\t* å…¶å®ƒç±»å‹\n\t\t* `cardinality` åŸºæ•°ï¼ˆdistinctå»é‡ï¼‰\n\t\t* `weighted_avg` å¸¦æƒé‡çš„avg\n\t\t* `median_absolute_deviation` ä¸­ä½å€¼\n* **å¤šå€¼åˆ†æ**: å•å€¼ä¹‹å¤–çš„\n\t* statså‹\n\t\t* `stats` åŒ…å«avg,max,min,sumå’Œcount\n\t\t* `matrix_stats` é’ˆå¯¹çŸ©é˜µæ¨¡å‹\n\t\t* `extended_stats`\n\t\t* `string_stats` é’ˆå¯¹å­—ç¬¦ä¸²\n\t* ç™¾åˆ†æ•°å‹\n\t\t* `percentiles` ç™¾åˆ†æ•°èŒƒå›´\n\t\t* `percentile_ranks` ç™¾åˆ†æ•°æ’è¡Œ\n\t* åœ°ç†ä½ç½®å‹\n\t\t* `geo_bounds` Geo bounds\n\t\t* `geo_centroid` Geo-centroid\n\t\t* `geo_line` Geo-Line\n\t* Topå‹\n\t\t* `top_hits` åˆ†æ¡¶åçš„top hits\n\t\t* `top_metrics`\n\n\u003e **é€šè¿‡ä¸Šè¿°åˆ—è¡¨ï¼ˆæˆ‘å°±ä¸ç”»å›¾äº†ï¼‰ï¼Œæˆ‘ä»¬æ„ç­‘çš„ä½“ç³»æ˜¯åŸºäº`åˆ†ç±»`å’Œ`åŠŸèƒ½`ï¼Œè€Œä¸æ˜¯å…·ä½“çš„é¡¹ï¼ˆæ¯”å¦‚avg,percentiles...)ï¼›è¿™æ˜¯ä¸åŒçš„è®¤çŸ¥ç»´åº¦: å…·ä½“çš„é¡¹æ˜¯ç¢ç‰‡åŒ–ï¼Œåˆ†ç±»å’ŒåŠŸèƒ½è¿™ç§æ˜¯ä½ éœ€è¦æ„ç­‘çš„ä½“ç³»**ã€‚@pdai\n\n### å•å€¼åˆ†æ: æ ‡å‡†statç±»å‹\n\n#### `avg` Â  å¹³å‡å€¼\n\nè®¡ç®—ç­çº§çš„å¹³å‡åˆ†\n\n```bash\nPOST /exams/_search?size=0\n{\n  \"aggs\": {\n    \"avg_grade\": { \"avg\": { \"field\": \"grade\" } }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  ...\n  \"aggregations\": {\n    \"avg_grade\": {\n      \"value\": 75.0\n    }\n  }\n}\n```\n\n#### `max` Â  æœ€å¤§å€¼\n\nè®¡ç®—é”€å”®æœ€é«˜ä»·\n\n```bash\nPOST /sales/_search?size=0\n{\n  \"aggs\": {\n    \"max_price\": { \"max\": { \"field\": \"price\" } }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  ...\n  \"aggregations\": {\n      \"max_price\": {\n          \"value\": 200.0\n      }\n  }\n}\n```\n\n### `min` Â  æœ€å°å€¼\n\nè®¡ç®—é”€å”®æœ€ä½ä»·\n\n```bash\nPOST /sales/_search?size=0\n{\n  \"aggs\": {\n    \"min_price\": { \"min\": { \"field\": \"price\" } }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  ...\n\n  \"aggregations\": {\n    \"min_price\": {\n      \"value\": 10.0\n    }\n  }\n}\n```\n\n#### `sum` Â  å’Œ\n\nè®¡ç®—é”€å”®æ€»ä»·\n\n```bash\nPOST /sales/_search?size=0\n{\n  \"query\": {\n    \"constant_score\": {\n      \"filter\": {\n        \"match\": { \"type\": \"hat\" }\n      }\n    }\n  },\n  \"aggs\": {\n    \"hat_prices\": { \"sum\": { \"field\": \"price\" } }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  ...\n  \"aggregations\": {\n    \"hat_prices\": {\n      \"value\": 450.0\n    }\n  }\n}\n```\n\n#### `value_count` Â  æ•°é‡\n\né”€å”®æ•°é‡ç»Ÿè®¡\n\n```bash\nPOST /sales/_search?size=0\n{\n  \"aggs\" : {\n    \"types_count\" : { \"value_count\" : { \"field\" : \"type\" } }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  ...\n  \"aggregations\": {\n    \"types_count\": {\n      \"value\": 7\n    }\n  }\n}\n```\n\n### å•å€¼åˆ†æ: å…¶å®ƒç±»å‹\n\n#### `weighted_avg` Â  å¸¦æƒé‡çš„avg\n\n```bash\nPOST /exams/_search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"weighted_grade\": {\n      \"weighted_avg\": {\n        \"value\": {\n          \"field\": \"grade\"\n        },\n        \"weight\": {\n          \"field\": \"weight\"\n        }\n      }\n    }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  ...\n  \"aggregations\": {\n    \"weighted_grade\": {\n      \"value\": 70.0\n    }\n  }\n}\n```\n\n#### `cardinality` Â  åŸºæ•°ï¼ˆdistinctå»é‡ï¼‰\n\n```bash\nPOST /sales/_search?size=0\n{\n  \"aggs\": {\n    \"type_count\": {\n      \"cardinality\": {\n        \"field\": \"type\"\n      }\n    }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  ...\n  \"aggregations\": {\n    \"type_count\": {\n      \"value\": 3\n    }\n  }\n}\n```\n\n#### `median_absolute_deviation` Â  ä¸­ä½å€¼\n\n```bash\nGET reviews/_search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"review_average\": {\n      \"avg\": {\n        \"field\": \"rating\"\n      }\n    },\n    \"review_variability\": {\n      \"median_absolute_deviation\": {\n        \"field\": \"rating\"\n      }\n    }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  ...\n  \"aggregations\": {\n    \"review_average\": {\n      \"value\": 3.0\n    },\n    \"review_variability\": {\n      \"value\": 2.0\n    }\n  }\n}\n```\n\n### éå•å€¼åˆ†æï¼šstatså‹\n\n#### `stats` Â  åŒ…å«avg,max,min,sumå’Œcount\n\n```bash\nPOST /exams/_search?size=0\n{\n  \"aggs\": {\n    \"grades_stats\": { \"stats\": { \"field\": \"grade\" } }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  ...\n\n  \"aggregations\": {\n    \"grades_stats\": {\n      \"count\": 2,\n      \"min\": 50.0,\n      \"max\": 100.0,\n      \"avg\": 75.0,\n      \"sum\": 150.0\n    }\n  }\n}\n```\n\n#### `matrix_stats` Â  é’ˆå¯¹çŸ©é˜µæ¨¡å‹\n\nä»¥ä¸‹ç¤ºä¾‹è¯´æ˜äº†ä½¿ç”¨çŸ©é˜µç»Ÿè®¡é‡æ¥æè¿°æ”¶å…¥ä¸è´«å›°ä¹‹é—´çš„å…³ç³»ã€‚\n\n```bash\nGET /_search\n{\n  \"aggs\": {\n    \"statistics\": {\n      \"matrix_stats\": {\n        \"fields\": [ \"poverty\", \"income\" ]\n      }\n    }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  ...\n  \"aggregations\": {\n    \"statistics\": {\n      \"doc_count\": 50,\n      \"fields\": [ {\n          \"name\": \"income\",\n          \"count\": 50,\n          \"mean\": 51985.1,\n          \"variance\": 7.383377037755103E7,\n          \"skewness\": 0.5595114003506483,\n          \"kurtosis\": 2.5692365287787124,\n          \"covariance\": {\n            \"income\": 7.383377037755103E7,\n            \"poverty\": -21093.65836734694\n          },\n          \"correlation\": {\n            \"income\": 1.0,\n            \"poverty\": -0.8352655256272504\n          }\n        }, {\n          \"name\": \"poverty\",\n          \"count\": 50,\n          \"mean\": 12.732000000000001,\n          \"variance\": 8.637730612244896,\n          \"skewness\": 0.4516049811903419,\n          \"kurtosis\": 2.8615929677997767,\n          \"covariance\": {\n            \"income\": -21093.65836734694,\n            \"poverty\": 8.637730612244896\n          },\n          \"correlation\": {\n            \"income\": -0.8352655256272504,\n            \"poverty\": 1.0\n          }\n        } ]\n    }\n  }\n}\n```\n\n#### `extended_stats`\n\næ ¹æ®ä»æ±‡æ€»æ–‡æ¡£ä¸­æå–çš„æ•°å€¼è®¡ç®—ç»Ÿè®¡ä¿¡æ¯ã€‚\n\n```bash\nGET /exams/_search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"grades_stats\": { \"extended_stats\": { \"field\": \"grade\" } }\n  }\n}\n```\n\nä¸Šé¢çš„æ±‡æ€»è®¡ç®—äº†æ‰€æœ‰æ–‡æ¡£çš„æˆç»©ç»Ÿè®¡ä¿¡æ¯ã€‚èšåˆç±»å‹ä¸ºextended_statsï¼Œå¹¶ä¸”å­—æ®µè®¾ç½®å®šä¹‰å°†åœ¨å…¶ä¸Šè®¡ç®—ç»Ÿè®¡ä¿¡æ¯çš„æ–‡æ¡£çš„æ•°å­—å­—æ®µã€‚\n\n```bash\n{\n  ...\n\n  \"aggregations\": {\n    \"grades_stats\": {\n      \"count\": 2,\n      \"min\": 50.0,\n      \"max\": 100.0,\n      \"avg\": 75.0,\n      \"sum\": 150.0,\n      \"sum_of_squares\": 12500.0,\n      \"variance\": 625.0,\n      \"variance_population\": 625.0,\n      \"variance_sampling\": 1250.0,\n      \"std_deviation\": 25.0,\n      \"std_deviation_population\": 25.0,\n      \"std_deviation_sampling\": 35.35533905932738,\n      \"std_deviation_bounds\": {\n        \"upper\": 125.0,\n        \"lower\": 25.0,\n        \"upper_population\": 125.0,\n        \"lower_population\": 25.0,\n        \"upper_sampling\": 145.71067811865476,\n        \"lower_sampling\": 4.289321881345245\n      }\n    }\n  }\n}\n```\n\n#### `string_stats` Â  é’ˆå¯¹å­—ç¬¦ä¸²\n\nç”¨äºè®¡ç®—ä»èšåˆæ–‡æ¡£ä¸­æå–çš„å­—ç¬¦ä¸²å€¼çš„ç»Ÿè®¡ä¿¡æ¯ã€‚è¿™äº›å€¼å¯ä»¥ä»ç‰¹å®šçš„å…³é”®å­—å­—æ®µä¸­æ£€ç´¢ã€‚\n\n```bash\nPOST /my-index-000001/_search?size=0\n{\n  \"aggs\": {\n    \"message_stats\": { \"string_stats\": { \"field\": \"message.keyword\" } }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  ...\n\n  \"aggregations\": {\n    \"message_stats\": {\n      \"count\": 5,\n      \"min_length\": 24,\n      \"max_length\": 30,\n      \"avg_length\": 28.8,\n      \"entropy\": 3.94617750050791\n    }\n  }\n}\n```\n\n### éå•å€¼åˆ†æï¼šç™¾åˆ†æ•°å‹\n\n#### `percentiles` Â  ç™¾åˆ†æ•°èŒƒå›´\n\né’ˆå¯¹ä»èšåˆæ–‡æ¡£ä¸­æå–çš„æ•°å€¼è®¡ç®—ä¸€ä¸ªæˆ–å¤šä¸ªç™¾åˆ†ä½æ•°ã€‚\n\n```bash\nGET latency/_search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"load_time_outlier\": {\n      \"percentiles\": {\n        \"field\": \"load_time\"\n      }\n    }\n  }\n}\n```\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œç™¾åˆ†ä½åº¦é‡æ ‡å‡†å°†ç”Ÿæˆä¸€å®šèŒƒå›´çš„ç™¾åˆ†ä½ï¼š[1ï¼Œ5ï¼Œ25ï¼Œ50ï¼Œ75ï¼Œ95ï¼Œ99]ã€‚\n\n```bash\n\n  ...\n\n \"aggregations\": {\n    \"load_time_outlier\": {\n      \"values\": {\n        \"1.0\": 5.0,\n        \"5.0\": 25.0,\n        \"25.0\": 165.0,\n        \"50.0\": 445.0,\n        \"75.0\": 725.0,\n        \"95.0\": 945.0,\n        \"99.0\": 985.0\n      }\n    }\n  }\n}\n```\n\n#### `percentile_ranks` Â  ç™¾åˆ†æ•°æ’è¡Œ\n\næ ¹æ®ä»æ±‡æ€»æ–‡æ¡£ä¸­æå–çš„æ•°å€¼è®¡ç®—ä¸€ä¸ªæˆ–å¤šä¸ªç™¾åˆ†ä½ç­‰çº§ã€‚\n\n```bash\nGET latency/_search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"load_time_ranks\": {\n      \"percentile_ranks\": {\n        \"field\": \"load_time\",\n        \"values\": [ 500, 600 ]\n      }\n    }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  ...\n\n \"aggregations\": {\n    \"load_time_ranks\": {\n      \"values\": {\n        \"500.0\": 90.01,\n        \"600.0\": 100.0\n      }\n    }\n  }\n}\n```\n\nä¸Šè¿°ç»“æœè¡¨ç¤º90.01ï¼…çš„é¡µé¢åŠ è½½åœ¨500mså†…å®Œæˆï¼Œè€Œ100ï¼…çš„é¡µé¢åŠ è½½åœ¨600mså†…å®Œæˆã€‚\n\n### éå•å€¼åˆ†æï¼šåœ°ç†ä½ç½®å‹\n\n#### `geo_bounds` Â  Geo bounds\n\n```bash\nPUT /museums\n{\n  \"mappings\": {\n    \"properties\": {\n      \"location\": {\n        \"type\": \"geo_point\"\n      }\n    }\n  }\n}\n\nPOST /museums/_bulk?refresh\n{\"index\":{\"_id\":1}}\n{\"location\": \"52.374081,4.912350\", \"name\": \"NEMO Science Museum\"}\n{\"index\":{\"_id\":2}}\n{\"location\": \"52.369219,4.901618\", \"name\": \"Museum Het Rembrandthuis\"}\n{\"index\":{\"_id\":3}}\n{\"location\": \"52.371667,4.914722\", \"name\": \"Nederlands Scheepvaartmuseum\"}\n{\"index\":{\"_id\":4}}\n{\"location\": \"51.222900,4.405200\", \"name\": \"Letterenhuis\"}\n{\"index\":{\"_id\":5}}\n{\"location\": \"48.861111,2.336389\", \"name\": \"MusÃ©e du Louvre\"}\n{\"index\":{\"_id\":6}}\n{\"location\": \"48.860000,2.327000\", \"name\": \"MusÃ©e d'Orsay\"}\n\nPOST /museums/_search?size=0\n{\n  \"query\": {\n    \"match\": { \"name\": \"musÃ©e\" }\n  },\n  \"aggs\": {\n    \"viewport\": {\n      \"geo_bounds\": {\n        \"field\": \"location\",\n        \"wrap_longitude\": true\n      }\n    }\n  }\n}\n```\n\nä¸Šé¢çš„æ±‡æ€»å±•ç¤ºäº†å¦‚ä½•é’ˆå¯¹å…·æœ‰å•†åº—ä¸šåŠ¡ç±»å‹çš„æ‰€æœ‰æ–‡æ¡£è®¡ç®—ä½ç½®å­—æ®µçš„è¾¹ç•Œæ¡†\n\n```bash\n{\n  ...\n  \"aggregations\": {\n    \"viewport\": {\n      \"bounds\": {\n        \"top_left\": {\n          \"lat\": 48.86111099738628,\n          \"lon\": 2.3269999679178\n        },\n        \"bottom_right\": {\n          \"lat\": 48.85999997612089,\n          \"lon\": 2.3363889567553997\n        }\n      }\n    }\n  }\n}\n```\n\n#### `geo_centroid` Â  Geo-centroid\n\n```bash\nPUT /museums\n{\n  \"mappings\": {\n    \"properties\": {\n      \"location\": {\n        \"type\": \"geo_point\"\n      }\n    }\n  }\n}\n\nPOST /museums/_bulk?refresh\n{\"index\":{\"_id\":1}}\n{\"location\": \"52.374081,4.912350\", \"city\": \"Amsterdam\", \"name\": \"NEMO Science Museum\"}\n{\"index\":{\"_id\":2}}\n{\"location\": \"52.369219,4.901618\", \"city\": \"Amsterdam\", \"name\": \"Museum Het Rembrandthuis\"}\n{\"index\":{\"_id\":3}}\n{\"location\": \"52.371667,4.914722\", \"city\": \"Amsterdam\", \"name\": \"Nederlands Scheepvaartmuseum\"}\n{\"index\":{\"_id\":4}}\n{\"location\": \"51.222900,4.405200\", \"city\": \"Antwerp\", \"name\": \"Letterenhuis\"}\n{\"index\":{\"_id\":5}}\n{\"location\": \"48.861111,2.336389\", \"city\": \"Paris\", \"name\": \"MusÃ©e du Louvre\"}\n{\"index\":{\"_id\":6}}\n{\"location\": \"48.860000,2.327000\", \"city\": \"Paris\", \"name\": \"MusÃ©e d'Orsay\"}\n\nPOST /museums/_search?size=0\n{\n  \"aggs\": {\n    \"centroid\": {\n      \"geo_centroid\": {\n        \"field\": \"location\"\n      }\n    }\n  }\n}\n```\n\nä¸Šé¢çš„æ±‡æ€»æ˜¾ç¤ºäº†å¦‚ä½•é’ˆå¯¹æ‰€æœ‰å…·æœ‰çŠ¯ç½ªç±»å‹çš„ç›—çªƒæ–‡ä»¶è®¡ç®—ä½ç½®å­—æ®µçš„è´¨å¿ƒã€‚\n\n```bash\n{\n  ...\n  \"aggregations\": {\n    \"centroid\": {\n      \"location\": {\n        \"lat\": 51.00982965203002,\n        \"lon\": 3.9662131341174245\n      },\n      \"count\": 6\n    }\n  }\n}\n```\n\n#### `geo_line` Â  Geo-Line\n\n```bash\nPUT test\n{\n    \"mappings\": {\n        \"dynamic\": \"strict\",\n        \"_source\": {\n            \"enabled\": false\n        },\n        \"properties\": {\n            \"my_location\": {\n                \"type\": \"geo_point\"\n            },\n            \"group\": {\n                \"type\": \"keyword\"\n            },\n            \"@timestamp\": {\n                \"type\": \"date\"\n            }\n        }\n    }\n}\n\nPOST /test/_bulk?refresh\n{\"index\": {}}\n{\"my_location\": {\"lat\":37.3450570, \"lon\": -122.0499820}, \"@timestamp\": \"2013-09-06T16:00:36\"}\n{\"index\": {}}\n{\"my_location\": {\"lat\": 37.3451320, \"lon\": -122.0499820}, \"@timestamp\": \"2013-09-06T16:00:37Z\"}\n{\"index\": {}}\n{\"my_location\": {\"lat\": 37.349283, \"lon\": -122.0505010}, \"@timestamp\": \"2013-09-06T16:00:37Z\"}\n\nPOST /test/_search?filter_path=aggregations\n{\n  \"aggs\": {\n    \"line\": {\n      \"geo_line\": {\n        \"point\": {\"field\": \"my_location\"},\n        \"sort\": {\"field\": \"@timestamp\"}\n      }\n    }\n  }\n}\n```\n\nå°†å­˜å‚¨æ¡¶ä¸­çš„æ‰€æœ‰geo_pointå€¼èšåˆåˆ°ç”±æ‰€é€‰æ’åºå­—æ®µæ’åºçš„LineStringä¸­ã€‚\n\n```bash\n{\n  \"aggregations\": {\n    \"line\": {\n      \"type\" : \"Feature\",\n      \"geometry\" : {\n        \"type\" : \"LineString\",\n        \"coordinates\" : [\n          [\n            -122.049982,\n            37.345057\n          ],\n          [\n            -122.050501,\n            37.349283\n          ],\n          [\n            -122.049982,\n            37.345132\n          ]\n        ]\n      },\n      \"properties\" : {\n        \"complete\" : true\n      }\n    }\n  }\n}\n```\n\n### éå•å€¼åˆ†æï¼šTopå‹\n\n#### `top_hits` Â  åˆ†æ¡¶åçš„top hits\n\n```bash\nPOST /sales/_search?size=0\n{\n  \"aggs\": {\n    \"top_tags\": {\n      \"terms\": {\n        \"field\": \"type\",\n        \"size\": 3\n      },\n      \"aggs\": {\n        \"top_sales_hits\": {\n          \"top_hits\": {\n            \"sort\": [\n              {\n                \"date\": {\n                  \"order\": \"desc\"\n                }\n              }\n            ],\n            \"_source\": {\n              \"includes\": [ \"date\", \"price\" ]\n            },\n            \"size\": 1\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  ...\n  \"aggregations\": {\n    \"top_tags\": {\n       \"doc_count_error_upper_bound\": 0,\n       \"sum_other_doc_count\": 0,\n       \"buckets\": [\n          {\n             \"key\": \"hat\",\n             \"doc_count\": 3,\n             \"top_sales_hits\": {\n                \"hits\": {\n                   \"total\" : {\n                       \"value\": 3,\n                       \"relation\": \"eq\"\n                   },\n                   \"max_score\": null,\n                   \"hits\": [\n                      {\n                         \"_index\": \"sales\",\n                         \"_type\": \"_doc\",\n                         \"_id\": \"AVnNBmauCQpcRyxw6ChK\",\n                         \"_source\": {\n                            \"date\": \"2015/03/01 00:00:00\",\n                            \"price\": 200\n                         },\n                         \"sort\": [\n                            1425168000000\n                         ],\n                         \"_score\": null\n                      }\n                   ]\n                }\n             }\n          },\n          {\n             \"key\": \"t-shirt\",\n             \"doc_count\": 3,\n             \"top_sales_hits\": {\n                \"hits\": {\n                   \"total\" : {\n                       \"value\": 3,\n                       \"relation\": \"eq\"\n                   },\n                   \"max_score\": null,\n                   \"hits\": [\n                      {\n                         \"_index\": \"sales\",\n                         \"_type\": \"_doc\",\n                         \"_id\": \"AVnNBmauCQpcRyxw6ChL\",\n                         \"_source\": {\n                            \"date\": \"2015/03/01 00:00:00\",\n                            \"price\": 175\n                         },\n                         \"sort\": [\n                            1425168000000\n                         ],\n                         \"_score\": null\n                      }\n                   ]\n                }\n             }\n          },\n          {\n             \"key\": \"bag\",\n             \"doc_count\": 1,\n             \"top_sales_hits\": {\n                \"hits\": {\n                   \"total\" : {\n                       \"value\": 1,\n                       \"relation\": \"eq\"\n                   },\n                   \"max_score\": null,\n                   \"hits\": [\n                      {\n                         \"_index\": \"sales\",\n                         \"_type\": \"_doc\",\n                         \"_id\": \"AVnNBmatCQpcRyxw6ChH\",\n                         \"_source\": {\n                            \"date\": \"2015/01/01 00:00:00\",\n                            \"price\": 150\n                         },\n                         \"sort\": [\n                            1420070400000\n                         ],\n                         \"_score\": null\n                      }\n                   ]\n                }\n             }\n          }\n       ]\n    }\n  }\n}\n```\n\n#### `top_metrics`\n\n```bash\nPOST /test/_bulk?refresh\n{\"index\": {}}\n{\"s\": 1, \"m\": 3.1415}\n{\"index\": {}}\n{\"s\": 2, \"m\": 1.0}\n{\"index\": {}}\n{\"s\": 3, \"m\": 2.71828}\nPOST /test/_search?filter_path=aggregations\n{\n  \"aggs\": {\n    \"tm\": {\n      \"top_metrics\": {\n        \"metrics\": {\"field\": \"m\"},\n        \"sort\": {\"s\": \"desc\"}\n      }\n    }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n  \"aggregations\": {\n    \"tm\": {\n      \"top\": [ {\"sort\": [3], \"metrics\": {\"m\": 2.718280076980591 } } ]\n    }\n  }\n}\n```\n\n## Piplineèšåˆè¯¦è§£\n\n### å¦‚ä½•ç†è§£pipelineèšåˆ\n\nå¦‚ä½•ç†è§£ç®¡é“èšåˆå‘¢ï¼Ÿæœ€é‡è¦çš„æ˜¯è¦ç«™åœ¨è®¾è®¡è€…è§’åº¦çœ‹è¿™ä¸ªåŠŸèƒ½çš„è¦å®ç°çš„ç›®çš„ï¼šè®©ä¸Šä¸€æ­¥çš„èšåˆç»“æœæˆä¸ºä¸‹ä¸€ä¸ªèšåˆçš„è¾“å…¥ï¼Œè¿™å°±æ˜¯ç®¡é“ã€‚\n\n#### ç®¡é“æœºåˆ¶çš„å¸¸è§åœºæ™¯\n\n##### è´£ä»»é“¾æ¨¡å¼\n\nç®¡é“æœºåˆ¶åœ¨è®¾è®¡æ¨¡å¼ä¸Šå±äºè´£ä»»é“¾æ¨¡å¼ï¼Œå¦‚æœä½ ä¸ç†è§£ï¼Œè¯·å‚çœ‹å¦‚ä¸‹æ–‡ç« ï¼š\n\n[è´£ä»»é“¾æ¨¡å¼(Chain of responsibility pattern)](/md/dev-spec/pattern/15_chain.html): é€šè¿‡è´£ä»»é“¾æ¨¡å¼, ä½ å¯ä»¥ä¸ºæŸä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªå¯¹è±¡é“¾. æ¯ä¸ªå¯¹è±¡ä¾åºæ£€æŸ¥æ­¤è¯·æ±‚å¹¶å¯¹å…¶è¿›è¡Œå¤„ç†æˆ–è€…å°†å®ƒä¼ ç»™é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå¯¹è±¡ã€‚\n\n##### FilterChain\n\nåœ¨è½¯ä»¶å¼€å‘çš„å¸¸æ¥è§¦çš„è´£ä»»é“¾æ¨¡å¼æ˜¯FilterChainï¼Œå®ƒä½“ç°åœ¨å¾ˆå¤šè½¯ä»¶è®¾è®¡ä¸­ï¼š\n\n**æ¯”å¦‚Spring Securityæ¡†æ¶ä¸­**\n\n![](https://pdai.tech/images/tomcat/tomcat-x-pipline-6.jpg)\n\n**æ¯”å¦‚HttpServletRequestå¤„ç†çš„è¿‡æ»¤å™¨ä¸­**\n\nå½“ä¸€ä¸ªrequestè¿‡æ¥çš„æ—¶å€™ï¼Œéœ€è¦å¯¹è¿™ä¸ªrequeståšä¸€ç³»åˆ—çš„åŠ å·¥ï¼Œä½¿ç”¨è´£ä»»é“¾æ¨¡å¼å¯ä»¥ä½¿æ¯ä¸ªåŠ å·¥ç»„ä»¶åŒ–ï¼Œå‡å°‘è€¦åˆã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨åœ¨å½“ä¸€ä¸ªrequestè¿‡æ¥çš„æ—¶å€™ï¼Œéœ€è¦æ‰¾åˆ°åˆé€‚çš„åŠ å·¥æ–¹å¼ã€‚å½“ä¸€ä¸ªåŠ å·¥æ–¹å¼ä¸é€‚åˆè¿™ä¸ªrequestçš„æ—¶å€™ï¼Œä¼ é€’åˆ°ä¸‹ä¸€ä¸ªåŠ å·¥æ–¹æ³•ï¼Œè¯¥åŠ å·¥æ–¹å¼å†å°è¯•å¯¹requeståŠ å·¥ã€‚\n\n![](https://pdai.tech/images/tomcat/tomcat-x-pipline-5.jpg)\n\n#### ElasticSearchè®¾è®¡ç®¡é“æœºåˆ¶\n\nç®€å•è€Œè¨€ï¼šè®©ä¸Šä¸€æ­¥çš„èšåˆç»“æœæˆä¸ºä¸‹ä¸€ä¸ªèšåˆçš„è¾“å…¥ï¼Œè¿™å°±æ˜¯ç®¡é“ã€‚\n\næ¥ä¸‹æ¥ï¼Œæ— éå°±æ˜¯å¯¹ä¸åŒç±»å‹çš„èšåˆæœ‰æ¥å£çš„æ”¯æ’‘ï¼Œæ¯”å¦‚ï¼š\n\n\u003e ç¬¬ä¸€ä¸ªç»´åº¦ï¼šç®¡é“èšåˆæœ‰å¾ˆå¤šä¸åŒ**ç±»å‹**ï¼Œæ¯ç§ç±»å‹éƒ½ä¸å…¶ä»–èšåˆè®¡ç®—ä¸åŒçš„ä¿¡æ¯ï¼Œä½†æ˜¯å¯ä»¥å°†è¿™äº›ç±»å‹åˆ†ä¸ºä¸¤ç±»ï¼š\n\n**çˆ¶çº§** çˆ¶çº§èšåˆçš„è¾“å‡ºæä¾›äº†ä¸€ç»„ç®¡é“èšåˆï¼Œå®ƒå¯ä»¥è®¡ç®—æ–°çš„å­˜å‚¨æ¡¶æˆ–æ–°çš„èšåˆä»¥æ·»åŠ åˆ°ç°æœ‰å­˜å‚¨æ¡¶ä¸­ã€‚\n\n**å…„å¼Ÿ** åŒçº§èšåˆçš„è¾“å‡ºæä¾›çš„ç®¡é“èšåˆï¼Œå¹¶ä¸”èƒ½å¤Ÿè®¡ç®—ä¸è¯¥åŒçº§èšåˆå¤„äºåŒä¸€çº§åˆ«çš„æ–°èšåˆã€‚\n\n\u003e ç¬¬äºŒä¸ªç»´åº¦ï¼šæ ¹æ®**åŠŸèƒ½è®¾è®¡**çš„æ„å›¾\n\næ¯”å¦‚å‰ç½®èšåˆå¯èƒ½æ˜¯Bucketèšåˆï¼Œåç½®çš„å¯èƒ½æ˜¯åŸºäºMetricèšåˆï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥æˆä¸ºä¸€ç±»ç®¡é“\n\nè¿›è€Œå¼•å‡ºäº†ï¼š`xxx bucket`(æ˜¯ä¸æ˜¯å¾ˆå®¹æ˜“ç†è§£äº† @pdai)\n\n**Bucketèšåˆ -\u003e Metricèšåˆ**ï¼š bucketèšåˆçš„ç»“æœï¼Œæˆä¸ºä¸‹ä¸€æ­¥metricèšåˆçš„è¾“å…¥\n\n* Average bucket\n* Min bucket\n* Max bucket\n* Sum bucket\n* Stats bucket\n* Extended stats bucket\n\nå¯¹æ„å»ºä½“ç³»è€Œè¨€ï¼Œç†è§£ä¸Šé¢çš„å·²ç»å¤Ÿäº†ï¼Œå…¶å®ƒçš„ç±»å‹ä¸è¿‡æ˜¯é”¦ä¸Šæ·»èŠ±è€Œè¨€ã€‚\n\n### ä¸€äº›ä¾‹å­\n\n#### Average bucket èšåˆ\n\n```bash\nPOST _search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"sales_per_month\": {\n      \"date_histogram\": {\n        \"field\": \"date\",\n        \"calendar_interval\": \"month\"\n      },\n      \"aggs\": {\n        \"sales\": {\n          \"sum\": {\n            \"field\": \"price\"\n          }\n        }\n      }\n    },\n    \"avg_monthly_sales\": {\n// tag::avg-bucket-agg-syntax[]\n      \"avg_bucket\": {\n        \"buckets_path\": \"sales_per_month\u003esales\",\n        \"gap_policy\": \"skip\",\n        \"format\": \"#,##0.00;(#,##0.00)\"\n      }\n// end::avg-bucket-agg-syntax[]\n    }\n  }\n}\n```\n\nåµŒå¥—çš„bucketèšåˆï¼šèšåˆå‡ºæŒ‰æœˆä»·æ ¼çš„ç›´æ–¹å›¾\n\nMeticèšåˆï¼šå¯¹ä¸Šé¢çš„èšåˆå†æ±‚å¹³å‡å€¼ã€‚\n\n**å­—æ®µç±»å‹**ï¼š\n\nbuckets_pathï¼šæŒ‡å®šèšåˆçš„åç§°ï¼Œæ”¯æŒå¤šçº§åµŒå¥—èšåˆã€‚\n\ngap_policy å½“ç®¡é“èšåˆé‡åˆ°ä¸å­˜åœ¨çš„å€¼ï¼Œæœ‰ç‚¹ç±»ä¼¼äºtermç­‰èšåˆçš„(missing)æ—¶æ‰€é‡‡å–çš„ç­–ç•¥ï¼Œå¯é€‰æ‹©å€¼ä¸ºï¼šskipã€insert_zerosã€‚\n\nskipï¼šæ­¤é€‰é¡¹å°†ä¸¢å¤±çš„æ•°æ®è§†ä¸ºbucketä¸å­˜åœ¨ã€‚å®ƒå°†è·³è¿‡æ¡¶å¹¶ä½¿ç”¨ä¸‹ä¸€ä¸ªå¯ç”¨å€¼ç»§ç»­è®¡ç®—ã€‚\n\nformat ç”¨äºæ ¼å¼åŒ–èšåˆæ¡¶çš„è¾“å‡º(key)ã€‚\n\nè¾“å‡ºç»“æœå¦‚ä¸‹\n\n```bash\n{\n  \"took\": 11,\n  \"timed_out\": false,\n  \"_shards\": ...,\n  \"hits\": ...,\n  \"aggregations\": {\n    \"sales_per_month\": {\n      \"buckets\": [\n        {\n          \"key_as_string\": \"2015/01/01 00:00:00\",\n          \"key\": 1420070400000,\n          \"doc_count\": 3,\n          \"sales\": {\n            \"value\": 550.0\n          }\n        },\n        {\n          \"key_as_string\": \"2015/02/01 00:00:00\",\n          \"key\": 1422748800000,\n          \"doc_count\": 2,\n          \"sales\": {\n            \"value\": 60.0\n          }\n        },\n        {\n          \"key_as_string\": \"2015/03/01 00:00:00\",\n          \"key\": 1425168000000,\n          \"doc_count\": 2,\n          \"sales\": {\n            \"value\": 375.0\n          }\n        }\n      ]\n    },\n    \"avg_monthly_sales\": {\n      \"value\": 328.33333333333333,\n      \"value_as_string\": \"328.33\"\n    }\n  }\n}\n```\n\n#### Stats bucket èšåˆ\n\nè¿›ä¸€æ­¥çš„stat bucketä¹Ÿå¾ˆå®¹æ˜“ç†è§£äº†\n\n```bash\nPOST /sales/_search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"sales_per_month\": {\n      \"date_histogram\": {\n        \"field\": \"date\",\n        \"calendar_interval\": \"month\"\n      },\n      \"aggs\": {\n        \"sales\": {\n          \"sum\": {\n            \"field\": \"price\"\n          }\n        }\n      }\n    },\n    \"stats_monthly_sales\": {\n      \"stats_bucket\": {\n        \"buckets_path\": \"sales_per_month\u003esales\"\n      }\n    }\n  }\n}\n```\n\nè¿”å›\n\n```bash\n{\n   \"took\": 11,\n   \"timed_out\": false,\n   \"_shards\": ...,\n   \"hits\": ...,\n   \"aggregations\": {\n      \"sales_per_month\": {\n         \"buckets\": [\n            {\n               \"key_as_string\": \"2015/01/01 00:00:00\",\n               \"key\": 1420070400000,\n               \"doc_count\": 3,\n               \"sales\": {\n                  \"value\": 550.0\n               }\n            },\n            {\n               \"key_as_string\": \"2015/02/01 00:00:00\",\n               \"key\": 1422748800000,\n               \"doc_count\": 2,\n               \"sales\": {\n                  \"value\": 60.0\n               }\n            },\n            {\n               \"key_as_string\": \"2015/03/01 00:00:00\",\n               \"key\": 1425168000000,\n               \"doc_count\": 2,\n               \"sales\": {\n                  \"value\": 375.0\n               }\n            }\n         ]\n      },\n      \"stats_monthly_sales\": {\n         \"count\": 3,\n         \"min\": 60.0,\n         \"max\": 550.0,\n         \"avg\": 328.3333333333333,\n         \"sum\": 985.0\n      }\n   }\n}\n```\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/ElasticSearch"]},"/Cards/CS/Git/%E7%96%91%E9%9A%BE%E9%97%AE%E9%A2%98":{"title":"ç–‘éš¾é—®é¢˜","content":"\n[å¦‚æœç†è§£â€gpg failed to sign the dataâ€œé—®é¢˜](https://gist.github.com/paolocarrasco/18ca8fe6e63490ae1be23e84a7039374)\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Git"]},"/Cards/CS/Golang/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86":{"title":"å†…å­˜ç®¡ç†","content":"\n# å †å†…å­˜ç®¡ç†\n\n![image.png](Extras/Images/image_1665644324748_0.png)\n\n# å †å†…å­˜ç®¡ç†\n\nåˆå§‹åŒ–è¿ç»­å†…å­˜å—ä½œä¸ºå †\n\næœ‰å†…å­˜ç”³è¯·çš„æ—¶å€™ï¼ŒAllocator ä»å †å†…å­˜çš„æœªåˆ†é…åŒºåŸŸåˆ†å‰²å°å†…å­˜å—\n\nç”¨é“¾è¡¨å°†å·²åˆ†é…å†…å­˜è¿æ¥èµ·æ¥\n\néœ€è¦ä¿¡æ¯æè¿°æ¯ä¸ªå†…å­˜å—çš„å…ƒæ•°æ®ï¼šå¤§å°ï¼Œæ˜¯å¦ä½¿ç”¨ï¼Œä¸‹ä¸€ä¸ªå†…å­˜å—çš„åœ°å€ç­‰\n\n![image.png](Extras/Images/image_1665644795653_0.png)\n\n# TCMalloc æ¦‚è§ˆ\n\n![image.png](Extras/Images/image_1665645649424_0.png)\n\n* page:å†…å­˜é¡µï¼Œä¸€å— 8K å¤§å°çš„å†…å­˜ç©ºé—´ã€‚Go ä¸æ“ä½œç³»ç»Ÿä¹‹é—´çš„å†…å­˜ç”³è¯·å’Œé‡Šæ”¾ï¼Œéƒ½æ˜¯ä»¥page ä¸ºå•ä½\n* span: å†…å­˜å—ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªè¿ç»­çš„ page ç»„æˆä¸€ä¸ª span\n* sizeclass : ç©ºé—´è§„æ ¼ï¼Œæ¯ä¸ª span éƒ½å¸¦æœ‰ä¸€ä¸ª sizeclass ï¼Œæ ‡è®°ç€è¯¥ span ä¸­çš„ page åº”è¯¥å¦‚ä½•\n* ä½¿ç”¨\n* object : å¯¹è±¡ï¼Œç”¨æ¥å­˜å‚¨ä¸€ä¸ªå˜é‡æ•°æ®å†…å­˜ç©ºé—´ï¼Œä¸€ä¸ª span åœ¨åˆå§‹åŒ–æ—¶ï¼Œä¼šè¢«åˆ‡å‰²æˆä¸€å †ç­‰å¤§çš„ object ï¼›å‡è®¾ object çš„å¤§å°æ˜¯ 16B ï¼Œspan å¤§å°æ˜¯ 8K ï¼Œé‚£ä¹ˆå°±ä¼šæŠŠ span ä¸­çš„ page å°±ä¼šè¢«åˆå§‹åŒ– 8K / 16B = 512 ä¸ª object ã€‚æ‰€è°“å†…å­˜åˆ†é…ï¼Œå°±æ˜¯åˆ†é…ä¸€ä¸ª object å‡ºå»\n\n* å¯¹è±¡å¤§å°å®šä¹‰\n\t* å°å¯¹è±¡å¤§å°ï¼š0~256KB\n\t* ä¸­å¯¹è±¡å¤§å°ï¼š256KB~1MB\n\t* å¤§å¯¹è±¡å¤§å°ï¼š\u003e1MB\n* å°å¯¹è±¡çš„åˆ†é…æµç¨‹\n\t* ThreadCache -\u003e CentralCache -\u003e HeapPageï¼Œå¤§éƒ¨åˆ†æ—¶å€™ï¼ŒThreadCache ç¼“å­˜éƒ½æ˜¯è¶³å¤Ÿçš„ï¼Œä¸éœ€è¦å»è®¿é—®CentralCache å’Œ HeapPageï¼Œæ— ç³»ç»Ÿè°ƒç”¨é…åˆæ— é”åˆ†é…ï¼Œåˆ†é…æ•ˆç‡æ˜¯éå¸¸é«˜çš„\n* ä¸­å¯¹è±¡åˆ†é…æµç¨‹\n\t* ç›´æ¥åœ¨ PageHeap ä¸­é€‰æ‹©é€‚å½“çš„å¤§å°å³å¯ï¼Œ128 Page çš„ Span æ‰€ä¿å­˜çš„æœ€å¤§å†…å­˜å°±æ˜¯ 1MB\n* å¤§å¯¹è±¡åˆ†é…æµç¨‹\n\t* ä» large span set é€‰æ‹©åˆé€‚æ•°é‡çš„é¡µé¢ç»„æˆ spanï¼Œç”¨æ¥å­˜å‚¨æ•°æ®\n\n# Goè¯­è¨€å†…å­˜åˆ†é…\n\n![image.png](Extras/Images/image_1665646120105_0.png)\n\nä¸¤ä¸ªå¤§å°ä¸€æ ·çš„span classå¯¹åº”ä¸€ä¸ªsize classï¼Œä¸€ä¸ªå­˜æŒ‡é’ˆï¼Œä¸€ä¸ªå­˜ç›´æ¥å¼•ç”¨å­˜ç›´æ¥å¼•ç”¨çš„spanæ— éœ€å†…å­˜å›æ”¶\n\n* mcacheï¼šå°å¯¹è±¡çš„å†…å­˜åˆ†é…ç›´æ¥èµ°\n\t* size class ä» 1 åˆ° 66ï¼Œæ¯ä¸ª class ä¸¤ä¸ª span\n\t* Span å¤§å°æ˜¯ 8KBï¼ŒæŒ‰ span class å¤§å°åˆ‡åˆ†\n* mcentral\n\t* Span å†…çš„æ‰€æœ‰å†…å­˜å—éƒ½è¢«å ç”¨æ—¶ï¼Œæ²¡æœ‰å‰©ä½™ç©ºé—´ç»§ç»­åˆ†é…å¯¹è±¡ï¼Œmcache ä¼šå‘ mcentral ç”³è¯·1ä¸ªspanï¼Œmcache æ‹¿åˆ° span åç»§ç»­åˆ†é…å¯¹è±¡\n\t* å½“ mcentral å‘ mcache æä¾› span æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„ spanï¼Œmcentral ä¼šå‘ mheap ç”³è¯·span\n* mheap\n\t* å½“ mheap æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜æ—¶ï¼Œmheap ä¼šå‘ OS ç”³è¯·å†…å­˜\n\t* Mheap æŠŠ Span ç»„ç»‡æˆäº†æ ‘ç»“æ„ï¼Œè€Œä¸æ˜¯é“¾è¡¨\n\t* ç„¶åæŠŠ Span åˆ†é…åˆ° heapArena è¿›è¡Œç®¡ç†ï¼Œå®ƒåŒ…å«åœ°å€æ˜ å°„å’Œ span æ˜¯å¦åŒ…å«æŒ‡é’ˆç­‰ä½å›¾\n\t\t* ä¸ºäº†æ›´é«˜æ•ˆçš„åˆ†é…ã€å›æ”¶å’Œå†åˆ©ç”¨å†…å­˜\n\n# å†…å­˜å›æ”¶\n\n* å¼•ç”¨è®¡æ•°ï¼ˆPythonï¼ŒPHPï¼ŒSwiftï¼‰\n\t* å¯¹æ¯ä¸€ä¸ªå¯¹è±¡ç»´æŠ¤ä¸€ä¸ªå¼•ç”¨è®¡æ•°ï¼Œå½“å¼•ç”¨è¯¥å¯¹è±¡çš„å¯¹è±¡è¢«é”€æ¯çš„å€™ï¼Œå¼•ç”¨è®¡æ•°å‡ 1ï¼Œå½“å¼•ç”¨è®¡æ•°ä¸º 0 çš„æ—¶å€™ï¼Œå›æ”¶è¯¥å¯¹è±¡\n\t* ä¼˜ç‚¹ï¼šå¯¹è±¡å¯ä»¥å¾ˆå¿«çš„è¢«å›æ”¶ï¼Œä¸ä¼šå‡ºç°å†…å­˜è€—å°½æˆ–è¾¾åˆ°æŸä¸ªé˜€å€¼æ—¶æ‰å›æ”¶\n\t* ç¼ºç‚¹ï¼šä¸èƒ½å¾ˆå¥½çš„å¤„ç†å¾ªç¯å¼•ç”¨ï¼Œè€Œä¸”å®æ—¶ç»´æŠ¤å¼•ç”¨è®¡æ•°ï¼Œæœ‰ä¹Ÿä¸€å®šçš„ä»£ä»·\n* æ ‡è®°-æ¸…é™¤ï¼ˆGolangï¼‰\n\t* ä»æ ¹å˜é‡å¼€å§‹éå†æ‰€æœ‰å¼•ç”¨çš„å¯¹è±¡ï¼Œå¼•ç”¨çš„å¯¹è±¡æ ‡è®°ä¸º\"è¢«å¼•ç”¨\"ï¼Œæ²¡æœ‰è¢«æ ‡è®°è¿›è¡Œå›æ”¶\n\t* ä¼˜ç‚¹ï¼šè§£å†³å¼•ç”¨è®¡æ•°çš„ç¼ºç‚¹\n\t* ç¼ºç‚¹ï¼šéœ€è¦ STWï¼ˆstop the wordï¼‰ï¼Œå³è¦æš‚åœç¨‹åºè¿è¡Œ\n* åˆ†ä»£æ”¶é›†ï¼ˆJavaï¼‰\n\t* æŒ‰ç…§ç”Ÿå‘½å‘¨æœŸè¿›è¡Œåˆ’åˆ†ä¸åŒçš„ä»£ç©ºé—´ï¼Œç”Ÿå‘½å‘¨æœŸé•¿çš„æ”¾å…¥è€å¹´ä»£ï¼ŒçŸ­çš„æ”¾å…¥æ–°ç”Ÿä»£ï¼Œæ–°ç”Ÿä»£çš„å›æ”¶é¢‘ç‡é«˜äºè€å¹´ä»£çš„é¢‘ç‡\n\n# mspan\n\n* allocBits\n\t* è®°å½•äº†æ¯å—å†…å­˜åˆ†é…çš„æƒ…å†µ\n* gcmarkBits\n\t* è®°å½•äº†æ¯å—å†…å­˜çš„å¼•ç”¨æƒ…å†µï¼Œæ ‡è®°é˜¶æ®µå¯¹æ¯å—å†…å­˜è¿›è¡Œæ ‡è®°ï¼Œæœ‰å¯¹è±¡å¼•ç”¨çš„å†…å­˜æ ‡è®°ä¸º1ï¼Œæ²¡æœ‰çš„æ ‡è®°ä¸º 0\n\n![image.png](Extras/Images/image_1665647360865_0.png)\n\nè¿™ä¸¤ä¸ªä½å›¾çš„æ•°æ®ç»“æ„æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œæ ‡è®°ç»“æŸåˆ™è¿›è¡Œå†…å­˜å›æ”¶ï¼Œå›æ”¶çš„æ—¶å€™ï¼Œå°† allocBits æŒ‡å‘ gcmarkBitsï¼Œæ ‡è®°è¿‡çš„åˆ™å­˜åœ¨ï¼Œæœªè¿›è¡Œæ ‡è®°çš„åˆ™è¿›è¡Œå›æ”¶\n\n![image.png](Extras/Images/image_1665647455220_0.png)\n\n# GCå·¥ä½œæµç¨‹\n\n* Golang GC çš„å¤§éƒ¨åˆ†å¤„ç†æ˜¯å’Œç”¨æˆ·ä»£ç å¹¶è¡Œçš„\n* Markï¼š\n\t* Mark Prepare: åˆå§‹åŒ– GC ä»»åŠ¡ï¼ŒåŒ…æ‹¬å¼€å¯å†™å±éšœ (write barrier) å’Œè¾…åŠ© GC(mutator assist)ï¼Œç»Ÿè®¡rootå¯¹è±¡çš„ä»»åŠ¡æ•°é‡ç­‰ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦STW\n\t* GC Drains: æ‰«ææ‰€æœ‰ root å¯¹è±¡ï¼ŒåŒ…æ‹¬å…¨å±€æŒ‡é’ˆå’Œ goroutine(G) æ ˆä¸Šçš„æŒ‡é’ˆï¼ˆæ‰«æå¯¹åº” G æ ˆæ—¶éœ€åœæ­¢è¯¥G)ï¼Œå°†å…¶åŠ å…¥æ ‡è®°é˜Ÿåˆ—(ç°è‰²é˜Ÿåˆ—)ï¼Œå¹¶å¾ªç¯å¤„ç†ç°è‰²é˜Ÿåˆ—çš„å¯¹è±¡ï¼Œç›´åˆ°ç°è‰²é˜Ÿåˆ—ä¸ºç©ºã€‚è¯¥è¿‡ç¨‹åå°å¹¶è¡Œæ‰§è¡Œ\n* Mark Terminationï¼šå®Œæˆæ ‡è®°å·¥ä½œï¼Œé‡æ–°æ‰«æ(re-scan)å…¨å±€æŒ‡é’ˆå’Œæ ˆã€‚å› ä¸º Mark å’Œç”¨æˆ·ç¨‹åºæ˜¯å¹¶è¡Œçš„ï¼Œæ‰€ä»¥åœ¨ Mark è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæœ‰æ–°çš„å¯¹è±¡åˆ†é…å’ŒæŒ‡é’ˆèµ‹å€¼ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦é€šè¿‡å†™å±éšœï¼ˆwrite barrierï¼‰è®°å½•ä¸‹æ¥ï¼Œre-scan å†æ£€æŸ¥ä¸€ä¸‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯ä¼š STW çš„\n* Sweepï¼šæŒ‰ç…§æ ‡è®°ç»“æœå›æ”¶æ‰€æœ‰çš„ç™½è‰²å¯¹è±¡ï¼Œè¯¥è¿‡ç¨‹åå°å¹¶è¡Œæ‰§è¡Œ\n* Sweep Terminationï¼šå¯¹æœªæ¸…æ‰«çš„ span è¿›è¡Œæ¸…æ‰«, åªæœ‰ä¸Šä¸€è½®çš„ GC çš„æ¸…æ‰«å·¥ä½œå®Œæˆæ‰å¯ä»¥å¼€å§‹æ–°ä¸€è½®çš„ GC\n\n![image.png](Extras/Images/image_1665648006969_0.png)\n\n# ä¸‰è‰²æ ‡è®°\n\nGC å¼€å§‹æ—¶ï¼Œè®¤ä¸ºæ‰€æœ‰ object éƒ½æ˜¯ ç™½è‰²ï¼Œå³åƒåœ¾ã€‚\n\nä» root åŒºå¼€å§‹éå†ï¼Œè¢«è§¦è¾¾çš„ object ç½®æˆ ç°è‰²ã€‚\n\néå†æ‰€æœ‰ç°è‰² objectï¼Œå°†ä»–ä»¬å†…éƒ¨çš„å¼•ç”¨å˜é‡ç½®æˆ ç°è‰²ï¼Œè‡ªèº«ç½®æˆ é»‘è‰²\n\nå¾ªç¯ç¬¬ 3 æ­¥ï¼Œç›´åˆ°æ²¡æœ‰ç°è‰² object äº†ï¼Œåªå‰©ä¸‹äº†é»‘ç™½ä¸¤ç§ï¼Œç™½è‰²çš„éƒ½æ˜¯åƒåœ¾ã€‚\n\nå¯¹äºé»‘è‰² objectï¼Œå¦‚æœåœ¨æ ‡è®°æœŸé—´å‘ç”Ÿäº†å†™æ“ä½œï¼Œå†™å±éšœä¼šåœ¨çœŸæ­£èµ‹å€¼å‰å°†æ–°å¯¹è±¡æ ‡è®°ä¸º ç°è‰²ã€‚\n\næ ‡è®°è¿‡ç¨‹ä¸­ï¼Œmallocgc æ–°åˆ†é…çš„ objectï¼Œä¼šå…ˆè¢«æ ‡è®°æˆ é»‘è‰² å†è¿”å›ã€‚\n\n![image.png](Extras/Images/image_1665648093332_0.png)\n\n# åƒåœ¾å›æ”¶è§¦å‘æœºåˆ¶\n\n* å†…å­˜åˆ†é…é‡è¾¾åˆ°é˜€å€¼è§¦å‘ GC\n\t* æ¯æ¬¡å†…å­˜åˆ†é…æ—¶éƒ½ä¼šæ£€æŸ¥å½“å‰å†…å­˜åˆ†é…é‡æ˜¯å¦å·²è¾¾åˆ°é˜€å€¼ï¼Œå¦‚æœè¾¾åˆ°é˜€å€¼åˆ™ç«‹å³å¯åŠ¨ GCã€‚\n\t\t* é˜€å€¼ = ä¸Šæ¬¡GC å†…å­˜åˆ†é…é‡ * å†…å­˜å¢é•¿ç‡\n\t\t* å†…å­˜å¢é•¿ç‡ç”±ç¯å¢ƒå˜é‡ GOGC æ§åˆ¶ï¼Œé»˜è®¤ä¸º 100ï¼Œå³æ¯å½“å†…å­˜æ‰©å¤§ä¸€å€æ—¶å¯åŠ¨ GCã€‚\n* å®šæœŸè§¦å‘ GC\n\t* é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ€é•¿ 2 åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ GCï¼Œè¿™ä¸ªé—´éš”åœ¨ src/runtime/proc.go:forcegcperiod å˜é‡ä¸­è¢«å£°æ˜\n* æ‰‹åŠ¨è§¦å‘\n\t* ç¨‹åºä»£ç ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ runtime.GC()æ¥æ‰‹åŠ¨è§¦å‘ GCã€‚è¿™ä¸»è¦ç”¨äº GC æ€§èƒ½æµ‹è¯•å’Œç»Ÿè®¡ã€‚\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Golang"]},"/Cards/CS/Golang/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1":{"title":"é¢å‘å¯¹è±¡","content":"\n# å¸¸ç”¨æ–¹æ³•\n\n* å¯è§æ€§æ§åˆ¶\n\t* public - å¸¸é‡ã€å˜é‡ã€ç±»å‹ã€æ¥å£ã€ç»“æ„ã€å‡½æ•°ç­‰çš„åç§°å¤§å†™\n\t* private - éå¤§å†™å°±åªèƒ½åœ¨åŒ…å†…ä½¿ç”¨\n* ç»§æ‰¿\n\t* é€šè¿‡ç»„åˆå®ç°ï¼Œå†…åµŒä¸€ä¸ªæˆ–å¤šä¸ª struct\n* å¤šæ€\n\t* é€šè¿‡æ¥å£å®ç°ï¼Œé€šè¿‡æ¥å£å®šä¹‰æ–¹æ³•é›†ï¼Œç¼–å†™å¤šå¥—å®ç°","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Golang"]},"/Cards/CS/Golang/GMP":{"title":"GMP","content":"\n\u003e æœ‰å…³ç³»ç»Ÿçš„è¿›ç¨‹å’Œè¿›ç¨‹çš„çŸ¥è¯†ï¼Œå¯å‚è€ƒ [[Linuxè¿›ç¨‹]]\n\n# åç¨‹\n\n* è¿›ç¨‹ï¼š\n\t* åˆ†é…ç³»ç»Ÿèµ„æºï¼ˆCPU æ—¶é—´ã€å†…å­˜ç­‰ï¼‰åŸºæœ¬å•ä½\n\t* æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œåˆ‡æ¢å¼€é”€å¤§\n* çº¿ç¨‹ï¼šè¿›ç¨‹çš„ä¸€ä¸ªæ‰§è¡Œæµï¼Œæ˜¯ CPU è°ƒåº¦å¹¶èƒ½ç‹¬ç«‹è¿è¡Œçš„çš„åŸºæœ¬å•ä½\n\t* åŒä¸€è¿›ç¨‹ä¸­çš„å¤šçº¿ç¨‹å…±äº«å†…å­˜ç©ºé—´ï¼Œçº¿ç¨‹åˆ‡æ¢ä»£ä»·å°\n\t* å¤šçº¿ç¨‹é€šä¿¡æ–¹ä¾¿\n\t* ä»å†…æ ¸å±‚é¢æ¥çœ‹çº¿ç¨‹å…¶å®ä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹ï¼Œå®ƒè·Ÿçˆ¶è¿›ç¨‹å…±äº«äº†æ‰“å¼€çš„æ–‡ä»¶å’Œæ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ï¼Œå…±äº«äº†åœ°å€ç©ºé—´å’Œä¿¡å·å¤„ç†å‡½æ•°\n* åç¨‹\n\t* Go è¯­è¨€ä¸­çš„è½»é‡çº§çº¿ç¨‹å®ç°\n\t* Golang åœ¨ runtimeã€ç³»ç»Ÿè°ƒç”¨ç­‰å¤šæ–¹é¢å¯¹ goroutine è°ƒåº¦è¿›è¡Œäº†å°è£…å’Œå¤„ç†ï¼Œå½“é‡åˆ°é•¿æ—¶é—´æ‰§è¡Œæˆ–è€…è¿›è¡Œç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œä¼šä¸»åŠ¨æŠŠå½“å‰ goroutine çš„ CPU (P) è½¬è®©å‡ºå»ï¼Œè®©å…¶ä»– goroutine èƒ½è¢«è°ƒåº¦å¹¶æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ Golang ä»è¯­è¨€å±‚é¢æ”¯æŒäº†åç¨‹\n\n# çº¿ç¨‹å’Œåç¨‹çš„å·®å¼‚\n\n* æ¯ä¸ª goroutine (åç¨‹) é»˜è®¤å ç”¨å†…å­˜è¿œæ¯” Java ã€C çš„çº¿ç¨‹å°‘\n\t* goroutineï¼š2KB\n\t* çº¿ç¨‹ï¼š8MB\n* çº¿ç¨‹/goroutine åˆ‡æ¢å¼€é”€æ–¹é¢ï¼Œgoroutine è¿œæ¯”çº¿ç¨‹å°\n\t* çº¿ç¨‹ï¼šæ¶‰åŠæ¨¡å¼åˆ‡æ¢(ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€)ã€16ä¸ªå¯„å­˜å™¨ã€PCã€SP...ç­‰å¯„å­˜å™¨çš„åˆ·æ–°\n\t* goroutineï¼šåªæœ‰ä¸‰ä¸ªå¯„å­˜å™¨çš„å€¼ä¿®æ”¹ - PC / SP / DX.\n* GOMAXPROCS\n\t* æ§åˆ¶å¹¶è¡Œçº¿ç¨‹æ•°é‡\n\n# Goroutine\n\nGo è¯­è¨€åŸºäº GMP æ¨¡å‹å®ç°ç”¨æˆ·æ€çº¿ç¨‹\n\n* Gï¼šè¡¨ç¤º goroutineï¼Œæ¯ä¸ª goroutine éƒ½æœ‰è‡ªå·±çš„æ ˆç©ºé—´ï¼Œå®šæ—¶å™¨ï¼Œåˆå§‹åŒ–çš„æ ˆç©ºé—´åœ¨ 2k å·¦å³ï¼Œç©ºé—´ä¼šéšç€éœ€æ±‚å¢é•¿ã€‚\n* Mï¼šæŠ½è±¡åŒ–ä»£è¡¨å†…æ ¸çº¿ç¨‹ï¼Œè®°å½•å†…æ ¸çº¿ç¨‹æ ˆä¿¡æ¯ï¼Œå½“ goroutine è°ƒåº¦åˆ°çº¿ç¨‹æ—¶ï¼Œä½¿ç”¨è¯¥ goroutine è‡ªå·±çš„æ ˆä¿¡æ¯ã€‚\n* Pï¼šä»£è¡¨è°ƒåº¦å™¨ï¼Œè´Ÿè´£è°ƒåº¦ goroutineï¼Œç»´æŠ¤ä¸€ä¸ªæœ¬åœ° goroutine é˜Ÿåˆ—ï¼ŒM ä» P ä¸Šè·å¾— goroutine å¹¶æ‰§è¡Œï¼ŒåŒæ—¶è¿˜è´Ÿè´£éƒ¨åˆ†å†…å­˜çš„ç®¡ç†ã€‚Pçš„æ•°é‡ä¸€èˆ¬ä¸CPUæ•°é‡ä¸€ç›´ã€‚\n\n![image.png](Extras/Images/image_1665580343096_0.png)\n\n# GMPçš„å¯¹åº”å…³ç³»\n\n![image.png](Extras/Images/image_1665581569027_0.png)\n\n# GMPæ¨¡å‹ç»†èŠ‚\n\n![image.png](Extras/Images/image_1665581701236_0.png)\n\n# G æ‰€å¤„çš„ä½ç½®\n\n* è¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå…¨å±€çš„ G é˜Ÿåˆ—\n* æ¯ä¸ª P æ‹¥æœ‰è‡ªå·±çš„æœ¬åœ°æ‰§è¡Œé˜Ÿåˆ—\n* æœ‰ä¸åœ¨è¿è¡Œé˜Ÿåˆ—ä¸­çš„ G\n\t* å¤„äº channel é˜»å¡æ€çš„ G è¢«æ”¾åœ¨ sudog\n\t* è„±ç¦» P ç»‘å®šåœ¨ M ä¸Šçš„ Gï¼Œå¦‚ç³»ç»Ÿè°ƒç”¨\n\t* ä¸ºäº†å¤ç”¨ï¼Œæ‰§è¡Œç»“æŸè¿›å…¥ P çš„ gFree åˆ—è¡¨ä¸­çš„ G\n\n# Goroutine åˆ›å»ºè¿‡ç¨‹\n\n* è·å–æˆ–è€…åˆ›å»ºæ–°çš„ Goroutine ç»“æ„ä½“\n\t* ä»å¤„ç†å™¨çš„ gFree åˆ—è¡¨ä¸­æŸ¥æ‰¾ç©ºé—²çš„ Goroutine\n\t* å¦‚æœä¸å­˜åœ¨ç©ºé—²çš„ Goroutineï¼Œä¼šé€šè¿‡ runtime.malg åˆ›å»ºä¸€ä¸ªæ ˆå¤§å°è¶³å¤Ÿçš„æ–°ç»“æ„ä½“\n* å°†å‡½æ•°ä¼ å…¥çš„å‚æ•°ç§»åˆ° Goroutine çš„æ ˆä¸Š\n* æ›´æ–° Goroutine è°ƒåº¦ç›¸å…³çš„å±æ€§ï¼Œæ›´æ–°çŠ¶æ€ä¸º_Grunnable\n* è¿”å›çš„ Goroutine ä¼šå­˜å‚¨åˆ°å…¨å±€å˜é‡ allgs ä¸­\n\n# å°† Goroutine æ”¾åˆ°è¿è¡Œé˜Ÿåˆ—ä¸Š\n\nGoroutine è®¾ç½®åˆ°å¤„ç†å™¨çš„ runnext ä½œä¸ºä¸‹ä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œçš„ä»»åŠ¡\n\nå½“å¤„ç†å™¨çš„**æœ¬åœ°è¿è¡Œé˜Ÿåˆ—å·²ç»æ²¡æœ‰å‰©ä½™ç©ºé—´æ—¶ï¼ˆ256ï¼‰**ï¼Œå°±ä¼šæŠŠæœ¬åœ°é˜Ÿåˆ—ä¸­çš„ä¸€éƒ¨åˆ† Goroutine å’Œå¾…åŠ å…¥çš„ Goroutine **é€šè¿‡ runtime.runqputslow æ·»åŠ åˆ°è°ƒåº¦å™¨æŒæœ‰çš„å…¨å±€è¿è¡Œé˜Ÿåˆ—ä¸Š**\n\n# è°ƒåº¦å™¨è¡Œä¸º\n\n* ä¸ºäº†ä¿è¯å…¬å¹³ï¼Œå½“å…¨å±€è¿è¡Œé˜Ÿåˆ—ä¸­æœ‰å¾…æ‰§è¡Œçš„ Goroutine æ—¶ï¼Œé€šè¿‡ schedtick ä¿è¯æœ‰ä¸€å®šå‡ ç‡ï¼ˆ1/61ï¼‰ä¼šä»**å…¨å±€çš„è¿è¡Œé˜Ÿåˆ—**ä¸­æŸ¥æ‰¾å¯¹åº”çš„ Goroutine\n* ä»å¤„ç†å™¨**æœ¬åœ°çš„è¿è¡Œé˜Ÿåˆ—**ä¸­æŸ¥æ‰¾å¾…æ‰§è¡Œçš„ Goroutine\n* å¦‚æœå‰ä¸¤ç§æ–¹æ³•éƒ½æ²¡æœ‰æ‰¾åˆ° Goroutineï¼Œä¼šé€šè¿‡ runtime.findrunnable **è¿›è¡Œé˜»å¡åœ°æŸ¥æ‰¾**Goroutine\n\t* ä»æœ¬åœ°è¿è¡Œé˜Ÿåˆ—ã€å…¨å±€è¿è¡Œé˜Ÿåˆ—ä¸­æŸ¥æ‰¾\n\t* ä»ç½‘ç»œè½®è¯¢å™¨ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰ Goroutine ç­‰å¾…è¿è¡Œ\n\t* é€šè¿‡ runtime.runqsteal å°è¯•ä»å…¶ä»–éšæœºçš„å¤„ç†å™¨ä¸­çªƒå–å¾…è¿è¡Œçš„ Goroutine\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Golang"]},"/Cards/CS/Golang/Modules":{"title":"Modules","content":"\nå¼€å¯modules\n\n`$ go env -w GO111MODULE=on`\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Golang"]},"/Cards/CS/Golang/Proxy":{"title":"Proxy","content":"\n# GOPROXY å’Œ GOPRIVAT\n\nä¸ºæ‹‰å– Go ä¾èµ–è®¾ç½®ä»£ç†\n\n`export GOPROXY=https://goproxy.cn`\n\nåœ¨è®¾ç½® GOPROXY ä»¥åï¼Œé»˜è®¤æ‰€æœ‰ä¾èµ–æ‹‰å–éƒ½éœ€è¦ç»è¿‡ proxy è¿æ¥ git repoï¼Œæ‹‰å–ä»£ç ï¼Œå¹¶åšchecksum æ ¡éªŒ\n\næŸäº›ç§æœ‰ä»£ç ä»“åº“æ˜¯ goproxy.cn æ— æ³•è¿æ¥çš„ï¼Œå› æ­¤éœ€è¦è®¾ç½® GOPRIVATE æ¥å£°æ˜ç§æœ‰ä»£ç ä»“åº“\n\n`GOPRIVATE=*.corp.example.com`\n`GOPROXY=proxy.example.com`\n`GONOPROXY=myrepo.corp.example.com`\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Golang"]},"/Cards/CS/Kubernetes/%E5%9F%BA%E4%BA%8EIstio%E7%9A%84%E9%AB%98%E7%BA%A7%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86":{"title":"åŸºäºIstioçš„é«˜çº§æµé‡ç®¡ç†","content":"\n# å¾®æœåŠ¡æ¶æ„çš„æ¼”å˜\n\n## Evolution\n\n![image.png](Extras/Images/image_1667232096191_0.png)\n\n![image.png](Extras/Images/image_1667232110413_0.png)\n\n## ä»å•å—ç³»ç»Ÿåˆ°å¾®æœåŠ¡ç³»ç»Ÿçš„æ¼”è¿›\n\n![image.png](Extras/Images/image_1667232153471_0.png)\n\n## å¾®æœåŠ¡æ¶æ„çš„æ¼”è¿›\n\n![image.png](Extras/Images/image_1667232200200_0.png)\n\n## å…¸å‹çš„å¾®æœåŠ¡ä¸šåŠ¡åœºæ™¯\n\n![image.png](Extras/Images/image_1667232226792_0.png)\n\n## æ›´å®Œæ•´çš„å¾®æœåŠ¡æ¶æ„\n\n![image.png](Extras/Images/image_1667232293928_0.png)\n\n## ç³»ç»Ÿè¾¹ç•Œ\n\n![image.png](Extras/Images/image_1667232353905_0.png)\n\n# å¾®æœåŠ¡åˆ°æœåŠ¡ç½‘æ ¼è¿˜ç¼ºä»€ä¹ˆ?\n\n## Sidecar çš„å·¥ä½œåŸç†\n\n![image.png](Extras/Images/image_1667232736020_0.png)\n\n## Service Mesh\n\n![image.png](Extras/Images/image_1667232759244_0.png)\n\n**é€‚åº”æ€§**\n- ç†”æ–­\n- é‡è¯•\n- è¶…æ—¶å¤„ç†\n- å¤±è´¥å¤„ç†\n- è´Ÿè½½å‡è¡¡\n- Failover\n\n**æœåŠ¡å‘ç°**\n- è·¯ç”±\n\n**å®‰å…¨å’Œè®¿é—®æ§åˆ¶**\n- TLSå’Œè¯ä¹¦ç®¡ç†\n\n**å¯è§‚å¯Ÿè¡Œ**\n- Metrics\n- ç›‘æ§\n- åˆ†å¸ƒå¼æ—¥å¿—\n- åˆ†å¸ƒå¼tracing\n\n**éƒ¨ç½²**\n- å®¹å™¨\n\n**é€šè®¯**\n- HTTP\n- WS\n- gRPC\n- TCP\n\n## å¾®æœåŠ¡çš„ä¼˜åŠ£\n\n**ä¼˜åŠ¿**\n- å°†åŸºç¡€æ¶æ„é€»è¾‘ä»ä¸šåŠ¡ä»£ç ä¸­å‰¥ç¦»å‡ºæ¥\n\t- åˆ†å¸ƒå¼ tracing\n\t- æ—¥å¿—\n- è‡ªç”±é€‰æ‹©æŠ€æœ¯æ ˆ\n- å¸®åŠ©ä¸šåŠ¡å¼€å‘éƒ¨é—¨åªå…³æ³¨ä¸šåŠ¡é€»è¾‘\n\n**åŠ£åŠ¿**\n- å¤æ‚\n\t- æ›´å¤šçš„è¿è¡Œå®ä¾‹\n- å¯èƒ½å¸¦æ¥é¢å¤–çš„ç½‘ç»œè·³è½¬\n\t- æ¯ä¸ªæœåŠ¡è°ƒç”¨éƒ½è¦ç»è¿‡ Sidecar\n- è§£å†³äº†ä¸€éƒ¨åˆ†é—®é¢˜ï¼ŒåŒæ—¶è¦ä»˜å‡ºä»£ä»·\n\t- ä¾ç„¶è¦å¤„ç†å¤æ‚è·¯ç”±ï¼Œç±»å‹æ˜ å°„ï¼Œä¸å¤–éƒ¨ç³»ç»Ÿæ•´åˆç­‰æ–¹é¢é—®é¢˜\n- ä¸è§£å†³ä¸šåŠ¡é€»è¾‘æˆ–æœåŠ¡æ•´åˆï¼ŒæœåŠ¡ç»„åˆç­‰é—®é¢˜\n\n## æœåŠ¡ç½‘æ ¼å¯é€‰æ–¹æ¡ˆ\n\n![image.png](Extras/Images/image_1667234149779_0.png)\n\n## ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼\n\n**æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰è¿™ä¸ªæœ¯è¯­é€šå¸¸ç”¨äºæè¿°æ„æˆè¿™äº›åº”ç”¨ç¨‹åºçš„å¾®æœåŠ¡ç½‘ç»œä»¥åŠåº”ç”¨ä¹‹é—´çš„äº¤äº’ã€‚** éšç€è§„æ¨¡å’Œå¤æ‚æ€§çš„å¢é•¿ï¼ŒæœåŠ¡ç½‘æ ¼è¶Šæ¥è¶Šéš¾ä»¥ç†è§£å’Œç®¡ç†ã€‚\n\nå®ƒçš„éœ€æ±‚åŒ…æ‹¬æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€æ•…éšœæ¢å¤ã€æŒ‡æ ‡æ”¶é›†å’Œç›‘æ§ä»¥åŠé€šå¸¸æ›´åŠ å¤æ‚çš„è¿ç»´éœ€æ±‚ä¾‹å¦‚ A/B æµ‹è¯•ã€é‡‘ä¸é›€å‘å¸ƒã€é™æµã€è®¿é—®æ§åˆ¶å’Œç«¯åˆ°ç«¯è®¤è¯ç­‰ã€‚\n\n![image.png](Extras/Images/image_1667236455656_0.png)\n\n## ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Istio\n\n**HTTPã€gRPCã€WebSocket å’Œ TCP**æµé‡çš„è‡ªåŠ¨è´Ÿè½½å‡è¡¡ã€‚\n\né€šè¿‡ä¸°å¯Œçš„è·¯ç”±è§„åˆ™ã€é‡è¯•ã€æ•…éšœè½¬ç§»å’Œæ•…éšœæ³¨å…¥ï¼Œå¯ä»¥å¯¹æµé‡è¡Œä¸ºè¿›è¡Œç»†ç²’åº¦æ§åˆ¶ã€‚\n\nå¯æ’å…¥çš„ç­–ç•¥å±‚å’Œé…ç½® APIï¼Œæ”¯æŒè®¿é—®æ§åˆ¶ã€é€Ÿç‡é™åˆ¶å’Œé…é¢ã€‚\n\nå¯¹å‡ºå…¥é›†ç¾¤å…¥å£å’Œå‡ºå£ä¸­æ‰€æœ‰æµé‡çš„è‡ªåŠ¨åº¦é‡æŒ‡æ ‡ã€æ—¥å¿—è®°å½•å’Œè·Ÿè¸ªã€‚\n\né€šè¿‡å¼ºå¤§çš„åŸºäºèº«ä»½çš„éªŒè¯å’Œæˆæƒï¼Œåœ¨é›†ç¾¤ä¸­å®ç°å®‰å…¨çš„æœåŠ¡é—´é€šä¿¡ã€‚\n\n## Istio åŠŸèƒ½æ¦‚è§ˆ\n\n![image.png](Extras/Images/image_1667236582525_0.png)\n\n## æµé‡ç®¡ç†\n\n**è¿æ¥**\n\né€šè¿‡ç®€å•çš„è§„åˆ™é…ç½®å’Œæµé‡è·¯ç”±ï¼Œå¯ä»¥æ§åˆ¶æœåŠ¡ä¹‹é—´çš„æµé‡å’Œ APIè°ƒç”¨ã€‚Istio ç®€åŒ–äº†æ–­è·¯å™¨ï¼Œè¶…æ—¶å’Œé‡è¯•ç­‰æœåŠ¡çº§åˆ«å±æ€§çš„é…ç½®ï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾è®¾ç½® A/B æµ‹è¯•ã€é‡‘ä¸é›€éƒ¨ç½²å’ŒåŸºäºç™¾åˆ†æ¯”çš„æµé‡åˆ†å‰²çš„åˆ†é˜¶æ®µéƒ¨ç½²ç­‰é‡è¦ä»»åŠ¡ã€‚\n\n**æ§åˆ¶**\n\né€šè¿‡æ›´å¥½åœ°äº†è§£æµé‡å’Œå¼€ç®±å³ç”¨çš„æ•…éšœæ¢å¤åŠŸèƒ½ï¼Œå¯ä»¥åœ¨é—®é¢˜å‡ºç°ä¹‹å‰å…ˆå‘ç°é—®é¢˜ï¼Œä½¿è°ƒç”¨æ›´å¯é ï¼Œå¹¶ä¸”ä½¿æ‚¨çš„ç½‘ç»œæ›´åŠ å¼ºå¤§â€”â€”æ— è®ºæ‚¨é¢ä¸´ä»€ä¹ˆæ¡ä»¶ã€‚\n\n## å®‰å…¨\n\n**å¼€å‘äººå‘˜å¯ä»¥ä¸“æ³¨äºåº”ç”¨ç¨‹åºçº§åˆ«çš„å®‰å…¨æ€§ã€‚** Istio æä¾›åº•å±‚å®‰å…¨é€šä¿¡ä¿¡é“ï¼Œå¹¶å¤§è§„æ¨¡ç®¡ç†æœåŠ¡é€šä¿¡çš„è®¤è¯ã€æˆæƒå’ŒåŠ å¯†ã€‚ä½¿ç”¨Istioï¼ŒæœåŠ¡é€šä¿¡åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯å®‰å…¨çš„ï¼Œå®ƒå…è®¸è·¨å¤šç§åè®®å’Œè¿è¡Œæ—¶ä¸€è‡´åœ°å®æ–½ç­–ç•¥æ‰€æœ‰è¿™äº›éƒ½å¾ˆå°‘æˆ–æ ¹æœ¬ä¸éœ€è¦åº”ç”¨ç¨‹åºæ›´æ”¹ã€‚\n\n**è™½ç„¶Istio ä¸å¹³å°æ— å…³ï¼Œä½†å°†å…¶ä¸Kubernetesï¼ˆæˆ–åŸºç¡€æ¶æ„ï¼‰ç½‘ç»œç­–ç•¥ç»“åˆä½¿ç”¨ï¼Œå…¶ä¼˜åŠ¿ä¼šæ›´å¤§ï¼ŒåŒ…æ‹¬åœ¨ç½‘ç»œå’Œåº”ç”¨å±‚ä¿æŠ¤ Pod é—´æˆ–æœåŠ¡é—´é€šä¿¡çš„èƒ½åŠ›ã€‚**\n\n## å¯è§‚å¯Ÿæ€§\n\nIstio ç”Ÿæˆä»¥ä¸‹ç±»å‹çš„é¥æµ‹æ•°æ®ï¼Œä»¥æä¾›å¯¹æ•´ä¸ªæœåŠ¡ç½‘æ ¼çš„å¯è§‚å¯Ÿæ€§âˆ¶\n\næŒ‡æ ‡ï¼šIstio åŸºäº4ä¸ªç›‘æ§çš„é»„é‡‘æ ‡è¯†ï¼ˆå»¶è¿Ÿã€æµé‡ã€é”™è¯¯ã€é¥±å’Œï¼‰ç”Ÿæˆäº†ä¸€ç³»åˆ—æœåŠ¡æŒ‡æ ‡ã€‚Istio è¿˜ä¸ºç½‘æ ¼æ§åˆ¶å¹³é¢æä¾›äº†æ›´è¯¦ç»†çš„æŒ‡æ ‡ã€‚é™¤æ­¤ä»¥å¤–è¿˜æä¾›äº†ä¸€ç»„é»˜è®¤çš„åŸºå¹²è¿™äº›æŒ‡æ ‡çš„ç½‘æ ¼ç›‘æ§ä»ªè¡¨æ¿ã€‚\n\nåˆ†å¸ƒå¼è¿½è¸ªï¼šIstio ä¸ºæ¯ä¸ªæœåŠ¡ç”Ÿæˆåˆ†å¸ƒå¼è¿½è¸ª spanï¼Œè¿ç»´äººå‘˜å¯ä»¥ç†è§£ç½‘æ ¼å†…æœåŠ¡çš„ä¾èµ–å’Œè°ƒç”¨æµç¨‹ã€‚\n\nè®¿é—®æ—¥å¿—ï¼šå½“æµé‡æµå…¥ç½‘æ ¼ä¸­çš„æœåŠ¡æ—¶ï¼ŒIstio å¯ä»¥ç”Ÿæˆæ¯ä¸ªè¯·æ±‚çš„å®Œæ•´è®°å½•ï¼ŒåŒ…æ‹¬æºå’Œç›®æ ‡çš„å…ƒæ•°æ®ã€‚æ­¤ä¿¡æ¯ä½¿è¿ç»´äººå‘˜èƒ½å¤Ÿå°†æœåŠ¡è¡Œä¸ºçš„å®¡æŸ¥æ§åˆ¶åˆ°å•ä¸ªå·¥ä½œè´Ÿè½½å®ä¾‹çš„çº§åˆ«ã€‚\n\n**æ‰€æœ‰è¿™äº›åŠŸèƒ½å¯ä»¥æ›´æœ‰æ•ˆåœ°è®¾ç½®ã€ç›‘æ§å’Œå®æ–½æœåŠ¡ä¸Šçš„ SLOï¼Œå¿«é€Ÿæœ‰æ•ˆåœ°æ£€æµ‹å’Œä¿®å¤é—®é¢˜ã€‚**\n\n## Istio æ¶æ„æ¼”è¿›\n\n- æ•°æ®å¹³é¢\n\t- ç”±ä¸€ç»„ä»¥Sidecaræ–¹å¼éƒ¨ç½²çš„æ™ºèƒ½ä»£ç†ï¼ˆEnvoyï¼‰ç»„æˆã€‚è¿™äº›ä»£ç†å¯ä»¥è°ƒèŠ‚å’Œæ§åˆ¶å¾®æœåŠ¡åŠMixerä¹‹æ‰€æœ‰çš„ç½‘ç»œé€šä¿¡ã€‚\n- æ§åˆ¶å¹³é¢\n\t- è´Ÿè´£ç®¡ç†å’Œé…ç½®ä»£ç†æ¥è·¯ç”±æµé‡ã€‚æ­¤å¤–æ§åˆ¶å¹³é¢é…ç½® Mixer ä»¥å®æ–½ç­–ç•¥å’Œæ”¶é›†é¥æµ‹æ•°æ®ã€‚\n- æ¶æ„æ¼”è¿›\n\t- ä»å¾®æœåŠ¡å›å½’å•ä½“\n\n![image.png](Extras/Images/image_1667237338403_0.png)\n\n## è®¾è®¡ç›®æ ‡\n\n**æœ€å¤§åŒ–é€æ˜åº¦**\n- Istio å°†è‡ªèº«è‡ªåŠ¨æ³¨å…¥åˆ°æœåŠ¡é—´æ‰€æœ‰çš„ç½‘ç»œè·¯å¾„ä¸­ï¼Œè¿ç»´å’Œå¼€å‘äººå‘˜åªéœ€ä»˜å‡ºå¾ˆå°‘çš„ä»£ä»·å°±å¯ä»¥ä»ä¸­å—ç›Šã€‚\n- Istio ä½¿ç”¨ Sidecar ä»£ç†æ¥æ•è·æµé‡ï¼Œå¹¶ä¸”åœ¨å°½å¯èƒ½çš„åœ°æ–¹è‡ªåŠ¨ç¼–ç¨‹ç½‘ç»œå±‚ï¼Œä»¥è·¯ç”±æµé‡é€šè¿‡è¿™äº›ä»£ç†ï¼Œè€Œæ— éœ€å¯¹å·²éƒ¨ç½²çš„åº”ç”¨ç¨‹åºä»£ç è¿›è¡Œä»»ä½•æ”¹åŠ¨ã€‚\n- åœ¨Kubernetesä¸­ï¼Œä»£ç†è¢«æ³¨å…¥åˆ° Podä¸­ï¼Œé€šè¿‡ç¼–å†™iptablesè§„åˆ™æ¥æ•è·æµé‡ã€‚æ³¨å…¥ Sidecar ä»£ç†åˆ°Pod ä¸­å¹¶ä¸”ä¿®æ”¹è·¯ç”±è§„åˆ™åï¼ŒIstio å°±èƒ½å¤Ÿè°ƒè§£æ‰€æœ‰æµé‡ã€‚\n- æ‰€æœ‰ç»„ä»¶å’Œ APIåœ¨è®¾è®¡æ—¶éƒ½å¿…é¡»è€ƒè™‘æ€§èƒ½å’Œè§„æ¨¡ã€‚\n\n**å¢é‡**\n- é¢„è®¡æœ€å¤§çš„éœ€æ±‚æ˜¯æ‰©å±•ç­–ç•¥ç³»ç»Ÿï¼Œé›†æˆå…¶ä»–ç­–ç•¥å’Œæ§åˆ¶æ¥æºï¼Œå¹¶å°†ç½‘æ ¼è¡Œä¸ºä¿¡å·ä¼ æ’­åˆ°å…¶ä»–ç³»ç»Ÿè¿›è¡Œåˆ†æã€‚ç­–ç•¥è¿è¡Œæ—¶æ”¯æŒæ ‡å‡†æ‰©å±•æœºåˆ¶ä»¥ä¾¿æ’å…¥åˆ°å…¶ä»–æœåŠ¡ä¸­ã€‚\n\n**å¯ç§»æ¤æ€§**\n- å°†åŸºäº Istio çš„æœåŠ¡ç§»æ¤åˆ°æ–°ç¯å¢ƒåº”è¯¥æ˜¯è½»è€Œæ˜“ä¸¾çš„ï¼Œè€Œä½¿ç”¨ Istio å°†ä¸€ä¸ªæœåŠ¡åŒæ—¶éƒ¨ç½²åˆ°å¤šä¸ªç¯å¢ƒä¸­ä¹Ÿæ˜¯å¯è¡Œçš„ï¼ˆä¾‹å¦‚ï¼Œåœ¨å¤šä¸ªäº‘ä¸Šè¿›è¡Œå†—ä½™éƒ¨ç½²ï¼‰ã€‚\n\n**ç­–ç•¥ä¸€è‡´æ€§**\n- åœ¨æœåŠ¡é—´çš„ APIè°ƒç”¨ä¸­ï¼Œç­–ç•¥çš„åº”ç”¨ä½¿å¾—å¯ä»¥å¯¹ç½‘æ ¼é—´è¡Œä¸ºè¿›è¡Œå…¨é¢çš„æ§åˆ¶ï¼Œä½†å¯¹äºæ— éœ€åœ¨ APIçº§åˆ«è¡¨è¾¾çš„èµ„æºæ¥è¯´ï¼Œå¯¹èµ„æºåº”ç”¨ç­–ç•¥ä¹ŸåŒæ ·é‡è¦ã€‚\n- å› æ­¤ï¼Œç­–ç•¥ç³»ç»Ÿä½œä¸ºç‹¬ç‰¹çš„æœåŠ¡æ¥ç»´æŠ¤ï¼Œå…·æœ‰è‡ªå·±çš„ APIï¼Œè€Œä¸æ˜¯å°†å…¶æ”¾åˆ°ä»£ç†/sidecar ä¸­ï¼Œè¿™å®¹è®¸æœ åŠ¡æ ¹æ®éœ€è¦ç›´æ¥ä¸å…¶é›†æˆã€‚\n\n# æ·±å…¥ç†è§£æ•°æ®å¹³é¢Envoy\n\n## ä¸»æµä¸ƒå±‚ä»£ç†çš„æ¯”è¾ƒ\n\n![image.png](Extras/Images/image_1667237802067_0.png)\n\n## Envoyçš„ä¼˜åŠ¿\n\n**æ€§èƒ½ï¼š**\n\nåœ¨å…·å¤‡å¤§é‡ç‰¹æ€§çš„åŒæ—¶ï¼ŒEnvoy æä¾›æé«˜çš„ååé‡å’Œä½å°¾éƒ¨å»¶è¿Ÿå·®å¼‚ï¼Œè€ŒCPU å’Œ RAMæ¶ˆè€—å´ç›¸å¯¹è¾ƒå°‘ã€‚\n\n**å¯æ‰©å±•æ€§ï¼š**\n\nEnvoy åœ¨ L4å’ŒL7éƒ½æä¾›äº†ä¸°å¯Œçš„å¯æ’æ‹”è¿‡æ»¤å™¨èƒ½åŠ›ï¼Œä½¿ç”¨æˆ·å¯ä»¥è½»æ¾æ·»åŠ  å¼€æºç‰ˆæœ¬ä¸­æ²¡æœ‰çš„åŠŸèƒ½ã€‚\n\n**APIå¯é…ç½®æ€§ï¼š**\n\nEnvoyæä¾›äº†ä¸€ç»„å¯ä»¥é€šè¿‡æ§åˆ¶å¹³é¢æœåŠ¡å®ç°çš„ç®¡ç† APIã€‚å¦‚æœæ§åˆ¶å¹³é¢å®ç°æ‰€æœ‰çš„ APIï¼Œåˆ™å¯ä»¥ä½¿ç”¨é€šç”¨å¼•å¯¼é…ç½®åœ¨æ•´ä¸ªåŸºç¡€æ¶æ„ä¸Šè¿è¡ŒEnvoyã€‚æ‰€æœ‰è¿›ä¸€æ­¥çš„é…ç½®æ›´æ”¹é€šè¿‡ç®¡ç†æœåŠ¡å™¨ä»¥æ— ç¼æ–¹å¼åŠ¨æ€ä¼ é€ï¼Œå› æ­¤ EnvoVä»ä¸éœ€è¦é‡æ–°å¯åŠ¨ã€‚è¿™ä½¿å¾—EnvoVæˆä¸ºé€šç”¨æ•°æ®å¹³é¢å½“å®ƒä¸ä¸€ä¸ªè¶³å¤Ÿå¤æ‚çš„æ§åˆ¶å¹³é¢ç›¸ç»“åˆæ—¶ï¼Œä¼šæå¤§çš„é™ä½æ•´ä½“è¿ç»´çš„å¤æ‚æ€§ã€‚\n\n## Envoy çº¿ç¨‹æ¨¡å¼\n\n- **Envoy é‡‡ç”¨å•è¿›ç¨‹å¤šçº¿ç¨‹æ¨¡å¼ï¼š**\n\t- ä¸»çº¿ç¨‹è´Ÿè´£åè°ƒï¼›\n\t- å­çº¿ç¨‹è´Ÿè´£ç›‘å¬è¿‡æ»¤å’Œè½¬å‘ã€‚\n- å½“æŸè¿æ¥è¢«ç›‘å¬å™¨æ¥å—ï¼Œé‚£ä¹ˆè¯¥è¿æ¥çš„å…¨éƒ¨ç”Ÿå‘½å‘¨æœŸä¼šä¸æŸçº¿ç¨‹ç»‘å®šã€‚\n- EnvoyåŸºäºéé˜»å¡æ¨¡å¼ï¼ˆEpollï¼‰ã€‚\n- **å»ºè®® Envoy é…ç½®çš„ workeræ•°é‡ä¸ Envoyæ‰€åœ¨çš„ç¡¬ä»¶çº¿ç¨‹æ•°ä¸€è‡´ã€‚**\n\n## Envoy æ¶æ„\n\n![image.png](Extras/Images/image_1667239065136_0.png)\n\n## v1 APIçš„ç¼ºç‚¹å’Œv2çš„å¼•å…¥\n\n**v1 APIä»…ä½¿ç”¨ JSON/RESTï¼Œæœ¬è´¨ä¸Šæ˜¯è½®è¯¢ã€‚** è¿™æœ‰å‡ ä¸ªç¼ºç‚¹âˆ¶\n\nå°½ç®¡Envoyåœ¨å†…éƒ¨ä½¿ç”¨çš„æ˜¯ JSON æ¨¡å¼ï¼Œä½† APIæœ¬èº«å¹¶ä¸æ˜¯å¼ºç±»å‹ï¼Œè€Œä¸”å®‰å…¨å®ç°å®ƒä»¬çš„é€šç”¨æœåŠ¡å™¨ä¹Ÿå¾ˆéš¾ã€‚\n\nè™½ç„¶è½®è¯¢å·¥ä½œåœ¨å®è·µä¸­æ˜¯å¾ˆæ­£å¸¸çš„ç”¨æ³•ï¼Œä½†æ›´å¼ºå¤§çš„æ§åˆ¶å¹³é¢æ›´å–œæ¬¢ streaming APIï¼Œå½“å…¶å°±ç»ªåï¼Œå¯ä»¥å°†æ›´æ–°æ¨é€ç»™æ¯ä¸ªEnvoVã€‚è¿™å¯ä»¥å°†æ›´æ–°ä¼ æ’­æ—¶é—´ä» 30-60ç§’é™ä½åˆ°250-500 æ¯«ç§’ï¼Œå³ä½¿åœ¨æå…¶åºå¤§çš„éƒ¨ç½²ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ã€‚\n\n**v2 APIå…·æœ‰ä»¥ä¸‹å±æ€§âˆ¶**\n\næ–°çš„ APIæ¨¡å¼ä½¿ç”¨ proto3æŒ‡å®šï¼Œå¹¶åŒæ—¶ä»¥gRPCå’Œ REST+JSON/YAMLç«¯ç‚¹å®ç°ã€‚\n\nå®ƒä»¬è¢«å®šä¹‰åœ¨ä¸€ä¸ªåä¸º envoy-apiçš„æ–°çš„ä¸“ç”¨æºä»£ç ä»“åº“ä¸­ã€‚proto3çš„ä½¿ç”¨æ„å‘³ç€è¿™äº› APIæ˜¯å¼ºç±»å‹çš„ï¼ŒåŒæ—¶ä»ç„¶é€šè¿‡ proto3çš„JSON/YAML è¡¨ç¤ºæ¥æ”¯æŒJSON/YAMLå˜ä½“ã€‚\n\nä¸“ç”¨å­˜å‚¨ä»“åº“çš„ä½¿ç”¨æ„å‘³ç€é¡¹ç›®å¯ä»¥æ›´å®¹æ˜“çš„ä½¿ç”¨ APIå¹¶ç”¨ gRPCæ”¯æŒçš„æ‰€æœ‰è¯­è¨€ç”Ÿæˆå­˜æ ¹ï¼ˆ**å®é™…ä¸Šï¼Œå¯¹äºå¸Œæœ›ä½¿ç”¨å®ƒçš„ç”¨æˆ·ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ”¯æŒåŸºäºREST çš„JSON/YAML å˜ä½“ï¼‰ã€‚**\n\n## xDS- Envoy çš„å‘ç°æœºåˆ¶\n\n**Endpoint Discovery Service (EDS):**\n\nè¿™æ˜¯ v1 SDS APIçš„æ›¿ä»£å“ã€‚æ­¤å¤–ï¼ŒgRPCçš„åŒå‘æµæ€§è´¨å°†å…è®¸å°†è´Ÿè½½/å¥åº·ä¿¡æ¯æŠ¥å‘Šå›ç®¡ç†æœåŠ¡å™¨ï¼Œä¸ºå°†æ¥çš„å…¨å±€è´Ÿè½½å‡è¡¡åŠŸèƒ½å¼€å¯å¤§é—¨ã€‚\n\n**Cluster Discovery Service (CDS):**\n\nå’ŒV1 æ²¡æœ‰å®è´¨æ€§å˜åŒ–ã€‚\n\n**Route Discovery Service (RDS):**\n\nå’ŒV1æ²¡æœ‰å®è´¨æ€§å˜åŒ–ã€‚\n\n**Listener Discovery Service (LDS):**\n\nå’Œv1 çš„å”¯ä¸€ä¸»è¦å˜åŒ–æ˜¯âˆ¶ç°åœ¨å…è®¸ç›‘å¬å™¨å®šä¹‰å¤šä¸ªå¹¶å‘è¿‡æ»¤æ ˆï¼Œè¿™äº›è¿‡æ»¤æ ˆå¯ä»¥åŸºäºä¸€ç»„ç›‘å¬å™¨è·¯ç”±è§„åˆ™ï¼ˆä¾‹å¦‚ï¼ŒSNIï¼Œæº/ç›®çš„åœ°IP åŒ¹é…ç­‰ï¼‰æ¥é€‰æ‹©ã€‚è¿™æ˜¯å¤„ç†\"åŸå§‹ç›®çš„åœ°\"ç­–ç•¥è·¯ç”±çš„æ›´ç®€æ´çš„æ–¹å¼ï¼Œè¿™ç§è·¯ç”±æ˜¯é€æ˜æ•°æ®å¹³é¢è§£å†³æ–¹æ¡ˆï¼ˆå¦‚ Istioï¼‰æ‰€éœ€è¦çš„ã€‚\n\n**Secret Discovery Service (SDS):**\n\nä¸€ä¸ªä¸“ç”¨çš„ APIæ¥ä¼ é€’TLSå¯†é’¥ææ–™ã€‚è¿™å°†è§£è€¦é€šè¿‡ LDS/CDSå‘é€ä¸»è¦ç›‘å¬å™¨ã€é›†ç¾¤é…ç½®å’Œé€šè¿‡ä¸“ç”¨å¯†é’¥ç®¡ç†ç³»ç»Ÿå‘é€ç§˜é’¥ç´ æã€‚\n\n**Health Discovery Service (HDS):**\n\nè¯¥ APIå°†å…è®¸Envoyæˆä¸ºåˆ†å¸ƒå¼å¥åº·æ£€æŸ¥ç½‘ç»œçš„æˆå‘˜ã€‚ä¸­å¤®å¥åº·æ£€æŸ¥æœåŠ¡å¯ä»¥ä½¿ç”¨ä¸€ç»„Envoyä½œä¸ºå¥åº·æ£€æŸ¥ç»ˆç‚¹å¹¶å°†çŠ¶æ€æŠ¥å‘Šå›æ¥ï¼Œä»è€Œç¼“è§£ Nå¥åº·æ£€æŸ¥é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜æŒ‡çš„æ˜¯å…¶é—´çš„æ¯ä¸ªEnvoy éƒ½å¯èƒ½éœ€è¦å¯¹æ¯ä¸ªå…¶ä»– Envoy è¿›è¡Œå¥åº·æ£€æŸ¥ã€‚\n\n**Aggregated Discovery Service (ADS):**\n\næ€»çš„æ¥è¯´ï¼ŒEnvoyçš„è®¾è®¡æ˜¯æœ€ç»ˆä¸€è‡´çš„ã€‚è¿™æ„å‘³ç€é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªç®¡ç†APIéƒ½å¹¶å‘è¿è¡Œï¼Œå¹¶ä¸”ä¸ä¼šç›¸äº’äº¤äº’ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸€æ¬¡ä¸€ä¸ªç®¡ç†æœåŠ¡å™¨å¤„ç†å•ä¸ªEnvoyçš„æ‰€æœ‰æ›´æ–°æ˜¯æœ‰ç›Šçš„ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœéœ€è¦å¯¹æ›´æ–°è¿›è¡Œæ’åºä»¥é¿å…æµé‡ä¸‹é™ï¼‰ã€‚æ­¤ APIå…è®¸é€šè¿‡å•ä¸ªç®¡ç†æœåŠ¡å™¨çš„å•ä¸ªgRPC åŒå‘æµå¯¹æ‰€æœ‰å…¶ä»– APIè¿›è¡Œç¼–ç»„ï¼Œä»è€Œå®ç°ç¡®å®šæ€§æ’åºã€‚\n\n## Envoy çš„è¿‡æ»¤å™¨æ¨¡å¼\n\n![image.png](Extras/Images/image_1667239733328_0.png)\n\n## Isitoæµé‡ç®¡ç†\n\n## æµé‡ç®¡ç†\n\n- Gateway\n- VirtualService\n- DestinationRule\n- ServieEntry\n- WorkloadEntry\n- Sidecar\n\n## Istio çš„æµé‡åŠ«æŒæœºåˆ¶\n\n**ä¸ºç”¨æˆ·åº”ç”¨æ³¨å…¥Sidecar**\n- è‡ªåŠ¨æ³¨å…¥\n- æ‰‹åŠ¨æ³¨å…¥\n\t- istioctl kube-inject -f yaml/istio-bookinfo/bookinfo.yaml\n\n**æ³¨å…¥åçš„ç»“æœ**\n- æ³¨å…¥äº† init-container istio-init\n\t- `istio-iptables -p 15001-z15006-u 1337-m REDIRECT -i * -x -b 9080-d 15090,15021,15020`\n- æ³¨å…¥äº† sidecar container istio-proxy\n\n![image.png](Extras/Images/image_1667293416806_0.png)\n\n## Init container\n\n**å°†åº”ç”¨å®¹å™¨çš„æ‰€æœ‰æµé‡éƒ½è½¬å‘åˆ°Envoyçš„15001ç«¯å£ã€‚**\n\nä½¿ç”¨ istio-proxy ç”¨æˆ·èº«ä»½è¿è¡Œï¼ŒUIDä¸º1337ï¼Œå³Envoyæ‰€å¤„çš„ç”¨æˆ·ç©ºé—´ï¼Œè¿™ä¹Ÿæ˜¯istio-proxyå®¹å™¨é»˜è®¤ä½¿ç”¨çš„ç”¨æˆ·ï¼Œè§YAMLé…ç½®ä¸­çš„runAsUserå­—æ®µã€‚\n\nä½¿ç”¨é»˜è®¤çš„REDIRECTæ¨¡å¼æ¥é‡å®šå‘æµé‡ã€‚\n\nå°†æ‰€æœ‰å‡ºç«™æµé‡éƒ½é‡å®šå‘åˆ°Envoyä»£ç†ã€‚\n\nå°†æ‰€æœ‰è®¿é—®9080ç«¯å£ï¼ˆå³åº”ç”¨å®¹å™¨productpageçš„ç«¯å£ï¼‰çš„æµé‡é‡å®šå‘åˆ°Envoyä»£ç†ã€‚\n\n```\n//æ‰€æœ‰å…¥ç«™TCPæµé‡èµ°ISTIO_INBOUND\n-A PREROUTING-P tcp-j ISTIO_INBOUND\n\n//æ‰€æœ‰å‡ºç«™TCPæµé‡èµ°ISTIO_OUTPUT\n-A OUTPUT-P tcp-j ISTIO  OUTPUT\n\n//å¿½ç•¥sshï¼Œhealth checkç­‰ç«¯å£\n-A ISTIO_INBOUND-p tcp-m tcp--dport 22-j RETURN\n-A ISTIO_INBOUND-p tcp-m tcp--dport 15090-j RETURN\n-A ISTIO_INBOUND-p tcp-m tcp--dport 15021-j RETURN\n-A ISTIO INBOUND-p tcp-m tcp--dport 15020-j RETURN\n//æ‰€æœ‰å…¥ç«™TCPæµé‡èµ°ISTIO_IN_REDIRECT\n-A ISTIO_INBOUND-P tcp-j ISTIO_IN_REDIRECT\n\n//TCPæµé‡è½¬å‘è‡³15006ç«¯å£\n-AISTIO_IN_REDIRECT-p tcp-j REDIRECT--to-ports 15006\n\n//loopback passthrough\n-A ISTIO OUTPUT-S 127.0.0.6/32-o lo-j RETURN\n//ä»loopbackå£å‡ºæ¥ï¼Œç›®æ ‡éæœ¬æœºåœ°å€ï¼Œowneræ˜¯envoyï¼Œäº¤ç”±ISTIO_IN_REDIRECTå¤„ç†\n-A ISTIO OUTPUT!-d 127.0.0.1/32-o lo-m owner--uid-owner 1337-j ISTIO_IN_REDIRECT\n//ä»loå£å‡ºæ¥ï¼Œowneréenvoyï¼Œreturn\n-A ISTIO_OUTPUT-o lo -m owner!--uid-owner 1337-j RETURN\n//owneræ˜¯envoyï¼Œreturn\n-A ISTIO_OUTPUT-m owner--uid-owner 1337-j RETURN\n-A ISTIO OUTPUT!-d 127.0.0.1/32-o lo-m owner--gid-owner 1337-j ISTIO_IN_REDIRECT\n-A ISTIO_OUTPUT-o lo-m owner!--gid-owner 1337-j RETURN\n-A ISTIO OUTPUT-m owner--gid-owner 1337-j RETURN\n-A ISTIO OUTPUT-d 127.0.0.1/32-j RETURN\n//å¦‚ä»¥ä¸Šè§„åˆ™éƒ½ä¸åŒ¹é…ï¼Œåˆ™äº¤ç»™ISTIO REDIRECTå¤„ç†\n-A ISTIO_OUTPUT-j ISTIO_REDIRECT\n\n-A ISTIO_REDIRECT-p tcp -j REDIRECT --to-ports 15001\n```\n\n## Sidecar containe\n\n**Istioä¼šç”Ÿæˆä»¥ä¸‹ç›‘å¬å™¨ï¼š**\n- 0.0.0.0âˆ¶15001ä¸Šçš„ç›‘å¬å™¨æ¥æ”¶è¿›å‡ºPodçš„æ‰€æœ‰æµé‡ï¼Œç„¶åå°†è¯·æ±‚ç§»äº¤ç»™è™šæ‹Ÿç›‘å¬å™¨ã€‚\n- æ¯ä¸ªservice IPä¸€ä¸ªè™šæ‹Ÿç›‘å¬å™¨ï¼Œæ¯ä¸ªå‡ºç«™TCP/HTTPSæµé‡ä¸€ä¸ªéHTTPç›‘å¬å™¨ã€‚\n- æ¯ä¸ªPodå…¥ç«™æµé‡æš´éœ²çš„ç«¯å£ä¸€ä¸ªè™šæ‹Ÿç›‘å¬å™¨ã€‚\n- æ¯ä¸ªå‡ºç«™HTTPæµé‡çš„HTTP 0.0.0.0ç«¯å£ä¸€ä¸ªè™šæ‹Ÿç›‘å¬å™¨ã€‚\n\n`istioctl proxy-config listeners productpage-v1-8b96c8794-bttdd -n bookinfo--port 15001-ojson`\n\n```json\n{\n    \"name\": \"virtual\",\n    \"address\": {\n        \"socketAddress\": {\n            \"address\": \"0.0.0.0\",\n            \"portValue\": 15001\n        }\n    },\n    \"filterChains\": [\n        {\n            \"filters\": [\n                {\n                    \"name\": \"envoy.tcp_proxy\",\n                    \"config\": {\n                        \"cluster\": \"BlackHoleCluster\",\n                        \"stat_prefix\": \"BlackHoleCluster\"\n                    }\n                }\n            ]\n        }\n    ],\n    \"useOriginalDst\": true\n}\n```\n\n---\n\n**æˆ‘ä»¬çš„è¯·æ±‚æ˜¯åˆ°9080 ç«¯å£çš„ HTTP å‡ºç«™è¯·æ±‚ï¼Œè¿™æ„å‘³ç€å®ƒè¢«åˆ‡æ¢åˆ° 0.0.0.0âˆ¶9080è™šæ‹Ÿç›‘å¬å™¨ã€‚**ç„¶åï¼Œæ­¤ç›‘å¬å™¨åœ¨å…¶é…ç½®çš„RDSä¸­é¦™æ‰¾è·¯ç”±é…ç½®ã€‚åœ¨è¿™ç§æƒ… å†µä¸‹ï¼Œå®ƒå°†æŸ¥æˆ‘ç”± Pilot é…ç½®çš„ RDSä¸­çš„è·¯ç”±9080ï¼ˆé€šè¿‡ADSï¼‰ã€‚\n\n```bash\nnetstat -nalgrep LISTEN\ntcp  0 0    127.0.0.1:15000 0.0.0.0:*   LISTEN\ntcp  0 0    0.0.0.0.15001   0.0.0.0:*   LISTEN\ntcp6 0 0    ::9080          :::*        LISTEN\n```\n\n```json\n\"rds\": {\n    \"config_source\": {\n        \"ads\": {}\n    },\n    \"route_config name\": \"9080\"\n}\n```\n\n---\n\n**9080è·¯ç”±é…ç½®ä»…ä¸ºæ¯ä¸ªæœåŠ¡æä¾›è™šæ‹Ÿä¸»æœºã€‚** æˆ‘ä»¬çš„è¯·æ±‚æ­£åœ¨å‰å¾€ reviews æœåŠ¡ï¼Œå› æ­¤ Envoy å°†é€‰æ‹©æˆ‘ä»¬çš„è¯·æ±‚ä¸åŸŸåŒ¹é…çš„è™šæ‹Ÿä¸»æœºã€‚ä¸€æ—¦åœ¨åŸŸä¸ŠåŒ¹é…ï¼ŒEnvoyä¼šæŸ¥æ‰¾ä¸è¯·æ±‚åŒ¹é…çš„ç¬¬ä¸€æ¡è·¯å¾„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ²¡æœ‰ä»»ä½•é«˜çº§è·¯ç”±ï¼Œå› æ­¤åªæœ‰ä¸€æ¡è·¯ç”±åŒ¹é…æ‰€æœ‰å†…å®¹ã€‚\n\nè¿™æ¡è·¯ç”±å‘Šè¯‰Envoyå°†è¯·æ±‚å‘é€åˆ°outbound\\[9080\\]lreviews.default.svc.cluster.local é›†ç¾¤ã€‚\n\n`istioctl proxy-config routes productpage-v1-8b96c8794-bttdd --name 9080 -o json -n bookinfo`\n\n```json\n{\n    \"name\": \"9080\",\n    \"virtualHosts\": [\n        {\n            \"name\": \"reviews.bookinfo.svc.cluster.local:9080\",\n            \"domains\": [\n                \"reviews.bookinfo.svc.cluster.local\",\n                \"reviews.bookinfo.svc.cluster.local:9080\",\n                \"reviews\",\n                \"reviews:9080\",\n                \"reviews.bookinfo.svc.cluster\",\n                \"reviews.bookinfo.svc.cluster:9080\",\n                \"reviews.bookinfo.svc\",\n                \"reviews.bookinfo.svc:9080\",\n                \"reviews.bookinfo\",\n                \"reviews.bookinfo:9080\",\n                \"192.168.143.232\",\n                \"192.168.143.232:9080\"\n            ],\n            \"routes\": [\n                {\n                    \"match\": {\n                        \"prefix\": \"/\"\n                    },\n                    \"route\": {\n                        \"cluster\": \"outbound|9080]lreviews.bookinfo.svc.cluster.local\",\n                        \"timeout\": \"0.000s\",\n                        \"maxGrpcTimeout\": \"0.000s\"\n                    }\n                }\n            ]\n        }\n    ]\n}\n```\n\n---\n\n**æ­¤é›†ç¾¤é…ç½®ä¸ºä» Pilotï¼ˆé€šè¿‡ ADSï¼‰æ£€ç´¢å…³è”çš„ç«¯ç‚¹ã€‚** å› æ­¤ï¼ŒEnvoy å°†ä½¿ç”¨ serviceNameå­—æ®µä½œ\n\nä¸ºå¯†é’¥æ¥æŸ¥æ‰¾ç«¯ç‚¹åˆ—è¡¨å¹¶å°†è¯·æ±‚ä»£ç†åˆ°å…¶ä¸­ä¸€ä¸ªç«¯ç‚¹ã€‚\n\n`istioctl proxy-config clusters productpage-v1-8b96c8794-bttdd --fqdn reviews.bookinfo.svc.cluster.local -n bookinfo-ojson`\n\n```json\n{\n    \"name\": \"outbound|9080l|reviews.bookinfo.svc.cluster.local\",\n    \"type\": \"EDS\",\n    \"edsclusterConfig\": {\n        \"edsConfig\": {\n            \"ads\": {}\n        },\n        \"serviceName\": \"outbound|9080|lreviews.bookinfo.svc.cluster.local\",\n        \"connectTimeout\": \"1.000s\",\n        \"circuitBreakers\": {\n            \"thresholds\": [\n                {}\n            ]\n        }\n    }\n}\n```\n\n## æµé‡ç®¡ç†\n\n![image.png](Extras/Images/image_1667296531856_0.png)\n\n## è¯·æ±‚è·¯ç”±\n\n**ç‰¹å®šç½‘æ ¼ä¸­æœåŠ¡çš„è§„èŒƒè¡¨ç¤ºç”± Pilot ç»´æŠ¤ã€‚** æœåŠ¡çš„ Istio æ¨¡å‹å’Œåœ¨åº•å±‚å¹³å°ï¼ˆKubernetesã€Mesosä»¥åŠ Cloud Foundrv ç­‰ï¼‰ä¸­çš„è¡¨è¾¾æ— å…³ã€‚ç‰¹å®šå¹³å°çš„é€‚é…å™¨è´Ÿè´£ä»å„è‡ªå¹³å°ä¸­è·å–å…ƒæ•°æ®çš„å„ç§å­—æ®µï¼Œç„¶åå¯¹æœåŠ¡æ¨¡å‹è¿›è¡Œå¡«å……ã€‚\n\n**Istio å¼•å…¥äº†æœåŠ¡ç‰ˆæœ¬çš„æ¦‚å¿µï¼Œå¯ä»¥é€šè¿‡ç‰ˆæœ¬ï¼ˆv1ã€v2ï¼‰æˆ–ç¯å¢ƒï¼ˆstagingã€prodï¼‰å¯¹æœåŠ¡è¿›è¡Œè¿›ä¸€æ­¥çš„ç»†åˆ†ã€‚** è¿™äº›ç‰ˆæœ¬ä¸ä¸€å®šæ˜¯ä¸åŒçš„ APIç‰ˆæœ¬âˆ¶å®ƒä»¬å¯èƒ½æ˜¯éƒ¨ç½²åœ¨ä¸åŒç¯å¢ƒï¼ˆprodã€stagingæˆ–è€… dev ç­‰ï¼‰ä¸­çš„åŒä¸€æœåŠ¡çš„ä¸åŒè¿­ä»£ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼çš„å¸¸è§åœºæ™¯åŒ…æ‹¬A/Bæµ‹è¯•æˆ–é‡‘ä¸é›€éƒ¨ç½²ã€‚\n\n**Istio çš„æµé‡è·¯ç”±è§„åˆ™å¯ä»¥æ ¹æ®æœåŠ¡ç‰ˆæœ¬æ¥å¯¹æœåŠ¡ä¹‹é—´æµé‡è¿›è¡Œé™„åŠ æ§åˆ¶ã€‚**\n\n## æœåŠ¡ä¹‹é—´çš„é€šè®¯\n\n**æœåŠ¡çš„å®¢æˆ·ç«¯ä¸çŸ¥é“æœåŠ¡ä¸åŒç‰ˆæœ¬é—´çš„å·®å¼‚ã€‚** å®ƒä»¬å¯ä»¥ä½¿ç”¨æœåŠ¡çš„ä¸»æœºåæˆ–è€… IPåœ°å€ç»§ç»­è®¿é—®æœåŠ¡ã€‚Envoy sidecar/ ä»£ç†æ‹¦æˆªå¹¶è½¬å‘å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ‰€æœ‰è¯·æ±‚å’Œå“åº”ã€‚\n\nIstio è¿˜ä¸ºåŒä¸€æœåŠ¡ç‰ˆæœ¬çš„å¤šä¸ªå®ä¾‹æä¾›æµé‡è´Ÿè½½å‡è¡¡ã€‚å¯ä»¥åœ¨æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ä¸­æ‰¾åˆ°æ›´å¤šä¿¡æ¯ã€‚\n\nIstio ä¸æä¾› DNSã€‚**åº”ç”¨ç¨‹åºå¯ä»¥å°è¯•ä½¿ç”¨åº•å±‚å¹³å°ï¼ˆkube-dnsã€mesos-dns ç­‰ï¼‰ä¸­å­˜åœ¨çš„DNSæœåŠ¡æ¥è§£æ FQDNã€‚**\n\n## Ingress å’Œ Egress\n\n**lIstio å‡å®šè¿›å…¥å’Œç¦»å¼€æœåŠ¡ç½‘ç»œçš„æ‰€æœ‰æµé‡éƒ½ä¼šé€šè¿‡ Envoy ä»£ç†è¿›è¡Œä¼ è¾“ã€‚**\n\né€šè¿‡å°† Envoy ä»£ç†éƒ¨ç½²åœ¨æœåŠ¡ä¹‹å‰ï¼Œè¿ç»´äººå‘˜å¯ä»¥é’ˆå¯¹é¢å‘ç”¨æˆ·çš„æœåŠ¡è¿›è¡ŒA/B æµ‹è¯•ã€éƒ¨ç½²é‡‘ä¸é›€æœåŠ¡ç­‰ã€‚\n\nç±»ä¼¼åœ°ï¼Œé€šè¿‡ä½¿ç”¨ Envoy å°†æµé‡è·¯ç”±åˆ°å¤–éƒ¨ Web æœåŠ¡ï¼ˆä¾‹å¦‚ï¼Œè®¿é—® Maps APIæˆ–è§†é¢‘æœåŠ¡ APIï¼‰çš„æ–¹å¼ï¼Œè¿ç»´äººå‘˜å¯ä»¥ä¸ºè¿™äº›æœåŠ¡æ·»åŠ è¶…æ—¶æ§åˆ¶ã€é‡è¯•ã€æ–­è·¯å™¨ç­‰åŠŸèƒ½.åŒæ—¶è¿˜èƒ½ä»æœåŠ¡è¿æ¥ä¸­è·å–å„ç§ç»†èŠ‚æŒ‡æ ‡ã€‚\n\n![image.png](Extras/Images/image_1667296805340_0.png)\n\n## æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡\n\n**Istio è´Ÿè½½å‡è¡¡æœåŠ¡ç½‘æ ¼ä¸­å®ä¾‹ä¹‹é—´çš„é€šä¿¡ã€‚**\n\nIstio å‡å®šå­˜åœ¨æœåŠ¡æ³¨å†Œè¡¨ï¼Œä»¥è·Ÿè¸ªåº”ç”¨ç¨‹åºä¸­æœåŠ¡çš„ **pod/VM**ã€‚å®ƒè¿˜å‡è®¾æœåŠ¡çš„æ–°å®ä¾‹è‡ªåŠ¨æ³¨å†Œåˆ°æœåŠ¡æ³¨å†Œè¡¨ï¼Œå¹¶ä¸”ä¸å¥åº·çš„å®ä¾‹å°†è¢«è‡ªåŠ¨åˆ é™¤ã€‚è¯¸å¦‚Kubernetesã€Mesos ç­‰å¹³å°å·²ç»ä¸ºåŸºäºå®¹å™¨çš„åº”ç”¨ç¨‹åºæä¾›äº†è¿™æ ·çš„åŠŸèƒ½ã€‚ä¸ºåŸºäºè™šæ‹Ÿæœºçš„åº”ç”¨ç¨‹åºæä¾›çš„è§£å†³æ–¹æ¡ˆå°±æ›´å¤šäº†ã€‚\n\nPilot ä½¿ç”¨æ¥è‡ªæœåŠ¡æ³¨å†Œçš„ä¿¡æ¯ï¼Œå¹¶æä¾›ä¸å¹³å°æ— å…³çš„æœåŠ¡å‘ç°æ¥å£ã€‚ç½‘æ ¼ä¸­çš„Envoy å®ä¾‹æ‰§è¡ŒæœåŠ¡å‘ç°ï¼Œå¹¶ç›¸åº”åœ°åŠ¨æ€æ›´æ–°å…¶è´Ÿè½½å‡è¡¡æ± ã€‚\n\nç½‘æ ¼ä¸­çš„æœåŠ¡ä½¿ç”¨å…¶ DNSåç§°è®¿é—®å½¼æ­¤ã€‚æœåŠ¡çš„æ‰€æœ‰ HTTPæµé‡éƒ½ä¼šé€šè¿‡Envoy è‡ªåŠ¨é‡æ–°è·¯ç”±ã€‚Envoyåœ¨è´Ÿè½½å‡è¡¡æ± ä¸­çš„å®ä¾‹ä¹‹é—´åˆ†å‘æµé‡ã€‚**è™½ç„¶Envoyæ”¯æŒå¤šç§å¤æ‚çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œä½†Istio ç›®å‰ä»…å…è®¸ä¸‰ç§è´Ÿè½½å‡è¡¡æ¨¡å¼âˆ¶è½®å¾ªã€éšæœºå’Œå¸¦æƒé‡çš„æœ€å°‘è¯·æ±‚ã€‚**\n\n---\n\n**é™¤äº†è´Ÿè½½å‡è¡¡å¤–ï¼ŒEnvoy è¿˜ä¼šå®šæœŸæ£€æŸ¥æ± ä¸­æ¯ä¸ªå®ä¾‹çš„è¿è¡ŒçŠ¶å†µã€‚** Envoyéµå¾ªç†”æ–­å™¨é£æ ¼æ¨¡å¼.æ ¹æ®å¥åº·æ£€æŸ¥ API è°ƒç”¨çš„å¤±è´¥ç‡å°†å®ä¾‹åˆ†ç±»ä¸ºä¸å¥åº·å’Œå¥åº·ä¸¤ç§ã€‚å½“ç»™å®šå®ä¾‹çš„å¥åº·æ£€é¦™å¤±è´¥æ¬¡æ•°è¶…è¿‡é¢„å®šé˜ˆå€¼æ—¶ï¼Œå°†ä¼šè¢«ä»è´Ÿè½½å‡è¡¡æ± ä¸­å¼¹å‡ºã€‚ç±»ä¼¼åœ°ï¼Œå½“é€šè¿‡çš„å¥åº·æ£€æŸ¥æ•°è¶…è¿‡é¢„å®šé˜ˆå€¼æ—¶ï¼Œè¯¥å®ä¾‹å°†è¢«æ·»åŠ å›è´Ÿè½½å‡è¡¡æ± ã€‚æ‚¨å¯ä»¥åœ¨å¤„ç†æ•…éšœä¸­äº†è§£æ›´å¤šæœ‰å…³Envoy çš„æ•…éšœå¤„ç†åŠŸèƒ½ã€‚\n\n**æœåŠ¡å¯ä»¥é€šè¿‡ä½¿ç”¨ HTTP 503å“åº”å¥åº·æ£€æŸ¥æ¥ä¸»åŠ¨å‡è½»è´Ÿæ‹…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å®ä¾‹å°†ç«‹å³ä»è°ƒç”¨è€…çš„è´Ÿè½½å‡è¡¡æ± ä¸­åˆ é™¤ã€‚**\n\n## æ•…éšœå¤„ç†\n\n![image.png](Extras/Images/image_1667297029724_0.png)\n\n## å¾®è°ƒ\n\n**Istio çš„æµé‡ç®¡ç†è§„åˆ™å…è®¸è¿ç»´äººå‘˜ä¸ºæ¯ä¸ªæœåŠ¡/ç‰ˆæœ¬è®¾ç½®æ•…éšœæ¢å¤çš„å…¨å±€é»˜è®¤å€¼ã€‚** ç„¶è€Œï¼ŒæœåŠ¡çš„æ¶ˆè´¹è€…ä¹Ÿå¯ä»¥é€šè¿‡ç‰¹æ®Šçš„HTTPå¤´æä¾›çš„è¯·æ±‚çº§åˆ«å€¼è¦†ç›–è¶…æ—¶å’Œé‡è¯•çš„é»˜è®¤å€¼ã€‚åœ¨ Envoyä»£ç†çš„å®ç°ä¸­ï¼Œå¯¹åº”çš„Header åˆ†åˆ«æ˜¯Ã—-envoy-upstream-rq-timeout-ms å’Œx-envoy-max-retriesã€‚\n\n## æ•…éšœæ³¨å…¥\n\n- **ä¸ºä»€ä¹ˆéœ€è¦é”™è¯¯æ³¨å…¥ï¼š**\n\t- å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œéœ€è¦æµ‹è¯•ç«¯åˆ°ç«¯çš„æ•…éšœæ¢å¤èƒ½åŠ›ã€‚\n- Istio å…è®¸åœ¨ç½‘ç»œå±‚é¢æŒ‰åè®®æ³¨å…¥é”™è¯¯æ¥æ¨¡æ‹Ÿé”™è¯¯ï¼Œæ— éœ€é€šè¿‡åº”ç”¨å±‚é¢åˆ é™¤Podï¼Œæˆ–è€…äººä¸ºåœ¨ TCPå±‚é€ æˆç½‘ç»œæ•…éšœæ¥æ¨¡æ‹Ÿã€‚\n- **æ³¨å…¥çš„é”™è¯¯å¯ä»¥åŸºäºç‰¹å®šçš„æ¡ä»¶ï¼Œå¯ä»¥è®¾ç½®å‡ºç°é”™è¯¯çš„æ¯”ä¾‹âˆ¶**\n\t- Delay-æé«˜ç½‘ç»œå»¶æ—¶ï¼›\n\t- Aborts-ç›´æ¥è¿”å›ç‰¹å®šçš„é”™è¯¯ç ã€‚\n\n## è§„åˆ™é…ç½®\n\n- **VirtualService** åœ¨ Istio æœåŠ¡ç½‘æ ¼ä¸­å®šä¹‰è·¯ç”±è§„åˆ™ï¼Œæ§åˆ¶è·¯ç”±å¦‚ä½•è·¯ç”±åˆ°æœåŠ¡ä¸Šã€‚\n- **DestinationRule** æ˜¯VirtualService è·¯ç”±ç”Ÿæ•ˆåï¼Œé…ç½®åº”ç”¨ä¸è¯·æ±‚çš„ç­–ç•¥é›†ã€‚\n- **ServiceEntry** æ˜¯é€šå¸¸ç”¨äºåœ¨ Istio æœåŠ¡ç½‘æ ¼ä¹‹å¤–å¯ç”¨å¯¹æœåŠ¡çš„è¯·æ±‚ã€‚\n- **Gateway**ä¸ºHTTP/TCPæµé‡é…ç½®è´Ÿè½½å‡è¡¡å™¨ï¼Œæœ€å¸¸è§çš„æ˜¯åœ¨ç½‘æ ¼çš„è¾¹ç¼˜çš„æ“ä½œï¼Œä»¥å¯ç”¨åº”ç”¨ç¨‹åºçš„å…¥å£æµé‡ã€‚\n\n## VirtualService\n\n**æ˜¯åœ¨ Istio æœåŠ¡ç½‘æ ¼å†…å¯¹æœåŠ¡çš„è¯·æ±‚å¦‚ä½•è¿›è¡Œè·¯ç”±æ§åˆ¶ã€‚**\n\n## è§„åˆ™çš„ç›®æ ‡æè¿°\n\n**è·¯ç”±è§„åˆ™å¯¹åº”ç€ä¸€æˆ–å¤šä¸ªç”¨ VirtualService é…ç½®æŒ‡å®šçš„è¯·æ±‚ç›®çš„ä¸»æœºã€‚** è¿™äº›ä¸»æœºå¯ä»¥æ˜¯ä¹Ÿå¯ä»¥ä¸æ˜¯å®é™…çš„ç›®æ ‡è´Ÿè½½ï¼Œç”šè‡³å¯ä»¥ä¸æ˜¯åŒä¸€ç½‘æ ¼å†…å¯è·¯ç”±çš„æœåŠ¡ã€‚ä¾‹å¦‚è¦ç»™åˆ°reviews æœåŠ¡çš„è¯·æ±‚å®šä¹‰è·¯ç”±è§„åˆ™ï¼Œå¯ä»¥ä½¿ç”¨å†…éƒ¨çš„åç§° reviewsï¼Œä¹Ÿå¯ä»¥ç”¨åŸŸå bookinfo.comï¼ŒVirtualService å¯ä»¥å®šä¹‰è¿™æ ·çš„hostå­—æ®µï¼š\n\nhost å­—æ®µç”¨æ˜¾ç¤ºæˆ–è€…éšå¼çš„æ–¹å¼å®šä¹‰äº†ä¸€æˆ–å¤šä¸ªå®Œå…¨é™å®šåï¼ˆFQDNï¼‰ã€‚ä¸Šé¢çš„ reviewsï¼Œä¼šéšå¼çš„æ‰©å±•æˆä¸ºç‰¹å®šçš„ FQDNï¼Œä¾‹å¦‚åœ¨ Kubernetes ç¯å¢ƒä¸­ï¼Œå…¨åä¼šä» VirtualService æ‰€åœ¨çš„é›†ç¾¤å’Œå‘½åç©ºé—´ä¸­ç»§æ‰¿è€Œæ¥ï¼ˆæ¯”å¦‚è¯´ reviews.default.svc.cluster.localï¼‰ã€‚\n\n```yaml\nhosts:\n- reviews\n- bookinfo.com\n```\n\n## åœ¨æœåŠ¡ä¹‹é—´åˆ†æ‹†æµé‡\n\nä¾‹å¦‚ä¸‹é¢çš„è§„åˆ™ä¼šæŠŠ25%çš„reviews æœåŠ¡æµé‡åˆ†é…ç»™v2æ ‡ç­¾ï¼›å…¶ä½™çš„75%æµ\u0000\u0000é‡åˆ†é…ç»™v1ã€‚\n\n```yaml\napiVersion: networking.istio.io/vlalpha3\nkind: VirtualService\nmetadata:\n  name: reviews\nspec:\n  hosts:\n  - reviews\n  http:\n  - route:\n    - destination:\n      host: reviews\n      subset: v1\n      weight: 75\n    - destination:\n      host: reviews\n      subset: v2\n      weight: 25\n```\n\n## è¶…æ—¶å’Œé‡è¯•\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: ratings\nspec:\n  hosts:\n  - ratings\n  http:\n  - route:\n    - destination:\n      host: ratings\n      subset: v1\n    timeout: 10s\n```\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: ratings\nspec:\n  hosts:\n  - ratings\n  http:\n  - route:\n    - destination:\n      host: ratings\n      subset: v1\n    retries:\n      attempts: 3\n      perTryTimeout: 2s\n```\n\n## é”™è¯¯æ³¨å…¥\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: ratings\nspec:\n  hosts:\n  - ratings\n  http:\n  - fault:\n      delay:\n        percent: 10\n        fixedDelay: 5s\n  route:\n    - destination:\n      host: ratings\n      subset: v1\n```\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: ratings\nspec:\n  hosts:\n  - ratings\n  http:\n  - fault:\n      abort:\n        percent: 10\n        httpStatus: 400\n  route:\n  - destination:\n    host: ratings\n    subset: v1\n```\n\n## æ¡ä»¶è§„åˆ™\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: productpage\nspec:\n  hosts:\n  - productpage\n  http:\n  - match:\n    - uri:\n      prefix: /api/v1\n  ...\n```\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name:reviews\nspec:\n  hosts:\n  - reviews\n  http:\n  - match:\n    - headers:\n      end-user:\n        exact: jason\n  ...\n```\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: ratings\nspec:\n  hosts:\n  - ratings\n  http:\n  - match:\n    sourceLabels:\n      app: reviews\n...\n```\n\n## æµé‡é•œåƒ\n\nmirror è§„åˆ™å¯ä»¥ä½¿ Envoy æˆªå–æ‰€æœ‰ requestï¼Œå¹¶åœ¨è½¬å‘è¯·æ±‚çš„åŒæ—¶ï¼Œå°† request è½¬å‘è‡³\nç‰ˆæœ¬ ï¼Œ åŒæ—¶åœ¨Mirror Headerçš„Host/AuthorityåŠ ä¸Š-shadowã€‚\n\n**è¿™äº›mirrorè¯·æ±‚ä¼šå·¥ä½œåœ¨fire and forgetæ¨¡å¼ï¼Œæ‰€æœ‰çš„responseéƒ½ä¼šè¢«åºŸå¼ƒã€‚**\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: httpbin\nspec:\n  hosts:\n  - httpbin\n  http:\n  - route:\n    - destination:\n      host: httpbin\n      subset: v1\n    weight: 100\n  mirror:\n    host: httpbin\n    subset: v2\n```\n\n## è§„åˆ™å§”æ‰˜\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: bookinfo\nspec:\n  hosts:\n  - \"bookinfo.com\"\n  gateways:\n  - mygateway\n  http:\n    - match:\n      - uri:\n        prefix: \"/productpage\"\n      delegate:\n        name: productpage\n        namespace: nsA\n    - match:\n      - uri:\n        prefix: \"/reviews\"\n      delegate:\n        name: reviews\n        namespace: nsB\n```\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: productpage\n  namespace: nsA\nspec:\n  http:\n  - match:\n    - uri:\n      prefix: \"/productpage/v1/\"\n    route:\n    - destination:\n      host: productpage-v1.nsA.svc.cluster.local\n  - route:\n    - destination:\n      host: productpage.nsA.svc.cluster.local\n```\n\n## ä¼˜å…ˆçº§\n\n**å½“å¯¹åŒä¸€ç›®æ ‡æœ‰å¤šä¸ªè§„åˆ™æ—¶ï¼Œä¼šæŒ‰ç…§åœ¨ VirtualService ä¸­çš„é¡ºåºè¿›è¡Œåº”ç”¨ï¼Œæ¢å¥è¯è¯´ï¼Œåˆ—è¡¨ä¸­çš„ç¬¬ä¸€æ¡è§„åˆ™å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§ã€‚**\n\nå½“å¯¹æŸä¸ªæœåŠ¡çš„è·¯ç”±æ˜¯å®Œå…¨åŸºäºæƒé‡çš„æ—¶å€™ï¼Œå°±å¯ä»¥åœ¨å•ä¸€è§„åˆ™ä¸­å®Œæˆã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæœ‰å¤šé‡æ¡ä»¶ï¼ˆä¾‹å¦‚æ¥è‡ªç‰¹å®šç”¨æˆ·çš„è¯·æ±‚ï¼‰ç”¨æ¥è¿›è¡Œè·¯ç”±ï¼Œå°±ä¼šéœ€è¦ä¸æ­¢ä¸€æ¡è§„åˆ™ã€‚è¿™æ ·å°±å‡ºç°äº†ä¼˜å…ˆçº§é—®é¢˜ï¼Œéœ€è¦é€šè¿‡ä¼˜å…ˆçº§æ¥ä¿è¯æ ¹æ®æ­£ç¡®çš„é¡ºåºæ¥æ‰§è¡Œè§„åˆ™ã€‚\n\nå¸¸è§çš„è·¯ç”±æ¨¡å¼æ˜¯æä¾›ä¸€æˆ–å¤šä¸ªé«˜ä¼˜å…ˆçº§è§„åˆ™ï¼Œè¿™äº›ä¼˜å…ˆè§„åˆ™ä½¿ç”¨æºæœåŠ¡ä»¥åŠ Header æ¥è¿›è¡Œè·¯ç”±åˆ¤æ–­ï¼Œç„¶åæ‰æä¾›ä¸€æ¡å•ç‹¬çš„åŸºäºæƒé‡çš„è§„åˆ™ï¼Œè¿™äº›ä½ä¼˜å…ˆçº§è§„åˆ™ä¸è®¾ç½®åŒ¹é…è§„åˆ™ï¼Œä»…æ ¹æ®æƒé‡å¯¹æ‰€æœ‰å‰©ä½™æµé‡è¿›è¡Œåˆ†æµã€‚\n\n## ç›®æ ‡è§„åˆ™\n\n**åœ¨è¯·æ±‚è¢«VirtualServiceè·¯ç”±ä¹‹åï¼ŒDestinationRuleé…ç½®çš„ä¸€ç³»åˆ—ç­–ç•¥å°±ç”Ÿæ•ˆäº†ã€‚**\n\nè¿™äº›ç­–ç•¥ç”±æœåŠ¡å±ä¸»ç¼–å†™ï¼ŒåŒ…å«æ–­è·¯å™¨ã€è´Ÿè½½å‡è¡¡ä»¥åŠTLSç­‰çš„é…ç½®å†…å®¹ã€‚\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: reviews\nspec:\n  host: reviews\n  trafficPolicy:\n    loadBalancer:\n      simple: RANDOM\n  subsets:\n  - name: v1\n    labels:\n      version: v1\n  - name: v2\n    labels:\n      version: v2\n    trafficPolicy:\n      loadBalancer:\n        simple: ROUND_ROBIN\n  - name: v3\n    labels:\n      version: v3\n```\n\n## æ–­è·¯å™¨\n\n**å¯ä»¥ç”¨ä¸€ç³»åˆ—çš„æ ‡å‡†ï¼Œä¾‹å¦‚è¿æ¥æ•°å’Œè¯·æ±‚æ•°é™åˆ¶æ¥å®šä¹‰ç®€å•çš„æ–­è·¯å™¨ã€‚**\n\nå¯ä»¥é€šè¿‡å®šä¹‰outlierDetectionè‡ªå®šä¹‰å¥åº·æ£€æŸ¥æ¨¡å¼ã€‚\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: httpbin\nspec:\n  host: httpbin\n  trafficPolicy:\n    connectionPool:\n      tcp:\n        maxConnections: 1\n      http:\n        http1MaxPendingRequests: 1\n        maxRequestsPerConnection: 1\n    outlierDetection:\n      consecutiveErrors: 1\n      interval: 1s\n      baseEjectionTime: 3m\n      maxEjectionPercent: 100\n```\n\n## ServiceEntry\n\n**Istio å†…éƒ¨ä¼šç»´æŠ¤ä¸€ä¸ªæœåŠ¡æ³¨å†Œè¡¨ï¼Œå¯ä»¥ç”¨ServiceEntryå‘å…¶ä¸­åŠ å…¥é¢å¤–çš„æ¡ç›®ã€‚** é€šå¸¸è¿™ä¸ªå¯¹è±¡ç”¨æ¥å¯ç”¨å¯¹IstioæœåŠ¡ç½‘æ ¼ä¹‹å¤–çš„æœåŠ¡å‘å‡ºè¯·æ±‚ã€‚\n\nServiceEntryä¸­ä½¿ç”¨hostså­—æ®µæ¥æŒ‡å®šç›®æ ‡ï¼Œå­—æ®µå€¼å¯ä»¥æ˜¯ä¸€ä¸ªå®Œå…¨é™å®šåï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸ªé€šé…ç¬¦åŸŸåã€‚å…¶ä¸­åŒ…å«çš„ç™½åå•ï¼ŒåŒ…å«ä¸€æˆ–å¤šä¸ªå…è®¸ç½‘æ ¼ä¸­æœåŠ¡è®¿é—®çš„æœåŠ¡ã€‚\n\n**åªè¦ServiceEntryæ¶‰åŠåˆ°äº†åŒ¹é…hostçš„æœåŠ¡ï¼Œå°±å¯ä»¥å’ŒVirtualServiceä»¥åŠDestinationRuleé…åˆå·¥ä½œã€‚**\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: ServiceEntry\nmetadata:\n  name: foo-ext-svc\nspec:\n  hosts:\n  - *.foo.com\n  ports:\n  - number: 80\n    name: http\n    protocol: HTTP\n  - number: 443\n    name: https\n    protocol: HTTPS\n```\n\n## WorkloadEntry\n\n```yaml\napiVersion: networking.istio.io/v1 beta1\nkind: ServiceEntry\nmetadata:\n  name: details-svc\nspec:\n  hosts:\n  - details.bookinfo.com\n  location: MESH_INTERNAL\n  ports:\n  - number: 80\n    name: http\n    protocol: HTTP\n  resolution: STATIC\n  workloadSelector:\n    labels:\n     app: details-legacy\n```\n\n```yaml\napiVersion: networking.istio.io/v1beta1\nkind: WorkloadEntry\nmetadata:\n  name: details-svc\nspec:\n  serviceAccount: details-legacy\n  address: 2.2.2.2\n  labels:\n    app: details-legacy\n    instance-id: vm1\n```\n\n## Gateway\n\n**Gateway ä¸º HTTP/TCPæµé‡é…ç½®äº†ä¸€ä¸ªè´Ÿè½½å‡è¡¡ï¼Œå¤šæ•°æƒ…å†µä¸‹åœ¨ç½‘æ ¼è¾¹ç¼˜è¿›è¡Œæ“ä½œï¼Œç”¨äºå¯ç”¨ä¸€ä¸ªæœåŠ¡çš„å…¥å£ï¼ˆingressï¼‰æµé‡ã€‚**\n\nå’ŒKubernetes Ingressä¸åŒï¼ŒIstio Gatewayåªé…ç½®å››å±‚åˆ°å…­å±‚çš„åŠŸèƒ½ï¼ˆä¾‹å¦‚å¼€æ”¾ç«¯å£æˆ–è€…TLSé…ç½®ï¼‰ã€‚ç»‘å®šä¸€ä¸ªVirtualService åˆ° Gatewayä¸Šï¼Œç”¨æˆ·å°±å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ Istio è§„åˆ™æ¥æ§åˆ¶è¿›å…¥çš„ HTTPå’Œ TCPæµé‡ã€‚\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  name: bookinfo-gateway\nspec:\n  servers:\n  - port:\n    number: 443\n    name: https\n    protocol: HTTPS\n  hosts:\n  - bookinfo.com\n  tls:\n    mode: SIMPLE\n    serverCertificate: /tmp/tls.crt\n    privateKey: /tmp/tls.key\n```\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: bookinfo\nspec:\n  hosts:\n  - bookinfo.com\n  gateways:\n  - bookinfo-gateway\n  http:\n  - match:\n    - uri:\n      prefix: /reviews\n    route:\n    Â·Â·Â·\n```\n\n## å¼€å¯ç½‘å…³å®‰å…¨åŠ å›º\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  name: bookinfo-gateway\nspec:\n  servers:\n  - port:\n      number: 443\n      name: https\n      protocol: HTTPS\n    hosts:\n    - bookinfo.com\n    tls:\n      mode: SIMPLE\n      serverCertificate: /tmp/tls.crt\n      privateKey: /tmp/tls.key\n```\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  name: bookinfo-gateway\nspec:\n  servers:\n  - port:\n    number: 443\n    name: https\n    protocol: HTTPS\n  hosts:\n  - bookinfo.com\n  tls:\n    mode: SIMPLE\n    credentialName: foo\n```\n\n## é¥æµ‹ï¼ˆ Telemetry V2ï¼‰\n\n- åŸºæœ¬Metrics\n- é’ˆå¯¹HTTPï¼ŒHTTP/2å’ŒGRPCåè®®ï¼ŒIstioæ”¶é›†ä»¥ä¸‹æŒ‡æ ‡ï¼š\n\t- Request Count(istio_requests_total)\n\t\t- è¯·æ€»æ•°\n\t- Request Duration (istio_request_duration_milliseconds)\n\t\t- è¯·æ±‚å¤„ç†æ—¶é•¿\n\t- Request Size (istio_request_bytes)\n\t\t- è¯·æ±‚åŒ…å¤§å°\n\t- Response Size(istio_response_bytes)\n\t\t- å“åº”åŒ…å¤§å°\n- é’ˆå¯¹TCPåè®®ï¼ŒIstioæ”¶é›†ä»¥ä¸‹æŒ‡æ ‡ï¼š\n\t- Tcp Byte Sent(istio_tcp_sent_bytes_total)\n\t\t- å‘é€çš„æ•°æ®å“åº”åŒ…çš„æ€»å¤§å°\n\t- Tcp Byte Received (istio_tcp_received_bytes_total)\n\t\t- æ¥æ”¶åˆ°çš„æ•°æ®åŒ…å¤§å°\n\t- Tcp Connections Opened(istio_tcp_connections_opened_total)\n\t\t- TCPè¿æ¥æ•°\n\t- Tcp Connections Closed(istio_tcp_connections_closed_total)\n\t\t- å…³é—­çš„TCPè¿æ¥æ•°\n\t- åŒæ—¶æ”¯æŒWASMï¼ˆWeb Assemblyï¼‰pluginæ”¶é›†æ•°æ®\n\t\t- ä½†å¯ç”¨WASMåèµ„æºå¼€é”€æ˜¾è‘—ä¸Šå‡\n\n## å¤šé›†ç¾¤ç½‘æ ¼æ‰©å±•\n\nåŸºäº Gateway\n\n![image.png](Extras/Images/image_1667311524904_0.png)\n\nåŸºäºVPN æˆ–å¯äº’é€šçš„é›†ç¾¤\n\n![image.png](Extras/Images/image_1667311572370_0.png)\n\n# è·Ÿè¸ªé‡‡æ ·\n\n## è·Ÿè¸ªé‡‡æ ·é…ç½®\n\n**lstio é»˜è®¤æ•è·æ‰€æœ‰è¯·æ±‚çš„è·Ÿè¸ªã€‚**ä¾‹å¦‚ï¼Œä½•æ—¶æ¯æ¬¡è®¿é—®æ—¶éƒ½ä½¿ç”¨ä¸Šé¢çš„ Bookinfo ç¤ºä¾‹åº”ç”¨ç¨‹åº/productpage ä½ åœ¨Jaeger çœ‹åˆ°äº†ç›¸åº”çš„ç—•è¿¹ä»ªè¡¨æ¿ã€‚æ­¤é‡‡æ ·ç‡é€‚ç”¨äºæµ‹è¯•æˆ–ä½æµé‡ç›®ã€‚\n\nåœ¨è¿è¡Œçš„ç½‘æ ¼ä¸­ï¼Œç¼–è¾‘ istio-pilot éƒ¨ç½²å¹¶ä½¿ç”¨ä»¥ä¸‹æ­¥éª¤æ›´æ”¹ç¯å¢ƒå˜é‡âˆ¶\n\n`istioctl upgrade --set values.global.tracer.zipkin.address=jaeger-collector:9417`\n\n## åº”ç”¨ç¨‹åºåŸ‹ç‚¹\n\n**è™½ç„¶Istioä»£ç†èƒ½å¤Ÿè‡ªåŠ¨å‘é€ Spanä¿¡æ¯ï¼Œä½†è¿˜æ˜¯éœ€è¦ä¸€äº›è¾…åŠ©æ‰‹æ®µæ¥æŠŠæ•´ä¸ªè·Ÿè¸ªè¿‡ç¨‹ç»Ÿä¸€èµ·æ¥ã€‚**åº”ç”¨ç¨‹åºåº”è¯¥è‡ªè¡Œä¼ æ’­è·Ÿè¸ªç›¸å…³çš„HTTP Headerï¼Œè¿™æ ·åœ¨ä»£ç†å‘é€Span ä¿¡æ¯çš„æ—¶å€™ï¼Œæ‰èƒ½æ­£ç¡®çš„æŠŠåŒä¸€ä¸ªè·Ÿè¸ªè¿‡ç¨‹ç»Ÿä¸€èµ·æ¥ã€‚\n\nä¸ºäº†å®Œæˆè·Ÿè¸ªçš„ä¼ æ’­è¿‡ç¨‹ï¼Œåº”ç”¨åº”è¯¥ä»è¯·æ±‚æºå¤´ä¸­æ”¶é›†ä¸‹åˆ—çš„HTTP Headerï¼Œå¹¶ä¼ æ’­ç»™å¤–å‘è¯·æ±‚âˆ¶\n- x-request-id\n- x-b3-traceid\n- x-b3-spanid\n- x-b3-parentspanid\n- x-b3-sampled\n- x-b3-flag5\n- x-ot-span-Context\n\n## Service Mesh æ¶‰åŠçš„ç½‘ç»œæ ˆ\n\n![image.png](Extras/Images/image_1667312881173_0.png)\n\n## Cilium æ•°æ®å¹³é¢åŠ é€Ÿ\n\n![image.png](Extras/Images/image_1667312900212_0.png)\n\n## å°ç»“\n\nå¾®æœåŠ¡æ¶æ„æ˜¯å½“å‰ä¸šç•Œæ™®éè®¤å¯çš„æ¶æ„æ¨¡å¼ï¼Œå®¹å™¨çš„å°è£…æ€§ï¼Œéš”ç¦»æ€§ä¸ºå¾®æœåŠ¡æ¶æ„çš„å…´ç››æä¾›äº†æœ‰åŠ›çš„ä¿éšœã€‚\n\nKubernetesä½œä¸ºå£°æ˜å¼é›†ç¾¤ç®¡ç†ç³»ç»Ÿï¼Œä»£è¡¨äº†åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„çš„å¤§æ–¹å‘âˆ¶\n- kube-proxy æœ¬èº«æä¾›äº†åŸºäºiptables/ipvsçš„å››å±‚ Service Meshæ–¹æ¡ˆ;\n- Istio/linkerdä½œä¸ºåŸºäºKubernetes çš„ä¸ƒå±‚ Service Meshæ–¹æ¡ˆï¼Œè¿‘æœŸä¼šæœ‰æ¯”è¾ƒå¤šçš„ç”Ÿäº§éƒ¨ç½²æ¡ˆä¾‹ã€‚\n\nç”Ÿäº§ç³»ç»Ÿéœ€è¦è€ƒè™‘çš„ï¼Œé™¤äº† Service Mesh æ¶æ„å¸¦æ¥çš„ä¾¿åˆ©æ€§ï¼Œè¿˜éœ€è¦è€ƒè™‘ï¼š\n- é…ç½®ä¸€è‡´æ€§æ£€æŸ¥ï¼›\n- endpoint å¥åº·æ£€æŸ¥ï¼›\n- æµ·é‡è½¬å‘è§„åˆ™æƒ…å†µä¸‹çš„scalabilityã€‚\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/%E5%9F%BA%E4%BA%8EKubernetes%E5%92%8CIstio%E7%9A%84%E5%AE%89%E5%85%A8%E4%BF%9D%E8%AF%81":{"title":"åŸºäºKuberneteså’ŒIstioçš„å®‰å…¨ä¿è¯","content":"\n# äº‘åŸç”Ÿè¯­å¢ƒä¸‹çš„å®‰å…¨ä¿è¯\n\n## äº‘åŸç”Ÿè¯­å¢ƒä¸‹çš„å®‰å…¨ä¿è¯\n\nå®‰å…¨ä¿è¯æ˜¯è´¯ç©¿è½¯ä»¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„é‡è¦éƒ¨åˆ†ã€‚\n\nå®‰å…¨ä¸æ•ˆç‡æœ‰æ—¶å€™æ˜¯ç›¸è¿èƒŒçš„ã€‚\n\nå¦‚ä½•å°†äºŒè€…ç»Ÿä¸€èµ·æ¥ï¼Œæå‡æ•´ä½“æ•ˆç‡æ˜¯å…³é”®ã€‚\n\nè¿™éœ€è¦æˆ‘ä»¬å°†å®‰å…¨æ€æƒ³è´¯ç©¿åˆ°è½¯ä»¶å¼€å‘è¿ç»´çš„æ‰€æœ‰ç¯èŠ‚ã€‚\n\n## äº‘åŸç”Ÿå±‚æ¬¡æ¨¡å‹\n\nè½¯ä»¶çš„ç”Ÿå‘½å‘¨æœŸâˆ¶å¼€å‘-\u003eåˆ†å‘â†’éƒ¨ç½²-\u003eè¿è¡Œ\n\n![image.png](Extras/Images/image_1667396770608_0.png)\n\n## å¼€å‘ç¯èŠ‚çš„å®‰å…¨ä¿è¯\n\nSaaS åº”ç”¨çš„ [[Cards/CS/ç³»ç»Ÿæ¶æ„#12 factors|12-factor]] è®¾è®¡åŸåˆ™çš„ä¸€äº›ç†å¿µä¸äº‘åŸç”Ÿå®‰å…¨ä¸è°‹è€Œåˆã€‚\n\nä¼ ç»Ÿçš„**å®‰å…¨ä¸‰å…ƒç´  CIAï¼ˆConfidentialitVIntegrityå’Œ AVailabilityï¼‰**ï¼Œåœ¨äº‘åŸç”Ÿå®‰å…¨ä¸­è¢«å……åˆ†åº”ç”¨ï¼Œå¦‚å¯¹å·¥ä½œè´Ÿè½½çš„å®Œæ•´æ€§ä¿æŠ¤ï¼Œä¸Iï¼ˆIntegrityï¼‰å®Œæ•´æ€§ä¿æŠ¤ç›¸å¯¹åº”ã€‚\n\n- æœºå¯†æ€§ï¼ˆConfidentialityï¼‰æŒ‡åªæœ‰æˆæƒç”¨æˆ·å¯ä»¥è·å–ä¿¡æ¯ã€‚\n- å®Œæ•´æ€§ï¼ˆIntegrityï¼‰æŒ‡ä¿¡æ¯åœ¨è¾“å…¥å’Œä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œä¸è¢«éæ³•æˆæƒä¿®æ”¹å’Œç ´åï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚\n- å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰æŒ‡ä¿è¯åˆæ³•ç”¨æˆ·å¯¹ä¿¡æ¯å’Œèµ„æºçš„ä½¿ç”¨ä¸ä¼šè¢«ä¸æ­£å½“åœ°æ‹’ç»ã€‚\n\n**åŸºç¡€è®¾æ–½å³ä»£ç ï¼ˆInfrastructure as Codeï¼Œç®€ç§° laCï¼‰**ä¹Ÿä¸äº‘åŸç”Ÿçš„å®è·µç´§å¯†ç›¸å…³ã€‚\n\nè¿™äº›æ–¹æ³•å’ŒåŸåˆ™ï¼Œéƒ½å¼ºè°ƒé€šè¿‡æ—©æœŸé›†æˆå®‰å…¨æ£€æµ‹ï¼Œä»¥ç¡®ä¿å¯¹è¿‡ç¨‹çš„æ§åˆ¶ï¼Œä½¿å…¶æŒ‰é¢„æœŸè¿è¡Œã€‚\n\né€šè¿‡æ—©æœŸæ£€æµ‹çš„é¢„é˜²æ€§æˆæœ¬ï¼Œé™ä½åç»­çš„ä¿®å¤æˆæœ¬ï¼Œæå‡äº†å®‰å…¨çš„ä»·å€¼ã€‚\n\n## å¼€å‘\n\n![image.png](Extras/Images/image_1667397465681_0.png)\n\n## åˆ†å‘ç¯èŠ‚çš„å®‰å…¨ä¿è¯\n\näº‘åŸç”Ÿåº”ç”¨ç”Ÿå‘½å‘¨æœŸä¸­çš„åˆ†å‘é˜¶æ®µä¸ä»…éœ€è¦åŒ…æ‹¬éªŒè¯å·¥ä½œè´Ÿè½½æœ¬èº«çš„å®Œæ•´æ€§çš„æ–¹æ³•ï¼Œè¿˜éœ€è¦åŒ…æ‹¬åˆ›å»ºå·¥ä½œè´Ÿè½½çš„è¿‡ç¨‹å’Œæ“ä½œæ‰‹æ®µã€‚\n\nå¯¹äºè½¯ä»¶ç”Ÿäº§å‘¨æœŸæµæ°´çº¿ä¸­äº§ç”Ÿçš„å·¥ä»¶ï¼ˆå¦‚å®¹å™¨é•œåƒï¼‰ï¼Œï¼Œéœ€è¦è¿›è¡ŒæŒç»­çš„è‡ªåŠ¨æ‰«æå’Œæ›´æ–°æ¥ç¡®ä¿å®‰å…¨ï¼Œé˜²æ­¢æ¼æ´ã€æ¶æ„è½¯ä»¶ã€ä¸å®‰å…¨çš„ç¼–ç å’Œå…¶ä»–ä¸å®‰å…¨çš„è¡Œä¸ºã€‚\n\nåœ¨å®Œæˆè¿™äº›æ£€æŸ¥åï¼Œæ›´é‡è¦çš„æ˜¯å¯¹äº§å“è¿›è¡ŒåŠ å¯†ç­¾åï¼Œä»¥ç¡®ä¿äº§å“çš„å®Œæ•´æ€§åŠä¸å¯æŠµèµ–æ€§ã€‚\n\n## åˆ†å‘\n\n![image.png](Extras/Images/image_1667397782368_0.png)\n\n## éƒ¨ç½²ç¯èŠ‚çš„å®‰å…¨ä¿è¯\n\nåœ¨æ•´ä¸ªå¼€å‘å’Œé›†æˆå‘å¸ƒé˜¶æ®µï¼Œåº”å¯¹å€™é€‰å·¥ä½œè´Ÿè½½çš„å®‰å…¨æ€§è¿›è¡Œå®æ—¶å’ŒæŒç»­çš„éªŒè¯ï¼Œå¦‚ï¼Œå¯¹ç­¾åçš„å·¥ä»¶è¿›è¡Œæ ¡éªŒï¼Œç¡®ä¿å®¹å™¨é•œåƒå®‰å…¨å’Œè¿è¡Œæ—¶å®‰å…¨ï¼Œå¹¶å¯éªŒè¯ä¸»æœºçš„é€‚ç”¨æ€§ã€‚\n\nå®‰å…¨å·¥ä½œè´Ÿè½½çš„ç›‘æ§èƒ½åŠ›ï¼Œåº”ä»¥å¯ä¿¡çš„æ–¹å¼ç›‘æ§æ—¥å¿—å’Œå¯ç”¨æŒ‡æ ‡ï¼Œä¸å·¥ä½œè´Ÿè½½ä¸€åŒéƒ¨ç½²æ¥å®Œå–„æ•´ä½“çš„å®‰å…¨æ€§ã€‚\n\n# éƒ¨ç½²\n\n![image.png](Extras/Images/image_1667397846895_0.png)\n\n## è¿è¡Œæ—¶ç¯èŠ‚çš„å®‰å…¨ä¿\n\nåº”ç”¨ç¨‹åºé€šå¸¸ç”±å¤šä¸ªç‹¬ç«‹å’Œå•ä¸€èŒè´£çš„å¾®æœåŠ¡ç»„æˆï¼Œå®¹å™¨ç¼–æ’å±‚ä½¿å¾—è¿™äº›å¾®æœåŠ¡é€šè¿‡æœåŠ¡å±‚æŠ½è±¡è¿›è¡Œç›¸äº’é€šä¿¡ã€‚\n\nç¡®ä¿è¿™ç§ç›¸äº’å…³è”çš„ç»„ä»¶æ¶æ„å®‰å…¨çš„æœ€ä½³å®è·µï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹âˆ¶\n\n1. åªæœ‰ç»è¿‡æ‰¹å‡†çš„è¿›ç¨‹èƒ½åœ¨å®¹å™¨å‘½åç©ºé—´å†…è¿è¡Œ;\n\n2. ç¦æ­¢å¹¶æŠ¥å‘Šæœªç»æˆæƒçš„èµ„æºè®¿é—®;\n\n3. ç›‘æ§ç½‘ç»œæµé‡ä»¥æ£€æµ‹æ¶æ„çš„æ´»åŠ¨;\n\n4. æœåŠ¡ç½‘æ ¼æ˜¯å¦ä¸€ç§å¸¸è§çš„æœåŠ¡å±‚æŠ½è±¡ï¼Œå®ƒä¸ºå·²ç»ç¼–æ’çš„æœåŠ¡æä¾›äº†æ•´åˆå’Œè¡¥å……åŠŸèƒ½ï¼Œè€Œä¸ä¼šæ”¹å˜å·¥ä½œè´Ÿè½½è½¯ä»¶æœ¬èº«ï¼ˆä¾‹å¦‚ï¼ŒAPIæµé‡çš„æ—¥å¿—è®°å½•ã€ä¼ è¾“åŠ å¯†ã€å¯è§‚å¯Ÿæ€§æ ‡è®°ã€è®¤è¯å’Œæˆæƒï¼‰ã€‚\n\n## è¿è¡Œç¯å¢ƒ\n\n![image.png](Extras/Images/image_1667397948189_0.png)\n\n# å®¹å™¨è¿è¡Œæ—¶çš„å®‰å…¨ä¿è¯\n\n## ä»¥ Non-root èº«ä»½è¿è¡Œå®¹å™¨\n\n**åœ¨ Dockerfile ä¸­é€šè¿‡ USERå‘½ä»¤åˆ‡æ¢æˆé rootç”¨æˆ·ã€‚**\n\nåŸå› åˆ†æï¼š\n\né˜²æ­¢æŸäº›åçš„é•œåƒçªƒå–ä¸»æœºçš„ root æƒé™å¹¶é€ æˆå±å®³ã€‚\n\næœ‰äº›è¿è¡Œæ—¶å®¹å™¨å†…éƒ¨çš„root ç”¨æˆ·ä¸ä¸»æœºçš„ root ç”¨æˆ·æ˜¯åŒä¸€ä¸ªç”¨æˆ·ï¼Œå¦‚ä¸è¿›è¡Œç”¨æˆ·åˆ‡æ¢å¾ˆå¯èƒ½å› ä¸ºæƒé™è¿‡å¤§å¼•å‘ä¸¥é‡çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¸€ä¸ªæœ€ç®€å•çš„ caseï¼Œä¸»æœºä¸Šçš„é‡è¦æ–‡ä»¶å¤¹è¢«mount åˆ°å®¹å™¨å†…éƒ¨ï¼Œå¹¶è¢«å®¹å™¨ä¿®æ”¹é…ç½®ã€‚\n\nå³ä½¿åœ¨å®¹å™¨å†…éƒ¨ä¹Ÿåº”è¯¥è¿›è¡Œæƒé™éš”ç¦»ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬å¸Œæœ›æ„å»ºä¸å¯å˜é…ç½®çš„å®¹å™¨é•œåƒæ—¶ï¼Œåº”è¯¥å°†è¿è¡Œå®¹å™¨çš„ç”¨æˆ·åˆ‡æ¢ä¸ºé root ç”¨æˆ·ï¼Œå¹¶ä¸”é™åˆ¶å…¶è¯»å†™æƒé™å’Œè¯»å†™ç›®å½•ã€‚\n\n```Dockerfile\nFROM ubuntu\nRUN user add patrick\nUSER patrick\n```\n\n## User Namespace å’Œ rootless container\n\n**User Namespace:**\n- ä¾èµ–äº User namespaceï¼Œä»»ä½•å®¹å™¨å†…éƒ¨çš„ç”¨æˆ·éƒ½ä¼šæ˜ å°„æˆä¸»æœºçš„é root ç”¨æˆ·ã€‚\n- ä½†è¯¥åŠŸèƒ½æœªè¢«é»˜è®¤enableï¼Œå› å…¶å¼•å…¥é…ç½®å¤æ‚æ€§ï¼Œæ¯”å¦‚ç³»ç»Ÿä¸çŸ¥é“ä¸»æœºç”¨æˆ·å’Œå®¹å™¨ç”¨æˆ·çš„æ˜ å°„å…³ç³»ï¼Œ åœ¨ mount æ–‡ä»¶çš„æ—¶å€™æ— æ³•è®¾ç½®é€‚å½“çš„æƒé™ã€‚\n\n**Rootless container:**\n- rootless Container æ˜¯æŒ‡å®¹å™¨è¿è¡Œæ—¶ä»¥é root èº«ä»½å¯åŠ¨ã€‚\n- åœ¨è¯¥é…ç½®ä¸‹ï¼Œå³ä½¿å®¹å™¨è¢«çªç ´ï¼Œåœ¨ä¸»æœºå±‚é¢è·å¾—çš„ç”¨æˆ·æƒé™ä¹Ÿæ˜¯é root èº«ä»½çš„ç”¨æˆ·ï¼Œè¿™ç¡®ä¿äº†å®‰å…¨ã€‚\n- Docker å’Œå…¶ä»–è¿è¡Œæ—¶æœ¬èº«çš„åå° Daemonï¼ˆå¦‚Docker Daemonï¼‰éœ€è¦ root èº«ä»½è¿è¡Œï¼Œç„¶åå…¶ä»–ç”¨æˆ·çš„å®¹å™¨æ‰èƒ½ä»¥rootless èº«ä»½è¿è¡Œã€‚\n- ä¸€äº›è¿è¡Œæ—¶ï¼Œæ¯”å¦‚ Podmanï¼Œæ— éœ€ Daemon è¿›ç¨‹ï¼Œå› ä¸ºå¯ä»¥å®Œå…¨ä¸éœ€è¦ root èº«ä»½ã€‚\n\n## é›†ç¾¤çš„å®‰å…¨æ€§ä¿è¯\n\nä¿è¯å®¹å™¨ä¸å®¹å™¨ä¹‹é—´ã€å®¹å™¨ä¸ä¸»æœºä¹‹é—´éš”ç¦»ï¼Œé™åˆ¶å®¹å™¨å¯¹å…¶ä»–å®¹å™¨å’Œä¸»æœºçš„æ¶ˆæå½±å“ã€‚\n\nä¿è¯ç»„ä»¶ã€ç”¨æˆ·åŠå®¹å™¨åº”ç”¨ç¨‹åºéƒ½æ˜¯æœ€å°æƒé™ï¼Œé™åˆ¶å®ƒä»¬çš„æƒé™èŒƒå›´ã€‚\n\nä¿è¯é›†ç¾¤çš„æ•æ„Ÿæ•°æ®çš„ä¼ è¾“å’Œå­˜å‚¨å®‰å…¨ã€‚\n\nå¸¸ç”¨æ‰‹æ®µ\n- Podå®‰å…¨ä¸Šä¸‹æ–‡ï¼ˆPod Security Contextï¼‰\n- API Serverçš„è®¤è¯ã€æˆæƒã€å®¡è®¡å’Œå‡†å…¥æ§åˆ¶\n- æ•°æ®çš„åŠ å¯†æœºåˆ¶ç­‰\n\n# Kubernetes çš„å®‰å…¨ä¿è¯\n\n## é›†ç¾¤çš„å®‰å…¨é€šä¿¡\n\nKubernetes æœŸæœ›é›†ç¾¤ä¸­æ‰€æœ‰çš„APIé€šä¿¡åœ¨é»˜è®¤æƒ…å†µä¸‹éƒ½ä½¿ç”¨TLSåŠ å¯†ï¼Œå¤§å¤šæ•°å®‰è£…æ–¹æ³•ä¹Ÿå…è®¸åˆ›å»ºæ‰€éœ€çš„è¯ä¹¦å¹¶ä¸”åˆ†å‘åˆ°é›†ç¾¤ç»„ä»¶ä¸­ã€‚\n\n![image.png](Extras/Images/image_1667398917035_0.png)\n\n## æ§åˆ¶é¢å®‰å…¨ä¿è¯\n\n**è®¤è¯**\n\nå°å‹çš„å•ç”¨æˆ·é›†ç¾¤å¯èƒ½å¸Œæœ›ä½¿ç”¨ç®€å•çš„è¯ä¹¦æˆ–é™æ€æ‰¿è½½ä»¤ç‰Œæ–¹æ³•ã€‚\n\næ›´å¤§çš„é›†ç¾¤åˆ™å¯èƒ½å¸Œæœ›æ•´åˆç°æœ‰çš„ã€OIDCã€LDAPç­‰å…è®¸ç”¨æˆ·åˆ†ç»„çš„æœåŠ¡å™¨ã€‚\n\næ‰€æœ‰ APIå®¢æˆ·ç«¯éƒ½å¿…é¡»ç»è¿‡èº«ä»½éªŒè¯ï¼Œå³ä½¿å®ƒæ˜¯åŸºç¡€è®¾æ–½çš„ä¸€éƒ¨åˆ†ï¼Œæ¯”å¦‚èŠ‚ç‚¹ã€ä»£ç†ã€è°ƒåº¦ç¨‹åºå’Œå·æ’ä»¶ã€‚è¿™äº›å®¢æˆ·ç«¯é€šå¸¸ä½¿ç”¨**æœåŠ¡å¸æˆ·æˆ– X509 å®¢æˆ·ç«¯è¯ä¹¦**ï¼Œå¹¶åœ¨é›†ç¾¤å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºæˆ–æ˜¯ä½œä¸ºé›†ç¾¤å®‰è£…çš„ä¸€éƒ¨åˆ†è¿›è¡Œè®¾ç½®ã€‚\n\n**æˆæƒ**\n\nä¸èº«ä»½éªŒè¯ä¸€æ ·ï¼Œç®€å•è€Œå¹¿æ³›çš„è§’è‰²å¯èƒ½é€‚åˆäºè¾ƒå°çš„é›†ç¾¤ï¼Œä½†æ˜¯éšç€æ›´å¤šçš„ç”¨æˆ·ä¸é›†ç¾¤äº¤äº’ï¼Œå¯èƒ½éœ€è¦å°†å›¢é˜Ÿåˆ’åˆ†æˆæœ‰æ›´å¤šè§’è‰²é™åˆ¶çš„å•ç‹¬çš„å‘½åç©ºé—´ã€‚\n\n**é…é¢**\n\nèµ„æºé…é¢é™åˆ¶äº†æˆäºˆå‘½åç©ºé—´çš„èµ„æºçš„æ•°é‡æˆ–å®¹é‡ã€‚è¿™é€šå¸¸ç”¨äºé™åˆ¶å‘½åç©ºé—´å¯ä»¥åˆ†é…çš„CPUã€å†…å­˜æˆ–æŒä¹…ç£ç›˜çš„æ•°é‡ï¼Œä½†ä¹Ÿå¯ä»¥æ§åˆ¶æ¯ä¸ªå‘½åç©ºé—´ä¸­æœ‰å¤šå°‘ä¸ªPodã€æœåŠ¡æˆ–å·çš„å­˜åœ¨ã€‚\n\n## NodeRestriction\n\nå‡†å…¥æ§åˆ¶å™¨é™åˆ¶äº†kubelet å¯ä»¥ä¿®æ”¹çš„ Node å’Œ Pod å¯¹è±¡ï¼Œkubeletåªå¯ä¿®æ”¹è‡ªå·±çš„ Node APIå¯¹è±¡ï¼Œåªèƒ½ä¿®æ”¹ç»‘å®šåˆ°èŠ‚ç‚¹æœ¬èº«çš„ Pod å¯¹è±¡ã€‚\n\nNodeRestrictionå‡†å…¥æ’ä»¶å¯é˜²æ­¢kubelet åˆ é™¤ Node APIå¯¹è±¡ã€‚\n\né˜²æ­¢ kubelet æ·»åŠ /åˆ é™¤/æ›´æ–°å¸¦æœ‰ node-restriction.kubernetes.io/å‰ç¼€çš„æ ‡ç­¾ã€‚\n\nå°†æ¥çš„ç‰ˆæœ¬å¯èƒ½ä¼šå¢åŠ å…¶ä»–é™åˆ¶ï¼Œä»¥ç¡®ä¿ kubelet å…·æœ‰æ­£å¸¸è¿è¡Œæ‰€éœ€çš„æœ€å°æƒé™é›†ã€‚\n\næ€è€ƒä¸ºä»€ä¹ˆ?\n\né™ä½è·å¾—kubelet kubeconfig çš„äººèƒ½åšæˆçš„ç ´åã€‚\n\n## Security Context\n\nPod å®šä¹‰åŒ…å«äº†ä¸€ä¸ªå®‰å…¨ä¸Šä¸‹æ–‡ï¼Œç”¨äºæè¿°å…è®¸å®ƒè¯·æ±‚è®¿é—®æŸä¸ªèŠ‚ç‚¹ä¸Šçš„ç‰¹å®š Linuxç”¨æˆ·ï¼ˆå¦‚rootï¼‰ã€è·å¾—ç‰¹æƒæˆ–è®¿é—®ä¸»æœºç½‘ç»œï¼Œä»¥åŠå…è®¸å®ƒåœ¨ä¸»æœºèŠ‚ç‚¹ä¸Šä¸å—çº¦æŸåœ°è¿è¡Œçš„å…¶å®ƒæ§ä»¶ã€‚\n\n**Pod å®‰å…¨ç­–ç•¥**å¯ä»¥é™åˆ¶å“ªäº›ç”¨æˆ·æˆ–æœåŠ¡å¸æˆ·å¯ä»¥æä¾›å±é™©çš„å®‰å…¨ä¸Šä¸‹æ–‡è®¾ç½®ã€‚ä¾‹å¦‚âˆ¶Pod çš„å®‰å…¨ç­–ç•¥å¯ä»¥é™åˆ¶å·æŒ‚è½½ï¼Œå°¤å…¶æ˜¯ hostpathï¼Œè¿™äº›éƒ½æ˜¯ Pod åº”è¯¥æ§åˆ¶çš„ä¸€äº›æ–¹é¢ã€‚\n\nä¸€èˆ¬æ¥è¯´ï¼Œå¤§å¤šæ•°åº”ç”¨ç¨‹åºéœ€è¦é™åˆ¶å¯¹ä¸»æœºèµ„æºçš„è®¿é—®ï¼Œä»–ä»¬å¯ä»¥åœ¨ä¸èƒ½è®¿é—®ä¸»æœºä¿¡æ¯çš„æƒ…å†µä¸‹æˆåŠŸä»¥æ ¹è¿›ç¨‹ï¼ˆUID 0ï¼‰è¿è¡Œã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°ä¸root ç”¨æˆ·ç›¸å…³çš„ç‰¹æƒï¼Œåœ¨ç¼–å†™åº”ç”¨ç¨‹åºå®¹å™¨æ—¶ï¼Œä½ åº”è¯¥ä½¿ç”¨é root ç”¨æˆ·è¿è¡Œã€‚\n\nç±»ä¼¼åœ°ï¼Œå¸Œæœ›é˜»æ­¢å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºé€ƒé¿å…¶å®¹å™¨çš„ç®¡ç†å‘˜ï¼Œåº”è¯¥ä½¿ç”¨é™åˆ¶æ€§çš„Pod å®‰å…¨ç­–ç•¥ã€‚\n\n**Kubernetesæä¾›äº†ä¸‰ç§é…ç½® Security Context çš„æ–¹æ³•âˆ¶**\n- Container-level Security Contextâˆ¶ä»…åº”ç”¨åˆ°æŒ‡å®šçš„å®¹å™¨ã€‚\n- Pod-level Security Contextâˆ¶åº”ç”¨åˆ° Pod å†…æ‰€æœ‰å®¹å™¨ä»¥åŠVolumeã€‚\n- Pod Security Policiesï¼ˆPSPï¼‰âˆ¶åº”ç”¨åˆ°é›†ç¾¤å†…éƒ¨æ‰€æœ‰ Pod ä»¥åŠVolumeã€‚\n\n## Container-level Security Context\n\n**Container-level Security Context**ä»…åº”ç”¨åˆ°æŒ‡å®šçš„å®¹å™¨ä¸Šï¼Œå¹¶ä¸”ä¸ä¼šå½±å“Volumeã€‚æ¯”å¦‚è®¾ç½®å®¹å™¨è¿è¡Œåœ¨ç‰¹æƒæ¨¡å¼ï¼š\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: hello-world\nspec:\n  containers:\n  - name: hello-world-container # The container definition #â€¦\n    securityContext:\n      privileged: true\n```\n\n## Pod-level Security Context\n\nPod-level Security Context åº”ç”¨åˆ°Pod å†…æ‰€æœ‰å®¹å™¨ï¼Œå¹¶ä¸”è¿˜ä¼šå½±å“Volumeï¼ˆåŒ…æ‹¬fsGroupå’ŒselinuxOptionsï¼‰ã€‚\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: hello-world\nspec:\n  containers:\n  # specification of the pod's containers\n  #â€¦\n  securityContext:\n    fsGroup: 1234\n    supplementalGroups: [5678]\n    seLinuxOptions:\n      level: \"s0:c123,c456\"\n```\n\n## Pod Security Policies(PSP)\n\nPod Security Policiesï¼ˆPSPï¼‰æ˜¯é›†ç¾¤çº§çš„Podå®‰å…¨ç­–ç•¥ï¼Œè‡ªåŠ¨ä¸ºé›†ç¾¤å†…çš„Podå’ŒVolumeè®¾ç½®Security Contextã€‚\n\n![image.png](Extras/Images/image_1667405053981_0.png)\n\n## PSPç¤ºä¾‹\n\n**é™åˆ¶å®¹å™¨çš„ hostç«¯å£èŒƒå›´ä¸º 8000-8080ï¼š**\n\n```yaml\napiVersion: extensions/v1beta1\nkind: PodSecurityPolicy\nmetadata:\n  name: permissive\nspec:\n  selinux:\n    rule: RunAsAny\n  supplementalGroups:\n    rule: RunAsAny\n  runAsUser:\n    rule: RunAsAny\n  fsGroup:\n    rule: RunAsAny\n  hostPorts:\n  - min: 8000\n    max: 8080\n  volumes:\n  - '*'\n```\n\n# Taint\n\n## ä¸ºèŠ‚ç‚¹å¢åŠ  taint\n\n**ä½¿ç”¨å‘½ä»¤kubectl taintç»™èŠ‚ç‚¹å¢åŠ ä¸€ä¸ªTaintï¼š**\n\n`kubectl taint nodes node1 key=value:NoSchedule`\n\n**è¿è¡Œå¦‚ä¸‹å‘½ä»¤åˆ é™¤Taintï¼š**\n\n`kubectl taint nodes node1 key:NoSchedule-`\n\n**åœ¨ PodSpecä¸­ä¸ºå®¹å™¨è®¾å®šå®¹å¿æ ‡ç­¾ï¼š**\n\n```yaml\ntolerations:\n- key: \"key\"\n  operator: \"Equal\"\n  value: \"value\"\n  effect: \"NoSchedule\"\n```\n\n```yaml\ntolerations:\n- key: \"key\"\n  operator: \"Exists'\n  effect: \"NoSchedule\"\n\n```\n\n## Taint\n\nå¯ä»¥ä»¥ç§Ÿæˆ·ä¸ºç²’åº¦ï¼Œä¸ºä¸åŒç§Ÿæˆ·çš„èŠ‚ç‚¹å¢åŠ  Taintï¼Œä½¿å¾—èŠ‚ç‚¹å½¼æ­¤éš”ç¦»ã€‚\n\nTaintçš„ä½œç”¨æ˜¯è®©ç§Ÿæˆ·ç‹¬å èŠ‚ç‚¹ï¼Œæ— å¯¹åº”Tolerationçš„ Podæ— æ³•è¢«è°ƒåº¦åˆ°TaintèŠ‚ç‚¹ä¸Šï¼Œå®ç°äº†åº”ç”¨éƒ¨ç½²çš„éš”ç¦»ã€‚\n\n# NetworkPolicy\n\n## NetworkPolicy\n\nå¦‚æœä½ å¸Œæœ›åœ¨ IPåœ°å€æˆ–ç«¯å£å±‚é¢ï¼ˆOSIç¬¬ 3å±‚æˆ–ç¬¬ 4 å±‚ï¼‰æ§åˆ¶ç½‘ç»œæµé‡ï¼Œåˆ™ä½ å¯ä»¥è€ƒè™‘ä¸ºé›†ç¾¤ä¸­ç‰¹å®šåº”ç”¨ä½¿ç”¨Kubernetes ç½‘ç»œç­–ç•¥ï¼ˆNetworkPolicyï¼‰ã€‚\n\nPod å¯ä»¥é€šä¿¡çš„ Podæ˜¯é€šè¿‡å¦‚ä¸‹ä¸‰ä¸ªæ ‡è¯†ç¬¦çš„ç»„åˆæ¥è¾©è¯†çš„ï¼š\n\n- å…¶ä»–è¢«å…è®¸çš„ Podsï¼›\n- è¢«å…è®¸çš„åå­—ç©ºé—´ï¼›\n- IPç»„å—ã€‚\n\nç½‘ç»œç­–ç•¥é€šè¿‡ç½‘ç»œæ’ä»¶æ¥å®ç°ã€‚è¦ä½¿ç”¨ç½‘ç»œç­–ç•¥ï¼Œä½ å¿…é¡»ä½¿ç”¨æ”¯æŒ NetworkPolicV çš„ç½‘ç»œè§£å†³æ–¹æ¡ˆã€‚**åˆ›å»ºä¸€ä¸ªNetworkPolicyèµ„æºå¯¹è±¡è€Œæ²¡æœ‰æ§åˆ¶å™¨æ¥ä½¿å®ƒç”Ÿæ•ˆçš„è¯ï¼Œæ˜¯æ²¡æœ‰ä»»ä½•ä½œç”¨çš„ã€‚**\n\n## éš”ç¦»å’Œééš”ç¦»çš„Pod\n\né»˜è®¤æƒ…å†µä¸‹ï¼ŒPodæ˜¯ééš”ç¦»çš„ï¼Œå®ƒä»¬æ¥å—ä»»ä½•æ¥æºçš„æµé‡ã€‚\n\nPodåœ¨è¢«æŸ NetworkPolicyé€‰ä¸­æ—¶è¿›å…¥è¢«éš”ç¦»çŠ¶æ€ã€‚\n\nä¸€æ—¦åå­—ç©ºé—´ä¸­æœ‰NetworkPolicy é€‰æ‹©äº†ç‰¹å®šçš„ Podï¼Œè¯¥ Pod ä¼šæ‹’ç»è¯¥NetworkPolicyæ‰€ä¸å…è®¸çš„è¿æ¥ã€‚\n\nç½‘ç»œç­–ç•¥ä¸ä¼šå†²çªï¼Œå®ƒä»¬æ˜¯ç´¯ç§¯çš„ã€‚å¦‚æœä»»ä½•ä¸€ä¸ªæˆ–å¤šä¸ªç­–ç•¥é€‰æ‹©äº†ä¸€ä¸ªPodï¼Œåˆ™è¯¥ Pod å—é™äºè¿™äº›ç­–ç•¥çš„**å…¥ç«™ï¼ˆIngressï¼‰/å‡ºç«™ï¼ˆEgressï¼‰è§„åˆ™**çš„å¹¶é›†ã€‚å› æ­¤è¯„ä¼°çš„é¡ºåºå¹¶ä¸ä¼šå½±å“ç­–ç•¥çš„ç»“æœã€‚\n\nä¸ºäº†å…è®¸ä¸¤ä¸ªPods ä¹‹é—´çš„ç½‘ç»œæ•°æ®æµï¼Œæºç«¯ Pod ä¸Šçš„å‡ºç«™ï¼ˆEaressï¼‰è§„åˆ™å’Œç›®æ ‡ç«¯ Pod ä¸Šçš„å…¥ç«™ï¼ˆIngressï¼‰è§„åˆ™éƒ½éœ€è¦å…è®¸è¯¥æµé‡ã€‚å¦‚æœæºç«¯çš„å‡ºç«™ï¼ˆEgressï¼‰è§„åˆ™æˆ–ç›®æ ‡ç«¯çš„å…¥ç«™ï¼ˆIngressï¼‰è§„åˆ™æ‹’ç»è¯¥æµé‡ï¼Œåˆ™æµé‡å°†è¢«æ‹’ç»ã€‚\n\n## å®‰å…¨ç­–ç•¥å±æ€§\n\n**specï¼š** NetworkPolicyè§„çº¦ä¸­åŒ…å«äº†åœ¨ä¸€ä¸ªåå­—ç©ºé—´ä¸­å®šä¹‰ç‰¹å®šç½‘ç»œç­–ç•¥æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚\n\n**podSelectorï¼š**\n\n- æ¯ä¸ª NetworkPolicyéƒ½åŒ…æ‹¬ä¸€ä¸ª podSelectorï¼Œå®ƒå¯¹è¯¥ç­–ç•¥æ‰€é€‚ç”¨çš„ä¸€ç»„ Podè¿›è¡Œé€‰æ‹©ã€‚\n- ç©ºçš„ podSelector é€‰æ‹©åå­—ç©ºé—´ä¸‹çš„æ‰€æœ‰ Podã€‚\n\n**policyTypesï¼š**\n\n- æ¯ä¸ªNetworkPolicyéƒ½åŒ…å«ä¸€ä¸ªpolicyTypesåˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«Ingressæˆ–Egress æˆ–ä¸¤è€…å…¼å…·ã€‚\n- å¦‚æœ NetworkPolicyæœªæŒ‡å®š policyTypes åˆ™é»˜è®¤æƒ…å†µä¸‹å§‹ç»ˆè®¾ç½®Ingressï¼›\n- å¦‚æœ NetworkPolicy æœ‰ä»»ä½•å‡ºå£è§„åˆ™çš„è¯åˆ™è®¾ç½® Egressã€‚\n\n## å®‰å…¨ç­–ç•¥å±æ€§\n\nIngressï¼š\n\n- æ¯ä¸ªNetworkPolicyå¯åŒ…å«ä¸€ä¸ªIngressè§„åˆ™çš„ç™½åå•åˆ—è¡¨ã€‚\n- æ¯ä¸ªè§„åˆ™éƒ½å…è®¸åŒæ—¶åŒ¹é… from å’Œ ports éƒ¨åˆ†çš„æµé‡ã€‚\n\nEgressï¼š\n\n- æ¯ä¸ªNetworkPolicyå¯åŒ…å«ä¸€ä¸ªEgress è§„åˆ™çš„ç™½åå•åˆ—è¡¨ã€‚\n- æ¯ä¸ªè§„åˆ™éƒ½å…è®¸åŒ¹é… to å’Œ port éƒ¨åˆ†çš„æµé‡ã€‚\n\n## NetworkPolicy\n\n![image.png](Extras/Images/image_1667463041667_0.png)\n\n## é»˜è®¤ç­–ç•¥\n\n![image.png](Extras/Images/image_1667463441696_0.png)\n\n![image.png](Extras/Images/image_1667463453193_0.png)\n\n# ä¾æ‰˜äºCalico çš„NetworkPolicy\n\n## NetworkPolicy\n\nNetworkPolicyæ˜¯å‘½åç©ºé—´çº§åˆ«èµ„æºã€‚è§„åˆ™åº”ç”¨äºä¸æ ‡ç­¾é€‰æ‹©å™¨åŒ¹é…çš„endpoint çš„é›†åˆã€‚\n\n![image.png](Extras/Images/image_1667464499256_0.png)\n\n## GlobalNetworkPolicy\n\nGlobalNetworkPolicyä¸ NetworkPolicy åŠŸèƒ½ä¸€æ ·ï¼Œæ˜¯æ•´ä¸ªé›†ç¾¤çº§åˆ«çš„èµ„æºã€‚\n\nGlobalNetworkPolicy ä¼šåœ¨é›†ç¾¤ä¸­æ‰€æœ‰ Namespaceç”Ÿæ•ˆï¼Œå¹¶ä¸”èƒ½é™åˆ¶ä¸»æœºï¼ˆHostEndpointï¼‰ã€‚\n\n## ç†è§£Calico çš„é˜²ç«å¢™è§„åˆ™\n\n![image.png](Extras/Images/image_1667465894838_0.png)\n\n## åˆ›å»º NetworkPolicyå¹¶æŸ¥çœ‹ç»“æœ\n\n![image.png](Extras/Images/image_1667465920840_0.png)\n\n## åˆ›å»ºè§„åˆ™å…è®¸ ICMPå¹¶æŸ¥çœ‹è§„åˆ™å˜åŒ–\n\n![image.png](Extras/Images/image_1667465957616_0.png)\n\n# é›¶ä¿¡ä»»æ¶æ„ï¼ˆZTAï¼‰\n\n## ä¼ ç»Ÿå®‰å…¨æ¨¡å‹\n\n**DMZæ¨¡å¼**\n\nä¼ ç»Ÿçš„ç½‘ç»œå®‰å…¨æ¶æ„ç†å¿µæ˜¯åŸºäºè¾¹ç•Œçš„å®‰å…¨æ¶æ„ï¼Œä¼ä¸šæ„å»ºç½‘ç»œå®‰å…¨ä½“ç³»æ—¶ï¼Œé¦–å…ˆå¯»æ‰¾å®‰å…¨è¾¹ç•Œï¼ŒæŠŠç½‘ç»œåˆ’åˆ†ä¸ºå¤–ç½‘ã€å†…ç½‘ã€DMZï¼ˆDeMilitarized Zoneï¼‰åŒºç­‰ä¸åŒçš„åŒºåŸŸç„¶ååœ¨è¾¹ç•Œä¸Šéƒ¨ç½²é˜²ç«å¢™ã€å…¥ä¾µæ£€æµ‹ã€WAFç­‰äº§å“ã€‚\n\nè¿™ç§ç½‘ç»œå®‰å…¨æ¶æ„å‡è®¾æˆ–é»˜è®¤äº†å†…ç½‘æ¯”å¤–ç½‘æ›´å®‰å…¨ï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šé¢„è®¾äº†å¯¹å†…ç½‘ä¸­çš„äººã€è®¾å¤‡å’Œç³»ç»Ÿçš„ä¿¡ä»»ï¼Œå¿½è§†åŠ å¼ºå†…ç½‘å®‰å…¨æªæ–½ã€‚\n\nä¸æ³•åˆ†å­ä¸€æ—¦çªç ´ä¼ä¸šçš„è¾¹ç•Œå®‰å…¨é˜²æŠ¤è¿›å…¥å†…ç½‘ï¼Œä¼šåƒè¿›å…¥æ— äººä¹‹å¢ƒï¼Œå°†å¸¦æ¥ä¸¥é‡çš„åæœã€‚\n\nä¼ ç»Ÿçš„è®¤è¯ï¼Œå³ä¿¡ä»»ã€è¾¹ç•Œé˜²æŠ¤ã€é™æ€è®¿é—®æ§åˆ¶ã€ä»¥ç½‘ç»œä¸ºä¸­å¿ƒã€‚\n\n![image.png](Extras/Images/image_1667468838210_0.png)\n\n## é›¶ä¿¡ä»»æ¶æ„ï¼ˆZero Trust Architectureï¼Œ ZTAï¼‰\n\néšç€äº‘è®¡ç®—ã€å¤§æ•°æ®ã€ç‰©è”ç½‘ã€ç§»åŠ¨åŠå…¬ç­‰æ–°æŠ€æœ¯ä¸ä¸šåŠ¡çš„æ·±åº¦èåˆï¼Œç½‘ç»œå®‰å…¨è¾¹ç•Œä¹Ÿé€æ¸å˜å¾—æ›´åŠ æ¨¡ç³Šï¼Œä¼ ç»Ÿè¾¹ç•Œå®‰å…¨é˜²æŠ¤ç†å¿µé¢ä¸´å·¨å¤§æŒ‘æˆ˜ã€‚\n\n**é›¶ä¿¡ä»»æ ¸å¿ƒåŸåˆ™ï¼šä»ä¸ä¿¡ä»»ï¼Œå§‹ç»ˆéªŒè¯**\n\nåŠ¨æ€å®‰å…¨æ¶æ„ï¼š\n\n- ä»¥èº«ä»½ä¸ºä¸­å¿ƒ\n- ä»¥è¯†åˆ«ã€æŒç»­è®¤è¯ã€åŠ¨æ€è®¿é—®æ§åˆ¶ã€æˆæƒã€å®¡è®¡ä»¥åŠç›‘æµ‹ä¸ºé“¾æ¡\n- ä»¥æœ€å°åŒ–å®æ—¶æˆæƒä¸ºæ ¸å¿ƒ\n- ä»¥å¤šç»´ä¿¡ä»»ç®—æ³•ä¸ºåŸºç¡€\n- è®¤è¯è¾¾æœ«ç«¯\n\n![image.png](Extras/Images/image_1667468921971_0.png)\n\n---\n\nä¸è¾¹ç•Œæ¨¡å‹çš„\"ä¿¡ä»»ä½†éªŒè¯\"ä¸åŒï¼Œé›¶ä¿¡ä»»çš„æ ¸å¿ƒåŸåˆ™æ˜¯\"ä»ä¸ä¿¡ä»»ã€å§‹ç»ˆéªŒè¯\"ã€‚\n\næ ¹æ®Evan Gilmanã€ŠZero Trust Networksã€‹ä¹¦ä¸­æ‰€è¿°ï¼Œé›¶ä¿¡ä»»ç½‘ç»œå»ºç«‹åœ¨äº”ä¸ªå‡è®¾å‰æä¹‹ä¸‹âˆ¶\n\n- å¤–éƒ¨å’Œå†…éƒ¨å¨èƒæ¯æ—¶æ¯åˆ»éƒ½å……æ–¥ç€ç½‘ç»œ;\n- ä¸èƒ½ä»…ä»…ä¾é ç½‘ç»œä½ç½®æ¥ç¡®è®¤ä¿¡ä»»å…³ç³»;\n- æ‰€æœ‰è®¾å¤‡ã€ç”¨æˆ·ã€ç½‘ç»œæµé‡éƒ½åº”è¯¥è¢«è®¤è¯å’Œæˆæƒ;\n- è®¿é—®æ§åˆ¶ç­–ç•¥åº”è¯¥åŠ¨æ€åœ°åŸºäºå°½é‡å¤šçš„æ•°æ®æºè¿›è¡Œè®¡ç®—å’Œè¯„ä¼°ã€‚\n\n## ZTA å®‰å…¨æ¨¡å‹\n\n- é›¶ä¿¡ä»»æ•°æ®\n- é›¶ä¿¡ä»»äººå‘˜\n- é›¶ä¿¡ä»»ç½‘ç»œ\n- é›¶ä¿¡ä»»å·¥ä½œè´Ÿè½½\n- é›¶ä¿¡ä»»è®¾å¤‡\n- å¯è§†åŒ–å’Œåˆ†æ\n- è‡ªåŠ¨åŒ–å’Œç¼–æ’\n\n![image.png](Extras/Images/image_1667469502375_0.png)\n\n## é›¶ä¿¡ä»»æ¶æ„çš„ä¸‰å¤§æŠ€æœ¯\"SIM\"\n\né›¶ä¿¡ä»»æ¶æ„çš„ä¸‰å¤§æŠ€æœ¯\"SIM\"ï¼Œå³\n\n- è½¯ä»¶å®šä¹‰è¾¹ç•Œï¼ˆSDPï¼ŒSoftware Defined Perimeterï¼‰\n- èº«ä»½è¯†åˆ«ä¸è®¿é—®ç®¡ç†ï¼ˆIAMï¼Œ Identity and Access Managementï¼‰\n- å¾®éš”ç¦»ï¼ˆMSGï¼ŒMicro Segmentationï¼‰\n\n## è½¯ä»¶å®šä¹‰è¾¹ç•Œï¼ˆSDPï¼‰\n\nSDPæ—¨åœ¨ä½¿åº”ç”¨ç¨‹åºæ‰€æœ‰è€…èƒ½åœ¨éœ€è¦æ—¶éƒ¨ç½²å®‰å…¨è¾¹ç•Œï¼Œä»¥ä¾¿å°†æœåŠ¡ä¸ä¸å®‰å…¨çš„ç½‘ç»œéš”ç¦»å¼€ã€‚\n\nSDPå°†ç‰©ç†è®¾å¤‡æ›¿æ¢ä¸ºåœ¨åº”ç”¨ç¨‹åºæ‰€æœ‰è€…æ§åˆ¶ä¸‹è¿è¡Œçš„é€»è¾‘ç»„ä»¶ï¼Œä»…åœ¨è®¾å¤‡éªŒè¯å’Œèº«ä»½éªŒè¯åæ‰å…è®¸è®¿é—®ä¼ä¸šåº”ç”¨åŸºç¡€æ¶æ„ã€‚\n\nåŸºäº SDPçš„ç³»ç»Ÿé€šå¸¸ä¼šå®æ–½æ§åˆ¶å±‚ä¸æ•°æ®å±‚çš„åˆ†ç¦»ï¼š\n\n- æ§åˆ¶æµé˜¶æ®µï¼Œç”¨æˆ·åŠå…¶è®¾å¤‡è¿›è¡Œé¢„è®¤è¯æ¥è·å–ä¸°å¯Œçš„å±æ€§å‡­æ®ä½œä¸ºèº«ä»½ä¸»ä½“ï¼Œä»¥æ­¤ç»“åˆåŸºäºå±æ€§çš„é¢„æˆæƒç­–ç•¥ï¼Œæ˜ å°„å¾—åˆ°ä»…ä¾›ç›®æ ‡è®¿é—®çš„ç‰¹å®šè®¾å¤‡å’ŒæœåŠ¡;\n- æ•°æ®ä¼ è¾“é˜¶æ®µç›´æ¥å»ºç«‹ç›¸åº”å®‰å…¨è¿æ¥å¹¶ä¼ è¾“æ•°æ®ã€‚\n\n## èº«ä»½è¯†åˆ«ä¸è®¿é—®ç®¡ç†ï¼ˆIAMï¼‰\n\né›¶ä¿¡ä»»å¼ºè°ƒåŸºäºèº«ä»½çš„ä¿¡ä»»é“¾æ¡ï¼Œå³è¯¥èº«ä»½åœ¨å¯ä¿¡ç»ˆç«¯ï¼Œè¯¥èº«ä»½æ‹¥æœ‰æƒé™æ‰å¯å¯¹èµ„æºè¿›è¡Œè¯·æ±‚ã€‚\n\nä¼ ç»Ÿçš„ IAMç³»ç»Ÿå¯ä»¥ååŠ©è§£å†³èº«ä»½å”¯ä¸€æ ‡è¯†ã€èº«ä»½å±æ€§ã€èº«ä»½å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„åŠŸèƒ½é—®é¢˜ã€‚\n\né€šè¿‡IAM å°†èº«ä»½ä¿¡æ¯ï¼ˆèº«ä»½åŠé”€ç¦»èŒã€èº«ä»½è¿‡æœŸã€èº«ä»½å¼‚å¸¸ç­‰ï¼‰ä¼ é€’ç»™é›¶ä¿¡ä»»ç³»ç»Ÿå.é›¶ä¿¡ä»»ç³»ç»Ÿå¯ä»¥é€šè¿‡IAMç³»ç»Ÿçš„èº«ä»½ä¿¡æ¯æ¥åˆ†é…ç›¸åº”æƒé™ã€‚\n\né€šè¿‡ IAMç³»ç»Ÿå¯¹èº«ä»½çš„å”¯ä¸€æ ‡è¯†ï¼Œå¯æœ‰åˆ©äºé›¶ä¿¡ä»»ç³»ç»Ÿç¡®è®¤ç”¨æˆ·å¯ä¿¡ï¼Œé€šè¿‡å”¯ä¸€æ ‡è¯†å¯¹ç”¨æˆ·èº«ä»½å»ºç«‹èµ·ç»ˆç«¯ã€èµ„æºçš„ä¿¡ä»»å…³ç³»ï¼Œå¹¶åœ¨å‘ç°é£é™©æ—¶å®æ–½é’ˆå¯¹å…³é”®ç”¨æˆ·ç›¸å…³çš„è®¿é—®è¿æ¥è¿›è¡Œé˜»æ–­ç­‰æ§åˆ¶ã€‚\n\n## å¾®éš”ç¦»ï¼ˆMSGï¼‰\n\n**å¾®éš”ç¦»æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ç½‘ç»œå®‰å…¨éš”ç¦»æŠ€æœ¯**\n\n- èƒ½å¤Ÿåœ¨é€»è¾‘ä¸Šå°†æ•°æ®ä¸­å¿ƒåˆ’åˆ†ä¸ºä¸åŒçš„å®‰å…¨æ®µï¼Œä¸€ç›´åˆ°å„ä¸ªå·¥ä½œè´Ÿè½½çº§åˆ«;\n- ä¸ºæ¯ä¸ªç‹¬ç«‹çš„å®‰å…¨æ®µå®šä¹‰è®¿é—®æ§åˆ¶ç­–ç•¥ã€‚\n\n**å®ƒä¸»è¦èšç„¦åœ¨äº‘å¹³å°ä¸œè¥¿å‘æµé‡çš„éš”ç¦»**\n\n- ä¸€æ˜¯åŒºåˆ«ä¼ ç»Ÿç‰©ç†é˜²ç«å¢™çš„éš”ç¦»ä½œç”¨;\n- äºŒæ˜¯æ›´åŠ è´´è¿‘äº‘è®¡ç®—ç¯å¢ƒä¸­çš„çœŸå®éœ€æ±‚ã€‚\n\nå¾®éš”ç¦»å°†ç½‘ç»œè¾¹ç•Œå®‰å…¨ç†å¿µå‘æŒ¥åˆ°æè‡´ï¼Œå°†ç½‘ç»œè¾¹ç•Œåˆ†å‰²åˆ°å°½å¯èƒ½çš„å°.èƒ½å¤Ÿå¾ˆå¥½çš„ç¼“è§£ä¼ ç»Ÿ\n\nè¾¹ç•Œå®‰å…¨ç†å¿µä¸‹çš„è¾¹ç•Œè¿‡åº¦ä¿¡ä»»å¸¦æ¥çš„å®‰å…¨é£é™©ã€‚\n\n# åŸºäºIstioçš„å®‰å…¨ä¿è¯\n\n## å¾®æœåŠ¡æ¶æ„ä¸‹çš„å®‰å…¨æŒ‘æˆ˜\n\nä¸ºäº†æŠµå¾¡ä¸­é—´äººæ”»å‡»ï¼Œéœ€è¦æµé‡åŠ å¯†ã€‚\n\nä¸ºäº†æä¾›çµæ´»çš„æœåŠ¡è®¿é—®æ§åˆ¶ï¼Œéœ€è¦åŒå‘TLSå’Œç»†ç²’åº¦çš„è®¿é—®ç­–ç•¥ã€‚\n\nè¦ç¡®å®šè°åœ¨ä»€ä¹ˆæ—¶å€™åšäº†ä»€ä¹ˆï¼Œéœ€è¦å®¡è®¡å·¥å…·ã€‚\n\n## Istioçš„å®‰å…¨ä¿è¯\n\n**Istioå®‰å…¨åŠŸèƒ½æä¾›ï¼š**\n\n- èº«ä»½è¯†åˆ«ï¼›\n- çµæ´»ç­–ç•¥ï¼›\n- é€æ˜çš„TLSåŠ å¯†ï¼›\n- è®¤è¯ï¼Œæˆæƒå’Œå®¡è®¡ï¼ˆAAAï¼‰å·¥å…·æ¥ä¿æŠ¤ä½ çš„æœåŠ¡å’Œæ•°æ®ã€‚\n\n**Istioå®‰å…¨çš„ç›®æ ‡æ˜¯ï¼š**\n\n- é»˜è®¤å®‰å…¨ï¼šåº”ç”¨ç¨‹åºä»£ç å’ŒåŸºç¡€è®¾æ–½æ— éœ€æ›´æ”¹ã€‚\n- æ·±åº¦é˜²å¾¡ï¼šä¸ç°æœ‰å®‰å…¨ç³»ç»Ÿé›†æˆä»¥æä¾›å¤šå±‚é˜²å¾¡ã€‚\n- é›¶ä¿¡ä»»ç½‘ç»œï¼šåœ¨ä¸å—ä¿¡ä»»çš„ç½‘ç»œä¸Šæ„å»ºå®‰å…¨è§£å†³æ–¹æ¡ˆã€‚\n\n![image.png](Extras/Images/image_1667470319529_0.png)\n\n## é«˜å±‚æ¶æ„\n\nç”¨äºå¯†é’¥å’Œè¯ä¹¦ç®¡ç†çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ã€‚\n\né…ç½® APIæœåŠ¡å™¨åˆ†å‘ç»™ä»£ç†âˆ¶\n\n- è®¤è¯ç­–ç•¥\n- æˆæƒç­–ç•¥\n\nå®‰å…¨å‘½åä¿¡æ¯\n\nSidecarå’Œè¾¹ç¼˜ä»£ç†ä½œä¸º Policy Enforcement Pointsï¼ˆPEPsï¼‰ä»¥ä¿æŠ¤å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å®‰å…¨ã€‚\n\nä¸€ç»„ Envoyä»£ç†æ‰©å±•ï¼Œç”¨äºç®¡ç†é¥æµ‹å’Œå®¡è®¡ã€‚\n\n## Istioå®‰å…¨æ¶æ„\n\n![image.png](Extras/Images/image_1667470608630_0.png)\n\n## Istioèº«ä»½\n\nèº«ä»½æ˜¯ä»»ä½•å®‰å…¨åŸºç¡€æ¶æ„çš„åŸºæœ¬æ¦‚å¿µã€‚\n\nåœ¨å·¥ä½œè´Ÿè½½é—´é€šä¿¡å¼€å§‹æ—¶ï¼ŒåŒæ–¹å¿…é¡»äº¤æ¢åŒ…å«èº«ä»½ä¿¡æ¯çš„å‡­è¯ä»¥è¿›è¡ŒåŒå‘éªŒè¯ã€‚\n\nåœ¨å®¢æˆ·ç«¯ï¼Œæ ¹æ®å®‰å…¨å‘½åä¿¡æ¯æ£€æŸ¥æœåŠ¡å™¨çš„æ ‡è¯†ï¼Œä»¥æŸ¥çœ‹å®ƒæ˜¯å¦æ˜¯è¯¥æœåŠ¡çš„æˆæƒè¿è¡Œç¨‹åºã€‚\n\nåœ¨æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨å¯ä»¥æ ¹æ®æˆæƒç­–ç•¥ç¡®å®šå®¢æˆ·ç«¯å¯ä»¥è®¿é—®å“ªäº›ä¿¡æ¯ï¼Œå®¡è®¡è°åœ¨ä»€ä¹ˆæ—¶é—´è®¿é—®äº†ä»€ä¹ˆï¼Œæ ¹æ®ä»–ä»¬ä½¿ç”¨çš„å·¥ä½œè´Ÿè½½å‘å®¢æˆ·æ”¶è´¹ï¼Œå¹¶æ‹’ç»ä»»ä½•æœªèƒ½æ”¯ä»˜è´¦å•çš„å®¢æˆ·è®¿é—®å·¥ä½œè´Ÿè½½ã€‚\n\nIstio èº«ä»½æ¨¡å‹ä½¿ç”¨ service identityï¼ˆæœåŠ¡èº«ä»½ï¼‰æ¥ç¡®å®šä¸€ä¸ªè¯·æ±‚æºç«¯çš„èº«ä»½ã€‚\n\n---\n\n**Kubernetesï¼š** Kubernetes æœåŠ¡å¸æˆ·\n\n**GKE/GCEï¼š** å¯ä»¥ä½¿ç”¨GCPæœåŠ¡å¸æˆ·\n\n**GCPï¼š** GCPæœåŠ¡å¸æˆ·\n\n**AWSï¼š** AWSIAMç”¨æˆ·/è§’è‰²å¸æˆ·\n\n**On-premisesï¼ˆéKubernetesï¼‰ï¼š** ç”¨æˆ·å¸æˆ·ã€è‡ªå®šä¹‰æœåŠ¡å¸æˆ·ã€æœåŠ¡åç§°ã€Istio æœåŠ¡å¸æˆ·æˆ– GCPæœåŠ¡å¸æˆ·ã€‚\n\n**Istioå®‰å…¨ä¸ SPIFFEï¼š**\n\nIstio å’Œ SPIFFEå…±äº«ç›¸åŒçš„èº«ä»½æ–‡ä»¶âˆ¶SVIDï¼ˆSPIFFE å¯éªŒè¯èº«ä»½è¯ä»¶ï¼‰ã€‚ä¾‹å¦‚âˆ¶ åœ¨ Kubernetes ä¸­ï¼ŒX.509è¯ä¹¦çš„ URIå­¦æ®µæ ¼å¼ä¸º `spiffeâˆ¶//\u003cdomain\u003e/ns/\u003cnamespace\u003e/sa/\u003cserviceaccount\u003e`ã€‚è¿™ä½¿ Istio æœåŠ¡èƒ½å¤Ÿå»ºç«‹å’Œæ¥å—ä¸å…¶ä»– SPIFFEå…¼å®¹ç³»ç»Ÿçš„è¿æ¥ã€‚\n\n## SDS\n\n**Istioä¾›åº”èº«ä»½æ˜¯é€šè¿‡secret discovery serviceï¼ˆSDSï¼‰æ¥å®ç°çš„ï¼š**\n\n- istiodæä¾› gRPCæœåŠ¡ä»¥æ¥å—è¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRSï¼‰ã€‚\n- å½“å·¥ä½œè´Ÿè½½å¯åŠ¨æ—¶ï¼ŒEnvoyé€šè¿‡ç§˜å¯†å‘ç°æœåŠ¡ï¼ˆSDSï¼‰APIå‘åŒå®¹å™¨å†…çš„istio-agentå‘é€è¯ä¹¦å’Œå¯†é’¥è¯·æ±‚ã€‚\n- åœ¨æ”¶åˆ°SDSè¯·æ±‚åï¼Œistio-agentåˆ›å»ºç§é’¥å’ŒCSRï¼Œç„¶åå°†CSRåŠå…¶å‡­æ®å‘é€åˆ° istiod CAè¿›è¡Œç­¾åã€‚\n- istiod CA éªŒè¯CSRä¸­æºå¸¦çš„å‡­æ®ï¼ŒæˆåŠŸéªŒè¯åç­¾ç½²CSRä»¥ç”Ÿæˆè¯ä¹¦ã€‚\n- istio-agent é€šè¿‡Envoy SDS APIå°†ç§é’¥å’Œä»Istio CA æ”¶åˆ°çš„è¯ä¹¦å‘é€ç»™Envoyã€‚\n- istio-agent ä¼šç›‘å·¥ä½œè´Ÿè½½è¯ä¹¦çš„æœ‰æ•ˆæœŸã€‚ä¸Šè¿°CSR è¿‡ç¨‹ä¼šå‘¨æœŸæ€§åœ°é‡å¤ï¼Œä»¥å¤„ç†è¯ä¹¦å’Œå¯†é’¥è½®æ¢ã€‚\n\n![image.png](Extras/Images/image_1667470838581_0.png)\n\n# è®¤è¯\n\n## åŸºäºIstioçš„è®¤è¯\n\n- Istio é€šè¿‡å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ Policy Enforcement Pointsï¼ˆPEPsï¼‰å»ºç«‹æœåŠ¡åˆ°æœåŠ¡çš„é€šä¿¡é€šé“ã€‚\n- PEPSåœ¨ Istio æ¶æ„ä¸­çš„å®ç°æ˜¯ Envoyã€‚\n- **Peer authenticationï¼š**\n\t- ç”¨äºæœåŠ¡åˆ°æœåŠ¡çš„è®¤è¯ï¼Œä»¥éªŒè¯è¿›è¡Œè¿æ¥çš„å®¢æˆ·ç«¯ã€‚\n- **Istio æä¾›åŒå‘ TLSä½œä¸ºä¼ è¾“è®¤è¯çš„å…¨æ ˆè§£å†³æ–¹æ¡ˆï¼Œæ— éœ€æ›´æ”¹æœåŠ¡ä»£ç å°±å¯ä»¥å¯ç”¨å®ƒ**ã€‚è¿™ä¸ªè§£å†³æ–¹æ¡ˆä¸ºï¼š\n\t- ä¸ºæ¯ä¸ªæœåŠ¡æä¾›å¼ºå¤§çš„èº«ä»½ï¼Œè¡¨ç¤ºå…¶è§’è‰²ï¼Œä»¥å®ç°è·¨ç¾¤é›†å’Œäº‘çš„äº’æ“ä½œæ€§ã€‚\n\t- ä¿æŠ¤æœåŠ¡åˆ°æœåŠ¡çš„é€šä¿¡ã€‚\n\t- æä¾›å¯†é’¥ç®¡ç†ç³»ç»Ÿï¼Œä»¥è‡ªåŠ¨è¿›è¡Œå¯†é’¥å’Œè¯ä¹¦çš„ç”Ÿæˆï¼Œåˆ†å‘å’Œè½®æ¢ã€‚\n- **Request authentication**\n\t- ç”¨äºæœ€ç»ˆç”¨æˆ·è®¤è¯ï¼Œä»¥éªŒè¯é™„åŠ åˆ°è¯·æ±‚çš„å‡­æ®ã€‚\n\t- Istio ä½¿ç”¨JSON Web Tokenï¼ˆJWTï¼‰éªŒè¯å¯ç”¨è¯·æ±‚çº§è®¤è¯ï¼Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰è®¤è¯å®ç°æˆ–ä»»ä½•OpenID Connect çš„è®¤è¯å®ç°ï¼ˆä¾‹å¦‚ä¸‹é¢åˆ—ä¸¾çš„ï¼‰æ¥ç®€åŒ–çš„å¼€å‘äººå‘˜ä½“éªŒã€‚\n\n## Istioè®¤è¯æ¶æ„\n\n- æœªè®¾ç½®æ¨¡å¼çš„ç½‘æ ¼èŒƒå›´çš„peerè®¤è¯ç­–ç•¥é»˜è®¤ä½¿ç”¨PERMISSIVEæ¨¡å¼ã€‚\n- å‘é€è¯·æ±‚çš„å®¢æˆ·ç«¯æœåŠ¡è´Ÿè´£éµå¾ªå¿…è¦çš„è®¤è¯æœºåˆ¶ã€‚\n- **RequestAuthentication**\n\t- åº”ç”¨ç¨‹åºè´Ÿè´£è·å–JWTå‡­è¯å¹¶å°†å…¶é™„åŠ åˆ°è¯·æ±‚ã€‚\n- **PeerAuthentication**\n\t- Istioä¼šè‡ªåŠ¨å°†ä¸¤ä¸ªPEPSä¹‹é—´çš„æ‰€æœ‰æµé‡å‡çº§ä¸ºåŒå‘TLSã€‚\n\t- å¦‚æœè®¤è¯ç­–ç•¥ç¦ç”¨äº†åŒå‘TLSæ¨¡å¼ï¼Œåˆ™Istioå°†ç»§ç»­åœ¨PEPSä¹‹é—´ä½¿ç”¨çº¯æ–‡æœ¬ã€‚\n\t- è¦è¦†ç›–æ­¤è¡Œä¸ºï¼Œdestination rules æ˜¾å¼ç¦ç”¨åŒå‘TLSæ¨¡å¼ã€‚\n\n![image.png](Extras/Images/image_1667471444924_0.png)\n\n## åŒå‘TLSè®¤è¯\n\n**å½“ä¸€ä¸ªå·¥ä½œè´Ÿè½½ä½¿ç”¨åŒå‘TLSè®¤è¯å‘å¦ä¸€ä¸ªå·¥ä½œè´Ÿè½½å‘é€è¯·æ±‚æ—¶ï¼Œè¯¥è¯·æ±‚çš„å¤„ç†æ–¹å¼å¦‚ä¸‹ï¼š**\n- Istio å°†å‡ºç«™æµé‡ä»å®¢æˆ·ç«¯é‡æ–°è·¯ç”±åˆ°å®¢æˆ·ç«¯çš„æœ¬åœ° sidecar Envoyã€‚\n- å®¢æˆ·ç«¯ Envoyä¸æœåŠ¡å™¨ç«¯ Envoy å¼€å§‹åŒå‘TLSæ¡æ‰‹ã€‚åœ¨æ¡æ‰‹æœŸé—´ï¼Œå®¢æˆ·ç«¯ Envoyè¿˜åšäº†å®‰å…¨å‘½åæ£€æŸ¥ï¼Œä»¥éªŒè¯æœåŠ¡å™¨è¯ä¹¦ä¸­æ˜¾ç¤ºçš„æœåŠ¡å¸æˆ·æ˜¯å¦è¢«æˆæƒè¿è¡Œç›®æ ‡æœåŠ¡ã€‚\n- å®¢æˆ·ç«¯ Envoyå’ŒæœåŠ¡å™¨ç«¯ Envoyå»ºç«‹äº†ä¸€ä¸ªåŒå‘çš„TLSè¿æ¥ï¼ŒIstio å°†æµé‡ä»å®¢æˆ·ç«¯ Envoyè½¬å‘åˆ°æœåŠ¡å™¨ç«¯ Envoyã€‚\n- æˆæƒåï¼ŒæœåŠ¡å™¨ç«¯ Envoy é€šè¿‡æœ¬åœ° TCPè¿æ¥å°†æµé‡è½¬å‘åˆ°æœåŠ¡å™¨æœåŠ¡ã€‚\n\n## å®½å®¹æ¨¡å¼ï¼ˆpermissive modeï¼‰\n\nå…è®¸æœåŠ¡åŒæ—¶æ¥å—çº¯æ–‡æœ¬æµé‡å’ŒåŒå‘ TLSæµé‡ã€‚\n\nè¿™ä¸ªåŠŸèƒ½æå¤§åœ°æå‡äº†åŒå‘TLSçš„å…¥é—¨ä½“éªŒã€‚\n\nåœ¨è¿ç»´äººå‘˜å¸Œæœ›å°†æœåŠ¡ç§»æ¤åˆ°å¯ç”¨äº†åŒå‘TLS çš„Istioä¸Šæ—¶ï¼Œè®¸å¤šéIstioå®¢æˆ·ç«¯å’Œé Istio æœåŠ¡ç«¯é€šä¿¡æ—¶ä¼šäº§ç”Ÿé—®é¢˜ã€‚\n\né€šå¸¸æƒ…å†µä¸‹ï¼Œè¿ç»´äººå‘˜æ— æ³•åŒæ—¶ä¸ºæ‰€æœ‰å®¢æˆ·ç«¯å®‰è£…Istio sidecarï¼Œç”šè‡³æ²¡æœ‰è¿™æ ·åšçš„æƒé™ã€‚å³ä½¿åœ¨æœåŠ¡ç«¯ä¸Šå®‰è£…äº†Istio sidecarï¼Œè¿ç»´äººå‘˜ä¹Ÿæ— æ³•åœ¨ä¸ä¸­æ–­ç°æœ‰è¿æ¥çš„æƒ…å†µä¸‹å¯ç”¨åŒå‘TLSã€‚\n\n## å®‰å…¨å‘½å\n\næœåŠ¡å™¨èº«ä»½ï¼ˆserver identitiesï¼‰è¢«ç¼–ç åœ¨è¯ä¹¦é‡Œï¼Œä½†æœåŠ¡åç§°ï¼ˆservice namesï¼‰é€šè¿‡æœåŠ¡å‘ç°æˆ– DNSè¢«æ£€ç´¢ã€‚\n\nå®‰å…¨å‘½åä¿¡æ¯å°†æœåŠ¡å™¨èº«ä»½æ˜ å°„åˆ°æœåŠ¡åç§°ã€‚\n\nèº«ä»½Aåˆ°æœåŠ¡åç§°Bçš„æ˜ å°„è¡¨ç¤º\"æˆæƒ Aè¿è¡ŒæœåŠ¡ B\"ã€‚\n\næ§åˆ¶å¹³é¢ç›‘è§† apiserverï¼Œç”Ÿæˆå®‰å…¨å‘½åæ˜ å°„ï¼Œå¹¶å°†å…¶å®‰å…¨åœ°åˆ†å‘åˆ°PEPsã€‚ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜äº†ä¸ºä»€ä¹ˆå®‰å…¨å‘½åå¯¹èº«ä»½éªŒè¯è‡³å…³é‡è¦ã€‚\n\n## è®¤è¯ç­–ç•¥\n\nè®¤è¯ç­–ç•¥æ˜¯å¯¹æœåŠ¡æ”¶åˆ°çš„è¯·æ±‚ç”Ÿæ•ˆçš„ï¼›\n\nè¦åœ¨åŒå‘TLSä¸­æŒ‡å®š**å®¢æˆ·ç«¯**è®¤è¯ç­–ç•¥ï¼Œéœ€è¦åœ¨ DetinationRule ä¸­è®¾ç½® TLSSettingsã€‚\n\n![image.png](Extras/Images/image_1667472040181_0.png)\n\nç›¸åº”çš„éœ€è¦é€šè¿‡PeerAuthenticationé…ç½®æœåŠ¡ç«¯æ¥å—ä½•ç§è®¤è¯æ–¹å¼\n\n![image.png](Extras/Images/image_1667472078286_0.png)\n\n## RequestAuthentication\n\n**Request è®¤è¯ç­–ç•¥æŒ‡å®šéªŒè¯ JSON Web Tokenï¼ˆJWTï¼‰æ‰€éœ€çš„å€¼ã€‚** è¿™äº›å€¼åŒ…æ‹¬ï¼š\n\n- token åœ¨è¯·æ±‚ä¸­çš„ä½ç½®\n- è¯·æ±‚çš„ issuer\n- å…± JSON Web Key Setï¼ˆJWKSï¼‰\n\nIstio ä¼šæ ¹æ®request è®¤è¯ç­–ç•¥ä¸­çš„è§„åˆ™æ£€æŸ¥æä¾›çš„ä»¤ç‰Œï¼ˆå¦‚æœå·²æä¾›ï¼‰ï¼Œå¹¶æ‹’ç»ä»¤ç‰Œæ— æ•ˆçš„è¯·æ±‚ã€‚\n\nå½“è¯·æ±‚ä¸å¸¦æœ‰ä»¤ç‰Œæ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹å°†æ¥å—å®ƒä»¬ã€‚\n\n```yaml\napiVersion: security.istio.io/v1beta1\nkind: RequestAuthentication\nmetadata:\n  name: \"default\"\n  namespace: istio-system\nspec:\n  selector:\n    matchLabels:\n      istio: ingressgateway\n  jwtRules:\n  - issuer: \"testing@secure.istio.io\"\n    jwksUri: \"https://raw.githubusercontent.com/istio/istio/release-1.12/security/tools/jwt/samples/jwks.json\"\n```\n\n# é‰´æƒ\n\n## æˆæƒæ¶æ„\n\n**æ¯ä¸ªEnvoyä»£ç†éƒ½è¿è¡Œä¸€ä¸ªæˆæƒå¼•æ“ï¼Œè¯¥å¼•æ“åœ¨è¿è¡Œæ—¶æˆæƒè¯·æ±‚ã€‚**\n\n- å½“è¯·æ±‚åˆ°è¾¾ä»£ç†æ—¶ï¼Œæˆæƒå¼•æ“æ ¹æ®å½“å‰æˆæƒç­–ç•¥è¯„ä¼°è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œå¹¶è¿”å›æˆæƒç»“æœALLOWæˆ–DENYã€‚\n- æˆæƒç­–ç•¥æ”¯æŒALLOWå’ŒDENYåŠ¨ä½œï¼Œæ‹’ç»ç­–ç•¥ä¼˜å…ˆäºå…è®¸ç­–ç•¥ã€‚\n- å¦‚æœå°†ä»»ä½•å…è®¸ç­–ç•¥åº”ç”¨äºå·¥ä½œè´Ÿè½½ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ç¬¦åˆè¯¥ç­–ç•¥çš„è®¿é—®éƒ½å°†è¢«ç¦æ­¢ã€‚\n\n![image.png](Extras/Images/image_1667474428578_0.png)\n\n## æˆæƒç­–ç•¥ï¼ˆAuthorizationPolicyï¼‰\n\n- selectorå­—æ®µæŒ‡å®šç­–ç•¥çš„ç›®æ ‡\n- actionå­—æ®µæŒ‡å®šå…è®¸è¿˜æ˜¯æ‹’ç»è¯·æ±‚\n- rules æŒ‡å®šä½•æ—¶è§¦å‘åŠ¨ä½œ\n\t- rulesä¸‹çš„fromå­—æ®µæŒ‡å®šè¯·æ±‚çš„æ¥æº\n\t- rulesä¸‹çš„toå­—æ®µæŒ‡å®šè¯·æ±‚çš„æ“ä½œ\n\t- rulesä¸‹çš„whenå­—æ®µæŒ‡å®šåº”ç”¨è§„åˆ™æ‰€éœ€çš„æ¡ä»¶\n\n![image.png](Extras/Images/image_1667474516979_0.png)\n\n![image.png](Extras/Images/image_1667474532819_0.png){:height 465, :width 458}\n\n## ç­–ç•¥ç›®æ ‡\n\nå¯ä»¥é€šè¿‡ metadata/namespace å­—æ®µå’Œå¯é€‰çš„selectorå­—æ®µæ¥æŒ‡å®šç­–ç•¥çš„èŒƒå›´æˆ–ç›®æ ‡ã€‚\n\nmetadata/namespaceå‘Šè¯‰è¯¥ç­–ç•¥é€‚ç”¨äºå“ªä¸ªå‘½åç©ºé—´ã€‚å¦‚æœå°†å…¶å€¼è®¾ç½®ä¸ºæ ¹åç§°ç©ºé—´ï¼Œåˆ™è¯¥ç­–ç•¥å°†åº”ç”¨äºç½‘æ ¼ä¸­çš„æ‰€æœ‰åç§°ç©ºé—´ã€‚\n\næ ¹å‘½åç©ºé—´çš„å€¼æ˜¯å¯é…ç½®çš„ï¼Œé»˜è®¤å€¼ä¸º istio-systemã€‚\n\næ‚¨å¯ä»¥ä½¿ç”¨selectorå­—æ®µæ¥è¿›ä¸€æ­¥é™åˆ¶ç­–ç•¥ä»¥åº”ç”¨äºç‰¹å®šå·¥ä½œè´Ÿè½½ã€‚\n\nå¦‚æœæœªè®¾ç½®ï¼Œåˆ™æˆæƒç­–ç•¥å°†åº”ç”¨äºä¸æˆæƒç­–ç•¥ç›¸åŒçš„å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰å·¥ä½œè´Ÿè½½ã€‚\n\n![image.png](Extras/Images/image_1667474660706_0.png)\n\n## å€¼åŒ¹é…\n\næˆæƒç­–ç•¥ä¸­çš„å¤§å¤šæ•°å­—æ®µéƒ½æ”¯æŒä»¥ä¸‹æ‰€æœ‰åŒ¹é…æ¨¡å¼ï¼š\n\n- å®Œå…¨åŒ¹é…å³å®Œæ•´çš„å­—ç¬¦ä¸²åŒ¹é…ã€‚\n- å‰ç¼€åŒ¹é…ï¼š\"\\*\"ç»“å°¾çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œ\"test.abc.\\*\"åŒ¹é…\"test.abc.com\"ã€\"test.abc.com.cn\"ã€\"test.abc.org\"ç­‰ç­‰ã€‚åç¼€åŒ¹é…\"*\"å¼€å¤´çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œ\"*.abc.com\"åŒ¹é…\"eng.abc.com\"ã€\"test.eng.abc.com\"ç­‰ç­‰ã€‚\n- å­˜åœ¨åŒ¹é…ï¼š\\*ç”¨äºæŒ‡å®šéç©ºçš„ä»»æ„å†…å®¹ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ ¼å¼fieldnameâˆ¶[\"\\*\"]æŒ‡å®šå¿…é¡»å­˜åœ¨çš„å­—æ®µã€‚è¿™æ„å‘³ç€è¯¥å­—æ®µå¯ä»¥åŒ¹é…ä»»æ„å†…å®¹ï¼Œä½†æ˜¯ä¸èƒ½ä¸ºç©ºã€‚\n\n![image.png](Extras/Images/image_1667474807722_0.png)\n\n## å…¨éƒ¨å…è®¸å’Œé»˜è®¤å…¨éƒ¨æ‹’ç»æˆæƒç­–ç•¥\n\n![image.png](Extras/Images/image_1667474840372_0.png)\n\n## è‡ªå®šä¹‰æ¡ä»¶\n\n![image.png](Extras/Images/image_1667474870864_0.png)\n\n## è®¤è¯ä¸æœªè®¤è¯èº«ä»½\n\n![image.png](Extras/Images/image_1667474896234_0.png)\n\n## åœ¨æ™®é€š TCPåè®®ä¸Šä½¿ç”¨ Istio æˆæƒ\n\nå¦‚æœæ‚¨æˆæƒç­–ç•¥ä¸­å¯¹TCPå·¥ä½œè´Ÿè½½ä½¿ç”¨äº†ä»»ä½•åªé€‚ç”¨äºHTTP çš„å­—æ®µï¼ŒIstio å°†ä¼šå¿½ç•¥å®ƒä»¬ã€‚\n\n![image.png](Extras/Images/image_1667474928562_0.png)\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/%E5%B0%86%E5%BA%94%E7%94%A8%E8%BF%81%E7%A7%BB%E8%87%B3Kubernetes%E5%B9%B3%E5%8F%B0":{"title":"å°†åº”ç”¨è¿ç§»è‡³Kuberneteså¹³å°","content":"\n# åº”ç”¨æ¥å…¥æœ€ä½³å®è·µ\n\n## åº”ç”¨å®¹å™¨åŒ–\n\n### ç›®æ ‡\n\n**ç¨³å®šæ€§ã€å¯ç”¨æ€§ã€æ€§èƒ½ã€å®‰å…¨**\n\nä»å¤šç»´åº¦æ€è€ƒé«˜å¯ç”¨çš„é—®é¢˜\n\n![image.png](Extras/Images/image_1667144371254_0.png)\n\n### åº”ç”¨å®¹å™¨åŒ–çš„æ€è€ƒ\n\n![image.png](Extras/Images/image_1667144500777_0.png)\n\n### å®¹å™¨é¢å¤–å¼€é”€å’Œé£é™©\n\n- **Log driver**\n\t- Blocking mode\n\t- Non blocking mode\n- **å…±ç”¨ kernel æ‰€ä»¥**\n\t- ç³»ç»Ÿå‚æ•°é…ç½®å…±äº«\n\t- è¿›ç¨‹æ•°å…±äº«-Fork bomb\n\t- fd æ•°å…±äº«\n\t- ä¸»æœºç£ç›˜å…±äº«\n\n### å®¹å™¨åŒ–åº”ç”¨çš„èµ„æºç›‘æ§\n\n**å®¹å™¨ä¸­çœ‹åˆ°çš„èµ„æºæ˜¯ä¸»æœºèµ„æº**\n\n- Top\n- Java runtime.GetAvailableProcesses()\n- cat /proc/cpuinfo\n- cat /proC/meminfo\n- df -k\n\n**è§£å†³æ–¹æ¡ˆ**\n\n- æŸ¥è¯¢/proc/1/cgroup æ˜¯å¦åŒ…å«kubepodså…³é”®å­—ï¼ˆdockerå…³é”®å­—ä¸å¯é ï¼‰ã€‚\n\t- 11:cpu,cpuacct:/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort\u0002-pod521722c3_85a8_11e9_87fc_3cfdfe57c998.slice/9568cc0d8ae182395e1ce172e2cac723c4781a999e89e0f9f10d33af079a56e9\n- åŒ…å«æ­¤å…³é”®å­—ï¼Œåˆ™è¡¨æ˜æ˜¯è¿è¡Œåœ¨Kubernetes ä¹‹ä¸Šã€‚\n\n### å†…å­˜å¼€é”€\n\n**é…é¢**\n\n- cat /sys/fs/cgroup/memory/memory.limit_in_bytes\n\t- 36854771712\n\n**ç”¨é‡**\n\n- cat /sys/fs/cgroup/memory/memory.usage_in_bytes\n\t- 448450560\n\n### CPU\n\n**é…é¢ï¼Œåˆ†é…çš„ CPUä¸ªæ•°=quota/ periodï¼Œquota=-1ä»£è¡¨ besteffort**\n\n- cat /sys/fs/cgroup/cpu/cpu.cfs_quota_us\n\t- -1\n- cat /sys/fs/cgroup/cpu/cpu.cfs_period_us\n\t- 100000\n\n**ç”¨é‡**\n\n- cat /sys/fs/cgroup/cpuacct/cpuacct.usage_percpuï¼ˆæŒ‰CPUåŒºåˆ†ï¼‰\n\t- 140669504971 148500278385149957919463 152786448674\n- cat /sys/fs/cgroup/cpuacct/cpuacct.usage\n\t- 12081100465458\n\n### å…¶ä»–æ–¹æ¡ˆ\n\n- xcfs\n\t- é€šè¿‡ so æŒ‚è½½çš„æ–¹å¼ï¼Œä½¿å®¹å™¨è·å¾—æ­£ç¡®çš„èµ„æºä¿¡æ¯\n- Kata\n\t- VMä¸­è·‘container\n- Virtlet\n\t- ç›´æ¥å¯åŠ¨ VM\n\n## å°†åº”ç”¨è¿ç§»è‡³Kubernetes\n\n### Pod spec\n\n- åˆå§‹åŒ–éœ€æ±‚ï¼ˆinit containerï¼‰\n- **éœ€è¦å‡ ä¸ªä¸» container**\n- æƒé™? Privilege å’Œ SecurityContextï¼ˆPSPï¼‰\n- **å…±äº«å“ªäº›Namespaceï¼ˆPIDï¼ŒIPCï¼ŒNETï¼ŒUTSï¼ŒMNTï¼‰**\n- é…ç½®ç®¡ç†\n- ä¼˜é›…ç»ˆæ­¢\n- å¥åº·æ£€æŸ¥\n\t- Liveness Probe\n\t- Readiness Probe\n- DNSç­–ç•¥ä»¥åŠå¯¹ resolv.conf çš„å½±å“\n- imagePullPolicy Image æ‹‰å–ç­–ç•¥\n\n### Probe è¯¯ç”¨ä¼šé€ æˆä¸¥é‡åæœ\n\n![image.png](Extras/Images/image_1667146432259_0.png)\n\n### å¦‚ä½•é˜²æ­¢ PIDæ³„éœ²\n\n- å•è¿›ç¨‹å®¹å™¨\n- **åˆç†çš„å¤„ç†å¤šè¿›ç¨‹å®¹å™¨**\n\t- å®¹å™¨çš„åˆå§‹åŒ–è¿›ç¨‹å¿…é¡»è´Ÿè´£æ¸…ç† fork å‡ºæ¥çš„æ‰€æœ‰å­è¿›ç¨‹\n\t- å¼€æºæ–¹æ¡ˆ\n\t\t- Tini https://github.com/krallin/tini\n\t\t- é‡‡ç”¨Tiniä½œä¸ºå®¹å™¨çš„åˆå§‹åŒ–è¿›ç¨‹ï¼ˆPID=1ï¼‰ï¼Œå®¹å™¨ä¸­åƒµå°¸è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ä¼šè¢«ç½®ä¸º1\n- **å¦‚æœä¸é‡‡ç”¨ç‰¹æ®Šåˆå§‹åŒ–è¿›ç¨‹**\n\t- å»ºè®®é‡‡ç”¨HTTPCheckä½œä¸ºProbe\n\t- ä¸ºexec Probe è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´\n\n![image.png](Extras/Images/image_1667146638863_0.png)\n\n### åœ¨ Kubernetes ä¸Šéƒ¨ç½²åº”ç”¨çš„æŒ‘æˆ˜\n\n**èµ„æºè§„åˆ’**\n\n- æ¯ä¸ªå®ä¾‹éœ€è¦å¤šå°‘è®¡ç®—èµ„æº\n\t- CPU/GPU?\n\t- Memory\n- è¶…å”®éœ€æ±‚\n- æ¯ä¸ªå®ä¾‹éœ€è¦å¤šå°‘å­˜å‚¨èµ„æº\n\t- å¤§å°\n\t- æœ¬åœ°è¿˜æ˜¯ç½‘ç›˜\n\t- è¯»å†™æ€§èƒ½\n\t- DiskIO\n- ç½‘ç»œéœ€æ±‚\n\t- æ•´ä¸ªåº”ç”¨æ€»ä½“ QPSå’Œå¸¦å®½\n\n### Pod çš„æ•°æ®ç®¡ç†\n\nlocal-ssdâˆ¶ç‹¬å çš„æœ¬åœ°ç£ç›˜ï¼Œç‹¬å IOï¼Œå›ºå®šå¤§å°ï¼Œè¯»å†™æ€§èƒ½é«˜ã€‚\n\nLocal-dynamicâˆ¶åŸºäºLVMï¼ŒåŠ¨æ€åˆ†é…ç©ºé—´ï¼Œæ•ˆç‡ä½ã€‚\n\n![image.png](Extras/Images/image_1667146864819_0.png)\n\n### æˆ‘çš„æ•°æ®åº”è¯¥ä¿å­˜åœ¨å“ªé‡Œ\n\n![image.png](Extras/Images/image_1667147111012_0.png)\n\n### åº”ç”¨é…ç½®\n\n**ä¼ å…¥æ–¹å¼**\n\n- Environment Variables\n- Volume Mount\n\n**æ•°æ®æ¥æº**\n\n- Configmap\n- Secret\n- Downward API\n\n### é«˜å¯ç”¨éƒ¨ç½²\n\n- éœ€è¦å¤šå°‘å®ä¾‹?\n- å¦‚ä½•æ§åˆ¶å¤±è´¥åŸŸï¼Œéƒ¨ç½²åœ¨å‡ ä¸ªåœ°åŒºï¼ŒAZï¼Œé›†ç¾¤?\n- å¦‚ä½•è¿›è¡Œç²¾ç»†çš„æµé‡æ§åˆ¶?\n- å¦‚ä½•åšæŒ‰åœ°åŸŸçš„é¡ºåºæ›´æ–°?\n- å¦‚ä½•å›æ»š?\n\n### å¦‚ä½•åº”å¯¹åŸºç¡€æ¶æ„çš„å½±å“\n\n![image.png](Extras/Images/image_1667147403099_0.png)\n\n### PodDisruptionBudget\n\nPDBæ˜¯ä¸ºäº†è‡ªä¸»ä¸­æ–­æ—¶ä¿éšœåº”ç”¨çš„é«˜å¯ç”¨ã€‚\n\nåœ¨ä½¿ç”¨ PDB æ—¶ï¼Œä½ éœ€è¦å¼„æ¸…æ¥šä½ çš„åº”ç”¨ç±»å‹ä»¥åŠä½ æƒ³è¦çš„åº”å¯¹æªæ–½ï¼š\n\n**æ— çŠ¶æ€åº”ç”¨ï¼š**\n\n- ç›®æ ‡ï¼šè‡³å°‘æœ‰60%å‰¯æœ¬ Availableã€‚\n- æ–¹æ¡ˆï¼šåˆ›å»º PDB Objectï¼ŒæŒ‡å®š minAvailableä¸º60%æˆ–è€…maxUnavailableä¸º40%\n\n**å•å®ä¾‹çš„æœ‰çŠ¶æ€åº”ç”¨âˆ¶**\n\n- ç›®æ ‡ï¼šç»ˆæ­¢è¿™ä¸ªå®ä¾‹ä¹‹å‰å¿…é¡»æå‰é€šçŸ¥å®¢æˆ·å¹¶å–å¾—åŒæ„ã€‚\n- æ–¹æ¡ˆï¼šåˆ›å»º PDB Objectï¼Œå¹¶è®¾ç½® maxUnavailableä¸º0ã€‚\n\n**å¤šå®ä¾‹çš„æœ‰çŠ¶æ€åº”ç”¨ï¼š**\n\n- ç›®æ ‡æœ€å°‘å¯ç”¨çš„å®ä¾‹æ•°ä¸èƒ½å°‘äºæŸä¸ªæ•°Nï¼Œä¾‹å¦‚ etcdã€‚\n- æ–¹æ¡ˆï¼šè®¾ç½® maxUnavailable=1æˆ–è€…minAvailable=Nï¼Œåˆ†åˆ«å…è®¸æ¯æ¬¡åªåˆ é™¤ä¸€ä¸ªå®ä¾‹å’Œæ¯æ¬¡åˆ é™¤ expected replicas-minAvailableä¸ªå®ä¾‹ã€‚\n\n### åŸºç¡€æ¶æ„ä¸åº”ç”¨å›¢é˜Ÿçš„çº¦æŸ\n\n**åŸºç¡€æ¶æ„å›¢é˜Ÿ**åœ¨ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œåº”éµå¾ªå¦‚ä¸‹æµç¨‹\n\nå°†nodeç½®ä¸ºä¸å¯è°ƒåº¦\n\n`kubectl cordon \u003cnode name\u003e`\n\næ‰§è¡Œnode drainæ’ç©ºèŠ‚ç‚¹ï¼Œå°†å…¶ä¸Šè¿è¡Œçš„\n\n`Podå¹³æ»‘è¿ç§»è‡³å…¶ä»–èŠ‚ç‚¹kubectl drain \u003cnode name\u003e`\n\n**åº”ç”¨å¼€å‘äººå‘˜**é’ˆå¯¹æ•æ„Ÿåº”ç”¨ï¼Œå¯å®šä¹‰PDBæ¥ç¡®ä¿åº”ç”¨ä¸ä¼šè¢«æ„å¤–ä¸­æ–­\n\n```yaml\napiVersion: policy/v1betal\nkind: PodDisruptionBudget\nmetadata:\n  name: zk-pdb\nspec:\n  minAvailable: 2\n  selector:\n    matchLabels:\n      app: zookeeper\n```\n\n### éƒ¨ç½²æ–¹å¼\n\n- å¤šå°‘å®ä¾‹\n- æ›´æ–°ç­–ç•¥\n\t- MaxSurge\n\t- MaxUnavailableï¼ˆéœ€è¦è€ƒè™‘ResourceQuota çš„é™åˆ¶ï¼‰\n- æ·±å…¥ç†è§£ PodTemplateHash å¯¼è‡´çš„åº”ç”¨çš„æ˜“å˜æ€§\n\n### æœåŠ¡å‘å¸ƒ\n\n- éœ€è¦æŠŠæœåŠ¡å‘å¸ƒè‡³é›†ç¾¤å†…éƒ¨æˆ–è€…å¤–éƒ¨ï¼ŒæœåŠ¡çš„ä¸åŒç±»å‹ï¼š\n\t- ClusterIP(Headless)\n\t- NodePort\n\t- LoadBalancer\n\t- ExternalName\n- è¯ä¹¦ç®¡ç†å’Œä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„éœ€æ±‚\n- éœ€è¦ gRPCè´Ÿè½½å‡è¡¡å¦‚ä½•åš?\n- DNS éœ€æ±‚\n- ä¸ä¸Šä¸‹æ¸¸æœåŠ¡çš„å…³ç³»\n\n### æœåŠ¡å‘å¸ƒçš„æŒ‘æˆ˜\n\n- **kube-dns**\n\t- DNS TTL é—®é¢˜\n- **Service**\n\t- ClusterIP åªèƒ½å¯¹å†…\n\t- Kube-proxy æ”¯æŒçš„ iptables/ipvsè§„æ¨¡æœ‰é™\n\t- IPVSçš„æ€§èƒ½å’Œç”Ÿäº§åŒ–é—®é¢˜\n\t- kube-proxy çš„ drift é—®é¢˜\n\t- é¢‘ç¹çš„ Podå˜åŠ¨ï¼ˆspecchangeï¼Œfailoverï¼ŒcrashLoopï¼‰å¯¼è‡´LBé¢‘ç¹å˜æ›´\n\t- å¯¹å¤–å‘å¸ƒçš„ Serviceéœ€è¦ä¸ä¼ä¸š ELBå³æˆ\n\t- ä¸æ”¯æŒgRPC\n\t- ä¸æ”¯æŒè‡ªå®šä¹‰ DNSå’Œé«˜çº§è·¯ç”±åŠŸèƒ½\n- **Ingress**\n\t- Specè¦ deprecate\n- **å…¶ä»–å¯é€‰æ–¹æ¡ˆ?**\n\n### æ— çŠ¶æ€åº”ç”¨ç®¡ç†\n\n- Replicasetå‰¯æœ¬é›†\n\t- ç”¨ä»€ä¹ˆPodæ¨¡ç‰ˆåˆ›å»ºå¤šå°‘ä¸ªå®ä¾‹ã€‚\n\t- replicas: 2\n- Deployment\n\t- æè¿°çš„æ˜¯éƒ¨ç½²è¿‡ç¨‹\n \nç‰ˆæœ¬ç®¡ç†\n\n```yaml\nannotations:\n  deployment.kubernetes.io/revision: \"1\"\nspec:\n  revisionHistoryLimit: 10\n```\n\næ»šåŠ¨å‡çº§ç­–ç•¥\n\n```yaml\nstrategy:\n  rollingUpdate:\n  \tmaxSurge: 25%\n    maxUnavailable: 1\n  type: RollingUpdate\n```\n\n### æœ‰çŠ¶æ€åº”ç”¨ç®¡ç†\n\n**Statefulset**\n\nä¸ deploymentç›¸æ¯”ï¼Œå¤šäº†\n\n`serviceName: nginx-ss`\n\n**Volume claim template**\n\n```yaml\nvolumeClaimTemplates:\n  metadata:\n    creationTimestamp: null\n    name: www\n  spec:\n    accessModes:\n\nReadWriteOnce\n  resources:\n    requests:\n      storage: 1Gi\n    volumeMode: Filesystem\n```\n\n### æœ‰çŠ¶æ€åº”ç”¨-Operator\n\n**åˆ›å»º Operator çš„å…³é”®æ˜¯CRDï¼ˆè‡ªå®šä¹‰èµ„æºï¼‰çš„è®¾è®¡ã€‚**\n\nKubernetes å¯¹è±¡æ˜¯å¯æ‰©å±•çš„ï¼Œæ‰©å±•çš„æ–¹å¼æœ‰\n\n- **åŸºäºåŸç”Ÿå¯¹è±¡**\n\t- ç”Ÿæˆ types å¯¹è±¡ï¼Œå¹¶é€šè¿‡client-goç”Ÿæˆç›¸åº”çš„clientsetï¼Œ listerï¼Œ informerã€‚\n\t- å®ç°å¯¹è±¡çš„registerybackendï¼Œå³å®šä¹‰å¯¹è±¡ä»»ä½•å­˜å‚¨è¿›etcdã€‚\n\t- æ³¨å†Œå¯¹è±¡çš„schemeè‡³apiserverã€‚\n\t- åˆ›å»ºè¯¥å¯¹è±¡çš„ apiservice ç”Ÿå‘½ï¼Œæ³¨å†Œè¯¥å¯¹è±¡æ‰€å¯¹åº”çš„api handlerã€‚\n\t- **åŸºäºåŸç”Ÿå¯¹è±¡å¾€å¾€éœ€è¦é€šè¿‡ aggregation apiserver æŠŠä¸åŒå¯¹è±¡ç»„åˆèµ·æ¥ã€‚**\n- **åŸºäºCRD**\n\t- åœ¨ä¸åŒåº”ç”¨ä¸šåŠ¡ç¯å¢ƒä¸‹ï¼Œå¯¹äºå¹³å°å¯èƒ½æœ‰ä¸€äº›ç‰¹æ®Šçš„éœ€æ±‚ï¼Œè¿™äº›éœ€æ±‚å¯ä»¥æŠ½è±¡ä¸ºKubernetesçš„æ‰©å±•èµ„æºï¼Œè€ŒKubernetesçš„CRDï¼ˆCustomResourceDefinitionï¼‰ä¸ºè¿™æ ·çš„éœ€æ±‚æä¾›äº†è½»é‡çº§çš„æœºåˆ¶ï¼Œä¿è¯æ–°çš„èµ„æºçš„å¿«é€Ÿæ³¨å†Œå’Œä½¿ç”¨ã€‚\n\t- åœ¨æ›´è€çš„ç‰ˆæœ¬ä¸­ï¼ŒTPRï¼ˆThirdPartyResourceï¼‰æ˜¯ä¸CRDç±»ä¼¼çš„æ¦‚å¿µï¼Œä½†æ˜¯åœ¨1.9ä»¥ä¸Šçš„ç‰ˆæœ¬ä¸­è¢«å¼ƒç”¨ï¼Œè€ŒCRDåˆ™è¿›å…¥çš„betaçŠ¶æ€ã€‚\n\n### å¦‚ä½•ä½¿ç”¨CRD\n\nç”¨æˆ·å‘Kubernetes APIæœåŠ¡æ³¨å†Œä¸€ä¸ªå¸¦ç‰¹å®š schema çš„èµ„æºï¼Œå¹¶å®šä¹‰ç›¸å…³ API\n\n- æ³¨å†Œä¸€ç³»åˆ—è¯¥èµ„æºçš„å®ä¾‹\n- åœ¨ Kubernetes çš„å…¶å®ƒèµ„æºå¯¹è±¡ä¸­å¼•ç”¨è¿™ä¸ªæ–°æ³¨å†Œèµ„æºçš„å¯¹è±¡å®ä¾‹\n- ç”¨æˆ·è‡ªå®šä¹‰çš„controllerä¾‹ç¨‹éœ€è¦å¯¹è¿™ä¸ªå¼•ç”¨è¿›è¡Œé‡Šä¹‰å’Œå®æ–½ï¼Œè®©æ–°çš„èµ„æºå¯¹è±¡è¾¾åˆ°é¢„æœŸçš„çŠ¶æ€\n\n### åŸºäºCRDçš„å¼€å‘è¿‡ç¨‹\n\n**å€ŸåŠ©Kubernetes RBACå’Œ authenticationæœºåˆ¶æ¥ä¿è¯è¯¥æ‰©å±•èµ„æºçš„ securityã€access controlã€authentication å’Œ multitenancyã€‚**\n\nå°†æ‰©å±•èµ„æºçš„æ•°æ®å­˜å‚¨åˆ°Kubernetes çš„ etcd é›†ç¾¤ã€‚\n\nå€ŸåŠ©Kubernetesæä¾›çš„controlleræ¨¡å¼å¼€å‘æ¡†æ¶ï¼Œå®ç°æ–°çš„ controllerï¼Œå¹¶å€ŸåŠ© APIServer ç›‘å¬etcd é›†ç¾¤å…³äºè¯¥èµ„æºçš„çŠ¶æ€å¹¶å®šä¹‰çŠ¶æ€å˜åŒ–çš„å¤„ç†é€»è¾‘ã€‚\n\nè¯¥åŠŸèƒ½å¯ä»¥è®©å¼€å‘äººå‘˜æ‰©å±•æ·»åŠ æ–°åŠŸèƒ½ï¼Œæ›´æ–°ç°æœ‰çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨æ‰§è¡Œä¸€äº›ç®¡ç†ä»»åŠ¡ï¼Œè¿™äº›è‡ªå®šä¹‰çš„æ§åˆ¶å™¨å°±åƒKubernetesåŸç”Ÿçš„ç»„ä»¶ä¸€æ ·ï¼ŒOperator ç›´æ¥ä½¿ç”¨Kubernetes APIè¿›è¡Œå¼€å‘ï¼Œä¹Ÿå°±æ˜¯è¯´**ä»–ä»¬å¯ä»¥æ ¹æ®è¿™äº›æ§åˆ¶å™¨å†…éƒ¨ç¼–å†™çš„è‡ªå®šä¹‰è§„åˆ™æ¥ç›‘æ§é›†ç¾¤ã€æ›´æ”¹ Pods/Servicesã€å¯¹æ­£åœ¨è¿è¡Œçš„åº”ç”¨è¿›è¡Œæ‰©ç¼©å®¹ã€‚**\n\n### æ§åˆ¶å™¨æ¨¡å¼\n\n![image.png](Extras/Images/image_1667153037444_0.png)\n\n## æœ‰çŠ¶æ€åº”ç”¨çš„å¤æ‚æ€§è®¨è®º\n\n### æœ‰çŠ¶æ€åº”ç”¨éƒ¨ç½²ç¤ºä¾‹-mysqL\n\n**1. é«˜å¯ç”¨éƒ¨ç½²**\n\n- æ„å»º Galara clusterï¼Œæä¾›å¤šæ´»é«˜å¯ç”¨ mysqlé›†ç¾¤\n- å¤šå®ä¾‹è·¨é›†ç¾¤/è·¨æœºæ¶/è·¨ä¸»æœº\n\n**2. æŒä¹…åŒ–å­˜å‚¨**\n\n- éœ€è¦ä¸ºæ¯ä¸ªPod åˆ›å»º PVCå¹¶ mount\n- è¯»å†™æ€§èƒ½ä¿è¯\n- local dynamicä½œä¸ºæ•°æ®ç›˜ï¼Œcephfs ä½œä¸ºå¤‡ä»½ç›˜\n\n**3. æœ‰çŠ¶æ€åº”ç”¨çš„å¤æ‚é…ç½®**\n\n- ä¸æ— çŠ¶æ€åº”ç”¨ä¸ä¸€æ ·ï¼Œmysql éœ€è¦å¤æ‚é…ç½®ä»¥å®Œæˆ galaraé›†ç¾¤çš„æ„å»º/etc/mysql/conf.d/galera.c\n\n### å¯åŠ¨é¡ºåº\n\n- **åœ¨PrimaryComponentèŠ‚ç‚¹ä¸Šè¿è¡Œ**\n\t- mysqld_bootstrap\n- **åœ¨å…¶ä»–èŠ‚ç‚¹ä¸Šè¿è¡Œ**\n\t- systemctl start mysql\n- **å‘ç”Ÿäº†ä»€ä¹ˆ**\n\t- å½“èŠ‚ç‚¹ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨ç”ŸæˆUUIDä»¥ä»£è¡¨å½“å‰èŠ‚ç‚¹èº«ä»½\n\t- å¯åŠ¨åï¼Œgaralaä¼šåœ¨æ•°æ®ç›®å½•ç”Ÿæˆgvwstate.datæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å†…å®¹è®°å½•Primary Component çš„UUIDä»¥åŠè¿æ¥åˆ°å½“å‰Primary Componentçš„èŠ‚ç‚¹çš„UUID\n\t- å¦‚æœPrimary Componentå‡ºç°æ•…éšœï¼Œåˆ™å‰©ä½™èŠ‚ç‚¹ä¼šé‡æ–°é€‰æ‹©æ–°çš„Primary Component\n\t- è‹¥è¯¥æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™æ— éœ€é¢å¤–æ‰§è¡Œbootstrapå‘½ä»¤å¯åŠ¨PrimaryCompontï¼Œå¯ä¾æ­¤è§„åˆ™ç¼–å†™Operatoråœ¨å¤šä¸ªèŠ‚ç‚¹æ„å»ºæ­¤æ–‡ä»¶\n\n### å¥åº·æ£€æŸ¥\n\n- **mysql æä¾›å¥åº·æ£€æŸ¥ API**\n\t- æ£€æŸ¥é›†ç¾¤æˆå‘˜æ˜¯å¦èƒ½æ¥å—æŸ¥è¯¢è¯·æ±‚\n\t\t- SHOW GLOBAL STATUS LIKE 'wsrep_ready';\n\t- æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦ä¸å…¶ä»–èŠ‚ç‚¹ç½‘ç»œäº’é€š\n\t\t- SHOW GLOBAL STATUS LIKE 'wsrep connected';\n\t- æ£€æŸ¥èŠ‚ç‚¹è‡ªåœºæ¬¡æŸ¥è¯¢ç»“æŸåæ¥æ”¶åˆ°çš„æŸ¥è¯¢è¯·æ±‚æ•°é‡ï¼Œå¦‚æœç»“æœä¸ºé0ï¼Œæ„å‘³ç€å†™è¯·æ±‚ä¸èƒ½ç«‹å³å¤„ç†\n\t\t- SHOW STATUS LIKE 'wsrep_local_recv_queue_avg';\n- **å¥åº·æ£€æŸ¥åº”è¯¥å½±å“ Pod çš„readiness probeï¼Œåœ¨è¿›è¡Œç‰ˆæœ¬å‡çº§æ—¶ï¼Œç¡®ä¿å¤§å¤šæ•°é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€ä¸€è‡´ã€‚**\n\n### æ•°æ®å¤‡ä»½\n\n- **æ¨èä¸º mysql åˆ›å»ºä¸åŒç±»å‹çš„ volume**\n\t- Local volume ç”¨æ¥åšæ•°æ®ç›˜\n\t- Network volume ç”¨æ¥åšæ•°æ®å¤‡ä»½\n- **åˆ›å»º cronjobï¼Œæ¯å¤©å°†æ•°æ®å¤‡ä»½è‡³backupç›®å½•**\n\t- å¤‡ä»½æ–‡ä»¶ä¸º\n- **ä¸€é”®æ¢å¤èƒ½åŠ›**\n\t- å¯¼å…¥å¤‡ä»½ç›®å½•çš„ sql file\n\n### ç‰ˆæœ¬å‘å¸ƒå’Œæ•…éšœè½¬ç§»\n\né’ˆå¯¹é…ç½®äº†Local diskçš„ Podï¼Œ**å½“å‘ç”Ÿå› ç‰ˆæœ¬å˜æ›´è€Œå¼•å‘çš„Pod é‡å»ºæ—¶**ï¼Œæ–°Podåœ¨è¿›è¡Œè°ƒåº¦æ—¶ï¼Œè°ƒåº¦å™¨ä¼šæŸ¥è¯¢ Pod æŒ‚è½½çš„volume æ‰€åœ¨èŠ‚ç‚¹ï¼Œå¹¶å°†æ–° Pod ä¼˜å…ˆè°ƒåº¦è‡³è¯¥èŠ‚ç‚¹ï¼Œæ­¤åœºæ™¯ä¸æ¶‰åŠåˆ°æ•°æ®æ¢å¤ã€‚\n\nå…¶å¼€é”€ä¸ mysqlè¿›ç¨‹é‡å¯ç›¸å·®ä¸å¤§ã€‚\n\n---\n\n**å¦‚æœèŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œå¦‚ç¡¬ä»¶æ•…éšœï¼ŒKubernetes çš„Evict Manager ä¼šå°†è¯¥Podä»æ•…éšœèŠ‚ç‚¹é©±é€ï¼ŒOperator åº”ç¡®ä¿æ–° Pod ä¼šè¢«é‡æ–°æ„å»ºã€‚** è€Œæ–° Podä¼šè¢«è°ƒåº¦è‡³æ–°èŠ‚ç‚¹ï¼Œæ­¤åœºæ™¯ç­‰ä»·äºæ›¿æ¢mysqlä¸­çš„å°‘æ•°èŠ‚ç‚¹ã€‚\n\ngalara é›†ç¾¤ä¸­çš„å°‘æ•° mysqlèŠ‚ç‚¹æ›¿æ¢ï¼Œä¸æ¶‰åŠåˆ°æ•°æ®è¿ç§»ï¼Œgalara ä¼šç¡®ä¿æ–°èŠ‚ç‚¹çš„æ•°æ®åŒæ­¥\n\n**è‹¥æ•´ä¸ªmysql é›†ç¾¤éœ€è¦åšæ•°æ®æ¢å¤ï¼Œåˆ™åº”è¯¥ä»backup ç›®å½•å¯¹åº”çš„ç½‘ç»œ volumeæ¢å¤æ•°æ®ã€‚** æ­¤æ—¶\n\n- å¯é€‰æ‹©ï¼š\n\t- åªæ¢å¤å•ä¸€èŠ‚ç‚¹æ•°æ®ï¼šé…ç½®ç®€å•\n\t- æ¢å¤æ‰€æœ‰èŠ‚ç‚¹æ•°æ®ï¼šæ¢å¤é€Ÿåº¦å¿«\n- ä¸åŸºç¡€æ¶æ„çš„Contract\n\t- PodDisruptionBudget\n\n# Specç®¡ç†ç¥å™¨-Helm\n\n## ä»€ä¹ˆæ˜¯Helm\n\n**Helm ç‰¹æ€§**\n\n- Helm chartæ˜¯åˆ›å»ºä¸€ä¸ªåº”ç”¨å®ä¾‹çš„å¿…è¦çš„é…ç½®ç»„ï¼Œä¹Ÿå°±æ˜¯ä¸€å † Specã€‚\n- é…ç½®ä¿¡æ¯è¢«å½’ç±»ä¸ºæ¨¡ç‰ˆï¼ˆTemplateï¼‰å’Œå€¼ï¼ˆValueï¼‰ï¼Œè¿™äº›ä¿¡æ¯ç»è¿‡æ¸²æŸ“ç”Ÿæˆæœ€ç»ˆçš„å¯¹è±¡ã€‚\n- æ‰€æœ‰é…ç½®å¯ä»¥è¢«æ‰“åŒ…è¿›ä¸€ä¸ªå¯ä»¥å‘å¸ƒçš„å¯¹è±¡ä¸­ã€‚\n- ä¸€ä¸ªrelease å°±æ˜¯ä¸€ä¸ªæœ‰ç‰¹å®šé…ç½®çš„chart çš„å®ä¾‹ã€‚\n\n## Helm çš„ç»„ä»¶\n\n**Helm client**\n\n- æœ¬åœ°chartå¼€å‘\n- ç®¡ç† repository\n- ç®¡ç† release\n- ä¸helm libraryäº¤äº’\n- å‘é€éœ€è¦å®‰è£…çš„chart\n- è¯·æ±‚å‡çº§æˆ–ç€å¸è½½å­˜åœ¨çš„ release\n\n**Helm library**\n\n- è´Ÿè´£ä¸ APIserveräº¤äº’ï¼Œå¹¶æä¾›ä»¥ä¸‹åŠŸèƒ½\n\t- åŸºäºchartå’Œ configuration åˆ›å»ºä¸€ä¸ªrelease\n\t- æŠŠ chartå®‰è£…è¿›kubernetesï¼Œå¹¶æä¾›ç›¸åº”çš„ release å¯¹è±¡\n\t- å‡çº§å’Œå¸è½½\n\t- Helm é‡‡ç”¨Kuberneteså­˜å‚¨æ‰€æœ‰é…ç½®ä¿¡æ¯ï¼Œæ— éœ€è‡ªå·±çš„æ•°æ®åº“\n\n# metrics-server\n\n## Aggregated APIServer\n\n![image.png](Extras/Images/image_1667209374158_0.png)\n\n## Metrics-Server\n\n**metrics-server æ˜¯Kubernetes ç›‘æ§ä½“ç³»ä¸­çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€**ï¼Œå®ƒè´Ÿè´£ä»kubelet æ”¶é›†èµ„æºæŒ‡æ ‡ï¼Œç„¶åå¯¹è¿™äº›æŒ‡æ ‡ç›‘æ§æ•°æ®è¿›è¡Œèšåˆï¼ˆä¾èµ–kube-aggregatorï¼‰ï¼Œå¹¶åœ¨Kubernetes Apiserverä¸­é€šè¿‡ MetricS API/apis/metrics.k8s.io/ï¼‰å…¬å¼€æš´éœ²å®ƒä»¬ï¼Œä½†æ˜¯ **metrics-serveråªå­˜å‚¨æœ€æ–°çš„æŒ‡æ ‡æ•°æ®ï¼ˆCPU/Memoryï¼‰**ã€‚\n\nä½ çš„ kube-apiserverè¦èƒ½è®¿é—®åˆ°metrics-server;\n\néœ€è¦kube-apiserverå¯ç”¨èšåˆå±‚;\n\nç»„ä»¶è¦æœ‰è®¤è¯é…ç½®å¹¶ä¸”ç»‘å®šåˆ° metrics-server;\n\nPod / Node æŒ‡æ ‡éœ€è¦ç”± Summary APIé€šè¿‡ kubeletå…¬å¼€ã€‚\n\n![image.png](Extras/Images/image_1667212041763_0.png)\n\n# è‡ªåŠ¨æ‰©å®¹ç¼©å®¹-HPA\n\n## æ¨ªå‘ä¼¸ç¼©å’Œçºµå‘ä¼¸ç¼©\n\n- **åº”ç”¨æ‰©å®¹æ˜¯æŒ‡åœ¨åº”ç”¨æ¥æ”¶åˆ°çš„å¹¶å‘è¯·æ±‚å·²ç»å¤„äºå…¶å¤„ç†è¯·æ±‚æé™è¾¹ç•Œçš„æƒ…å½¢ä¸‹ï¼Œæ‰©å±•å¤„ç†èƒ½åŠ›è€Œç¡®ä¿åº”ç”¨é«˜å¯ç”¨çš„æŠ€æœ¯æ‰‹æ®µ**\n- Horizontal Scaling\n\t- æ‰€è°“æ¨ªå‘ä¼¸ç¼©æ˜¯æŒ‡é€šè¿‡å¢åŠ åº”ç”¨å®ä¾‹æ•°é‡åˆ†æ‹…è´Ÿè½½çš„æ–¹å¼æ¥æå‡åº”ç”¨æ•´ä½“å¤„ç†èƒ½åŠ›çš„æ–¹å¼\n- Vertical Scaling\n\t- æ‰€è°“çºµå‘ä¼¸ç¼©æ˜¯æŒ‡é€šè¿‡å¢åŠ å•ä¸ªåº”ç”¨å®ä¾‹èµ„æºä»¥æå‡å•ä¸ªå®ä¾‹å¤„ç†èƒ½åŠ›ï¼Œè¿›è€Œæå‡åº”ç”¨æ•´ä½“å¤„ç†èƒ½åŠ›çš„æ–¹å¼\n\n![image.png](Extras/Images/image_1667212325432_0.png)\n\n## ç†è§£äº‘åŸç”Ÿçš„å¼¹æ€§èƒ½åŠ›\n\n![image.png](Extras/Images/image_1667212517047_0.png)\n\n## HPA\n\n**HPAï¼ˆHorizontal Pod Autoscalerï¼‰æ˜¯Kubernetes çš„ä¸€ç§èµ„æºå¯¹è±¡**ï¼Œèƒ½å¤Ÿæ ¹æ®æŸäº›æŒ‡æ ‡å¯¹åœ¨ statefulSetã€replicaSetã€deployment ç­‰é›†åˆä¸­çš„ Pod æ•°é‡è¿›è¡Œæ¨ªå‘åŠ¨æ€ä¼¸ç¼©ï¼Œä½¿è¿è¡Œåœ¨ä¸Šé¢çš„æœåŠ¡å¯¹æŒ‡æ ‡çš„å˜åŒ–æœ‰ä¸€å®šçš„è‡ªé€‚åº”èƒ½åŠ›ã€‚\n\nå› èŠ‚ç‚¹è®¡ç®—èµ„æºå›ºå®šï¼Œå½“ Pod è°ƒåº¦å®Œæˆå¹¶è¿è¡Œä»¥åï¼ŒåŠ¨æ€è°ƒæ•´è®¡ç®—èµ„æºå˜å¾—è¾ƒä¸ºå›°éš¾ï¼Œå› ä¸ºæ¨ªå‘æ‰©å±•å…·æœ‰æ›´å¤§ä¼˜åŠ¿ï¼ŒHPAæ˜¯æ‰©å±•åº”ç”¨èƒ½åŠ›çš„ç¬¬ä¸€é€‰æ‹©ã€‚è§„åˆ™ã€‚\n\nHPAä¾èµ–äºMetrics-Serverã€‚\n\n## HPA Spec\n\n```yaml\napiVersion: autoscaling/v2beta2\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: mynginx\nspec:\n  #HPAçš„ä¼¸ç¼©å¯¹è±¡æè¿°ï¼ŒHPAä¼šåŠ¨æ€ä¿®æ”¹è¯¥å¯¹è±¡çš„Podæ•°é‡\n  scaleTargetRef:\n    apiVersion: apps/v1\n    kind: Deployment\n    name: mynginx\n  # HPA çš„æœ€å° Pod æ•°é‡å’Œæœ€å¤§ Podæ•°é‡\n  minReplicas: 1\n  maxReplicas: 3\n#ç›‘æ§çš„æŒ‡æ ‡æ•°ç»„ï¼Œæ”¯æŒå¤šç§ç±»å‹çš„æŒ‡æ ‡å…±å­˜\nmetric:\n```\n\n## HPA æ”¯æŒçš„æŒ‡æ ‡ç±»å‹\n\nå¯¹äºæŒ‰ Podç»Ÿè®¡çš„èµ„æºæŒ‡æ ‡ï¼ˆå¦‚ CPUï¼‰ï¼Œæ§åˆ¶å™¨ä»èµ„æºæŒ‡æ ‡ APIä¸­è·å–æ¯ä¸€ä¸ª**HorizontalPodAutoscaleræŒ‡å®šçš„ Pod çš„åº¦é‡å€¼**ï¼Œå¦‚æœè®¾ç½®äº†ç›®æ ‡ä½¿ç”¨ç‡ï¼Œæ§åˆ¶å™¨è·å–æ¯ä¸ªPod ä¸­çš„å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µï¼Œå¹¶è®¡ç®—èµ„æºä½¿ç”¨ç‡ã€‚ å¦‚æœè®¾ç½®äº†target å€¼ï¼Œå°†ç›´æ¥ä½¿ç”¨åŸå§‹æ•°æ®ï¼ˆä¸å†è®¡ç®—ç™¾åˆ†æ¯”ï¼‰ã€‚\n\nå¦‚æœ Podä½¿ç”¨è‡ªå®šä¹‰æŒ‡ç¤ºï¼Œæ§åˆ¶å™¨æœºåˆ¶ä¸èµ„æºæŒ‡æ ‡ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºè‡ªå®šä¹‰æŒ‡æ ‡åªä½¿ç”¨åŸå§‹å€¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç‡ã€‚\n\nå¦‚æœ Podä½¿ç”¨å¯¹è±¡æŒ‡æ ‡å’Œå¤–éƒ¨æŒ‡æ ‡ï¼ˆæ¯ä¸ªæŒ‡æ ‡æè¿°ä¸€ä¸ªå¯¹è±¡ä¿¡æ¯ï¼‰ã€‚ è¿™ä¸ªæŒ‡æ ‡å°†ç›´æ¥æ ¹æ®ç›®æ ‡è®¾å®šå€¼ç›¸æ¯”è¾ƒï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªä¸Šé¢æåˆ°çš„æ‰©ç¼©æ¯”ä¾‹ã€‚**åœ¨ autoscaling/v2beta2ç‰ˆæœ¬ APIä¸­ï¼Œè¿™ä¸ªæŒ‡æ ‡ä¹Ÿå¯ä»¥æ ¹æ® Podæ•°é‡å¹³åˆ†åå†è®¡ç®—ã€‚**\n\n## HPAæŒ‡æ ‡\n\n```yaml\n#Resourceç±»å‹çš„æŒ‡æ ‡\n- type: Resource\n  resource:\n    name: cpu\n    #Utilizationç±»å‹çš„ç›®æ ‡å€¼ï¼ŒResourceç±»å‹çš„æŒ‡æ ‡åªæ”¯æŒUtilizationå’ŒAverageValueç±»å‹çš„ç›®æ ‡å€¼\n    target:\n      type: Utilization\n      averageUtilization: 50\n \n#Podsç±»å‹çš„æŒ‡æ ‡\n- type: Pods\n  pods:\n    metric:\n      name: packets-per-second\n      #AverageValueç±»å‹çš„ç›®æ ‡å€¼ï¼ŒPodsæŒ‡æ ‡ç±»å‹ä¸‹åªæ”¯æŒAverageValueç±»å‹çš„ç›®æ ‡å€¼\n      target:\n        type: AverageValue\n        averageValue: 1k\n```\n\n## ç®—æ³•ç»†èŠ‚\n\nHPAç®—æ³•éå¸¸ç®€å•\n\n**æœŸæœ›å‰¯æœ¬æ•°=ceil\\[å½“å‰å‰¯æœ¬æ•°*(å½“å‰æŒ‡æ ‡/æœŸæœ›æŒ‡æ ‡)\\]**\n\nå½“å‰åº¦é‡å€¼ä¸º 200mï¼Œç›®æ ‡è®¾å®šå€¼ä¸º100mï¼Œé‚£ä¹ˆç”±äº200.0/100.0 == 2.0ï¼Œå‰¯æœ¬æ•°é‡å°†ä¼šç¿»å€ã€‚å¦‚æœå½“å‰æŒ‡æ ‡ä¸º50mï¼Œå‰¯æœ¬æ•°é‡å°†ä¼šæ´åŠï¼Œå› ä¸º 50.0/100.0== 0.5ã€‚å¦‚æœè®¡ç®—å‡ºçš„æ‰©ç¼©ä¸Šä¾‹æ¥è¿‘ 1.0ï¼ˆæ ¹æ®--horizontal-pod-autoscaler-toleranceå‚æ•°å…¨å±€é…ç½®çš„å®¹å¿å€¼ï¼Œé»˜è®¤ä¸º 0.1ï¼‰ï¼Œå°†ä¼šæ”¾å¼ƒæœ¬æ¬¡æ‰©ç¼©ã€‚\n\n## æ»šåŠ¨å‡çº§æ—¶æ‰©ç¼©\n\n- å½“ä½ ä¸ºä¸€ä¸ªDeployment é…ç½®è‡ªåŠ¨æ‰©ç¼©æ—¶ï¼Œä½ è¦ä¸ºæ¯ä¸ª Deployment ç»‘å®šä¸€ä¸ªHorizontalPodAutoscalerã€‚\n- HorizontalPodAutoscaler ç®¡ç† Deployment çš„ replicaså­—æ®µã€‚\n- Deployment Controller è´Ÿè´£è®¾ç½®ä¸‹å±‚ReplicaSet çš„ replicaså­—æ®µï¼Œä»¥ä¾¿ç¡®ä¿åœ¨ä¸Šçº¿åŠåç»­è¿‡ç¨‹å‰¯æœ¬ä¸ªæ•°åˆé€‚ã€‚\n- **æƒ³ä¸€æƒ³ï¼šä¸ºä»€ä¹ˆ deploymentSpecä¸­çš„ replicaså­—æ®µçš„ç±»å‹ä¸º\\*intï¼Œè€Œä¸æ˜¯int?**\n\n## å†·å´/å»¶è¿Ÿæ”¯æŒ\n\nå½“ä½¿ç”¨Horizontal Pod AutosCaler ç®¡ç†ä¸€ç»„å‰¯æœ¬æ‰©ç¼©æ—¶ï¼Œæœ‰å¯èƒ½å› ä¸ºæŒ‡æ ‡åŠ¨æ€çš„å˜åŒ–é€ æˆå‰¯æœ¬æ•°é‡é¢‘ç¹çš„å˜åŒ–ï¼Œæœ‰æ—¶è¿™è¢«ç§°ä¸º **æŠ–åŠ¨ï¼ˆThrashingï¼‰**ã€‚\n\n--horizontal-pod-autoscaler-downscale-stabilizationâˆ¶è®¾ç½®ç¼©å®¹å†·å´æ—¶é—´çª—å£é•¿åº¦ã€‚æ°´å¹³ Podæ‰©ç¼©å™¨èƒ½å¤Ÿè®°ä½è¿‡å»å»ºè®®çš„è´Ÿè½½è§„æ¨¡ï¼Œå¹¶ä»…å¯¹æ­¤æ—¶é—´çª—å£å†…çš„æœ€å¤§è§„æ¨¡æ‰§è¡Œæ“ä½œã€‚**é»˜è®¤å€¼æ˜¯5åˆ†é’Ÿï¼ˆ5m0sï¼‰ã€‚**\n\n## æ‰©ç¼©ç­–ç•¥\n\nåœ¨ Specå­—æ®µçš„ behavior éƒ¨åˆ†å¯ä»¥æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªæ‰©ç¼©ç­–ç•¥ã€‚ å½“æŒ‡å®šå¤šä¸ªç­–ç•¥æ—¶ï¼Œé»˜è®¤é€‰æ‹©å…è®¸æ›´æ”¹æœ€å¤šçš„ç­–ç•¥ã€‚ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ç¼©å®¹æ—¶çš„è¡Œä¸ºï¼š\n\n```yaml\nbehavior:\n  scaleDOown:\n    policies:\n    - type: Pods\n      value: 4\n      periodSeconds: 60\n    - type: Percent\n    value: 10\n    periodSeconds: 60\n```\n\n## HPA å­˜åœ¨çš„é—®é¢˜\n\n- åŸºäºæŒ‡æ ‡çš„å¼¹æ€§æœ‰æ»åæ•ˆåº”ï¼Œå› ä¸ºå¼¹æ€§æ§åˆ¶å™¨æ“ä½œçš„é“¾è·¯è¿‡é•¿ã€‚\n- ä»åº”ç”¨è´Ÿè½½è¶…å‡ºé˜ˆå€¼åˆ°HPAå®Œæˆæ‰©å®¹ä¹‹é—´çš„æ—¶é—´å·®åŒ…æ‹¬âˆ¶\n\t- åº”ç”¨æŒ‡æ ‡æ•°æ®å·²ç»è¶…å‡ºé˜ˆå€¼ï¼›\n\t- HPAå®šæœŸæ‰§è¡ŒæŒ‡æ ‡æ”¶é›†æ»åæ•ˆåº”ï¼›\n\t- HPAæ§åˆ¶ Deployment è¿›è¡Œæ‰©å®¹çš„æ—¶é—´ï¼›\n\t- Podè°ƒåº¦ï¼Œè¿è¡Œæ—¶å¯åŠ¨æŒ‚è½½å­˜å‚¨å’Œç½‘ç»œçš„æ—¶é—´ï¼›\n\t- åº”ç”¨å¯åŠ¨åˆ°æœåŠ¡å°±ç»ªçš„æ—¶é—´ã€‚\n- **å¾ˆå¯èƒ½åœ¨çªå‘æµé‡å‡ºç°æ—¶ï¼Œè¿˜æ²¡å®Œæˆå¼¹æ€§æ‰©å®¹ï¼Œæ—¢æœ‰çš„æœåŠ¡å®ä¾‹å·²ç»è¢«æµé‡å‡»å®ã€‚**\n\n# è‡ªåŠ¨æ‰©å®¹ç¼©å®¹-VPA\n\n## VPA\n\n**VPAå…¨ç§°Vertical Pod Autoscalerï¼Œå³å‚ç›´ Pod è‡ªåŠ¨æ‰©ç¼©å®¹**ï¼Œå®ƒæ ¹æ®å®¹å™¨èµ„æºä½¿ç”¨ç‡è‡ªåŠ¨è®¾ç½®CPU å’Œ å†…å­˜çš„ requestsï¼Œä»è€Œå…è®¸åœ¨èŠ‚ç‚¹ä¸Šè¿›è¡Œé€‚å½“çš„è°ƒåº¦ï¼Œä»¥ä¾¿ä¸ºæ¯ä¸ª Podæä¾›é€‚å½“çš„èµ„æºã€‚å®ƒæ—¢å¯ä»¥ç¼©å°è¿‡åº¦è¯·æ±‚èµ„æºçš„å®¹å™¨ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å…¶ä½¿ç”¨æƒ…å†µéšæ—¶æå‡èµ„æºä¸è¶³çš„å®¹é‡ã€‚\n\nä½¿ç”¨VPA çš„æ„ä¹‰ï¼š\n\n- Pod èµ„æºç”¨å…¶æ‰€éœ€ï¼Œæå‡é›†ç¾¤èŠ‚ç‚¹ä½¿ç”¨æ•ˆç‡ï¼›\n- ä¸å¿…è¿è¡ŒåŸºå‡†æµ‹è¯•ä»»åŠ¡æ¥ç¡®å®šCPU å’Œå†…å­˜è¯·æ±‚çš„åˆé€‚å€¼ï¼›\n- VPA å¯ä»¥éšæ—¶è°ƒæ•´CPUå’Œå†…å­˜è¯·æ±‚ï¼Œæ— éœ€äººä¸ºæ“ä½œï¼Œå› æ­¤å¯ä»¥å‡å°‘ç»´æŠ¤æ—¶é—´ã€‚\n\n**æ³¨æ„ï¼šVPA ç›®å‰è¿˜æ²¡æœ‰ç”Ÿäº§å°±ç»ªï¼Œåœ¨ä½¿ç”¨ä¹‹å‰éœ€è¦äº†è§£èµ„æºè°ƒèŠ‚å¯¹åº”ç”¨çš„å½±å“ã€‚**\n\n## VPAæ¶æ„å›¾\n\n![image.png](Extras/Images/image_1667218774861_0.png)\n\n## VPAç»„ä»¶\n\nVPA å¼•å…¥äº†ä¸€ç§æ–°å‹çš„ APIèµ„æºï¼š**VerticalPodAutoscaler**ã€‚\n\n**VPA Recommender**ç›‘è§†æ‰€æœ‰ Podï¼Œä¸æ–­ä¸ºå®ƒä»¬è®¡ç®—æ–°çš„æ¨èèµ„æºï¼Œå¹¶å°†æ¨èå€¼å­˜å‚¨åœ¨VPAå¯¹è±¡ä¸­ã€‚å®ƒä½¿ç”¨æ¥è‡ªMetrics-Server çš„é›†ç¾¤ä¸­æ‰€æœ‰ Pod çš„åˆ©ç”¨ç‡å’Œ OOMäº‹ä»¶ã€‚\n\næ‰€æœ‰ Pod åˆ›å»ºè¯·æ±‚éƒ½é€šè¿‡ **VPA Admission Controller**ã€‚\n\n**VPAUpdater** æ˜¯è´Ÿè´£ Pod å®æ—¶æ›´æ–°çš„ç»„ä»¶ã€‚å¦‚æœ Podåœ¨\"Auto\"æ¨¡å¼ä¸‹ä½¿ç”¨VPAï¼Œåˆ™Updater å¯ä»¥å†³å®šä½¿ç”¨æ¨èå™¨èµ„æºå¯¹å…¶è¿›è¡Œæ›´æ–°ã€‚\n\n**History Storage**æ˜¯ä¸€ä¸ªå­˜å‚¨ç»„ä»¶ï¼ˆå¦‚Prometheusï¼‰ï¼Œå®ƒä½¿ç”¨æ¥è‡ª API Server çš„åˆ©ç”¨ç‡ä¿¡æ¯å’Œ OOMï¼ˆä¸æ¨èå™¨ç›¸åŒçš„æ•°æ®ï¼‰å¹¶å°†å…¶æŒä¹…å­˜å‚¨ã€‚\n\nVPA æ›´æ–°æ¨¡å¼ï¼š\n- Off\n- Auto\n\n## VPA å·¥ä½œåŸç†\n\n![image.png](Extras/Images/image_1667218863362_0.png)\n\n## Recommender è®¾è®¡ç†å¿µ\n\n**æ¨èæ¨¡å‹ï¼ˆMVPï¼‰å‡è®¾å†…å­˜å’Œ CPUåˆ©ç”¨ç‡æ˜¯ç‹¬ç«‹çš„éšæœºå˜é‡ï¼Œå…¶åˆ†å¸ƒç­‰äºè¿‡å¤« N å¤©è§‚å¯Ÿåˆ°çš„å˜é‡ï¼ˆæ¨èå€¼ä¸ºN=8ä»¥æ•è·æ¯å‘¨å³°å€¼ï¼‰ã€‚**\n\nå¯¹äº CPUï¼Œç›®æ ‡æ˜¯å°†å®¹å™¨ä½¿ç”¨ç‡è¶…è¿‡è¯·æ±‚çš„é«˜ç™¾åˆ†æ¯”ï¼ˆä¾‹å¦‚ 95%ï¼‰çš„æ—¶é—´éƒ¨åˆ†ä¿æŒå­˜æŸä¸ªé˜ˆå€¼ï¼ˆä¾‹å¦‚1%çš„æ—¶é—´ï¼‰ä»¥ä¸‹ã€‚åœ¨æ­¤æ¨¡å‹ä¸­ï¼Œ**\"CPUä½¿ç”¨ç‡\"** è¢«å®šä¹‰ä¸ºåœ¨çŸ­æ—¶é—´é—´éš”å†…æµ‹é‡çš„å¹³å‡ä½¿ç”¨ç‡ã€‚æµ‹é‡é—´éš”è¶ŠçŸ­ï¼Œé’ˆå¯¹å°–å³°ã€å»¶è¿Ÿæ•æ„Ÿçš„å·¥ä½œè´Ÿè½½çš„å»ºè®®è´¨é‡å°±è¶Šé«˜ã€‚**æœ€å°åˆç†åˆ†è¾¨ç‡ä¸º1/minï¼Œæ¨èä¸º1/secã€‚**\n\nå¯¹äº**å†…å­˜**ï¼Œç›®æ ‡æ˜¯å°†ç‰¹å®šæ—¶é—´çª—å£å†…å®¹å™¨ä½¿ç”¨ç‡è¶…è¿‡è¯·æ±‚çš„æ¦‚ç‡ä¿æŒåœ¨æŸä¸ªé˜ˆå€¼ä»¥ä¸‹ï¼ˆä¾‹å¦‚ï¼Œ**24å°æ—¶å†…ä½äº1%**ï¼‰ã€‚**çª—å£å¿…é¡»å¾ˆé•¿ï¼ˆâ‰¥24 å°æ—¶ï¼‰** ä»¥ç¡®ä¿ç”±OOM å¼•èµ·çš„é©±é€ä¸ä¼šæ˜æ˜¾å½±å“ï¼ˆaï¼‰æœåŠ¡åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§ï¼ˆbï¼‰æ‰¹å¤„ç†è®¡ç®—çš„è¿›åº¦ï¼ˆæ›´é«˜çº§çš„æ¨¡å‹å¯ä»¥å…è®¸ç”¨æˆ·æŒ‡å®š SLOæ¥æ§åˆ¶å®ƒï¼‰ã€‚\n\n## ä¸»è¦æµç¨‹\n\n![image.png](Extras/Images/image_1667219529173_0.png)\n\n## æ»‘åŠ¨çª—å£ä¸åŠè¡°æŒ‡æ•°ç›´æ–¹å›¾\n\nRecommenderçš„èµ„æºæ¨èç®—æ³•ä¸»è¦å—Google AutoPilot moving window æ¨èå™¨çš„å¯å‘ï¼Œ**å‡è®¾CPUå’ŒMemoryæ¶ˆè€—æ˜¯ç‹¬ç«‹çš„éšæœºå˜é‡ï¼Œå…¶åˆ†å¸ƒç­‰äºè¿‡å»Nå¤©è§‚å¯Ÿåˆ°çš„å˜é‡åˆ†å¸ƒï¼ˆæ¨èå€¼ä¸ºN=8ä»¥æ•è·æ¯å‘¨ä¸šåŠ¡å®¹å™¨å³°å€¼ï¼‰ã€‚**\n\nRecommenderç»„ä»¶è·å–èµ„æºæ¶ˆè€—å®æ—¶æ•°æ®ï¼Œå­˜åˆ°ç›¸åº”èµ„æºå¯¹è±¡CheckPointä¸­ã€‚CheckPoint CRD èµ„æºæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç›´æ–¹å›¾ã€‚\n\n![image.png](Extras/Images/image_1667219600773_0.png)\n\n## ç›´æ–¹å›¾ç»Ÿä¸€å¯¹å¤–æä¾›çš„æ¥å£\n\n![image.png](Extras/Images/image_1667219640780_0.png)\n\n## åŠè¡°æœŸå’Œæƒé‡ç³»æ•°\n\nä¸ºæ¯ä¸ªæ ·æœ¬æ•°æ®æƒé‡ä¹˜ä¸Š**æŒ‡æ•°2^ï¼ˆï¼ˆsampleTime-referenceTimestampï¼‰/ halfLifeï¼‰**ï¼Œä»¥ä¿è¯è¾ƒæ–°çš„æ ·æœ¬è¢«èµ‹äºˆæ›´é«˜çš„æƒé‡ï¼Œè€Œè¾ƒè€çš„æ ·æœ¬éšæ—¶é—´æ¨ç§»æƒé‡é€æ­¥è¡°å‡ã€‚\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œ**æ¯24h ä¸ºä¸€ä¸ªåŠè¡°æœŸ**ï¼Œå³æ¯ç»è¿‡ 24hï¼Œç›´æ–¹å›¾ä¸­æ‰€æœ‰æ ·æœ¬çš„æƒé‡ï¼ˆé‡è¦æ€§ï¼‰è¡°å‡ä¸ºåŸæ¥çš„ä¸€åŠã€‚\n\n**å½“æŒ‡æ•°è¿‡å¤§æ—¶ï¼ŒreferenceTimestamp å°±éœ€è¦å‘å‰è°ƒæ•´ï¼Œä»¥é¿å…æµ®ç‚¹ä¹˜æ³•è®¡ç®—æ—¶å‘ä¸Šæº¢å‡ºã€‚**\n\n- CPUä½¿ç”¨é‡æ ·æœ¬å¯¹åº”çš„æƒé‡æ˜¯åŸºäºå®¹å™¨ CPU requestå€¼ç¡®å®šçš„ã€‚å½“ CPUrequest å¢åŠ æ—¶ï¼Œå¯¹åº”çš„æƒé‡ä¹Ÿéšä¹‹å¢åŠ ã€‚\n- è€ŒMemory ä½¿ç”¨é‡æ ·æœ¬å¯¹åº”çš„æƒé‡å›ºå®šä¸º1.0ã€‚\n\n## VPA\n\n**VPA çš„æˆç†Ÿåº¦è¿˜ä¸è¶³**\n\næ›´æ–°æ­£åœ¨è¿è¡Œçš„ Pod èµ„æºé…ç½®æ˜¯VPAçš„ä¸€é¡¹è¯•éªŒæ€§åŠŸèƒ½ï¼Œä¼šå¯¼è‡´ Pod çš„é‡å»ºå’Œé‡å¯ï¼Œè€Œä¸”æœ‰å¯èƒ½è¢«è°ƒåº¦åˆ°å…¶ä»–çš„èŠ‚ç‚¹ä¸Šã€‚\n\nVPAä¸ä¼šé©±é€æ²¡æœ‰åœ¨å‰¯æœ¬æ§åˆ¶å™¨ç®¡ç†ä¸‹çš„ Podã€‚**ç›®å‰å¯¹äºè¿™ç±» Podï¼ŒAuto æ¨¡å¼ç­‰åŒäºInitial æ¨¡å¼ã€‚**\n\nç›®å‰VPAä¸èƒ½å’Œç›‘æ§CPUå’Œå†…å­˜åº¦é‡çš„ **Horizontal Pod Autoscalerï¼ˆHPAï¼‰**åŒæ—¶è¿è¡Œï¼Œé™¤é HPA åªç›‘æ§å…¶ä»–å®šåˆ¶åŒ–çš„æˆ–è€…å¤–éƒ¨çš„èµ„æºåº¦é‡ã€‚\n\nVPAä½¿ç”¨ admission webhook ä½œä¸ºå…¶å‡†å…¥æ§åˆ¶å™¨ã€‚å¦‚æœé›†ç¾¤ä¸­æœ‰å…¶ä»–çš„ admission webhookï¼Œéœ€è¦ç¡®ä¿å®ƒä»¬ä¸ä¼šä¸VPAå‘ç”Ÿå†²çªã€‚å‡†å…¥æ§åˆ¶å™¨çš„æ‰§è¡Œé¡ºåºå®šä¹‰åœ¨ APIServerçš„é…ç½®å‚æ•°ä¸­ã€‚\n\nVPAä¼šå¤„ç†å‡ºç°çš„ç»å¤§å¤šæ•° **OOMï¼ˆOut Of Memoryï¼‰** çš„äº‹ä»¶ï¼Œä½†ä¸ä¿è¯æ‰€æœ‰çš„åœºæ™¯ä¸‹éƒ½æœ‰æ•ˆã€‚\n\nVPAçš„æ€§èƒ½è¿˜æ²¡æœ‰åœ¨å¤§å‹é›†ç¾¤ä¸­æµ‹è¯•è¿‡ã€‚\n\nVPA å¯¹ Pod èµ„æº requests çš„ä¿®æ”¹å€¼å¯èƒ½è¶…è¿‡å®é™…çš„èµ„æºä¸Šé™ï¼Œä¾‹å¦‚èŠ‚ç‚¹èµ„æºä¸Šé™ã€ç©ºé—²èµ„æºæˆ–èµ„æºé…é¢ï¼Œä»è€Œé€ æˆï¼Œ Pod å¤„äº PendingçŠ¶æ€æ— æ³•è¢«è°ƒåº¦ã€‚åŒæ—¶ä½¿ç”¨é›†ç¾¤è‡ªåŠ¨ä¼¸ç¼©ï¼ˆClusterAutoScalerï¼‰å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n\nå¤šä¸ªVPAåŒæ—¶åŒ¹é…åŒä¸€ä¸ª Pod ä¼šé€ æˆæœªå®šä¹‰çš„è¡Œä¸ºã€‚\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4":{"title":"å¸¸ç”¨å‘½ä»¤","content":"\n# Kubectl\n\n## Kubectl å‘½ä»¤å’Œ kubeconfig\n\n* kubectl æ˜¯ä¸€ä¸ª Kubernetes çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒå…è®¸Kubernetes ç”¨æˆ·ä»¥å‘½ä»¤è¡Œçš„æ–¹å¼ä¸ Kubernetes äº¤äº’ï¼Œå…¶é»˜è®¤è¯»å–é…ç½®æ–‡ä»¶ ~/.kube/configã€‚\n* kubectl ä¼šå°†æ¥æ”¶åˆ°çš„ç”¨æˆ·è¯·æ±‚è½¬åŒ–ä¸º rest è°ƒç”¨ä»¥rest client çš„å½¢å¼ä¸ apiserver é€šè®¯ã€‚\n* apiserver çš„åœ°å€ï¼Œç”¨æˆ·ä¿¡æ¯ç­‰é…ç½®åœ¨ kubeconfigã€‚\n\n## å¸¸ç”¨å‘½ä»¤\n\n* kubectl get po â€“oyaml -w\n\t* kubectl    å¯æŸ¥çœ‹å¯¹è±¡ã€‚\n\t* -oyaml    è¾“å‡ºè¯¦ç»†ä¿¡æ¯ä¸º yaml æ ¼å¼ã€‚\n\t* -w watch    è¯¥å¯¹è±¡çš„åç»­å˜åŒ–ã€‚\n\t* -owide    ä»¥è¯¦ç»†åˆ—è¡¨çš„æ ¼å¼æŸ¥çœ‹å¯¹è±¡ã€‚\n\n## åœ¨ç»ˆç«¯é€šè¿‡stdinè¯»å–inline YAML\n\n```bash\n\n$ kubectl apply -f - \u003c\u003cEOF\n\u003c-- insert YAML content here --\u003e\nEOF\n```\n\nOR\n\n```bash\n$ cat file.yaml | kubectl apply -f -\n```\n\n## è·¨ Namespace åŒæ­¥ Secret å’Œ ConfigMap\n\n### æ‰‹åŠ¨\n\n```bash\nkubectl get secret \u003csecret-name\u003e -n \u003csource_ns\u003e -o json \\\n | jq 'del(.metadata[\"namespace\",\"creationTimestamp\",\"resourceVersion\",\"selfLink\",\"uid\"])' \\\n | kubectl apply -n \u003ctarget_ns\u003e -f -\n```\n\n### More\n\nhttps://zhuanlan.zhihu.com/p/519168101\n\n## finalizerå¯¼è‡´namespace Terminating\n\n### namespaceèµ„æºå¯¹è±¡çš„spec.finalizer[] åˆ—è¡¨ä¸­ä¸ä¸ºç©º\n\n```bash\nNAMESPACE=delete-me\nkubectl get ns $NAMESPACE -o json | jq '.spec.finalizers=[]' \u003e ns.json\nkubectl proxy --port=8899 \u0026\nPID=$!\ncurl -X PUT http://localhost:8899/api/v1/namespaces/$NAMESPACE/finalize -H \"Content-Type: application/json\" --data-binary @ns.json\nkill $PID\n```\n\n### namespaceèµ„æºå¯¹è±¡çš„metadata.finalizer[] åˆ—è¡¨ä¸ä¸ºç©º\n\n```bash\n$ kubelet edit ns \u003cname\u003e #å°†metadata.finalizer[]åˆ—è¡¨åˆ é™¤\n```\n\n# Secret\n\n## åˆ›å»ºsecret\n\n`kubectl create secret generic \u003csecret name\u003e --from-literal=\u003ckey\u003e=\u003cvalue\u003e -n \u003cnamespace\u003e`\n\n## è·å–secretï¼ˆpasswordï¼‰\n\n```sh\nkubectl get secret -n \u003cnamespace\u003e \u003csecret name\u003e -o jsonpath='{.data}'\nkubectl get secret -n \u003cnamespace\u003e \u003csecret name\u003e -o jsonpath='{.data.password}' | base64 -d\n```\n\n## åˆ é™¤secret\n\n`kubectl -n \u003cnamespace\u003e delete secrets \u003csecret name\u003e`\n\n## åˆ›å»ºimagePullSecrets\n\n### é€šè¿‡å‘½ä»¤è¡Œåˆ›å»º\n\n```bash\n$ kubectl create -n \u003cnamespace\u003e secret docker-registry \u003csecret-name\u003e \\\n\t\t  --docker-server=\u003cdocker-server\u003e \\\n          --docker-username=\u003cusername\u003e \\\n          --docker-password=\u003cpassword\u003e \\\n          --docker-email=\u003cemail\u003e\n```\n\n### åŸºäºç°æœ‰å‡­è¯åˆ›å»º\n\n```basg\nkubectl create -n \u003cnamespace\u003e secret generic \u003csecret-name\u003e \\\n    --from-file=.dockerconfigjson=\u003cpath/to/.docker/config.json\u003e \\\n    --type=kubernetes.io/dockerconfigjson\n```\n\n# kubecm\n\n\u003e https://kubecm.cloud/zh-cn/introduction\n\näº¤äº’å¼ç®¡ç†kubeconfigå·¥å…·ã€‚\n\n```bash\n# æŸ¥çœ‹ $HOME/.kube/config ä¸­æ‰€æœ‰çš„ context\nkubecm list\n  \n# æ·»åŠ  example.yaml åˆ° $HOME/.kube/config.yamlï¼Œè¯¥æ–¹å¼ä¸ä¼šè¦†ç›–æº kubeconfigï¼Œåªä¼šåœ¨å½“å‰ç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ª config.yaml æ–‡ä»¶\nkubecm add -f example.yaml\n  \n# åŠŸèƒ½åŒä¸Šï¼Œä½†æ˜¯ä¼šå°† example.yaml ä¸­çš„ context å‘½åä¸º test\nkubecm add -f example.yaml -n test\n  \n# æ·»åŠ  -c ä¼šè¦†ç›–æº kubeconfig\nkubecm add -f example.yaml -c\n  \n# äº¤äº’å¼åˆ é™¤\nkubecm delete\n  \n# åˆ é™¤æŒ‡å®š context\nkubecm delete my-context\n  \n# åˆå¹¶ test ç›®å½•ä¸­çš„ kubeconfig,è¯¥æ–¹å¼ä¸ä¼šè¦†ç›–æº kubeconfigï¼Œåªä¼šåœ¨å½“å‰ç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ª config.yaml æ–‡ä»¶\nkubecm merge -f test \n  \n# æ·»åŠ  -c ä¼šè¦†ç›–æº kubeconfig\nkubecm merge -f test -c\n  \n# äº¤äº’å¼é‡å‘½å\nkubecm rename\n  \n# å°† dev é‡å‘½åä¸º test\nkubecm rename -o dev -n test\n  \n# é‡å‘½å current-context ä¸º dev\nkubecm rename -n dev -c\n  \n# äº¤äº’å¼åˆ‡æ¢ namespace\nkubecm namespace\n  \n# æˆ–è€…\nkubecm ns\n  \n# åˆ‡æ¢é»˜è®¤ namespace ä¸º kube-system\nkubecm ns kube-system\n```\n\n# è°ƒè¯•å‘½ä»¤\n\n## crictlæŸ¥æ‰¾å®¹å™¨PID\n\n```bash\n# 0.è®¾ç½®runtime-endpoint\ncrictl -r unix:///run/k0s/containerd.sock\n  \n# 1.æŸ¥æ‰¾å®¹å™¨id\ncrictl ps æˆ–é€šè¿‡k8sæŸ¥æ‰¾\n  \n# 2.é€šè¿‡inspectæŸ¥æ‰¾PID\ncrictl inspect --output go-template --template '{{.info.pid}}' $containerid\n```\n\n## dockeræŸ¥æ‰¾å®¹å™¨PID\n\n```bash\n# 1.æŸ¥æ‰¾å®¹å™¨id\ndocker ps\n  \n# 2.é€šè¿‡inspectæŸ¥æ‰¾PID\ndocker inspect $containerid -f '{{ .State.Pid }}'\n```\n\n## nsenter\n\n\u003e https://qingwave.github.io/k8s-debug-nsenter\n\né€šè¿‡`nsenter`å¯ä»¥è½»æ¾åœ¨å®¿ä¸»æœºè¿›å…¥å®¹å™¨çš„ç½‘ç»œå‘½ä»¤ç©ºé—´ã€‚ä¹‹åä¾¿å¯ä»¥ä½¿ç”¨å®¿ä¸»æœºå„ç§å·¥å…·`tcpdump`,Â `netstat`ç­‰å‘½ä»¤ã€‚\n\n```bash\n# è¿›å…¥å®¹å™¨networker namespace\nnsenter -n --target $pid\n```\n\n# kubectl debug\n\n\u003e https://kubernetes.io/zh-cn/docs/tasks/debug/debug-application/debug-running-pod/\n\n### ä½¿ç”¨ä¸´æ—¶å®¹å™¨æ¥è°ƒè¯•\n\nå½“ç”±äºå®¹å™¨å´©æºƒæˆ–å®¹å™¨é•œåƒä¸åŒ…å«è°ƒè¯•ç¨‹åºï¼ˆä¾‹å¦‚[æ— å‘è¡Œç‰ˆé•œåƒ](https://github.com/GoogleContainerTools/distroless)ç­‰ï¼‰ è€Œå¯¼è‡´Â `kubectl exec`Â æ— æ³•è¿è¡Œæ—¶ï¼Œ[ä¸´æ—¶å®¹å™¨](https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/ephemeral-containers/)å¯¹äºæ’é™¤äº¤äº’å¼æ•…éšœå¾ˆæœ‰ç”¨ã€‚\n\n\u003e **è¯´æ˜ï¼š**Â [å®¹å™¨è¿è¡Œæ—¶](https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes)å¿…é¡»æ”¯æŒÂ `--target`Â å‚æ•°ã€‚ å¦‚æœä¸æ”¯æŒï¼Œåˆ™ä¸´æ—¶å®¹å™¨å¯èƒ½ä¸ä¼šå¯åŠ¨ï¼Œæˆ–è€…å¯èƒ½ä½¿ç”¨éš”ç¦»çš„è¿›ç¨‹å‘½åç©ºé—´å¯åŠ¨ï¼Œ ä»¥ä¾¿Â `ps`Â ä¸æ˜¾ç¤ºå…¶ä»–å®¹å™¨å†…çš„è¿›ç¨‹ã€‚\n\n```bash\nkubectl debug -it $podName --image=busybox:1.28 --target=$containerName\n```\n\n### é€šè¿‡ Pod å‰¯æœ¬è°ƒè¯•\n\næœ‰äº›æ—¶å€™ Pod çš„é…ç½®å‚æ•°ä½¿å¾—åœ¨æŸäº›æƒ…å†µä¸‹å¾ˆéš¾æ‰§è¡Œæ•…éšœæ’æŸ¥ã€‚ ä¾‹å¦‚ï¼Œåœ¨å®¹å™¨é•œåƒä¸­ä¸åŒ…å« shell æˆ–è€…ä½ çš„åº”ç”¨ç¨‹åºåœ¨å¯åŠ¨æ—¶å´©æºƒçš„æƒ…å†µä¸‹ï¼Œ å°±ä¸èƒ½é€šè¿‡è¿è¡ŒÂ `kubectl exec`Â æ¥æ’æŸ¥å®¹å™¨æ•…éšœã€‚ åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨Â `kubectl debug`Â æ¥åˆ›å»º Pod çš„å‰¯æœ¬ï¼Œé€šè¿‡æ›´æ”¹é…ç½®å¸®åŠ©è°ƒè¯•ã€‚\n\n#### åœ¨æ·»åŠ æ–°çš„å®¹å™¨æ—¶åˆ›å»º Pod å‰¯æœ¬\n\nå½“åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œä½†å…¶è¡¨ç°ä¸ç¬¦åˆé¢„æœŸæ—¶ï¼Œä½ ä¼šå¸Œæœ›åœ¨ Pod ä¸­æ·»åŠ é¢å¤–çš„è°ƒè¯•å·¥å…·ï¼Œ è¿™æ—¶æ·»åŠ æ–°å®¹å™¨æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚\n\nä¾‹å¦‚ï¼Œåº”ç”¨çš„å®¹å™¨é•œåƒæ˜¯å»ºç«‹åœ¨Â `busybox`Â çš„åŸºç¡€ä¸Šï¼Œ ä½†æ˜¯ä½ éœ€è¦Â `busybox`Â ä¸­å¹¶ä¸åŒ…å«çš„è°ƒè¯•å·¥å…·ã€‚ ä½ å¯ä»¥ä½¿ç”¨Â `kubectl run`Â æ¨¡æ‹Ÿè¿™ä¸ªåœºæ™¯ï¼š\n\n```bash\n\nbectl run myapp --image=busybox:1.28 --restart=Never -- sleep 1d\n```\n\né€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå»ºç«‹Â `myapp`Â çš„ä¸€ä¸ªåä¸ºÂ `myapp-debug`Â çš„å‰¯æœ¬ï¼Œ æ–°å¢äº†ä¸€ä¸ªç”¨äºè°ƒè¯•çš„ Ubuntu å®¹å™¨ï¼Œ\n\n```bash\nkubectl debug myapp -it --image=ubuntu --share-processes --copy-to=myapp-debug\n```\n\n\u003e` --share-processes`Â å…è®¸åœ¨æ­¤ Pod ä¸­çš„å…¶ä»–å®¹å™¨ä¸­æŸ¥çœ‹è¯¥å®¹å™¨çš„è¿›ç¨‹ã€‚ å‚é˜…[åœ¨ Pod ä¸­çš„å®¹å™¨ä¹‹é—´å…±äº«è¿›ç¨‹å‘½åç©ºé—´](https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/share-process-namespace/)Â è·å–æ›´å¤šä¿¡æ¯ã€‚\n\n#### åœ¨æ”¹å˜ Pod å‘½ä»¤æ—¶åˆ›å»º Pod å‰¯æœ¬\n\næœ‰æ—¶æ›´æ”¹å®¹å™¨çš„å‘½ä»¤å¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚æ·»åŠ è°ƒè¯•æ ‡å¿—æˆ–å› ä¸ºåº”ç”¨å´©æºƒã€‚\n\nä¸ºäº†æ¨¡æ‹Ÿåº”ç”¨å´©æºƒçš„åœºæ™¯ï¼Œä½¿ç”¨Â `kubectl run`Â å‘½ä»¤åˆ›å»ºä¸€ä¸ªç«‹å³é€€å‡ºçš„å®¹å™¨ï¼š\n\n```bash\n\nbectl run --image=busybox:1.28 myapp -- false\n```\n\nä½ å¯ä»¥ä½¿ç”¨Â `kubectl debug`Â å‘½ä»¤åˆ›å»ºè¯¥ Pod çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œ åœ¨è¯¥å‰¯æœ¬ä¸­å‘½ä»¤æ”¹å˜ä¸ºäº¤äº’å¼ shellï¼š\n\n```bash\n\nbectl debug myapp -it --copy-to=myapp-debug --container=myapp -- sh\n```\n\nç°åœ¨ä½ æœ‰äº†ä¸€ä¸ªå¯ä»¥æ‰§è¡Œç±»ä¼¼æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿè·¯å¾„æˆ–è€…æ‰‹åŠ¨è¿è¡Œå®¹å™¨å‘½ä»¤çš„äº¤äº’å¼ shellã€‚\n\n\u003e è¦æ›´æ”¹æŒ‡å®šå®¹å™¨çš„å‘½ä»¤ï¼Œä½ å¿…é¡»ç”¨Â `--container`Â å‘½ä»¤æŒ‡å®šå®¹å™¨çš„åå­—ï¼Œ å¦åˆ™Â `kubectl debug`Â å°†å»ºç«‹ä¸€ä¸ªæ–°çš„å®¹å™¨è¿è¡Œä½ æŒ‡å®šçš„å‘½ä»¤ã€‚\n\n#### åœ¨æ›´æ”¹å®¹å™¨é•œåƒæ—¶æ‹·è´ Pod\n\nåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½æƒ³è¦æ”¹åŠ¨ä¸€ä¸ªè¡Œä¸ºå¼‚å¸¸çš„ Podï¼Œå³ä»å…¶æ­£å¸¸çš„ç”Ÿäº§å®¹å™¨é•œåƒæ›´æ”¹ä¸ºåŒ…å«è°ƒè¯•æ„å»ºç¨‹åºæˆ–å…¶ä»–å®ç”¨ç¨‹åºçš„é•œåƒã€‚\n\nä¸‹é¢çš„ä¾‹å­ï¼Œç”¨Â `kubectl run`Â åˆ›å»ºä¸€ä¸ª Podï¼š\n\n```bash\n\nkubectl run myapp --image=busybox:1.28 --restart=Never -- sleep 1d\n```\n\nç°åœ¨å¯ä»¥ä½¿ç”¨Â `kubectl debug`Â åˆ›å»ºä¸€ä¸ªæ‹·è´å¹¶å°†å…¶å®¹å™¨é•œåƒæ›´æ”¹ä¸ºÂ `ubuntu`ï¼š\n\n```bash\nkubectl debug myapp --copy-to=myapp-debug --set-image=*=ubuntu\n```\n\n`--set-image`Â ä¸Â `container_name=image`Â ä½¿ç”¨ç›¸åŒçš„Â `kubectl set image`Â è¯­æ³•ã€‚Â `*=ubuntu`Â è¡¨ç¤ºæŠŠæ‰€æœ‰å®¹å™¨çš„é•œåƒæ”¹ä¸ºÂ `ubuntu`ã€‚\n\n### åœ¨èŠ‚ç‚¹ä¸Šé€šè¿‡ shell æ¥è¿›è¡Œè°ƒè¯•\n\nå¦‚æœè¿™äº›æ–¹æ³•éƒ½ä¸èµ·ä½œç”¨ï¼Œä½ å¯ä»¥æ‰¾åˆ°è¿è¡Œ Pod çš„èŠ‚ç‚¹ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª Pod è¿è¡Œåœ¨è¯¥èŠ‚ç‚¹ä¸Šã€‚ ä½ å¯ä»¥é€šè¿‡Â `kubectl debug`Â åœ¨èŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªäº¤äº’å¼ Shellï¼š\n\n```bash\nkubectl debug node/mynode -it --image=ubuntu\n```\n\nå½“åœ¨èŠ‚ç‚¹ä¸Šåˆ›å»ºè°ƒè¯•ä¼šè¯ï¼Œæ³¨æ„ä»¥ä¸‹è¦ç‚¹ï¼š\n* `kubectl debug`Â åŸºäºèŠ‚ç‚¹çš„åå­—è‡ªåŠ¨ç”Ÿæˆæ–°çš„ Pod çš„åå­—ã€‚\n* èŠ‚ç‚¹çš„æ ¹æ–‡ä»¶ç³»ç»Ÿä¼šè¢«æŒ‚è½½åœ¨Â `/host`ã€‚\n* æ–°çš„è°ƒè¯•å®¹å™¨è¿è¡Œåœ¨ä¸»æœº IPC åå­—ç©ºé—´ã€ä¸»æœºç½‘ç»œåå­—ç©ºé—´ä»¥åŠä¸»æœº PID åå­—ç©ºé—´å†…ï¼Œ Pod æ²¡æœ‰ç‰¹æƒï¼Œå› æ­¤è¯»å–æŸäº›è¿›ç¨‹ä¿¡æ¯å¯èƒ½ä¼šå¤±è´¥ï¼Œå¹¶ä¸”Â `chroot /host`Â ä¹Ÿä¼šå¤±è´¥ã€‚\n* å¦‚æœä½ éœ€è¦ä¸€ä¸ªç‰¹æƒ Podï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºã€‚\n\nå½“ä½ å®ŒæˆèŠ‚ç‚¹è°ƒè¯•æ—¶ï¼Œä¸è¦å¿˜è®°æ¸…ç†è°ƒè¯• Podï¼š\n\n```bash\nkubectl delete pod node-debugger-mynode-pdx84\n```\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0":{"title":"æœåŠ¡å‘ç°","content":"\n# æœåŠ¡å‘å¸ƒ\n\n* éœ€è¦æŠŠæœåŠ¡å‘å¸ƒè‡³é›†ç¾¤å†…éƒ¨æˆ–è€…å¤–éƒ¨ï¼ŒæœåŠ¡çš„ä¸åŒç±»å‹\n\t* ClusterlP(Headless)\n\t* NodePort\n\t* LoadBalancer\n\t* ExternalName\n* è¯ä¹¦ç®¡ç†å’Œä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„éœ€æ±‚\n* éœ€è¦gRPCè´Ÿè½½å‡è¡¡å¦‚ä½•åš?\n* DNSéœ€æ±‚\n* ä¸ä¸Šä¸‹æ¸¸æœåŠ¡çš„å…³ç³»\n\n## æœåŠ¡å‘å¸ƒçš„æŒ‘æˆ˜\n\n- kube-dns\n\t- DNS TTLé—®é¢˜\n- Service\n\t- ClusterIPåªèƒ½å¯¹å†…\n\t- kube-proxyæ”¯æŒçš„iptables/ipvsè§„æ¨¡æœ‰é™\n\t- IPVSçš„æ€§èƒ½å’Œç”Ÿäº§åŒ–é—®é¢˜\n\t- kube-proxyçš„drifté—®é¢˜\n\t- é¢‘ç¹çš„Podå˜åŠ¨ï¼ˆspec changeï¼Œfailoverï¼Œcrashloopï¼‰å¯¼è‡´LBé¢‘ç¹å˜æ›´\n\t- å¯¹å¤–å‘å¸ƒçš„Serviceéœ€è¦ä¸ä¼ä¸šELBå³æˆ\n\t- ä¸æ”¯æŒgRPC\n\t- ä¸æ”¯æŒè‡ªå®šä¹‰DNSå’Œé«˜çº§è·¯ç”±åŠŸèƒ½\n- Ingress\n\t- Specçš„æˆç†Ÿåº¦?\n- å…¶ä»–å¯é€‰æ–¹æ¡ˆ?\n\n# å¾®æœåŠ¡æ¶æ„ä¸‹çš„é«˜å¯ç”¨æŒ‘æˆ˜\n\n## æœåŠ¡å‘ç°\n\nå¾®æœåŠ¡æ¶æ„æ˜¯ç”±ä¸€ç³»åˆ—èŒè´£å•ä¸€çš„ç»†ç²’åº¦æœåŠ¡æ„æˆçš„åˆ†å¸ƒå¼ç½‘çŠ¶ç»“æ„ï¼ŒæœåŠ¡ä¹‹é—´é€šè¿‡è½»é‡æœºåˆ¶è¿›è¡Œé€šä¿¡ï¼Œè¿™æ—¶å€™å¿…ç„¶å¼•å…¥ä¸€ä¸ªæœåŠ¡æ³¨å†Œå‘ç°é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´æœåŠ¡æä¾›æ–¹è¦æ³¨å†Œé€šå‘ŠæœåŠ¡åœ°å€ï¼ŒæœåŠ¡çš„è°ƒç”¨æ–¹è¦èƒ½å‘ç°ç›®æ ‡æœåŠ¡ã€‚\n\nåŒæ—¶æœåŠ¡æä¾›æ–¹ä¸€èˆ¬ä»¥é›†ç¾¤æ–¹å¼æä¾›æœåŠ¡ï¼Œä¹Ÿå°±å¼•å…¥äº†è´Ÿè½½å‡è¡¡å’Œå¥åº·æ£€æŸ¥é—®é¢˜ã€‚\n\n## äº’è”ç½‘æ¶æ„å‘å±•å†ç¨‹\n\n![image.png](Extras/Images/image_1666185055076_0.png)\n\n## ç†è§£ç½‘ç»œåŒ…æ ¼å¼\n\n![image.png](Extras/Images/image_1666185072055_0.png)\n\n## é›†ä¸­å¼LBæœåŠ¡å‘ç°\n\nåœ¨æœåŠ¡æ¶ˆè´¹è€…å’ŒæœåŠ¡æä¾›è€…ä¹‹é—´æœ‰ä¸€ä¸ªç‹¬ç«‹çš„LBã€‚\n\nLBä¸Šæœ‰æ‰€æœ‰æœåŠ¡çš„åœ°å€æ˜ å°„è¡¨ï¼Œé€šå¸¸ç”±è¿ç»´é…ç½®æ³¨å†Œã€‚\n\nå½“æœåŠ¡æ¶ˆè´¹æ–¹è°ƒç”¨æŸä¸ªç›®æ ‡æœåŠ¡æ—¶ï¼Œå®ƒå‘LBå‘èµ·è¯·æ±‚ï¼Œç”±LBä»¥æŸç§ç­–ç•¥ï¼ˆæ¯”å¦‚Round-Robinï¼‰åšè´Ÿè½½å‡è¡¡åå°†è¯·æ±‚è½¬å‘åˆ°ç›®æ ‡æœåŠ¡ã€‚\n\nLBä¸€èˆ¬å…·å¤‡å¥åº·æ£€æŸ¥èƒ½åŠ›ï¼Œèƒ½è‡ªåŠ¨æ‘˜é™¤ä¸å¥åº·çš„æœåŠ¡å®ä¾‹ã€‚\n\næœåŠ¡æ¶ˆè´¹æ–¹é€šè¿‡DNSå‘ç°LBï¼Œè¿ç»´äººå‘˜ä¸ºæœåŠ¡é…ç½®ä¸€ä¸ªDNSåŸŸåï¼Œè¿™ä¸ªåŸŸåæŒ‡å‘LBã€‚\n\n![image.png](Extras/Images/image_1666185251776_0.png){:height 238, :width 657}\n\n---\n\né›†ä¸­å¼LBæ–¹æ¡ˆå®ç°ç®€å•ï¼Œåœ¨LBä¸Šä¹Ÿå®¹æ˜“åšé›†ä¸­å¼çš„è®¿é—®æ§åˆ¶ï¼Œè¿™ä¸€æ–¹æ¡ˆç›®å‰è¿˜æ˜¯ä¸šç•Œä¸»æµã€‚\n\né›†ä¸­å¼LBçš„ä¸»è¦é—®é¢˜æ˜¯å•ç‚¹é—®é¢˜ï¼Œæ‰€æœ‰æœåŠ¡è°ƒç”¨æµé‡éƒ½ç»è¿‡LBï¼Œå½“æœåŠ¡æ•°é‡å’Œè°ƒç”¨é‡å¤§çš„æ—¶å€™ï¼ŒLBå®¹æ˜“æˆä¸ºç“¶é¢ˆï¼Œä¸”ä¸€æ—¦LBå‘ç”Ÿæ•…éšœå¯¹æ•´ä¸ªç³»ç»Ÿçš„å½±å“æ˜¯ç¾éš¾æ€§çš„ã€‚\n\nLBåœ¨æœåŠ¡æ¶ˆè´¹æ–¹å’ŒæœåŠ¡æä¾›æ–¹ä¹‹é—´å¢åŠ äº†ä¸€è·³ï¼ˆhopï¼‰ï¼Œæœ‰ä¸€å®šæ€§èƒ½å¼€é”€ã€‚\n\n## è¿›ç¨‹å†…LBæœåŠ¡å‘ç°\n\nè¿›ç¨‹å†…LBæ–¹æ¡ˆå°†LBçš„åŠŸèƒ½ä»¥åº“çš„å½¢å¼é›†æˆåˆ°æœåŠ¡æ¶ˆè´¹æ–¹è¿›ç¨‹é‡Œå¤´ï¼Œè¯¥æ–¹æ¡ˆä¹Ÿè¢«ç§°ä¸ºå®¢æˆ·ç«¯è´Ÿè½½æ–¹æ¡ˆã€‚\n\næœåŠ¡æ³¨å†Œè¡¨ï¼ˆSerViCe ReqistrVï¼‰é…åˆæ”¯æŒæœåŠ¡è‡ªæ³¨å†Œå’Œè‡ªå‘ç°ï¼ŒæœåŠ¡æä¾›æ–¹å¯åŠ¨æ—¶.é¦–å…ˆå°†æœåŠ¡åœ°å€æ³¨å†Œåˆ°æœåŠ¡æ³¨å†Œè¡¨ï¼ˆåŒæ—¶å®šæœŸæŠ¥å¿ƒè·³åˆ°æœåŠ¡æ³¨å†Œè¡¨ä»¥è¡¨æ˜æœåŠ¡çš„å­˜æ´»çŠ¶æ€ï¼‰ã€‚\n\næœåŠ¡æ¶ˆè´¹æ–¹è¦è®¿é—®æŸä¸ªæœåŠ¡æ—¶ï¼Œå®ƒé€šè¿‡å†…ç½®çš„LBç»„ä»¶å‘æœåŠ¡æ³¨å†Œè¡¨æŸ¥è¯¢ï¼ˆåŒæ—¶ç¼“å­˜å¹¶å®šæœŸåˆ·æ–°ï¼‰ç›®æ ‡æœåŠ¡åœ°å€åˆ—è¡¨ï¼Œç„¶åä»¥æŸç§è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©ä¸€ä¸ªç›®æ ‡æœåŠ¡åœ°å€ï¼Œæœ€åå‘ç›®æ ‡æœåŠ¡å‘èµ·è¯·æ±‚ã€‚\n\nè¿™ä¸€æ–¹æ¡ˆå¯¹æœåŠ¡æ³¨å†Œè¡¨çš„å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰è¦æ±‚å¾ˆé«˜ï¼Œä¸€èˆ¬é‡‡ç”¨èƒ½æ»¡è¶³é«˜å¯ç”¨åˆ†å¸ƒå¼ä¸€è‡´çš„ç»„ä»¶ï¼ˆä¾‹å¦‚ZooKeeperï¼Œ Consulï¼Œ etcdç­‰ï¼‰æ¥å®ç°ã€‚\n\n![image.png](Extras/Images/image_1666185729019_0.png)\n\n---\n\nè¿›ç¨‹å†…LBæ˜¯ä¸€ç§åˆ†å¸ƒå¼æ¨¡å¼ï¼ŒLBå’ŒæœåŠ¡å‘ç°èƒ½åŠ›è¢«åˆ†æ•£åˆ°æ¯ä¸€ä¸ªæœåŠ¡æ¶ˆè´¹è€…çš„è¿› â€¢ç¨‹å†…éƒ¨ï¼ŒåŒæ—¶æœåŠ¡æ¶ˆè´¹æ–¹å’ŒæœåŠ¡æä¾›æ–¹ä¹‹é—´æ˜¯ç›´æ¥è°ƒç”¨ï¼Œæ²¡æœ‰é¢å¤–å¼€é”€ï¼Œæ€§èƒ½æ¯”è¾ƒå¥½ã€‚è¯¥æ–¹æ¡ˆä»¥å®¢æˆ·åº“ï¼ˆClient Librarvï¼‰çš„æ–¹å¼é›†æˆåˆ°æœåŠ¡è°ƒç”¨æ–¹è¿›ç¨‹é‡Œå¤´ï¼Œå¦‚æœä¼ä¸šå†…æœ‰å¤šç§ä¸åŒçš„è¯­è¨€æ ˆï¼Œå°±è¦é…åˆå¼€å‘å¤šç§ä¸åŒçš„å®¢æˆ·ç«¯ï¼Œæœ‰ä¸€å®šçš„ç ”å‘å’Œç»´æŠ¤æˆæœ¬ã€‚\n\nä¸€æ—¦å®¢æˆ·ç«¯è·ŸéšæœåŠ¡è°ƒç”¨æ–¹å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåç»­å¦‚æœè¦å¯¹å®¢æˆ·åº“è¿›è¡Œå‡çº§ï¼ŒåŠ¿å¿…è¦æ±‚æœåŠ¡è°ƒç”¨æ–¹ä¿®æ”¹ä»£ç å¹¶é‡æ–°å‘å¸ƒï¼Œæ‰€ä»¥è¯¥æ–¹æ¡ˆçš„å‡çº§æ¨å¹¿æœ‰ä¸å°çš„é˜»åŠ›ã€‚\n\n## ç‹¬ç«‹LBè¿›ç¨‹æœåŠ¡å‘ç°\n\né’ˆå¯¹è¿›ç¨‹å†…LBæ¨¡å¼çš„ä¸è¶³è€Œæå‡ºçš„ä¸€ç§æŠ˜ä¸­æ–¹æ¡ˆï¼ŒåŸç†å’Œç¬¬äºŒç§æ–¹æ¡ˆåŸºæœ¬ç±»ä¼¼ã€‚\n\nä¸åŒä¹‹å¤„æ˜¯ï¼Œå°†LBå’ŒæœåŠ¡å‘ç°åŠŸèƒ½ä»è¿›ç¨‹å†…ç§»å‡ºæ¥ï¼Œå˜æˆä¸»æœºä¸Šçš„ä¸€ä¸ªç‹¬ç«‹è¿›ç¨‹ï¼Œä¸»æœºä¸Šçš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªæœåŠ¡è¦è®¿é—®ç›®æ ‡æœåŠ¡æ—¶ï¼Œä»–ä»¬éƒ½é€šè¿‡åŒä¸€ä¸»æœºä¸Šçš„ç‹¬ç«‹LBè¿›ç¨‹åšæœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚\n\nLBç‹¬ç«‹è¿›ç¨‹å¯ä»¥è¿›ä¸€æ­¥ä¸æœåŠ¡æ¶ˆè´¹æ–¹è¿›è¡Œè§£è€¦ï¼Œä»¥ç‹¬ç«‹é›†ç¾¤çš„å½¢å¼æä¾›é«˜å¯ç”¨çš„è´Ÿè½½å‡è¡¡æœåŠ¡ã€‚\n\nè¿™ç§æ¨¡å¼å¯ä»¥ç§°ä¹‹ä¸ºçœŸæ­£çš„\"è½¯è´Ÿè½½ï¼ˆSoft Load Balancingï¼‰\"ã€‚\n\n![image.png](Extras/Images/image_1666185836227_0.png)\n\n---\n\nç‹¬ç«‹LBè¿›ç¨‹ä¹Ÿæ˜¯ä¸€ç§åˆ†å¸ƒå¼æ–¹æ¡ˆï¼Œæ²¡æœ‰å•ç‚¹é—®é¢˜ï¼Œä¸€ä¸ªLBè¿›ç¨‹æŒ‚äº†åªå½±å“è¯¥ä¸»æœºä¸Šçš„æœåŠ¡è°ƒç”¨æ–¹ã€‚\n\næœåŠ¡è°ƒç”¨æ–¹å’ŒLBä¹‹é—´æ˜¯è¿›ç¨‹é—´è°ƒç”¨ï¼Œæ€§èƒ½å¥½ã€‚\n\nç®€åŒ–äº†æœåŠ¡è°ƒç”¨æ–¹ï¼Œä¸éœ€è¦ä¸ºä¸åŒè¯­è¨€å¼€å‘å®¢æˆ·åº“ï¼ŒLBçš„å‡çº§ä¸éœ€è¦æœåŠ¡è°ƒç”¨æ–¹æ”¹ä»£ç ã€‚\n\nä¸è¶³æ˜¯éƒ¨ç½²è¾ƒå¤æ‚ï¼Œç¯èŠ‚å¤šï¼Œå‡ºé”™è°ƒè¯•æ’æŸ¥é—®é¢˜ä¸æ–¹ä¾¿ã€‚\n\n## è´Ÿè½½å‡è¡¡\n\nç³»ç»Ÿçš„æ‰©å±•å¯åˆ†ä¸ºçºµå‘ï¼ˆå‚ç›´ï¼‰æ‰©å±•å’Œæ¨ªå‘ï¼ˆæ°´å¹³ï¼‰æ‰©å±•ã€‚\n\n* çºµå‘æ‰©å±•ï¼Œæ˜¯ä»å•æœºçš„è§’åº¦é€šè¿‡å¢åŠ ç¡¬ä»¶å¤„ç†èƒ½åŠ›ï¼Œæ¯”å¦‚CPUå¤„ç†èƒ½åŠ›ï¼Œå†…å­˜å®¹é‡ï¼Œç£ç›˜ç­‰æ–¹é¢ï¼Œå®ç°æœåŠ¡å™¨å¤„ç†èƒ½åŠ›çš„æå‡ï¼Œä¸èƒ½æ»¡è¶³å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆç½‘ç«™ï¼‰ï¼Œå¤§æµé‡ï¼Œé«˜å¹¶å‘ï¼Œæµ·é‡æ•°æ®çš„é—®é¢˜ï¼›\n* æ¨ªå‘æ‰©å±•ï¼Œé€šè¿‡æ·»åŠ æœºå™¨æ¥æ»¡è¶³å¤§å‹ç½‘ç«™æœåŠ¡çš„å¤„ç†èƒ½åŠ›ã€‚æ¯”å¦‚âˆ¶ä¸€å°æœºå™¨ä¸èƒ½æ»¡è¶³ï¼Œåˆ™å¢åŠ ä¸¤å°æˆ–è€…å¤šå°æœºå™¨ï¼Œå…±åŒæ‰¿æ‹…è®¿é—®å‹åŠ›ï¼Œè¿™å°±æ˜¯å…¸å‹çš„é›†ç¾¤å’Œè´Ÿè½½å‡è¡¡æ¶æ„ã€‚\n\nè´Ÿè½½å‡è¡¡çš„ä½œç”¨ï¼ˆè§£å†³çš„é—®é¢˜ï¼‰ï¼š\n\n* è§£å†³å¹¶å‘å‹åŠ›ï¼Œæé«˜åº”ç”¨å¤„ç†æ€§èƒ½ï¼Œå¢åŠ ååé‡ï¼ŒåŠ å¼ºç½‘ç»œå¤„ç†èƒ½åŠ›ï¼›\n* æä¾›æ•…éšœè½¬ç§»ï¼Œå®ç°é«˜å¯ç”¨ï¼›\n* é€šè¿‡æ·»åŠ æˆ–å‡å°‘æœåŠ¡å™¨æ•°é‡ï¼Œæä¾›ç½‘ç«™ä¼¸ç¼©æ€§ï¼Œæ‰©å±•æ€§ï¼›\n* å®‰å…¨é˜²æŠ¤ï¼Œè´Ÿè½½å‡è¡¡è®¾å¤‡ä¸Šåšä¸€äº›è¿‡æ»¤ï¼Œé»‘ç™½åå•ç­‰å¤„ç†ã€‚\n\n## DNSè´Ÿè½½å‡è¡¡\n\næœ€æ—©çš„è´Ÿè½½å‡è¡¡æŠ€æœ¯ï¼Œåˆ©ç”¨åŸŸåè§£æå®ç°è´Ÿè½½å‡è¡¡ï¼Œåœ¨DNSæœåŠ¡å™¨.é…ç½®å¤šä¸ªAè®°å½•ï¼Œè¿™äº›Aè®°å½•å¯¹åº”çš„æœåŠ¡å™¨æ„æˆé›†ç¾¤ã€‚\n\n![image.png](Extras/Images/image_1666186231947_0.png)\n\n![image.png](Extras/Images/image_1666186257815_0.png)\n\n## è´Ÿè½½å‡è¡¡æŠ€æœ¯æ¦‚è§ˆ\n\n![image.png](Extras/Images/image_1666186318831_0.png)\n\n## ç½‘ç»œåœ°å€è½¬æ¢\n\nç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNetwork Address Translationï¼ŒNATï¼‰é€šå¸¸é€šè¿‡ä¿®æ”¹æ•°æ®åŒ…çš„æºåœ°å€ï¼ˆSource NATï¼‰æˆ–ç›®æ ‡åœ°å€ï¼ˆDestination NATï¼‰æ¥æ§åˆ¶æ•°æ®åŒ…çš„è½¬å‘è¡Œä¸º\n\n![image.png](Extras/Images/image_1666186604654_0.png)\n\n## æ–°å»ºTCPè¿æ¥\n\nä¸ºè®°å½•åŸå§‹å®¢æˆ·ç«¯IPåœ°å€ï¼Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ä¸ä»…éœ€è¦è¿›è¡Œæ•°æ®åŒ…çš„æºç›®æ ‡åœ°å€ä¿®æ”¹ï¼ŒåŒæ—¶è¦è®°å½•åŸå§‹å®¢æˆ·ç«¯IPåœ°å€ï¼ŒåŸºäºç®€å•çš„NATæ— æ³•æ»¡è¶³æ­¤éœ€æ±‚ï¼Œäºæ˜¯è¡ç”Ÿå‡ºäº†åŸºäºä¼ è¾“å±‚åè®®çš„è´Ÿè½½å‡è¡¡çš„å¦ä¸€ç§æ–¹æ¡ˆâ€”TCP/UDPTerminationæ–¹æ¡ˆ\n\n![image.png](Extras/Images/image_1666186661092_0.png)\n\n## é“¾è·¯å±‚è´Ÿè½½å‡è¡¡\n\nåœ¨é€šä¿¡åè®®çš„æ•°æ®é“¾è·¯å±‚ä¿®æ”¹MACåœ°å€è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚\n\næ•°æ®åˆ†å‘æ—¶ï¼Œä¸ä¿®æ”¹IPåœ°å€ï¼ŒæŒ‡ä¿®æ”¹ç›®æ ‡MACåœ°å€ï¼Œé…ç½®çœŸå®ç‰©ç†æœåŠ¡å™¨é›†ç¾¤æ‰€æœ‰æœºå™¨è™šæ‹ŸIPå’Œè´Ÿè½½å‡è¡¡æœåŠ¡å™¨IPåœ°å€ä¸€è‡´ï¼Œè¾¾åˆ°ä¸ä¿®æ”¹æ•°æ®åŒ…çš„æºåœ°å€å’Œç›®æ ‡åœ°å€ï¼Œè¿›è¡Œæ•°æ®åˆ†å‘çš„ç›®çš„ã€‚å®é™…å¤„ç†æœåŠ¡å™¨IPå’Œæ•°æ®è¯·æ±‚ç›®çš„IPä¸€è‡´ï¼Œä¸éœ€è¦ç»è¿‡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨è¿›è¡Œåœ°å€è½¬æ¢ï¼Œå¯å°†å“\n\nåº”æ•°æ®åŒ…ç›´æ¥è¿”å›ç»™ç”¨æˆ·æµè§ˆå™¨ï¼Œé¿å…è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ç½‘å¡å¸¦å®½æˆä¸ºç“¶é¢ˆã€‚ä¹Ÿç§°ä¸ºç›´æ¥è·¯ç”±æ¨¡å¼ï¼ˆDRæ¨¡å¼ï¼‰ã€‚\n\n![image.png](Extras/Images/image_1666186804807_0.png)\n\n## éš§é“æŠ€æœ¯\n\nè´Ÿè½½å‡è¡¡ä¸­å¸¸ç”¨çš„éš§é“æŠ€æœ¯æ˜¯IP over IPï¼Œå…¶åŸç†æ˜¯ä¿æŒåŸå§‹æ•°æ®åŒ…IPå¤´ä¸å˜ï¼Œåœ¨IPå¤´å¤–å±‚å¢åŠ é¢å¤–çš„IPåŒ…å¤´åè½¬å‘ç»™ä¸Šæ¸¸æœåŠ¡å™¨ã€‚\n\nä¸Šæ¸¸æœåŠ¡å™¨æ¥æ”¶IPæ•°æ®åŒ…ï¼Œè§£å¼€å¤–å±‚IPåŒ…å¤´åï¼Œå‰©ä¸‹çš„æ˜¯åŸå§‹æ•°æ®åŒ…ã€‚\n\nåŒæ ·çš„ï¼ŒåŸå§‹æ•°æ®åŒ…ä¸­çš„ç›®æ ‡IPåœ°å€è¦é…ç½®åœ¨ä¸Šæ¸¸æœåŠ¡å™¨ä¸­ï¼Œä¸Šæ¸¸æœåŠ¡å™¨å¤„ç†å®Œæ•°æ®è¯·æ±‚ä»¥åï¼Œå“åº”åŒ…é€šè¿‡ç½‘å…³ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/%E6%9E%B6%E6%9E%84%E5%9F%BA%E7%A1%80":{"title":"æ¶æ„åŸºç¡€","content":"\n# ä¸»è¦ç»„ä»¶\n\n![image.png](Extras/Images/image_1665768740767_0.png)\n\n# Kubernetes çš„ä¸»èŠ‚ç‚¹ï¼ˆMaster Nodeï¼‰\n\n- APIæœåŠ¡å™¨ï¼šAPI Server\n\t- è¿™æ˜¯ Kubernetes æ§åˆ¶é¢æ¿ä¸­å”¯ä¸€å¸¦æœ‰ç”¨æˆ·å¯è®¿é—® API ä»¥åŠç”¨æˆ·å¯äº¤äº’çš„ç»„ä»¶ã€‚API æœåŠ¡å™¨ä¼šæš´éœ²ä¸€ä¸ª RESTful çš„ Kubernetes API å¹¶ä½¿ç”¨ JSON æ ¼å¼çš„æ¸…å•æ–‡ä»¶ï¼ˆmanifest filesï¼‰ã€‚\n- ç¾¤çš„æ•°æ®å­˜å‚¨ï¼šCluster Data Store\n\t- Kubernetes ä½¿ç”¨â€œetcdâ€ã€‚è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ã€ç¨³å®šçš„ã€é«˜å¯ç”¨çš„é”®å€¼å­˜å‚¨ï¼Œè¢«Kubernetes ç”¨äºé•¿ä¹…å‚¨å­˜æ‰€æœ‰çš„ API å¯¹è±¡ã€‚\n- æ§åˆ¶ç®¡ç†å™¨ï¼šController Manager\n\t- è¢«ç§°ä¸ºâ€œkube-controller managerâ€ï¼Œå®ƒè¿è¡Œç€æ‰€æœ‰å¤„ç†é›†ç¾¤æ—¥å¸¸ä»»åŠ¡çš„æ§åˆ¶å™¨ã€‚åŒ…æ‹¬äº†èŠ‚ç‚¹æ§åˆ¶å™¨ã€å‰¯æœ¬æ§åˆ¶å™¨ã€ç«¯ç‚¹ï¼ˆendpointï¼‰æ§åˆ¶å™¨ä»¥åŠæœåŠ¡è´¦æˆ·ç­‰ã€‚\n- è°ƒåº¦å™¨ï¼šScheduler\n\t- è°ƒåº¦å™¨ä¼šç›‘æ§æ–°å»ºçš„ podsï¼ˆä¸€ç»„æˆ–ä¸€ä¸ªå®¹å™¨ï¼‰å¹¶å°†å…¶åˆ†é…ç»™èŠ‚ç‚¹ã€‚\n\n# Kubernetes çš„å·¥ä½œèŠ‚ç‚¹ï¼ˆWorker Nodeï¼‰\n\n- Kubelet\n\t- è´Ÿè´£è°ƒåº¦åˆ°å¯¹åº”èŠ‚ç‚¹çš„ Pod çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œæ‰§è¡Œä»»åŠ¡å¹¶å°† Pod çŠ¶æ€æŠ¥å‘Šç»™ä¸»èŠ‚ç‚¹çš„æ¸ é“ï¼Œé€šè¿‡å®¹å™¨è¿è¡Œæ—¶ï¼ˆæ‹‰å–é•œåƒã€å¯åŠ¨å’Œåœæ­¢å®¹å™¨ç­‰ï¼‰æ¥è¿è¡Œè¿™äº›å®¹å™¨ã€‚å®ƒè¿˜ä¼šå®šæœŸæ‰§è¡Œè¢«è¯·æ±‚çš„å®¹å™¨çš„å¥åº·æ¢æµ‹ç¨‹åºã€‚\n- Kube-proxy\n\t- å®ƒè´Ÿè´£èŠ‚ç‚¹çš„ç½‘ç»œï¼Œåœ¨ä¸»æœºä¸Šç»´æŠ¤ç½‘ç»œè§„åˆ™å¹¶æ‰§è¡Œè¿æ¥è½¬å‘ã€‚å®ƒè¿˜è´Ÿè´£å¯¹æ­£åœ¨æœåŠ¡çš„ pods è¿›è¡Œè´Ÿè½½å¹³è¡¡ã€‚\n\n# etcd\n\netcd æ˜¯ CoreOS åŸºäº Raft å¼€å‘çš„åˆ†å¸ƒå¼ key-value å­˜å‚¨ï¼Œå¯ç”¨äºæœåŠ¡å‘ç°ã€å…±äº«é…ç½®ä»¥åŠä¸€è‡´æ€§ä¿éšœï¼ˆå¦‚æ•°æ®åº“é€‰ä¸»ã€åˆ†å¸ƒå¼é”ç­‰ï¼‰ã€‚\n\n- åŸºæœ¬çš„ key-value å­˜å‚¨ï¼›\n- ç›‘å¬æœºåˆ¶ï¼›\n- key çš„è¿‡æœŸåŠç»­çº¦æœºåˆ¶ï¼Œç”¨äºç›‘æ§å’ŒæœåŠ¡å‘ç°ï¼›\n- åŸå­ CAS å’Œ CADï¼Œç”¨äºåˆ†å¸ƒå¼é”å’Œ leader é€‰ä¸¾\n\n![image.png](Extras/Images/image_1665770514940_0.png)\n\n# APIServer\n\nKube-APIServer æ˜¯ Kubernetes æœ€é‡è¦çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œä¸»è¦æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š\n\n- æä¾›é›†ç¾¤ç®¡ç†çš„ REST API æ¥å£ï¼ŒåŒ…æ‹¬:\n\t- è®¤è¯ Authenticationï¼›\n\t- æˆæƒ Authorizationï¼›\n\t- å‡†å…¥ Admissionï¼ˆMutating \u0026 Valiatingï¼‰ã€‚\n- æä¾›å…¶ä»–æ¨¡å—ä¹‹é—´çš„æ•°æ®äº¤äº’å’Œé€šä¿¡çš„æ¢çº½ï¼ˆå…¶ä»–æ¨¡å—é€šè¿‡ APIServer æŸ¥è¯¢æˆ–ä¿®æ”¹æ•°æ®ï¼Œåªæœ‰ APIServer æ‰ç›´æ¥æ“ä½œ etcdï¼‰ã€‚\n\t- APIServer æä¾› etcd æ•°æ®ç¼“å­˜ä»¥å‡å°‘é›†ç¾¤å¯¹ etcd çš„è®¿é—®ã€‚\n\n## APIServerå±•å¼€\n\n![image.png](Extras/Images/image_1665770845377_0.png)\n\n# Controller Manager\n\nController Manager æ˜¯é›†ç¾¤çš„å¤§è„‘ï¼Œæ˜¯ç¡®ä¿æ•´ä¸ªé›†ç¾¤åŠ¨èµ·æ¥çš„å…³é”®ï¼›\n\nä½œç”¨æ˜¯ç¡®ä¿ Kubernetes éµå¾ªå£°æ˜å¼ç³»ç»Ÿè§„èŒƒï¼Œç¡®ä¿ç³»ç»Ÿçš„çœŸå®çŠ¶æ€ï¼ˆActualStateï¼‰ä¸ç”¨æˆ·å®šä¹‰çš„æœŸæœ›çŠ¶æ€ï¼ˆDesired Stateï¼‰ä¸€è‡´ï¼›\n\nController Manager æ˜¯å¤šä¸ªæ§åˆ¶å™¨çš„ç»„åˆï¼Œæ¯ä¸ª Controller äº‹å®ä¸Šéƒ½æ˜¯ä¸€ä¸ªcontrol loopï¼Œè´Ÿè´£ä¾¦å¬å…¶ç®¡æ§çš„å¯¹è±¡ï¼Œå½“å¯¹è±¡å‘ç”Ÿå˜æ›´æ—¶å®Œæˆé…ç½®ï¼›\n\nController é…ç½®å¤±è´¥é€šå¸¸ä¼šè§¦å‘è‡ªåŠ¨é‡è¯•ï¼Œæ•´ä¸ªé›†ç¾¤ä¼šåœ¨æ§åˆ¶å™¨ä¸æ–­é‡è¯•çš„æœºåˆ¶ä¸‹ç¡®ä¿æœ€ç»ˆä¸€è‡´æ€§ï¼ˆ **Eventual Consistency**ï¼‰ã€‚\n\n## æ§åˆ¶å™¨çš„ååŒå·¥ä½œåŸç†\n\n![image.png](Extras/Images/image_1665819441936_0.png)\n\n# Scheduler\n\nç‰¹æ®Šçš„ Controllerï¼Œå·¥ä½œåŸç†ä¸å…¶ä»–æ§åˆ¶å™¨æ— å·®åˆ«ã€‚\n\nScheduler çš„ç‰¹æ®ŠèŒè´£åœ¨äºç›‘æ§å½“å‰é›†ç¾¤æ‰€æœ‰æœªè°ƒåº¦çš„ Podï¼Œå¹¶ä¸”è·å–å½“å‰é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹çš„å¥åº·çŠ¶å†µå’Œèµ„æºä½¿ç”¨æƒ…å†µï¼Œä¸ºå¾…è°ƒåº¦ Pod é€‰æ‹©æœ€ä½³è®¡ç®—èŠ‚ç‚¹ï¼Œå®Œæˆè°ƒåº¦ã€‚\n\n**è°ƒåº¦é˜¶æ®µåˆ†ä¸ºï¼š**\n\n- Predictï¼šè¿‡æ»¤ä¸èƒ½æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„èŠ‚ç‚¹ï¼Œå¦‚èµ„æºä¸è¶³ã€ç«¯å£å†²çªç­‰ã€‚\n- Priorityï¼šæŒ‰æ—¢å®šè¦ç´ å°†æ»¡è¶³è°ƒåº¦éœ€æ±‚çš„èŠ‚ç‚¹è¯„åˆ†ï¼Œé€‰æ‹©æœ€ä½³èŠ‚ç‚¹ã€‚\n- Bindï¼šå°†è®¡ç®—èŠ‚ç‚¹ä¸ Pod ç»‘å®šï¼Œå®Œæˆè°ƒåº¦ã€‚\n\n# Kubelet\n\nKubernetes çš„åˆå§‹åŒ–ç³»ç»Ÿï¼ˆinit systemï¼‰\n\n- ä»ä¸åŒæºè·å– Pod æ¸…å•ï¼Œå¹¶æŒ‰éœ€æ±‚å¯åœ Pod çš„æ ¸å¿ƒç»„ä»¶ï¼š\n\t- Pod æ¸…å•å¯ä»æœ¬åœ°æ–‡ä»¶ç›®å½•ï¼Œç»™å®šçš„ HTTPServer æˆ– Kube-APIServer ç­‰æºå¤´è·å–ï¼›\n\t- Kubelet å°†è¿è¡Œæ—¶ï¼Œç½‘ç»œå’Œå­˜å‚¨æŠ½è±¡æˆäº† CRIï¼ŒCNIï¼ŒCSIã€‚\n- è´Ÿè´£æ±‡æŠ¥å½“å‰èŠ‚ç‚¹çš„èµ„æºä¿¡æ¯å’Œå¥åº·çŠ¶æ€ï¼›\n- è´Ÿè´£ Pod çš„å¥åº·æ£€æŸ¥å’ŒçŠ¶æ€æ±‡æŠ¥ã€‚\n\n![image.png](Extras/Images/image_1665820588387_0.png)\n\n# Kube-Proxy\n\nç›‘æ§é›†ç¾¤ä¸­ç”¨æˆ·å‘å¸ƒçš„æœåŠ¡ï¼Œå¹¶å®Œæˆè´Ÿè½½å‡è¡¡é…ç½®ã€‚\n\næ¯ä¸ªèŠ‚ç‚¹çš„ Kube-Proxy éƒ½ä¼šé…ç½®ç›¸åŒçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä½¿å¾—æ•´ä¸ªé›†ç¾¤çš„æœåŠ¡å‘ç°å»ºç«‹åœ¨åˆ†å¸ƒå¼è´Ÿè½½å‡è¡¡å™¨ä¹‹ä¸Šï¼ŒæœåŠ¡è°ƒç”¨æ— éœ€ç»è¿‡é¢å¤–çš„ç½‘ç»œè·³è½¬ï¼ˆNetwork Hopï¼‰ã€‚\n\nè´Ÿè½½å‡è¡¡é…ç½®åŸºäºä¸åŒæ’ä»¶å®ç°ï¼š\n\n- userspaceã€‚\n- æ“ä½œç³»ç»Ÿç½‘ç»œåè®®æ ˆä¸åŒçš„ Hooks ç‚¹å’Œæ’ä»¶ï¼š\n\t- iptablesï¼›\n\t- ipvsã€‚\n\n![image.png](Extras/Images/image_1665820733260_0.png)\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3":{"title":"æ·±å…¥ç†è§£","content":"\n# API è®¾è®¡åŸåˆ™\n\n**æ‰€æœ‰ API éƒ½åº”æ˜¯å£°æ˜å¼çš„**\n\nç›¸å¯¹äºå‘½ä»¤å¼æ“ä½œï¼Œå£°æ˜å¼æ“ä½œå¯¹äºé‡å¤æ“ä½œçš„æ•ˆæœæ˜¯ç¨³å®šçš„ï¼Œè¿™å¯¹äºå®¹æ˜“å‡ºç°æ•°æ®ä¸¢å¤±æˆ–é‡å¤çš„åˆ†å¸ƒå¼ç¯å¢ƒæ¥è¯´æ˜¯å¾ˆé‡è¦çš„ã€‚\n\nå£°æ˜å¼æ“ä½œæ›´æ˜“è¢«ç”¨æˆ·ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç³»ç»Ÿå‘ç”¨æˆ·éšè—å®ç°çš„ç»†èŠ‚ï¼ŒåŒæ—¶ä¹Ÿä¿ç•™äº†ç³»ç»Ÿæœªæ¥æŒç»­ä¼˜åŒ–çš„å¯èƒ½æ€§ã€‚\n\næ­¤å¤–ï¼Œå£°æ˜å¼çš„ API è¿˜éšå«äº†æ‰€æœ‰çš„ API å¯¹è±¡éƒ½æ˜¯åè¯æ€§è´¨çš„ï¼Œä¾‹å¦‚ Serviceã€Volume è¿™äº› API éƒ½æ˜¯åè¯ï¼Œè¿™äº›åè¯æè¿°äº†ç”¨æˆ·æ‰€\n\n**æœŸæœ›å¾—åˆ°çš„ä¸€ä¸ªç›®æ ‡å¯¹è±¡ã€‚**\n\nAPI å¯¹è±¡æ˜¯å½¼æ­¤äº’è¡¥è€Œä¸”å¯ç»„åˆçš„\n\nè¿™å®é™…ä¸Šé¼“åŠ± API å¯¹è±¡å°½é‡å®ç°é¢å‘å¯¹è±¡è®¾è®¡æ—¶çš„è¦æ±‚ï¼Œå³â€œé«˜å†…èšï¼Œæ¾è€¦åˆâ€ï¼Œå¯¹ä¸šåŠ¡ç›¸å…³çš„æ¦‚å¿µæœ‰ä¸€ä¸ªåˆé€‚çš„åˆ†è§£ï¼Œæé«˜åˆ†è§£å‡ºæ¥çš„å¯¹è±¡çš„å¯é‡ç”¨æ€§ã€‚\n\n**é«˜å±‚ API ä»¥æ“ä½œæ„å›¾ä¸ºåŸºç¡€è®¾è®¡**\n\nå¦‚ä½•èƒ½å¤Ÿè®¾è®¡å¥½ APIï¼Œè·Ÿå¦‚ä½•èƒ½ç”¨é¢å‘å¯¹è±¡çš„æ–¹æ³•è®¾è®¡å¥½åº”ç”¨ç³»ç»Ÿæœ‰ç›¸é€šçš„åœ°æ–¹ï¼Œé«˜å±‚è®¾è®¡ä¸€å®šæ˜¯ä»ä¸šåŠ¡å‡ºå‘ï¼Œè€Œä¸æ˜¯è¿‡æ—©çš„ä»æŠ€æœ¯å®ç°å‡ºå‘ã€‚\n\nå› æ­¤ï¼Œé’ˆå¯¹ Kubernetes çš„é«˜å±‚ API è®¾è®¡ï¼Œä¸€å®šæ˜¯ä»¥ Kubernetes çš„ä¸šåŠ¡ä¸ºåŸºç¡€å‡ºå‘ï¼Œä¹Ÿå°±æ˜¯ä»¥ç³»ç»Ÿè°ƒåº¦ç®¡ç†å®¹å™¨çš„æ“ä½œæ„å›¾ä¸ºåŸºç¡€è®¾è®¡\n\n**ä½å±‚ API æ ¹æ®é«˜å±‚ API çš„æ§åˆ¶éœ€è¦è®¾è®¡**\n\nè®¾è®¡å®ç°ä½å±‚ API çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†è¢«é«˜å±‚ API ä½¿ç”¨ï¼Œè€ƒè™‘å‡å°‘å†—ä½™ã€æé«˜é‡ç”¨æ€§çš„ç›®çš„ï¼Œä½å±‚ APIçš„è®¾è®¡ä¹Ÿè¦ä»¥éœ€æ±‚ä¸ºåŸºç¡€ï¼Œè¦å°½é‡æŠµæŠ—å—æŠ€æœ¯å®ç°å½±å“çš„è¯±æƒ‘ã€‚\n\n**å°½é‡é¿å…ç®€å•å°è£…ï¼Œä¸è¦æœ‰åœ¨å¤–éƒ¨ API æ— æ³•æ˜¾å¼çŸ¥é“çš„å†…éƒ¨éšè—çš„æœºåˆ¶**\n\nç®€å•çš„å°è£…ï¼Œå®é™…æ²¡æœ‰æä¾›æ–°çš„åŠŸèƒ½ï¼Œåè€Œå¢åŠ äº†å¯¹æ‰€å°è£… API çš„ä¾èµ–æ€§ã€‚\n\nä¾‹å¦‚ StatefulSet å’Œ ReplicaSetï¼Œæœ¬æ¥å°±æ˜¯ä¸¤ç§ Pod é›†åˆï¼Œé‚£ä¹ˆ Kubernetes å°±ç”¨ä¸åŒ API å¯¹è±¡æ¥å®šä¹‰å®ƒä»¬ï¼Œè€Œä¸ä¼šè¯´åªç”¨åŒä¸€ä¸ª ReplicaSetï¼Œå†…éƒ¨é€šè¿‡ç‰¹æ®Šçš„ç®—æ³•å†æ¥åŒºåˆ†è¿™ä¸ª ReplicaSet æ˜¯æœ‰çŠ¶æ€çš„è¿˜æ˜¯æ— çŠ¶æ€\n\n**API æ“ä½œå¤æ‚åº¦ä¸å¯¹è±¡æ•°é‡æˆæ­£æ¯”**\n\nAPI çš„æ“ä½œå¤æ‚åº¦ä¸èƒ½è¶…è¿‡ O(N)ï¼Œå¦åˆ™ç³»ç»Ÿå°±ä¸å…·å¤‡æ°´å¹³ä¼¸ç¼©æ€§äº†ã€‚\n\n**API å¯¹è±¡çŠ¶æ€ä¸èƒ½ä¾èµ–äºç½‘ç»œè¿æ¥çŠ¶æ€**\n\nç”±äºä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œç½‘ç»œè¿æ¥æ–­å¼€æ˜¯ç»å¸¸å‘ç”Ÿçš„äº‹æƒ…ï¼Œå› æ­¤è¦ä¿è¯ API å¯¹è±¡çŠ¶æ€èƒ½åº”å¯¹ç½‘ç»œçš„ä¸ç¨³å®šï¼ŒAPI å¯¹è±¡çš„çŠ¶æ€å°±ä¸èƒ½ä¾èµ–äºç½‘ç»œè¿æ¥çŠ¶æ€ã€‚\n\n**å°½é‡é¿å…è®©æ“ä½œæœºåˆ¶ä¾èµ–äºå…¨å±€çŠ¶æ€**\n\nå› ä¸ºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¦ä¿è¯å…¨å±€çŠ¶æ€çš„åŒæ­¥æ˜¯éå¸¸å›°éš¾çš„ã€‚\n\n# Kubernetes å¦‚ä½•é€šè¿‡å¯¹è±¡çš„ç»„åˆå®Œæˆä¸šåŠ¡æè¿°\n\n![image.png](Extras/Images/image_1665825319357_0.png)\n\n# æ¶æ„è®¾è®¡åŸåˆ™\n\nåªæœ‰ APIServer å¯ä»¥ç›´æ¥è®¿é—® etcd å­˜å‚¨ï¼Œå…¶ä»–æœåŠ¡å¿…é¡»é€šè¿‡ Kubernetes API æ¥è®¿é—®é›†ç¾¤çŠ¶æ€ï¼›\n\nå•èŠ‚ç‚¹æ•…éšœä¸åº”è¯¥å½±å“é›†ç¾¤çš„çŠ¶æ€ï¼›\n\nåœ¨æ²¡æœ‰æ–°è¯·æ±‚çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç»„ä»¶åº”è¯¥åœ¨æ•…éšœæ¢å¤åç»§ç»­æ‰§è¡Œä¸Šæ¬¡æœ€åæ”¶åˆ°çš„è¯·æ±‚ï¼ˆæ¯”å¦‚ç½‘ç»œåˆ†åŒºæˆ–æœåŠ¡é‡å¯ç­‰ï¼‰ï¼›\n\næ‰€æœ‰ç»„ä»¶éƒ½åº”è¯¥åœ¨å†…å­˜ä¸­ä¿æŒæ‰€éœ€è¦çš„çŠ¶æ€ï¼ŒAPIServer å°†çŠ¶æ€å†™å…¥ etcd å­˜å‚¨ï¼Œè€Œå…¶ä»–ç»„ä»¶åˆ™é€šè¿‡ APIServer æ›´æ–°å¹¶ç›‘å¬æ‰€æœ‰çš„å˜åŒ–ï¼›\n\nä¼˜å…ˆä½¿ç”¨äº‹ä»¶ç›‘å¬è€Œä¸æ˜¯è½®è¯¢ã€‚\n\n# å¼•å¯¼ï¼ˆBootstrappingï¼‰åŸåˆ™\n\n- Self-hosting æ˜¯ç›®æ ‡ã€‚\n- å‡å°‘ä¾èµ–ï¼Œç‰¹åˆ«æ˜¯ç¨³æ€è¿è¡Œçš„ä¾èµ–ã€‚\n- é€šè¿‡åˆ†å±‚çš„åŸåˆ™ç®¡ç†ä¾èµ–ã€‚\n- å¾ªç¯ä¾èµ–é—®é¢˜çš„åŸåˆ™ï¼š\n\t- åŒæ—¶è¿˜æ¥å—å…¶ä»–æ–¹å¼çš„æ•°æ®è¾“å…¥ï¼ˆæ¯”å¦‚æœ¬åœ°æ–‡ä»¶ç­‰ï¼‰ï¼Œè¿™æ ·åœ¨å…¶ä»–æœåŠ¡ä¸å¯ç”¨æ—¶è¿˜å¯ä»¥æ‰‹åŠ¨é…ç½®å¼•å¯¼æœåŠ¡ï¼›\n\t- çŠ¶æ€åº”è¯¥æ˜¯å¯æ¢å¤æˆ–å¯é‡æ–°å‘ç°çš„ï¼›\n\t- æ”¯æŒç®€å•çš„å¯åŠ¨ä¸´æ—¶å®ä¾‹æ¥åˆ›å»ºç¨³æ€è¿è¡Œæ‰€éœ€è¦çš„çŠ¶æ€ï¼Œä½¿ç”¨åˆ†å¸ƒå¼é”æˆ–æ–‡ä»¶é”ç­‰æ¥åè°ƒä¸åŒçŠ¶æ€çš„åˆ‡æ¢ï¼ˆé€šå¸¸ç§°ä¸º pivoting æŠ€æœ¯ï¼‰ï¼›\n\t- è‡ªåŠ¨é‡å¯å¼‚å¸¸é€€å‡ºçš„æœåŠ¡ï¼Œæ¯”å¦‚å‰¯æœ¬æˆ–è€…è¿›ç¨‹ç®¡ç†å™¨ç­‰ã€‚\n\n# æ ¸å¿ƒæŠ€æœ¯æ¦‚å¿µå’Œ API å¯¹è±¡\n\nAPI å¯¹è±¡æ˜¯ Kubernetes é›†ç¾¤ä¸­çš„ç®¡ç†æ“ä½œå•å…ƒã€‚\n\nKubernetes é›†ç¾¤ç³»ç»Ÿæ¯æ”¯æŒä¸€é¡¹æ–°åŠŸèƒ½ï¼Œå¼•å…¥ä¸€é¡¹æ–°æŠ€æœ¯ï¼Œä¸€å®šä¼šæ–°å¼•å…¥å¯¹åº”çš„ API å¯¹è±¡ï¼Œæ”¯æŒå¯¹è¯¥åŠŸèƒ½çš„ç®¡ç†æ“ä½œã€‚\n\næ¯ä¸ª API å¯¹è±¡éƒ½æœ‰å››å¤§ç±»å±æ€§ï¼š\n\n- TypeMeta\n- MetaData\n- Spec\n- Status\n\n## TypeMeta\n\nKuberneteså¯¹è±¡çš„æœ€åŸºæœ¬å®šä¹‰ï¼Œå®ƒé€šè¿‡å¼•å…¥GKVï¼ˆGroupï¼ŒKindï¼ŒVersionï¼‰æ¨¡å‹å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡çš„ç±»å‹ã€‚\n\n**1. Group**\n\nKubernetes å®šä¹‰äº†éå¸¸å¤šçš„å¯¹è±¡ï¼Œå¦‚ä½•å°†è¿™äº›å¯¹è±¡è¿›è¡Œå½’ç±»æ˜¯ä¸€é—¨å­¦é—®ï¼Œ**å°†å¯¹è±¡ä¾æ®å…¶åŠŸèƒ½èŒƒå›´å½’å…¥ä¸åŒçš„åˆ†ç»„ï¼Œæ¯”å¦‚æŠŠæ”¯æ’‘æœ€åŸºæœ¬åŠŸèƒ½çš„å¯¹è±¡å½’å…¥ core ç»„ï¼ŒæŠŠä¸åº”ç”¨éƒ¨ç½²æœ‰å…³çš„å¯¹è±¡å½’å…¥ apps ç»„ï¼Œ** ä¼šä½¿è¿™äº›å¯¹è±¡çš„å¯ç»´æŠ¤æ€§å’Œå¯ç†è§£æ€§æ›´é«˜ã€‚\n\n**2. Kind**\n\nå®šä¹‰ä¸€ä¸ªå¯¹è±¡çš„åŸºæœ¬ç±»å‹ï¼Œæ¯”å¦‚ Nodeã€Podã€Deployment ç­‰ã€‚\n\n**3. Version**\n\nç¤¾åŒºæ¯ä¸ªå­£åº¦ä¼šæ¨å‡ºä¸€ä¸ª Kubernetes ç‰ˆæœ¬ï¼Œéšç€ Kubernetes ç‰ˆæœ¬çš„æ¼”è¿›ï¼Œå¯¹è±¡ä»åˆ›å»ºä¹‹åˆåˆ°èƒ½å¤Ÿå®Œå…¨ç”Ÿäº§åŒ–å°±ç»ªçš„ç‰ˆæœ¬æ˜¯ä¸æ–­å˜åŒ–çš„ã€‚ä¸è½¯ä»¶ç‰ˆæœ¬ç±»ä¼¼ï¼Œé€šå¸¸ç¤¾åŒºæå‡ºä¸€ä¸ªæ¨¡å‹å®šä¹‰ä»¥åï¼Œéšç€è¯¥å¯¹è±¡ä¸æ–­æˆç†Ÿï¼Œå…¶ç‰ˆæœ¬å¯èƒ½ä¼šä» v1alpha1 åˆ° v1alpha2ï¼Œæˆ–è€…åˆ° v1beta1ï¼Œæœ€ç»ˆå˜æˆç”Ÿäº§å°±ç»ªç‰ˆæœ¬ v1ã€‚\n\n## MetaData\n\nMetadata ä¸­æœ‰ä¸¤ä¸ªæœ€é‡è¦çš„å±æ€§ï¼š**Namespaceå’ŒName**ï¼Œåˆ†åˆ«å®šä¹‰äº†å¯¹è±¡çš„Namespace å½’å±åŠåå­—ï¼Œ**è¿™ä¸¤ä¸ªå±æ€§å”¯ä¸€å®šä¹‰äº†æŸä¸ªå¯¹è±¡å®ä¾‹ã€‚**\n\n1. Label\n\né¡¾åæ€ä¹‰å°±æ˜¯ç»™å¯¹è±¡æ‰“æ ‡ç­¾ï¼Œä¸€ä¸ªå¯¹è±¡å¯ä»¥æœ‰ä»»æ„å¯¹æ ‡ç­¾ï¼Œå…¶å­˜åœ¨å½¢å¼æ˜¯é”®å€¼å¯¹ã€‚Label å®šä¹‰äº†å¯¹è±¡çš„å¯è¯†åˆ«å±æ€§ï¼ŒKubernetes API æ”¯æŒä»¥ Label ä½œä¸ºè¿‡æ»¤æ¡ä»¶æŸ¥è¯¢å¯¹è±¡ã€‚\n\n2. Annotation\n\nAnnotation ä¸ Label ä¸€æ ·ç”¨é”®å€¼å¯¹æ¥å®šä¹‰ï¼Œä½† Annotation æ˜¯ä½œä¸ºå±æ€§æ‰©å±•ï¼Œæ›´å¤šé¢å‘äºç³»ç»Ÿç®¡ç†å‘˜å’Œå¼€å‘äººå‘˜ï¼Œå› æ­¤éœ€è¦åƒå…¶ä»–å±æ€§ä¸€æ ·åšåˆç†å½’ç±»ã€‚\n\n3. Finalizer\n\nFinalizer æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªèµ„æºé”ï¼ŒKubernetes åœ¨æ¥æ”¶æŸå¯¹è±¡çš„åˆ é™¤è¯·æ±‚æ—¶ï¼Œä¼šæ£€æŸ¥ Finalizer æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºåˆ™åªå¯¹å…¶åšé€»è¾‘åˆ é™¤ï¼Œå³åªä¼šæ›´æ–°å¯¹è±¡ä¸­çš„metadata.deletionTimestamp å­—æ®µã€‚\n\n4. ResourceVersion\n\nResourceVersion å¯ä»¥è¢«çœ‹ä½œä¸€ç§ä¹è§‚é”ï¼Œæ¯ä¸ªå¯¹è±¡åœ¨ä»»æ„æ—¶åˆ»éƒ½æœ‰å…¶ResourceVersionï¼Œå½“ Kubernetes å¯¹è±¡è¢«å®¢æˆ·ç«¯è¯»å–ä»¥åï¼ŒResourceVersionä¿¡æ¯ä¹Ÿè¢«ä¸€å¹¶è¯»å–ã€‚æ­¤æœºåˆ¶ç¡®ä¿äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä»»æ„å¤šçº¿ç¨‹èƒ½å¤Ÿæ— é”å¹¶å‘è®¿é—®å¯¹è±¡ï¼Œæå¤§æå‡äº†ç³»ç»Ÿçš„æ•´ä½“æ•ˆç‡ã€‚\n\n### Label\n\nLabel æ˜¯è¯†åˆ« Kubernetes å¯¹è±¡çš„æ ‡ç­¾ï¼Œä»¥ key/value çš„æ–¹å¼é™„åŠ åˆ°å¯¹è±¡ä¸Šã€‚\n\nkey æœ€é•¿ä¸èƒ½è¶…è¿‡ 63 å­—èŠ‚ï¼Œvalue å¯ä»¥ä¸ºç©ºï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸è¶…è¿‡ 253 å­—èŠ‚çš„å­—ç¬¦ä¸²ã€‚\n\nLabel ä¸æä¾›å”¯ä¸€æ€§ï¼Œå¹¶ä¸”å®é™…ä¸Šç»å¸¸æ˜¯å¾ˆå¤šå¯¹è±¡ï¼ˆå¦‚ Podsï¼‰éƒ½ä½¿ç”¨ç›¸åŒçš„ label æ¥æ ‡å¿—å…·ä½“çš„åº”ç”¨ã€‚\n\nLabel å®šä¹‰å¥½åå…¶ä»–å¯¹è±¡å¯ä»¥ä½¿ç”¨ Label Selector æ¥é€‰æ‹©ä¸€ç»„ç›¸åŒ label çš„å¯¹è±¡\n\n![image.png](Extras/Images/image_1665835918391_0.png)\n\nLabel Selector æ”¯æŒä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š\n\n- ç­‰å¼ï¼Œå¦‚ app=nginx å’Œ env!=productionï¼›\n- é›†åˆï¼Œå¦‚ env in (production, qa)ï¼›\n- å¤šä¸ª labelï¼ˆå®ƒä»¬ä¹‹é—´æ˜¯ AND å…³ç³»ï¼‰ï¼Œå¦‚ app=nginx,env=testã€‚\n\n### Annotation\n\nAnnotations æ˜¯ key/value å½¢å¼é™„åŠ äºå¯¹è±¡çš„æ³¨è§£ã€‚\n\nä¸åŒäº Labels ç”¨äºæ ‡å¿—å’Œé€‰æ‹©å¯¹è±¡ï¼ŒAnnotations åˆ™æ˜¯ç”¨æ¥è®°å½•ä¸€äº›é™„åŠ ä¿¡æ¯ï¼Œç”¨æ¥è¾…åŠ©åº”ç”¨éƒ¨ç½²ã€å®‰å…¨ç­–ç•¥ä»¥åŠè°ƒåº¦ç­–ç•¥ç­‰ã€‚\n\næ¯”å¦‚ deployment ä½¿ç”¨ annotations æ¥è®°å½• rolling update çš„çŠ¶æ€ã€‚\n\n## Spec å’Œ Status\n\nSpec å’Œ Status æ‰æ˜¯å¯¹è±¡çš„æ ¸å¿ƒã€‚\n\nSpec æ˜¯ç”¨æˆ·çš„æœŸæœ›çŠ¶æ€ï¼Œç”±åˆ›å»ºå¯¹è±¡çš„ç”¨æˆ·ç«¯æ¥å®šä¹‰ã€‚\n\nStatus æ˜¯å¯¹è±¡çš„å®é™…çŠ¶æ€ï¼Œç”±å¯¹åº”çš„æ§åˆ¶å™¨æ”¶é›†å®é™…çŠ¶æ€å¹¶æ›´æ–°ã€‚\n\nä¸ TypeMeta å’Œ Metadata ç­‰é€šç”¨å±æ€§ä¸åŒï¼ŒSpec å’Œ Status æ˜¯æ¯ä¸ªå¯¹è±¡ç‹¬æœ‰çš„ã€‚\n\n## å¸¸ç”¨ Kubernetes å¯¹è±¡åŠå…¶åˆ†ç»„\n\n![image.png](Extras/Images/image_1665836531393_0.png)\n\n# æ ¸å¿ƒå¯¹è±¡æ¦‚è§ˆ\n\n## Node\n\nNode æ˜¯ Pod çœŸæ­£è¿è¡Œçš„ä¸»æœºï¼Œå¯ä»¥ç‰©ç†æœºï¼Œä¹Ÿå¯ä»¥æ˜¯è™šæ‹Ÿæœºã€‚\n\nä¸ºäº†ç®¡ç† Podï¼Œæ¯ä¸ª Node èŠ‚ç‚¹ä¸Šè‡³å°‘è¦è¿è¡Œ container runtimeï¼ˆæ¯”å¦‚ Docker æˆ–è€… Rktï¼‰ã€Kubelet å’Œ Kube-proxy æœåŠ¡ã€‚\n\n## Namespace\n\n**Namespace æ˜¯å¯¹ä¸€ç»„èµ„æºå’Œå¯¹è±¡çš„æŠ½è±¡é›†åˆ**ï¼Œæ¯”å¦‚å¯ä»¥ç”¨æ¥å°†ç³»ç»Ÿå†…éƒ¨çš„å¯¹è±¡åˆ’åˆ†ä¸ºä¸åŒçš„é¡¹ç›®ç»„æˆ–ç”¨æˆ·ç»„ã€‚\n\nå¸¸è§çš„ pods, services, replication controllers å’Œ deployments ç­‰éƒ½æ˜¯å±äºæŸä¸€ä¸ª Namespace çš„ï¼ˆé»˜è®¤æ˜¯ defaultï¼‰ï¼Œè€Œ Node, persistentVolumesç­‰åˆ™ä¸å±äºä»»ä½• Namespaceã€‚\n\n## ä»€ä¹ˆæ˜¯ Pod\n\nPod æ˜¯ä¸€ç»„ç´§å¯†å…³è”çš„å®¹å™¨é›†åˆï¼Œå®ƒä»¬å…±äº« PIDã€IPCã€Network å’Œ UTS namespaceï¼Œæ˜¯ Kubernetesè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚\n\nPod çš„è®¾è®¡ç†å¿µæ˜¯æ”¯æŒå¤šä¸ªå®¹å™¨åœ¨ä¸€ä¸ª Pod ä¸­å…±äº«ç½‘ç»œå’Œæ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡è¿›ç¨‹é—´é€šä¿¡å’Œæ–‡ä»¶å…±äº«è¿™ç§ç®€å•é«˜æ•ˆçš„æ–¹å¼ç»„åˆå®ŒæˆæœåŠ¡ã€‚\n\nåŒä¸€ä¸ª Pod ä¸­çš„ä¸åŒå®¹å™¨å¯å…±äº«èµ„æºï¼š\n\n- å…±äº«ç½‘ç»œ Namespaceï¼›\n- å¯é€šè¿‡æŒ‚è½½å­˜å‚¨å·å…±äº«å­˜å‚¨ï¼›\n- å…±äº« Security Contextã€‚\n\n## å¦‚ä½•é€šè¿‡ Pod å¯¹è±¡å®šä¹‰æ”¯æ’‘åº”ç”¨è¿è¡Œ\n\nç¯å¢ƒå˜é‡ï¼š\n\n- ç›´æ¥è®¾ç½®å€¼ï¼›\n- è¯»å– Pod Spec çš„æŸäº›å±æ€§ï¼›\n- ä» ConfigMap è¯»å–æŸä¸ªå€¼ï¼›\n- ä» Secret è¯»å–æŸä¸ªå€¼ã€‚\n\n![image.png](Extras/Images/image_1665837588972_0.png)\n\n## å­˜å‚¨å·\n\né€šè¿‡å­˜å‚¨å·å¯ä»¥å°†å¤–æŒ‚å­˜å‚¨æŒ‚è½½åˆ° Pod å†…éƒ¨ä½¿ç”¨ã€‚\n\nå­˜å‚¨å·å®šä¹‰åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†: Volume å’Œ VolumeMountsã€‚\n\n- Volumeï¼šå®šä¹‰ Pod å¯ä»¥ä½¿ç”¨çš„å­˜å‚¨å·æ¥æºï¼›\n- VolumeMountsï¼šå®šä¹‰å­˜å‚¨å·å¦‚ä½• Mount åˆ°å®¹å™¨å†…éƒ¨ã€‚\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\nname: hello-volume\nspec:\ncontainers:\n- image: nginx:1.15\nname: nginx\nvolumeMounts: - name: data\nmountPath: /data\nvolumes:\n- name: data\nemptyDir: {}\n```\n\n## Pod ç½‘ç»œ\n\nPodçš„å¤šä¸ªå®¹å™¨æ˜¯å…±äº«ç½‘ç»œ Namespace çš„ï¼Œè¿™æ„å‘³ç€ï¼š\n\nåŒä¸€ä¸ª Pod ä¸­çš„ä¸åŒå®¹å™¨å¯ä»¥å½¼æ­¤é€šè¿‡ Loopback åœ°å€è®¿é—®ï¼š\n\n- åœ¨ç¬¬ä¸€ä¸ªå®¹å™¨ä¸­èµ·äº†ä¸€ä¸ªæœåŠ¡ http://127.0.0.1 ã€‚\n- åœ¨ç¬¬äºŒä¸ªå®¹å™¨å†…ï¼Œæ˜¯å¯ä»¥é€šè¿‡ httpGet http://127.0.0.1 è®¿é—®åˆ°è¯¥åœ°å€çš„ã€‚\n\nè¿™ç§æ–¹æ³•å¸¸ç”¨äºä¸åŒå®¹å™¨çš„äº’ç›¸åä½œã€‚\n\n## èµ„æºé™åˆ¶\n\nKubernetes é€šè¿‡ Cgroups æä¾›å®¹å™¨èµ„æºç®¡ç†çš„åŠŸèƒ½ï¼Œå¯ä»¥é™åˆ¶æ¯ä¸ªå®¹å™¨çš„CPU å’Œå†…å­˜ä½¿ç”¨ï¼Œæ¯”å¦‚å¯¹äºåˆšæ‰åˆ›å»ºçš„ deploymentï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤é™åˆ¶nginx å®¹å™¨æœ€å¤šåªç”¨ 50% çš„ CPU å’Œ 128MB çš„å†…å­˜ï¼š\n\n```bash\n$ kubectl set resources deployment nginx-app -c=nginx --\nlimits=cpu=500m,memory=128Mi\ndeployment \"nginx\" resource requirements updated\n```\n\n## å¥åº·æ£€æŸ¥\n\nKubernetes ä½œä¸ºä¸€ä¸ªé¢å‘åº”ç”¨çš„é›†ç¾¤ç®¡ç†å·¥å…·ï¼Œéœ€è¦ç¡®ä¿å®¹å™¨åœ¨éƒ¨ç½²åç¡®å®å¤„åœ¨æ­£å¸¸çš„è¿è¡ŒçŠ¶æ€ã€‚\n\n1. æ¢é’ˆç±»å‹ï¼š\n\t- LivenessProbe\n\t\t- æ¢æµ‹åº”ç”¨æ˜¯å¦å¤„äºå¥åº·çŠ¶æ€ï¼Œå¦‚æœä¸å¥åº·åˆ™åˆ é™¤å¹¶é‡æ–°åˆ›å»ºå®¹å™¨ã€‚\n\t- ReadinessProbe\n\t\t- æ¢æµ‹åº”ç”¨æ˜¯å¦å°±ç»ªå¹¶ä¸”å¤„äºæ­£å¸¸æœåŠ¡çŠ¶æ€ï¼Œå¦‚æœä¸æ­£å¸¸åˆ™ä¸ä¼šæ¥æ”¶æ¥è‡ª Kubernetes Service çš„æµé‡ã€‚\n\t- StartupProbe\n\t\t- æ¢æµ‹åº”ç”¨æ˜¯å¦å¯åŠ¨å®Œæˆï¼Œå¦‚æœåœ¨ failureThreshold\\*periodSeconds å‘¨æœŸå†…æœªå°±ç»ªï¼Œåˆ™ä¼šåº”ç”¨è¿›ç¨‹ä¼šè¢«é‡å¯ã€‚\n1. æ¢æ´»æ–¹å¼ï¼š\n\t- Exec\n\t- TCP socket\n\t- HTTP\n\n## Configmap\n\nConfigMap ç”¨æ¥å°†éæœºå¯†æ€§çš„æ•°æ®ä¿å­˜åˆ°é”®å€¼å¯¹ä¸­ã€‚\n\nä½¿ç”¨æ—¶ï¼Œ Pods å¯ä»¥å°†å…¶ç”¨ä½œç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°æˆ–è€…å­˜å‚¨å·ä¸­çš„é…ç½®æ–‡ä»¶ã€‚\n\nConfigMap å°†ç¯å¢ƒé…ç½®ä¿¡æ¯å’Œ å®¹å™¨é•œåƒè§£è€¦ï¼Œä¾¿äºåº”ç”¨é…ç½®çš„ä¿®æ”¹\n\n## å¯†é’¥å¯¹è±¡ï¼ˆSecretï¼‰\n\nSecret æ˜¯ç”¨æ¥ä¿å­˜å’Œä¼ é€’å¯†ç ã€å¯†é’¥ã€è®¤è¯å‡­è¯è¿™äº›æ•æ„Ÿä¿¡æ¯çš„å¯¹è±¡ã€‚\n\nä½¿ç”¨ Secret çš„å¥½å¤„æ˜¯å¯ä»¥é¿å…æŠŠæ•æ„Ÿä¿¡æ¯æ˜æ–‡å†™åœ¨é…ç½®æ–‡ä»¶é‡Œã€‚\n\nKubernetes é›†ç¾¤ä¸­é…ç½®å’Œä½¿ç”¨æœåŠ¡ä¸å¯é¿å…çš„è¦ç”¨åˆ°å„ç§æ•æ„Ÿä¿¡æ¯å®ç°ç™»å½•ã€è®¤è¯ç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚è®¿é—® AWS å­˜å‚¨çš„ç”¨æˆ·åå¯†ç ã€‚\n\nä¸ºäº†é¿å…å°†ç±»ä¼¼çš„æ•æ„Ÿä¿¡æ¯æ˜æ–‡å†™åœ¨æ‰€æœ‰éœ€è¦ä½¿ç”¨çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥å°†è¿™äº›ä¿¡æ¯å­˜å…¥ä¸€ä¸ª Secret å¯¹è±¡ï¼Œè€Œåœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡ Secret å¯¹è±¡å¼•ç”¨è¿™äº›æ•æ„Ÿä¿¡æ¯ã€‚\n\nè¿™ç§æ–¹å¼çš„å¥½å¤„åŒ…æ‹¬ï¼šæ„å›¾æ˜ç¡®ï¼Œé¿å…é‡å¤ï¼Œå‡å°‘æš´æ¼æœºä¼šã€‚\n\n## ç”¨æˆ·ï¼ˆUser Accountï¼‰\u0026 æœåŠ¡å¸æˆ·ï¼ˆService Accountï¼‰\n\né¡¾åæ€ä¹‰ï¼Œç”¨æˆ·å¸æˆ·ä¸ºäººæä¾›è´¦æˆ·æ ‡è¯†ï¼Œè€ŒæœåŠ¡è´¦æˆ·ä¸ºè®¡ç®—æœºè¿›ç¨‹å’Œ Kubernetes é›†ç¾¤ä¸­è¿è¡Œçš„ Pod æä¾›è´¦æˆ·æ ‡è¯†ã€‚\n\n**ç”¨æˆ·å¸æˆ·å’ŒæœåŠ¡å¸æˆ·çš„ä¸€ä¸ªåŒºåˆ«æ˜¯ä½œç”¨èŒƒå›´ï¼š**\n\n- ç”¨æˆ·å¸æˆ·å¯¹åº”çš„æ˜¯äººçš„èº«ä»½ï¼Œäººçš„èº«ä»½ä¸æœåŠ¡çš„ Namespace æ— å…³ï¼Œæ‰€ä»¥ç”¨æˆ·è´¦æˆ·æ˜¯è·¨Namespace çš„ï¼›\n- è€ŒæœåŠ¡å¸æˆ·å¯¹åº”çš„æ˜¯ä¸€ä¸ªè¿è¡Œä¸­ç¨‹åºçš„èº«ä»½ï¼Œä¸ç‰¹å®š Namespace æ˜¯ç›¸å…³çš„ã€‚\n\n## Service\n\nService æ˜¯åº”ç”¨æœåŠ¡çš„æŠ½è±¡ï¼Œé€šè¿‡ labels ä¸ºåº”ç”¨æä¾›è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘ç°ã€‚åŒ¹é… labels çš„ Pod IP å’Œç«¯å£åˆ—è¡¨ç»„æˆ endpointsï¼Œç”± Kube-proxy è´Ÿè´£å°†æœåŠ¡IP è´Ÿè½½å‡è¡¡åˆ°è¿™äº› endpoints ä¸Šã€‚\n\næ¯ä¸ª Service éƒ½ä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ª cluster IPï¼ˆä»…åœ¨é›†ç¾¤å†…éƒ¨å¯è®¿é—®çš„è™šæ‹Ÿåœ°å€ï¼‰å’Œ DNS åï¼Œå…¶ä»–å®¹å™¨å¯ä»¥é€šè¿‡è¯¥åœ°å€æˆ– DNS æ¥è®¿é—®æœåŠ¡ï¼Œè€Œä¸éœ€è¦äº†è§£åç«¯å®¹å™¨çš„è¿è¡Œã€‚\n\n![image.png](Extras/Images/image_1665839447998_0.png)\n\n## å‰¯æœ¬é›†ï¼ˆReplica Setï¼‰\n\nPod åªæ˜¯å•ä¸ªåº”ç”¨å®ä¾‹çš„æŠ½è±¡ï¼Œè¦æ„å»ºé«˜å¯ç”¨åº”ç”¨ï¼Œé€šå¸¸éœ€è¦æ„å»ºå¤šä¸ªåŒæ ·çš„å‰¯æœ¬ï¼Œæä¾›åŒä¸€ä¸ªæœåŠ¡ã€‚\n\nKubernetes ä¸ºæ­¤æŠ½è±¡å‡ºå‰¯æœ¬é›† ReplicaSetï¼Œå…¶å…è®¸ç”¨æˆ·å®šä¹‰ Pod çš„å‰¯æœ¬æ•°ï¼Œæ¯ä¸€ä¸ª Pod éƒ½ä¼šè¢«å½“ä½œä¸€ä¸ªæ— çŠ¶æ€çš„æˆå‘˜è¿›è¡Œç®¡ç†ï¼ŒKubernetes ä¿è¯æ€»æ˜¯æœ‰ç”¨æˆ·æœŸæœ›çš„æ•°é‡çš„ Pod æ­£å¸¸è¿è¡Œã€‚\n\nå½“æŸä¸ªå‰¯æœ¬å®•æœºä»¥åï¼Œæ§åˆ¶å™¨å°†ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å‰¯æœ¬ã€‚\n\nå½“å› ä¸šåŠ¡è´Ÿè½½å‘ç”Ÿå˜æ›´è€Œéœ€è¦è°ƒæ•´æ‰©ç¼©å®¹æ—¶ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è°ƒæ•´å‰¯æœ¬æ•°é‡ã€‚\n\n## éƒ¨ç½²ï¼ˆDeploymentï¼‰\n\néƒ¨ç½²è¡¨ç¤ºç”¨æˆ·å¯¹ Kubernetes é›†ç¾¤çš„ä¸€æ¬¡æ›´æ–°æ“ä½œã€‚\n\néƒ¨ç½²æ˜¯ä¸€ä¸ªæ¯” RS åº”ç”¨æ¨¡å¼æ›´å¹¿çš„ API å¯¹è±¡ï¼Œå¯ä»¥æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„æœåŠ¡ï¼Œæ›´æ–°ä¸€ä¸ªæ–°çš„æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜¯æ»šåŠ¨å‡çº§ä¸€ä¸ªæœåŠ¡ã€‚\n\næ»šåŠ¨å‡çº§ä¸€ä¸ªæœåŠ¡ï¼Œå®é™…æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ RSï¼Œç„¶åé€æ¸å°†æ–° RS ä¸­å‰¯æœ¬æ•°å¢åŠ åˆ°ç†æƒ³çŠ¶æ€ï¼Œå°†æ—§ RS ä¸­çš„å‰¯æœ¬æ•°å‡å°åˆ° 0 çš„å¤åˆæ“ä½œã€‚\n\nè¿™æ ·ä¸€ä¸ªå¤åˆæ“ä½œç”¨ä¸€ä¸ª RS æ˜¯ä¸å¤ªå¥½æè¿°çš„ï¼Œæ‰€ä»¥ç”¨ä¸€ä¸ªæ›´é€šç”¨çš„ Deployment æ¥æè¿°ã€‚\n\nä»¥ Kubernetes çš„å‘å±•æ–¹å‘ï¼Œæœªæ¥å¯¹æ‰€æœ‰é•¿æœŸä¼ºæœå‹çš„çš„ä¸šåŠ¡çš„ç®¡ç†ï¼Œéƒ½ä¼šé€šè¿‡ Deployment æ¥ç®¡ç†ã€‚\n\n![image.png](Extras/Images/image_1665839670775_0.png)\n\n## æœ‰çŠ¶æ€æœåŠ¡é›†ï¼ˆStatefulSetï¼‰\n\nå¯¹äº StatefulSet ä¸­çš„ Podï¼Œæ¯ä¸ª Pod æŒ‚è½½è‡ªå·±ç‹¬ç«‹çš„å­˜å‚¨ï¼Œå¦‚æœä¸€ä¸ª Pod å‡ºç°æ•…éšœï¼Œä»å…¶ä»–èŠ‚ç‚¹å¯åŠ¨ä¸€ä¸ªåŒæ ·åå­—çš„Podï¼Œè¦æŒ‚è½½ä¸ŠåŸæ¥ Pod çš„å­˜å‚¨ç»§ç»­ä»¥å®ƒçš„çŠ¶æ€æä¾›æœåŠ¡ã€‚\n\né€‚åˆäº StatefulSet çš„ä¸šåŠ¡åŒ…æ‹¬æ•°æ®åº“æœåŠ¡ MySQL å’Œ PostgreSQLï¼Œé›†ç¾¤åŒ–ç®¡ç†æœåŠ¡ ZooKeeperã€etcd ç­‰æœ‰çŠ¶æ€æœåŠ¡ã€‚\n\nä½¿ç”¨ StatefulSetï¼ŒPod ä»ç„¶å¯ä»¥é€šè¿‡æ¼‚ç§»åˆ°ä¸åŒèŠ‚ç‚¹æä¾›é«˜å¯ç”¨ï¼Œè€Œå­˜å‚¨ä¹Ÿå¯ä»¥é€šè¿‡å¤–æŒ‚çš„å­˜å‚¨æ¥æä¾›é«˜å¯é æ€§ï¼ŒStatefulSet åšçš„åªæ˜¯å°†ç¡®å®šçš„ Pod ä¸ç¡®å®šçš„å­˜å‚¨å…³è”èµ·æ¥ä¿è¯çŠ¶æ€çš„è¿ç»­æ€§ã€‚\n\n![image.png](Extras/Images/image_1665839742250_0.png)\n\n## Statefulset ä¸ Deployment çš„å·®å¼‚\n\n- èº«ä»½æ ‡è¯†\n\t- StatefulSet Controller ä¸ºæ¯ä¸ª Pod ç¼–å·ï¼Œåºå·ä»0å¼€å§‹ã€‚\n- æ•°æ®å­˜å‚¨\n\t- StatefulSet å…è®¸ç”¨æˆ·å®šä¹‰ volumeClaimTemplatesï¼ŒPod è¢«åˆ›å»ºçš„åŒæ—¶ï¼ŒKubernetes ä¼šä»¥volumeClaimTemplates ä¸­å®šä¹‰çš„æ¨¡æ¿åˆ›å»ºå­˜å‚¨å·ï¼Œå¹¶æŒ‚è½½ç»™ Podã€‚\n- StatefulSet çš„å‡çº§ç­–ç•¥ä¸åŒ\n\t- onDelete\n\t- æ»šåŠ¨å‡çº§\n\t- åˆ†ç‰‡å‡çº§\n\n## ä»»åŠ¡ï¼ˆJobï¼‰\n\nJob æ˜¯ Kubernetes ç”¨æ¥æ§åˆ¶æ‰¹å¤„ç†å‹ä»»åŠ¡çš„ API å¯¹è±¡ã€‚\n\nJob ç®¡ç†çš„ Pod æ ¹æ®ç”¨æˆ·çš„è®¾ç½®æŠŠä»»åŠ¡æˆåŠŸå®Œæˆåå°±è‡ªåŠ¨é€€å‡ºã€‚\n\næˆåŠŸå®Œæˆçš„æ ‡å¿—æ ¹æ®ä¸åŒçš„ spec.completions ç­–ç•¥è€Œä¸åŒï¼š\n\n- å• Pod å‹ä»»åŠ¡æœ‰ä¸€ä¸ª Pod æˆåŠŸå°±æ ‡å¿—å®Œæˆï¼›\n- å®šæ•°æˆåŠŸå‹ä»»åŠ¡ä¿è¯æœ‰ N ä¸ªä»»åŠ¡å…¨éƒ¨æˆåŠŸï¼›\n- å·¥ä½œé˜Ÿåˆ—å‹ä»»åŠ¡æ ¹æ®åº”ç”¨ç¡®è®¤çš„å…¨å±€æˆåŠŸè€Œæ ‡å¿—æˆåŠŸã€‚\n\n## åå°æ”¯æ’‘æœåŠ¡é›†ï¼ˆDaemonSetï¼‰\n\né•¿æœŸä¼ºæœå‹å’Œæ‰¹å¤„ç†å‹æœåŠ¡çš„æ ¸å¿ƒåœ¨ä¸šåŠ¡åº”ç”¨ï¼Œå¯èƒ½æœ‰äº›èŠ‚ç‚¹è¿è¡Œå¤šä¸ªåŒç±»ä¸šåŠ¡çš„ Podï¼Œæœ‰äº›èŠ‚ç‚¹ä¸Šåˆæ²¡æœ‰è¿™ç±» Pod è¿è¡Œï¼›\n\nè€Œåå°æ”¯æ’‘å‹æœåŠ¡çš„æ ¸å¿ƒå…³æ³¨ç‚¹åœ¨ Kubernetes é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ï¼ˆç‰©ç†æœºæˆ–è™šæ‹Ÿæœºï¼‰ï¼Œè¦ä¿è¯æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰ä¸€ä¸ªæ­¤ç±» Pod è¿è¡Œã€‚\n\nèŠ‚ç‚¹å¯èƒ½æ˜¯æ‰€æœ‰é›†ç¾¤èŠ‚ç‚¹ä¹Ÿå¯èƒ½æ˜¯é€šè¿‡ nodeSelector é€‰å®šçš„ä¸€äº›ç‰¹å®šèŠ‚ç‚¹ã€‚\n\nå…¸å‹çš„åå°æ”¯æ’‘å‹æœåŠ¡åŒ…æ‹¬å­˜å‚¨ã€æ—¥å¿—å’Œç›‘æ§ç­‰åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ”¯æ’‘ Kubernetes é›†ç¾¤è¿è¡Œçš„æœåŠ¡ã€‚\n\n![image.png](Extras/Images/image_1665839934475_0.png)\n\n## å­˜å‚¨ PV å’Œ PVC\n\nPersistentVolumeï¼ˆPVï¼‰æ˜¯é›†ç¾¤ä¸­çš„ä¸€å—å­˜å‚¨å·ï¼Œå¯ä»¥ç”±ç®¡ç†å‘˜æ‰‹åŠ¨è®¾ç½®ï¼Œæˆ–å½“ç”¨æˆ·åˆ›å»º PersistentVolumeClaimï¼ˆPVCï¼‰æ—¶æ ¹æ® StorageClass åŠ¨æ€è®¾ç½®ã€‚\n\nPV å’Œ PVC ä¸ Pod ç”Ÿå‘½å‘¨æœŸæ— å…³ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ Pod ä¸­çš„å®¹å™¨é‡æ–°å¯åŠ¨ã€Pod é‡æ–°è°ƒåº¦æˆ–è€…åˆ é™¤æ—¶ï¼ŒPV å’Œ PVC ä¸ä¼šå—åˆ°å½±å“ï¼ŒPod å­˜å‚¨äº PV é‡Œçš„æ•°æ®å¾—ä»¥ä¿ç•™ã€‚\n\nå¯¹äºä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œç”¨æˆ·é€šå¸¸éœ€è¦ä¸åŒå±æ€§ï¼ˆä¾‹å¦‚æ€§èƒ½ã€è®¿é—®æ¨¡å¼ç­‰ï¼‰çš„ PVã€‚\n\n## CustomResourceDefinition\n\nCRD å°±åƒæ•°æ®åº“çš„å¼€æ”¾å¼è¡¨ç»“æ„ï¼Œå…è®¸ç”¨æˆ·è‡ªå®šä¹‰ Schemaã€‚\n\næœ‰äº†è¿™ç§å¼€æ”¾å¼è®¾è®¡ï¼Œç”¨æˆ·å¯ä»¥åŸºäº CRD å®šä¹‰ä¸€åˆ‡éœ€è¦çš„æ¨¡å‹ï¼Œæ»¡è¶³ä¸åŒä¸šåŠ¡çš„éœ€æ±‚ã€‚\n\nç¤¾åŒºé¼“åŠ±åŸºäº CRD çš„ä¸šåŠ¡æŠ½è±¡ï¼Œä¼—å¤šä¸»æµçš„æ‰©å±•åº”ç”¨éƒ½æ˜¯åŸºäº CRD æ„å»ºçš„ï¼Œæ¯”å¦‚ Istioã€Knativeã€‚\n\nç”šè‡³åŸºäº CRD æ¨å‡ºäº† Operator Mode å’Œ Operator SDKï¼Œå¯ä»¥ä»¥æä½çš„å¼€å‘æˆæœ¬å®šä¹‰æ–°å¯¹è±¡ï¼Œå¹¶æ„å»ºæ–°å¯¹è±¡çš„æ§åˆ¶å™¨ã€‚\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Pod%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F":{"title":"æ·±å…¥ç†è§£Podçš„ç”Ÿå‘½å‘¨æœŸ","content":"\n# å¦‚ä½•ä¼˜é›…çš„ç®¡ç†Podçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ\n\n![image.png](Extras/Images/image_1666168768853_0.png)\n\n# PodçŠ¶æ€æœº\n\n![image.png](Extras/Images/image_1666168798844_0.png)\n\n# Pod Phase\n\n- Pod Phase\n\t- Pending\n\t- Running\n\t- Succeeded\n\t- Failed\n\t- Unknown\n- kubectl get podæ˜¾ç¤ºçš„çŠ¶æ€ä¿¡æ¯æ˜¯ç”±podstatus çš„conditionså’Œphaseè®¡ç®—å‡ºæ¥çš„\n- æŸ¥çœ‹podç»†èŠ‚\n\t- `kubectl get pod $podname-oyaml`\n- æŸ¥çœ‹podç›¸å…³äº‹ä»¶\n\t- `kubectl describe pod`\n\n![image.png](Extras/Images/image_1666169145175_0.png)\n\n# PodçŠ¶æ€è®¡ç®—ç»†èŠ‚\n\n![image.png](Extras/Images/image_1666169178690_0.png)\n\n# å¦‚ä½•ç¡®ä¿Podçš„é«˜å¯ç”¨\n\né¿å…å®¹å™¨è¿›ç¨‹è¢«ç»ˆæ­¢é¿å…Podè¢«é©±é€\n\n- è®¾ç½®åˆç†çš„ resources.memory limits é˜²æ­¢å®¹å™¨è¿›ç¨‹è¢«OOMKill\n- è®¾ç½®åˆç†çš„ emptydir.sizeLimitå¹¶ä¸”ç¡®ä¿æ•°æ®å†™å…¥ä¸è¶…è¿‡emptyDirçš„é™åˆ¶ï¼Œé˜²æ­¢Podè¢«é©±é€\n\n# Podçš„QoSåˆ†ç±»\n\n**\\[QoS\u0026Quota\\] Guaranteed, Burstable and BestEffort**\n\nå½“è®¡ç®—èŠ‚ç‚¹æ£€æµ‹åˆ°å†…å­˜å‹åŠ›æ—¶ï¼ŒKubernetesä¼šæŒ‰BestEffort-\u003eBurstable-\u003eGuaranteedçš„é¡ºåºä¾æ¬¡é©±é€Pod\n\n![image.png](Extras/Images/image_1666169701618_0.png)\n\n![image.png](Extras/Images/image_1666169722428_0.png)\n\n```bash\n$ kubectl get pod test-vfgg6-oyaml lgrep qosClass\nqosClass: Burstable\n```\n\n# è´¨é‡ä¿è¯Guaranteedï¼ŒBurstable and BestEffort\n\nå®šä¹‰Guaranteedç±»å‹çš„èµ„æºéœ€æ±‚æ¥ä¿æŠ¤ä½ çš„é‡è¦Podã€‚\n\nè®¤çœŸè€ƒé‡Podéœ€è¦çš„çœŸå®éœ€æ±‚å¹¶è®¾ç½®Limitå’Œresourceï¼Œè¿™æœ‰åˆ©å¹²å°†é›†ç¾¤èµ„æºåˆ©ç”¨ç‡æ§åˆ¶åœ¨åˆç†èŒƒå›´å¹¶å‡å°‘Podè¢«é©±é€çš„ç°è±¡ã€‚\n\nå°½é‡é¿å…å°†ç”Ÿäº§Podè®¾ç½®ä¸ºBestEffortï¼Œä½†æ˜¯å¯¹æµ‹è¯•ç¯å¢ƒæ¥è®²ï¼ŒBestEffort Podèƒ½ç¡®ä¿å¤§å¤šæ•°åº”ç”¨ä¸ä¼šå› ä¸ºèµ„æºä¸è¶³è€Œå¤„äºPendingçŠ¶æ€ã€‚\n\nBurstableé€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯ã€‚æ€è€ƒâˆ¶ä¸ºä»€ä¹ˆ?\n\n# åŸºäºTaintçš„Evictions\n\n![image.png](Extras/Images/image_1666170094232_0.png)\n\n# å¥åº·æ£€æŸ¥æ¢é’ˆ\n\n- å¥åº·æ¢é’ˆç±»å‹åˆ†ä¸º\n\t- livenessProbe\n\t\t- æ¢æ´»ï¼Œå½“æ£€æŸ¥å¤±è´¥æ—¶ï¼Œæ„å‘³ç€è¯¥åº”ç”¨è¿›ç¨‹å·²ç»æ— æ³•æ­£å¸¸æä¾›æœåŠ¡ï¼Œkubeletä¼šç»ˆæ­¢è¯¥å®¹å™¨è¿›ç¨‹å¹¶æŒ‰ç…§restartPolicyå†³å®šæ˜¯å¦é‡å¯\n\t- readinessProbe\n\t\t- å°±ç»ªçŠ¶æ€æ£€æŸ¥ï¼Œå½“æ£€æŸ¥å¤±è´¥æ—¶ï¼Œæ„å‘³ç€åº”ç”¨è¿›ç¨‹æ­£åœ¨è¿è¡Œï¼Œä½†å› ä¸ºæŸäº›åŸå› ä¸èƒ½æä¾›æœåŠ¡ï¼ŒPodçŠ¶æ€ä¼šè¢«æ ‡è®°ä¸ºNotReady\n\t- startupProbe\n\t\t- åœ¨åˆå§‹åŒ–é˜¶æ®µï¼ˆReadyä¹‹å‰ï¼‰è¿›è¡Œçš„å¥åº·æ£€æŸ¥ï¼Œé€šå¸¸ç”¨æ¥é¿å…è¿‡äºé¢‘ç¹çš„ç›‘æµ‹å½±å“åº”ç”¨å¯åŠ¨\n- æ¢æµ‹æ–¹æ³•åŒ…æ‹¬\n\t- ExecActionï¼šåœ¨å®¹å™¨å†…éƒ¨è¿è¡ŒæŒ‡å®šå‘½ä»¤ï¼Œå½“è¿”å›ç ä¸º0æ—¶ï¼Œæ¢æµ‹ç»“æœä¸ºæˆåŠŸ\n\t- TCPSocketActionï¼šç”±kubeletèµ·ï¼Œé€šè¿‡TCPåè®®æ£€æŸ¥å®¹å™¨IPå’Œç«¯å£ï¼Œå½“ç«¯å£å¯è¾¾æ—¶ï¼Œæ¢æµ‹ç»“æœä¸ºæˆåŠŸ\n\t- HTTPGetActionï¼šç”±kubeletå‘èµ·ï¼Œå¯¹Podçš„IPå’ŒæŒ‡å®šç«¯å£ä»¥åŠè·¯å¾„è¿›è¡ŒHTTPGetæ“ä½œï¼Œå½“è¿”å›ç ä¸º200-400ä¹‹é—´æ—¶ï¼Œæ¢æµ‹ç»“æœä¸ºæˆåŠŸ\n\n# æ¢é’ˆå±æ€§\n\n![image.png](Extras/Images/image_1666170883220_0.png)\n\n# ReadinessGates\n\nReadinesså…è®¸åœ¨Kubernetesè‡ªå¸¦çš„Pod Conditionsä¹‹å¤–å¼•å…¥è‡ªå®šä¹‰çš„å°±ç»ªæ¡ä»¶\n\næ–°å¼•å…¥çš„readinessGates conditionéœ€è¦ä¸ºTrueçŠ¶æ€åï¼ŒåŠ ä¸Šå†…ç½®çš„Conditionsï¼ŒPodæ‰å¯ä»¥ä¸ºå°±ç»ªçŠ¶æ€\n\nè¯¥çŠ¶æ€åº”è¯¥ç”±æŸæ§åˆ¶å™¨ä¿®æ”¹\n\n# Post-startå’ŒPre-Stop Hook\n\n![image.png](Extras/Images/image_1666174698494_0.png)\n\n# terminationGracePeriodSecondsçš„åˆ†è§£\n\n![image.png](Extras/Images/image_1666174728593_0.png)\n\n# Terminating Podçš„è¯¯ç”¨\n\nbash/sh ä¼šå¿½ç•¥SIGTERMä¿¡å·é‡ï¼Œå› æ­¤kill-SIGTERMä¼šæ°¸è¿œè¶…æ—¶ï¼Œè‹¥åº”ç”¨ä½¿ç”¨bash/shä½œä¸ºEntrypointï¼Œåˆ™åº”é¿å…è¿‡é•¿çš„grace period\n\n![image.png](Extras/Images/image_1666174795919_0.png)\n\n# Terminating Podçš„ç»éªŒåˆ†äº«\n\n- terminationGracePeriodSecondsé»˜è®¤æ—¶é•¿30ç§’\n- å¦‚æœä¸å…³å¿ƒPodçš„ç»ˆæ­¢æ—¶é•¿ï¼Œé‚£ä¹ˆæ— éœ€é‡‡å–ç‰¹æ®Šæªæ–½\n- å¦‚æœå¸Œæœ›å¿«é€Ÿç»ˆæ­¢åº”ç”¨è¿›ç¨‹ï¼Œé‚£ä¹ˆå¯é‡‡å–å¦‚ä¸‹æ–¹æ¡ˆ\n\t- åœ¨preStop Scriptä¸­ä¸»åŠ¨é€€å‡ºè¿›ç¨‹\n\t- åœ¨ä¸»å®¹å™¨è¿›ç¨‹ä¸­ä½¿ç”¨ç‰¹å®šçš„åˆå§‹åŒ–è¿›ç¨‹\n- ä¼˜é›…çš„åˆå§‹åŒ–è¿›ç¨‹åº”è¯¥\n\t- æ­£ç¡®å¤„ç†ç³»ç»Ÿä¿¡å·é‡ï¼Œå°†ä¿¡å·é‡è½¬å‘ç»™å­è¿›ç¨‹\n\t- åœ¨ä¸»è¿›ç¨‹é€€å‡ºä¹‹å‰ï¼Œéœ€è¦å…ˆç­‰å¾…å¹¶ç¡®ä¿æ‰€æœ‰å­è¿›ç¨‹é€€å‡º\n\t- ç›‘æ§å¹¶æ¸…ç†å­¤å„¿å­è¿›ç¨‹\n\n# å­˜å‚¨å¸¦æ¥çš„æŒ‘æˆ˜\n\n- å¤šå®¹å™¨ä¹‹é—´å…±äº«å­˜å‚¨ï¼Œæœ€ç®€æ–¹æ¡ˆæ˜¯emptyDir\n- å¸¦æ¥çš„æŒ‘æˆ˜ï¼š\n\t- emptyDiréœ€è¦æ§åˆ¶ size limtï¼Œå¦åˆ™æ— é™æ‰©å¼ çš„åº”ç”¨ä¼šæ’‘çˆ†ä¸»æœºç£ç›˜å¯¼è‡´ä¸»æœºä¸å¯ç”¨ï¼Œè¿›è€Œå¯¼è‡´å¤§è§„æ¨¡é›†ç¾¤æ•…éšœ\n\t- emptyDir size limitç”Ÿæ•ˆä»¥åï¼Œkubeletä¼šå®šæœŸå¯¹å®¹å™¨ç›®å½•æ‰§è¡Œduæ“ä½œï¼Œä¼šå¯¼è‡´äº›è®¸çš„æ€§èƒ½å½±å“\n\t- size limitè¾¾åˆ°ä»¥åï¼ŒPodä¼šè¢«é©±é€ï¼ŒåŸPodçš„æ—¥å¿—é…ç½®ç­‰ä¿¡æ¯ä¼šæ¶ˆå¤±\n\n# åº”ç”¨é…ç½®\n\n- ä¼ å…¥æ–¹å¼\n\t- Environment Variables\n\t- Volume Mount\n- æ•°æ®æ¥æº\n\t- ConfigMap\n\t- Secret\n\t- Downward API\n\n# æ•°æ®åº”è¯¥å¦‚ä½•ä¿å­˜\n\n![image.png](Extras/Images/image_1666175473162_0.png)\n\n![image.png](Extras/Images/image_1666175513153_0.png)\n\n# å®¹å™¨åº”ç”¨å¯èƒ½é¢ä¸´çš„è¿›ç¨‹ä¸­æ–­\n\n![image.png](Extras/Images/image_1666176184774_0.png)\n\n# é«˜å¯ç”¨éƒ¨ç½²æ–¹å¼\n\n- å¤šå°‘å®ä¾‹\n- æ›´æ–°ç­–ç•¥\n\t- maxSurge\n\t- maxUnavailableï¼ˆéœ€è¦è€ƒè™‘ResourceQuotaçš„é™åˆ¶\n- æ·±å…¥ç†è§£PodTemplateHashå¯¼è‡´çš„åº”ç”¨çš„æ˜“å˜æ€§\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/%E7%94%9F%E4%BA%A7%E5%8C%96%E8%BF%90%E7%BB%B4":{"title":"ç”Ÿäº§åŒ–è¿ç»´","content":"\n# é•œåƒä»“åº“\n\n## é•œåƒä»“åº“\n\n- é•œåƒä»“åº“ï¼ˆDocker Registryï¼‰è´Ÿè´£å­˜å‚¨ã€ç®¡ç†å’Œåˆ†å‘é•œåƒã€‚\n- é•œåƒä»“åº“ç®¡ç†å¤šä¸ªRepositoryï¼ŒRepositoryé€šè¿‡å‘½åæ¥åŒºåˆ†ã€‚æ¯ä¸ªRepositoryåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒï¼Œé•œåƒé€šè¿‡é•œåƒåç§°å’Œæ ‡ç­¾ï¼ˆTagï¼‰æ¥åŒºåˆ†ã€‚\n- å®¢æˆ·ç«¯æ‹‰å–é•œåƒæ—¶ï¼Œè¦æŒ‡å®šä¸‰è¦ç´ ï¼š\n\t- é•œåƒä»“åº“ï¼šè¦ä»å“ªä¸€ä¸ªé•œåƒä»“åº“æ‹‰å–é•œåƒï¼Œé€šå¸¸é€šè¿‡DNSæˆ–IPåœ°å€æ¥ç¡®å®šä¸€ä¸ªé•œåƒä»“åº“ï¼Œå¦‚hub.docker.com\n\t- Repositoryï¼šç»„ç»‡åï¼Œå¦‚cncamp\n\t- é•œåƒåç§°+æ ‡ç­¾ï¼šå¦‚nginxâˆ¶latest\n\n![image.png](Extras/Images/image_1667053630959_0.png)\n\n---\n\n**å…¬æœ‰é•œåƒä»“åº“ä¼˜åŠ¿**\n\nå¼€æ”¾ï¼šä»»ä½•å¼€å‘è€…éƒ½å¯ä»¥ä¸Šä¼ ã€åˆ†äº«é•œåƒåˆ°å…¬æœ‰é•œåƒä»“åº“ä¸­ã€‚\n\nä¾¿æ·ï¼šå¼€å‘è€…å¯ä»¥éå¸¸æ–¹ä¾¿åœ°æœç´¢ã€æ‹‰å–å…¶ä»–å¼€å‘è€…çš„é•œåƒï¼Œé¿å…é‡å¤é€ è½®å­ã€‚\n\nå…è¿ç»´ï¼šå¼€å‘è€…åªéœ€è¦å…³æ³¨åº”ç”¨å¼€å‘ï¼Œä¸å¿…å…³å¿ƒé•œåƒä»“åº“çš„æ›´æ–°ã€å‡çº§ã€ç»´æŠ¤ç­‰ã€‚\n\næˆæœ¬ä½ï¼šä¼ä¸šæˆ–å¼€å‘è€…ä¸éœ€è¦è´­ä¹°ç¡¬ä»¶ã€è§£å†³æ–¹æ¡ˆæ¥æ­å»ºé•œåƒä»“åº“ï¼Œä¹Ÿä¸éœ€è¦å›¢é˜Ÿæ¥ç»´æŠ¤ã€‚\n\n**ç§æœ‰é•œåƒä»“åº“ä¼˜åŠ¿**\n\néšç§æ€§ï¼šä¼ä¸šçš„ä»£ç å’Œæ•°æ®æ˜¯ä¼ä¸šçš„ç§æœ‰èµ„äº§ï¼Œä¸å…è®¸éšæ„å…±äº«åˆ°å…¬å…±å¹³å°ã€‚\n\næ•æ„Ÿæ€§ï¼šä¼ä¸šçš„é•œåƒä¼šåŒ…å«ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚å¯†é’¥ä¿¡æ¯ã€ä»¤ç‰Œä¿¡æ¯ç­‰ã€‚è¿™äº›æ•æ„Ÿä¿¡æ¯ä¸¥ç¦æš´éœ²åˆ°ä¼ä¸šå¤–éƒ¨ã€‚\n\nç½‘ç»œè¿é€šæ€§ï¼šä¼ä¸šçš„ç½‘ç»œç»“æ„å¤šç§å¤šæ ·ï¼Œå¹¶éæ‰€æœ‰ç¯å¢ƒéƒ½å¯ä»¥è®¿é—®äº’è”ç½‘ã€‚\n\nå®‰å…¨æ€§ï¼šè€Œåœ¨ä¼ä¸šç¯å¢ƒä¸­ï¼Œè‹¥ä½¿ç”¨ä¸€äº›å«æœ‰æ¼æ´çš„ä¾èµ–åŒ…ï¼Œåˆ™ä¼šå¼•å…¥å®‰å…¨éšæ‚£ã€‚\n\n## é•œåƒä»“åº“éµå¾ªOCIçš„Distribution Spec\n\n![image.png](Extras/Images/image_1667053850649_0.png)\n\n## æ•°æ®å’Œå—æ–‡ä»¶\n\né•œåƒç”±å…ƒæ•°æ®å’Œå—æ–‡ä»¶ä¸¤éƒ¨åˆ†ç»„æˆï¼Œé•œåƒä»“åº“çš„æ ¸å¿ƒèŒèƒ½å°±æ˜¯ç®¡ç†è¿™ä¸¤é¡¹æ•°æ®ã€‚\n\n- å…ƒæ•°æ®\n\t- å…ƒæ•°æ®ç”¨äºæè¿°ä¸€ä¸ªé•œåƒçš„æ ¸å¿ƒä¿¡æ¯ï¼ŒåŒ…å«é•œåƒçš„é•œåƒä»“åº“ã€ä»“åº“ã€æ ‡ç­¾ã€æ ¡éªŒç ã€æ–‡ä»¶å±‚ï¼Œé•œåƒæ„å»ºæè¿°ç­‰ä¿¡æ¯ã€‚\n\t- é€šè¿‡è¿™äº›ä¿¡æ¯ï¼Œå¯ä»¥ä»æŠ½è±¡å±‚é¢å®Œæ•´åœ°æè¿°ä¸€ä¸ªé•œåƒâˆ¶å®ƒæ˜¯å¦‚ä½•æ„å»ºå‡ºæ¥çš„ã€è¿è¡Œè¿‡ä»€ä¹ˆæ„å»ºå‘½ä»¤ã€æ„å»ºçš„æ¯ä¸€ä¸ªæ–‡ä»¶å±‚çš„æ ¡éªŒç ã€æ‰“çš„æ ‡ç­¾ã€é•œåƒçš„æ ¡éªŒç ç­‰ã€‚\n- å—æ–‡ä»¶ï¼ˆblobï¼‰\n\t- å—æ–‡ä»¶æ˜¯ç»„æˆé•œåƒçš„è”åˆæ–‡ä»¶å±‚çš„å®ä½“ï¼Œæ¯ä¸€ä¸ªå—æ–‡ä»¶æ˜¯ä¸€ä¸ªæ–‡ä»¶å±‚ï¼Œå†…éƒ¨åŒ…å«å¯¹åº”æ–‡ä»¶å±‚çš„å˜æ›´ã€‚\n\n![image.png](Extras/Images/image_1667053866547_0.png)\n\n## Harbor\n\nHarboræ˜¯VMwareå¼€æºçš„ä¼ä¸šçº§é•œåƒä»“åº“ï¼Œç›®å‰å·²æ˜¯CNCFçš„æ¯•ä¸šé¡¹ç›®ã€‚å®ƒæ‹¥æœ‰å®Œæ•´çš„ä»“åº“ç®¡ç†ã€é•œåƒç®¡ç†ã€åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ã€é•œåƒå®‰å…¨æ‰«æé›†æˆã€é•œåƒç­¾åç­‰ã€‚\n\n![image.png](Extras/Images/image_1667054088588_0.png)\n\n### Harboræä¾›çš„æœåŠ¡\n\nHarboræ ¸å¿ƒæœåŠ¡ï¼šæä¾›Harborçš„æ ¸å¿ƒç®¡ç†æœåŠ¡APIï¼ŒåŒ…æ‹¬ä»“åº“ç®¡ç†ï¼Œè®¤è¯ç®¡ç†ï¼Œæˆæƒç®¡ç†ï¼Œé…ç½®ç®¡ç†ã€é¡¹ç›®ç®¡ç†ã€é…é¢ç®¡ç†ã€ç­¾åç®¡ç†ã€å‰¯æœ¬ç®¡ç†ç­‰ã€‚\n\nHarbor Portalï¼šHarborçš„Webç•Œé¢ã€‚\n\nRegistryï¼šRegistryè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„pull/pushè¯·æ±‚ï¼Œå…¶æ ¸å¿ƒä¸ºdocker/Distributionã€‚\n\nå‰¯æœ¬æ§åˆ¶å™¨ï¼šHarborå¯ä»¥ä»¥ä¸»ä»æ¨¡å¼æ¥éƒ¨ç½²é•œåƒä»“åº“ï¼Œå‰¯æœ¬æ§åˆ¶å™¨å°†é•œåƒä»ä¸»é•œåƒæœåŠ¡åˆ†å‘åˆ°ä»é•œåƒæœåŠ¡ã€‚\n\næ—¥å¿—æ”¶é›†å™¨ï¼šæ”¶é›†å„æ¨¡å—çš„æ—¥å¿—ã€‚\n\nåƒåœ¾å›æ”¶æ§åˆ¶å™¨ï¼šå›æ”¶æ—¥å¸¸æ“ä½œä¸­åˆ é™¤é•œåƒè®°å½•åé—ç•™åœ¨å—å­˜å‚¨ä¸­çš„å­¤ç«‹å—æ–‡ä»¶ã€‚\n\n### Harboræ¶æ„\n\n![image.png](Extras/Images/image_1667054290568_0.png)\n\n### Harboré«˜å¯ç”¨æ¶æ„\n\n![image.png](Extras/Images/image_1667054764792_0.png)\n\n## æœ¬åœ°é•œåƒåŠ é€ŸDragonfly\n\n- Dragonflyæ˜¯ä¸€æ¬¾åŸºäºP2Pçš„æ™ºèƒ½é•œåƒå’Œæ–‡ä»¶åˆ†å‘å·¥å…·\n- å®ƒæ—¨åœ¨æé«˜æ–‡ä»¶ä¼ è¾“çš„æ•ˆç‡å’Œé€Ÿç‡ï¼Œæœ€å¤§é™åº¦åœ°åˆ©ç”¨ç½‘ç»œå¸¦å®½ï¼Œå°¤å…¶æ˜¯åœ¨åˆ†å‘å¤§é‡æ•°æ®æ—¶\n\t- åº”ç”¨åˆ†å‘\n\t- ç¼“å­˜åˆ†å‘\n\t- æ—¥å¿—åˆ†å‘\n\t- é•œåƒåˆ†å‘\n\n### ä¼˜åŠ¿\n\n- åŸºäºP2Pçš„æ–‡ä»¶åˆ†å‘\n- éä¾µå…¥å¼æ”¯æŒæ‰€æœ‰ç±»å‹çš„å®¹å™¨æŠ€æœ¯\n- æœºå™¨çº§åˆ«çš„é™é€Ÿ\n- è¢«åŠ¨å¼CDN\n- é«˜åº¦ä¸€è‡´æ€§\n- ç£ç›˜ä¿æŠ¤å’Œé«˜æ•ˆ IO\n- é«˜æ€§èƒ½\n- è‡ªåŠ¨éš”ç¦»å¼‚å¸¸\n- å¯¹æ–‡ä»¶æºæ— å‹åŠ›\n- æ”¯æŒæ ‡å‡† HTTP å¤´æ–‡ä»¶\n- æœ‰æ•ˆçš„ Registryé‰´æƒå¹¶å‘æ§åˆ¶\n- ç®€å•æ˜“ç”¨\n\n### é•œåƒä¸‹è½½æµç¨‹\n\ndfget proxyä¹Ÿç§°ä¸º dfdaemonï¼Œä¼šæ‹¦æˆªæ¥è‡ª docker pullæˆ–docker pushçš„HTTPè¯·æ±‚ï¼Œç„¶åä½¿ç”¨ dfget æ¥å¤„ç†é‚£äº›è·Ÿé•œåƒåˆ†å±‚ç›¸å…³çš„è¯·æ±‚\n\n![image.png](Extras/Images/image_1667055180018_0.png)\n\næ¯ä¸ªæ–‡ä»¶ä¼šè¢«åˆ†æˆå¤šä¸ªåˆ†å—ï¼Œå¹¶åœ¨å¯¹ç­‰èŠ‚ç‚¹ä¹‹é—´ä¼ è¾“\n\n![image.png](Extras/Images/image_1667055195716_0.png)\n\n# é•œåƒå®‰å…¨\n\n## é•œåƒå®‰å…¨çš„æœ€ä½³å®è·µ\n\n- æ„å»ºæŒ‡ä»¤é—®é¢˜\n\t- é¿å…åœ¨æ„å»ºç«Ÿåƒæ—¶ï¼Œæ·»åŠ å¯†é’¥ï¼ŒTokenç­‰æ•æ„Ÿä¿¡æ¯ï¼ˆé…ç½®ä¸ä»£ç åº”åˆ†ç¦»ï¼‰\n- åº”ç”¨ä¾èµ–é—®é¢˜\n\t- åº”å°½é‡é¿å…å®‰è£…ä¸å¿…è¦çš„ä¾èµ–\n\t- ç¡®ä¿ä¾èµ–æ— å®‰å…¨é£é™©ï¼Œä¸€äº›é•¿æ—¶é—´ä¸æ›´æ–°çš„åŸºç¡€é•œåƒçš„å¯èƒ½é¢ä¸´å®‰å…¨é£é™©ï¼Œæ¯”å¦‚åŸºäºopenssl1.0ï¼Œåªæ”¯æŒtls1.0ç­‰\n- æ–‡ä»¶é—®é¢˜\n\t- åœ¨æ„å»ºé•œåƒæ—¶ï¼Œé™¤åº”ç”¨æœ¬èº«å¤–ï¼Œè¿˜ä¼šæ·»åŠ åº”ç”¨éœ€è¦çš„é…ç½®æ–‡ä»¶ã€æ¨¡æ¿ç­‰ï¼Œåœ¨æ·»åŠ è¿™äº›æ–‡ä»¶æ—¶ï¼Œä¼šæ— æ„é—´æ·»åŠ ä¸€äº›åŒ…å«æ•æ„Ÿä¿¡æ¯æˆ–ä¸ç¬¦åˆå®‰å…¨ç­–ç•¥çš„æ–‡ä»¶åˆ°é•œåƒä¸­ã€‚\n\t- å½“é•œåƒä¸­å­˜åœ¨æ–‡ä»¶é—®é¢˜æ—¶ï¼Œéœ€è¦é€šè¿‡å¼•å…¥è¯¥æ–‡ä»¶çš„æ„å»ºæŒ‡ä»¤è¡Œè¿›è¡Œä¿®å¤ï¼Œè€Œä¸æ˜¯é€šè¿‡è¿½åŠ ä¸€æ¡åˆ é™¤æŒ‡ä»¤æ¥ä¿®å¤ã€‚\n\n![image.png](Extras/Images/image_1667055854221_0.png)\n\n## é•œåƒæ‰«æï¼ˆVulnerability Scanningï¼‰\n\né•œåƒæ‰«æé€šè¿‡æ‰«æå·¥å…·æˆ–æ‰«ææœåŠ¡å¯¹é•œåƒè¿›è¡Œæ‰«æï¼Œæ¥ç¡®å®šé•œåƒæ˜¯å¦å®‰å…¨\n\n- åˆ†ææ„å»ºæŒ‡ä»¤ã€åº”ç”¨ã€æ–‡ä»¶ã€ä¾èµ–åŒ…\n- æŸ¥è¯¢CVEåº“ã€å®‰å…¨ç­–ç•¥\n- æ£€æµ‹é•œåƒæ˜¯å¦å®‰å…¨ï¼Œæ˜¯å¦ç¬¦åˆä¼ä¸šçš„å®‰å…¨æ ‡å‡†ã€‚\n\n## é•œåƒç­–ç•¥å‡†å…¥æ§åˆ¶\n\né•œåƒå‡†å…¥æ§åˆ¶æ˜¯åœ¨éƒ¨ç½²Podã€æ›´æ–°Podæ—¶ï¼Œå¯¹Pod ä¸­çš„æ‰€æœ‰é•œåƒè¿›è¡Œå®‰å…¨éªŒè¯ä»¥æ”¾è¡Œæˆ–æ‹¦æˆªå¯¹Podçš„æ“ä½œï¼š\n\n- æ”¾è¡Œï¼šPodä¸­æ‰€æœ‰çš„é•œåƒéƒ½å®‰å…¨ï¼Œå…è®¸æ­¤æ¬¡çš„æ“ä½œï¼ŒPodæˆåŠŸè¢«åˆ›å»ºæˆ–æ›´æ–°ã€‚\n- æ‹¦æˆªï¼šPodä¸­çš„é•œåƒæœªæ‰«æï¼Œæˆ–å·²ç»æ‰«æä½†å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œæˆ–ä¸ç¬¦åˆå®‰å…¨ç­–ç•¥ï¼ŒPodæ— æ³•è¢«åˆ›å»ºæˆ–æ›´æ–°ã€‚\n\n![image.png](Extras/Images/image_1667056069430_0.png)\n\n## æ‰«æé•œåƒ\n\n1. é•œåƒæ‰«ææœåŠ¡ä»é•œåƒä»“åº“æ‹‰å–é•œåƒã€‚\n2. è§£æé•œåƒçš„å…ƒæ•°æ®ã€‚\n3. è§£å‹é•œåƒçš„æ¯ä¸€ä¸ªæ–‡ä»¶å±‚ã€‚\n4. æå–æ¯ä¸€å±‚æ‰€åŒ…å«çš„ä¾èµ–åŒ…ã€å¯è¿è¡Œç¨‹åºã€æ–‡ä»¶åˆ—è¡¨ã€æ–‡ä»¶å†…å®¹æ‰«æã€‚\n5. å°†æ‰«æç»“æœä¸CVEå­—å…¸ã€å®‰å…¨ç­–ç•¥å­—å…¸è¿›è¡ŒåŒ¹é…ï¼Œä»¥ç¡®è®¤æœ€ç»ˆé•œåƒæ˜¯å¦å®‰å…¨ã€‚\n\n## é•œåƒæ‰«ææœåŠ¡\n\n![image.png](Extras/Images/image_1667056153240_0.png)\n\n# åŸºäºKubernetesçš„DevOps\n\n## ä¼ ç»Ÿè¿ç»´æ¨¡å¼\n\n- ç¼ºä¹ä¸€è‡´æ€§ç¯å¢ƒ\n- å¹³å°ä¸åº”ç”¨éƒ¨ç½²ç›¸äº’å‰²è£‚\n- ç¼ºä¹å·¥å…·é“¾æ”¯æŒ\n- ç¼ºä¹ç»Ÿä¸€çš„ç°åº¦å‘å¸ƒç®¡ç†\n- ç¼ºä¹ç»Ÿä¸€ç›‘æ§èƒ½åŠ›å’ŒæŒç»­è¿ç»´èƒ½åŠ›\n\n![image.png](Extras/Images/image_1667058218102_0.png)\n\n## å»ºç«‹æŒç»­äº¤ä»˜çš„æœåŠ¡ä½“ç³»\n\nä¼ ç»Ÿçš„å¼€å‘è¿ç»´æ¨¡å¼ä¸‹ï¼Œå­˜åœ¨çš„é—®é¢˜ï¼š\n\n- ä»éœ€æ±‚åˆ°ç‰ˆæœ¬ä¸Šçº¿ä¸­é—´æ˜¯ä¸ªé»‘ç®±å­ï¼Œé£é™©ä¸å¯æ§ï¼›\n- å¼€å‘è®¾è®¡æ—¶æœªè¿‡å¤šè€ƒè™‘è¿ç»´ï¼Œå¯¼è‡´åç»­éƒ¨ç½²åŠç»´æŠ¤çš„å›°éš¾ï¼›\n- å¼€å‘å„è‡ªä¸ºæ”¿ï¼ŒçƒŸå›±å¼å¼€å‘ï¼Œæœªè€ƒè™‘å…±äº«é‡ç”¨ã€è”è°ƒï¼Œå¼€å‘çš„èµ„äº§ç§¯ç´¯ä¸èƒ½å¿«é€Ÿäº¤ç§»åˆ°è¿ç»´æ‰‹ä¸­ï¼›\n\nåº”å¯¹è¿™æ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬é€šå¸¸å€¡å¯¼çš„è§£å†³ä¹‹é“æ˜¯ï¼šè¿ç»´å‰ç§»ï¼Œç»Ÿä¸€è¿ç»´ï¼Œå»ºç«‹æŒç»­äº¤ä»˜æœåŠ¡ä½“ç³»ã€‚\n\n## åŸºäºDockerçš„å¼€å‘æ¨¡å¼é©±åŠ¨æŒç»­é›†æˆ\n\n![image.png](Extras/Images/image_1667058564537_0.png)\n\n## DevOpsæµç¨‹å®šä¹‰\n\n![image.png](Extras/Images/image_1667058593881_0.png)\n\n## Devå’ŒOpsçš„è¾¹ç•Œå®šä¹‰\n\nProgramming vs. Engineering\n\nProgrammingæ›´å¤šçš„æ˜¯ç³»ç»Ÿè®¾è®¡å’Œç¼–ç å®ç°\n\nEngineeringåŒ…å«æ›´å¤§èŒƒå›´æ¦‚å¿µï¼Œé™¤äº†åŠŸèƒ½å±‚é¢çš„å®ç°ï¼Œè¿˜éœ€ä¸ºè¿ç»´æœåŠ¡\n\n## å®šä¹‰production readiness\n\nFunction ready vs. production ready\n- Function Readyåªæ˜¯äº¤ä»˜çš„è½¯ä»¶äº§å“ä»åŠŸèƒ½å±‚é¢æ»¡è¶³éœ€æ±‚å®šä¹‰\n- Production Readyé™¤äº†åŠŸèƒ½å°±ç»ªè¿˜åŒ…å«\n\t- LnPæµ‹è¯•é€šè¿‡ï¼Œæ»¡è¶³æ€§èƒ½éœ€æ±‚\n\t- ç”¨æˆ·æ‰‹å†Œå®Œæˆï¼Œç”¨æˆ·å¯æŒ‰ç…§ç”¨æˆ·æ‰‹å†Œä½¿ç”¨æ—¢å®šåŠŸèƒ½\n\t- ç®¡ç†æ‰‹å†Œå®Œæˆï¼Œè¿ç»´äººå‘˜å¯ä»¥ä¾ç…§ç®¡ç†æ‰‹å†Œéƒ¨ç½²ï¼Œå‡çº§äº§å“å¹¶è§£å†³ç°ç½‘é—®é¢˜\n\t- ç›‘æ§ï¼ŒåŒ…æ‹¬\n\t\t- ç»„ä»¶å¥åº·çŠ¶æ€æ£€æŸ¥ï¼ˆUPï¼‰\n\t\t- æ€§èƒ½æŒ‡æ ‡ï¼ˆMetricsï¼‰\n\t\t- åŸºäºæ€§èƒ½æŒ‡æ ‡ï¼Œå®šä¹‰alert ruleï¼Œåœ¨ç³»ç»Ÿæ•…éšœæˆ–ç¼“æ…¢æ—¶ï¼Œå‘é€å‘Šè­¦ä¿¡æ¯ç»™è¿ç»´äººå‘˜\n\t\t- Assertionï¼Œå®šæœŸæµ‹è¯•æŸåŠŸèƒ½å¹¶æ£€æŸ¥ç»“æœï¼Œæ¯”å¦‚æ¯å°æ—¶åˆ›å»ºserviceï¼Œæµ‹è¯•vipè¿é€šæ€§\n\n## å•ä½“æ¶æ„ä¸‹çš„äººå‘˜é…ç½®\n\n![image.png](Extras/Images/image_1667059342424_0.png)\n\n## å¾®æœåŠ¡æ¶æ„ä¸‹çš„äººå‘˜é…ç½®\n\n![image.png](Extras/Images/image_1667059375806_0.png)\n\n## DevOpsä¸‹çš„äººå‘˜åˆ’åˆ†\n\n![image.png](Extras/Images/image_1667059434125_0.png)\n\n## æ­¤ç»„ç»‡ç»“æ„çš„ä¼˜ç¼ºç‚¹\n\n### ä¼˜åŠ¿\n\n- ä¸€ä¸ªæ¶æ„å¸ˆè´Ÿè´£æ•´ä¸ªäº§å“çš„è§„åˆ’ï¼Œä½¿å¾—äº§å“æ›´è§„èŒƒï¼Œäº§å“è¿›åŒ–ä¸åŒçš„Programç”±ä¸åŒPOè´Ÿè´£ç«¯åˆ°ç«¯ï¼Œä»éœ€æ±‚åˆ°ç”Ÿäº§ç³»ç»Ÿéƒ¨ç½²ï¼Œä¿è¯solutionè´¨é‡\n- ç ”å‘å’Œè¿è¥ç»Ÿä¸€ï¼Œä¸€ä¸ªæœ€å¤§çš„ä½œç”¨æ˜¯ç ”å‘å¯ä»¥æ·±åˆ»ç†è§£ç°ç½‘ç—›è‹¦ï¼Œå¯¹åŠŸèƒ½éœ€æ±‚çš„è®¾è®¡ï¼Œå’Œä¼˜å…ˆçº§å®šä¹‰æœ‰æå¤§å¸®åŠ©ã€‚\n- Function ready vs. production ready\n- Programming vs. Engineering\n- æ›´å…·è¿ç»­æ€§\n\n### é—®é¢˜\n\n- ä¼ ç»Ÿè¿è¥å’Œå¼€å‘çš„å†²çªå¹¶éæ¶ˆå¤±ï¼Œè€Œæ˜¯è½¬å˜ä¸ºäº†è¿è¥ç»ç†å’Œæ¶æ„ä»¥åŠPOä¹‹é—´çš„å†²çªã€‚\n- è¿è¥è½®å€¼å¯¼è‡´ç”Ÿäº§ç³»ç»Ÿæƒè´£ä¸æ˜ç¡®\n- è½®å€¼æœŸé—´æœŸå¾…ä¸å‡ºæ•…éšœ\n- å¯¹äºå‡ºç°çš„æ•…éšœç¼ºå°‘ç«¯å¯¹ç«¯çš„è·Ÿè¸ªï¼Œå¯èƒ½é—®é¢˜è¿˜æ²¡å¤„ç†ç»“æŸï¼Œå·²ç»è¦äº¤æ¥ç»™ä¸‹ä¸€ä¸ªäººäº†\n- å¯¹äºç”Ÿäº§ç³»ç»Ÿçš„ç§¯ç´¯é—®é¢˜ï¼Œå¦‚æ•…éšœèŠ‚ç‚¹ï¼Œæ— äººä¸“èŒå¤„ç†ï¼Œå¯¼è‡´æ¯”è¾ƒå¤šçš„æ•…éšœèŠ‚ç‚¹å †ç§¯\n- å¯¹äºç”Ÿäº§ç³»ç»Ÿçš„é…ç½®ï¼Œæ— ç»Ÿä¸€è§„åˆ’ï¼Œæ¯ä¸ªäººå¯èƒ½ç”¨ä¸åŒçš„é…ç½®è¾¾åˆ°ç›¸åŒçš„ç›®çš„\n- Devè‡ªä¸»æƒè¿‡é«˜å¯¼è‡´Devå¯ä»¥å·å·åŠ åŠŸèƒ½å¹¶éƒ¨ç½²åˆ°ç”Ÿäº§\n\n## æˆ‘çœ¼ä¸­ç†æƒ³çš„DevOps\n\nDevå’ŒOpséœ€è¦è´£æƒåˆ’åˆ†ï¼Œå¯ä»¥æœ‰overlapï¼ŒåŒæ—¶åšéƒ¨ç½²ï¼ŒåŒæ—¶åšè®¡åˆ’ï¼Œä½†Devåº”ä¾§é‡åŠŸèƒ½å¼€å‘ï¼ŒOpsåé‡ç”Ÿäº§ç³»ç»Ÿè¿ç»´\n\nOpså‚ä¸åˆ°ç‰ˆæœ¬è§„åˆ’æµç¨‹ä¸­ï¼Œå¹¶ä¸ºä¸€ä¸ªåŠŸèƒ½èƒ½ä¸èƒ½releaseå’ŒdeployæŠŠå…³\n\n- Dev\n\t- Plan\n\t- Code\n\t- Build\n\t- Test\n\t- Release\n\t- Deploy\n- Ops\n\t- Deploy\n\t- Operate\n\t- Monitor\n\t- Plan\n\n![image.png](Extras/Images/image_1667060313830_0.png)\n\n## DevOpsæµç¨‹æ¦‚è§ˆ\n\n![image.png](Extras/Images/image_1667060846273_0.png)\n\n## ä»£ç åˆ†æ”¯ç®¡ç†\n\n![image.png](Extras/Images/image_1667060900749_0.png)\n\n## æŒç»­é›†æˆ\n\n![image.png](Extras/Images/image_1667061198936_0.png)\n\n## æŒç»­éƒ¨ç½²\n\n![image.png](Extras/Images/image_1667061220025_0.png)\n\n## Gitops\n\n![image.png](Extras/Images/image_1667061243780_0.png)\n\n# åŸºäºJenkinsçš„è‡ªåŠ¨åŒ–æµæ°´çº¿\n\n## Kubernetes CI\u0026CDå®Œæ•´æµç¨‹\n\n![image.png](Extras/Images/image_1667115885998_0.png)\n\n# Tekton\n\n## Jenkinsçš„ä¸è¶³\n\n- åŸºäºè„šæœ¬çš„Jobé…ç½®å¤ç”¨ç‡ä¸è¶³\n\t- Jenkinsç­‰å·¥å…·çš„æµæ°´çº¿ä½œä¸šé€šå¸¸åŸºäºå¤§é‡ä¸å¯å¤ç”¨çš„è„šæœ¬è¯­è¨€ï¼Œå¦‚ä½•æé«˜ä»£ç å¤ç”¨ç‡\n- ä»£ç è°ƒè¯•å›°éš¾\n\t- å¦‚ä½•è®©æµæ°´çº¿ä½œä¸šçš„é…ç½®æ›´å¥½åœ°é€‚åº”äº‘åŸç”Ÿåœºæ™¯çš„éœ€æ±‚è¶Šæ¥è¶Šæ€¥è¿«\n\n## åŸºäºå£°æ˜å¼APIçš„æµæ°´çº¿-Tekton\n\nè‡ªå®šä¹‰ï¼šTektonå¯¹è±¡æ˜¯é«˜åº¦è‡ªå®šä¹‰çš„ï¼Œå¯æ‰©å±•æ€§æå¼ºã€‚å¹³å°å·¥ç¨‹å¸ˆå¯é¢„å®šä¹‰å¯é‡ç”¨æ¨¡å—ä»¥è¯¦ç»†çš„æ¨¡å—ç›®å½•æä¾›ï¼Œå¼€å‘äººå‘˜å¯åœ¨å…¶ä»–é¡¹ç›®ä¸­ç›´æ¥å¼•ç”¨ã€‚\n\nå¯é‡ç”¨ï¼šTektonå¯¹è±¡çš„å¯é‡ç”¨æ€§å¼ºï¼Œç»„ä»¶åªéœ€â€”æ¬¡å®šä¹‰ï¼Œå³å¯è¢«ç»„ç»‡å†…çš„ä»»ä½•äººåœ¨ä»»ä½•æµæ°´çº¿éƒ½å¯é‡ç”¨ã€‚ä½¿å¾—å¼€å‘äººå‘˜æ— éœ€é‡å¤é€ è½®å­å³å¯æ„å»ºå¤æ‚æµæ°´çº¿ã€‚\n\nå¯æ‰©å±•æ€§ï¼šTektonç»„ä»¶ç›®å½•ï¼ˆTekton Catalogï¼‰æ˜¯ä¸€ä¸ªç¤¾åŒºé©±åŠ¨çš„Tektonç»„ä»¶çš„å­˜å‚¨ä»“åº“ã€‚ä»»ä½•ç”¨æˆ·å¯ä»¥ç›´æ¥ä»ç¤¾åŒºè·å–æˆç†Ÿçš„ç»„ä»¶å¹¶åœ¨æ­¤ä¹‹ä¸Šæ„å»ºå¤æ‚æµæ°´çº¿ï¼Œä¹Ÿå°±æ˜¯å½“ä½ è¦æ„å»ºä¸€ä¸ªæµæ°´çº¿æ—¶ï¼Œå¾ˆå¯èƒ½ä½ éœ€è¦çš„æ‰€æœ‰ä»£ç å’Œé…ç½®éƒ½å¯ä»¥ä»Tekton Catalogç›´æ¥æ‹¿ä¸‹æ¥å¤ç”¨ï¼Œè€Œæ— éœ€é‡å¤å¼€å‘ã€‚\n\næ ‡å‡†åŒ–ï¼šTektonä½œä¸ºKubernetesé›†ç¾¤çš„æ‰©å±•å®‰è£…å’Œè¿è¡Œï¼Œå¹¶ä½¿ç”¨ä¸šç•Œå…¬è®¤çš„Kubernetesèµ„æºæ¨¡å‹ï¼›Tektonä½œä¸šä»¥Kuberneteså®¹å™¨å½¢æ€æ‰§è¡Œã€‚\n\nè§„æ¨¡åŒ–æ”¯æŒï¼šåªéœ€å¢åŠ KubernetesèŠ‚ç‚¹ï¼Œå³å¯å¢åŠ ä½œä¸šå¤„ç†èƒ½åŠ›ã€‚Tektonçš„èƒ½åŠ›å¯ä¾ç…§é›†ç¾¤è§„æ¨¡éšæ„æ‰©å……ï¼Œæ— éœ€é‡æ–°å®šä¹‰èµ„æºåˆ†é…éœ€æ±‚æˆ–è€…é‡æ–°å®šä¹‰æµæ°´çº¿ã€‚\n\n## Tektonæ ¸å¿ƒç»„ä»¶\n\nPipelineï¼šå¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªæµæ°´çº¿ä½œä¸šï¼Œä¸€ä¸ªPipelineå¯¹è±¡ç”±ä¸€ä¸ªæˆ–æ•°ä¸ªTaskå¯¹è±¡ç»„æˆã€‚\n\nTaskï¼šä¸€ä¸ªå¯ç‹¬ç«‹è¿è¡Œçš„ä»»åŠ¡ï¼Œå¦‚è·å–ä»£ç ï¼Œç¼–è¯‘ï¼Œæˆ–è€…æ¨é€é•œåƒç­‰ç­‰ï¼Œå½“æµæ°´çº¿è¢«è¿è¡Œæ—¶ï¼ŒKubernetesä¼šä¸ºæ¯ä¸ªTaskåˆ›å»ºä¸€ä¸ªPodã€‚ä¸€ä¸ªTaskç”±å¤šä¸ªStepç»„æˆï¼Œæ¯ä¸ªStepä½“ç°ä¸ºè¿™ä¸ªPodä¸­çš„ä¸€ä¸ªå®¹å™¨ã€‚\n\n![image.png](Extras/Images/image_1667119295352_0.png)\n\n## è¾“å…¥è¾“å‡ºèµ„æº\n\nPipelineå’ŒTaskå¯¹è±¡å¯ä»¥æ¥æ”¶git reposityï¼Œpull requestç­‰èµ„æºä½œä¸ºè¾“å…¥ï¼Œå¯ä»¥å°†Imageï¼ŒKubernetes Clusterï¼ŒStorageï¼ŒCloudEventç­‰å¯¹è±¡ä½œä¸ºè¾“å‡º\n\n![image.png](Extras/Images/image_1667119345327_0.png)\n\n## äº‹ä»¶è§¦å‘çš„è‡ªåŠ¨åŒ–æµæ°´çº¿\n\n![image.png](Extras/Images/image_1667120405330_0.png)\n\n## EventListener\n\nEventListener:\n\näº‹ä»¶ç›‘å¬å™¨ï¼Œè¯¥å¯¹è±¡æ ¸å¿ƒå±æ€§æ˜¯interceptorsæ‹¦æˆªå™¨ï¼Œè¯¥æ‹¦æˆªå™¨å¯ç›‘å¬å¤šç§ç±»å‹çš„äº‹ä»¶ï¼Œæ¯”å¦‚ç›‘å¬æ¥è‡ªGitLabçš„Pushäº‹ä»¶ã€‚\n\nå½“è¯¥EventListenerå¯¹è±¡è¢«åˆ›å»ºä»¥åï¼ŒTekton æ§åˆ¶å™¨ä¼šä¸ºè¯¥EventListeneråˆ›å»ºKubernetes Podå’ŒServiceï¼Œå¹¶å¯åŠ¨ä¸€ä¸ªHTTPæœåŠ¡ä»¥ç›‘å¬Pushäº‹ä»¶ã€‚\n\nå½“ç”¨æˆ·åœ¨GitLabé¡¹ç›®ä¸­è®¾ç½®webhookå¹¶å¡«å†™è¯¥EventListenerçš„æœåŠ¡åœ°å€ä»¥åï¼Œä»»ä½•äººé’ˆå¯¹è¢«ç®¡ç†é¡¹ç›®å‘èµ·çš„Pushæ“ä½œï¼Œéƒ½ä¼šè¢«EventListeneræ•è·ã€‚\n\n# Argocd\n\n## Argocd\n\nArgo CDæ˜¯ç”¨äºKubernetesçš„å£°æ˜æ€§GitOpsè¿ç»­äº¤ä»˜å·¥å…·ã€‚\n\n**ä¸ºä»€ä¹ˆé€‰æ‹©Argo CD?**\n\nåº”ç”¨ç¨‹åºå®šä¹‰ï¼Œé…ç½®å’Œç¯å¢ƒåº”ä¸ºå£°æ˜æ€§çš„ï¼Œå¹¶å—ç‰ˆæœ¬æ§åˆ¶ã€‚\n\nåº”ç”¨ç¨‹åºéƒ¨ç½²å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†åº”è¯¥æ˜¯è‡ªåŠ¨åŒ–çš„ï¼Œå¯å®¡æ ¸çš„ä¸”æ˜“äºç†è§£çš„ã€‚\n\n## argo cd æ¶æ„\n\nArgo CDè¢«å®ç°ä¸ºkubernetesæ§åˆ¶å™¨ï¼Œè¯¥æ§åˆ¶å™¨è¿ç»­ç›‘è§†æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œå¹¶å°†å½“å‰çš„æ´»åŠ¨çŠ¶æ€ä¸æ‰€éœ€çš„ç›®æ ‡çŠ¶æ€ï¼ˆåœ¨Gitå­˜å‚¨åº“ä¸­æŒ‡å®šï¼‰è¿›è¡Œæ¯”è¾ƒã€‚\n\nå…¶æ´»åŠ¨çŠ¶æ€åç¦»ç›®æ ‡çŠ¶æ€çš„å·²éƒ¨ç½²åº”ç”¨ç¨‹åºè¢«æ ‡è®°ä¸ºOutofsyncã€‚\n\nArgo CDæŠ¥å‘Šå¹¶å¯è§†åŒ–å·®å¼‚ï¼ŒåŒæ—¶æä¾›äº†è‡ªåŠ¨æˆ–æ‰‹åŠ¨å°†å®æ—¶çŠ¶æ€åŒæ­¥å›æ‰€éœ€ç›®æ ‡çŠ¶æ€çš„åŠŸèƒ½ã€‚\n\nåœ¨Gitå­˜å‚¨åº“ä¸­å¯¹æ‰€éœ€ç›®æ ‡çŠ¶æ€æ‰€åšçš„ä»»ä½•ä¿®æ”¹éƒ½å¯ä»¥è‡ªåŠ¨åº”ç”¨å¹¶åæ˜ åœ¨æŒ‡å®šçš„ç›®æ ‡ç¯å¢ƒä¸­ã€‚\n\n![image.png](Extras/Images/image_1667121172178_0.png)\n\n## argocdçš„é€‚ç”¨åœºæ™¯\n\n1. ä½æˆæœ¬çš„Gitopsåˆ©å™¨\n2. å¤šé›†ç¾¤ç®¡ç†\n\t1. ä¸åŒç›®çš„é›†ç¾¤âˆ¶æµ‹è¯•ï¼Œé›†æˆï¼Œé¢„ç”Ÿäº§ï¼Œç”Ÿäº§\n\t2. å¤šç”Ÿäº§é›†ç¾¤ç®¡ç†\n\n# ç›‘æ§å’Œæ—¥å¿—\n\n## æ•°æ®ç³»ç»Ÿæ„å»º\n\næ—¥å¿—æ”¶é›†ä¸åˆ†æ\n\nç›‘æ§ç³»ç»Ÿæ„å»º\n\n## æ—¥å¿—ç³»ç»Ÿçš„ä»·å€¼\n\nåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ—¥å¿—æŸ¥çœ‹æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºå¤šå¯¹èŠ‚ç‚¹çš„ç³»ç»Ÿï¼Œè¦å…ˆæ‰¾åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ï¼Œæ‰èƒ½çœ‹åˆ°æƒ³çœ‹çš„æ—¥å¿—ã€‚æ—¥å¿—ç³»ç»ŸæŠŠæ•´ä¸ªé›†ç¾¤çš„æ—¥å¿—æ±‡æ€»åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿æŸ¥çœ‹\n\nå› ä¸ºèŠ‚ç‚¹ä¸Šçš„æ—¥å¿—æ»šåŠ¨æœºåˆ¶ï¼Œå¦‚æœæœ‰åº”ç”¨æ‰“å°å¤ªå¤šæ—¥å¿—ï¼Œå¦‚æœæ²¡æœ‰æ—¥å¿—ç³»ç»Ÿï¼Œä¼šå¯¼è‡´å…³é”®æ—¥å¿— â€¢ä¸¢å¤±ã€‚\n\næ—¥å¿—ç³»ç»Ÿçš„é‡è¦æ„ä¹‰åœ¨äºè§£å†³ï¼ŒèŠ‚ç‚¹å‡ºé”™å¯¼è‡´ä¸å¯è®¿é—®ï¼Œè¿›è€Œä¸¢å¤±æ—¥å¿—çš„æƒ…å†µã€‚\n\n## å¸¸ç”¨æ•°æ®ç³»ç»Ÿæ„å»ºæ¨¡å¼\n\n![image.png](Extras/Images/image_1667134573485_0.png)\n\n## æ—¥å¿—æ”¶é›†ç³»ç»ŸLoki\n\nGrafana Lokiæ˜¯å¯ä»¥ç»„æˆåŠŸèƒ½é½å…¨çš„æ—¥å¿—è®°å½•å †æ ˆçš„ä¸€ç»„ç»„ä»¶ã€‚\n\n- ä¸å…¶ä»–æ—¥å¿—è®°å½•ç³»ç»Ÿä¸åŒï¼ŒLokiæ˜¯åŸºäºä»…ç´¢å¼•æœ‰å…³æ—¥å¿—çš„å…ƒæ•°æ®çš„æƒ³æ³•è€Œæ„å»ºçš„ï¼šæ ‡ç­¾ã€‚\n- æ—¥å¿—æ•°æ®æœ¬èº«è¢«å‹ç¼©å¹¶å­˜å‚¨åœ¨å¯¹è±¡å­˜å‚¨ï¼ˆä¾‹å¦‚S3æˆ–GCSï¼‰ä¸­çš„å—ä¸­ï¼Œç”šè‡³å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿæœ¬åœ°ã€‚\n- å°ç´¢å¼•å’Œé«˜åº¦å‹ç¼©çš„å—ç®€åŒ–äº†æ“ä½œï¼Œå¹¶å¤§å¤§é™ä½äº†Lokiçš„æˆæœ¬ã€‚\n\n## åŸºäºLokiçš„æ—¥å¿—æ”¶é›†ç³»ç»Ÿ\n\n![image.png](Extras/Images/image_1667135054996_0.png)\n\n## Loki-stackå­ç³»ç»Ÿ\n\n- Promtail\n\t- å°†å®¹å™¨æ—¥å¿—å‘é€åˆ° Lokiæˆ–è€…Grafana æœåŠ¡ä¸Šçš„æ—¥å¿—æ”¶é›†å·¥å…·\n\t- å‘ç°é‡‡é›†ç›®æ ‡ä»¥åŠç»™æ—¥å¿—æµæ·»åŠ ä¸ŠLabelï¼Œç„¶åå‘é€ç»™Loki\n\t- Promtail çš„æœåŠ¡å‘ç°æ˜¯åŸºäºPrometheus çš„æœåŠ¡å‘ç°æœºåˆ¶å®ç°çš„ï¼Œå¯ä»¥æŸ¥çœ‹configmap loki-promtailäº†è§£ç»†èŠ‚\n- Loki\n\t- Lokiæ˜¯å¯ä»¥æ°´å¹³æ‰©å±•ã€é«˜å¯ç”¨ä»¥åŠæ”¯æŒå¤šç§Ÿæˆ·çš„æ—¥å¿—èšåˆç³»ç»Ÿ\n\t- ä½¿ç”¨å’Œ Prometheus ç›¸åŒçš„æœåŠ¡å‘ç°æœºåˆ¶ï¼Œå°†æ ‡ç­¾æ·»åŠ åˆ°æ—¥å¿—æµä¸­è€Œä¸æ˜¯æ„å»ºå…¨æ–‡ç´¢å¼•\n\t- Promtail æ¥æ”¶åˆ°çš„æ—¥å¿—å’Œåº”ç”¨çš„ metricsæŒ‡æ ‡å°±å…·æœ‰ç›¸åŒçš„æ ‡ç­¾é›†\n- Grafana\n\t- Grafana æ˜¯ä¸€ä¸ªç”¨äºç›‘æ§å’Œå¯è§†åŒ–è§‚æµ‹çš„å¼€æºå¹³å°ï¼Œæ”¯æŒéå¸¸ä¸°å¯Œçš„æ•°æ®æº\n\t- åœ¨ LokiæŠ€æœ¯æ ˆä¸­å®ƒä¸“é—¨ç”¨æ¥å±•ç¤ºæ¥è‡ª Prometheuså’Œ Loki ç­‰æ•°æ®æºçš„æ—¶é—´åºåˆ—æ•°æ®\n\t- å…è®¸è¿›è¡ŒæŸ¥è¯¢ã€å¯è§†åŒ–ã€æŠ¥è­¦ç­‰æ“ä½œï¼Œå¯ä»¥ç”¨äºåˆ›å»ºã€æ¢ç´¢å’Œå…±äº«æ•°æ® Dashboard\n\n## Lokiæ¶æ„\n\n![image.png](Extras/Images/image_1667135213971_0.png)\n\n## Lokiç»„ä»¶\n\n- Distributorï¼ˆåˆ†é…å™¨ï¼‰\n\t- åˆ†é…å™¨æœåŠ¡è´Ÿè´£å¤„ç†å®¢æˆ·ç«¯å†™å…¥çš„æ—¥å¿—ã€‚\n\t- ä¸€æ—¦åˆ†é…å™¨æ¥æ”¶åˆ°æ—¥å¿—æ•°æ®ï¼Œå®ƒå°±ä¼šæŠŠå®ƒä»¬åˆ†æˆè‹¥å¹²æ‰¹æ¬¡ï¼Œå¹¶å°†å®ƒä»¬å¹¶è¡Œåœ°å‘é€åˆ°å¤šä¸ªé‡‡é›†å™¨å»ã€‚\n\t- åˆ†é…å™¨é€šè¿‡ gRPCå’Œé‡‡é›†å™¨è¿›è¡Œé€šä¿¡ã€‚\n\t- å®ƒä»¬æ˜¯æ— çŠ¶æ€çš„ï¼Œ åŸºäºä¸€è‡´æ€§å“ˆå¸Œï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å®é™…éœ€è¦å¯¹ä»–ä»¬è¿›è¡Œæ‰©ç¼©å®¹ã€‚\n- Ingesterï¼ˆé‡‡é›†å™¨ï¼‰\n\t- é‡‡é›†å™¨æœåŠ¡è´Ÿè´£å°†æ—¥å¿—æ•°æ®å†™å…¥é•¿æœŸå­˜å‚¨çš„åç«¯ï¼ˆDynamoDBã€S3ã€Cassandra ç­‰ç­‰ï¼‰ã€‚\n\t- é‡‡é›†å™¨ä¼šæ ¡éªŒé‡‡é›†çš„æ—¥å¿—æ˜¯å¦ä¹±åºã€‚\n\t- é‡‡é›†å™¨éªŒè¯æ¥æ”¶åˆ°çš„æ—¥å¿—è¡Œæ˜¯æŒ‰ç…§æ—¶é—´æˆ³é€’å¢çš„é¡ºåºæ¥æ”¶çš„ï¼Œå¦åˆ™æ—¥å¿—è¡Œå°†è¢«æ‹’ç»å¹¶è¿”å›é”™è¯¯ã€‚\n- Querierï¼ˆæŸ¥è¯¢å™¨ï¼‰\n\t- æŸ¥è¯¢å™¨æœåŠ¡è´Ÿè´£å¤„ç† LogQL æŸ¥è¯¢è¯­å¥æ¥è¯„ä¼°å­˜å‚¨åœ¨é•¿æœŸå­˜å‚¨ä¸­çš„æ—¥å¿—æ•°æ®ã€‚\n\n## åœ¨ç”Ÿäº§ä¸­çš„é—®é¢˜\n\nå­˜åœ¨çš„é—®é¢˜\n\n- åˆ©ç”¨ç‡ä½\n\t- æ—¥å¿—å¤§å¤šæ•°ç›®çš„æ˜¯ç»™ç®¡ç†å‘˜åšé—®é¢˜åˆ†æç”¨çš„ï¼Œä½†ç®¡ç†å‘˜æ›´å¤šçš„æ˜¯ç™»é™†åˆ°èŠ‚ç‚¹æˆ–è€…podé‡Œåšåˆ†æï¼Œå› ä¸ºæ—¥å¿—åˆ†æåªæ˜¯æ•´ä¸ªåˆ†æè¿‡ç¨‹ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™é¡ºæ‰‹å°±æŠŠæ—¥å¿—çœ‹äº†\n- Beatså‡ºç°è¿‡é”ä½æ–‡ä»¶ç³»ç»Ÿï¼Œdocker containeræ— æ³•åˆ é™¤çš„æƒ…å†µ\n- ä¸ç›‘æ§ç³»ç»Ÿç›¸æ¯”ï¼Œæ—¥å¿—ç³»ç»Ÿçš„é‡è¦åº¦ç¨ä½\n- å‡ºç°è¿‡å¤šæ¬¡å› ä¸ºæ—¥å¿—æ»šåŠ¨å¤ªå¿«è€Œä½¿å¾—æ—¥å¿—æ”¶é›†å ç”¨å¤ªå¤§ç½‘ç»œå¸¦å®½çš„æƒ…å†µ\n\n## ç›‘æ§ç³»ç»Ÿ\n\n- ä¸ºä»€ä¹ˆç›‘æ§ï¼Œç›‘æ§ä»€ä¹ˆå†…å®¹\n\t- å¯¹è‡ªå·±ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€äº†å¦‚æŒ‡æŒï¼Œæœ‰é—®é¢˜åŠæ—¶å‘ç°ï¼Œè€Œä¸è®©ç”¨æˆ·å…ˆå‘ç°æˆ‘ä»¬ç³»ç»Ÿä¸èƒ½ä½¿ç”¨ã€‚\n\t- æˆ‘ä»¬ä¹Ÿéœ€è¦çŸ¥é“æˆ‘ä»¬çš„æœåŠ¡è¿è¡Œæƒ…å†µã€‚ä¾‹å¦‚ï¼Œslowsqlå¤„äºä»€ä¹ˆæ°´å¹³ï¼Œå¹³å‡å“åº”æ—¶é—´è¶…è¿‡200msçš„å æ¯”æœ‰ç™¾åˆ†ä¹‹å¤šå°‘\n- æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§æˆ‘ä»¬çš„æœåŠ¡\n\t- éœ€è¦ç›‘æ§å·¥å…·æ¥æé†’æˆ‘æœåŠ¡å‡ºç°äº†æ•…éšœï¼Œæ¯”å¦‚é€šè¿‡ç›‘æ§æœåŠ¡çš„è´Ÿè½½æ¥å†³å®šæ‰©å®¹æˆ–ç¼©å®¹ã€‚å¦‚æœæœºå™¨æ™®éè´Ÿè½½ä¸é«˜ï¼Œåˆ™å¯ä»¥è€ƒè™‘æ˜¯å¦ç¼©å‡ä¸€ä¸‹æœºå™¨è§„æ¨¡ï¼Œå¦‚æœæ•°æ®åº“è¿æ¥ç»å¸¸ç»´æŒåœ¨ä¸€ä¸ªé«˜ä½æ°´å¹³ï¼Œåˆ™å¯ä»¥è€ƒè™‘ä¸€ä¸‹æ˜¯å¦å¯ä»¥è¿›è¡Œæ‹†åº“å¤„ç†ï¼Œä¼˜åŒ–ä¸€ä¸‹æ¶æ„ã€‚\n\t- ç›‘æ§è¿˜å¯ä»¥å¸®åŠ©è¿›è¡Œå†…éƒ¨ç»Ÿåˆ¶ï¼Œå°¤å…¶æ˜¯å¯¹å®‰å…¨æ¯”è¾ƒæ•æ„Ÿçš„è¡Œä¸šï¼Œæ¯”å¦‚è¯åˆ¸é“¶è¡Œç­‰ã€‚æ¯”å¦‚æœåŠ¡å™¨å—åˆ°æ”»å‡»æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ†æäº‹ä»¶ï¼Œæ‰¾åˆ°æ ¹æœ¬åŸå› ï¼Œè¯†åˆ«ç±»ä¼¼æ”»å‡»ï¼Œå‘ç°æ²¡æœ‰å‘ç°çš„è¢«æ”»å‡»çš„ç³»ç»Ÿï¼Œç”šè‡³å®Œæˆå–è¯ç­‰å·¥ä½œã€‚\n- ç›‘æ§ç›®çš„\n\t- å‡å°‘å®•æœºæ—¶é—´\n\t- æ‰©å±•å’Œæ€§èƒ½ç®¡ç†\n\t- èµ„æºè®¡åˆ’\n\t- è¯†åˆ«å¼‚å¸¸äº‹ä»¶\n\t- æ•…éšœæ’é™¤ã€åˆ†æ\n\n## åœ¨Kubernetesé›†ç¾¤ä¸­çš„ç›‘æ§ç³»ç»Ÿ\n\n![image.png](Extras/Images/image_1667136576658_0.png)\n\n## Prometheusä¸­çš„æŒ‡æ ‡ç±»å‹\n\n- Counter ï¼ˆè®¡æ•°å™¨å™¨ï¼‰\n\t- Counter ç±»å‹ä»£è¡¨ä¸€ç§æ ·æœ¬æ•°æ®å•è°ƒé€’å¢çš„æŒ‡æ ‡ï¼Œå³åªå¢ä¸å‡ï¼Œé™¤éç›‘æ§ç³»ç»Ÿå‘ç”Ÿäº†é‡ç½®ã€‚\n- Gaugeï¼ˆä»ªè¡¨ç›˜ï¼‰\n\t- Guage ç±»å‹ä»£è¡¨ä¸€ç§æ ·æœ¬æ•°æ®å¯ä»¥ä»»æ„å˜åŒ–çš„æŒ‡æ ‡ï¼Œå³å¯å¢å¯å‡ã€‚\n- Histogramï¼ˆç›´æ–¹å›¾ï¼‰\n\t- Histogram åœ¨ä¸€æ®µæ—¶é—´èŒƒå›´å†…å¯¹æ•°æ®è¿›è¡Œé‡‡æ ·ï¼ˆé€šå¸¸æ˜¯è¯·æ±‚æŒç»­æ—¶é—´æˆ–å“åº”å¤§å°ç­‰ï¼‰ï¼Œå¹¶å°†å…¶è®¡å…¥å¯é…ç½®çš„å­˜å‚¨æ¡¶ï¼ˆbucketï¼‰ä¸­ï¼Œåç»­å¯é€šè¿‡æŒ‡å®šåŒºé—´ç­›é€‰æ ·æœ¬ï¼Œä¹Ÿå¯ä»¥ç»Ÿè®¡æ ·æœ¬æ€»æ•°ï¼Œæœ€åä¸€èˆ¬å°†æ•°æ®å±•ç¤ºä¸ºç›´æ–¹å›¾\n\t- æ ·æœ¬çš„å€¼åˆ†å¸ƒåœ¨ bucket ä¸­çš„æ•°é‡ï¼Œå‘½åä¸º `\u003cbasename\u003e_bucket{le=\"\u003cä¸Šè¾¹ç•Œ\u003e\"}`\n\t- æ‰€æœ‰æ ·æœ¬å€¼çš„å¤§å°æ€»å’Œï¼Œå‘½åä¸º `\u003cbasename\u003e_sum`\n\t- æ ·æœ¬æ€»æ•°ï¼Œå‘½åä¸º `\u003cbasename\u003e_count`ã€‚å€¼å’Œ `\u003cbasename\u003e_bucket{le=\"+Inf\"}` ç›¸åŒ\n- Summaryï¼ˆæ‘˜è¦ï¼‰\n\t- ä¸ Histogram ç±»å‹ç±»ä¼¼ï¼Œç”¨äºè¡¨ç¤ºä¸€æ®µæ—¶é—´å†…çš„æ•°æ®é‡‡æ ·ç»“æœï¼ˆé€šå¸¸æ˜¯è¯·æ±‚æŒç»­æ—¶é—´æˆ–å“åº”å¤§å°ç­‰ï¼‰ï¼Œä½†å®ƒç›´æ¥å­˜å‚¨äº†åˆ†ä½æ•°ï¼ˆé€šè¿‡å®¢æˆ·ç«¯è®¡ç®—ï¼Œç„¶åå±•ç¤ºå‡ºæ¥ï¼‰ï¼Œè€Œä¸æ˜¯é€šè¿‡åŒºé—´æ¥è®¡ç®—\n\t- å®ƒä»¬éƒ½åŒ…å«äº† `\u003cbasename\u003e_sum` å’Œ `\u003cbasename\u003e_count` æŒ‡æ ‡\n\t- Histogram éœ€è¦é€šè¿‡ `\u003cbasename\u003e_bucket` æ¥è®¡ç®—åˆ†ä½æ•°ï¼Œè€Œ Summary åˆ™ç›´æ¥å­˜å‚¨äº†åˆ†ä½æ•°çš„å€¼ã€‚\n\n## Prometheus Query Language\n\n- histogram_quantile(0.95, sum(rate(httpserver_execution_latency_seconds_bucket\\[5m\\])) by (le))\n- Histogramæ˜¯ç›´æ–¹å›¾ï¼Œ httpserver_execution_latency_seconds_buckeæ˜¯ç›´æ–¹å›¾æŒ‡æ ‡ï¼Œæ˜¯å°†httpserverå¤„ç†è¯·æ±‚çš„æ—¶é—´æ”¾å…¥ä¸åŒçš„æ¡¶å†…ï¼Œå…¶è¡¨è¾¾çš„æ˜¯è½åœ¨ä¸åŒæ—¶é•¿åŒºé—´çš„å“åº”æ¬¡æ•°\n- by (le)ï¼Œæ˜¯å°†é‡‡é›†çš„æ•°æ®æŒ‰æ¡¶çš„ä¸Šè¾¹ç•Œåˆ†ç»„\n- rate(httpserver_execution_latency_seconds_bucket\\[5m\\])ï¼Œè®¡ç®—çš„æ˜¯äº”åˆ†é’Ÿå†…çš„å˜åŒ–ç‡\n- Sum()ï¼Œæ˜¯å°†æ‰€æœ‰æŒ‡æ ‡çš„å˜åŒ–ç‡æ€»è®¡\n- 0.95ï¼Œæ˜¯å–95åˆ†ä½\n- ç»¼ä¸Šï¼š\n\t- ä¸Šè¿°è¡¨è¾¾å¼è®¡ç®—çš„æ˜¯httpserverå¤„ç†è¯·æ±‚æ—¶ï¼Œ95%çš„è¯·æ±‚åœ¨äº”åˆ†é’Ÿå†…ï¼Œåœ¨ä¸åŒå“åº”æ—¶é—´åŒºé—´çš„å¤„ç†çš„æ•°é‡çš„å˜åŒ–æƒ…å†µ\n\n## æ„å»ºæ”¯æ’‘ç”Ÿäº§çš„ç›‘æ§ç³»ç»Ÿ\n\n- Metrics\n\t- æ”¶é›†æ•°æ®\n- Alert\n\t- åˆ›å»ºå‘Šè­¦è§„åˆ™ï¼Œå¦‚æœå‘Šè­¦è§„åˆ™è¢«è§¦å‘ï¼Œåˆ™æŒ‰ä¸åŒçœ¼ä¸­ç¨‹åº¦æ¥å‘Šè­¦\n- Assertion\n\t- ä»¥ä¸€å®šæ—¶é—´é—´éš”ï¼Œæ¨¡æ‹Ÿå®¢æˆ·è¡Œä¸ºï¼Œæ“ä½œkuberneteså¯¹è±¡ï¼Œå¹¶æ–­è¨€æˆåŠŸï¼Œå¦‚æœä¸æˆåŠŸåˆ™æŒ‰çœ¼ä¸­ç¨‹åº¦å‘Šè­¦\n\n## æ¥è‡ªç”Ÿäº§ç³»ç»Ÿçš„ç»éªŒåˆ†äº«\n\n- Prometheuséœ€è¦å¤§å†…å­˜å’Œå­˜å‚¨\n\t- æœ€åˆprometheusç»å¸¸å‘ç”ŸOOM kill\n\t- åœ¨æé«˜æŒ‡å®šçš„èµ„æºä»¥åï¼Œå¦‚æœå‘ç”Ÿcrashæˆ–è€…é‡å¯ï¼Œprometheuséœ€è¦30åˆ†é’Ÿä»¥ä¸Šçš„æ—¶é—´æ¥è¯»å–æ•°æ®è¿›è¡Œåˆå§‹åŒ–\n- Prometheusæ˜¯è¿è¥ç”Ÿäº§ç³»ç»Ÿè¿‡ç¨‹ä¸­æœ€é‡è¦çš„æ¨¡å—\n\t- å¦‚æœprometheus downæœºï¼Œåˆ™æ²¡æœ‰ä»»ä½•æ•°æ®å’Œå‘Šè­¦ï¼Œç®¡ç†å‘˜ä¸¤çœ¼ä¸€é»‘ï¼Œä»€ä¹ˆéƒ½ä¸çŸ¥é“äº†\n\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/%E7%94%9F%E4%BA%A7%E5%8C%96%E9%9B%86%E7%BE%A4%E7%9A%84%E7%AE%A1%E7%90%86":{"title":"ç”Ÿäº§åŒ–é›†ç¾¤çš„ç®¡ç†","content":"\n# è®¡ç®—èŠ‚ç‚¹\n\n## ç”Ÿäº§åŒ–é›†ç¾¤çš„è€ƒé‡\n\n- è®¡ç®—èŠ‚ç‚¹ï¼š\n\t- å¦‚ä½•æ‰¹é‡å®‰è£…å’Œå‡çº§è®¡ç®—èŠ‚ç‚¹çš„æ“ä½œç³»ç»Ÿ?\n\t- å¦‚ä½•ç®¡ç†é…ç½®è®¡ç®—èŠ‚ç‚¹çš„ç½‘ç»œä¿¡æ¯?\n\t- å¦‚ä½•ç®¡ç†ä¸åŒSKUï¼ˆStockKeeping Unitï¼‰çš„è®¡ç®—èŠ‚ç‚¹?\n\t- å¦‚ä½•å¿«é€Ÿä¸‹æ¶æ•…éšœçš„è®¡ç®—èŠ‚ç‚¹?\n\t- å¦‚ä½•å¿«é€Ÿæ‰©ç¼©é›†ç¾¤çš„è§„æ¨¡?\n- æ§åˆ¶å¹³é¢ï¼š\n\t- å¦‚ä½•åœ¨ä¸»èŠ‚ç‚¹ä¸Šä¸‹è½½ã€å®‰è£…å’Œå‡çº§æ§åˆ¶å¹³é¢ç»„ä»¶åŠå…¶æ‰€éœ€çš„é…ç½®æ–‡ä»¶?\n\t- å¦‚ä½•ç¡®ä¿é›†ç¾¤æ‰€éœ€çš„å…¶ä»–æ’ä»¶ï¼Œä¾‹å¦‚CoreDNSã€ç›‘æ§ç³»ç»Ÿç­‰éƒ¨ç½²å®Œæˆ?\n\t- å¦‚ä½•å‡†å¤‡æ§åˆ¶å¹³é¢ç»„ä»¶çš„å„ç§å®‰å…¨è¯ä¹¦?\n\t- å¦‚ä½•å¿«é€Ÿå‡çº§æˆ–å›æ»šæ§åˆ¶å¹³é¢ç»„ä»¶çš„ç‰ˆæœ¬?\n\n# æ“ä½œç³»ç»Ÿçš„é€‰æ‹©\n\n## æ“ä½œç³»ç»Ÿçš„è¯„ä¼°ä¸é€‰æ‹©\n\n- é€šç”¨æ“ä½œç³»ç»Ÿ\n\t- Ubuntu\n\t- Centos\n\t- Fedora\n- ä¸“ä¸ºå®¹å™¨ä¼˜åŒ–çš„æ“ä½œç³»ç»Ÿ\n\t- æœ€å°åŒ–æ“ä½œç³»ç»Ÿ\n\t\t- CoreOS\n\t\t- RedHat Atomic\n\t\t- Snappy Ubuntu Core\n\t\t- RancherOS\n\n## æ“ä½œç³»ç»Ÿçš„è¯„ä¼°ä¸é€‰æ‹©\n\næ“ä½œç³»ç»Ÿè¯„ä¼°å’Œé€‰å‹çš„æ ‡å‡†\n\n- æ˜¯å¦æœ‰ç”Ÿæ€ç³»ç»Ÿ\n- æˆç†Ÿåº¦\n- å†…æ ¸ç‰ˆæœ¬\n- å¯¹è¿è¡Œæ—¶çš„æ”¯æŒ\n- Init System\n- åŒ…ç®¡ç†å’Œç³»ç»Ÿå‡çº§\n- å®‰å…¨\n\n## ç”Ÿæ€ç³»ç»Ÿä¸æˆç†Ÿåº¦\n\nå®¹å™¨ä¼˜åŒ–æ“ä½œç³»ç»Ÿçš„ä¼˜åŠ¿\n\n- å°\n- åŸå­çº§å‡çº§å’Œå›é€€\n- æ›´é«˜çš„å®‰å…¨æ€§\n\n![image.png](Extras/Images/image_1666270636230_0.png)\n\n## äº‘åŸç”Ÿçš„åŸåˆ™\n\nå¯å˜åŸºç¡€è®¾æ–½çš„é£é™©\n\n- åœ¨ç¾éš¾å‘ç”Ÿçš„æ—¶å€™ï¼Œéš¾ä»¥é‡æ–°æ„å»ºæœåŠ¡ã€‚æŒç»­è¿‡å¤šçš„æ‰‹å·¥æ“ä½œï¼Œç¼ºä¹è®°å½•ï¼Œä¼šå¯¼è‡´å¾ˆéš¾ç”±æ ‡å‡†åˆå§‹åŒ–åçš„æœåŠ¡å™¨æ¥é‡æ–°æ„å»ºèµ·ç­‰æ•ˆçš„æœåŠ¡ã€‚\n- åœ¨æœåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒæŒç»­çš„ä¿®æ”¹æœåŠ¡å™¨ï¼Œå°±çŠ¹å¦‚ç¨‹åºä¸­çš„å¯å˜å˜é‡çš„å€¼å‘ç”Ÿå˜åŒ–è€Œå¼•å…¥çš„çŠ¶æ€ä¸ä¸€è‡´çš„å¹¶å‘é£é™©ã€‚è¿™äº›å¯¹äºæœåŠ¡å™¨çš„ä¿®æ”¹ï¼ŒåŒæ ·ä¼šå¼•å…¥ä¸­é—´çŠ¶æ€ï¼Œä»è€Œå¯¼è‡´ä¸å¯é¢„çŸ¥çš„é—®é¢˜ã€‚\n\nä¸å¯å˜åŸºç¡€è®¾æ–½ï¼ˆimmutable infrastructureï¼‰\n\n- ä¸å¯å˜çš„å®¹å™¨é•œåƒ\n- ä¸å¯å˜çš„ä¸»æœºæ“ä½œç³»ç»Ÿ\n\n## Atomic\n\n- ç”±Red Hatæ”¯æŒçš„è½¯ä»¶åŒ…å®‰è£…ç³»ç»Ÿ\n- å¤šç§Distro\n\t- Fedora\n\t- CentOS\n\t- RHEL\n- ä¼˜åŠ¿\n\t- ä¸å¯å˜æ“ä½œç³»ç»Ÿï¼Œé¢å‘å®¹å™¨ä¼˜åŒ–çš„åŸºç¡€è®¾æ–½\n\t\t- çµæ´»å’Œå®‰å…¨æ€§è¾ƒå¥½\n\t\t- åªæœ‰/etcå’Œ/varå¯ä»¥ä¿®æ”¹ï¼Œå…¶ä»–ç›®å½•å‡ä¸ºåªè¯»\n\t- åŸºäºrpm-ostreeç®¡ç†ç³»ç»ŸåŒ…\n\t\t- rpm-ostreeæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œä½¿å¾—ç”Ÿäº§ç³»ç»Ÿä¸­æ„å»ºé•œåƒéå¸¸ç®€å•\n\t\t- æ”¯æŒæ“ä½œç³»ç»Ÿå‡çº§å’Œå›æ»šçš„åŸå­æ“ä½œ\n\n## æœ€å°åŒ–ä¸»æœºæ“ä½œç³»ç»Ÿ\n\n- åŸåˆ™ï¼š\n- æœ€å°åŒ–ä¸»æœºæ“ä½œç³»ç»Ÿ\n- åªå®‰è£…å¿…è¦çš„å·¥å…·\n\t- å¿…è¦ï¼šæ”¯æŒç³»ç»Ÿè¿è¡Œçš„æœ€å°å·¥å…·é›†\n\t- ä»»ä½•è°ƒè¯•å·¥å…·ï¼Œæ¯”å¦‚æ€§èƒ½æ’æŸ¥ï¼Œç½‘ç»œæ’æŸ¥å·¥å…·ï¼Œå‡å¯ä»¥åæœŸä»¥å®¹å™¨å½¢å¼è¿è¡Œ\n- æ„ä¹‰\n\t- æ€§èƒ½\n\t- ç¨³å®šæ€§\n\t- å®‰å…¨ä¿éšœ\n\n## æ“ä½œç³»ç»Ÿæ„å»ºæµç¨‹\n\n![image.png](Extras/Images/image_1666271335385_0.png)\n\n## ostree\n\næä¾›ä¸€ä¸ªå…±äº«åº“ï¼ˆlibostreeï¼‰å’Œä¸€äº›åˆ—å‘½ä»¤è¡Œ\n\næä¾›ä¸gitå‘½ä»¤è¡Œä¸€è‡´çš„ä½“éªŒï¼Œå¯ä»¥æäº¤æˆ–è€…ä¸‹è½½ä¸€ä¸ªå®Œæ•´çš„å¯å¯åŠ¨çš„æ–‡ä»¶ç³»ç»Ÿæ ‘\n\næä¾›å°†ostreeéƒ¨ç½²è¿›bootloaderçš„æœºåˆ¶\n\n```bash\nhttps://github.com/ostreedev/ostree/blob/main/src/boot/dracut/module-setup.sh\ninstall() {\n\tdracut_install /usr/lib/ostree/ostree-prepare-root\n\tinst simple \"$systemdsystemunitdir}/ostree-prepare-root.service\"\n\tmkdir-p\"${initdir}${systemdsystemconfdir}/initrd-root-fs.target.wants\"\n\tln_r\"${systemdsystemunitdir}/ostree-prepare-root.service\"\\\n\t\t\"$systemdsystemconfdiry/initrd-root-fs.target.wants/ostree-prepare-root.service\"\n}\n```\n\n## æ„å»ºostree\n\n- rpm-ostree\n\t- åŸºäºtreefileå°†rpmåŒ…æ„å»ºæˆä¸ºostree ç®¡ç†ostreeä»¥åŠbootloaderé…ç½®\n- treefile\n\t- referï¼šåˆ†æ”¯åï¼ˆç‰ˆæœ¬ï¼Œcpuæ¶æ„ï¼‰\n\t- repo:ï¼šrpm package repositories\n\t- packagesï¼šå¾…å®‰è£…ç»„ä»¶\n- å°†rpmæ„å»ºæˆostree\n\t- rpm-ostree compose tree --unified-core --cachedir=cache--repo=./build-repo /path/to/treefile.json\n\n![image.png](Extras/Images/image_1666271634113_0.png)\n\n## åŠ è½½ostree\n\nåˆå§‹åŒ–é¡¹ç›®\n\nostree admin os-init centos-atomic-host\n\nå¯¼å…¥ostree repo\n\nostree remote add atomic http://ostree.svr/ostree\n\n![image.png](Extras/Images/image_1666271736326_0.png)\n\næ‹‰å–ostree\n\nostree pull atomic centos-atomic-host/8/x86_64/standard\n\néƒ¨ç½²os\n\nostree admin deploy--os=centos-atomic-host centos-atomic-host/8/x86_64/standard--karg='root=/dev/atomicos/root'\n\n## æ“ä½œç³»ç»ŸåŠ è½½\n\n- ç‰©ç†æœº\n\t- ç‰©ç†æœºé€šå¸¸éœ€è¦é€šè¿‡foremanå¯åŠ¨ï¼Œforemané€šè¿‡pxe bootï¼Œå¹¶åŠ è½½kickstart\n\t- kickstarté€šè¿‡ostree deployå³å¯å®Œæˆæ“ä½œç³»ç»Ÿçš„éƒ¨ç½²\n- è™šæ‹Ÿæœº\n\t- éœ€è¦é€šè¿‡é•œåƒå·¥å…·å°†ostreeæ„å»ºæˆqcow2æ ¼å¼ï¼Œvhdï¼Œrawç­‰æ¨¡å¼\n\n# èŠ‚ç‚¹èµ„æºç®¡ç†\n\n## NUMA Node\n\nNon-Uniform Memory Accessæ˜¯ä¸€ç§å†…å­˜è®¿é—®æ–¹å¼ï¼Œæ˜¯ä¸ºå¤šå¤„ç†å™¨è®¡ç®—æœºè®¾è®¡çš„å†…å­˜æ¶æ„\n\n![image.png](Extras/Images/image_1666276412414_0.png)\n\n## èŠ‚ç‚¹èµ„æºç®¡ç†\n\n- çŠ¶æ€æ±‡æŠ¥\n- èµ„æºé¢„ç•™\n- é˜²æ­¢èŠ‚ç‚¹èµ„æºè€—å°½çš„é˜²å¾¡æœºåˆ¶é©±é€\n- å®¹å™¨å’Œç³»ç»Ÿèµ„æºçš„é…ç½®\n\n## çŠ¶æ€ä¸ŠæŠ¥\n\nkubeletå‘¨æœŸæ€§åœ°å‘API Serverè¿›è¡Œæ±‡æŠ¥ï¼Œå¹¶æ›´æ–°èŠ‚ç‚¹çš„ç›¸å…³å¥åº·å’Œèµ„æºä½¿ç”¨ä¿¡æ¯\n\n- èŠ‚ç‚¹åŸºç¡€ä¿¡æ¯ï¼ŒåŒ…æ‹¬IPåœ°å€ã€æ“ä½œç³»ç»Ÿã€å†…æ ¸ã€è¿è¡Œæ—¶ã€kubeletã€kube-proxyç‰ˆæœ¬ä¿¡æ¯ã€‚\n- èŠ‚ç‚¹èµ„æºä¿¡æ¯åŒ…æ‹¬CPUã€å†…å­˜ã€HugePageã€ä¸´æ—¶å­˜å‚¨ã€GPUç­‰æ³¨å†Œè®¾å¤‡ï¼Œä»¥åŠè¿™äº›èµ„æºä¸­å¯ä»¥åˆ†é…ç»™å®¹å™¨ä½¿ç”¨çš„éƒ¨åˆ†ã€‚\n- è°ƒåº¦å™¨åœ¨ä¸ºPodé€‰æ‹©èŠ‚ç‚¹æ—¶ä¼šå°†æœºå™¨çš„çŠ¶æ€ä¿¡æ¯ä½œä¸ºä¾æ®ã€‚\n\n![image.png](Extras/Images/image_1666276786048_0.png)\n\n## Lease\n\nåœ¨æ—©æœŸç‰ˆæœ¬kubeletçš„çŠ¶æ€ä¸ŠæŠ¥ç›´æ¥æ›´æ–°nodeå¯¹è±¡ï¼Œè€Œä¸ŠæŠ¥çš„ä¿¡æ¯åŒ…å«çŠ¶æ€ä¿¡æ¯å’Œèµ„æºä¿¡æ¯ï¼Œå› æ­¤éœ€è¦ä¼ è¾“çš„æ•°æ®åŒ…è¾ƒå¤§ï¼Œç»™APIServerå’Œetcdé€ æˆçš„å‹åŠ›è¾ƒå¤§ã€‚\n\nåå¼•å…¥Leaseå¯¹è±¡ç”¨æ¥ä¿å­˜å¥åº·ä¿¡æ¯ï¼Œåœ¨é»˜è®¤40sçš„nodeleaseDurationSecondså‘¨æœŸå†…ï¼Œè‹¥Leaseå¯¹è±¡æ²¡æœ‰è¢«æ›´æ–°ï¼Œåˆ™å¯¹åº”èŠ‚ç‚¹å¯ä»¥è¢«åˆ¤å®šä¸ºä¸å¥åº·ã€‚\n\n```yaml\napiVersion: coordination.k8s.io/v1\nkind: Lease\nmetadata:\n  creationTimestamp: \"2021-08-19T02:50:09Z\"\n  name: k8snode\n  namespace: kube-node-lease\n  ownerReferences:\n  - apiVersion: V1\n    kind: Node\n    name: k8snode\n    uid: 58679942-e2dd-4ead-aada-385f099d5f56\n  resourceVersion: \"1293702\"\n  uid: 1bf51951-b832-49da-8708-4b224b1ec3ed\nspec:\n  holderldentity: k8snode\n  leaseDurationSeconds: 40\n  renewTime: \"2021-09-08T01:34:16.489589Z\"\n```\n\n## èµ„æºé¢„ç•™\n\nè®¡ç®—èŠ‚ç‚¹é™¤ç”¨æˆ·å®¹å™¨å¤–ï¼Œè¿˜å­˜åœ¨å¾ˆå¤šæ”¯æ’‘ç³»ç»Ÿè¿è¡Œçš„åŸºç¡€æœåŠ¡ï¼Œè­¬å¦‚systemdã€journaldã€sshdã€dockerdã€Containerdã€kubeletç­‰ã€‚\n\nä¸ºäº†ä½¿æœåŠ¡è¿›ç¨‹èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œè¦ç¡®ä¿å®ƒä»¬åœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥è·å–è¶³å¤Ÿçš„ç³»ç»Ÿèµ„æºï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¸ºè¿™äº›ç³»ç»Ÿè¿›ç¨‹é¢„ç•™èµ„æºã€‚\n\nkubeletå¯ä»¥é€šè¿‡ä¼—å¤šå¯åŠ¨å‚æ•°ä¸ºç³»ç»Ÿé¢„ç•™CPUã€å†…å­˜ã€PIDç­‰èµ„æºï¼Œæ¯”å¦‚SystemReservedã€KubeReservedç­‰ã€‚\n\n## Capacityå’ŒAllocatable\n\nå®¹é‡èµ„æºï¼ˆCapacityï¼‰æ˜¯æŒ‡kubeletè·å–çš„è®¡ç®—èŠ‚ç‚¹å½“å‰çš„èµ„æºä¿¡æ¯ã€‚\n\n- CPUæ˜¯ä»/proc/cpuinfoæ–‡ä»¶ä¸­è·å–çš„èŠ‚ç‚¹CPUæ ¸æ•°ï¼›\n- memoryæ˜¯ä»/proc/memoryinfoä¸­è·å–çš„èŠ‚ç‚¹å†…å­˜å¤§å°ï¼›\n- ephemeral-storageæ˜¯æŒ‡èŠ‚ç‚¹æ ¹åˆ†åŒºçš„å¤§å°ã€‚\n\nèµ„æºå¯åˆ†é…é¢ï¼ˆAllocatableï¼‰æ˜¯ç”¨æˆ·Podå¯ç”¨çš„èµ„æºï¼Œæ˜¯èµ„æºå®¹é‡å‡å»åˆ†é…ç»™ç³»ç»Ÿçš„èµ„æºçš„å‰©ä½™éƒ¨åˆ†ã€‚\n\n![image.png](Extras/Images/image_1666277432159_0.png)\n\n## èŠ‚ç‚¹ç£ç›˜ç®¡ç†\n\n- ç³»ç»Ÿåˆ†åŒº nodefs\n\t- å·¥ä½œç›®å½•å’Œå®¹å™¨æ—¥å¿—\n- å®¹å™¨è¿è¡Œæ—¶åˆ†åŒº imagefs\n\t- ç”¨æˆ·é•œåƒå’Œå®¹å™¨å¯å†™å±‚\n\t- å®¹å™¨è¿è¡Œæ—¶åˆ†åŒºæ˜¯å¯é€‰çš„ï¼Œå¯ä»¥åˆå¹¶åˆ°ç³»ç»Ÿåˆ†åŒºä¸­\n\n## é©±é€ç®¡ç†\n\n- kubeletä¼šåœ¨ç³»ç»Ÿèµ„æºä¸å¤Ÿæ—¶ä¸­æ­¢ä¸€äº›å®¹å™¨è¿›ç¨‹ï¼Œä»¥ç©ºå‡ºç³»ç»Ÿèµ„æºï¼Œä¿è¯èŠ‚ç‚¹çš„ç¨³å®šæ€§ã€‚\n- ä½†ç”±kubeletå‘èµ·çš„é©±é€åªåœæ­¢Podçš„æ‰€æœ‰å®¹å™¨è¿›ç¨‹ï¼Œå¹¶ä¸ä¼šç›´æ¥åˆ é™¤Podã€‚\n\t- Podçš„status.phaseä¼šè¢«æ ‡è®°ä¸ºFailed\n\t- status.reasonä¼šè¢«è®¾ç½®ä¸ºEvicted\n\t- status.messageåˆ™ä¼šè®°å½•è¢«é©±é€çš„åŸå› \n\n## èµ„æºå¯ç”¨é¢ç›‘æ§\n\nkubeletä¾èµ–å†…åµŒçš„å¼€æºè½¯ä»¶cAdvisorï¼Œå‘¨æœŸæ€§æ£€æŸ¥èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µ\n\nCPUæ˜¯å¯å‹ç¼©èµ„æºï¼Œæ ¹æ®ä¸åŒè¿›ç¨‹åˆ†é…æ—¶é—´é…é¢å’Œæƒé‡ï¼ŒCPUå¯è¢«å¤šä¸ªè¿›ç¨‹ç«ç›¸ä½¿ç”¨\n\né©±é€ç­–ç•¥æ˜¯åŸºäºç£ç›˜å’Œå†…å­˜èµ„æºç”¨é‡è¿›è¡Œçš„ï¼Œå› ä¸ºä¸¤è€…å±äºä¸å¯å‹ç¼©çš„èµ„æºï¼Œå½“æ­¤ç±»èµ„æºä½¿ç”¨è€—å°½æ—¶å°†æ— æ³•å†ç”³è¯·\n\n![image.png](Extras/Images/image_1666277809205_0.png)\n\n## é©±é€ç­–ç•¥\n\nkubeletè·å¾—èŠ‚ç‚¹çš„å¯ç”¨é¢ä¿¡æ¯åï¼Œä¼šç»“åˆèŠ‚ç‚¹çš„å®¹é‡ä¿¡æ¯æ¥åˆ¤æ–­å½“å‰èŠ‚ç‚¹è¿è¡Œçš„Podæ˜¯å¦æ»¡è¶³é©±é€æ¡ä»¶ã€‚\n\né©±é€æ¡ä»¶å¯ä»¥æ˜¯ç»å¯¹å€¼æˆ–ç™¾åˆ†æ¯”ï¼Œå½“ç›‘æ§èµ„æºçš„å¯ä½¿ç”¨é¢å°‘å¹²è®¾å®šçš„æ•°å€¼æˆ–ç™¾åˆ†æ¯”æ—¶ï¼Œkubeletå°±ä¼šå‘èµ·é©±é€æ“ä½œã€‚\n\nkubeletå‚æ•°evictionMinimumReclaimå¯ä»¥è®¾ç½®æ¯æ¬¡å›æ”¶çš„èµ„æºçš„æœ€å°å€¼ï¼Œä»¥é˜²æ­¢å°èµ„æºçš„å¤šæ¬¡å›æ”¶ã€‚\n\n![image.png](Extras/Images/image_1666278219341_0.png)\n\n## åŸºäºå†…å­˜å‹åŠ›çš„é©±é€\n\nmemory.avaiableè¡¨ç¤ºå½“å‰ç³»ç»Ÿçš„å¯ç”¨å†…å­˜æƒ…å†µã€‚\n\nkubeleté»˜è®¤è®¾ç½®äº†memory.avaiable\u003c100Miçš„ç¡¬é©±é€æ¡ä»¶\nå½“kubeletæ£€æµ‹åˆ°å½“å‰èŠ‚ç‚¹å¯ç”¨å†…å­˜èµ„æºç´§å¼ å¹¶æ»¡è¶³é©±é€æ¡ä»¶æ—¶ï¼Œä¼šå°†èŠ‚ç‚¹çš„MemoryPressureçŠ¶\næ€è®¾ç½®ä¸ºTrueï¼Œè°ƒåº¦å™¨ä¼šé˜»æ­¢BestEffort Podè°ƒåº¦åˆ°å†…å­˜æ‰¿å‹çš„èŠ‚ç‚¹ã€‚\n\nkubeletå¯åŠ¨å¯¹å†…å­˜ä¸è¶³çš„é©±é€æ“ä½œæ—¶ï¼Œä¼šä¾ç…§å¦‚ä¸‹çš„é¡ºåºé€‰å–ç›®æ ‡Podï¼š\n\nï¼ˆ1ï¼‰åˆ¤æ–­Podæ‰€æœ‰å®¹å™¨çš„å†…å­˜ä½¿ç”¨é‡æ€»å’Œæ˜¯å¦è¶…å‡ºäº†è¯·æ±‚çš„å†…å­˜é‡ï¼Œè¶…å‡ºè¯·æ±‚èµ„æºçš„Podä¼šæˆä¸º\nå¤‡é€‰ç›®æ ‡ã€‚\n\nï¼ˆ2ï¼‰æŸ¥è¯¢Podçš„è°ƒåº¦ä¼˜å…ˆçº§ï¼Œä½ä¼˜å…ˆçº§çš„Podè¢«ä¼˜å…ˆé©±é€ã€‚\n\nï¼ˆ3ï¼‰è®¡ç®—Podæ‰€æœ‰å®¹å™¨çš„å†…å­˜ä½¿ç”¨é‡å’ŒPodè¯·æ±‚çš„å†…å­˜é‡çš„å·®å€¼ï¼Œå·®å€¼è¶Šå°ï¼Œè¶Šä¸å®¹æ˜“è¢«é©±é€ã€‚\n\n## åŸºäºç£ç›˜å‹åŠ›çš„é©±é€\n\n* ä»¥ä¸‹ä»»ä½•ä¸€é¡¹æ»¡è¶³é©±é€æ¡ä»¶æ—¶ï¼Œå®ƒä¼šå°†èŠ‚ç‚¹çš„DiskPressureçŠ¶æ€è®¾ç½®ä¸ºTrueï¼Œè°ƒåº¦å™¨ä¸ä¼šå†è°ƒåº¦ä»»ä½•Podåˆ°è¯¥èŠ‚ç‚¹ä¸Š\n\t* nodefs.available\n\t* nodefs.inodesFree\n\t* imagefs.available\n\t* imagefs.inodesFree\n* é©±é€è¡Œä¸º\n\t* æœ‰å®¹å™¨è¿è¡Œæ—¶åˆ†åŒº\n\t\t* nodefsè¾¾åˆ°é©±é€é˜ˆå€¼ï¼Œé‚£ä¹ˆkubeletåˆ é™¤å·²ç»é€€å‡ºçš„å®¹å™¨\n\t\t* Imagefsè¾¾åˆ°é©±é€é˜ˆå€¼ï¼Œé‚£ä¹ˆkubeletåˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒã€‚\n* æ— å®¹å™¨è¿è¡Œæ—¶åˆ†åŒº\n\t* kubeletåŒæ—¶åˆ é™¤æœªè¿è¡Œçš„å®¹å™¨å’Œæœªä½¿ç”¨çš„é•œåƒã€‚\n\n---\n\n* å›æ”¶å·²ç»é€€å‡ºçš„å®¹å™¨å’Œæœªä½¿ç”¨çš„é•œåƒåï¼Œå¦‚æœèŠ‚ç‚¹ä¾ç„¶æ»¡è¶³é©±é€æ¡ä»¶ï¼Œkubeletå°±ä¼šå¼€å§‹é©±é€æ­£åœ¨è¿è¡Œçš„Podï¼Œè¿›ä¸€æ­¥é‡Šæ”¾ç£ç›˜ç©ºé—´ã€‚\n* åˆ¤æ–­Podçš„ç£ç›˜ä½¿ç”¨é‡æ˜¯å¦è¶…è¿‡è¯·æ±‚çš„å¤§å°ï¼Œè¶…å‡ºè¯·æ±‚èµ„æºçš„Podä¼šæˆä¸ºå¤‡é€‰ç›®æ ‡ã€‚\n* æŸ¥è¯¢Podçš„è°ƒåº¦ä¼˜å…ˆçº§ï¼Œä½ä¼˜å…ˆçº§çš„Podä¼˜å…ˆé©±é€ã€‚\n* æ ¹æ®ç£ç›˜ä½¿ç”¨è¶…è¿‡è¯·æ±‚çš„æ•°é‡è¿›è¡Œæ’åºï¼Œå·®å€¼è¶Šå°ï¼Œè¶Šä¸å®¹æ˜“è¢«é©±é€ã€‚\n\n## å®¹å™¨å’Œèµ„æºé…ç½®\n\né’ˆå¯¹ä¸åŒQoS Classçš„Podï¼ŒKubneretesæŒ‰å¦‚ä¸‹Hierarchyç»„ç»‡cgroupä¸­çš„CPUå­ç³»ç»Ÿ\n\n![image.png](Extras/Images/image_1666279135958_0.png)\n\n## CPU CGroupé…ç½®\n\n![image.png](Extras/Images/image_1666279354888_0.png)\n\n## å†…å­˜CGroupé…ç½®\n\n![image.png](Extras/Images/image_1666279387571_0.png)\n\n## OOM Killerè¡Œä¸º\n\nç³»ç»Ÿçš„OOMKillerå¯èƒ½ä¼šé‡‡å–OOMçš„æ–¹å¼æ¥ä¸­æ­¢æŸäº›å®¹å™¨çš„è¿›ç¨‹ï¼Œè¿›è¡Œå¿…è¦çš„å†…å­˜å›æ”¶æ“ä½œè€Œç³»ç»Ÿæ ¹æ®è¿›ç¨‹çš„oom scoreæ¥è¿›è¡Œä¼˜å…ˆçº§æ’åºï¼Œï¼Œé€‰æ‹©å¾…ç»ˆæ­¢çš„è¿›ç¨‹ï¼Œä¸”è¿›ç¨‹çš„oom scoreï¼Œè¶Šé«˜ï¼Œè¶Šå®¹æ˜“è¢«ç»ˆæ­¢ã€‚\n\nè¿›ç¨‹çš„oom scoreæ˜¯æ ¹æ®å½“å‰è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜å èŠ‚ç‚¹æ€»å†…å­˜çš„æ¯”ä¾‹å€¼ä¹˜ä»¥10ï¼Œå†åŠ ä¸Šoom_SCore_adjç»¼åˆå¾—åˆ°çš„\n\nè€Œå®¹å™¨è¿›ç¨‹çš„oom score adjæ­£æ˜¯kubeletæ ¹æ®memory.requestè¿›è¡Œè®¾ç½®çš„\n\n![image.png](Extras/Images/image_1666279569545_0.png)\n-\n\n## æ—¥å¿—ç®¡ç†\n\nèŠ‚ç‚¹ä¸Šéœ€è¦é€šè¿‡è¿è¡Œlogrotateçš„å®šæ—¶ä»»åŠ¡å¯¹ç³»ç»ŸæœåŠ¡æ—¥å¿—è¿›è¡Œrotateæ¸…ç†ï¼Œä»¥é˜²æ­¢ç³»ç»ŸæœåŠ¡æ—¥å¿—å ç”¨å¤§é‡çš„ç£ç›˜ç©ºé—´ã€‚\n\n* logrotateçš„æ‰§è¡Œå‘¨æœŸä¸èƒ½è¿‡é•¿ï¼Œä»¥é˜²æ—¥å¿—çŸ­æ—¶é—´å†…å¤§é‡å¢é•¿ã€‚\n* åŒæ—¶é…ç½®æ—¥å¿—çš„rotateæ¡ä»¶ï¼Œåœ¨æ—¥å¿—ä¸å ç”¨å¤ªå¤šç©ºé—´çš„æƒ…å†µä¸‹ï¼Œä¿è¯æœ‰è¶³å¤Ÿçš„æ—¥å¿—å¯ä¾›æŸ¥çœ‹ã€‚\n* Docker\n\t* é™¤äº†åŸºäºç³»ç»Ÿlogrotateç®¡ç†æ—¥å¿—ï¼Œè¿˜å¯ä»¥ä¾èµ–Dockerè‡ªå¸¦çš„æ—¥å¿—ç®¡ç†åŠŸèƒ½æ¥è®¾ç½®å®¹å™¨æ—¥å¿—çš„æ•°é‡å’Œæ¯ä¸ªæ—¥å¿—æ–‡ä»¶çš„å¤§å°ã€‚\n\t* Dockerå†™å…¥æ•°æ®ä¹‹å‰ä¼šå¯¹æ—¥å¿—å¤§å°è¿›è¡Œæ£€æŸ¥å’Œrotateæ“ä½œï¼Œç¡®ä¿æ—¥å¿—æ–‡ä»¶ä¸ä¼šè¶…è¿‡é…ç½®çš„æ•°é‡å’Œå¤§å°ã€‚\n* Containerd\n\t* æ—¥å¿—çš„ç®¡ç†æ˜¯é€šè¿‡kubeletå®šæœŸï¼ˆé»˜è®¤ä¸º10sï¼‰æ‰§è¡Œduå‘½ä»¤ï¼Œæ¥æ£€æŸ¥å®¹å™¨æ—¥å¿—çš„æ•°é‡å’Œæ–‡ä»¶çš„å¤§å°çš„ã€‚\n\t* æ¯ä¸ªå®¹å™¨æ—¥å¿—çš„å¤§å°å’Œå¯ä»¥ä¿ç•™çš„æ–‡ä»¶ä¸ªæ•°ï¼Œå¯ä»¥é€šè¿‡kubeletçš„é…ç½®å‚æ•°container-log-max\u0002size å’Œcontainer-log-max-filesè¿›è¡Œè°ƒæ•´ã€‚\n\n## Dockerå·ç®¡ç†\n\nåœ¨æ„å»ºå®¹å™¨é•œåƒæ—¶ï¼Œå¯ä»¥åœ¨Dockerfileä¸­é€šè¿‡VOLUMEæŒ‡ä»¤å£°æ˜ä¸€ä¸ªå­˜å‚¨å·ï¼Œç›®å‰Kuberneteså°šæœªå°†å…¶çº³å…¥ç®¡æ§èŒƒå›´ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚\n\nå¦‚æœå®¹å™¨è¿›ç¨‹åœ¨å¯å†™å±‚æˆ–emptyDirå·è¿›è¡Œå¤§é‡è¯»å†™æ“ä½œï¼Œå°±ä¼šå¯¼è‡´ç£ç›˜I/Oè¿‡é«˜ï¼Œä»è€Œå½±å“å…¶ä»–å®¹å™¨è¿›ç¨‹ç”šè‡³ç³»ç»Ÿè¿›ç¨‹ã€‚\n\nDockerå’ŒContainerdè¿è¡Œæ—¶éƒ½åŸºäºCGroup v1ã€‚å¯¹äºå—è®¾å¤‡ï¼Œåªæ”¯æŒå¯¹DirectI/Oé™é€Ÿï¼Œè€Œå¯¹äºBuffer I/Oè¿˜ä¸å…·å¤‡æœ‰æ•ˆçš„æ”¯æŒã€‚å› æ­¤ï¼Œé’ˆå¯¹è®¾å¤‡é™é€Ÿçš„é—®é¢˜ï¼Œç›®å‰è¿˜æ²¡æœ‰å®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œå¯¹äºæœ‰ç‰¹æ®ŠI/Oéœ€æ±‚çš„å®¹å™¨ï¼Œå»ºè®®ä½¿ç”¨ç‹¬ç«‹çš„ç£ç›˜ç©ºé—´ã€‚\n\n## ç½‘ç»œèµ„æº\n\nç”±ç½‘ç»œæ’ä»¶é€šè¿‡Linux Traffic Controlä¸ºPodé™åˆ¶å¸¦å®½\n\nå¯åˆ©ç”¨CNIç¤¾åŒºæä¾›çš„bandwidthæ’ä»¶\n\n```yaml\napiversion: v1\nkind: Pod\nmetadata:\n\tannotations:\n\t\tkubernetes.io/ingress-bandwidth: 10MB\n    \tkubernetes.io/egress-bandwidth: 10MB\nÂ·Â·\n```\n\n## è¿›ç¨‹æ•°\n\nkubeleté»˜è®¤ä¸é™åˆ¶Podå¯ä»¥åˆ›å»ºçš„å­è¿›ç¨‹æ•°é‡ï¼Œä½†å¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°podPidsLimitå¼€å¯é™åˆ¶ï¼Œè¿˜å¯ä»¥ç”±reservedå‚æ•°ä¸ºç³»ç»Ÿè¿›ç¨‹é¢„ç•™è¿›ç¨‹æ•°ã€‚\n\n- kubeleté€šè¿‡ç³»ç»Ÿè°ƒç”¨å‘¨æœŸæ€§åœ°è·å–å½“å‰ç³»ç»Ÿçš„PIDçš„ä½¿ç”¨é‡ï¼Œå¹¶è¯»å–/proc/sys/kernel/pid_maxï¼Œè·å–ç³»ç»Ÿæ”¯æŒçš„PIDä¸Šé™ã€‚\n- å¦‚æœå½“å‰çš„å¯ç”¨è¿›ç¨‹æ•°å°‘äºè®¾å®šé˜ˆå€¼ï¼Œé‚£ä¹ˆkubeletä¼šå°†èŠ‚ç‚¹å¯¹è±¡çš„PIDPressureæ ‡è®°ä¸ºTrue\n- kube-scheduleråœ¨è¿›è¡Œè°ƒåº¦æ—¶ï¼Œä¼šä»å¤‡é€‰èŠ‚ç‚¹ä¸­å¯¹å¤„äºNodeUnderPIDPressureçŠ¶æ€çš„èŠ‚ç‚¹è¿›è¡Œè¿‡æ»¤ã€‚\n\n# èŠ‚ç‚¹å¼‚å¸¸æ£€æµ‹\n\n## Kubernetesé›†ç¾¤å¯èƒ½å­˜åœ¨çš„é—®é¢˜\n\n- åŸºç¡€æ¶æ„å®ˆæŠ¤ç¨‹åºé—®é¢˜ï¼šNTPæœåŠ¡å…³é—­ï¼›\n- ç¡¬ä»¶é—®é¢˜ï¼šCPUï¼Œå†…å­˜æˆ–ç£ç›˜æŸåï¼›\n- å†…æ ¸é—®é¢˜ï¼šå†…æ ¸æ­»é”ï¼Œæ–‡ä»¶ç³»ç»ŸæŸåï¼›\n- å®¹å™¨è¿è¡Œæ—¶é—®é¢˜ï¼šè¿è¡Œæ—¶å®ˆæŠ¤ç¨‹åºæ— å“åº”\n- ...\n\nå½“kubernetesä¸­èŠ‚ç‚¹å‘ç”Ÿä¸Šè¿°é—®é¢˜ï¼Œåœ¨æ•´ä¸ªé›†ç¾¤ä¸­ï¼Œk8sæœåŠ¡ç»„ä»¶å¹¶ä¸ä¼šæ„ŸçŸ¥ä»¥ä¸Šé—®é¢˜ï¼Œå°±ä¼šå¯¼è‡´podä»ä¼šè°ƒåº¦è‡³é—®é¢˜èŠ‚ç‚¹ã€‚\n\n## node-problem-detector\n\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç¤¾åŒºå¼•å…¥äº†å®ˆæŠ¤è¿›ç¨‹node-problem-detectorï¼Œä»å„ä¸ªå®ˆæŠ¤è¿›ç¨‹æ”¶é›†èŠ‚ç‚¹é—®é¢˜ï¼Œå¹¶ä½¿å®ƒä»¬å¯¹ä¸Šæ¸¸å±‚å¯è§ã€‚\n\nKubernetesèŠ‚ç‚¹è¯Šæ–­çš„å·¥å…·ï¼Œå¯ä»¥å°†èŠ‚ç‚¹çš„å¼‚å¸¸ï¼Œä¾‹å¦‚\n\n- Runtimeæ— å“åº”\n- Linux Kernelæ— å“åº”\n- ç½‘ç»œå¼‚å¸¸\n- æ–‡ä»¶æè¿°ç¬¦å¼‚å¸¸\n- ç¡¬ä»¶é—®é¢˜å¦‚CPUï¼Œå†…å­˜æˆ–è€…ç£ç›˜æ•…éšœ\n\n## æ•…éšœåˆ†ç±»\n\n![image.png](Extras/Images/image_1666282939883_0.png)\n\n## é—®é¢˜æ±‡æŠ¥æ‰‹æ®µ\n\nnode-problem-detectoré€šè¿‡è®¾ç½®NodeConditionæˆ–è€…åˆ›å»ºEventå¯¹è±¡æ¥æ±‡æŠ¥é—®é¢˜\n\nNodeConditionï¼šé’ˆå¯¹æ°¸ä¹…æ€§æ•…éšœï¼Œä¼šé€šè¿‡è®¾ç½®NodeConditionæ¥æ”¹å˜èŠ‚ç‚¹çŠ¶æ€\n\nEventï¼šä¸´æ—¶æ•…éšœé€šè¿‡Eventæ¥æé†’ç›¸å…³å¯¹è±¡ï¼Œæ¯”å¦‚é€šçŸ¥å½“å‰èŠ‚ç‚¹è¿è¡Œçš„æ‰€æœ‰Pod\n\n## ä½¿ç”¨æ’ä»¶ pod å¯ç”¨NPD\n\nå¦‚æœä½ ä½¿ç”¨çš„æ˜¯è‡ªå®šä¹‰é›†ç¾¤å¼•å¯¼è§£å†³æ–¹æ¡ˆï¼Œä¸éœ€è¦è¦†ç›–é»˜è®¤é…ç½®ï¼Œå¯ä»¥åˆ©ç”¨æ’ä»¶ Podè¿›ä¸€æ­¥è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚\n\nåˆ›å»º node-strick-detector.yamlï¼Œå¹¶åœ¨æ§åˆ¶å¹³é¢èŠ‚ç‚¹ä¸Šä¿å­˜é…ç½®åˆ°æ’ä»¶ Pod çš„ç›®å½•/etc/kubernetes/addons/node-problem-detectorã€‚\n\n## NPDçš„å¼‚å¸¸å¤„ç†è¡Œä¸º\n\nNPDåªè´Ÿè´£è·å–å¼‚å¸¸äº‹ä»¶ï¼Œå¹¶ä¿®æ”¹node conditionï¼Œä¸ä¼šå¯¹èŠ‚ç‚¹çŠ¶æ€å’Œè°ƒåº¦äº§ç”Ÿå½±å“\n\n```yaml\nlastHeartbeatTime: \"2021-11-06T15:44:46Z\"\nlastTransitionTime: \"2021-11-06T15:29:43Z\"\nmessage:'kernel: INFO:task docker:20744 blocked for more than 120 seconds.'\nreason: DockerHung\nstatus: \"True\"\ntype: KernelDeadlock\n```\n\néœ€è¦è‡ªå®šä¹‰æ§åˆ¶å™¨ï¼Œç›‘å¬NPDæ±‡æŠ¥çš„conditionï¼Œtaint nodeï¼Œé˜»æ­¢podè°ƒåº¦åˆ°æ•…éšœèŠ‚ç‚¹\n\né—®é¢˜ä¿®å¤åï¼Œé‡å¯NPD Podæ¥æ¸…ç†é”™è¯¯äº‹ä»¶\n\n# å¸¸ç”¨èŠ‚ç‚¹é—®é¢˜æ’æŸ¥æ‰‹æ®µ\n\n## sshåˆ°å†…ç½‘èŠ‚ç‚¹\n\nåˆ›å»ºä¸€ä¸ªæ”¯æŒsshçš„pod\n\nå¹¶é€šè¿‡è´Ÿè½½å‡è¡¡å™¨è½¬å‘sshè¯·æ±‚\n\n## æŸ¥çœ‹æ—¥å¿—\n\n- é’ˆå¯¹ä½¿ç”¨systemdæ‹‰èµ·çš„æœåŠ¡\n\t- `journalctl-afu kubelet-S \"2019-08-26 15:00:00\"`\n\t\t- -u unitï¼Œå¯¹åº”çš„systemdæ‹‰èµ·çš„ç»„ä»¶ï¼Œå¦‚kubelet\n\t\t- -f folloWï¼Œè·Ÿè¸ªæœ€æ–°æ—¥å¿—\n\t\t- -a show allï¼Œç°å®æ‰€æœ‰æ—¥å¿—åˆ—\n\t\t- -S sinceï¼Œä»æŸä¸€æ—¶é—´å¼€å§‹-S \"2019-08-26 15âˆ¶00âˆ¶00\"\n- å¯¹äºæ ‡å‡†çš„å®¹å™¨æ—¥å¿—\n\t- `kubectl logs -f -c \u003ccontainername\u003e \u003cpodname\u003e`\n\t- `kubectl logs -f --all -containers \u003cpodname\u003e`\n\t- `kubectl logs -f -c \u003cpodname\u003e -- previous`\n- å¦‚æœå®¹å™¨æ—¥å¿—è¢«shellè½¬å‚¨åˆ°æ–‡ä»¶ï¼Œåˆ™éœ€é€šè¿‡exec\n\t- `kubectl exec -it xxx --tail -f /path/to/log`\n\n# åŸºäºextended resourceæ‰©å±•èŠ‚ç‚¹èµ„æº\n\n## æ‰©å±•èµ„æº\n\næ‰©å±•èµ„æºæ˜¯ kubernetes.io åŸŸåä¹‹å¤–çš„æ ‡å‡†èµ„æºåç§°ã€‚ å®ƒä»¬ä½¿å¾—é›†ç¾¤ç®¡ç†å‘˜èƒ½å¤Ÿé¢å¸ƒéKubernetes å†…ç½®èµ„æºï¼Œè€Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ä»–ä»¬ã€‚\n\nè‡ªå®šä¹‰æ‰©å±•èµ„æºæ— æ³•ä½¿ç”¨kubernetes.ioä½œä¸ºèµ„æºåŸŸå\n\n## ç®¡ç†æ‰©å±•èµ„æº\n\n- èŠ‚ç‚¹çº§æ‰©å±•èµ„æº\n\t- èŠ‚ç‚¹çº§æ‰©å±•èµ„æºç»‘å®šåˆ°èŠ‚ç‚¹\n- è®¾å¤‡æ’ä»¶ç®¡ç†çš„èµ„æº\n\t- å‘å¸ƒåœ¨å„èŠ‚ç‚¹ä¸Šç”±è®¾å¤‡æ’ä»¶æ‰€ç®¡ç†çš„èµ„æºï¼Œå¦‚GPUï¼Œæ™ºèƒ½ç½‘å¡ç­‰\n\n## ä¸ºèŠ‚ç‚¹é…ç½®èµ„æº\n\né›†ç¾¤æ“ä½œå‘˜å¯ä»¥å‘ APIæœåŠ¡å™¨æäº¤ PATCH HTTPè¯·æ±‚ï¼Œä»¥åœ¨é›†ç¾¤ä¸­èŠ‚ç‚¹çš„ status.capacity ä¸­ä¸ºå…¶é…ç½®å¯ç”¨æ•°é‡ã€‚\n\nå®Œæˆæ­¤æ“ä½œåï¼ŒèŠ‚ç‚¹çš„ status.capacity å­—æ®µä¸­å°†åŒ…å«æ–°èµ„æºã€‚\n\nkubeletä¼šå¼‚æ­¥åœ°å¯¹ status.allocatableå­—æ®µæ‰§è¡Œè‡ªåŠ¨æ›´æ–°æ“ä½œï¼Œä½¿ä¹‹åŒ…å«æ–°èµ„æºã€‚\n\nè°ƒåº¦å™¨åœ¨è¯„ä¼° Pod æ˜¯å¦é€‚åˆåœ¨æŸèŠ‚ç‚¹ä¸Šæ‰§è¡Œæ—¶ä¼šä½¿ç”¨èŠ‚ç‚¹çš„ status.allocatable å€¼ï¼Œåœ¨æ›´æ–°èŠ‚ç‚¹å®¹é‡ä½¿ä¹‹åŒ…å«æ–°èµ„æºä¹‹åå’Œè¯·æ±‚è¯¥èµ„æºçš„ç¬¬ä¸€ä¸ª Pod è¢«è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ä¹‹é—´ï¼Œå¯èƒ½ä¼šæœ‰çŸ­æš‚çš„å»¶è¿Ÿã€‚\n\n```bash\ncurl --key admin.key --cert admin.crt --header \"Content-Type: application/json\u0002patch+ison\"\\\n--request PATCH-k\\\n--data '[{\"op\":\"add\",\"path\":\"/status/capacity/cncamp.com~1reclaimed-cpu\", \"Value\":\"2\"}]'\nhttps://192.168.34.2:6443/api/v1/nodes/cadmin/status\n```\n\n## ä½¿ç”¨æ‰©å±•èµ„æº\n\n```yaml\nspec:\n  containers:\n    - name: nginx\n      image: nginx\n      resources:\n        limits:\n          cncamp.com/reclaimed-cpu: 3\n        requests:\n          cncamp.com/reclaimed-cpu: 3\n```\n\n## é›†ç¾¤å±‚é¢çš„æ‰©å±•èµ„æº\n\n- å¯é€‰æ‹©ç”±é»˜è®¤è°ƒåº¦å™¨ç®¡ç†èµ„æºï¼Œé»˜è®¤è°ƒåº¦å™¨åƒç®¡ç†å…¶ä»–èµ„æºä¸€æ ·ç®¡ç†æ‰©å±•èµ„æº\n\t- Requestä¸Limitå¿…é¡»ä¸€è‡´ï¼Œå› ä¸ºKubernetesæ— æ³•ç¡®ä¿æ‰©å±•èµ„æºçš„è¶…å”®\n- æ›´å¸¸è§çš„åœºæ™¯æ˜¯ï¼Œç”±è°ƒåº¦å™¨æ‰©å±•ç¨‹åºï¼ˆScheduler Extendersï¼‰ç®¡ç†ï¼Œè¿™äº›ç¨‹åºå¤„ç†èµ„æºæ¶ˆè€—å’Œèµ„æºé…é¢\n\t- ä¿®æ”¹è°ƒåº¦å™¨ç­–ç•¥é…ç½®ignoredBySchedulerå­—æ®µå¯é…ç½®è°ƒåº¦å™¨ä¸è¦æ£€æŸ¥è‡ªå®šä¹‰èµ„æº\n\n```json\n{\n    \"kind\": \"Policy\",\n    \"apiVersion\": \"v1\",\n    \"extenders\": [\n        {\n            \"urlPrefix\": \"\u003cextender-endpoint\u003e\",\n            \"bindVerb\": \"bind\",\n            \"managedResources\": [\n                {\n                    \"name\": \"example.com/foo\",\n                    \"ignoredByScheduler\": true\n                }\n            ]\n        }\n    ]\n}\n```\n\n# æ„å»ºå’Œç®¡ç†é«˜å¯ç”¨é›†ç¾¤\n\n## Kubernetesé«˜å¯ç”¨å±‚çº§\n\n![image.png](Extras/Images/image_1667027450698_0.png)\n-\n\n## é«˜å¯ç”¨çš„æ•°æ®ä¸­å¿ƒ\n\n- å¤šåœ°éƒ¨ç½²\n- æ¯ä¸ªæ•°æ®ä¸­å¿ƒéœ€è¦åˆ’åˆ†æˆå…·æœ‰ç‹¬ç«‹ä¾›ç”µã€åˆ¶å†·ã€ç½‘ç»œè®¾å¤‡çš„é«˜å¯ç”¨åŒº\n- æ¯ä¸ªé«˜å¯ç”¨åŒºç®¡ç†ç‹¬ç«‹çš„ç¡¬ä»¶èµ„äº§ï¼ŒåŒ…æ‹¬æœºæ¶ã€è®¡ç®—èŠ‚ç‚¹ã€å­˜å‚¨ã€è´Ÿè½½å‡è¡¡å™¨ã€é˜²ç«å¢™ç­‰ç¡¬ä»¶è®¾å¤‡\n\n## Nodeçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†\n\nè¿è¥Kubernetesé›†ç¾¤ï¼Œä¸ä»…ä»…æ˜¯é›†ç¾¤æ­å»ºé‚£ä¹ˆç®€å•ï¼Œè¿è¥éœ€è¦å¯¹é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„å®Œæ•´ç”³æ˜å‘¨æœŸè´Ÿè´£ã€‚\n\n- é›†ç¾¤æ­å»º\n- é›†ç¾¤æ‰©å®¹/ç¼©å®¹\n- é›†ç¾¤é”€æ¯ï¼ˆå¾ˆå°‘ï¼‰\n- æ— è®ºæ˜¯é›†ç¾¤æ­å»ºè¿˜æ˜¯æ‰©å®¹ï¼Œæ ¸å¿ƒæ˜¯Nodeçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†\n\t- Onboard\n\t\t- ç‰©ç†èµ„äº§ä¸Šæ¶\n\t\t- æ“ä½œç³»ç»Ÿå®‰è£…\n\t\t- ç½‘ç»œé…ç½®\n\t\t- Kubernetesç»„ä»¶å®‰è£…\n\t\t- åˆ›å»ºNode å¯¹è±¡\n\t- æ•…éšœå¤„ç†\n\t\t- ä¸´æ—¶æ•…éšœ?é‡å¯å¤§æ³•å¥½\n\t\t- æ°¸ä¹…æ•…éšœ?æœºå™¨ä¸‹æ¶\n\t- Offboard\n\t\t- åˆ é™¤Nodeå¯¹è±¡\n\t\t- ç‰©ç†èµ„äº§ä¸‹æ¶ï¼Œé€ä¿®/æŠ¥åºŸ\n\n## ä¸»æœºç®¡ç†\n\né€‰å®šå“ªä¸ªç‰ˆæœ¬çš„ç³»ç»Ÿå†…æ ¸ã€å“ªä¸ªå‘è¡Œç‰ˆã€å®‰è£…å“ªäº›å·¥å…·é›†ã€ä¸»æœºç½‘ç»œå¦‚ä½•è§„åˆ’ç­‰ã€‚\n\næ—¥å¸¸çš„ä¸»æœºé•œåƒå‡çº§æ›´æ–°ä¹Ÿå¯èƒ½æ˜¯é€ æˆæœåŠ¡ä¸å¯ç”¨çš„å› ç´ ä¹‹ä¸€ã€‚\n\nä¸»æœºé•œåƒæ›´æ–°å¯ä»¥é€šè¿‡A/Bç³»ç»ŸOTAï¼ˆOver The Airï¼‰å‡çº§æ–¹å¼è¿›è¡Œã€‚\n\nåˆ†åˆ«ä½¿ç”¨Aã€Bä¸¤ä¸ªå­˜å‚¨ç©ºé—´ï¼Œå…±äº«ä¸€ä»½ç”¨æˆ·æ•°æ®ã€‚åœ¨å‡çº§è¿‡ç¨‹ä¸­ï¼ŒOTAæ›´æ–°å³å¾€å…¶ä¸­ä¸€ä¸ªå­˜å‚¨ç©ºé—´å†™å…¥å‡çº§åŒ…ï¼ŒåŒæ—¶ä¿è¯äº†å¦ä¸€ä¸ªç³»ç»Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œè€Œä¸ä¼šæ‰“æ–­ç”¨æˆ·ã€‚å¦‚æœOTAå¤±è´¥ï¼Œé‚£ä¹ˆè®¾å¤‡ä¼šå¯åŠ¨åˆ°OTAä¹‹å‰çš„ç£ç›˜åˆ†åŒºï¼Œå¹¶ä¸”ä»ç„¶å¯ä»¥ä½¿ç”¨ã€‚\n\n## ç”Ÿäº§åŒ–é›†ç¾¤ç®¡ç†\n\n- å¦‚ä½•è®¾å®šå•ä¸ªé›†ç¾¤è§„æ¨¡\n\t- ç¤¾åŒºå£°æ˜å•ä¸€é›†ç¾¤å¯æ”¯æŒ5000èŠ‚ç‚¹ï¼Œåœ¨å¦‚æ­¤è§„æ¨¡çš„é›†ç¾¤ä¸­ï¼Œå¤§è§„æ¨¡éƒ¨ç½²åº”ç”¨æ˜¯æœ‰è¯¸å¤šæŒ‘æˆ˜çš„ã€‚åº”è¯¥æ›´å¤šè¿˜æ˜¯æ›´å°‘?å¦‚ä½•æƒè¡¡?\n- å¦‚ä½•æ ¹æ®åœ°åŸŸåˆ’åˆ†é›†ç¾¤\n\t- ä¸åŒåœ°åŸŸçš„è®¡ç®—èŠ‚ç‚¹åˆ’åˆ†åˆ°åŒä¸€é›†ç¾¤\n\t- å°†åŒä¸€åœ°åŸŸçš„èŠ‚ç‚¹åˆ’åˆ†åˆ°åŒä¸€é›†ç¾¤\n- å¦‚ä½•è§„åˆ’é›†ç¾¤çš„ç½‘ç»œ\n\t- ä¼ä¸šåŠå…¬ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€é¢„ç”Ÿäº§ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒåº”å¦‚ä½•è¿›è¡Œç½‘ç»œåˆ†ç¦»\n\t- ä¸åŒç§Ÿæˆ·ä¹‹é—´åº”å¦‚ä½•è¿›è¡Œç½‘ç»œéš”ç¦»\n- å¦‚ä½•è‡ªåŠ¨åŒ–æ­å»ºé›†ç¾¤\n\t- å¦‚ä½•è‡ªåŠ¨åŒ–æ­å»ºå’Œå‡çº§é›†ç¾¤ï¼ŒåŒ…æ‹¬è‡ªåŠ¨åŒ–éƒ¨ç½²æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢çš„æ ¸å¿ƒç»„ä»¶\n\t- å¦‚ä½•ä¸ä¼ä¸šçš„å…¬å…±æœåŠ¡é›†æˆ\n\n## ä¼ä¸šå…¬å…±æœåŠ¡\n\néœ€è¦ä¸ä¼ä¸šè®¤è¯å¹³å°é›†æˆï¼Œè¿™æ ·ä¼ä¸šç”¨æˆ·å°±èƒ½é€šè¿‡ç»Ÿä¸€è®¤è¯å¹³å°æ¥å…¥Kubernetesé›†ç¾¤ï¼Œè€Œæ— é¡»é‡æ–°è®¾è®¡å’Œç®¡ç†ä¸€å¥—ç”¨æˆ·ç³»ç»Ÿã€‚\n\né›†æˆä¼ä¸šçš„åŸŸåæœåŠ¡ã€è´Ÿè½½å‡è¡¡æœåŠ¡ï¼Œæä¾›é›†ç¾¤æœåŠ¡å¯¹ä¼ä¸šå¤–å‘å¸ƒçš„è®¿é—®å…¥å£\n\nåœ¨ä¸ä¼ä¸šçš„å…¬å…±æœåŠ¡é›†æˆæ—¶ï¼Œéœ€è¦è€ƒè™‘å®ƒä»¬çš„æœåŠ¡æ˜¯å¦å¯é \n\nå¯¹äºä¸èƒ½å¼‚æ­¥è°ƒç”¨çš„è¯·æ±‚ï¼Œé‡‡ç”¨åŒæ­¥è°ƒç”¨éœ€è¦è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´\n\nè¿‡é•¿çš„è¶…æ—¶æ—¶é—´ï¼Œï¼Œä¼šå»¶è¿Ÿç»“æœç­‰å¾…æ—¶é—´ï¼Œå¯¼è‡´æ•´ä½“çš„é“¾è·¯è°ƒç”¨æ—¶é—´å»¶é•¿ï¼Œä»è€Œé™ä½æ•´ä½“çš„TPS\n\næœ‰äº›å¤±è´¥æ˜¯çŸ­æš‚çš„ã€å¶ç„¶çš„ï¼ˆæ¯”å¦‚ç½‘ç»œæŠ–åŠ¨ï¼‰ï¼Œè¿›è¡Œé‡è¯•å³å¯ã€‚è€Œæœ‰äº›å¤±è´¥æ˜¯å¿…ç„¶çš„ï¼Œé‡è¯•åè€Œä¼šé€ æˆè°ƒç”¨è¯·æ±‚é‡æ”¾å¤§ï¼ŒåŠ é‡å¯¹è°ƒç”¨ç³»ç»Ÿçš„è´Ÿæ‹…\n\n## æ§åˆ¶å¹³é¢çš„é«˜å¯ç”¨ä¿è¯\n\né’ˆå¯¹å¤§è§„æ¨¡çš„é›†ç¾¤ï¼Œåº”è¯¥ä¸ºæ§åˆ¶å¹³é¢ç»„ä»¶åˆ’åˆ†å•ç‹¬èŠ‚ç‚¹ï¼Œå‡å°‘ä¸šåŠ¡å®¹å™¨å¯¹æ§åˆ¶å¹³é¢å®¹å™¨æˆ–å®ˆæŠ¤è¿›ç¨‹çš„å¹²æ‰°å’Œèµ„æºæŠ¢å \n\næ§åˆ¶å¹³é¢æ‰€åœ¨çš„èŠ‚ç‚¹ï¼Œåº”ç¡®ä¿åœ¨ä¸åŒæœºæ¶ä¸Šï¼Œä»¥é˜²æ­¢å› ä¸ºæŸäº›æœºæ¶çš„äº¤æ¢æœºæˆ–ç”µæºå‡ºé—®é¢˜ï¼Œé€ æˆæ‰€æœ‰çš„æ§åˆ¶é¢èŠ‚ç‚¹éƒ½æ— æ³•å·¥ä½œ\n\nä¿è¯æ§åˆ¶å¹³é¢çš„æ¯ä¸ªç»„ä»¶æœ‰è¶³å¤Ÿçš„CPUã€å†…å­˜å’Œç£ç›˜èµ„æºï¼Œè¿‡äºä¸¥è‹›çš„èµ„æºé™åˆ¶ä¼šå¯¼è‡´ç³»ç»Ÿæ•ˆç‡ä½ä¸‹ï¼Œé™ä½é›†ç¾¤å¯ç”¨æ€§\n\nåº”å°½å¯èƒ½åœ°å‡å°‘æˆ–æ¶ˆé™¤å¤–éƒ¨ä¾èµ–ã€‚åœ¨KubneretesåˆæœŸç‰ˆæœ¬ä¸­å­˜åœ¨è¾ƒå¤šCloud Provider APIçš„è°ƒç”¨ï¼Œå¯¼è‡´åœ¨è¿è¥è¿‡ç¨‹ä¸­ï¼Œå½“Cloud Provider APIå‡ºç°æ•…éšœæ—¶ï¼Œä¼šä½¿å¾—Kubernetesé›†ç¾¤ä¹Ÿæ— æ³•æ­£å¸¸å·¥ä½œã€‚\n\nåº”å°½å¯èƒ½åœ°å°†æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢è§£è€¦ï¼Œç¡®ä¿æ§åˆ¶å¹³é¢ç»„ä»¶å‡ºç°æ•…éšœæ—¶ï¼Œå°†ä¸šåŠ¡å½±å“é™åˆ°æœ€ä½ã€‚\n\nKubernetesè¿˜æœ‰ä¸€äº›æ ¸å¿ƒæ’ä»¶ï¼Œæ˜¯ä»¥æ™®é€šçš„Podå½¢å¼åŠ è½½è¿è¡Œçš„ï¼Œå¯èƒ½ä¼šè¢«è°ƒåº¦åˆ°ä»»æ„å·¥ä½œèŠ‚ç‚¹ï¼Œä¸æ™®é€šåº”ç”¨ç«äº‰èµ„æºã€‚è¿™äº›æ’ä»¶æ˜¯å¦æ­£å¸¸è¿è¡Œä¹Ÿå†³å®šäº†é›†ç¾¤çš„å¯ç”¨æ€§ã€‚\n\n## é«˜å¯ç”¨é›†ç¾¤\n\n![image.png](Extras/Images/image_1667030270184_0.png)\n\n## é›†ç¾¤å®‰è£…æ–¹æ³•æ¯”è¾ƒ\n\n![image.png](Extras/Images/image_1667030574489_0.png)\n\n## ç”¨Kubesprayæ­å»ºé«˜å¯ç”¨é›†ç¾¤æ­å»º\n\n![image.png](Extras/Images/image_1667037652776_0.png)\n\n## åŸºäºå£°æ˜å¼APIç®¡ç†é›†ç¾¤\n\n- é›†ç¾¤ç®¡ç†ä¸ä»…ä»…åŒ…æ‹¬é›†ç¾¤æ­å»ºï¼Œè¿˜æœ‰æ›´å¤šåŠŸèƒ½éœ€è¦æ”¯æŒ\n\t- é›†ç¾¤æ‰©ç¼©å®¹\n\t- èŠ‚ç‚¹å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨ä¿®å¤\n\t- Kuberneteså‡çº§\n\t- æ“ä½œç³»ç»Ÿå‡çº§\n- äº‘åŸç”Ÿåœºæ™¯ä¸­é›†ç¾¤åº”è¯¥æŒ‰ç…§æˆ‘ä»¬çš„æœŸæœ›çš„çŠ¶æ€è¿è¡Œï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åº”è¯¥å°†é›†ç¾¤ç®¡ç†å»ºç«‹åœ¨å£°æ˜å¼APIçš„åŸºç¡€ä¹‹ä¸Š\n\n## Kubernetes Cluster API\n\n![image.png](Extras/Images/image_1667038756175_0.png)\n\n## å‚ä¸è§’è‰²\n\n- ç®¡ç†é›†ç¾¤\n\t- ç®¡ç†workload é›†ç¾¤çš„é›†ç¾¤ï¼Œç”¨æ¥å­˜æ”¾Cluster APIå¯¹è±¡çš„åœ°æ–¹\n- Workloadé›†ç¾¤\n\t- çœŸæ­£å¼€æ”¾ç»™ç”¨æˆ·ç”¨æ¥è¿è¡Œåº”ç”¨çš„é›†ç¾¤ï¼Œç”±ç®¡ç†é›†ç¾¤ç®¡ç†\n- Infrastructure provider\n\t- æä¾›ä¸åŒäº‘çš„åŸºç¡€æ¶æ„ç®¡ç†ï¼ŒåŒ…æ‹¬è®¡ç®—èŠ‚ç‚¹ï¼Œç½‘ç»œç­‰ã€‚ç›®å‰æµè¡Œçš„å…¬æœ‰äº‘å¤šä¸Cluster APIé›†æˆäº†ã€‚\n- Bootstrap provider\n\t- è¯ä¹¦ç”Ÿæˆ\n\t- æ§åˆ¶é¢ç»„ä»¶å®‰è£…å’Œåˆå§‹åŒ–ï¼Œç›‘æ§èŠ‚ç‚¹çš„åˆ›å»º\n\t- å°†ä¸»èŠ‚ç‚¹å’Œè®¡ç®—èŠ‚ç‚¹åŠ å…¥é›†ç¾¤\n- Control plane\n\t- Kubernetesæ§åˆ¶å¹³é¢ç»„ä»¶\n\n## æ¶‰åŠæ¨¡å‹\n\n- Machine\n\t- è®¡ç®—èŠ‚ç‚¹ï¼Œç”¨æ¥æè¿°å¯ä»¥è¿è¡ŒKubernetesç»„ä»¶çš„æœºå™¨å¯¹è±¡ï¼ˆæ³¨æ„ä¸Kubernetes Nodeï¼‰çš„å·®å¼‚\n\t- ä¸€ä¸ªæ–°Machineè¢«åˆ›å»ºä»¥åï¼Œå¯¹åº”çš„æ§åˆ¶å™¨ä¼šåˆ›å»ºä¸€ä¸ªè®¡ç®—èŠ‚ç‚¹ï¼Œå®‰è£…å¥½æ“ä½œç³»ç»Ÿå¹¶æ›´æ–°Machineçš„çŠ¶æ€\n\t- å½“ä¸€ä¸ªMachineè¢«åˆ é™¤åï¼Œå¯¹åº”çš„æ§åˆ¶å™¨ä¼šåˆ é™¤æ‰è¯¥èŠ‚ç‚¹å¹¶å›æ”¶è®¡ç®—èµ„æºã€‚\n\t- å½“Machineå±æ€§è¢«æ›´æ–°ä»¥åï¼ˆæ¯”å¦‚Kubernetesç‰ˆæœ¬æ›´æ–°ï¼‰ï¼Œå¯¹åº”çš„æ§åˆ¶å™¨ä¼šåˆ é™¤æ—§èŠ‚ç‚¹å¹¶åˆ›å»ºæ–°èŠ‚ç‚¹\n- Machine Immutability (In-place Upgrade vs. Replace)\n\t- ä¸å¯å˜åŸºç¡€æ¶æ„\n- MachineDeployment\n\t- æä¾›é’ˆå¯¹Machineå’ŒMachineSetçš„å£°æ˜å¼æ›´æ–°ï¼Œç±»ä¼¼äºKubernetes Deployment\n- MachineSet\n\t- ç»´æŠ¤ä¸€ä¸ªç¨³å®šçš„æœºå™¨é›†åˆï¼Œç±»ä¼¼Kubernetes ReplicaSet\n- MachineHealthCheck\n\t- å®šä¹‰èŠ‚ç‚¹åº”è¯¥è¢«æ ‡è®°ä¸ºä¸å¯ç”¨çš„æ¡ä»¶\n\n## æ—¥å¸¸è¿è¥ä¸­çš„èŠ‚ç‚¹é—®é¢˜å½’ç±»\n\n- å¯è‡ªåŠ¨ä¿®å¤çš„é—®é¢˜\n\t- è®¡ç®—èŠ‚ç‚¹down\n\t\t- Pingä¸é€š\n\t\t- TCP probeå¤±è´¥\n\t\t- èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰åº”ç”¨éƒ½ä¸å¯è¾¾\n- ä¸å¯è‡ªåŠ¨ä¿®å¤çš„é—®é¢˜\n\t- æ–‡ä»¶ç³»ç»Ÿå\n\t- ç£ç›˜é˜µåˆ—æ•…éšœ\n\t- ç½‘ç›˜æŒ‚è½½é—®é¢˜\n\t- å…¶ä»–ç¡¬ä»¶æ•…éšœ\n\t- Kernelå‡ºé”™ï¼Œcore dumps\n- å…¶ä»–é—®é¢˜\n\t- è½¯ä»¶Bug\n\t- è¿›ç¨‹é”æ­»ï¼Œæˆ–è€…memory/CPUç«äº‰é—®é¢˜\n\t- Kubernetesç»„ä»¶å‡ºé—®é¢˜\n\t\t- Kubelet/Kube-proxy/Docker/Salt\n\n## æ•…éšœç›‘æµ‹å’Œè‡ªåŠ¨æ¢å¤\n\nå½“åˆ›å»ºComputeèŠ‚ç‚¹æ—¶ï¼Œå…è®¸å®šä¹‰Liveness Probe\n\nå½“livenessProbeå¤±è´¥æ—¶ï¼ŒComputeNodeçš„ProbePassedè®¾ç½®ä¸ºfalse\n\nåœ¨Prometheusä¸­ï¼Œå·²ç»æœ‰Node levelçš„alertï¼ŒæŠ“å–Prometheusä¸­çš„alert\n\n![image.png](Extras/Images/image_1667045860645_0.png)\n\nè®¾å®šè‡ªåŠ¨æ¢å¤è§„åˆ™\n\n- å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé‡å¯å¤§æ³•å¥½ï¼ˆäººäººéƒ½æ˜¯Restart operator)ã€‚\n- å¦‚æœé‡å¯ä¸è¡Œå°±é‡è£…ã€‚ï¼ˆreprovisionï¼‰\n- é‡è£…ä¸è¡Œå°±é‡ä¿®ã€‚ï¼ˆbreakfixï¼‰\n\n# Cluster Autoscaler\n\n## å·¥ä½œæœºåˆ¶\n\n- æ‰©å®¹\n\t- ç”±äºèµ„æºä¸è¶³ï¼Œpodè°ƒåº¦å¤±è´¥ï¼Œå³æœ‰podä¸€ç›´å¤„äºPendingçŠ¶æ€\n- ç¼©å®¹\n\t- nodeçš„èµ„æºåˆ©ç”¨ç‡è¾ƒä½æ—¶ï¼ŒæŒç»­10åˆ†é’Ÿä½äº50%\n\t- æ­¤nodeä¸Šå­˜åœ¨çš„podéƒ½èƒ½è¢«é‡æ–°è°ƒåº¦åˆ°å…¶ä»–nodeä¸Šè¿è¡Œ\n\n![image.png](Extras/Images/image_1667046078752_0.png)\n\n## Cluster AutoScaleræ¶æ„\n\n- Autoscalerï¼šæ ¸å¿ƒæ¨¡å—ï¼Œè´Ÿè´£æ•´ä½“æ‰©ç¼©å®¹åŠŸèƒ½\n- Estimatorï¼šè´Ÿè´£è¯„ä¼°è®¡ç®—æ‰©å®¹èŠ‚ç‚¹\n- Simulatorï¼šè´Ÿè´£æ¨¡æ‹Ÿè°ƒåº¦ï¼Œè®¡ç®—ç¼©å®¹èŠ‚ç‚¹\n- Cloud-Providerï¼šä¸äº‘äº¤äº’è¿›è¡ŒèŠ‚ç‚¹çš„å¢åˆ æ“ä½œï¼Œæ¯ä¸ªæ”¯æŒCAçš„ä¸»æµå‚å•†éƒ½å®ç°è‡ªå·±çš„pluginå®ç°åŠ¨æ€ç¼©æ”¾\n\n![image.png](Extras/Images/image_1667046243581_0.png)\n\n## Cluster Autoscalerçš„æ‰©å±•æœºåˆ¶\n\n- ä¸ºäº†è‡ªåŠ¨åˆ›å»ºå’Œåˆå§‹åŒ–Nodeï¼ŒCluster Autoscalerè¦æ±‚Nodeå¿…é¡»å±äºæŸä¸ªNode Groupï¼Œæ¯”å¦‚\n\t- GCE/GKE ä¸­çš„ Managed instance groupsï¼ˆMIGï¼‰\n\t- AWSä¸­çš„ Autoscaling Groups\n\t- Cluster API Node\n- å½“é›†ç¾¤ä¸­æœ‰å¤šä¸ªNode Group æ—¶ï¼Œå¯ä»¥é€šè¿‡`--expander=\u003coption\u003e` é€‰é¡¹é…ç½®é€‰æ‹©Node Group çš„ç­–ç•¥ï¼Œæ”¯æŒå¦‚ä¸‹å››ç§æ–¹å¼\n\t- randomï¼šéšæœºé€‰æ‹©\n\t- most-podsï¼šé€‰æ‹©å®¹é‡æœ€å¤§ï¼ˆå¯ä»¥åˆ›å»ºæœ€å¤šPodï¼‰çš„Node Group\n\t- least-wasteï¼šä»¥æœ€å°æµªè´¹åŸåˆ™é€‰æ‹©ï¼Œå³é€‰æ‹©æœ‰æœ€å°‘å¯ç”¨èµ„æºçš„ Node Group\n\t- priceï¼šé€‰æ‹©æœ€ä¾¿å®œçš„ Node Group\n\n# å¤šç§Ÿæˆ·é›†ç¾¤ç®¡ç†\n\n## ç§Ÿæˆ·\n\nç§Ÿæˆ·æ˜¯æŒ‡ä¸€ç»„æ‹¥æœ‰è®¿é—®ç‰¹å®šè½¯ä»¶èµ„æºæƒé™çš„ç”¨æˆ·é›†åˆï¼Œåœ¨å¤šç§Ÿæˆ·ç¯å¢ƒä¸­ï¼Œå®ƒè¿˜åŒ…æ‹¬å…±äº«çš„åº”ç”¨ã€æœåŠ¡ã€æ•°æ®å’Œå„é¡¹é…ç½®ç­‰\n\nå¤šç§Ÿæˆ·é›†ç¾¤å¿…é¡»å°†ç§Ÿæˆ·å½¼æ­¤éš”ç¦»ï¼Œä»¥æœ€å¤§é™åº¦åœ°å‡å°‘ç§Ÿæˆ·ä¸ç§Ÿæˆ·ã€ç§Ÿæˆ·ä¸é›†ç¾¤ä¹‹é—´çš„å½±å“\n\né›†ç¾¤é¡»åœ¨ç§Ÿæˆ·ä¹‹é—´å…¬å¹³åœ°åˆ†é…é›†ç¾¤èµ„æºã€‚é€šè¿‡å¤šç§Ÿæˆ·å…±äº«é›†ç¾¤èµ„æºï¼Œå¯ä»¥æœ‰æ•ˆåœ°é™ä½é›†ç¾¤ç®¡ç†æˆæœ¬ï¼Œæé«˜æ•´ä½“é›†ç¾¤çš„èµ„æºåˆ©ç”¨ç‡\n\n## è®¤è¯-å®ç°å¤šç§Ÿæˆ·çš„åŸºç¡€\n\nç§Ÿæˆ·ç®¡ç†é¦–å…ˆéœ€è¦è¯†åˆ«è®¿é—®çš„ç”¨æˆ·æ˜¯è°ï¼Œå› æ­¤ç”¨æˆ·èº«ä»½è®¤è¯æ˜¯å¤šç§Ÿæˆ·çš„åŸºç¡€\n\næƒé™æ§åˆ¶ï¼Œå¦‚å…è®¸åˆæ³•ç™»å½•çš„ç”¨æˆ·è®¿é—®ã€æ‹’ç»éæ³•ç™»å½•çš„ç”¨æˆ·è®¿é—®æˆ–æä¾›æœ‰é™çš„åŒ¿åè®¿é—®\n\nKuberneteså¯ç®¡ç†ä¸¤ç±»ç”¨æˆ·\n\nç”¨æ¥æ ‡è¯†å’Œç®¡ç†ç³»ç»Ÿç»„ä»¶çš„ServiceAccount\n\nå¤–éƒ¨ç”¨æˆ·çš„è®¤è¯ï¼Œéœ€è¦é€šè¿‡Kubernetesçš„è®¤è¯æ‰©å±•æ¥å¯¹æ¥ä¼ä¸šã€ä¾›åº”å•†çš„è®¤è¯æœåŠ¡ï¼Œä¸ºç”¨æˆ·éªŒè¯ã€æ“ä½œæˆæƒã€èµ„æºéš”ç¦»ç­‰æä¾›åŸºç¡€\n\n## éš”ç¦»\n\né™¤è®¤è¯ã€æˆæƒè¿™äº›åŸºç¡€æ¡ä»¶å¤–ï¼Œè¿˜è¦èƒ½å¤Ÿä¿è¯ç”¨æˆ·çš„å·¥ä½œè´Ÿè½½å½¼æ­¤ä¹‹é—´æœ‰å°½å¯èƒ½å®‰å…¨çš„éš”ç¦»ï¼Œå‡å°‘ç”¨æˆ·å·¥ä½œè´Ÿè½½ä¹‹é—´çš„å½±å“ã€‚é€šå¸¸ä»æƒé™ã€ç½‘ç»œã€æ•°æ®ä¸‰ä¸ªæ–¹é¢å¯¹ä¸åŒç”¨æˆ·è¿›è¡Œéš”ç¦»\n\næƒé™éš”ç¦»\n\næ™®é€šç”¨æˆ·çš„å®¹å™¨é»˜è®¤ä¸å…·æœ‰priviledgedã€sys adminã€net adminç­‰é«˜çº§ç®¡ç†æƒé™ï¼Œä»¥é˜»æ­¢å¯¹å®¿ä¸»æœºåŠå…¶ä»–ç”¨æˆ·çš„å®¹å™¨è¿›è¡Œè¯»å–ã€å†™å…¥ç­‰æ“ä½œã€‚\n\nç½‘ç»œéš”ç¦»\n\nä¸åŒçš„Podï¼Œè¿è¡Œåœ¨ä¸åŒçš„Network Namespaceä¸­ï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„ç½‘ç»œåè®®æ ˆã€‚Podä¹‹é—´åªèƒ½é€šè¿‡å®¹å™¨å¼€æ”¾çš„ç«¯å£è¿›è¡Œé€šä¿¡ï¼Œä¸èƒ½é€šè¿‡å…¶ä»–æ–¹å¼è¿›è¡Œè®¿é—®ã€‚\n\næ•°æ®éš”ç¦»\n\nå®¹å™¨ä¹‹é—´åˆ©ç”¨Namespaceè¿›è¡Œéš”ç¦»ï¼Œåœ¨ç¬¬2ç« ä¸­æˆ‘ä»¬å·²ç»å¯¹ä¸åŒçš„Namespaceè¿›è¡Œäº†è¯¦ç»†æè¿°ã€‚ä¸åŒPodçš„å®¹å™¨ï¼Œè¿è¡Œåœ¨ä¸åŒçš„MNTã€UTSã€PIDã€IPC Namespaceä¸Šï¼Œç›¸äº’ä¹‹é—´æ— æ³•è®¿é—®å¯¹æ–¹çš„æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹ã€IPCç­‰ä¿¡æ¯;åŒä¸€ä¸ªPodçš„å®¹å™¨ï¼Œå…¶mntã€PID Namespaceä¹Ÿä¸å…±äº«ã€‚\n\n## ç§Ÿæˆ·éš”ç¦»æ‰‹æ®µ\n\nNamespaceï¼šNamespaceå±äºä¸”ä»…å±äºä¸€ä¸ªç§Ÿæˆ·ã€‚æƒé™å®šä¹‰âˆ¶å®šä¹‰å†…å®¹åŒ…æ‹¬å‘½åç©ºé—´ä¸­çš„Roleä¸RoleBindingã€‚è¿™äº›èµ„æºè¡¨ç¤ºç›®å‰ç§Ÿæˆ·åœ¨å½’å±äºè‡ªå·±çš„å‘½åç©ºé—´ä¸­å®šä¹‰äº†ä»€ä¹ˆæƒé™ã€æˆæƒç»™äº†å“ªäº›ç§Ÿæˆ·çš„æˆå‘˜ã€‚\n\nPodå®‰å…¨ç­–ç•¥ï¼šç‰¹æ®Šæƒé™æŒ‡é›†ç¾¤çº§çš„ç‰¹å®šèµ„æºå®šä¹‰â€”â€”PodSecurityPolicyã€‚å®ƒå®šä¹‰äº†ä¸€ç³»åˆ—å·¥ä½œè´Ÿè½½ä¸åŸºç¡€è®¾æ–½ä¹‹é—´ã€å·¥ä½œè´Ÿè½½ä¸å·¥ä½œè´Ÿè½½ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œå¹¶é€šè¿‡å‘½åç©ºé—´çš„RoleBindingå®Œæˆæˆæƒã€‚\n\nç½‘ç»œç­–ç•¥ï¼šåŸºç¡€è®¾æ–½å±‚é¢ä¸ºä¿éšœç§Ÿæˆ·ç½‘ç»œçš„éš”ç¦»æœºåˆ¶æä¾›äº†ä¸€ç³»åˆ—é»˜è®¤ç­–ç•¥ï¼Œä»¥åŠç§Ÿæˆ·è‡ªå·±å®šåˆ¶çš„ç”¨äºç§Ÿæˆ·åº”ç”¨å½¼æ­¤è®¿é—®çš„ç­–ç•¥ã€‚\n\nPodã€Serviceã€PersistentVolumeClaimç­‰å‘½åç©ºé—´èµ„æºï¼šè¿™äº›å®šä¹‰è¡¨ç¤ºç§Ÿæˆ·çš„åº”ç”¨è½åœ°åˆ°Kubernetesä¸­çš„å®ä½“ã€‚\n\n![image.png](Extras/Images/image_1667048020921_0.png)\n\n## æƒé™éš”ç¦»\n\n- åŸºäºNamespaceçš„æƒé™éš”ç¦»\n\t- åˆ›å»ºä¸€ä¸ªnamespace-admin ClusterRoleï¼Œæ‹¥æœ‰æ‰€æœ‰å¯¹è±¡çš„æ‰€æœ‰æƒé™\n\t- ä¸ºç”¨æˆ·å¼€è¾Ÿæ–°namespaceï¼Œå¹¶åœ¨è¯¥namespaceåˆ›å»ºrolebindingç»‘å®šnamespace-admin ClusterRoleï¼Œç”¨æˆ·å³å¯æ‹¥æœ‰å½“å‰namespaceæ‰€æœ‰å¯¹è±¡æ“ä½œæƒé™\n- è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆ\n\t- å½“Namespaceåˆ›å»ºæ—¶ï¼Œé€šè¿‡mutatingwebhookå°†namespaceå˜å½¢ï¼Œå°†ç”¨æˆ·ä¿¡æ¯è®°å½•è‡³namespace annotation\n\t- åˆ›å»ºä¸€ä¸ªæ§åˆ¶å™¨ï¼Œç›‘æ§namespaceï¼Œåˆ›å»ºrolebindingä¸ºè¯¥ç”¨æˆ·ç»‘å®šnamespace-admin çš„æƒé™\n\n![image.png](Extras/Images/image_1667048158659_0.png)\n\n## Quotaç®¡ç†\n\nå¼€å¯ResourceQuotaå‡†å…¥æ’ä»¶ã€‚\n\nåœ¨ç”¨æˆ·namespaceåˆ›å»ºResourceQuotaå¯¹è±¡è¿›è¡Œé™é¢é…ç½®ã€‚\n\n```yaml\napiVersion: v1\nkind: ResourceQuota\nmetadata:\n  name: high-qos-limit-requests\nSpec:\n  hard:\n    limits.cpu: 8\n    limits.memory: 24Gi\n    pods: 10\n    requests.cpu: 4\n    requests.memory: 12Gi\n  scopes:\n    - NotBestEffort\n```\n\n![image.png](Extras/Images/image_1667048868059_0.png)\n\n## èŠ‚ç‚¹èµ„æºéš”ç¦»\n\né€šè¿‡ä¸ºèŠ‚ç‚¹è®¾ç½®ä¸åŒtaintæ¥è¯†åˆ«ä¸åŒç§Ÿæˆ·çš„è®¡ç®—èµ„æºã€‚\n\nä¸åŒç§Ÿæˆ·åœ¨åˆ›å»ºPodæ—¶ï¼Œå¢åŠ Tolerationå…³é”®å­—ï¼Œç¡®ä¿å…¶èƒ½è°ƒåº¦è‡³æŸä¸ªtaintçš„èŠ‚ç‚¹ã€‚\n\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/%E8%B0%83%E5%BA%A6":{"title":"è°ƒåº¦","content":"\n# kube-scheduler\n\nkube-schedulerè´Ÿè´£åˆ†é…è°ƒåº¦Pod åˆ°é›†ç¾¤å†…çš„èŠ‚ç‚¹ä¸Šï¼Œå®ƒç›‘å¬ kube-apiserverï¼ŒæŸ¥è¯¢è¿˜æœªåˆ†é…\n\nNode çš„Podï¼Œç„¶åæ ¹æ®è°ƒåº¦ç­–ç•¥ä¸ºè¿™äº› Pod åˆ†é…èŠ‚ç‚¹ï¼ˆæ›´æ–° Pod çš„ NodeName å­—æ®µï¼‰ã€‚\n\nè°ƒåº¦å™¨éœ€è¦å……åˆ†è€ƒè™‘è¯¸å¤šçš„å› ç´ âˆ¶\n\n* å…¬å¹³è°ƒåº¦ï¼›\n* èµ„æºé«˜æ•ˆåˆ©ç”¨ï¼›\n* QoSï¼›\n* affinityå’Œ anti-affinityï¼›\n* æ•°æ®æœ¬åœ°åŒ–ï¼ˆdata localityï¼‰ï¼›\n* å†…éƒ¨è´Ÿè½½å¹²æ‰°ï¼ˆinter-workload interferenceï¼‰ï¼›\n* deadlinesã€‚\n\n# è°ƒåº¦å™¨\n\nkube-scheduler è°ƒåº¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œpredicate å’Œ priorityï¼š\n\n* predicateï¼šè¿‡æ»¤ä¸ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ï¼›\n* priorityï¼šä¼˜å…ˆçº§æ’åºï¼Œé€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„èŠ‚ç‚¹ã€‚\n\n# Predicatesç­–ç•¥\n\n![image.png](Extras/Images/image_1666026644919_0.png)\n\n![image.png](Extras/Images/image_1666026667493_0.png)\n\nè¿˜æœ‰å¾ˆå¤šå…¶ä»–ç­–ç•¥ï¼Œä½ ä¹Ÿå¯ä»¥ç¼–å†™è‡ªå·±çš„ç­–ç•¥ã€‚\n\n# Predicates pluginå·¥ä½œåŸç†\n\n![image.png](Extras/Images/image_1666026900870_0.png)\n\n# Prioritiesç­–ç•¥\n\n![image.png](Extras/Images/image_1666026930477_0.png)\n\n![image.png](Extras/Images/image_1666026940091_0.png)\n\n# èµ„æºéœ€æ±‚\n\n* CPU\n\t* requests\n\t\t* Kubernetesè°ƒåº¦Podæ—¶ï¼Œä¼šåˆ¤æ–­å½“å‰èŠ‚ç‚¹æ­£åœ¨è¿è¡Œçš„Podçš„CPURequestçš„æ€»å’Œï¼Œå†åŠ ä¸Šå½“å‰è°ƒåº¦Podçš„CPU requestï¼Œè®¡ç®—å…¶æ˜¯å¦è¶…è¿‡èŠ‚ç‚¹çš„CPUçš„å¯åˆ†é…èµ„æº\n* limits\n\t* é…ç½®cgroupä»¥é™åˆ¶èµ„æºä¸Šé™\n* å†…å­˜\n\t* requests\n\t\t* åˆ¤æ–­èŠ‚ç‚¹çš„å‰©ä½™å†…å­˜æ˜¯å¦æ»¡è¶³Podçš„å†…å­˜è¯·æ±‚é‡ï¼Œä»¥ç¡®å®šæ˜¯å¦å¯ä»¥å°†Podè°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹\n\t* limits\n\t\t* é…ç½®cgroupä»¥é™åˆ¶èµ„æºä¸Šé™\n\n# ç£ç›˜èµ„æºéœ€æ±‚\n\nå®¹å™¨ä¸´æ—¶å­˜å‚¨ï¼ˆephemeral storageï¼‰åŒ…å«æ—¥å¿—å’Œå¯å†™å±‚æ•°æ®ï¼Œå¯ä»¥é€šè¿‡å®šä¹‰Pod Specä¸­çš„limits.ephemeral-storageå’Œrequests.ephemeral-storageæ¥ç”³è¯·ã€‚\n\nPodè°ƒåº¦å®Œæˆåï¼Œè®¡ç®—èŠ‚ç‚¹å¯¹ä¸´æ—¶å­˜å‚¨çš„é™åˆ¶ä¸æ˜¯åŸºäºCGroupçš„ï¼Œè€Œæ˜¯ç”±kubeletå®šæ—¶è·å–å®¹å™¨çš„æ—¥å¿—å’Œå®¹å™¨å¯å†™å±‚çš„ç£ç›˜ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœè¶…è¿‡é™åˆ¶ï¼Œåˆ™ä¼šå¯¹Podè¿›è¡Œé©±é€ã€‚\n\n# Init Containerçš„èµ„æºéœ€æ±‚\n\nå½“kube-Schedulerè°ƒåº¦å¸¦æœ‰å¤šä¸ªinitå®¹å™¨çš„Podæ—¶ï¼Œåªè®¡ç®—cpu.requestæœ€å¤šçš„initå®¹å™¨ï¼Œè€Œä¸æ˜¯è®¡ç®—æ‰€æœ‰çš„initå®¹å™¨æ€»å’Œã€‚\n\nç”±äºå¤šä¸ªinitå®¹å™¨æŒ‰é¡ºåºæ‰§è¡Œï¼Œå¹¶ä¸”æ‰§è¡Œå®Œæˆç«‹å³é€€å‡ºï¼Œæ‰€ä»¥ç”³è¯·æœ€å¤šçš„èµ„æºinitå®¹å™¨ä¸­çš„æ‰€éœ€èµ„æºï¼Œå³å¯æ»¡è¶³æ‰€æœ‰initå®¹å™¨éœ€æ±‚ã€‚\n\nkube-Scheduleråœ¨è®¡ç®—è¯¥èŠ‚ç‚¹è¢«å ç”¨çš„èµ„æºæ—¶ï¼Œinitå®¹å™¨çš„èµ„æºä¾ç„¶ä¼šè¢«çº³å…¥è®¡ç®—ã€‚å› ä¸ºinitå®¹å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹å¯èƒ½ä¼šè¢«å†æ¬¡æ‰§è¡Œï¼Œæ¯”å¦‚ç”±äºæ›´æ¢é•œåƒè€Œå¼•èµ·Sandboxé‡å»ºæ—¶ã€‚\n\n# æŠŠ Pod è°ƒåº¦åˆ°æŒ‡å®š Node ä¸Š\n\nå¯ä»¥é€šè¿‡ nodeSelectorã€nodeAffinityã€podAfinity ä»¥åŠTaints å’Œ tolerations ç­‰æ¥å°†Pod è°ƒåº¦åˆ°éœ€è¦çš„ Node ä¸Šã€‚\n\nä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½® nodeName å‚æ•°ï¼Œå°†Pod è°ƒåº¦åˆ°æŒ‡å®šnodeèŠ‚ç‚¹ä¸Šã€‚\n\næ¯”å¦‚ï¼Œä½¿ç”¨nodeSelectorï¼Œé¦–å…ˆç»™NodeåŠ ä¸Šæ ‡ç­¾âˆ¶ `kubectl label nodes \u003cyour-node-name\u003e disktype=ssd`\n\næ¥ç€ï¼ŒæŒ‡å®šè¯¥Podåªæƒ³è¿è¡Œåœ¨å¸¦æœ‰disktype=ssdæ ‡ç­¾çš„Nodeä¸Šã€‚\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\n  labels:\n    env: test\nspec:\n  containers:\n    - name: nginx\n      image: nginx\n      imagePullPolicy: IfNotPresent\n  nodeSelector:\n    disktype: ssd\n```\n\n## nodeSelector\n\né¦–å…ˆç»™ Nodeæ‰“ä¸Šæ ‡ç­¾âˆ¶\n\nkubectl label nodes node-01 disktype=ssd\n\nç„¶ååœ¨ daemonset ä¸­æŒ‡å®šnodeSelectorä¸º disktype=ssdï¼š\n\n```yaml\nSpec:  \n  nodeSelector:  \n    disktype: ssd \n```\n\n## NodeAffinity\n\nNodeAffinity ç›®å‰æ”¯æŒä¸¤ç§âˆ¶requiredDuringSchedulinglgnoredDuringExecution å’ŒpreferredDuringSchedulinglgnoredDuringExecutionï¼Œåˆ†åˆ«ä»£è¡¨å¿…é¡»æ»¡è¶³æ¡ä»¶å’Œä¼˜é€‰æ¡ä»¶ã€‚\n\næ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ä»£è¡¨è°ƒåº¦åˆ°åŒ…å«æ ‡ç­¾Kubernetes.io/e2e-az-nameå¹¶ä¸”å€¼ä¸ºe2e-az1æˆ–e2e-az2çš„Nodeä¸Šï¼Œå¹¶ä¸”ä¼˜é€‰è¿˜å¸¦æœ‰æ ‡ç­¾another-node-label-key=another-node-label-value çš„ Nodeã€‚\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: with-node-affinity\nspec:\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulinglgnoredDuringExecution:\n        nodeSelectorTerms:\n          - matchExpressions:\n            - key: kubernetes.io/e2e-az-name\n              operator: In\n              values:\n              - e2e-az1\n              - e2e-az2\n      preferredDuringSchedulinglgnoredDuringExecution:\n        - weight: 1\n          preference:\n            matchExpressions:\n            - key: another-node-label-key\n              operator: In\n              values:\n              - another-node-label-value\n  containers:\n  - name: with-node-affinity\n    image: gcr.io/google_containers/pause:2.0\n```\n\n## podAffinity\n\npodAffinity åŸºäº Pod çš„æ ‡ç­¾æ¥é€‰æ‹©Nodeï¼Œä»…è°ƒåº¦åˆ°æ»¡è¶³æ¡ä»¶ Pod æ‰€åœ¨çš„ Node ä¸Šï¼Œæ”¯æŒpodAffinity å’Œ podAntiAffinityã€‚è¿™ä¸ªåŠŸèƒ½æ¯”è¾ƒç»•ï¼Œä»¥ä¸‹é¢çš„ä¾‹å­ä¸ºä¾‹âˆ¶\n\nå¦‚æœä¸€ä¸ª\"Node æ‰€åœ¨ Zone ä¸­åŒ…å«è‡³å°‘ä¸€ä¸ªå¸¦æœ‰security=S1æ ‡ç­¾ä¸”è¿è¡Œä¸­çš„ Pod\"ï¼Œé‚£ä¹ˆå¯ä»¥è°ƒåº¦åˆ°è¯¥ Nodeï¼Œä¸è°ƒåº¦åˆ°\"åŒ…å«è‡³å°‘ä¸€ä¸ªå¸¦æœ‰ security=S2æ ‡ç­¾ä¸”è¿è¡Œä¸­ Pod\"çš„Node ä¸Šã€‚\n\n```yaml\nkind: Pod\nmetadata:\n  name: with-pod-affinity\nspec:\n  afinity:\n    podAffinity:\n      requiredDuringSchedulinglgnoredDuringExecution:\n      - labelSelector:\n        matchExpressions:\n        - key: security\n          operator: In\n          values:\n            - S1\n      topologyKey: failure-domain.beta.kubernetes.io/zone\n    podAntiAffinity:\n      preferredDuringSchedulinglgnoredDuringExecution:\n      - weight: 100\n        podAffityTerm:\n          labelSelector:\n            matchExpressions:\n            - key: security\n              operator: In\n              values:\n              - 52\n          topologyKey: kubernetes.io/hostname\n  containers:\n  - name: with-pod-affinity\n    image: gcr.io/google_containers/pause:2.0\n```\n\n## Taints å’Œ Toleration\n\nTaintså’ŒTolerations ç”¨äºä¿è¯ Pod ä¸è¢«è°ƒåº¦åˆ°ä¸åˆé€‚çš„ Node ä¸Šï¼Œå…¶ä¸­Taint åº”ç”¨äºNode ä¸Šï¼Œè€ŒToleration åˆ™åº”ç”¨äº Pod ä¸Šã€‚\n\nç›®å‰æ”¯æŒçš„Taintç±»å‹ï¼š\n\n- **NoSchedule**ï¼šæ–°çš„ Podä¸è°ƒåº¦åˆ°è¯¥Node ä¸Šï¼Œä¸å½±å“æ­£åœ¨è¿è¡Œçš„ Podï¼›\n- **PreferNoSchedule**ï¼šsoftç‰ˆçš„NoScheduleï¼Œå°½é‡ä¸è°ƒåº¦åˆ°è¯¥ Node ä¸Šï¼›\n- **NoExecute**ï¼šæ–°çš„ Pod ä¸è°ƒåº¦åˆ°è¯¥Nodeä¸Šï¼Œå¹¶ä¸”åˆ é™¤ï¼ˆevictï¼‰å·²åœ¨è¿è¡Œçš„ Podã€‚Pod å¯ä»¥å¢åŠ ä¸€ä¸ªæ—¶é—´ï¼ˆtolerationSecondsï¼‰ã€‚\n\nç„¶è€Œï¼Œå½“ Pod çš„ Tolerations åŒ¹é… Node çš„æ‰€æœ‰Taints çš„æ—¶å€™å¯ä»¥è°ƒåº¦åˆ°è¯¥Nodeä¸Š;å½“ Pod æ˜¯å·²ç»è¿è¡Œçš„æ—¶å€™ï¼Œä¹Ÿä¸ä¼šè¢«åˆ é™¤ï¼ˆevictedï¼‰ã€‚å¦å¤–å¯¹äºNoExecuteï¼Œå¦‚æœ Pod å¢åŠ äº†ä¸€ä¸ªtolerationSecondsï¼Œåˆ™ä¼šåœ¨è¯¥æ—¶é—´ä¹‹åæ‰åˆ é™¤ Podã€‚\n\n## å¤šç§Ÿæˆ·Kubernetesé›†ç¾¤-è®¡ç®—èµ„æºéš”ç¦»\n\nKubernetesé›†ç¾¤ä¸€èˆ¬æ˜¯é€šç”¨é›†ç¾¤ï¼Œå¯è¢«æ‰€æœ‰ç”¨æˆ·å…±äº«ï¼Œç”¨æˆ·æ— éœ€å…³å¿ƒè®¡ç®—èŠ‚ç‚¹ç»†èŠ‚ã€‚\n\nä½†å¾€å¾€æŸäº›è‡ªå¸¦è®¡ç®—èµ„æºçš„å®¢æˆ·è¦æ±‚ï¼š\n\n* å¸¦ç€è®¡ç®—èµ„æºåŠ å…¥Kubernetesé›†ç¾¤ï¼›\n* è¦æ±‚èµ„æºéš”ç¦»ã€‚\n\nå®ç°æ–¹æ¡ˆï¼š\n\n* å°†è¦éš”ç¦»çš„è®¡ç®—èŠ‚ç‚¹æ‰“ä¸ŠTaintsï¼›\n* åœ¨ç”¨æˆ·åˆ›å»ºåˆ›å»º Pod æ—¶ï¼Œå®šä¹‰ tolerationsæ¥æŒ‡å®šè¦è°ƒåº¦åˆ° node taintsã€‚\n\n**è¯¥æ–¹æ¡ˆæœ‰æ¼æ´å—?å¦‚ä½•å µä½?**\n\n* å…¶ä»–ç”¨æˆ·å¦‚æœå¯ä»¥get nodes æˆ–è€… podsï¼Œå¯ä»¥çœ‹åˆ°taintsä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ç”¨ç›¸åŒçš„tolerationså ç”¨èµ„æºã€‚\n* ä¸è®©ç”¨æˆ·get node detailï¼Ÿ\n* ä¸è®©ç”¨æˆ·getåˆ«äººçš„pod detailï¼Ÿ\n* ä¼ä¸šå†…éƒ¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è§„èŒƒç®¡ç†ï¼Œé€šè¿‡ç»Ÿè®¡æ•°æ®çœ‹è°å ç”¨äº†å“ªäº›nodeï¼›\n* æ•°æ®å¹³é¢ä¸Šçš„éš”ç¦»è¿˜éœ€è¦å…¶ä»–æ–¹æ¡ˆé…åˆã€‚\n\n## ä¼˜å…ˆçº§è°ƒåº¦\n\nä»v1.8å¼€å§‹ï¼Œkube-scheduleræ”¯æŒå®šä¹‰Pod çš„ä¼˜å…ˆçº§ï¼Œä»è€Œä¿è¯é«˜ä¼˜å…ˆçº§çš„ Pod ä¼˜å…ˆè°ƒåº¦ã€‚å¼€å¯æ–¹æ³•ä¸ºï¼š\n\n* apiserver é…ç½® `--feature-gates=PodPriority=true` å’Œ `--runtime\u0002config=scheduling.k8s.io/v1alpha1=true`\n* kube-Scheduler é…ç½® `--feature-gates=PodPriority=true`\n\n### PriorityClass\n\nåœ¨æŒ‡å®š Pod çš„ä¼˜å…ˆçº§ä¹‹å‰éœ€è¦å…ˆå®šä¹‰ä¸€ä¸ªPriorityClassï¼ˆénamespaceèµ„æºï¼‰ï¼Œå¦‚ï¼šã€\n\n```yaml\npiVersion: v1\nkind: PriorityClass\nmetadata:\n  name: high-priority\nvalue: 1000000\nglobalDefault: false\ndescription: \"This priority class should be used for XYZ service pods only.\"\n```\n\n### ä¸º pod è®¾ç½® priority\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\nlabels:\n  env: test\nspec:\n  containers:\n  - name: nginx\n    image: nginx\n    imagePullPolicy: IfNotPresent\npriorityClassName: high-priority\n```\n\n### å¤šè°ƒåº¦å™¨\n\nå¦‚æœé»˜è®¤çš„è°ƒåº¦å™¨ä¸æ»¡è¶³è¦æ±‚ï¼Œè¿˜å¯ä»¥éƒ¨ç½²è‡ªå®šä¹‰çš„è°ƒåº¦å™¨ã€‚å¹¶ä¸”ï¼Œåœ¨æ•´ä¸ªé›†ç¾¤ä¸­è¿˜å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªè°ƒåº¦å™¨å®ä¾‹ï¼Œé€šè¿‡ podSpec.schedulerName æ¥é€‰æ‹©ä½¿ç”¨å“ªä¸€ä¸ªè°ƒåº¦å™¨ï¼ˆé»˜è®¤ä½¿ç”¨å†…ç½®çš„è°ƒåº¦å™¨ï¼‰ã€‚\n\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95":{"title":"è¿œç¨‹è°ƒè¯•","content":"\n\u003e åŸç†ï¼šhttps://learn.microsoft.com/zh-cn/visualstudio/bridge/overview-bridge-to-kubernetes\n\n\u003e æ•™ç¨‹ï¼šhttps://learn.microsoft.com/zh-cn/visualstudio/bridge/bridge-to-kubernetes-vs-code\n\n\u003e ç¤ºä¾‹ï¼šhttps://learn.microsoft.com/zh-cn/visualstudio/bridge/bridge-to-kubernetes-sample\n\n## å®‰è£…\n\n1. å®‰è£…vscode\n2. å®‰è£…vscodeæ‰©å±•Kuberneteså’ŒBridge to Kubernetes\n3. å®‰è£…goæ‰©å±•\n\n## é…ç½®\n\n1. æ‰“å¼€é¡¹ç›®\n2. é€‰æ‹©kubernetes namespace\n3. æ‰“å¼€å‘½ä»¤é¢æ¿ï¼Œè¿è¡Œå‘½ä»¤â€œBridge to Kubernetes: é…ç½®â€\n4. é€‰æ‹©éœ€è¦é‡å®šå‘åˆ°æœ¬åœ°çš„æœåŠ¡\n5. è¾“å…¥æœ¬åœ°è¿è¡Œçš„ç¨‹åºçš„ç«¯å£å·\n6. é€‰æ‹©æˆ–åˆ›å»ºè°ƒè¯•çš„å¯åŠ¨é…ç½®ï¼ˆä¸æœ¬åœ°å¼€å‘çš„é…ç½®ç›¸åŒï¼‰\n7. é€‰æ‹©åœ¨éš”ç¦»æˆ–ééš”ç¦»æ¨¡å¼ä¸‹è¿è¡Œï¼Œéš”ç¦»æ¨¡å¼éœ€è¦è½¬å‘header kubernetes-route-as\n8. åœ¨è°ƒè¯•ä¸­é€‰æ‹©åˆšæ‰åˆ›å»ºçš„é…ç½®å¯åŠ¨\n\n## é™åˆ¶\n\n- è¦ä½¿ Bridge to Kubernetes æˆåŠŸè¿æ¥ï¼Œä¸€ä¸ª pod åªèƒ½æœ‰ä¸€ä¸ªå®¹å™¨åœ¨è¯¥ pod ä¸­è¿è¡Œã€‚\n- ç›®å‰ï¼ŒBridge to Kubernetes pod å¿…é¡»æ˜¯ Linux å®¹å™¨ã€‚ ä¸æ”¯æŒ Windows å®¹å™¨ã€‚\n- Bridge to Kubernetes éœ€è¦æå‡çš„æƒé™æ‰èƒ½åœ¨å¼€å‘è®¡ç®—æœºä¸Šè¿è¡Œï¼Œä»¥ä¾¿ç¼–è¾‘ä¸»æœºæ–‡ä»¶ã€‚\n- Bridge to Kubernetes ä¸èƒ½ç”¨äºå·²å¯ç”¨ Azure Dev Spaces çš„ç¾¤é›†ã€‚\n\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/%E9%83%A8%E7%BD%B2KubeSphere":{"title":"éƒ¨ç½²KubeSphere","content":"\n# å®‰è£…KubeSphere\n\n## ç›´æ¥åœ¨k8sä¸­å®‰è£…\n\n```sh\nkubectl apply -f https://github.com/kubesphere/ks-installer/releases/download/v3.3.0/kubesphere-installer.yaml\n  \nkubectl apply -f https://github.com/kubesphere/ks-installer/releases/download/v3.3.0/cluster-configuration.yaml\n```\n\n## æ£€æŸ¥å®‰è£…æ—¥å¿—\n\n`kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l 'app in (ks-install, ks-installer)' -o jsonpath='{.items[0].metadata.name}') -f`\n\n# è®¿é—® KubeSphere æ§åˆ¶å°\n\næ‰§è¡Œ `kubectl edit ks-console` å°† service ç±»å‹ `NodePort` Â æ›´æ”¹ä¸º `LoadBalancer`\n\næ‰§è¡Œ `kubectl get svc -n kubesphere-system` è·å– EXTERNAL-IP\n\nä½¿ç”¨é»˜è®¤å¸æˆ·å’Œå¯†ç ï¼ˆ `admin/P@88w0rd` ï¼‰ç™»å½•æ§åˆ¶å°\n\n# åˆ é™¤è‡ªå¸¦çš„prometheus\n\n## å®˜æ–¹æ•™ç¨‹\n\n### å¸è½½å †æ ˆ\n\n```sh\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/alertmanager/ 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/devops/ 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/etcd/ 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/grafana/ 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/kube-state-metrics/ 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/node-exporter/ 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/upgrade/ 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/prometheus-rules-v1.16\\+.yaml 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/prometheus-rules.yaml 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/prometheus 2\u003e/dev/null\n# Uncomment this line if you don't have Prometheus managed by Prometheus Operator in other namespaces.\n\nkubectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/init/ 2\u003e/dev/null\n```\n\n### åˆ é™¤PVC\n\n```sh\nkubectl -n kubesphere-monitoring-system delete pvc `kubectl -n kubesphere-monitoring-system get pvc | grep -v VOLUME | awk '{print $1}' |  tr '\\n' ' '`\n```\n\n## ç½‘å‹æ•™ç¨‹\n\n```sh\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/alertmanager/ 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/devops/ 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/etcd/ 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/grafana/ 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/kube-state-metrics/ 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/node-exporter/ 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/upgrade/ 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/prometheus-rules-v1.16\\+.yaml 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/prometheus-rules.yaml 2\u003e/dev/null\n\nbectl -n kubesphere-system exec $(kubectl get pod -n kubesphere-system -l app=ks-installer -o jsonpath='{.items[0].metadata.name}') -- kubectl delete -f /kubesphere/kubesphere/prometheus/prometheus 2\u003e/dev/null\nkubectl delete deploy -n  kubesphere-monitoring-system prometheus-operator\nkubectl delete svc -n kubesphere-monitoring-system prometheus-operator\nkubectl delete prometheusrules.monitoring.coreos.com -n kubesphere-monitoring-system  prometheus-operator-rules  prometheus-k8s-rules\nkubectl delete servicemonitor -n kubesphere-monitoring-system coredns kube-apiserver  kube-controller-manager  kube-scheduler kubelet prometheus-operator\n```\n\n# é…ç½®KubeSphere\n\n## é…ç½® `monitoring endpoint`\n\n```sh\nkubectl edit cm -n kubesphere-system kubesphere-config      #é›†ç¾¤é‡å¯åä¼šå¤±æ•ˆ\n \n    monitoring:\n      endpoint: http://prometheus-operated.monitoring.svc:9090\n  \nkubectl edit cc -n kubesphere-system ks-installer          #é›†ç¾¤é‡å¯åä¸ä¼šå¤±æ•ˆ\n    monitoring:\n      endpoint: http://prometheus-operated.monitoring.svc:9090\n      \n# æœæ‚¨å¯ç”¨äº† KubeSphere çš„å‘Šè­¦ç»„ä»¶ï¼Œè¯·æœç´¢ alerting çš„ prometheusEndpoint å’Œ thanosRulerEndpointï¼Œå¹¶å‚ç…§å¦‚ä¸‹ç¤ºä¾‹ä¿®æ”¹ã€‚KubeSphere Apiserver å°†è‡ªåŠ¨é‡å¯ä½¿è®¾ç½®ç”Ÿæ•ˆã€‚\n...\n   alerting:\n     ...\n     prometheusEndpoint: http://prometheus-operated.monitoring.svc:9090\n     thanosRulerEndpoint: http://thanos-ruler-operated.monitoring.svc:10902\n     ...\n...\n```\n\n## ä¿®å¤dashboardçš„å›¾è¡¨\n\n```sh\n# ä¸‹è½½kubernetes-prometheusRule.yamlï¼Œæ­¤ä¸apiserveræŒ‡æ ‡æœ‰å…³\nwget https://raw.githubusercontent.com/kubesphere/ks-installer/master/roles/ks-monitor/files/prometheus/kubernetes/kubernetes-prometheusRule.yaml\n  \n# åº”ç”¨kubernetes-prometheusRule.yaml\nkubectl apply -f kubernetes-prometheusRule.yaml\n  \n# kube-prometheus-stack-node.rulesä¼šä¸kubernetes-prometheusRule.yamlä¸­çš„â€™node_namespace_pod:kube_pod_info:'å’Œnode:node_num_cpu:sumå†²çªã€‚\nkubectl edit prometheusrules.monitoring.coreos.com -n monitoring kube-prometheus-stack-node.rules\n# åˆ é™¤ä»¥ä¸‹å†…å®¹\n\nexpr: |-\n        topk by(cluster, namespace, pod) (1,\n          max by (cluster, node, namespace, pod) (\n            label_replace(kube_pod_info{job=\"kube-state-metrics\",node!=\"\"}, \"pod\", \"$1\", \"pod\", \"(.*)\")\n        ))\n      record: 'node_namespace_pod:kube_pod_info:'\n\nexpr: |-\n        count by (cluster, node) (sum by (node, cpu) (\n          node_cpu_seconds_total{job=\"node-exporter\"}\n        * on (namespace, pod) group_left(node)\n          topk by(namespace, pod) (1, node_namespace_pod:kube_pod_info:)\n        ))\n      record: node:node_num_cpu:sum\n```\n\n## é‡å¯ KubeSphere APIserver\n\n```sh\nkubectl -n kubesphere-system rollout restart deployment/ks-apiserver\n# æˆ–è€…\nkubectl rollout restart deploy -n kubesphere-system ks-installer\n```\n\n# å®Œå…¨åˆ é™¤KubeSphere\n\nä½¿ç”¨è„šæœ¬[kubesphere-delete.sh](https://github.com/kubesphere/ks-installer/blob/release-3.1/scripts/kubesphere-delete.sh)\n\n# å‚è€ƒæ–‡ç« \n\n1. [kubesphereé›†æˆè‡ªæœ‰çš„kube-prometheus-stack](https://blog.csdn.net/u010533742/article/details/125554002)\n2. [é›†æˆæ‚¨è‡ªå·±çš„ Prometheus](https://kubesphere.io/zh/docs/v3.3/faq/observability/byop/)\n\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/%E9%9B%86%E7%BE%A4%E8%81%94%E9%82%A6%E5%92%8CIstio%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86":{"title":"é›†ç¾¤è”é‚¦å’ŒIstioå¤šé›†ç¾¤ç®¡ç†","content":"\n# é›†ç¾¤æ²»ç†çš„é©±åŠ¨åŠ›\n\n## åˆ†å¸ƒå¼äº‘æ˜¯æœªæ¥\n\n- **æˆæœ¬ä¼˜åŒ–**ï¼ˆCost Effectiveï¼‰\n- æ›´å¥½çš„å¼¹æ€§åŠçµæ´»æ€§ï¼ˆ**Elasticity\u0026Flexibility**ï¼‰\n- **é¿å…å‚å•†é”å®š**ï¼ˆAvoid Vendor Lock-inï¼‰\n- ç¬¬ä¸€æ—¶é—´è·å–äº‘ä¸Šçš„æ–°åŠŸèƒ½ï¼ˆ**Innovation**ï¼‰\n- **å®¹ç¾**ï¼ˆResilience \u0026Recoveryï¼‰\n- æ•°æ®ä¿æŠ¤åŠé£é™©ç®¡ç†ï¼ˆ**Data Protection\u0026Risk Management**ï¼‰\n- **æå‡å“åº”é€Ÿåº¦**ï¼ˆNetworkPerformance Improvementsï¼‰\n\n## åˆ†å¸ƒå¼äº‘çš„æŒ‘æˆ˜\n\n- Kuberneteså•é›†ç¾¤æ‰¿è½½èƒ½åŠ›æœ‰é™\n- å¼‚æ„çš„åŸºç¡€è®¾æ–½\n- å­˜é‡èµ„æºæ¥å…¥\n- é…ç½®å˜æ›´åŠä¸‹å‘\n- è·¨åœ°åŸŸã€è·¨æœºæˆ¿åº”ç”¨éƒ¨ç½²åŠç®¡ç†\n- å®¹ç¾ä¸éš”ç¦»æ€§ï¼Œå¼‚åœ°å¤šæ´»\n- å¼¹æ€§è°ƒåº¦åŠè‡ªåŠ¨ä¼¸ç¼©\n- ç›‘æ§å‘Šè­¦\n\n## å¦‚ä½•åº”å¯¹\n\n- é€šè¿‡Kubernetes å±è”½åº•å±‚åŸºç¡€è®¾æ–½ï¼Œæä¾›ç»Ÿä¸€çš„æ¥å…¥å±‚\n- å¤šäº‘æ¶æ„\n- å¤šé›†ç¾¤+å¤šäº‘\n- å¤šé›†ç¾¤ç®¡æ§\n- ç»Ÿä¸€çš„ç®¡æ§é¢\n- æ–¹ä¾¿æ¥å…¥ï¼Œé™ä½ä½¿ç”¨é—¨æ§›\n\n## è·¨åœ°åŸŸçš„é›†ç¾¤ç®¡ç†\n\n![image.png](Extras/Images/image_1667318499437_0.png)\n\n## é›†ç¾¤è”é‚¦\n\n### é›†ç¾¤è”é‚¦çš„å¿…è¦æ€§\n\n#### å•ä¸€é›†ç¾¤çš„ç®¡ç†è§„æ¨¡æœ‰ä¸Šé™\n\n**æ•°æ®åº“å­˜å‚¨**\n\netcd ä½œä¸º Kubernetesé›†ç¾¤çš„åç«¯å­˜å‚¨æ•°æ®åº“ï¼Œå¯¹ç©ºé—´å¤§å°çš„è¦æ±‚æ¯”è¾ƒè‹›åˆ»ï¼Œè¿™é™åˆ¶äº†é›†ç¾¤èƒ½å­˜å‚¨çš„å¯¹è±¡æ•°é‡å’Œå¤§å°ã€‚\n\n**å†…å­˜å ç”¨**\n\nä¸ºæé«˜ç³»ç»Ÿæ•ˆç‡ï¼ŒKubernetes çš„ API Server ä½œä¸º APIç½‘å…³ï¼Œä¼šå¯¹è¯¥é›†ç¾¤çš„æ‰€æœ‰å¯¹è±¡åšç¼“å­˜ã€‚é›†ç¾¤è¶Šå¤§ï¼Œç¼“å­˜éœ€è¦çš„å†…å­˜ç©ºé—´å°±è¶Šå¤§ã€‚\n\nå…¶ä»–Kubernetes æ§åˆ¶å™¨ä¹Ÿéœ€è¦å¯¹ä¾¦å¬çš„å¯¹è±¡æ„å»ºå®¢æˆ·ç«¯ç¼“å­˜ï¼Œè¿™äº›éƒ½éœ€è¦å ç”¨ç³»ç»Ÿå†…å­˜ã€‚è¿™äº›å†…å­˜éœ€æ±‚éƒ½è¦æ±‚å¯¹ç³»ç»Ÿçš„è§„æ¨¡æœ‰æ‰€é™åˆ¶ã€‚\n\n**æ§åˆ¶å™¨å¤æ‚åº¦**\n\nKubernetes çš„ä¸€ä¸ªä¸šåŠ¡æµç¨‹æ˜¯ç”±å¤šä¸ªå¯¹è±¡å’Œæ§åˆ¶å™¨è”åŠ¨å®Œæˆçš„ï¼Œå³ä½¿æ§åˆ¶å™¨éµå¾ªäº†è®¾è®¡åŸåˆ™ï¼Œéšç€å¯¹è±¡æ•°é‡çš„å¢é•¿ï¼Œæ§åˆ¶å™¨çš„å¤„ç†è€—æ—¶ä¹Ÿä¼šè¶Šæ¥è¶Šé•¿ã€‚\n\n#### å•ä¸ªè®¡ç®—èŠ‚ç‚¹èµ„æºä¸Šé™\n\nå•ä¸ªè®¡ç®—èŠ‚ç‚¹çš„èµ„æºï¼Œä¸ä»…ä»…æ˜¯CPUã€å†…å­˜ç­‰å¯é‡åŒ–èµ„æºã€‚\n\nè¿˜æœ‰ç«¯å£ã€è¿›ç¨‹æ•°é‡ç­‰ä¸å¯é‡åŒ–èµ„æºã€‚æ¯”å¦‚ Linuxæ”¯æŒçš„ TCPç«¯å£ä¸Šé™æ˜¯65535ï¼Œå»é™¤å¸¸ç”¨ç«¯å£å’Œç¨‹åºæºç«¯å£åï¼Œç•™ç»™ Service nodePort çš„ç«¯å£æ•°é‡æ˜¯æœ‰é™çš„ï¼Œè¿™é™åˆ¶äº†é›†ç¾¤æ”¯æŒçš„ Service çš„æ•°é‡ã€‚\n\n#### æ•…éšœåŸŸæ§åˆ¶\n\né›†ç¾¤è§„æ¨¡è¶Šå¤§ï¼Œæ§åˆ¶å¹³é¢ç»„ä»¶å‡ºç°æ•…éšœæ—¶çš„å½±å“èŒƒå›´å°±è¶Šå¤§ã€‚ä¸ºäº†æ›´å¥½åœ°æ§åˆ¶æ•…éšœåŸŸï¼ˆFaultDomainï¼‰ï¼Œéœ€è¦å°†å¤§è§„æ¨¡çš„æ•°æ®ä¸­å¿ƒåˆ‡åˆ†æˆå¤šä¸ªè§„æ¨¡ç›¸å¯¹è¾ƒå°çš„é›†ç¾¤ï¼Œæ¯ä¸ªé›†ç¾¤æ§åˆ¶åœ¨ä¸€å®šè§„æ¨¡ã€‚\n\n#### åº”ç”¨é«˜å¯ç”¨éƒ¨ç½²\n\nç”Ÿäº§åº”ç”¨é€šå¸¸éœ€è¦å¤šæ•°æ®ä¸­å¿ƒéƒ¨ç½²æ¥ä¿éšœè·¨åœ°åŸŸé«˜å¯ç”¨ï¼Œä»¥ç¡®ä¿å½“å…¶ä¸­ä¸€ä¸ªæ•°æ®ä¸­å¿ƒå‡ºç°æ•…éšœï¼Œæˆ–è€…é›†ç¾¤åšæŠ€æœ¯è¿­ä»£æ›´æ–°æ—¶ï¼Œå…¶ä»–æ•°æ®ä¸­å¿ƒå¯ä»¥ç»§ç»­æä¾›æœåŠ¡ã€‚\n\n#### æ··åˆäº‘\n\nç§æœ‰äº‘åŠ å…¬æœ‰äº‘çš„æ··åˆäº‘æ¨¡å¼é€æ¸æˆä¸ºä¼ä¸šçš„ä¸»æµæ¶æ„ã€‚\n\n## é›†ç¾¤è”é‚¦çš„èŒè´£\n\n- è·¨é›†ç¾¤åŒæ­¥èµ„æº\n\t- è”é‚¦å¯ä»¥å°†èµ„æºåŒæ­¥åˆ°å¤šä¸ªé›†ç¾¤å¹¶åè°ƒèµ„æºçš„åˆ†é…ã€‚ä¾‹å¦‚ï¼Œè”é‚¦å¯ä»¥ä¿è¯ä¸€ä¸ªåº”ç”¨çš„ Deployment è¢«éƒ¨ç½²åˆ°å¤šä¸ªé›†ç¾¤ä¸­ï¼ŒåŒæ—¶èƒ½å¤Ÿæ»¡è¶³å…¨å±€çš„è°ƒåº¦ç­–ç•¥ã€‚\n- è·¨é›†ç¾¤æœåŠ¡å‘ç°\n\t- è”é‚¦æ±‡æ€»å„ä¸ªé›†ç¾¤çš„æœåŠ¡å’Œ Ingressï¼Œå¹¶æš´éœ²åˆ°å…¨å±€ DNS æœåŠ¡ä¸­ã€‚\n- é«˜å¯ç”¨\n\t- è”é‚¦å¯ä»¥åŠ¨æ€åœ°è°ƒæ•´æ¯ä¸ªé›†ç¾¤çš„åº”ç”¨å®ä¾‹ï¼Œä¸”éšè—äº†å…·ä½“çš„é›†ç¾¤ä¿¡æ¯ã€‚\n- é¿å…å‚å•†é”å®š\n\t- æ¯ä¸ªé›†ç¾¤éƒ½æ˜¯éƒ¨ç½²åœ¨çœŸå®çš„ç¡¬ä»¶æˆ–äº‘ä¾›åº”å•†æä¾›çš„ç¡¬ä»¶ï¼ˆæˆ–è™šæ‹Ÿç¡¬ä»¶ï¼‰ä¹‹ä¸Šçš„ï¼Œè‹¥è¦æ›´æ¢ä¾›åº”å•†ï¼Œåªéœ€åœ¨æ–°ä¾›åº”å•†æä¾›çš„ç¡¬ä»¶ä¸Šéƒ¨ç½²æ–°çš„é›†ç¾¤ï¼Œå¹¶åŠ å…¥è”é‚¦ã€‚è”é‚¦å¯ä»¥å‡ ä¹é€æ˜åœ°å°†åº”ç”¨ä»åŸé›†ç¾¤è¿ç§»åˆ°æ–°é›†ç¾¤è€Œæ— é¡»å¯¹åº”ç”¨åšæ›´æ”¹ã€‚\n\n## æ··åˆäº‘\n\n- **æ··åˆäº‘æ˜¯æŒ‡å°†å…¬æœ‰äº‘å’Œç§æœ‰äº‘æ•´åˆåœ¨ä¸€èµ·çš„ç»Ÿä¸€äº‘å¹³å°ã€‚**\n- ç”¨æˆ·ä¸šåŠ¡å¯çµæ´»éƒ¨ç½²æˆ–æ‰©å®¹åœ¨ä¸åŒäº‘ä¸­ã€‚\n- æ··åˆäº‘é¿å…å‚å•†é”å®šã€‚\n- æ··åˆäº‘å¯æ”¯æŒæ›´å¤šå¤æ‚ä¸šåŠ¡åœºæ™¯âˆ¶\n\t- Cloud Burstã€‚\n\t- å¦‚12306ï¼Œä½æµé‡æ—¶è¿è¡Œåœ¨æœ¬åœ°æ•°æ®ä¸­å¿ƒï¼Œå½“è¯·æ±‚é‡çªç„¶çˆ†å‘çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥åœ¨å…¬æœ‰äº‘æ‰©å®¹ï¼ŒèŠ‚çœæ•°æ®ä¸­å¿ƒæˆæœ¬ã€‚\n\t- å¯å°†ä¸šåŠ¡åˆ†ä¸ºåŒ…å«æ•æ„Ÿæ•°æ®å’Œä¸åŒ…å«æ•æ„Ÿæ•°æ®çš„ä¸šåŠ¡ï¼Œå°†æ•æ„Ÿæ•°æ®ä¸šåŠ¡è¿è¡Œåœ¨ç§æœ‰äº‘ï¼Œå°†éæ•æ„Ÿæ•°æ®ä¸šåŠ¡è¿è¡Œåœ¨å…¬æœ‰äº‘ã€‚\n\t- å¯é‡å¤åˆ©ç”¨å…¬æœ‰äº‘æä¾›å•†æ•°æ®ä¸­å¿ƒé è¿‘è¾¹ç¼˜çš„èƒ½åŠ›ã€‚\n\n## é›†ç¾¤è”é‚¦\n\n**é›†ç¾¤è”é‚¦ï¼ˆFederationï¼‰æ˜¯å°†å¤šä¸ªKubernetes é›†ç¾¤æ³¨å†Œåˆ°ç»Ÿä¸€æ§åˆ¶å¹³é¢ï¼Œä¸ºç”¨æˆ·æä¾›ç»Ÿä¸€APIå…¥å£çš„å¤šé›†ç¾¤è§£å†³æ–¹æ¡ˆã€‚**\n\né›†ç¾¤è”é‚¦è®¾è®¡çš„æ ¸å¿ƒæ˜¯æä¾›åœ¨å…¨å±€å±‚é¢å¯¹åº”ç”¨çš„æè¿°èƒ½åŠ›ï¼Œå¹¶å°†è”é‚¦å¯¹è±¡å®ä¾‹åŒ–ä¸º Kubernetes å¯¹è±¡ï¼Œåˆ†å‘åˆ°è”é‚¦ä¸‹è¾–çš„å„ä¸ªæˆå‘˜é›†ç¾¤ä¸­ã€‚\n\n![image.png](Extras/Images/image_1667319263814_0.png)\n\n## åŸºäºé›†ç¾¤è”é‚¦çš„é«˜å¯ç”¨åº”ç”¨éƒ¨ç½²\n\n![image.png](Extras/Images/image_1667319487098_0.png)\n\n## é›†ç¾¤è”é‚¦æ ¸å¿ƒæ¶æ„\n\netcdä½œä¸ºåˆ†å¸ƒå¼å­˜å‚¨åç«¯å­˜å‚¨æ‰€æœ‰å¯¹è±¡ï¼›\n\nAPIServerä½œä¸ºAPIç½‘å…³ï¼Œæ¥æ”¶æ‰€æœ‰æ¥è‡ªç”¨æˆ·åŠæ§åˆ¶å¹³é¢ç»„ä»¶çš„è¯·æ±‚ï¼›\n\nä¸åŒçš„æ§åˆ¶å™¨å¯¹è”é‚¦å±‚é¢çš„å¯¹è±¡è¿›è¡Œç®¡ç†ã€åè°ƒç­‰ï¼›\n\nè°ƒåº¦æ§åˆ¶å™¨åœ¨è”é‚¦å±‚é¢å¯¹åº”ç”¨è¿›è¡Œè°ƒåº¦ã€åˆ†é…ã€‚\n\n**é›†ç¾¤è”é‚¦æ”¯æŒçµæ´»çš„å¯¹è±¡æ‰©å±•ï¼Œå…è®¸å°†åŸºæœ¬Kuberneteså¯¹è±¡æ‰©å±•ä¸ºé›†ç¾¤è”é‚¦å¯¹è±¡ï¼Œå¹¶é€šè¿‡ç»Ÿä¸€çš„è”é‚¦æ§åˆ¶å™¨æ¨é€å’Œæ”¶é›†çŠ¶æ€ã€‚**\n\n![image.png](Extras/Images/image_1667322401735_0.png)\n\n## é›†ç¾¤è”é‚¦ç®¡ç†çš„å¯¹è±¡\n\n**æˆå‘˜é›†ç¾¤æ˜¯è”é‚¦çš„åŸºæœ¬ç®¡ç†å•å…ƒï¼Œæ‰€æœ‰å¾…ç®¡ç†é›†ç¾¤å‡é¡»æ³¨å†Œåˆ°é›†ç¾¤è”é‚¦ã€‚**\n\né›†ç¾¤è”é‚¦V2æä¾›äº†ç»Ÿä¸€çš„å·¥å…·é›†ï¼ˆKubefedctï¼‰ï¼Œå…è®¸ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡åŠ¨æ€åœ°åˆ›å»ºè”é‚¦å¯¹è±¡.ã€‚\nåŠ¨æ€å¯¹è±¡çš„ç”ŸæˆåŸºäºCRDã€‚\n\n![image.png](Extras/Images/image_1667322442338_0.png)\n\n## é›†ç¾¤æ³¨å†Œä¸­å¿ƒ\n\n**é›†ç¾¤æ³¨å†Œä¸­å¿ƒï¼ˆClusterRegistryï¼‰æä¾›äº†æ‰€æœ‰è”é‚¦ä¸‹è¾–çš„é›†ç¾¤æ¸…å•ï¼Œä»¥åŠæ¯ä¸ªé›†ç¾¤çš„è®¤è¯ä¿¡æ¯ï¼ŒçŠ¶æ€ä¿¡æ¯ç­‰ã€‚**\n\né›†ç¾¤è”é‚¦æœ¬èº«ä¸æä¾›ç®—åŠ›ï¼Œå®ƒåªæ‰¿æ‹…å¤šé›†ç¾¤çš„åè°ƒå·¥ä½œï¼Œæ‰€æœ‰è¢«ç®¡ç†çš„é›†ç¾¤éƒ½åº”æ³¨å†Œåˆ°é›†ç¾¤è”é‚¦ä¸­ã€‚\n\né›†ç¾¤è”é‚¦ä½¿ç”¨äº†å•ç‹¬çš„KubeFedCluster å¯¹è±¡ï¼ˆåŒæ ·é€‚ç”¨CRDæ¥å®šä¹‰ï¼‰æ¥ç®¡ç†é›†ç¾¤æ³¨å†Œä¿¡æ¯ï¼š\n\n- åœ¨è¯¥å¯¹è±¡çš„å®šä¹‰ä¸­ï¼Œä¸ä»…åŒ…å«é›†ç¾¤çš„æ³¨å†Œä¿¡æ¯ï¼Œè¿˜åŒ…å«é›†ç¾¤çš„è®¤è¯ä¿¡æ¯çš„å¼•ç”¨ï¼Œä»¥æ˜ç¡®æ¯ä¸ªé›†ç¾¤ä½¿ç”¨çš„è®¤è¯ä¿¡æ¯ï¼›\n- è¯¥å¯¹è±¡è¿˜åŒ…å«å„ä¸ªé›†ç¾¤çš„å¥åº·çŠ¶æ€ã€åŸŸåç­‰ï¼›\n- å½“æ§åˆ¶å™¨è¡Œä¸ºå‡ºç°å¼‚å¸¸æ—¶ï¼Œç›´æ¥é€šè¿‡é›†ç¾¤çŠ¶æ€ä¿¡æ¯å³å¯è·çŸ¥æ§åˆ¶å™¨å¼‚å¸¸çš„åŸå› ã€‚\n\n## é›†ç¾¤ç±»å‹\n\n**Hostï¼š**\n\nç”¨äºæä¾›KubeFed APIä¸æ§åˆ¶å¹³é¢çš„é›†ç¾¤ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ Federationæ§åˆ¶é¢ã€‚\n\n**Memberï¼š**\n\né€šè¿‡ KubeFed APIæ³¨å†Œçš„é›†ç¾¤ï¼Œå¹¶æä¾›ç›¸å…³èº«ä»½å‡­è¯æ¥è®©KubeFed Controller èƒ½å¤Ÿå­˜å–é›†ç¾¤ã€‚Hosté›†ç¾¤ä¹Ÿå¯ä»¥ä½œä¸ºMember è¢«åŠ å…¥ã€‚\n\n## æ³¨å†Œé›†ç¾¤KubeFedCluster\n\nç”¨æ¥å®šä¹‰å“ªäº›Kubernetesé›†ç¾¤è¦è¢«è”é‚¦ã€‚\n\nå¯é€è¿‡**kubefedctl join/unjoin** æ¥åŠ å…¥/åˆ é™¤é›†ç¾¤ï¼Œå½“æˆåŠŸåŠ å…¥æ—¶ï¼Œä¼šå»ºç«‹ä¸€ä¸ªKubeFedClusterç»„ä»¶æ¥å‚¨å­˜é›†ç¾¤ç›¸å…³ä¿¡æ¯ï¼Œå¦‚**APIEndpointã€CA Bundle**ç­‰ã€‚\n\nè¿™äº›ä¿¡æ¯ä¼šè¢«ç”¨åœ¨**KubeFed Controller**å­˜å–ä¸åŒKubernetes é›†ç¾¤ä¸Šï¼Œä»¥ç¡®ä¿èƒ½å¤Ÿå»ºç«‹KubernetesAPIèµ„æºã€‚\n\n![image.png](Extras/Images/image_1667323372563_0.png)\n\n## KubeFedCluster\n\n```yaml\napiVersion: core.kubefed.io/v1beta1\nkind: KubeFedCluster\nmetadata:\n  name: \"cluster1\"\nspec:\n  apiEndpoint: https://API Server.cluster1.example.com\n  caBundle: LSOtLS***LSOK\n  disabledTLSValidations:\n  - â€˜*â€™\n  secretRef:\n    name: cluster1-vhvfw\nstatus:\n  conditions:\n  - reason: ClusterReady\n    type: Ready\n  region: China\n  zones:\n  - Shanghai\n```\n\n![image.png](Extras/Images/image_1667323641894_0.png)\n\n## Federation æ”¯æŒçš„æ ¸å¿ƒå¯¹è±¡\n\n![image.png](Extras/Images/image_1667323667635_0.png)\n\n## Type Configuration\n\nå®šä¹‰äº†å“ªäº›Kubernetes APIèµ„æºè¦è¢«ç”¨äºè”é‚¦ç®¡ç†ã€‚\n\nè‹¥æƒ³æ–°å¢ Federated APIçš„è¯ï¼Œå¯é€šè¿‡`kubefedctlenable \u003cres\u003e`æŒ‡ä»¤æ¥å»ºç«‹ã€‚\n\næ¯”å¦‚è¯´æƒ³å°†ConfigMap èµ„æºé€šè¿‡è”é‚¦æœºåˆ¶å»ºç«‹åœ¨ä¸åŒé›†ç¾¤ä¸Šæ—¶ï¼Œå°±å¿…é¡»å…ˆåœ¨ **Federation Host**é›†ç¾¤ä¸­ï¼Œé€šè¿‡CRDå»ºç«‹æ–°èµ„æº **FederatedConfigMap**ï¼Œæ¥ç€å†å»ºç«‹åç§°ä¸ºconfigmaps çš„ Type configurationï¼ˆ**FederatedTypeConfig**ï¼‰èµ„æºï¼Œç„¶åæè¿°ConfigMap è¦è¢« FederatedConfigMap æ‰€ç®¡ç†\n\nè¿™æ ·KubeFed Controllersæ‰èƒ½çŸ¥é“å¦‚ä½•å»ºç«‹ Federated èµ„æºã€‚\n\n## FederatedConfigMap\n\n```bash\nk get crd federatedconfigmaps.types.kubefed.io\nNAME                                  CREATEDAT\nfederatedconfigmaps.types.kubefed.io 2021-09-13T10:10:03Z\n```\n\n```yaml\napiVersion: core.kubefed.io/v1beta1\nkind: FederatedTypeConfig\nmetadata:\n  name: configmaps\nspec:\n  federatedType:\n    group: types.kubefed.io\n    kind: FederatedConfigMap\n    pluralName: federatedconfigmaps\n    scope: Namespaced\n    version: v1betal\n  propagation: Enabled\n  targetType:\n    kind: ConfigMap\n    pluralName: configmaps\n    scope: Namespaced\n    version: v1\n```\n\n## è”é‚¦å¯¹è±¡ç»„æˆ\n\nTemplateï¼šå®šä¹‰ Kubernetes å¯¹è±¡çš„æ¨¡æ¿ã€‚\n\nPlacementï¼šå®šä¹‰è”é‚¦å¯¹è±¡éœ€è¦è¢«åŒæ­¥çš„ç›®æ ‡é›†ç¾¤ã€‚\n\nOverridesï¼šä¸åŒç›®æ ‡é›†ç¾¤ä¸­ï¼Œå¯¹Kubernetes å¯¹è±¡æ¨¡æ¿çš„æœ¬åœ°åŒ–å±æ€§ã€‚\n\n![image.png](Extras/Images/image_1667324020820_0.png)\n\n## Template\n\n**Templateæ˜¯è”é‚¦å¯¹è±¡ä¸­å®šä¹‰Kubernetes é›†ç¾¤å¯¹è±¡çš„æ¨¡æ¿éƒ¨åˆ†ï¼Œå®ƒçš„å†…å®¹ä¸ºå®Œæ•´çš„Kuberneteså¯¹è±¡ã€‚**\n\n## Placement\n\nPlacementç”¨æ¥é…ç½®è”é‚¦å¯¹è±¡çš„ç›®æ ‡é›†ç¾¤ï¼Œå…¶å€¼å¯ä»¥æ˜¯å…·ä½“çš„é›†ç¾¤åå•ï¼Œä¹Ÿå¯ä»¥æ˜¯clusterSeletoré€‰æ‹©å¯¹åº”æ ‡ç­¾ï¼ˆlabelï¼‰çš„é›†ç¾¤ã€‚\n\nå½“ä¸¤è€…åŒæ—¶å­˜åœ¨æ—¶ï¼Œæ˜ç¡®å®šä¹‰çš„é›†ç¾¤åå•å…·æœ‰è¾ƒé«˜ä¼˜å…ˆçº§ã€‚\n\nè”é‚¦æ ¹æ®ä¼˜å…ˆçº§æ¥å®šä¹‰è¦åŒæ­¥å¯¹è±¡çš„ç›®æ ‡é›†ç¾¤ï¼Œå¦‚æœæä¾›äº†é›†ç¾¤åå•ï¼ˆå“ªæ€•æ˜¯ä¸€ä¸ªç©ºListï¼‰ï¼Œåˆ™æ— è®ºclusterSelectoræä¾›ä»€ä¹ˆå†…å®¹ï¼Œéƒ½ä¼šè¢«å¿½ç•¥ã€‚\n\n## Overrides\n\nOverrides ç”¨äºé’ˆå¯¹æ¯ä¸ªé›†ç¾¤è¿›è¡Œæœ¬åœ°åŒ–å®šåˆ¶ã€‚\n\nåœ¨å®é™…éƒ¨ç½²åº”ç”¨æ—¶ï¼Œé€šå¸¸ä¼šé€šè¿‡è°ƒæ•´ä¸åŒé›†ç¾¤ä¸­çš„é…ç½®æ¨¡æ¿ï¼Œéƒ¨ç½²ç¬¦åˆç‰¹å®šé›†ç¾¤éœ€æ±‚çš„åº”ç”¨ï¼Œä»¥æ›´å¥½åœ°å‘æŒ¥ç½‘ç»œã€è®¡ç®—èµ„æºã€å­˜å‚¨ç­‰çš„ä¼˜åŠ¿ã€‚\n\nç›®å‰ Overrides ä¸æ”¯æŒ Listï¼ˆArrayï¼‰ã€‚æ¯”å¦‚è¯´æ— æ³•ä¿®æ”¹\n\nspec.template.spec.containers\\[0\\].imageã€‚\n\næ€è€ƒä¸€ä¸‹ä¸ºä»€ä¹ˆ\n\n## ä½¿ç”¨ Federated å¯¹è±¡\n\n**å°†Namespace è®¾ç½®ä¸ºè”é‚¦å¯¹è±¡**\n\nkubefedctl federate ns default\n\n## è”é‚¦è°ƒåº¦\n\n**KubeFed**æä¾›äº†ä¸€ç§è‡ªåŠ¨åŒ–æœºåˆ¶æ¥å°†å·¥ä½œè´Ÿè½½å®ä¾‹åˆ†æ•£åˆ°ä¸åŒçš„é›†ç¾¤ä¸­ï¼Œè¿™èƒ½å¤ŸåŸºäºæ€»å‰¯æœ¬æ•°ä¸é›†ç¾¤çš„å®šä¹‰ç­–ç•¥æ¥å°†Deploymentæˆ–ReplicaSetèµ„æºè¿›è¡Œç¼–æ’ã€‚\n\nç¼–æ’ç­–ç•¥æ˜¯é€šè¿‡å»ºç«‹**ReplicaSchedulingPreference(RSP)** æ–‡ä»¶ï¼Œå†ç”±KubeFed RSP Controller ç›‘å¬ä¸æ’·å–RSPå†…å®¹æ¥å°†å·¥ä½œè´Ÿè½½å®ä¾‹å»ºç«‹åˆ°æŒ‡å®šçš„é›†ç¾¤ä¸Šã€‚\n\n![image.png](Extras/Images/image_1667324454149_0.png)\n\n## å¤šé›†ç¾¤DNS\n\n**KubeFedæä¾›äº†ä¸€ç»„ APIèµ„æºï¼Œä»¥åŠControllers æ¥å®ç°è·¨é›†ç¾¤ Service/Ingress çš„ DNS recordsè‡ªåŠ¨äº§ç”Ÿæœºåˆ¶ã€‚**\n\néœ€è¦ç»“åˆ ExternalDNSæ¥åŒæ­¥æ›´æ–°è‡³ DNSæœåŠ¡ä¾›åº”å•†ã€‚\n\nåœ¨ 2020å¹´è¢«ç§»å‡ºï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªDNSæ¥å…¥çš„æ€è·¯ã€‚\n\n## ServiceDNSRecord åŸç†\n\n![image.png](Extras/Images/image_1667324649874_0.png)\n\n# Clusternet\n\n## Clusternet ç®€ä»‹\n\n**Clusternetï¼ˆClusterInternetï¼‰æ˜¯ä¸€ä¸ªå…¼å…·å¤šé›†ç¾¤ç®¡ç†å’Œè·¨é›†ç¾¤åº”ç”¨ç¼–æ’çš„å¼€æºäº‘åŸç”Ÿç®¡æ§å¹³å°æ‰“é€šäº†è·¨VPCã€è·¨åœ°åŸŸã€è·¨äº‘çš„é›†ç¾¤ç®¡ç†ã€‚**\n\nClusterneté¢å‘æœªæ¥æ··åˆäº‘ã€åˆ†å¸ƒå¼äº‘å’Œè¾¹ç¼˜è®¡ç®—åœºæ™¯è®¾è®¡ï¼Œæ”¯æŒæµ·é‡é›†ç¾¤çš„æ¥å…¥å’Œç®¡ç†ã€‚\n\nClusternet åœ¨ä¿è¯æ— ä¾µå…¥ç›®è½»é‡åŒ–çš„åŸºç¡€ä¸Šï¼Œåˆ›å»ºäº†ä¸€å¼ é›†ç¾¤ç½‘ç»œï¼Œå¯¹å­é›†ç¾¤è¿›è¡Œçº³ç®¡ï¼Œå¹¶æ”¯æŒå¤šé›†ç¾¤çš„åº”ç”¨ç¼–æ’ä¸æ²»ç†ã€‚\n\nå¼€æºé¡¹ç›®åœ°å€ï¼šhttpsâˆ¶//github.com/clusternet/clusternet\n\n## Clusternet èƒ½åŠ›ä¸€è§ˆ\n\n- ç»Ÿä¸€ç®¡æ§å„ç±»**Kubernetes**é›†ç¾¤ï¼›\n- é›†ç¾¤ç®¡ç†**Pull/Push**æ¨¡å¼ï¼›\n- è½»é‡åŒ–ï¼Œå¼€ç®±å³ç”¨ï¼Œæ˜“äºéƒ¨ç½²å’Œç»´æŠ¤ï¼›\n- è·¨é›†ç¾¤çš„æœåŠ¡å‘ç°åŠæœåŠ¡äº’è®¿ï¼›\n- Kubernetes åŸç”Ÿï¼Œæ²¡æœ‰é¢å¤–çš„å­¦ä¹ æˆæœ¬ï¼›\n- å®Œå–„çš„**RBAC**èƒ½åŠ›ï¼Œè®¿é—®ä»»ä¸€å­é›†ç¾¤ï¼›\n- å®Œå–„çš„æ¥å…¥èƒ½åŠ›ï¼š**kubectl plugin/client-go**ï¼›\n- æ”¯æŒåˆ†å‘å„ç±»åŸç”Ÿåº”ç”¨/**CRD/HelmChart**ã€‚\n\n![image.png](Extras/Images/image_1667324958372_0.png)\n\n## å¤šé›†ç¾¤ç®¡ç†çš„æŒ‘æˆ˜\n\n- é›†ç¾¤æ— å¤„ä¸åœ¨\n- å…¬æœ‰äº‘ã€ç§æœ‰äº‘ã€æ··åˆäº‘ã€è¾¹ç¼˜ã€è£¸é‡‘å±\n- æä¾›ä¸€è‡´çš„çº³ç®¡èƒ½åŠ›\n\t- é›†ç¾¤ä¸€é”®æ³¨å†Œèƒ½åŠ›\n\t- ä¸€è‡´æ€§çš„é›†ç¾¤è®¿é—®ä½“éªŒï¼Œæ¯”å¦‚ execï¼Œlogs\n\t- æƒé™ç®¡æ§ RBAC\n- æ¶æ„è¦è¶³å¤Ÿè½»é‡åŒ–ï¼Œæ–¹ä¾¿ä¸€é”®æ¥å…¥\n\n## Clusternet æ¶æ„\n\n![image.png](Extras/Images/image_1667325210364_0.png)\n\n## Clusternet æ¶æ„\n\n- æœ€è½»é‡åŒ–çš„æ¶æ„\n- ä¸€ç«™å¼è¿æ¥å„ç±»é›†ç¾¤\n- æ”¯æŒ **Pull**å’Œ **Push** æ¨¡å¼\n- è·¨é›†ç¾¤è·¯ç”±è®¿é—®\n- æ”¯æŒå­é›†ç¾¤ **RBAC**è®¿é—®\n- æä¾›ä¸€è‡´çš„é›†ç¾¤è®¿é—®ä½“éªŒï¼Œæ¯”å¦‚ **execï¼Œlogs**\n- åŸç”Ÿ **Kubernetes API**\n- æ¥å…¥æˆæœ¬ä½ï¼Œ**kubectl plugin/client-go**\n\n## å¦‚ä½•é€šè¿‡ Clusternet è®¿é—®ä»»ä¸€å­é›†ç¾¤\n\nClusternetæ”¯æŒé€šè¿‡Bootstrap Tokenï¼ŒService Tokenï¼ŒTLSè¯ä¹¦ç­‰RBACçš„æ–¹å¼è®¿é—®å­é›†ç¾¤ï¼›\n\n**å­é›†ç¾¤çš„ credentialä¿¡æ¯ä¸éœ€è¦å­˜åœ¨çˆ¶é›†ç¾¤ä¸­**\n\nä¹Ÿæ”¯æŒé€šè¿‡kubectlå‘½ä»¤è¡Œçš„æ–¹å¼å¯¹å­é›†ç¾¤è¿›è¡Œ create/get/List/watch/patch/execç­‰æ“ä½œã€‚\n\n---\n\næ›´è¯¦ç»†æ­¥éª¤åŠåŠŸèƒ½å¯ä»¥å‚ç…§\n\nhttps://aithub.com/clusternet/clusternet/blob/main/docs/tutorials/visiting-child-clusters-with-rbac.md\n\n- ä½¿ç”¨curlè¿›è¡Œè®¿é—®\n- é€šè¿‡kubectlè¿›è¡Œè®¿é—®\n\n## Clusternet åº”ç”¨åˆ†å‘è®¾è®¡\n\n- å®Œå…¨å…¼å®¹**Kubernetes çš„å†…ç½®API**\n- æ”¯æŒ **Helm Charts**\n- æ”¯æŒ**CRD**\n- ä¸°å¯Œçµæ´»çš„åˆ†å‘ç­–ç•¥é…ç½®ã€å·®å¼‚åŒ–ç­–ç•¥\n\n## åº”ç”¨åˆ†å‘çš„å·®å¼‚åŒ–ç—›ç‚¹\n\n1. åœ¨åˆ†å‘çš„èµ„æºä¸Šå…¨éƒ¨æ‰“ä¸Šç»Ÿä¸€çš„æ ‡ç­¾ï¼Œæ¯”å¦‚ apps.my.company/deployed-byâˆ¶my-platform;\n2. åœ¨åˆ†å‘åˆ°å­é›†ç¾¤çš„èµ„æºä¸Šæ ‡è®°é›†ç¾¤çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ apps.my.company/running-inâˆ¶cluster-01;\n3. è°ƒæ•´åº”ç”¨åœ¨æ¯ä¸ªé›†ç¾¤ä¸­çš„å‰¯æœ¬æ•°ç›®ã€é•œåƒåç§°ç­‰;\n4. åœ¨åˆ†å‘åˆ°æŸé›†ç¾¤å‰ï¼Œè°ƒæ•´åº”ç”¨åœ¨è¯¥é›†ç¾¤ä¸­çš„ä¸€äº›é…ç½®ï¼Œæ¯”å¦‚æ³¨å…¥ä¸€ä¸ª Sidecar å®¹å™¨ç­‰\n5. ç°åº¦å‡çº§ï¼Œå˜æ›´å¯æ§ï¼Œæ–¹ä¾¿å›æ»š;\n6. é‡å¤å®šä¹‰æ€ä¹ˆåŠ?å†²çªå—?\n7. ...\n\n## Clusternet åº”ç”¨åˆ†å‘æ¨¡å‹\n\n![image.png](Extras/Images/image_1667326114977_0.png)\n\n# Istioå¤šé›†ç¾¤\n\n## è·¨åœ°åŸŸæµé‡ç®¡ç†çš„æŒ‘æˆ˜\n\né‡‡ç”¨å¤šæ´»æ•°æ®ä¸­å¿ƒçš„ç½‘ç»œæ‹“æ‰‘ï¼Œä»»ä½•ç”Ÿäº§åº”ç”¨éƒ½éœ€è¦å®Œæˆè·¨ä¸‰ä¸ªæ•°æ®ä¸­å¿ƒçš„éƒ¨ç½²ã€‚\n\nä¸ºæ»¡è¶³å•é›†ç¾¤çš„é«˜å¯ç”¨ï¼Œé’ˆå¯¹æ¯ä¸ªæ•°æ®ä¸­å¿ƒï¼Œä»»ä½•åº”ç”¨éƒ½éœ€è¿›è¡Œå¤šå‰¯æœ¬éƒ¨ç½²ï¼Œå¹¶é…ç½®è´Ÿè½½å‡è¡¡ã€‚\n\nä»¥å®ç°å…¨ç«™å¾®æœåŠ¡åŒ–ï¼Œä½†ä¸ºä¿è¯é«˜å¯ç”¨ï¼ŒæœåŠ¡ä¹‹é—´çš„è°ƒç”¨ä»ä»¥å—åŒ—æµé‡ä¸ºä¸»ã€‚\n\né’ˆå¯¹æ ¸å¿ƒåº”ç”¨ï¼Œé™¤é›†ç¾¤æœ¬åœ°è´Ÿè½½å‡è¡¡é…ç½®ä»¥å¤–ï¼Œè¿˜éœ€é…ç½®è·¨æ•°æ®ä¸­å¿ƒè´Ÿè½½å‡è¡¡ï¼Œå¹¶é€šè¿‡æƒé‡æ§åˆ¶å°†**99%** çš„è¯·æ±‚è½¬å…¥æœ¬åœ°æ•°æ®ä¸­å¿ƒï¼Œå°†**1%** çš„æµé‡è½¬å‘è·¨åœ°åŸŸçš„æ•°æ®ä¸­å¿ƒã€‚\n\n![image.png](Extras/Images/image_1667373822431_0.png)\n\n## è§„æ¨¡åŒ–å¸¦æ¥çš„æŒ‘æˆ˜\n\n- 3ä¸»æ•°æ®ä¸­å¿ƒï¼Œ20è¾¹ç¼˜æ•°æ®ä¸­å¿ƒï¼Œ100+Kubernetesé›†ç¾¤\n- è§„æ¨¡åŒ–è¿è¥Kubernetesé›†ç¾¤\n\t- æ€»è®¡100000ç‰©ç†èŠ‚ç‚¹\n\t- å•é›†ç¾¤ç‰©ç†æœºèŠ‚ç‚¹è§„æ¨¡é«˜è¾¾5000\n- ä¸šåŠ¡æœåŠ¡å…¨é¢å®¹å™¨åŒ–ï¼Œå•é›†ç¾¤\n\t- Podå®ä¾‹å¯è¾¾100000\n\t- å‘å¸ƒæœåŠ¡5000-10000\n- å•é›†ç¾¤å¤šç¯å¢ƒæ”¯æŒ\n\t- åŠŸèƒ½æµ‹è¯•ã€é›†æˆæµ‹è¯•ã€å‹åŠ›æµ‹è¯•å…±ç”¨å•é›†ç¾¤\n\t- ä¸åŒç¯å¢ƒéœ€è¦å½¼æ­¤éš”ç¦»\n- å¼‚æ„åº”ç”¨\n\t- äº‘ä¸šåŠ¡ï¼Œå¤§æ•°æ®ï¼Œæœç´¢æœåŠ¡\n\t- å¤šç§åº”ç”¨åè®®\n\t- ç°åº¦å‘å¸ƒ\n- æ—¥ç›Šå¢é•¿çš„å®‰å…¨éœ€æ±‚\n\t- å…¨é“¾è·¯TLS\n- å¯è§æ€§éœ€æ±‚\n\t- è®¿é—®æ—¥å¿—\n\t- Tracing\n\n## å¤šé›†ç¾¤éƒ¨ç½²\n\n- Kubernetesé›†ç¾¤è”é‚¦\n\t- é›†ç¾¤è”é‚¦APIServerä½œä¸ºç”¨æˆ·è®¿é—®Kubernetesé›†ç¾¤å…¥å£\n\t- æ‰€æœ‰Kubernetes é›†ç¾¤æ³¨å†Œè‡³é›†ç¾¤è”é‚¦\n- å¯ç”¨åŒº\n\t- æ•°æ®ä¸­å¿ƒä¸­å…·æœ‰ç‹¬ç«‹ä¾›ç”µåˆ¶å†·è®¾å¤‡çš„æ•…éšœåŸŸ\n\t- åŒä¸€å¯ç”¨åŒºæœ‰è¾ƒå°ç½‘ç»œå»¶è¿Ÿ\n\t- åŒä¸€å¯ç”¨åŒºéƒ¨ç½²äº†å¤šä¸ªKubernetes é›†ç¾¤\n- å¤šé›†ç¾¤éƒ¨ç½²\n\t- åŒä¸€å¯ç”¨åŒºè®¾å®šä¸€ä¸ªç½‘å…³é›†ç¾¤\n\t- ç½‘å…³é›†ç¾¤ä¸­éƒ¨ç½²Istio Primary\n\t- åŒä¸€å¯ç”¨åŒºçš„å…¶ä»–é›†ç¾¤ä¸­éƒ¨ç½²Istio Remote\n\t- æ‰€æœ‰é›†ç¾¤é‡‡ç”¨ç›¸åŒRootCA\n\t- ç›¸åŒç¯å¢ƒTrustDomainç›¸åŒ\n- ä¸œè¥¿å—åŒ—æµé‡ç»Ÿä¸€ç®¡æ§\n\t- åŒä¸€å¯ç”¨åŒºçš„æœåŠ¡è°ƒç”¨åŸºäºSidecar Â·  è·¨å¯ç”¨åŒºçš„æœåŠ¡è°ƒç”¨åŸºäº Istio Gateway\n\n![image.png](Extras/Images/image_1667375341308_0.png)\n\n## å…¥ç«™æµé‡æ¶æ„ L4+L7\n\n**ä¸ºä¸åŒåº”ç”¨é…ç½®ç‹¬ç«‹çš„ç½‘å…³æœåŠ¡ä»¥æ–¹ä¾¿ç½‘ç»œéš”ç¦»ã€‚**\n\nåŸºäºIPVS/xDPçš„ServiceControllerï¼š\n\n- å››å±‚ç½‘å…³è°ƒåº¦ï¼›\n- è™šæ‹ŸIPåœ°å€åˆ†é…ï¼›\n- åŸºäºIPIPåè®®çš„è½¬å‘è§„åˆ™é…ç½®ï¼›\n- åŸºäºBGPçš„IPè·¯ç”±å®£å‘Šï¼›\n- åœ¨Ingress Podä¸­é…ç½®Tunnelè®¾å¤‡ï¼Œ\n- å¹¶ç»‘å®šè™šæ‹ŸIPåœ°å€ä»¥å¸è½½IPIPåŒ…ã€‚\n\n![image.png](Extras/Images/image_1667375443775_0.png)\n\n## å•ç½‘å…³é›†ç¾¤å¤šç¯å¢ƒæ”¯æŒ\n\n![image.png](Extras/Images/image_1667375755323_0.png)\n\n## åº”ç”¨é«˜å¯ç”¨æ¥å…¥æ–¹æ¡ˆ\n\n![image.png](Extras/Images/image_1667376301327_0.png)\n\n## ä¸ºåº”ç”¨å‘å¸ƒæœåŠ¡\n\nå®šä¹‰**LoadBalancer Type Service**ï¼Œæä¾›é›†ç¾¤å¤–å¯è®¿é—®çš„ **LoadBalancerIlP**ã€‚\n\nå…¶ä»–é›†ç¾¤å¯é€šè¿‡å®šä¹‰**WorkloadEntry**æŒ‡å‘è¯¥**LoadBalancerIP**ï¼Œä»¥å®ç°æ•…éšœè½¬ç§»ç›®çš„ã€‚\n\n## åˆ›å»º WorkloadEntry\n\n**åˆ›å»ºWorkloadEntryæŒ‡å‘å…¶ä»–æ•°æ®ä¸­å¿ƒ LoadBalancerIP**\n\n```yaml\napiVersion: networking.istio.io/v1beta1\nkind: WorkloadEntry\nmetadata:\n  name: foo\nspec:\n  address: foo.bar.svc.cluster2\n  labels:\n    run: foo\n  locality: region1/zone1\n```\n\n## å®šä¹‰ ServiceEntry\n\nåŒæ—¶é€‰æ‹©WorkloadEntryå’Œæœ¬åœ°Podã€‚\n\n**ServiceEntryå¯¹è±¡å¯ä»¥å°†æœ¬åœ°Podå’Œå…·æœ‰ç›¸åŒLabelçš„WorkloadEntryå®šä¹‰æˆç›¸åŒçš„Envoy Clusterã€‚**\n\n```yaml\napiVersion: networking.istio.io/v1beta1\nkind: ServiceEntry\nmetadata:\n  name: foo\nspec:\n  hosts:\n  - foo.com\n  ports:\n  - name: http-default\n    number: 80\n    protocol: HTTP\n    targetPort: 80\n  resolution: STATIC\n  workloadSelector:\n    labels:\n      run: foo\n```\n\n## åœ¨ VirtualService ä¸­å¼•ç”¨ ServiceEntry\n\n```yaml\napiVersion: networking.istio.io/v1beta1\nkind: VirtualService\nmetadata:\n  name: foo\nspec:\n  gateways:\n  - foo\n  hosts:\n  - foo.com\n  http:\n  - match:\n    - port: 80\n    route:\n    - destination:\n      host: foo.com\n      port:\n        number: 80\n```\n\n```yaml\napiVersion: networking.istio.io/v1betal\nkind: Gateway\nmetadata:\n  name:foo\nspec:\n  selector:\n    istio: ingressgateway\n  servers:\n  - hosts:\n    - foo.com\n    port:\n      name: http-default\n      number: 80\n      protocol: HTTP\n```\n\n## ä¸ºworkload æ·»åŠ  Locality ä¿¡æ¯\n\nIstio ä»å¦‚ä¸‹é…ç½®ä¸­è¯»å–ï¼ŒåŸºäºè¿™äº›é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º Istio ä¸­è¿è¡Œçš„æ‰€æœ‰ workload æ·»åŠ åœ°åŸŸå±æ€§ã€‚\n\n**Kubernetes Node å¯¹è±¡ä¸­çš„åœ°åŸŸä¿¡æ¯ï¼Œæ‰€æœ‰ Pod è‡ªåŠ¨ç»§æ‰¿è¯¥ Locality ä¿¡æ¯**\n\n- region: topology.kubernetes.io/region\n- zone: topology.kubernetes.io/zone\n- ubzone: topology.istio.io/subzone\n\n**Kubernetes Pod çš„ istio-localityæ ‡ç­¾ï¼Œå¯è¦†ç›–èŠ‚ç‚¹ Locality ä¿¡æ¯**\n\n- istio-locality: \"region/zone/subzone\"\n\n**WorkloadEntry çš„ Locality å±æ€§**\n\n- locality: region/zone/subzone\n\n## å®šä¹‰åŸºäº Locality çš„æµé‡è½¬å‘è§„åˆ™\n\n**Distribute**\n\n```yaml\napiVersion: networking.istio.io/v1beta1\nkind: DestinationRule\nmetadata:\n  name: foo\nspec:\n  host: foo.com\n  trafficPolicy:\n    loadBalancer:\n      localityLbSetting:\n        distribute:\n        - from: \"*/*\"\n          to:\n            region1/zone1/*: 99\n            region2/zone2/*: 1\n        enabled: true\n    outlierDetection:\n      baseEjectionTime: 10s\n      consecutive5xxErrors: 100\n      interval: 10s\n  tls:\n    mode: ISTIO_MUTUAL\n```\n\n**Failover**\n\n```yaml\napiVersion: networking.istio.io/v1beta1\nkind: DestinationRule\nmetadata:\n  name: foo\nspec:\n  host: foo.com\n  trafficPolicy:\n    loadBalancer:\n      localityLbSetting:\n        enabled: true\n        failover:\n        - from: region1/zone1\n          to: region2/zone2\n    outlierDetection:\n      baseEjectionTime: 10m\n      consecutive5xxerrors: 1\n      interval: 2s\n  tls:\n    mode: ISTIO_MUTUAL\n```\n\n## åº”å¯¹è§„æ¨¡åŒ–é›†ç¾¤æŒ‘æˆ˜\n\n**Istio xDS é»˜è®¤å‘ç°é›†ç¾¤ä¸­æ‰€æœ‰çš„é…ç½®å’ŒæœåŠ¡çŠ¶æ€ï¼Œåœ¨è¶…å¤§è§„æ¨¡é›†ç¾¤ä¸­ï¼ŒIstiodæˆ–è€… Envoyéƒ½æ‰¿å—æ¯”è¾ƒå¤§çš„å‹åŠ›ã€‚**\n\n- é›†ç¾¤ä¸­çš„æœ‰10000ä¸ªServiceï¼Œæ¯ä¸ªServiceå¼€æ”¾80å’Œ443ä¸¤ä¸ªç«¯å£ï¼ŒIstioçš„CDSä¼šdiscoverå‡º20000ä¸ªEnvoyClusterã€‚\n- å¦‚æœå¼€å¯å¤šé›†ç¾¤ï¼ŒIstio è¿˜ä¼šä¸ºæ¯ä¸ªclusteråˆ›å»ºç¬¦åˆåŸŸåè§„èŒƒçš„é›†ç¾¤ã€‚\n- Istio è¿˜éœ€è¦å‘ç°remote cluster ä¸­çš„ Serviceï¼ŒEndpoint å’Œ Pod ä¿¡æ¯ï¼Œè€Œè¿™äº›ä¿¡æ¯çš„é¢‘ç¹å˜æ›´ï¼Œä¼šå¯¼è‡´ç½‘ç»œå¸¦å®½å ç”¨å’Œæ§åˆ¶é¢æ¿çš„å‹åŠ›éƒ½å¾ˆå¤§ã€‚\n\n**meshConfigä¸­æ§åˆ¶å¯è§æ€§âˆ¶**\n\n```yaml\ndefaultServiceExportTo: \n- \".\"\ndefaultVirtualServiceExportTo:\n- \".\"\ndefaultDestinationRuleExportTo:\n- \".\"\n```\n\n**é€šè¿‡Istioå¯¹è±¡ä¸­çš„exportToå±æ€§è¦†ç›–é»˜è®¤é…ç½®ã€‚**\n\n## Istiod è‡ªèº«çš„è§„æ¨¡æ§åˆ¶\n\n**ç¤¾åŒºæ–°å¢åŠ äº† discoverySelector çš„æ”¯æŒï¼Œå…è®¸Istiodåªå‘ç°æ·»åŠ äº†ç‰¹å®š label çš„ namespacesä¸‹çš„Istio ä»¥åŠKubernetes å¯¹è±¡ã€‚**\n\nä½†å› ä¸ºKubernetesæ¡†æ¶çš„é™åˆ¶ï¼Œæ”¹åŠŸèƒ½ä¾ç„¶è¦è®© Istiodæ¥æ”¶æ‰€æœ‰é…ç½®å’ŒçŠ¶æ€å˜æ›´æ–°ç»†ï¼Œå¹¶ä¸”åœ¨Istiod ä¸­è¿›è¡Œå¯¹è±¡è¿‡æ»¤ã€‚åœ¨è¶…å¤§é›†ç¾¤è§„æ¨¡ä¸­ï¼Œå¹¶æœªé™ä½ç½‘ç»œå¸¦å®½å ç”¨å’ŒIstiod çš„å¤„ç†å‹åŠ›ã€‚\n\néœ€è¦ç»§ç»­å¯»æ±‚ä»Kubernetes Serverç«¯è¿‡æ»¤çš„è§£å†³æ–¹æ¡ˆã€‚\n\n## åŸºäºè”é‚¦çš„ç»Ÿä¸€æµé‡æ¨¡å‹\n\n- Spec\n\t- Scope\n\t- TrafficTemplate\n\t\t- Istio models\n\t\t- Kubernetes Services\n\t- Override\n\t\t- å¯ä¸ºä¸åŒç›®æ ‡é›†ç¾¤ä¿®æ”¹æ¨¡æ¿å±æ€§å€¼\n\t\t- æ”¯æŒå¤šç§overrideæ–¹æ³•\n\t\t\t- jsonPatch\n\t\t\t- mergePatch\n\t- Policy\n\t\t- PlacementPolicy\n\t\t- RolloutPolicy\n\t\t- RuntimePolicy\n- Status\n\t- Conditions\n\t\t- å››å±‚ç½‘å…³çŠ¶æ€\n\t\t- ä¸ƒå±‚ç½‘å…³é…ç½®å®Œæˆåº¦\n\t\t- è¯ä¹¦ç‰ˆæœ¬\n\t\t- ç½‘å…³æœåŠ¡IPå’ŒFQDN\n\n![image.png](Extras/Images/image_1667393693694_0.png)\n\n## ç»Ÿä¸€æµé‡æ¨¡å‹-NameService\n\n- Spec\n\t- Global Name FQDN\n\t- TTL\n\t- DNSPolicy\n\t\t- RoundRobin\n\t\t- Locality\n\t\t- Ratio\n\t- HeathCheck Port\n\t- Target\n\t\t- Target Service FQDN\n\t\t- Ratio\n- Status\n\t- Conditions\n\t\t- åŸŸåé…ç½®ç»“æœ\n\t- é…ç½®é”™è¯¯ä¿¡æ¯\n\n## AccessPoint æ§åˆ¶å™¨\n\n**PcementPolicy** æ§åˆ¶ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ç›®æ ‡é›†ç¾¤æ¥å®Œæˆæµé‡é…ç½®ï¼Œç”šè‡³å¯ä»¥é€‰æ‹©å…³è”çš„**FederatedDeployment** å¯¹è±¡ï¼Œä½¿å¾— **AccessPoint** è‡ªåŠ¨å‘ç°ç›®æ ‡é›†ç¾¤å¹¶å®Œæˆé…ç½®ã€‚\n\nå®Œæˆäº†çŠ¶æ€ä¸ŠæŠ¥ï¼ŒåŒ…æ‹¬ç½‘å…³è™šæ‹Ÿ**IP**åœ°å€ï¼Œç½‘å…³ **FQDN**ï¼Œè¯ä¹¦å®‰è£…çŠ¶æ€ä»¥åŠç‰ˆæœ¬ä¿¡æ¯ï¼Œè·¯ç”±ç­–ç•¥æ˜¯å¦é…ç½®å®Œæˆç­‰ã€‚è¿™è¡¥é½äº†**Istio** è‡ªèº«çš„çŸ­æ¿ï¼Œï¼Œä½¿å¾—ä»»ä½•éƒ¨ç½²åœ¨ **Istio** çš„åº”ç”¨çš„ç½‘ç»œé…ç½®çŠ¶æ€ä¸€ç›®äº†ç„¶ã€‚\n\nå‘å¸ƒç­–ç•¥æ§åˆ¶ï¼Œé’ˆå¯¹å¤šé›†ç¾¤çš„é…ç½®ï¼Œå¯å®ç°å•é›†ç¾¤çš„ç°åº¦å‘å¸ƒï¼Œå¹¶ä¸”èƒ½å¤Ÿè‡ªåŠ¨æš‚åœå‘å¸ƒï¼Œç®¡ç†å‘˜éªŒè¯å•ä¸ªé›†ç¾¤çš„å˜æ›´æ­£ç¡®ä»¥åï¼Œå†ç»§ç»­å‘å¸ƒã€‚é€šè¿‡æ­¤æœºåˆ¶ï¼Œé¿å…å› ä¸ºå…¨å±€æµé‡å˜æ›´äº§ç”Ÿçš„æ•…éšœã€‚\n\nä¸åŒåŸŸåçš„ **AccessPoint** å¯æ‹¥æœ‰ä¸åŒçš„å››å±‚ç½‘å…³è™šæ‹Ÿ**IP**åœ°å€ï¼Œä»¥å®ç°åŸºäº**IP**åœ°å€çš„å››å±‚ç½‘ç»œéš”ç¦»ã€‚\n\næ§åˆ¶å™¨å¯ä»¥åŸºäº**AccessPoint** è‡ªåŠ¨åˆ›å»º **WorkloadEntry**ï¼Œå¹¶è®¾ç½® **Locality** ä¿¡æ¯ã€‚\n\n## æœªæ¥å±•æœ›\n\n- å…¨é¢æ„å»ºåŸºäº Mesh çš„æµé‡ç®¡ç†\n- åœ¨ç”¨æˆ·æ— æ„ŸçŸ¥çš„å‰æä¸‹å°†å—åŒ—æµé‡è½¬æˆä¸œè¥¿æµé‡\n- æ•°æ®å¹³é¢åŠ é€ŸCilium\n\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/APIServer":{"title":"APIServer","content":"\n# API Server\n\nkube-apiserveræ˜¯Kubernetesæœ€é‡è¦çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œä¸»è¦æä¾›ä»¥ä¸‹çš„åŠŸèƒ½\n\næä¾›é›†ç¾¤ç®¡ç†çš„REST APIæ¥å£ï¼ŒåŒ…æ‹¬è®¤è¯æˆæƒã€æ•°æ®æ ¡éªŒä»¥åŠé›†ç¾¤çŠ¶æ€å˜æ›´ç­‰\n\næä¾›å…¶ä»–æ¨¡å—ä¹‹é—´çš„æ•°æ®äº¤äº’å’Œé€šä¿¡çš„æ¢çº½ï¼ˆå…¶ä»–æ¨¡å—é€šè¿‡API ServeræŸ¥è¯¢æˆ–ä¿®æ”¹æ•°æ®ï¼Œåªæœ‰API Serveræ‰ç›´æ¥æ“ä½œetcdï¼‰\n\n## è®¿é—®æ§åˆ¶æ¦‚è§ˆ\n\nKubernetes APIçš„æ¯ä¸ªè¯·æ±‚éƒ½ä¼šç»è¿‡å¤šé˜¶æ®µçš„è®¿é—®æ§åˆ¶ä¹‹åæ‰ä¼šè¢«æ¥å—ï¼Œè¿™åŒ…æ‹¬è®¤è¯ã€æˆæƒä»¥åŠå‡†å…¥æ§åˆ¶ï¼ˆAdmission Controlï¼‰ç­‰ã€‚\n\n![image.png](Extras/Images/image_1665936179908_0.png)\n\n## è®¿é—®æ§åˆ¶ç»†èŠ‚\n\n![image.png](Extras/Images/image_1665936203999_0.png)\n\n# è®¤è¯\n\nå¼€å¯TLSæ—¶ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½éœ€è¦é¦–å…ˆè®¤è¯ã€‚Kubernetesæ”¯æŒå¤šç§è®¤è¯æœºåˆ¶ï¼Œå¹¶æ”¯æŒåŒæ—¶å¼€å¯å¤šä¸ªè®¤è¯æ’ä»¶ï¼ˆåªè¦æœ‰ä¸€ä¸ªè®¤è¯é€šè¿‡å³å¯ï¼‰ã€‚å¦‚æœè®¤è¯æˆåŠŸï¼Œåˆ™ç”¨æˆ·çš„usernameä¼šä¼ å…¥æˆæƒæ¨¡å—åšè¿›ä¸€æ­¥æˆæƒéªŒè¯ï¼›è€Œå¯¹äºè®¤è¯å¤±è´¥çš„è¯·æ±‚åˆ™è¿”å›HTTP 401ã€‚\n\n## è®¤è¯æ’ä»¶\n\n- X509è¯ä¹¦\n\t- ä½¿ç”¨X509å®¢æˆ·ç«¯è¯ä¹¦åªéœ€è¦API Serverå¯åŠ¨æ—¶é…ç½®--client-ca-file=SOMEFILEã€‚åœ¨è¯ä¹¦è®¤è¯æ—¶ï¼Œå…¶CNåŸŸç”¨ä½œç”¨æˆ·åï¼Œè€Œç»„ç»‡æœºæ„åŸŸåˆ™ç”¨ä½œgroupåã€‚\n- é™æ€Tokenæ–‡ä»¶\n\t- ä½¿ç”¨é™æ€Tokenæ–‡ä»¶è®¤è¯åªéœ€è¦API Serverå¯åŠ¨æ—¶é…ç½®--token-auth-file=SOMEFILEã€‚\n\t- è¯¥æ–‡ä»¶ä¸ºcsvæ ¼å¼ï¼Œæ¯è¡Œè‡³å°‘åŒ…æ‹¬ä¸‰åˆ—token,username,user idï¼Œ\n\t\t- `token,user,uid,\"group1,group2,group3â€`\n- å¼•å¯¼Token\n\t- ä¸ºäº†æ”¯æŒå¹³æ»‘åœ°å¯åŠ¨å¼•å¯¼æ–°çš„é›†ç¾¤ï¼ŒKubernetes åŒ…å«äº†ä¸€ç§åŠ¨æ€ç®¡ç†çš„æŒæœ‰è€…ä»¤ç‰Œç±»å‹ï¼Œ ç§°ä½œ å¯åŠ¨å¼•å¯¼ä»¤ç‰Œï¼ˆBootstrapTokenï¼‰ã€‚\n\t- è¿™äº›ä»¤ç‰Œä»¥ Secret çš„å½¢å¼ä¿å­˜åœ¨ kube-system åå­—ç©ºé—´ä¸­ï¼Œå¯ä»¥è¢«åŠ¨æ€ç®¡ç†å’Œåˆ›å»ºã€‚\n\t- æ§åˆ¶å™¨ç®¡ç†å™¨åŒ…å«çš„ TokenCleaner æ§åˆ¶å™¨èƒ½å¤Ÿåœ¨å¯åŠ¨å¼•å¯¼ä»¤ç‰Œè¿‡æœŸæ—¶å°†å…¶åˆ é™¤ã€‚\n\t- åœ¨ä½¿ç”¨kubeadméƒ¨ç½²Kubernetesæ—¶ï¼Œå¯é€šè¿‡kubeadm token listå‘½ä»¤æŸ¥è¯¢ã€‚\n- é™æ€å¯†ç æ–‡ä»¶\n\t- éœ€è¦API Serverå¯åŠ¨æ—¶é…ç½®--basic-auth-file=SOMEFILEï¼Œæ–‡ä»¶æ ¼å¼ä¸ºcsvï¼Œæ¯è¡Œè‡³å°‘ä¸‰åˆ—password, user, uidï¼Œåé¢æ˜¯å¯é€‰çš„groupå\n\t\t- `password,user,uid,\"group1,group2,group3â€`\n- ServiceAccount\n\t- ServiceAccountæ˜¯Kubernetesè‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå¹¶ä¼šè‡ªåŠ¨æŒ‚è½½åˆ°å®¹å™¨çš„/run/secrets/kubernetes.io/serviceaccountç›®å½•ä¸­ã€‚\n- OpenID\n\t- OAuth 2.0çš„è®¤è¯æœºåˆ¶\n- Webhook ä»¤ç‰Œèº«ä»½è®¤è¯\n\t- --authentication-token-webhook-config-file æŒ‡å‘ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­æè¿° å¦‚ä½•è®¿é—®è¿œç¨‹çš„ Webhook æœåŠ¡ã€‚\n\t- --authentication-token-webhook-cache-ttl ç”¨æ¥è®¾å®šèº«ä»½è®¤è¯å†³å®šçš„ç¼“å­˜æ—¶é—´ã€‚ é»˜è®¤æ—¶é•¿ä¸º 2 åˆ†é’Ÿã€‚\n- åŒ¿åè¯·æ±‚\n\t- å¦‚æœä½¿ç”¨AlwaysAllowä»¥å¤–çš„è®¤è¯æ¨¡å¼ï¼Œåˆ™åŒ¿åè¯·æ±‚é»˜è®¤å¼€å¯ï¼Œä½†å¯ç”¨--anonymous-auth=falseç¦æ­¢åŒ¿åè¯·æ±‚ã€‚\n\n## åŸºäºwebhookçš„è®¤è¯æœåŠ¡é›†æˆ\n\n### æ„å»ºç¬¦åˆKubernetesè§„èŒƒçš„è®¤è¯æœåŠ¡\n\néœ€è¦ä¾ç…§Kubernetesè§„èŒƒï¼Œæ„å»ºè®¤è¯æœåŠ¡ï¼Œç”¨æ¥è®¤è¯tokenreview requestæ„å»ºè®¤è¯æœåŠ¡\n\n* è®¤è¯æœåŠ¡éœ€è¦æ»¡è¶³å¦‚ä¸‹Kubernetesçš„è§„èŒƒ\n* URLï¼š https://authn.example.com/authenticate\n* Methodï¼š POST\n* Input:\n* Output:\n\n```json\n{ \"apiVersion\": \"authentication.k8s.io/v1beta1\", \"kind\": \"TokenReview\",\n\"spec\": { \"token\": \"(BEARERTOKEN)\" } }\n\n{\n  \"apiVersion\": \"authentication.k8s.io/v1beta1\",\n  \"kind\": \"TokenReview\",\n   \"status\": {\n    \"authenticated\": true,\n    \"user\": {\n      \"username\": \"janedoe@example.com\",\n      \"uid\": \"42\",\n      \"groups\": [\n        \"developers\",\n        \"qa\"\n      ]}}\n}\n```\n\n### å¼€å‘è®¤è¯æœåŠ¡\n\nè§£ç è®¤è¯è¯·æ±‚\n\n```go\ndecoder := json.NewDecoder(r.Body)\nvar tr authentication.TokenReview\nerr := decoder.Decode(\u0026tr)\nif err != nil {\n\tlog.Println(\"[Error]\", err.Error())\n\tw.WriteHeader(http.StatusBadRequest)\n\tjson.NewEncoder(w).Encode(map[string]interface{}{\n\t\t\"apiVersion\": \"authentication.k8s.io/v1beta1\",\n\t\t\"kind\": \"TokenReview\",\n\t\t\"status\": authentication.TokenReviewStatus{\n\t\t\tAuthenticated: false,\n\t\t},\n\t})\n\treturn\n}\n```\n\nè½¬å‘è®¤è¯è¯·æ±‚è‡³è®¤è¯æœåŠ¡å™¨\n\n```go\n// Check User\nts := oauth2.StaticTokenSource(\n\t\u0026oauth2.Token{AccessToken: tr.Spec.Token},\n)\ntc := oauth2.NewClient(oauth2.NoContext, ts)\nclient := github.NewClient(tc)\nuser, _, err := client.Users.Get(context.Background(), \"\")\nif err != nil {\n\tlog.Println(\"[Error]\", err.Error())\n\tw.WriteHeader(http.StatusUnauthorized)\n\tjson.NewEncoder(w).Encode(map[string]interface{}{\n\t\t\"apiVersion\": \"authentication.k8s.io/v1beta1\",\n\t\t\"kind\": \"TokenReview\",\n\t\t\"status\": authentication.TokenReviewStatus{\n\t\tAuthenticated: false,\n\t\t},\n\t})\n\treturn\n}\n```\n\nè®¤è¯ç»“æœè¿”å›ç»™APIServer\n\n```go\nw.WriteHeader(http.StatusOK)\ntrs := authentication.TokenReviewStatus{\n\tAuthenticated: true,\n\tUser: authentication.UserInfo{\n\t\tUsername: *user.Login,\n\t\tUID: *user.Login,\n\t},\n}\njson.NewEncoder(w).Encode(map[string]interface{}{\n\t\"apiVersion\": \"authentication.k8s.io/v1beta1\",\n\t\"kind\": \"TokenReview\",\n\t\"status\": trs,\n})\n```\n\n### é…ç½®apiserver\n\n- å¯ä»¥æ˜¯ä»»ä½•è®¤è¯ç³»ç»Ÿ\n\t- ä½†åœ¨ç”¨æˆ·è®¤è¯å®Œæˆåï¼Œç”Ÿæˆä»£è¡¨ç”¨æˆ·èº«ä»½çš„token\n\t- è¯¥tokené€šå¸¸æ˜¯æœ‰å¤±æ•ˆæ—¶é—´çš„\n\t- ç”¨æˆ·è·å–è¯¥tokenä»¥åä»¥åï¼Œå°†tokené…ç½®è¿›kubeconfig\n- ä¿®æ”¹apiserverè®¾ç½®ï¼Œå¼€å¯è®¤è¯æœåŠ¡ï¼Œapiserverä¿è¯å°†æ‰€æœ‰æ”¶åˆ°çš„\n- è¯·æ±‚ä¸­çš„tokenä¿¡æ¯ï¼Œå‘ç»™è®¤è¯æœåŠ¡è¿›è¡ŒéªŒè¯\n\t- --authentication-token-webhook-config-fileï¼Œè¯¥æ–‡ä»¶æè¿°å¦‚ä½•è®¿é—®è®¤è¯æœåŠ¡\n\t- --authentication-token-webhook-cache-ttlï¼Œé»˜è®¤2åˆ†é’Ÿ\n- é…ç½®æ–‡ä»¶éœ€è¦mountè¿›Pod\n- é…ç½®æ–‡ä»¶ä¸­çš„æœåŠ¡å™¨åœ°å€éœ€è¦æŒ‡å‘authService\n\n```json\n{\n    \"kind\": \"Config\",\n    \"apiVersion\": \"v1\",\n    \"preferences\": {},\n    \"clusters\": [\n        {\n            \"name\": \"github-authn\",\n            \"cluster\": {\n                \"server\": \"http://localhost:3000/authenticate\"\n            }\n        }\n    ],\n    \"users\": [\n        {\n            \"name\": \"authn-apiserver\",\n            \"user\": {\n                \"token\": \"secret\"\n            }\n        }\n    ],\n    \"contexts\": [\n        {\n            \"name\": \"webhook\",\n            \"context\": {\n                \"cluster\": \"github-authn\",\n                \"user\": \"authn-apiserver\"\n            }\n        }\n    ],\n    \"current-context\": \"webhook\"\n}\n```\n\n# é‰´æƒ\n\n## æˆæƒ\n\næˆæƒä¸»è¦æ˜¯ç”¨äºå¯¹é›†ç¾¤èµ„æºçš„è®¿é—®æ§åˆ¶ï¼Œé€šè¿‡æ£€æŸ¥è¯·æ±‚åŒ…å«çš„ç›¸å…³å±æ€§å€¼ï¼Œä¸ç›¸å¯¹åº”çš„è®¿é—®ç­–ç•¥ç›¸æ¯”è¾ƒï¼ŒAPIè¯·æ±‚å¿…é¡»æ»¡è¶³æŸäº›ç­–ç•¥æ‰èƒ½è¢«å¤„ç†ã€‚è·Ÿè®¤è¯ç±»ä¼¼ï¼ŒKubernetesä¹Ÿæ”¯æŒå¤šç§æˆæƒæœºåˆ¶ï¼Œå¹¶æ”¯æŒåŒæ—¶å¼€å¯å¤šä¸ªæˆæƒæ’ä»¶ï¼ˆåªè¦æœ‰ä¸€ä¸ªéªŒè¯é€šè¿‡å³å¯ï¼‰ã€‚å¦‚æœæˆæƒæˆåŠŸï¼Œåˆ™ç”¨æˆ·çš„è¯·æ±‚ä¼šå‘é€åˆ°å‡†å…¥æ§åˆ¶æ¨¡å—åšè¿›ä¸€æ­¥çš„è¯·æ±‚éªŒè¯ï¼›å¯¹äºæˆæƒå¤±è´¥çš„è¯·æ±‚åˆ™è¿”å›HTTP 403ã€‚\n\nKubernetesæˆæƒä»…å¤„ç†ä»¥ä¸‹çš„è¯·æ±‚å±æ€§ï¼š\n\n- user, group, extra\n- APIã€è¯·æ±‚æ–¹æ³•ï¼ˆå¦‚getã€postã€updateã€patchå’Œdeleteï¼‰å’Œè¯·æ±‚è·¯å¾„ï¼ˆå¦‚/apiï¼‰\n- è¯·æ±‚èµ„æºå’Œå­èµ„æº\n- Namespace\n- API Group\n\nç›®å‰ï¼ŒKubernetesæ”¯æŒä»¥ä¸‹æˆæƒæ’ä»¶ï¼š\n\n- ABAC\n- RBAC\n- Webhook\n- Node\n\n## RBAC vs ABAC\n\nABACï¼ˆAttribute Based Access Controlï¼‰æœ¬æ¥æ˜¯ä¸é”™çš„æ¦‚å¿µï¼Œä½†æ˜¯åœ¨ Kubernetes ä¸­çš„å®ç°æ¯”è¾ƒéš¾äºç®¡ç†å’Œç†è§£ï¼Œè€Œä¸”éœ€è¦å¯¹ Master æ‰€åœ¨èŠ‚ç‚¹çš„ SSH å’Œæ–‡ä»¶ç³»ç»Ÿæƒé™ï¼Œè¦ä½¿å¾—å¯¹æˆæƒçš„å˜æ›´æˆåŠŸç”Ÿæ•ˆï¼Œè¿˜éœ€è¦é‡æ–°å¯åŠ¨ API Serverã€‚\n\nè€Œ RBAC çš„æˆæƒç­–ç•¥å¯ä»¥åˆ©ç”¨ kubectl æˆ–è€… Kubernetes API ç›´æ¥è¿›è¡Œé…ç½®ã€‚RBAC å¯ä»¥æˆæƒç»™ç”¨æˆ·ï¼Œè®©ç”¨æˆ·æœ‰æƒè¿›è¡Œæˆæƒç®¡ç†ï¼Œè¿™æ ·å°±å¯ä»¥æ— éœ€æ¥è§¦èŠ‚ç‚¹ï¼Œç›´æ¥è¿›è¡Œæˆæƒç®¡ç†ã€‚RBAC åœ¨ Kubernetesä¸­è¢«æ˜ å°„ä¸º API èµ„æºå’Œæ“ä½œã€‚\n\n## RBACè€å›¾\n\n![image.png](Extras/Images/image_1665943450461_0.png)\n\n## RBACæ–°è§£\n\n![image.png](Extras/Images/image_1665943481332_0.png)\n\n## Roleä¸ClusterRole\n\nRoleï¼ˆè§’è‰²ï¼‰æ˜¯ä¸€ç³»åˆ—æƒé™çš„é›†åˆï¼Œä¾‹å¦‚ä¸€ä¸ªè§’è‰²å¯ä»¥åŒ…å«è¯»å– Pod çš„æƒé™å’Œåˆ—å‡º Pod çš„æƒé™ã€‚Roleåªèƒ½ç”¨æ¥ç»™æŸä¸ªç‰¹å®šnamespaceä¸­çš„èµ„æºä½œé‰´æƒï¼Œå¯¹å¤šnamespaceå’Œé›†ç¾¤çº§çš„èµ„æºæˆ–è€…æ˜¯éèµ„æºç±»çš„APIï¼ˆå¦‚/healthzï¼‰ä½¿ç”¨ClusterRoleã€‚\n\n![image.png](Extras/Images/image_1665943682167_0.png)\n\n## binding\n\n![image.png](Extras/Images/image_1665943725607_0.png)\n\n## è´¦æˆ·ï¼ç»„çš„ç®¡ç†\n\nè§’è‰²ç»‘å®šï¼ˆRole Bindingï¼‰æ˜¯å°†è§’è‰²ä¸­å®šä¹‰çš„æƒé™èµ‹äºˆä¸€ä¸ªæˆ–è€…ä¸€ç»„ç”¨æˆ·ã€‚å®ƒåŒ…å«è‹¥å¹² **ä¸»ä½“**ï¼ˆç”¨æˆ·ã€ç»„æˆ–æœåŠ¡è´¦æˆ·ï¼‰çš„åˆ—è¡¨å’Œå¯¹è¿™äº›ä¸»ä½“æ‰€è·å¾—çš„è§’è‰²çš„å¼•ç”¨ã€‚\n\nç»„çš„æ¦‚å¿µï¼š\n\n- å½“ä¸å¤–éƒ¨è®¤è¯ç³»ç»Ÿå¯¹æ¥æ—¶ï¼Œç”¨æˆ·ä¿¡æ¯ï¼ˆUserInfoï¼‰å¯åŒ…å«Groupä¿¡æ¯ï¼Œæˆæƒå¯é’ˆå¯¹ç”¨æˆ·ç¾¤ç»„\n- å½“å¯¹ServiceAccountæˆæƒæ—¶ï¼ŒGroupä»£è¡¨æŸä¸ªNamespaceä¸‹çš„æ‰€æœ‰ServiceAccount\n\n![image.png](Extras/Images/image_1665943926495_0.png)\n\n## è§„åˆ’ç³»ç»Ÿè§’è‰²\n\n- User\n\t- ç®¡ç†å‘˜\n\t\t- æ‰€æœ‰èµ„æºçš„æ‰€æœ‰æƒé™ï¼Ÿï¼Ÿï¼ˆä¸ç»™æ™®é€šç”¨çš„secretçš„è¯»å–æƒé™ï¼‰\n\t- æ™®é€šç”¨æˆ·\n\t\t- æ˜¯å¦æœ‰è¯¥ç”¨æˆ·åˆ›å»ºçš„namespaceä¸‹çš„æ‰€æœ‰objectçš„æ“ä½œæƒé™ï¼Ÿ\n\t\t- å¯¹å…¶ä»–ç”¨æˆ·çš„namespaceèµ„æºæ˜¯å¦å¯è¯»ï¼Œæ˜¯å¦å¯å†™ï¼Ÿ\n- ServiceAccount\n\t- ServiceAccountæ˜¯å¼€å‘è€…ï¼ˆkubernetes developeræˆ–è€…domain developerï¼‰åˆ›å»ºåº”ç”¨åï¼Œåº”ç”¨äºapiserveré€šè®¯éœ€è¦çš„èº«ä»½\n\t- ç”¨æˆ·å¯ä»¥åˆ›å»ºè‡ªå®šçš„ServiceAccountï¼Œkubernetesä¹Ÿä¸ºæ¯ä¸ªnamespaceåˆ›å»ºdefault ServiceAccount\n\t- Default ServiceAccounté€šå¸¸éœ€è¦ç»™å®šæƒé™ä»¥åæ‰èƒ½å¯¹apiserveråšå†™æ“ä½œ\n\n## å®ç°æ–¹æ¡ˆ\n\n- åœ¨clusteråˆ›å»ºæ—¶ï¼Œåˆ›å»ºè‡ªå®šä¹‰çš„clusterRoleï¼Œæ¯”å¦‚namespace-creator\n- Namespace-creator roleå®šä¹‰ç”¨æˆ·å¯æ“ä½œçš„å¯¹è±¡å’Œå¯¹åº”çš„è¯»å†™æ“ä½œã€‚\n- åˆ›å»ºè‡ªå®šä¹‰çš„namespace admission control webhook\n\t- å½“namespaceåˆ›å»ºè¯·æ±‚è¢«å¤„ç†æ—¶ï¼Œè·å–å½“å‰ç”¨æˆ·ä¿¡æ¯å¹¶annotateåˆ°namespace\n- åˆ›å»ºRBAC controller\n\t- Watch namespaceçš„åˆ›å»ºäº‹ä»¶\n\t- è·å–å½“å‰namespaceçš„åˆ›å»ºè€…ä¿¡æ¯\n\t- åœ¨å½“å‰namespaceåˆ›å»ºrolebindingå¯¹è±¡ï¼Œå¹¶å°†namespace-creator è§’è‰²å’Œç”¨æˆ·ç»‘å®š\n\n## ä¸æƒé™ç›¸å…³çš„å…¶ä»–æœ€ä½³å®è·µ\n\n- ClusterRoleæ˜¯énamespaceç»‘å®šçš„ï¼Œé’ˆå¯¹æ•´ä¸ªé›†ç¾¤ç”Ÿæ•ˆ\n- é€šå¸¸éœ€è¦åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è§’è‰²ï¼Œå¹¶ä¸”ç»‘å®šç»™å¼€å‘è¿è¥å›¢é˜Ÿæˆå‘˜\n- CustomResourceDefinitionæ˜¯å…¨å±€èµ„æºï¼Œæ™®é€šç”¨æˆ·åˆ›å»ºCustomResourceDefinitionä»¥åï¼Œéœ€è¦ç®¡ç†å‘˜æˆäºˆç›¸åº”æƒé™åæ‰èƒ½çœŸæ­£æ“ä½œè¯¥å¯¹è±¡\n- é’ˆå¯¹æ‰€æœ‰çš„è§’è‰²ç®¡ç†ï¼Œå»ºè®®åˆ›å»ºspecï¼Œç”¨æºä»£ç é©±åŠ¨\n\t- è™½ç„¶å¯ä»¥é€šè¿‡editæ“ä½œæ¥ä¿®æ”¹æƒé™ï¼Œä½†åæœŸä¼šå¯¼è‡´æƒé™ç®¡ç†æ··ä¹±ï¼Œå¯èƒ½ä¼šæœ‰å¾ˆå¤šä¸´æ—¶åˆ›å»ºå‡ºæ¥çš„è§’è‰²å’Œè§’è‰²ç»‘å®šå¯¹è±¡ï¼Œé‡å¤ç»‘å®šæŸä¸€ä¸ªèµ„æºæƒé™\n- æƒé™æ˜¯å¯ä»¥ä¼ é€’çš„ï¼Œç”¨æˆ·Aå¯ä»¥å°†å…¶å¯¹æŸå¯¹è±¡çš„æŸæ“ä½œï¼ŒæŠ½å–æˆä¸€ä¸ªæƒé™ï¼Œå¹¶èµ‹ç»™ç”¨æˆ·B\n- é˜²æ­¢æµ·é‡çš„è§’è‰²å’Œè§’è‰²ç»‘å®šå¯¹è±¡ï¼Œå› ä¸ºå¤§é‡çš„å¯¹è±¡ä¼šå¯¼è‡´é‰´æƒæ•ˆç‡ä½ï¼ŒåŒæ—¶ç»™apiserverå¢åŠ è´Ÿæ‹…\n- ServiceAccountä¹Ÿéœ€è¦æˆæƒçš„ï¼Œå¦åˆ™ä½ çš„componentå¯èƒ½æ— æ³•æ“ä½œæŸå¯¹è±¡\n- Tipsï¼šSSHåˆ°masterèŠ‚ç‚¹é€šè¿‡insecure portè®¿é—®apiserverå¯ç»•è¿‡é‰´æƒï¼Œå½“éœ€è¦åšç®¡ç†æ“ä½œåˆæ²¡æœ‰æƒé™æ—¶å¯ä»¥ä½¿ç”¨ï¼ˆä¸æ¨èï¼‰\n\n# å‡†å…¥\n\n## å‡†å…¥æ§åˆ¶\n\n- ä¸ºèµ„æºå¢åŠ è‡ªå®šä¹‰å±æ€§\n- ä½œä¸ºå¤šç§Ÿæˆ·é›†ç¾¤æ–¹æ¡ˆä¸­çš„ä¸€ç¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨namespaceçš„å‡†å…¥æ§åˆ¶ä¸­ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶å°†ç”¨æˆ·ä¿¡æ¯æ›´æ–°çš„namespaceçš„annotation\n- æœ‰å½“namespaceä¸­æœ‰æœ‰æ•ˆç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬æ‰å¯ä»¥åœ¨namespaceåˆ›å»ºæ—¶ï¼Œè‡ªåŠ¨ç»‘å®šç”¨æˆ·æƒé™ï¼Œnamespaceæ‰å¯ç”¨ã€‚\n\n---\n\n- é…é¢ç®¡ç†\n\t- åŸå› ï¼šèµ„æºæœ‰é™ï¼Œå¦‚ä½•é™å®šæŸä¸ªç”¨æˆ·æœ‰å¤šå°‘èµ„æºï¼Ÿ\n- æ–¹æ¡ˆï¼š\n\t- é¢„å®šä¹‰æ¯ä¸ªNamespaceçš„ResourceQuotaï¼Œå¹¶æŠŠspecä¿å­˜ä¸ºconfigmap\n\t\t- ç”¨æˆ·å¯ä»¥åˆ›å»ºå¤šå°‘ä¸ªPod\n\t\t\t- BestEffortPod\n\t\t\t- QoSPod\n\t\t- ç”¨æˆ·å¯ä»¥åˆ›å»ºå¤šå°‘ä¸ªservice\n\t\t- ç”¨æˆ·å¯ä»¥åˆ›å»ºå¤šå°‘ä¸ªingress\n\t\t- ç”¨æˆ·å¯ä»¥åˆ›å»ºå¤šå°‘ä¸ªservice VIP\n\t- åˆ›å»ºResourceQuota Controller\n\t\t- ç›‘æ§namespaceåˆ›å»ºäº‹ä»¶ï¼Œå½“namespaceåˆ›å»ºæ—¶ï¼Œåœ¨è¯¥namespaceåˆ›å»ºå¯¹åº”çš„ResourceQuota å¯¹è±¡\n\t- apiserverä¸­å¼€å¯ResourceQuotaçš„admission plugin\n\n---\n\nå‡†å…¥æ§åˆ¶ï¼ˆAdmission Controlï¼‰åœ¨æˆæƒåå¯¹è¯·æ±‚åšè¿›ä¸€æ­¥çš„éªŒè¯æˆ–æ·»åŠ é»˜è®¤å‚æ•°ã€‚ä¸åŒäºæˆæƒå’Œè®¤è¯åªå…³å¿ƒè¯·æ±‚çš„ç”¨æˆ·å’Œæ“ä½œï¼Œå‡†å…¥æ§åˆ¶è¿˜å¤„ç†è¯·æ±‚çš„å†…å®¹ï¼Œå¹¶ä¸”ä»…å¯¹åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤æˆ–è¿æ¥ï¼ˆå¦‚ä»£ç†ï¼‰ç­‰æœ‰æ•ˆï¼Œè€Œå¯¹è¯»æ“ä½œæ— æ•ˆã€‚\n\nå‡†å…¥æ§åˆ¶æ”¯æŒåŒæ—¶å¼€å¯å¤šä¸ªæ’ä»¶ï¼Œå®ƒä»¬ä¾æ¬¡è°ƒç”¨ï¼Œåªæœ‰å…¨éƒ¨æ’ä»¶éƒ½é€šè¿‡çš„è¯·æ±‚æ‰å¯ä»¥æ”¾è¿‡è¿›å…¥ç³»ç»Ÿã€‚\n\n## å‡†å…¥æ§åˆ¶æ’ä»¶\n\n- AlwaysAdmit: æ¥å—æ‰€æœ‰è¯·æ±‚ã€‚\n- AlwaysPullImages: æ€»æ˜¯æ‹‰å–æœ€æ–°é•œåƒã€‚åœ¨å¤šç§Ÿæˆ·åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ã€‚\n- DenyEscalatingExec: ç¦æ­¢ç‰¹æƒå®¹å™¨çš„execå’Œattachæ“ä½œã€‚\n- ImagePolicyWebhook: é€šè¿‡webhookå†³å®šimageç­–ç•¥ï¼Œéœ€è¦åŒæ—¶é…ç½®--admission-control-config-file\n- ServiceAccountï¼šè‡ªåŠ¨åˆ›å»ºé»˜è®¤ServiceAccountï¼Œå¹¶ç¡®ä¿Podå¼•ç”¨çš„ServiceAccountå·²ç»å­˜åœ¨\n- SecurityContextDenyï¼šæ‹’ç»åŒ…å«éæ³•SecurityContexté…ç½®çš„å®¹å™¨\n- ResourceQuotaï¼šé™åˆ¶Podçš„è¯·æ±‚ä¸ä¼šè¶…è¿‡é…é¢ï¼Œéœ€è¦åœ¨namespaceä¸­åˆ›å»ºä¸€ä¸ªResourceQuotaå¯¹è±¡\n- LimitRangerï¼šä¸ºPodè®¾ç½®é»˜è®¤èµ„æºè¯·æ±‚å’Œé™åˆ¶ï¼Œéœ€è¦åœ¨namespaceä¸­åˆ›å»ºä¸€ä¸ªLimitRangeå¯¹è±¡\n- InitialResourcesï¼šæ ¹æ®é•œåƒçš„å†å²ä½¿ç”¨è®°å½•ï¼Œä¸ºå®¹å™¨è®¾ç½®é»˜è®¤èµ„æºè¯·æ±‚å’Œé™åˆ¶\n- NamespaceLifecycleï¼šç¡®ä¿å¤„äºterminationçŠ¶æ€çš„namespaceä¸å†æ¥æ”¶æ–°çš„å¯¹è±¡åˆ›å»ºè¯·æ±‚ï¼Œå¹¶æ‹’ç»è¯·æ±‚ä¸å­˜åœ¨çš„namespace\n- DefaultStorageClassï¼šä¸ºPVCè®¾ç½®é»˜è®¤StorageClass\n- DefaultTolerationSecondsï¼šè®¾ç½®Podçš„é»˜è®¤forgiveness tolerationä¸º5åˆ†é’Ÿ\n- PodSecurityPolicyï¼šä½¿ç”¨Pod Security Policiesæ—¶å¿…é¡»å¼€å¯\n- NodeRestrictionï¼šé™åˆ¶kubeletä»…å¯è®¿é—®nodeã€endpointã€podã€serviceä»¥åŠsecretã€configmapã€PVå’ŒPVCç­‰ç›¸å…³çš„èµ„æº\n\n## å‡†å…¥æ§åˆ¶æ’ä»¶çš„å¼€å‘\n\né™¤é»˜è®¤çš„å‡†å…¥æ§åˆ¶æ’ä»¶ä»¥å¤–ï¼ŒKubernetesé¢„ç•™äº†å‡†å…¥æ§åˆ¶æ’ä»¶çš„æ‰©å±•ç‚¹ï¼Œç”¨æˆ·å¯è‡ªå®šä¹‰å‡†å…¥æ§åˆ¶æ’ä»¶å®ç°è‡ªå®šä¹‰å‡†å…¥åŠŸèƒ½\n\nMutatingWebhookConfigurationï¼šå˜å½¢æ’ä»¶ï¼Œæ”¯æŒå¯¹å‡†å…¥å¯¹è±¡çš„ä¿®æ”¹\n\nValidatingWebhookConfigurationï¼šæ ¡éªŒæ’ä»¶ï¼Œåªèƒ½å¯¹å‡†å…¥å¯¹è±¡åˆæ³•æ€§è¿›è¡Œæ ¡éªŒï¼Œä¸èƒ½ä¿®æ”¹\n\n![image.png](Extras/Images/image_1665998764708_0.png)\n\n```yaml\n# {{if eq .k8snode_validating \"enabled\"}}\napiVersion: admissionregistration.k8s.io/v1beta1\nkind: MutatingWebhookConfiguration\nmetadata:\n  name: ns-mutating.webhook.k8s.io\nwebhooks:\n- clientConfig:\n  caBundle: {{.serverca_base64}}\n  url: https://admission.local.tess.io/apis/admission.k8s.io/v1alpha1/ ns-mutating\nfailurePolicy: Fail\nname: ns-mutating.webhook.k8s.io\nnamespaceSelector: {}\nrules:\n  - apiGroups:\n    - \"\"\n    apiVersions:\n      - '*'\n    operations:\n      - CREATE\n    resources:\n      - nodes\nsideEffects: Unknown\n# {{end}}\n```\n\n# é™æµ\n\n## è®¡æ•°å™¨å›ºå®šçª—å£ç®—æ³•\n\nåŸç†å°±æ˜¯å¯¹ä¸€æ®µå›ºå®šæ—¶é—´çª—å£å†…çš„è¯·æ±‚è¿›è¡Œè®¡æ•°ï¼Œå¦‚æœè¯·æ±‚æ•°è¶…è¿‡äº†é˜ˆå€¼ï¼Œåˆ™èˆå¼ƒè¯¥è¯·æ±‚ï¼›\nå¦‚æœæ²¡æœ‰è¾¾åˆ°è®¾å®šçš„é˜ˆå€¼ï¼Œåˆ™æ¥å—è¯¥è¯·æ±‚ï¼Œä¸”è®¡æ•°åŠ 1ã€‚\n\nå½“æ—¶é—´çª—å£ç»“æŸæ—¶ï¼Œé‡ç½®è®¡æ•°å™¨ä¸º0ã€‚\n\n![image.png](Extras/Images/image_1666013649334_0.png)\n\n## è®¡æ•°å™¨æ»‘åŠ¨çª—å£ç®—æ³•\n\nåœ¨å›ºå®šçª—å£çš„åŸºç¡€ä¸Šï¼Œå°†ä¸€ä¸ªè®¡æ—¶çª—å£åˆ†æˆäº†è‹¥å¹²ä¸ªå°çª—å£ï¼Œç„¶åæ¯ä¸ªå°çª—å£ç»´æŠ¤ä¸€ä¸ªç‹¬ç«‹çš„è®¡æ•°å™¨ã€‚\n\nå½“è¯·æ±‚çš„æ—¶é—´å¤§äºå½“å‰çª—å£çš„æœ€å¤§æ—¶é—´æ—¶ï¼Œåˆ™å°†è®¡æ—¶çª—å£å‘å‰å¹³ç§»ä¸€ä¸ªå°çª—å£ã€‚\n\nå¹³ç§»æ—¶ï¼Œå°†ç¬¬ä¸€ä¸ªå°çª—å£çš„æ•°æ®ä¸¢å¼ƒï¼Œç„¶åå°†ç¬¬äºŒä¸ªå°çª—å£è®¾ç½®ä¸ºç¬¬ä¸€ä¸ªå°çª—å£ï¼ŒåŒæ—¶åœ¨æœ€åé¢æ–°å¢ä¸€ä¸ªå°çª—å£ï¼Œå°†æ–°çš„è¯·æ±‚æ”¾åœ¨æ–°å¢çš„å°çª—å£ä¸­ã€‚\n\nåŒæ—¶è¦ä¿è¯æ•´ä¸ªçª—å£ä¸­æ‰€æœ‰å°çª—å£çš„è¯·æ±‚æ•°ç›®ä¹‹åä¸èƒ½è¶…è¿‡è®¾å®šçš„é˜ˆå€¼ã€‚\n\n![image.png](Extras/Images/image_1666013698808_0.png)\n\n## æ¼æ–—ç®—æ³•\n\næ¼æ–—ç®—æ³•çš„åŸç†ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ã€‚è¯·æ±‚æ¥äº†ä¹‹åä¼šé¦–å…ˆè¿›åˆ°æ¼æ–—é‡Œï¼Œç„¶åæ¼æ–—ä»¥æ’å®šçš„é€Ÿç‡å°†è¯·æ±‚æµå‡ºè¿›è¡Œå¤„ç†ï¼Œä»è€Œèµ·åˆ°å¹³æ»‘æµé‡çš„ä½œç”¨ã€‚\n\nå½“è¯·æ±‚çš„æµé‡è¿‡å¤§æ—¶ï¼Œæ¼æ–—è¾¾åˆ°æœ€å¤§å®¹é‡æ—¶ä¼šæº¢å‡ºï¼Œæ­¤æ—¶è¯·æ±‚è¢«ä¸¢å¼ƒã€‚\n\nåœ¨ç³»ç»Ÿçœ‹æ¥ï¼Œè¯·æ±‚æ°¸è¿œæ˜¯ä»¥å¹³æ»‘çš„ä¼ è¾“é€Ÿç‡è¿‡æ¥ï¼Œä»è€Œèµ·åˆ°äº†ä¿æŠ¤ç³»ç»Ÿçš„ä½œç”¨ã€‚\n\n![image.png](Extras/Images/image_1666013753347_0.png)\n\n## ä»¤ç‰Œæ¡¶ç®—æ³•\n\nä»¤ç‰Œæ¡¶ç®—æ³•æ˜¯å¯¹æ¼æ–—ç®—æ³•çš„ä¸€ç§æ”¹è¿›ï¼Œé™¤äº†èƒ½å¤Ÿèµ·åˆ°é™æµçš„ä½œç”¨å¤–ï¼Œè¿˜å…è®¸ä¸€å®šç¨‹åº¦çš„æµé‡çªå‘ã€‚\n\nåœ¨ä»¤ç‰Œæ¡¶ç®—æ³•ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªä»¤ç‰Œæ¡¶ï¼Œç®—æ³•ä¸­å­˜åœ¨ä¸€ç§æœºåˆ¶ä»¥æ’å®šçš„é€Ÿç‡å‘ä»¤ç‰Œæ¡¶ä¸­æ”¾å…¥ä»¤ç‰Œã€‚ä»¤ç‰Œæ¡¶ä¹Ÿæœ‰ä¸€å®šçš„å®¹é‡ï¼Œå¦‚æœæ»¡äº†ä»¤ç‰Œå°±æ— æ³•æ”¾è¿›å»äº†ã€‚\n\nå½“è¯·æ±‚æ¥æ—¶ï¼Œä¼šé¦–å…ˆåˆ°ä»¤ç‰Œæ¡¶ä¸­å»æ‹¿ä»¤ç‰Œï¼Œå¦‚æœæ‹¿åˆ°äº†ä»¤ç‰Œï¼Œåˆ™è¯¥è¯·æ±‚ä¼šè¢«å¤„ç†ï¼Œå¹¶æ¶ˆè€—æ‰æ‹¿åˆ°çš„ä»¤ç‰Œï¼›\n\nå¦‚æœä»¤ç‰Œæ¡¶ä¸ºç©ºï¼Œåˆ™è¯¥è¯·æ±‚ä¼šè¢«ä¸¢å¼ƒã€‚\n\n![image.png](Extras/Images/image_1666013871935_0.png)\n\n## ä¼ ç»Ÿé™æµæ–¹æ³•çš„å±€é™æ€§\n\n- ç²’åº¦ç²—\n\t- æ— æ³•ä¸ºä¸åŒç”¨æˆ·ï¼Œä¸åŒåœºæ™¯è®¾ç½®ä¸é€šçš„é™æµ\n- å•é˜Ÿåˆ—\n\t- å…±äº«é™æµçª—å£/æ¡¶ï¼Œä¸€ä¸ªåç”¨æˆ·å¯èƒ½ä¼šå°†æ•´ä¸ªç³»ç»Ÿå µå¡ï¼Œå…¶ä»–æ­£å¸¸ç”¨æˆ·çš„è¯·æ±‚æ— æ³•è¢«åŠæ—¶å¤„ç†\n- ä¸å…¬å¹³\n\t- æ­£å¸¸ç”¨æˆ·çš„è¯·æ±‚ä¼šè¢«æ’åˆ°é˜Ÿå°¾ï¼Œæ— æ³•åŠæ—¶å¤„ç†è€Œé¥¿æ­»\n- æ— ä¼˜å…ˆçº§\n\t- é‡è¦çš„ç³»ç»ŸæŒ‡ä»¤ä¸€å¹¶è¢«é™æµï¼Œç³»ç»Ÿæ•…éšœéš¾ä»¥æ¢å¤\n\n## APIServerä¸­çš„é™æµ\n\n- max-requests-inflightï¼š åœ¨ç»™å®šæ—¶é—´å†…çš„æœ€å¤§ non-mutating è¯·æ±‚æ•°\n- max-mutating-requests-inflightï¼š åœ¨ç»™å®šæ—¶é—´å†…çš„æœ€å¤§ mutating è¯·æ±‚æ•°ï¼Œè°ƒæ•´ apiserver çš„æµæ§ qos\n- ä»£ç \n\t- staging/src/k8s.io/apiserver/pkg/server/filters/maxinflight.go:WithMaxInFlightLimit()\n\n![image.png](Extras/Images/image_1666014967707_0.png)\n\n## API Priority and Fairness\n\n- APF ä»¥æ›´ç»†ç²’åº¦çš„æ–¹å¼å¯¹è¯·æ±‚è¿›è¡Œåˆ†ç±»å’Œéš”ç¦»ã€‚\n- å®ƒè¿˜å¼•å…¥äº†ç©ºé—´æœ‰é™çš„æ’é˜Ÿæœºåˆ¶ï¼Œå› æ­¤åœ¨éå¸¸çŸ­æš‚çš„çªå‘æƒ…å†µä¸‹ï¼ŒAPI æœåŠ¡å™¨ä¸ä¼šæ‹’ç»ä»»ä½•è¯·æ±‚ã€‚\n- é€šè¿‡ä½¿ç”¨å…¬å¹³æ’é˜ŸæŠ€æœ¯ä»é˜Ÿåˆ—ä¸­åˆ†å‘è¯·æ±‚ï¼Œè¿™æ ·ï¼Œ ä¸€ä¸ªè¡Œä¸ºä¸ä½³çš„æ§åˆ¶å™¨å°±ä¸ä¼šé¥¿æ­»å…¶ä»–æ§åˆ¶å™¨ï¼ˆå³ä½¿ä¼˜å…ˆçº§ç›¸åŒï¼‰ã€‚\n- APFçš„æ ¸å¿ƒ\n\t- å¤šç­‰çº§\n\t- å¤šé˜Ÿåˆ—\n\n![image.png](Extras/Images/image_1666015880281_0.png)\n\n---\n\nAPF çš„å®ç°ä¾èµ–ä¸¤ä¸ªéå¸¸é‡è¦çš„èµ„æº FlowSchema, PriorityLevelConfiguration\n\nAPF å¯¹è¯·æ±‚è¿›è¡Œæ›´ç»†ç²’åº¦çš„åˆ†ç±»ï¼Œæ¯ä¸€ä¸ªè¯·æ±‚åˆ†ç±»å¯¹åº”ä¸€ä¸ª FlowSchema (FS)\n\nFS å†…çš„è¯·æ±‚åˆä¼šæ ¹æ® distinguisher è¿›ä¸€æ­¥åˆ’åˆ†ä¸ºä¸åŒçš„ Flow.\n\nFS ä¼šè®¾ç½®ä¸€ä¸ªä¼˜å…ˆçº§ (Priority Level, PL)ï¼Œä¸åŒä¼˜å…ˆçº§çš„å¹¶å‘èµ„æºæ˜¯éš”ç¦»çš„ã€‚æ‰€ä»¥ä¸åŒä¼˜å…ˆçº§çš„èµ„æºä¸ä¼šç›¸äº’æ’æŒ¤ã€‚ç‰¹å®š\n\nä¼˜å…ˆçº§çš„è¯·æ±‚å¯ä»¥è¢«é«˜ä¼˜å¤„ç†ã€‚\n\nä¸€ä¸ª PL å¯ä»¥å¯¹åº”å¤šä¸ª FSï¼ŒPL ä¸­ç»´æŠ¤äº†ä¸€ä¸ª QueueSetï¼Œç”¨äºç¼“å­˜ä¸èƒ½åŠæ—¶å¤„ç†çš„è¯·æ±‚ï¼Œè¯·æ±‚ä¸ä¼šå› ä¸ºè¶…å‡º PL çš„å¹¶å‘é™åˆ¶è€Œè¢«ä¸¢å¼ƒã€‚\n\nFS ä¸­çš„æ¯ä¸ª Flow é€šè¿‡ shuffle sharding ç®—æ³•ä» QueueSet é€‰å–ç‰¹å®šçš„ queues ç¼“å­˜è¯·æ±‚ã€‚\n\næ¯æ¬¡ä» QueueSet ä¸­å–è¯·æ±‚æ‰§è¡Œæ—¶ï¼Œä¼šå…ˆåº”ç”¨ fair queuing ç®—æ³•ä» QueueSet ä¸­é€‰ä¸­ä¸€ä¸ª queueï¼Œç„¶åä»è¿™ä¸ª queueä¸­å–å‡º oldest è¯·æ±‚æ‰§è¡Œã€‚æ‰€ä»¥å³ä½¿æ˜¯åŒä¸€ä¸ª PL å†…çš„è¯·æ±‚ï¼Œä¹Ÿä¸ä¼šå‡ºç°ä¸€ä¸ª Flow å†…çš„è¯·æ±‚ä¸€ç›´å ç”¨èµ„æºçš„ä¸å…¬å¹³ç°è±¡ã€‚\n\n### æ¦‚å¿µ\n\nä¼ å…¥çš„è¯·æ±‚é€šè¿‡ *FlowSchema* æŒ‰ç…§å…¶å±æ€§åˆ†ç±»ï¼Œå¹¶åˆ†é…ä¼˜å…ˆçº§ã€‚\n\næ¯ä¸ªä¼˜å…ˆçº§ç»´æŠ¤è‡ªå®šä¹‰çš„å¹¶å‘é™åˆ¶ï¼ŒåŠ å¼ºäº†éš”ç¦»åº¦ï¼Œè¿™æ ·ä¸åŒä¼˜å…ˆçº§çš„è¯·æ±‚ï¼Œå°±ä¸ä¼šç›¸äº’é¥¿æ­»ã€‚\n\nåœ¨åŒä¸€ä¸ªä¼˜å…ˆçº§å†…ï¼Œå…¬å¹³æ’é˜Ÿç®—æ³•å¯ä»¥é˜²æ­¢æ¥è‡ªä¸åŒ *flow* çš„è¯·æ±‚ç›¸äº’é¥¿æ­»ã€‚\n\nè¯¥ç®—æ³•å°†è¯·æ±‚æ’é˜Ÿï¼Œé€šè¿‡æ’é˜Ÿæœºåˆ¶ï¼Œé˜²æ­¢åœ¨å¹³å‡è´Ÿè½½è¾ƒä½æ—¶ï¼Œé€šä¿¡é‡çªå¢è€Œå¯¼è‡´è¯·æ±‚å¤±è´¥ã€‚\n\n### ä¼˜å…ˆçº§\n\nå¦‚æœæœªå¯ç”¨ APFï¼ŒAPI æœåŠ¡å™¨ä¸­çš„æ•´ä½“å¹¶å‘é‡å°†å—åˆ° kube-apiserver çš„å‚æ•° --max\u0002requests-inflight å’Œ --max-mutating-requests-inflight çš„é™åˆ¶ã€‚\n\nå¯ç”¨ APF åï¼Œå°†å¯¹è¿™äº›å‚æ•°å®šä¹‰çš„å¹¶å‘é™åˆ¶è¿›è¡Œæ±‚å’Œï¼Œç„¶åå°†æ€»å’Œåˆ†é…åˆ°ä¸€ç»„å¯é…ç½®çš„ *ä¼˜å…ˆçº§* ä¸­ã€‚ æ¯ä¸ªä¼ å…¥çš„è¯·æ±‚éƒ½ä¼šåˆ†é…ä¸€ä¸ªä¼˜å…ˆçº§ï¼›\n\næ¯ä¸ªä¼˜å…ˆçº§éƒ½æœ‰å„è‡ªçš„é…ç½®ï¼Œè®¾å®šå…è®¸åˆ†å‘çš„å¹¶å‘è¯·æ±‚æ•°ã€‚\n\nä¾‹å¦‚ï¼Œé»˜è®¤é…ç½®åŒ…æ‹¬é’ˆå¯¹é¢†å¯¼è€…é€‰ä¸¾è¯·æ±‚ã€å†…ç½®æ§åˆ¶å™¨è¯·æ±‚å’Œ Pod è¯·æ±‚éƒ½å•ç‹¬è®¾ç½®ä¼˜å…ˆçº§ã€‚è¿™è¡¨ç¤ºå³ä½¿å¼‚å¸¸çš„ Pod å‘ API æœåŠ¡å™¨å‘é€å¤§é‡è¯·æ±‚ï¼Œä¹Ÿæ— æ³•é˜»æ­¢é¢†å¯¼è€…é€‰ä¸¾æˆ–å†…ç½®æ§åˆ¶å™¨çš„æ“ä½œæ‰§è¡ŒæˆåŠŸã€‚\n\n### æ’é˜Ÿ\n\nå³ä½¿åœ¨åŒä¸€ä¼˜å…ˆçº§å†…ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨å¤§é‡ä¸åŒçš„æµé‡æºã€‚\n\nåœ¨è¿‡è½½æƒ…å†µä¸‹ï¼Œé˜²æ­¢ä¸€ä¸ªè¯·æ±‚æµé¥¿æ­»å…¶ä»–æµæ˜¯éå¸¸æœ‰ä»·å€¼çš„ ï¼ˆå°¤å…¶æ˜¯åœ¨ä¸€ä¸ªè¾ƒä¸ºå¸¸è§çš„åœºæ™¯ä¸­ï¼Œä¸€ä¸ªæœ‰æ•…éšœçš„å®¢æˆ·ç«¯ä¼šç–¯ç‹‚åœ°å‘ kube-apiserver å‘é€è¯·æ±‚ï¼Œ ç†æƒ³æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæœ‰æ•…éšœçš„å®¢æˆ·ç«¯ä¸åº”å¯¹å…¶ä»–å®¢æˆ·ç«¯äº§ç”Ÿå¤ªå¤§çš„å½±å“ï¼‰ã€‚\n\nå…¬å¹³æ’é˜Ÿç®—æ³•åœ¨å¤„ç†å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„è¯·æ±‚æ—¶ï¼Œå®ç°äº†ä¸Šè¿°åœºæ™¯ã€‚\n\næ¯ä¸ªè¯·æ±‚éƒ½è¢«åˆ†é…åˆ°æŸä¸ª æµ ä¸­ï¼Œè¯¥æµç”±å¯¹åº”çš„ FlowSchema çš„åå­—åŠ ä¸Šä¸€ä¸ª æµåŒºåˆ†é¡¹ï¼ˆFlowDistinguisherï¼‰ æ¥æ ‡è¯†ã€‚\n\nè¿™é‡Œçš„æµåŒºåˆ†é¡¹å¯ä»¥æ˜¯å‘å‡ºè¯·æ±‚çš„ç”¨æˆ·ã€ç›®æ ‡èµ„æºçš„åç§°ç©ºé—´æˆ–ä»€ä¹ˆéƒ½ä¸æ˜¯ã€‚\n\nç³»ç»Ÿå°è¯•ä¸ºä¸åŒæµä¸­å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„è¯·æ±‚èµ‹äºˆè¿‘ä¼¼ç›¸ç­‰çš„æƒé‡ã€‚\n\nå°†è¯·æ±‚åˆ’åˆ†åˆ°æµä¸­ä¹‹åï¼ŒAPF åŠŸèƒ½å°†è¯·æ±‚åˆ†é…åˆ°é˜Ÿåˆ—ä¸­ã€‚\n\nåˆ†é…æ—¶ä½¿ç”¨ä¸€ç§ç§°ä¸º æ··æ´—åˆ†ç‰‡ï¼ˆShuffle-Shardingï¼‰ çš„æŠ€æœ¯ã€‚ è¯¥æŠ€æœ¯å¯ä»¥ç›¸å¯¹æœ‰æ•ˆåœ°åˆ©ç”¨é˜Ÿåˆ—éš”ç¦»ä½å¼ºåº¦æµä¸é«˜å¼ºåº¦æµã€‚\n\næ’é˜Ÿç®—æ³•çš„ç»†èŠ‚å¯é’ˆå¯¹æ¯ä¸ªä¼˜å…ˆç­‰çº§è¿›è¡Œè°ƒæ•´ï¼Œå¹¶å…è®¸ç®¡ç†å‘˜åœ¨å†…å­˜å ç”¨ã€ å…¬å¹³æ€§ï¼ˆå½“æ€»æµé‡è¶…æ ‡æ—¶ï¼Œå„ä¸ªç‹¬ç«‹çš„æµå°†éƒ½ä¼šå–å¾—è¿›å±•ï¼‰ã€ çªå‘æµé‡çš„å®¹å¿åº¦ä»¥åŠæ’é˜Ÿå¼•å‘çš„é¢å¤–å»¶è¿Ÿä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚\n\n### è±å…è¯·æ±‚\n\næŸäº›ç‰¹åˆ«é‡è¦çš„è¯·æ±‚ä¸å—åˆ¶äºæ­¤ç‰¹æ€§æ–½åŠ çš„ä»»ä½•é™åˆ¶ã€‚è¿™äº›è±å…å¯é˜²æ­¢ä¸å½“çš„æµæ§é…ç½®å®Œå…¨ç¦ç”¨\nAPI æœåŠ¡å™¨ã€‚\n\n### é»˜è®¤é…ç½®\n\nsystem\n\nç”¨äº system:nodes ç»„ï¼ˆå³ kubeletsï¼‰çš„è¯·æ±‚ï¼› kubelets å¿…é¡»èƒ½è¿ä¸Š API æœåŠ¡å™¨ï¼Œä»¥ä¾¿å·¥ä½œè´Ÿè½½èƒ½å¤Ÿè°ƒåº¦åˆ°å…¶ä¸Šã€‚\n\nleader-election\n\nç”¨äºå†…ç½®æ§åˆ¶å™¨çš„é¢†å¯¼é€‰ä¸¾çš„è¯·æ±‚ ï¼ˆç‰¹åˆ«æ˜¯æ¥è‡ª kube-system åç§°ç©ºé—´ä¸­ system:kube-controller-manager å’Œ system:kube-scheduler ç”¨æˆ·å’ŒæœåŠ¡è´¦å·ï¼Œé’ˆå¯¹ endpointsã€configmaps æˆ– leases çš„è¯·æ±‚ï¼‰ã€‚\n\nå°†è¿™äº›è¯·æ±‚ä¸å…¶ä»–æµé‡ç›¸éš”ç¦»éå¸¸é‡è¦ï¼Œå› ä¸ºé¢†å¯¼è€…é€‰ä¸¾å¤±è´¥ä¼šå¯¼è‡´æ§åˆ¶å™¨å‘ç”Ÿæ•…éšœå¹¶é‡æ–°å¯åŠ¨ï¼Œè¿™åè¿‡æ¥ä¼šå¯¼è‡´æ–°å¯åŠ¨çš„æ§åˆ¶å™¨åœ¨åŒæ­¥ä¿¡æ¯æ—¶ï¼Œæµé‡å¼€é”€æ›´å¤§ã€‚\n\nworkload-high\n\nä¼˜å…ˆçº§ç”¨äºå†…ç½®æ§åˆ¶å™¨çš„è¯·æ±‚ã€‚\n\nworkload-low\n\nä¼˜å…ˆçº§é€‚ç”¨äºæ¥è‡ªä»»ä½•æœåŠ¡å¸æˆ·çš„è¯·æ±‚ï¼Œé€šå¸¸åŒ…æ‹¬æ¥è‡ª Pods ä¸­è¿è¡Œçš„æ§åˆ¶å™¨çš„æ‰€æœ‰è¯·æ±‚ã€‚\n\nglobal-default\n\nä¼˜å…ˆçº§å¯å¤„ç†æ‰€æœ‰å…¶ä»–æµé‡ï¼Œä¾‹å¦‚ï¼šéç‰¹æƒç”¨æˆ·è¿è¡Œçš„äº¤äº’å¼ kubectl å‘½ä»¤ã€‚\n\nexempt\n\nä¼˜å…ˆçº§çš„è¯·æ±‚å®Œå…¨ä¸å—æµæ§é™åˆ¶ï¼šå®ƒä»¬æ€»æ˜¯ç«‹åˆ»è¢«åˆ†å‘ã€‚ ç‰¹æ®Šçš„ exempt FlowSchemaæŠŠ system:masters ç»„çš„æ‰€æœ‰è¯·æ±‚éƒ½å½’å…¥è¯¥ä¼˜å…ˆçº§ç»„ã€‚\n\ncatch-all\n\nä¼˜å…ˆçº§ä¸ç‰¹æ®Šçš„ catch-all FlowSchema ç»“åˆä½¿ç”¨ï¼Œä»¥ç¡®ä¿æ¯ä¸ªè¯·æ±‚éƒ½åˆ†ç±»ã€‚\n\nä¸€èˆ¬ä¸åº”è¯¥ä¾èµ–äº catch-all çš„é…ç½®ï¼Œè€Œåº”é€‚å½“åœ°åˆ›å»ºè‡ªå·±çš„ catch-all FlowSchema å’ŒPriorityLevelConfigurationsï¼ˆæˆ–ä½¿ç”¨é»˜è®¤å®‰è£…çš„ global-default é…ç½®ï¼‰ã€‚\n\nä¸ºäº†å¸®åŠ©æ•è·éƒ¨åˆ†è¯·æ±‚æœªåˆ†ç±»çš„é…ç½®é”™è¯¯ï¼Œå¼ºåˆ¶è¦æ±‚ catch-all ä¼˜å…ˆçº§ä»…å…è®¸5ä¸ªå¹¶å‘ä»½é¢ï¼Œå¹¶ä¸”ä¸å¯¹è¯·æ±‚è¿›è¡Œæ’é˜Ÿï¼Œä½¿å¾—ä»…ä¸ catch-all FlowSchema åŒ¹é…çš„æµé‡è¢«æ‹’ç»çš„å¯èƒ½æ€§æ›´é«˜ï¼Œå¹¶æ˜¾ç¤º HTTP 429 é”™è¯¯ã€‚\n\n### PriorityLevelConfiguration\n\nä¸€ä¸ª PriorityLevelConfiguration è¡¨ç¤ºå•ä¸ªéš”ç¦»ç±»å‹ã€‚\n\næ¯ä¸ª PriorityLevelConfigurations å¯¹æœªå®Œæˆçš„è¯·æ±‚æ•°æœ‰å„è‡ªçš„é™åˆ¶ï¼Œå¯¹æ’é˜Ÿä¸­çš„è¯·æ±‚æ•°ä¹Ÿæœ‰é™åˆ¶ã€‚\n\n![image.png](Extras/Images/image_1666017137479_0.png)\n\n### FlowSchema\n\nFlowSchema åŒ¹é…ä¸€äº›å…¥ç«™è¯·æ±‚ï¼Œå¹¶å°†å®ƒä»¬åˆ†é…ç»™ä¼˜å…ˆçº§ã€‚\n\næ¯ä¸ªå…¥ç«™è¯·æ±‚éƒ½ä¼šå¯¹æ‰€æœ‰ FlowSchema æµ‹è¯•æ˜¯å¦åŒ¹é…ï¼Œ é¦–å…ˆä» matchingPrecedence æ•°å€¼æœ€ä½çš„åŒ¹é…å¼€å§‹ï¼ˆæˆ‘ä»¬è®¤ä¸ºè¿™æ˜¯é€»è¾‘ä¸ŠåŒ¹é…åº¦æœ€é«˜ï¼‰ï¼Œ ç„¶åä¾æ¬¡è¿›è¡Œï¼Œç›´åˆ°é¦–ä¸ªåŒ¹é…å‡ºç°\n\n![image.png](Extras/Images/image_1666017081344_0.png)\n\n### è°ƒè¯•\n\n- /debug/api_priority_and_fairness/dump_priority_levels â€”â€” æ‰€æœ‰ä¼˜å…ˆçº§åŠå…¶å½“å‰çŠ¶æ€çš„åˆ—è¡¨\n\t- kubectl get --raw /debug/api_priority_and_fairness/dump_priority_levels\n- /debug/api_priority_and_fairness/dump_queues â€”â€” æ‰€æœ‰é˜Ÿåˆ—åŠå…¶å½“å‰çŠ¶æ€çš„åˆ—è¡¨\n\t- kubectl get --raw /debug/api_priority_and_fairness/dump_queues\n- /debug/api_priority_and_fairness/dump_requests â€”â€”å½“å‰æ­£åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…çš„æ‰€æœ‰è¯·æ±‚çš„åˆ—è¡¨\n\t- kubectl get --raw /debug/api_priority_and_fairness/dump_requests\n\n# APIServerå¯¹è±¡çš„å®ç°\n\n## æ„å»ºé«˜å¯ç”¨çš„å¤šå‰¯æœ¬apiserver\n\n- apiserveræ˜¯æ— çŠ¶æ€çš„Rest Server\n- æ— çŠ¶æ€æ‰€ä»¥æ–¹ä¾¿Scale Upï¼down\n- è´Ÿè½½å‡è¡¡\n\t- åœ¨å¤šä¸ªapiserverå®ä¾‹ä¹‹ä¸Šï¼Œé…ç½®è´Ÿè½½å‡è¡¡\n\t- è¯ä¹¦å¯èƒ½éœ€è¦åŠ ä¸ŠLoadbalancer VIPé‡æ–°ç”Ÿæˆ\n\n## é¢„ç•™å……è¶³çš„CPUã€å†…å­˜èµ„æº\n\néšç€é›†ç¾¤ä¸­èŠ‚ç‚¹æ•°é‡ä¸æ–­å¢å¤šï¼ŒAPIServerå¯¹CPUå’Œå†…å­˜çš„å¼€é”€ä¹Ÿä¸æ–­å¢å¤§ã€‚è¿‡å°‘çš„CPUèµ„æºä¼šé™ä½å…¶å¤„ç†æ•ˆç‡ï¼Œè¿‡å°‘çš„å†…å­˜èµ„æºä¼šå¯¼è‡´Podè¢«OOMKilledï¼Œç›´æ¥å¯¼è‡´æœåŠ¡ä¸å¯ç”¨ã€‚åœ¨è§„åˆ’APIServerèµ„æºæ—¶ï¼Œä¸èƒ½ä»…çœ‹å½“ä¸‹éœ€æ±‚ï¼Œä¹Ÿè¦ä¸ºæœªæ¥é¢„ç•™å……åˆ†ã€‚\n\n## å–„ç”¨é€Ÿç‡é™åˆ¶ï¼ˆRateLimitï¼‰\n\nAPIServerçš„å‚æ•°â€œ--max-requests-inflightâ€å’Œâ€œ--max-mutating-requests-inflightâ€æ”¯æŒåœ¨ç»™å®šæ—¶é—´å†…é™åˆ¶å¹¶è¡Œå¤„ç†è¯»è¯·æ±‚ï¼ˆåŒ…æ‹¬Getã€Listå’ŒWatchæ“ä½œï¼‰å’Œå†™è¯·æ±‚ï¼ˆåŒ…æ‹¬Createã€Deleteã€Updateå’ŒPatchæ“ä½œï¼‰çš„æœ€å¤§æ•°é‡ã€‚å½“APIServeræ¥æ”¶åˆ°çš„è¯·æ±‚è¶…è¿‡è¿™ä¸¤ä¸ªå‚æ•°è®¾å®šçš„å€¼æ—¶ï¼Œå†æ¥æ”¶åˆ°çš„è¯·æ±‚å°†ä¼šè¢«ç›´æ¥æ‹’ç»ã€‚é€šè¿‡é€Ÿç‡é™åˆ¶æœºåˆ¶ï¼Œå¯ä»¥æœ‰æ•ˆåœ°æ§åˆ¶APIServerå†…å­˜çš„ä½¿ç”¨ã€‚å¦‚æœè¯¥å€¼é…ç½®è¿‡ä½ï¼Œä¼šç»å¸¸å‡ºç°è¯·æ±‚è¶…è¿‡é™åˆ¶çš„é”™è¯¯ï¼Œå¦‚æœé…ç½®è¿‡é«˜ï¼Œåˆ™APIServerå¯èƒ½ä¼šå› ä¸ºå ç”¨è¿‡å¤šå†…å­˜è€Œè¢«å¼ºåˆ¶ç»ˆæ­¢ï¼Œå› æ­¤éœ€è¦æ ¹æ®å®é™…çš„è¿è¡Œç¯å¢ƒï¼Œç»“åˆå®æ—¶ç”¨æˆ·è¯·æ±‚æ•°é‡å’ŒAPIServerçš„èµ„æºé…ç½®è¿›è¡Œè°ƒä¼˜ã€‚\n\nå®¢æˆ·ç«¯åœ¨æ¥æ”¶åˆ°æ‹’ç»è¯·æ±‚çš„è¿”å›å€¼åï¼Œåº”ç­‰å¾…ä¸€æ®µæ—¶é—´å†å‘èµ·é‡è¯•ï¼Œæ— é—´éš”çš„é‡è¯•ä¼šåŠ é‡APIServerçš„å‹åŠ›ï¼Œå¯¼è‡´æ€§èƒ½è¿›ä¸€æ­¥é™ä½ã€‚é’ˆå¯¹å¹¶è¡Œå¤„ç†è¯·æ±‚æ•°çš„è¿‡æ»¤é¢—ç²’åº¦å¤ªå¤§ï¼Œåœ¨è¯·æ±‚æ•°é‡æ¯”è¾ƒå¤šçš„åœºæ™¯ï¼Œé‡è¦çš„æ¶ˆæ¯å¯èƒ½ä¼šè¢«æ‹’ç»æ‰ï¼Œè‡ª1.18ç‰ˆæœ¬å¼€å§‹ï¼Œç¤¾åŒºå¼•å…¥äº†ä¼˜å…ˆçº§å’Œå…¬å¹³ä¿è¯ï¼ˆPriority and Fairnessï¼‰åŠŸèƒ½ï¼Œä»¥æä¾›æ›´ç»†ç²’åº¦åœ°å®¢æˆ·ç«¯è¯·æ±‚æ§åˆ¶ã€‚è¯¥åŠŸèƒ½æ”¯æŒå°†ä¸åŒç”¨æˆ·æˆ–ä¸åŒç±»å‹çš„è¯·æ±‚è¿›è¡Œä¼˜å…ˆçº§å½’ç±»ï¼Œä¿è¯é«˜ä¼˜å…ˆçº§çš„è¯·æ±‚æ€»æ˜¯èƒ½å¤Ÿæ›´å¿«å¾—åˆ°å¤„ç†ï¼Œä»è€Œä¸å—ä½ä¼˜å…ˆçº§è¯·æ±‚çš„å½±å“ã€‚\n\n## è®¾ç½®åˆé€‚çš„ç¼“å­˜å¤§å°\n\nAPIServerä¸etcdä¹‹é—´åŸºäºgRPCåè®®è¿›è¡Œé€šä¿¡ï¼ŒgRPCåè®®ä¿è¯äº†äºŒè€…åœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸­çš„æ•°æ®é«˜é€Ÿä¼ è¾“ã€‚gRPCåŸºäºè¿æ¥å¤ç”¨çš„HTTP/2åè®®ï¼Œå³é’ˆå¯¹ç›¸åŒåˆ†ç»„çš„å¯¹è±¡ï¼ŒAPIServerå’Œetcdä¹‹é—´å…±äº«ç›¸åŒçš„TCPè¿æ¥ï¼Œä¸åŒè¯·æ±‚ç”±ä¸åŒçš„streamä¼ è¾“ã€‚\n\nä¸€ä¸ªHTTP/2è¿æ¥æœ‰å…¶streamé…é¢ ï¼Œé…é¢çš„å¤§å°é™åˆ¶äº†èƒ½æ”¯æŒçš„å¹¶å‘è¯·æ±‚ã€‚APIServeræä¾›äº†é›†ç¾¤å¯¹è±¡çš„ç¼“å­˜æœºåˆ¶ï¼Œå½“å®¢æˆ·ç«¯å‘èµ·æŸ¥è¯¢è¯·æ±‚æ—¶ï¼ŒAPIServeré»˜è®¤ä¼šå°†å…¶ç¼“å­˜ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ç¼“å­˜åŒºå¤§å°å¯ä»¥é€šè¿‡å‚æ•°â€œ--watch-cache-sizesâ€è®¾ç½®ã€‚é’ˆå¯¹è®¿é—®è¯·æ±‚æ¯”è¾ƒå¤šçš„å¯¹è±¡ï¼Œé€‚å½“è®¾ç½®ç¼“å­˜çš„å¤§å°ï¼Œæå¤§é™ä½å¯¹etcdçš„è®¿é—®é¢‘ç‡ï¼ŒèŠ‚çœäº†ç½‘ç»œè°ƒç”¨ï¼Œé™ä½äº†å¯¹etcdé›†ç¾¤çš„è¯»å†™å‹åŠ›ï¼Œä»è€Œæé«˜å¯¹è±¡è®¿é—®çš„æ€§èƒ½ã€‚\n\nä½†æ˜¯APIServerä¹Ÿæ˜¯å…è®¸å®¢æˆ·ç«¯å¿½ç•¥ç¼“å­˜çš„ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯è¯·æ±‚ä¸­ListOptionä¸­æ²¡æœ‰è®¾ç½®resourceVersionï¼Œè¿™æ—¶APIServerç›´æ¥ä»etcdæ‹‰å–æœ€æ–°æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯åº”å°½é‡é¿å…æ­¤æ“ä½œï¼Œåº”åœ¨ListOptionä¸­è®¾ç½®resourceVersionä¸º0ï¼ŒAPIServeråˆ™å°†ä»ç¼“å­˜é‡Œé¢è¯»å–æ•°æ®ï¼Œè€Œä¸ä¼šç›´æ¥è®¿é—®etcdã€‚\n\n## å®¢æˆ·ç«¯å°½é‡ä½¿ç”¨é•¿è¿æ¥\n\nå½“æŸ¥è¯¢è¯·æ±‚çš„è¿”å›æ•°æ®è¾ƒå¤§ä¸”æ­¤ç±»è¯·æ±‚å¹¶å‘é‡è¾ƒå¤§æ—¶ï¼Œå®¹æ˜“å¼•å‘TCPé“¾è·¯çš„é˜»å¡ï¼Œå¯¼è‡´å…¶ä»–æŸ¥è¯¢æ“ä½œè¶…æ—¶ã€‚å› æ­¤åŸºäºKuberneteså¼€å‘ç»„ä»¶æ—¶ï¼Œä¾‹å¦‚æŸäº›DaemonSetå’ŒControllerï¼Œå¦‚æœè¦æŸ¥è¯¢æŸç±»å¯¹è±¡ï¼Œåº”å°½é‡é€šè¿‡é•¿è¿æ¥ListWatchç›‘å¬å¯¹è±¡å˜æ›´ï¼Œé¿å…å…¨é‡ä»APIServerè·å–èµ„æºã€‚å¦‚æœåœ¨åŒä¸€åº”ç”¨ç¨‹åºä¸­ï¼Œå¦‚æœæœ‰å¤šä¸ªInformerç›‘å¬APIServerèµ„æºå˜åŒ–ï¼Œå¯ä»¥å°†è¿™äº›Informeråˆå¹¶ï¼Œå‡å°‘å’ŒAPIServerçš„é•¿è¿æ¥æ•°ï¼Œä»è€Œé™ä½å¯¹APIServerçš„å‹åŠ›ã€‚\n\n## æ­å»ºå¤šç§Ÿæˆ·çš„Kubernetesé›†ç¾¤\n\n- æˆä¿¡\n\t- è®¤è¯ï¼š\n\t\t- ç¦æ­¢åŒ¿åè®¿é—®ï¼Œåªå…è®¸å¯ä¿¡ç”¨æˆ·åšæ“ä½œã€‚\n\t- æˆæƒï¼š\n\t\t- åŸºäºæˆä¿¡çš„æ“ä½œï¼Œé˜²æ­¢å¤šç”¨æˆ·ä¹‹é—´äº’ç›¸å½±å“ï¼Œæ¯”å¦‚æ™®é€šç”¨æˆ·åˆ é™¤Kubernetesæ ¸å¿ƒæœåŠ¡ï¼Œæˆ–è€…Aç”¨æˆ·åˆ é™¤æˆ–ä¿®æ”¹Bç”¨æˆ·çš„åº”ç”¨ã€‚\n- éš”ç¦»\n\t- å¯è§è¡Œéš”ç¦»ï¼š\n\t\t- ç”¨æˆ·åªå…³å¿ƒè‡ªå·±çš„åº”ç”¨ï¼Œæ— éœ€çœ‹åˆ°å…¶ä»–ç”¨æˆ·çš„æœåŠ¡å’Œéƒ¨ç½²ã€‚\n\t- èµ„æºéš”ç¦»ï¼š\n\t\t- æœ‰äº›å…³é”®é¡¹ç›®å¯¹èµ„æºéœ€æ±‚è¾ƒé«˜ï¼Œéœ€è¦ä¸“æœ‰è®¾å¤‡ï¼Œä¸ä¸å…¶ä»–äººå…±äº«ã€‚\n\t- åº”ç”¨è®¿é—®éš”ç¦»ï¼š\n\t\t- ç”¨æˆ·åˆ›å»ºçš„æœåŠ¡ï¼ŒæŒ‰æ—¢å®šè§„åˆ™å…è®¸å…¶ä»–ç”¨æˆ·è®¿é—®ã€‚\n- èµ„æºç®¡ç†\n\t- Quotaç®¡ç†\n\t\t- è°èƒ½ç”¨å¤šå°‘èµ„æºï¼Ÿ\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/CNI":{"title":"CNI","content":"\n# CNI\n\nKubernetes ç½‘ç»œæ¨¡å‹è®¾è®¡çš„åŸºç¡€åŸåˆ™æ˜¯ï¼š\n\n- æ‰€æœ‰çš„ Pod èƒ½å¤Ÿä¸é€šè¿‡ NATå°±èƒ½ç›¸äº’è®¿é—®ã€‚\n- æ‰€æœ‰çš„èŠ‚ç‚¹èƒ½å¤Ÿä¸é€šè¿‡NATå°±èƒ½ç›¸äº’è®¿é—®ã€‚\n- å®¹å™¨å†…çœ‹è§çš„ IPåœ°å€å’Œå¤–éƒ¨ç»„ä»¶çœ‹åˆ°çš„å®¹å™¨ IPæ˜¯ä¸€æ ·çš„ã€‚\n \nKubernetes çš„é›†ç¾¤é‡Œï¼ŒIPåœ°å€æ˜¯ä»¥ Podä¸ºå•ä½è¿›è¡Œåˆ†é…çš„ï¼Œæ¯ä¸ª Podéƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ IPåœ°å€ã€‚ä¸€ä¸ªPodå†…éƒ¨çš„æ‰€æœ‰å®¹å™¨å…±äº«ä¸€ä¸ªç½‘ç»œæ ˆï¼Œå³å®¿ä¸»æœºä¸Šçš„ä¸€ä¸ªç½‘ç»œå‘½åç©ºé—´ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„IP åœ°å€ã€ç½‘ç»œè®¾å¤‡ã€é…ç½®ç­‰éƒ½æ˜¯å…±äº«çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒPod é‡Œé¢çš„æ‰€æœ‰å®¹å™¨èƒ½é€šè¿‡localhost:portæ¥è¿æ¥å¯¹æ–¹ã€‚åœ¨Kubernetesä¸­ï¼Œæä¾›äº†ä¸€ä¸ªè½»é‡çš„é€šç”¨å®¹å™¨ç½‘ç»œæ¥å£ CNIï¼ˆContainer Network Interfaceï¼‰ï¼Œä¸“é—¨ç”¨äºè®¾ç½®å’Œåˆ é™¤å®¹å™¨çš„ç½‘ç»œè¿é€šæ€§ã€‚å®¹å™¨è¿è¡Œæ—¶é€šè¿‡ CNIè°ƒç”¨ç½‘ç»œæ’ä»¶æ¥å®Œæˆå®¹å™¨çš„ç½‘ç»œè®¾ç½®ã€‚\n\n# CNIæ’ä»¶åˆ†ç±»å’Œå¸¸è§æ’ä»¶\n\n- IPAMï¼šIPåœ°å€åˆ†é…\n- ä¸»æ’ä»¶ï¼šç½‘å¡è®¾ç½®\n- bridgeï¼šåˆ›å»ºä¸€ä¸ªç½‘æ¡¥ï¼Œå¹¶æŠŠä¸»æœºç«¯å£å’Œå®¹å™¨ç«¯å£æ’å…¥ç½‘æ¡¥\n- ipvlanï¼šä¸ºå®¹å™¨æ·»åŠ ipvlanç½‘å£\n- loopbackï¼šè®¾ç½®loopbackç½‘å£\n- Metaï¼šé™„åŠ åŠŸèƒ½\n- portmapï¼šè®¾ç½®ä¸»æœºç«¯å£å’Œå®¹å™¨ç«¯å£æ˜ å°„\n- bandwidthï¼šåˆ©ç”¨Linux Traffic Controlé™æµ\n- firewallï¼šé€šè¿‡iptablesæˆ–firewalldä¸ºå®¹å™¨è®¾ç½®é˜²ç«å¢™è§„åˆ™\n\nhttps://ithub.com/containernetworking/plugins\n\n# CNI æ’ä»¶è¿è¡Œæœº\n\nå®¹å™¨è¿è¡Œæ—¶åœ¨å¯åŠ¨æ—¶ä¼šä»CNI çš„é…ç½®ç›®å½•ä¸­è¯»å–JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶åç¼€ä¸º\".conf\"\".conflist\"\".json\"ã€‚å¦‚æœé…ç½®ç›®å½•ä¸­åŒ…å«å¤šä¸ªæ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¼šä»¥åå­—æ’åºé€‰ç”¨ç¬¬ä¸€ä¸ªé…ç½®æ–‡ä»¶ä½œä¸ºé»˜è®¤çš„ç½‘ç»œé…ç½®ï¼Œå¹¶åŠ è½½è·å–å…¶ä¸­æŒ‡å®šçš„CNIæ’ä»¶åç§°å’Œé…ç½®å‚æ•°ã€‚\n\n![image.png](Extras/Images/image_1666107209591_0.png)\n\n# CNI çš„è¿è¡Œæœºåˆ¶\n\nå…³äºå®¹å™¨ç½‘ç»œç®¡ç†ï¼Œå®¹å™¨è¿è¡Œæ—¶ä¸€èˆ¬éœ€è¦é…ç½®ä¸¤ä¸ªå‚æ•°--cni-bin-dir å’Œ--cni-conf-dirã€‚æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œkubelet å†…ç½®çš„ Docker ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ï¼Œæ˜¯ç”±kubeletæ¥æŸ¥æ‰¾CNIæ’ä»¶çš„ï¼Œè¿è¡Œæ’ä»¶æ¥ä¸ºå®¹å™¨è®¾ç½®ç½‘ç»œï¼Œè¿™ä¸¤ä¸ªå‚æ•°åº”è¯¥é…ç½®åœ¨ kubelet å¤„ï¼š\n\n- cni-bin-dirï¼šç½‘ç»œæ’ä»¶çš„å¯æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨ç›®å½•ã€‚é»˜è®¤æ˜¯/opt/cni/binã€‚\n- cni-conf-dirï¼šç½‘ç»œæ’ä»¶çš„é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•ã€‚é»˜è®¤æ˜¯/etc/cni/net.dã€‚\n\n# CNIæ’ä»¶è®¾è®¡è€ƒé‡\n\nå®¹å™¨è¿è¡Œæ—¶å¿…é¡»åœ¨è°ƒç”¨ä»»ä½•æ’ä»¶ä¹‹å‰ä¸ºå®¹å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç»œå‘½åç©ºé—´ã€‚\n\nå®¹å™¨è¿è¡Œæ—¶å¿…é¡»å†³å®šè¿™ä¸ªå®¹å™¨å±äºå“ªäº›ç½‘ç»œï¼Œé’ˆå¯¹æ¯ä¸ªç½‘ç»œï¼Œå“ªäº›æ’ä»¶å¿…é¡»è¦æ‰§è¡Œã€‚\n\nå®¹å™¨è¿è¡Œæ—¶å¿…é¡»åŠ è½½é…ç½®æ–‡ä»¶ï¼Œå¹¶ç¡®å®šè®¾ç½®ç½‘ç»œæ—¶å“ªäº›æ’ä»¶å¿…é¡»è¢«æ‰§è¡Œã€‚\n\nç½‘ç»œé…ç½®é‡‡ç”¨ JSON æ ¼å¼ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ã€‚\n\nå®¹å™¨è¿è¡Œæ—¶å¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œé…ç½®æ–‡ä»¶é‡Œç›¸åº”çš„æ’ä»¶ã€‚\n\nåœ¨å®Œæˆå®¹å™¨ç”Ÿå‘½å‘¨æœŸåï¼Œå®¹å™¨è¿è¡Œæ—¶å¿…é¡»æŒ‰ç…§ä¸æ‰§è¡Œæ·»åŠ å®¹å™¨ç›¸åçš„é¡ºåºæ‰§è¡Œæ’ä»¶ï¼Œä»¥ä¾¿å°†å®¹å™¨ä¸ç½‘ç»œæ–­å¼€è¿æ¥ã€‚\n\nå®¹å™¨è¿è¡Œæ—¶è¢«åŒä¸€å®¹å™¨è°ƒç”¨æ—¶ä¸èƒ½å¹¶è¡Œæ“ä½œï¼Œä½†è¢«ä¸åŒçš„å®¹å™¨è°ƒç”¨æ—¶ï¼Œå…è®¸å¹¶è¡Œæ“ä½œã€‚\n\nå®¹å™¨è¿è¡Œæ—¶é’ˆå¯¹ä¸€ä¸ªå®¹å™¨å¿…é¡»æŒ‰é¡ºåºæ‰§è¡ŒADD å’Œ DELæ“ä½œï¼ŒADDåé¢æ€»æ˜¯è·Ÿç€ç›¸åº”çš„ DELã€‚ DEL å¯èƒ½è·Ÿç€é¢å¤–çš„ DELï¼Œæ’ä»¶åº”è¯¥å…è®¸å¤„ç†å¤šä¸ªDELã€‚\n\nå®¹å™¨å¿…é¡»ç”± ContainerIlD æ¥å”¯ä¸€æ ‡è¯†ï¼Œéœ€è¦å­˜å‚¨çŠ¶æ€çš„æ’ä»¶éœ€è¦ä½¿ç”¨ç½‘ç»œåç§°å®¹å™¨IDå’Œç½‘ç»œæ¥å£ç»„æˆçš„ä¸» keç”¨äºç´¢å¼•ã€‚\n\nå®¹å™¨è¿è¡Œæ—¶é’ˆå¯¹åŒä¸€ä¸ªç½‘ç»œã€åŒä¸€ä¸ªå®¹å™¨ã€åŒä¸€ä¸ªç½‘ç»œæ¥å£ï¼Œä¸èƒ½è¿ç»­è°ƒç”¨ä¸¤æ¬¡ADDå‘½ä»¤ã€‚\n\n# æ‰“é€šä¸»æœºå±‚ç½‘ç»œ\n\nCNIæ’ä»¶å¤–ï¼ŒKubernetes è¿˜éœ€è¦æ ‡å‡†çš„ CNIæ’ä»¶ loï¼Œæœ€ä½ç‰ˆæœ¬ä¸º 0.2.0ç‰ˆæœ¬ã€‚ç½‘ç»œæ’ä»¶é™¤æ”¯æŒè®¾ç½®å’Œæ¸…ç† Pod ç½‘ç»œæ¥å£å¤–ï¼Œè¯¥æ’ä»¶è¿˜éœ€è¦æ”¯æŒIptablesã€‚å¦‚æœKube-proxy å·¥ä½œåœ¨ Iptables æ¨¡å¼ï¼Œç½‘ç»œæ’ä»¶éœ€è¦ç¡®ä¿å®¹å™¨æµé‡èƒ½ä½¿ç”¨Iptables è½¬å‘ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç½‘ç»œæ’ä»¶å°†å®¹å™¨è¿æ¥åˆ°Linux ç½‘æ¡¥ï¼Œå¿…é¡»å°†net/bridge/bridge-nf-call-iptableså‚æ•° sysctlè®¾ç½®ä¸º1ï¼Œç½‘æ¡¥ä¸Šæ•°æ®åŒ…å°†éå† Iptables è§„åˆ™ã€‚å¦‚æœæ’ä»¶ä¸ä½¿ç”¨Linuxæ¡¥æ¥å™¨ï¼ˆè€Œæ˜¯ç±»ä¼¼ Open vSwitch æˆ–å…¶ä»–æŸç§æœºåˆ¶çš„æ’ä»¶ï¼‰ï¼Œåˆ™åº”ç¡®ä¿å®¹å™¨æµé‡è¢«æ­£ç¡®è®¾ç½®äº†è·¯ç”±ã€‚\n\n# CNI Plugin\n\nContainerNetworkingç»„ç»´æŠ¤äº†ä¸€äº›CNIæ’ä»¶ï¼ŒåŒ…æ‹¬ç½‘ç»œæ¥å£åˆ›å»ºçš„ bridgeã€ipvlanã€loopbackã€macvlanã€ptpã€host-device ç­‰ï¼ŒIPåœ°å€åˆ†é…çš„ DHCPã€host-localå’Œ staticï¼Œå…¶ä»–çš„ Flannelï¼Œtunningã€portmapã€firewall ç­‰ã€‚\n\nç¤¾åŒºè¿˜æœ‰äº›ç¬¬ä¸‰æ–¹ç½‘ç»œç­–ç•¥æ–¹é¢çš„æ’ä»¶ï¼Œä¾‹å¦‚Calicoã€Cilium å’Œ Weave ç­‰ã€‚å¯ç”¨é€‰é¡¹çš„å¤šæ ·æ€§æ„å‘³ç€å¤§å¤šæ•°ç”¨æˆ·å°†èƒ½å¤Ÿæ‰¾åˆ°é€‚åˆå…¶å½“å‰éœ€æ±‚å’Œéƒ¨ç½²ç¯å¢ƒçš„ CNIæ’ä»¶ï¼Œå¹¶åœ¨æƒ…å†µå˜åŒ–æ—¶è¿…æ·è½¬æ¢è§£å†³æ–¹æ¡ˆã€‚\n\n# Flannel\n\nFlannelæ˜¯ç”±CoreOSå¼€å‘çš„é¡¹ç›®ï¼Œæ˜¯CNIæ’ä»¶æ—©æœŸçš„å…¥é—¨äº§å“ï¼Œç®€å•æ˜“ç”¨ã€‚\n\nFlannelä½¿ç”¨Kubernetesé›†ç¾¤çš„ç°æœ‰etcdé›†ç¾¤æ¥å­˜å‚¨å…¶çŠ¶æ€ä¿¡æ¯ï¼Œä»è€Œä¸å¿…æä¾›ä¸“ç”¨çš„æ•°æ®å­˜å‚¨ï¼Œåªéœ€è¦åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œflanneldæ¥å®ˆæŠ¤è¿›ç¨‹ã€‚\n\næ¯ä¸ªèŠ‚ç‚¹éƒ½è¢«åˆ†é…ä¸€ä¸ªå­ç½‘ï¼Œä¸ºè¯¥èŠ‚ç‚¹ä¸Šçš„Podåˆ†é…IPåœ°å€ã€‚\n\nåŒä¸€ä¸»æœºå†…çš„Podå¯ä»¥ä½¿ç”¨ç½‘æ¡¥è¿›è¡Œé€šä¿¡ï¼Œè€Œä¸åŒä¸»æœºä¸Šçš„Podå°†é€šè¿‡flanneldå°†å…¶æµé‡å°è£…åœ¨UDPæ•°æ®åŒ…ä¸­ï¼Œä»¥è·¯ç”±åˆ°é€‚å½“çš„ç›®çš„åœ°ã€‚\n\nå°è£…æ–¹å¼é»˜è®¤å’Œæ¨èçš„æ–¹æ³•æ˜¯ä½¿ç”¨VxLANï¼Œå› ä¸ºå®ƒå…·æœ‰è‰¯å¥½çš„æ€§èƒ½ï¼Œå¹¶ä¸”æ¯”å…¶ä»–é€‰é¡¹è¦å°‘äº›äººä¸ºå¹²é¢„ã€‚è™½ç„¶ä½¿ç”¨VXLANä¹‹ç±»çš„æŠ€æœ¯å°è£…çš„è§£å†³æ–¹æ¡ˆæ•ˆæœå¾ˆå¥½ï¼Œä½†ç¼ºç‚¹å°±æ˜¯è¯¥è¿‡ç¨‹ä½¿æµé‡è·Ÿè¸ªå˜å¾—å›°éš¾ã€‚\n\n![image.png](Extras/Images/image_1666108009446_0.png)\n\n# Calico\n\nCalico ä»¥å…¶æ€§èƒ½ã€çµæ´»æ€§å’Œç½‘ç»œç­–ç•¥è€Œé—»åï¼Œä¸ä»…æ¶‰åŠåœ¨ä¸»æœºå’Œ Pod ä¹‹é—´æä¾›ç½‘ç»œè¿æ¥ï¼Œè€Œä¸”è¿˜æ¶‰åŠç½‘ç»œå®‰å…¨æ€§å’Œç­–ç•¥ç®¡ç†ã€‚\n\nå¯¹å¹²åŒç½‘æ®µé€šä¿¡ï¼ŒåŸºäºç¬¬ 3å±‚ï¼ŒCalico ä½¿ç”¨ BGPè·¯ç”±åè®®åœ¨ä¸»æœºä¹‹é—´è·¯ç”±æ•°æ®åŒ…ï¼Œä½¿ç”¨BGPè·¯ç”±åè®®ä¹Ÿæ„å‘³ç€æ•°æ®åŒ…åœ¨ä¸»æœºä¹‹é—´ç§»åŠ¨æ—¶ä¸éœ€è¦åŒ…è£…åœ¨é¢å¤–çš„å°è£…å±‚ä¸­ã€‚\n\nå¯¹äºè·¨ç½‘æ®µé€šä¿¡ï¼ŒåŸºäºIPinIP ä½¿ç”¨è™šæ‹Ÿç½‘å¡è®¾å¤‡ tunlOï¼Œç”¨ä¸€ä¸ªIPæ•°æ®åŒ…å°è£…å¦ä¸€ä¸ªIPæ•°æ®åŒ…ï¼Œå¤–å±‚IPæ•°æ®åŒ…å¤´çš„æºåœ°å€ä¸ºéš§é“å…¥å£è®¾å¤‡çš„ IPåœ°å€ï¼Œç›®æ ‡åœ°å€ä¸ºéš§é“å‡ºå£è®¾å¤‡çš„IPåœ°å€ã€‚\n\nç½‘ç»œç­–ç•¥æ˜¯ Calico æœ€å—æ¬¢è¿çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œä½¿ç”¨ ACLsåè®®å’Œ kube-proxyæ¥åˆ›å»º iptables è¿‡æ»¤è§„åˆ™ï¼Œä»è€Œå®ç°éš”ç¦»å®¹å™¨ç½‘ç»œçš„ç›®çš„ã€‚\n\næ­¤å¤–ï¼ŒCalico è¿˜å¯ä»¥ä¸æœåŠ¡ç½‘æ ¼ Istioé›†æˆï¼Œåœ¨æœåŠ¡ç½‘æ ¼å±‚å’Œç½‘ç»œåŸºç¡€ç»“æ„å±‚ä¸Šè§£é‡Šå’Œå®æ–½é›†ç¾¤ä¸­å·¥ä½œè´Ÿè½½çš„ç­–ç•¥ã€‚\n\nè¿™æ„å‘³ç€æ‚¨å¯ä»¥é…ç½®åŠŸèƒ½å¼ºå¤§çš„è§„åˆ™ï¼Œä»¥æè¿° Pod åº”è¯¥å¦‚ä½•å‘é€å’Œæ¥æ”¶æµé‡ï¼Œæé«˜å®‰å…¨æ€§åŠåŠ å¼ºå¯¹ç½‘ç»œç¯å¢ƒçš„æ§åˆ¶ã€‚\n\nCalico å±äºå®Œå…¨åˆ†å¸ƒå¼çš„æ¨ªå‘æ‰©å±•ç»“æ„ï¼Œå…è®¸å¼€å‘äººå‘˜å’Œç®¡ç†å‘˜å¿«é€Ÿå’Œå¹³ç¨³åœ°æ‰©å±•éƒ¨ç½²è§„æ¨¡ã€‚å¯¹äºæ€§èƒ½å’ŒåŠŸèƒ½ï¼ˆå¦‚ç½‘ç»œç­–ç•¥ï¼‰è¦æ±‚é«˜çš„ç¯å¢ƒï¼ŒCalicO æ˜¯ä¸€ä¸ªä¸é”™é€‰æ‹©ã€‚\n\n# Calicoç»„ä»¶ï¼ˆIPinIPï¼‰\n\n![image.png](Extras/Images/image_1666110657777_0.png)\n\n# Calicoåˆå§‹åŒ–\n\né…ç½®å’ŒCNIäºŒè¿›åˆ¶æ–‡ä»¶ç”±initContaineræ¨é€\n\n```yaml\n- command:\n  - /opt/cni/bin/install\n  env:\n  - name: CNI_CONF_NAME\n    value: 10-calico.conflist\n  - name: SLEEP\n    value: \"false\"\n  - name: CNI_NET_DIR\n    value: /etc/cni/net.d\n  - name: CNI_NETWORK_CONFIG\n    valueFrom:\n      configMapKeyRef:\n        key: config\n        name: cni-config\n  - name: KUBERNETES_SERVICE_HOST\n    value: 10.96.0.1\n  - name: KUBERNETES_SERVICE_PORT\n    value: \"443\"\n  image: docker.io/calico/cni:v3.20.1\n  imagePullPolicy: IfNotPresent\n  name: install-cni\n```\n\n# Calicoé…ç½®ä¸€è§ˆ\n\n```yaml\n{\n    \"name\": \"k8s-pod-network\",\n    \"cniVersion\": \"0.3.1\",\n    \"plugins\": [\n        {\n            \"type\": \"calico\",\n            \"datastore_type\": \"kubernetes\",\n            \"mtu\": 0,\n            \"nodename_file_optional\": false,\n            \"log_level\": \"Info\",\n            \"log_file_path\": \"/var/log/calico/cni/cni.log\",\n            \"ipam\": {\n                \"type\": \"calico-ipam\",\n                \"assign_ipv4\": \"true\",\n                \"assign_ipv6\": \"false\"\n            },\n            \"container_settings\": {\n                \"allow_ip_forwarding\": false\n            },\n            \"policy\": {\n                \"type\": \"k8s\"\n            },\n            \"kubernetes\": {\n                \"k8s_api_root\": \"https://10.96.0.1:443\",\n                \"kubeconfig\": \"/etc/cni/net.d/calico-kubeconfig\"\n            }\n        },\n        {\n            \"type\": \"bandwidth\",\n            \"capabilities\": {\n                \"bandwidth\": true\n            }\n        },\n        {\n            \"type\": \"portmap\",\n            \"snat\": true,\n            \"capabilities\": {\n                \"portMappings\": true\n            }\n        }\n    ]\n}\n```\n\n# Calico VXLan\n\n![image.png](Extras/Images/image_1666111513662_0.png)\n\n# IPPool\n\nIPPoolç”¨æ¥å®šä¹‰ä¸€ä¸ªé›†ç¾¤çš„é¢„å®šä¹‰IPæ®µ\n\n```yaml\napiVersion: crd.projectcalico.org/v1\nkind: IPPool\nmetadata:\n  name: default-ipv4-ippool\nSpec:\n  blockSize: 26\n  cidr: 192.168.0.0/16\n  lipipMode: Never\n  natOutgoing: true\n  nodeSelector: all()\n  vxlanMode: CrossSubnet\n```\n\n# IPAMBlock\n\nIPAMBlockç”¨æ¥å®šä¹‰æ¯ä¸ªä¸»æœºé¢„åˆ†é…çš„IPæ®µ\n\n```yaml\napiVersion: crd.projectcalico.org/v1\nkind: IPAMBlock\nmetadata:\n  annotations:\n  name: 192-168-119-64-26\nSpec:\n  affinity: host:cadmin\n  allocations:\n  - null\n  - 0\n  - null\n  - 1\n  - 2\n  - 3\nattributes:\n  - handle_id: vxlan-tunnel-addr-cadmin\n    secondary:\n      node: cadmin\n      type: vxlanTunnelAddress\n  - handle_id: k8s-pod-network.6680d3883d6150e75ffbd031f86c689a97a5be0f260c6442b2b567c2ca40\n    secondary:\n      namespace: calico-apiserver node:cadmin\n      pod: calico-apiserver-77dffffcdf-g2tcx\n      timestamp: 2021-09-3009:46:57.45651816+0000UTC\n  - handle_id: k8s-pod-network.b10d7702bf334fc55a5e399a731ab3201ea990ale3bc79894abdd712646699\n    secondary:\n      namespace: calico-system\n      node: cadmin\n      pod: calico-kube-controllers-bdd5f97c5-554z5\n      timestamp: 2021-09-3009:46:57.502351346+0000 UTC\n```\n\n# IPAMHandle\n\nIPAMHandleç”¨æ¥è®°å½•IPåˆ†é…çš„å…·ä½“ç»†èŠ‚\n\n```yaml\napiVersion: crd.projectcalico.org/v1\nkind: IPAMHandle\nmetadata:\n  name: k8s-pod-network.8d75b941d85c4998016b72c83f9c5a75512c82c052357daf0ec8e67365635d93\nSpec:\n  block:\n    192.168.119.64/26:1\n  deleted: false\n  handlelD: k8s-pod-network.8d75b941d85c4998016b72c83f9c5a75512c82c052357daf0ec8e67365635d93\n```\n\n# åˆ›å»ºPodå¹¶æŸ¥çœ‹IPé…ç½®æƒ…å†µ\n\n![image.png](Extras/Images/image_1666113174345_0.png)\n\n# CNI pluginçš„å¯¹æ¯”\n\n![image.png](Extras/Images/image_1666113196669_0.png)\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/CRI":{"title":"CRI","content":"\n# CRI\n\nå®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer Runtimeï¼‰ï¼Œè¿è¡ŒäºKubernetesï¼ˆk8sï¼‰é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸­ï¼Œè´Ÿè´£å®¹å™¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚å…¶ä¸­ Docker æ˜¯ç›®å‰åº”ç”¨æœ€å¹¿çš„ã€‚éšç€å®¹å™¨äº‘çš„å‘å±•ï¼Œè¶Šæ¥è¶Šå¤šçš„å®¹å™¨è¿è¡Œæ—¶æ¶Œç°ã€‚ä¸ºäº†è§£å†³è¿™äº›å®¹å™¨è¿è¡Œæ—¶å’Œ Kubernetes çš„é›†æˆé—®é¢˜ï¼Œåœ¨ Kubernetes1.5ç‰ˆæœ¬ä¸­ï¼Œç¤¾åŒºæ¨å‡ºäº†CRIï¼ˆContainer Runtime Interfaceï¼Œå®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼‰ä»¥æ”¯æŒæ›´å¤šçš„å®¹å™¨è¿è¡Œæ—¶ã€‚\n\n![image.png](Extras/Images/image_1666097629440_0.png)\n\n---\n\nCRIæ˜¯ Kuberneteså®šä¹‰çš„ä¸€ç»„ gRPCæœåŠ¡ã€‚kubeletä½œä¸ºå®¢æˆ·ç«¯ï¼ŒåŸºäºgRPCæ¡†æ¶ï¼Œé€šè¿‡ Socket å’Œå®¹å™¨è¿è¡Œæ—¶é€šä¿¡ã€‚ å®ƒåŒ…æ‹¬ä¸¤ç±»æœåŠ¡âˆ¶é•œåƒæœåŠ¡ï¼ˆImage Serviceï¼‰å’Œè¿è¡Œæ—¶æœåŠ¡ï¼ˆRuntime Serviceï¼‰ã€‚ é•œåƒæœåŠ¡æä¾›ä¸‹è½½ã€æ£€æŸ¥å’Œåˆ é™¤é•œåƒçš„è¿œç¨‹ç¨‹åºè°ƒç”¨ã€‚ è¿è¡Œæ—¶æœåŠ¡ åŒ…å«ç”¨äºç®¡ç†å®¹å™¨ç”Ÿå‘½å‘¨æœŸï¼Œä»¥åŠä¸å®¹å™¨äº¤äº’çš„è°ƒç”¨ï¼ˆexeC/ attach/ port-forwardï¼‰çš„è¿œç¨‹ç¨‹åºè°ƒç”¨ã€‚\n\n![image.png](Extras/Images/image_1666097676671_0.png)\n\n# è¿è¡Œæ—¶çš„å±‚çº§\n\nDockershimï¼Œcontainerdå’Œ CRI-O éƒ½æ˜¯éµå¾ªCRI çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬ç§°ä»–ä»¬ä¸º **é«˜å±‚çº§è¿è¡Œæ—¶(High-level Runtime)**ã€‚\n\nOCIï¼ˆOpen Container Initiativeï¼Œå¼€æ”¾å®¹å™¨è®¡åˆ’ï¼‰å®šä¹‰äº†åˆ›å»ºå®¹å™¨çš„æ ¼å¼å’Œè¿è¡Œæ—¶çš„å¼€æºè¡Œä¸šæ ‡å‡†ï¼ŒåŒ…æ‹¬é•œåƒè§„èŒƒï¼ˆImage Specificationï¼‰å’Œè¿è¡Œæ—¶è§„èŒƒï¼ˆRuntime Specificationï¼‰ã€‚\n\né•œåƒè§„èŒƒå®šä¹‰äº† OCI é•œåƒçš„æ ‡å‡†ã€‚é«˜å±‚çº§è¿è¡Œæ—¶å°†ä¼šä¸‹è½½ä¸€ä¸ªOClé•œåƒï¼Œå¹¶æŠŠå®ƒè§£å‹æˆOCl è¿è¡Œæ—¶æ–‡ä»¶ç³»ç»ŸåŒ…ï¼ˆfilesystem bundleï¼‰ã€‚\n\nè¿è¡Œæ—¶è§„èŒƒåˆ™æè¿°äº†å¦‚ä½•ä» OCI è¿è¡Œæ—¶æ–‡ä»¶ç³»ç»ŸåŒ…è¿è¡Œå®¹å™¨ç¨‹åºï¼Œå¹¶ä¸”å®šä¹‰å®ƒçš„é…ç½®ã€è¿è¡Œç¯å¢ƒå’Œç”Ÿå‘½å‘¨æœŸã€‚å¦‚ä½•ä¸ºæ–°å®¹å™¨è®¾ç½®å‘½åç©ºé—´ï¼ˆnamepsacesï¼‰å’Œæ§åˆ¶ç»„ï¼ˆcgroupsï¼‰ï¼Œä»¥åŠæŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿç­‰ç­‰æ“ä½œï¼Œéƒ½æ˜¯åœ¨è¿™é‡Œå®šä¹‰çš„ã€‚å®ƒçš„ä¸€ä¸ªå‚è€ƒå®ç°æ˜¯ runCã€‚æˆ‘ä»¬ç§°å…¶ä¸º **ä½å±‚çº§è¿è¡Œæ—¶ï¼ˆLow-levelRuntimeï¼‰**ã€‚é™¤runCä»¥å¤–ï¼Œä¹Ÿæœ‰å¾ˆå¤šå…¶ä»–çš„è¿è¡Œæ—¶éµå¾ªOCIæ ‡å‡†ï¼Œä¾‹å¦‚ kata-runtime.ã€‚\n\n# CRI\n\nå®¹å™¨è¿è¡Œæ—¶æ˜¯çœŸæ­£èµ·åˆ å’Œç®¡ç†å®¹å™¨çš„ç»„ä»¶ã€‚å®¹å™¨è¿è¡Œæ—¶å¯ä»¥åˆ†ä¸ºé«˜å±‚å’Œä½å±‚çš„è¿è¡Œæ—¶ã€‚é«˜å±‚è¿è¡Œæ—¶ä¸»è¦åŒ…æ‹¬ Dockerï¼Œcontainerdå’Œ CRI-Oï¼Œä½å±‚çš„è¿è¡Œæ—¶ï¼ŒåŒ…å«äº†runcï¼Œkataï¼Œä»¥åŠ gVisorã€‚ä½å±‚è¿è¡Œæ—¶kata å’Œ gVisoréƒ½è¿˜å¤„äºå°è§„æ¨¡è½åœ°æˆ–è€…å®éªŒé˜¶æ®µï¼Œå…¶ç”Ÿæ€æˆç†Ÿåº¦å’Œä½¿ç”¨æ¡ˆä¾‹éƒ½æ¯”è¾ƒæ¬ ç¼ºï¼Œæ‰€ä»¥é™¤éæœ‰ç‰¹æ®Šçš„éœ€æ±‚ï¼Œå¦åˆ™ runc å‡ å¹³æ˜¯å¿…ç„¶çš„é€‰æ‹©ã€‚å› æ­¤åœ¨å¯¹å®¹å™¨è¿è¡Œæ—¶çš„é€‰æ‹©ä¸Šï¼Œä¸»è¦æ˜¯èšç„¦äºä¸Šå±‚è¿è¡Œæ—¶çš„é€‰æ‹©ã€‚\n\nDocker å†…éƒ¨å…³äºå®¹å™¨è¿è¡Œæ—¶åŠŸèƒ½çš„æ ¸å¿ƒç»„ä»¶æ˜¯ containerdï¼Œåæ¥ containerd ä¹Ÿå¯ç›´æ¥å’Œ kubelet é€šè¿‡ CRI å¯¹æ¥ï¼Œç‹¬ç«‹åœ¨ Kubernetesä¸­ä½¿ç”¨ã€‚ç›¸å¯¹äºDocker è€Œè¨€ï¼Œcontainerdå‡å°‘äº†Docker æ‰€éœ€çš„å¤„ç†æ¨¡å— Dockerd å’ŒDocker-shimï¼Œå¹¶ä¸”å¯¹ Docker æ”¯æŒçš„å­˜å‚¨é©±åŠ¨è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå› æ­¤åœ¨å®¹å™¨çš„åˆ›å»ºå¯åŠ¨åœæ­¢å’Œåˆ é™¤ï¼Œä»¥åŠå¯¹é•œåƒçš„æ‹‰å–ä¸Šï¼Œéƒ½å…·æœ‰æ€§èƒ½ä¸Šçš„ä¼˜åŠ¿ã€‚æ¶æ„çš„ç®€åŒ–åŒæ—¶ä¹Ÿå¸¦æ¥äº†ç»´æŠ¤çš„ä¾¿åˆ©ã€‚å½“ç„¶ Docker ä¹Ÿå…·æœ‰å¾ˆå¤š containerd ä¸å…·æœ‰çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ”¯æŒ zfs å­˜å‚¨é©±åŠ¨ï¼Œæ”¯æŒå¯¹æ—¥å¿—çš„å¤§å°å’Œæ–‡ä»¶é™åˆ¶ï¼Œåœ¨ä»¥overlayfs2åšå­˜å‚¨é©±åŠ¨çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡xfs quotaæ¥å¯¹å®¹å™¨çš„å¯å†™å±‚è¿›è¡Œå¤§å°é™åˆ¶ç­‰ã€‚å°½ç®¡å¦‚æ­¤ï¼Œcontainerd ç›®å‰ä¹ŸåŸºæœ¬ä¸Šèƒ½å¤Ÿæ»¡è¶³å®¹å™¨çš„ä¼—å¤šç®¡ç†éœ€æ±‚ï¼Œæ‰€ä»¥å°†å®ƒä½œä¸ºè¿è¡Œæ—¶çš„ä¹Ÿè¶Šæ¥è¶Šå¤šã€‚\n\nKubeletå’Œè¿è¡Œæ—¶çš„å…³ç³»ï¼š\n\n![image.png](Extras/Images/image_1666097993198_0.png)\n\n---\n\n![image.png](Extras/Images/image_1666098015943_0.png)\n\n# å¼€æºè¿è¡Œæ—¶çš„æ¯”è¾ƒ\n\nDocker çš„å¤šå±‚å°è£…å’Œè°ƒç”¨ï¼Œå¯¼è‡´å…¶åœ¨å¯ç»´æŠ¤æ€§ä¸Šç•¥é€Šä¸€ç­¹ï¼Œå¢åŠ äº†çº¿ä¸Šé—®é¢˜çš„å®šä½éš¾åº¦;å‡ ä¹é™¤äº†é‡å¯Dockerï¼Œæˆ‘ä»¬å°±æ¯«æ— ä»–æ³•äº†ã€‚\n\ncontainerdå’Œ CRI-O çš„æ–¹æ¡ˆæ¯”èµ· Docker ç®€æ´å¾ˆå¤šã€‚\n\n![image.png](Extras/Images/image_1666098269820_0.png)\n\n# Dockerå’Œcontainerdçš„å·®å¼‚ç»†èŠ‚\n\n![image.png](Extras/Images/image_1666098300776_0.png)\n\n# å¤šç§è¿è¡Œæ—¶æ€§èƒ½æ¯”è¾ƒ\n\ncontainerdåœ¨å„ä¸ªæ–¹é¢éƒ½è¡¨ç°è‰¯å¥½ï¼Œé™¤äº†å¯åŠ¨å®¹å™¨è¿™é¡¹ã€‚ä»æ€»ç”¨æ—¶æ¥çœ‹ï¼Œcontainerd çš„ç”¨æ—¶è¿˜æ˜¯è¦æ¯”CRI-O è¦çŸ­çš„\n\n![image.png](Extras/Images/image_1666098442449_0.png)\n\n# è¿è¡Œæ—¶ä¼˜åŠ£å¯¹æ¯”\n\nåŠŸèƒ½æ€§æ¥è®²ï¼Œcontainerdå’ŒCRI-Oéƒ½ç¬¦åˆCRIå’Œ OCIçš„æ ‡å‡†ï¼›\n\nåœ¨ç¨³å®šæ€§ä¸Šï¼Œcontainerd ç•¥èƒœä¸€ç­¹ï¼›\n\nä»æ€§èƒ½ä¸Šè®²ï¼Œcontainerdèƒœå‡ºã€‚\n\n![image.png](Extras/Images/image_1666098492945_0.png)\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/CSI":{"title":"CSI","content":"\n# å®¹å™¨è¿è¡Œæ—¶å­˜å‚¨\n\né™¤å¤–æŒ‚å­˜å‚¨å·å¤–ï¼Œå®¹å™¨å¯åŠ¨åï¼Œè¿è¡Œæ—¶æ‰€éœ€æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½ç›´æ¥å½±å“å®¹å™¨æ€§èƒ½ï¼›\n\næ—©æœŸçš„ Docker é‡‡ç”¨ Device Mapper ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶å­˜å‚¨é©±åŠ¨ï¼Œå› ä¸º OverlayFSå°šæœªåˆå¹¶è¿›Kernelï¼›\n\nç›®å‰ Docker å’Œ containerdéƒ½é»˜è®¤ä»¥OverlayFS ä½œä¸ºè¿è¡Œæ—¶å­˜å‚¨é©±åŠ¨ï¼›\n\nOverlayFSç›®å‰å·²ç»æœ‰éå¸¸å¥½çš„æ€§èƒ½ï¼Œä¸DeviceMapper ç›¸æ¯”ä¼˜ 20%ï¼Œä¸æ“ä½œä¸»æœºæ–‡ä»¶æ€§èƒ½å‡ ä¹ä¸€è‡´\n\n# å­˜å‚¨å·æ’ä»¶ç®¡ç†\n\nKubernetesæ”¯æŒä»¥æ’ä»¶çš„å½¢å¼æ¥å®ç°å¯¹ä¸åŒå­˜å‚¨çš„æ”¯æŒå’Œæ‰©å±•ï¼Œè¿™äº›æ‰©å±•åŸºäºå¦‚ä¸‹ä¸‰ç§æ–¹å¼ï¼š\n\n![image.png](Extras/Images/image_1666114625255_0.png)\n\n# out-of-tree CSIæ’ä»¶\n\nCSI é€šè¿‡ RPCä¸å­˜å‚¨é©±åŠ¨è¿›è¡Œäº¤äº’ã€‚\n\nåœ¨è®¾è®¡ CSIçš„æ—¶å€™ï¼ŒKubernetes å¯¹CSIå­˜å‚¨é©±åŠ¨çš„æ‰“åŒ…å’Œéƒ¨ç½²è¦æ±‚å¾ˆå°‘ï¼Œä¸»è¦å®šä¹‰äº†Kubernetes çš„ä¸¤ä¸ªç›¸å…³æ¨¡å—ï¼š\n\n- **kube-controller-managerï¼š**\n\t- kube-controller-manager æ¨¡å—ç”¨äºæ„ŸçŸ¥CSIé©±åŠ¨å­˜åœ¨ã€‚\n\t- Kubernetes çš„ä¸»æ§æ¨¡å—é€šè¿‡Unix domain socketï¼ˆè€Œä¸æ˜¯CSIé©±åŠ¨ï¼‰æˆ–è€…å…¶ä»–æ–¹å¼è¿›è¡Œç›´æ¥åœ°äº¤äº’ã€‚\n\t- Kubernetes çš„ä¸»æ§æ¨¡å—åªä¸ Kubernetesç›¸å…³çš„ APIè¿›è¡Œäº¤äº’ã€‚\n\t- å› æ­¤CSIé©±åŠ¨è‹¥æœ‰ä¾èµ–äºKubernetes API çš„æ“ä½œï¼Œä¾‹å¦‚å·çš„åˆ›å»ºã€å·çš„ attachã€å·çš„å¿«ç…§ç­‰ï¼Œéœ€è¦åœ¨ CSIé©±åŠ¨é‡Œé¢é€šè¿‡Kubernetes çš„ APIï¼Œæ¥è§¦å‘ç›¸å…³çš„CSIæ“ä½œã€‚\n- **kubeletï¼š**\n\t- kubeletæ¨¡å—ç”¨äºä¸ CSIé©±åŠ¨è¿›è¡Œäº¤äº’ã€‚\n\t- kubeleté€šè¿‡ Unix domain socket å‘ CSIé©±åŠ¨å‘èµ· CSI è°ƒç”¨ï¼ˆå¦‚ NodeStageVolumeã€NodePublishVolume ç­‰ï¼‰ï¼Œå†å‘èµ· mount å·å’Œ umountå·ã€‚\n\t- kubeleté€šè¿‡æ’ä»¶æ³¨å†Œæœºåˆ¶å‘ç° CSIé©±åŠ¨åŠç”¨äºå’Œ CSIé©±åŠ¨äº¤äº’çš„ Unix Domain Socketã€‚\n\t- æ‰€æœ‰éƒ¨ç½²åœ¨ Kubernetesé›†ç¾¤ä¸­çš„ CSIé©±åŠ¨éƒ½è¦é€šè¿‡kubelet çš„æ’ä»¶æ³¨å†Œæœºåˆ¶æ¥æ³¨å†Œè‡ªå·±ã€‚\n\n# CSIé©±åŠ¨\n\nCSI çš„é©±åŠ¨ä¸€èˆ¬åŒ…å«external-attacherã€external-provisionerã€external-resizerã€external\u0002snapshotterã€node-driver-registerã€CSI driver ç­‰æ¨¡å—ï¼Œå¯ä»¥æ ¹æ®å®é™…çš„å­˜å‚¨ç±»å‹å’Œéœ€æ±‚è¿›è¡Œä¸åŒæ–¹å¼çš„éƒ¨ç½²ã€‚\n\n![image.png](Extras/Images/image_1666115068189_0.png)\n\n# ä¸´æ—¶å­˜å‚¨\n\nå¸¸è§çš„ä¸´æ—¶å­˜å‚¨ä¸»è¦å°±æ˜¯emptyDir å·ã€‚\n\nemptyDir æ˜¯ä¸€ç§ç»å¸¸è¢«ç”¨æˆ·ä½¿ç”¨çš„å·ç±»å‹ï¼Œé¡¾åæ€ä¹‰ï¼Œ\"å·\"æœ€åˆæ˜¯ç©ºçš„ã€‚å½“ Pod ä»èŠ‚ç‚¹ä¸Šåˆ é™¤æ—¶ï¼ŒemptyDir å·ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ã€‚ä½†å½“ Pod çš„å®¹å™¨å› ä¸ºæŸäº›åŸå› é€€å‡ºå†é‡å¯æ—¶ï¼ŒemptvDir å·å†…çš„æ•°æ®å¹¶ä¸ä¼šä¸¢å¤±ã€‚\n\né»˜è®¤æƒ…å†µä¸‹ï¼ŒemptvDir å·å­˜å‚¨åœ¨æ”¯æŒè¯¥èŠ‚ç‚¹æ‰€ä½¿ç”¨çš„å­˜å‚¨ä»‹è´¨ä¸Šï¼Œå¯ä»¥æ˜¯æœ¬åœ°ç£ç›˜æˆ–ç½‘ç»œå­˜å‚¨ã€‚emptyDir ä¹Ÿå¯ä»¥é€šè¿‡å°† emptyDir.medium å­—æ®µè®¾ç½®ä¸º\"Memory\"æ¥é€šçŸ¥Kubernetesä¸ºå®¹å™¨å®‰è£…tmpfsï¼Œæ­¤æ—¶æ•°æ®è¢«å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé€Ÿåº¦ç›¸å¯¹äºæœ¬åœ°å­˜å‚¨å’Œç½‘ç»œå­˜å‚¨å¿«å¾ˆå¤šã€‚ä½†æ˜¯åœ¨èŠ‚ç‚¹é‡å¯çš„æ—¶å€™ï¼Œå†…å­˜æ•°æ®ä¼šè¢«æ¸…é™¤;è€Œå¦‚æœå­˜åœ¨ç£ç›˜ä¸Šï¼Œåˆ™é‡å¯åæ•°æ®ä¾ç„¶å­˜åœ¨ã€‚å¦å¤–ï¼Œä½¿ç”¨ tmpfs çš„å†…å­˜ä¹Ÿä¼šè®¡å…¥å®¹å™¨çš„ä½¿ç”¨å†…å­˜æ€»é‡ä¸­ï¼Œå—ç³»ç»Ÿçš„Cgroup é™åˆ¶ã€‚\n\nemptyDir è®¾è®¡çš„åˆè¡·ä¸»è¦æ˜¯ç»™åº”ç”¨å……å½“ç¼“å­˜ç©ºé—´ï¼Œæˆ–è€…å­˜å‚¨ä¸­é—´æ•°æ®ï¼Œç”¨äºå¿«é€Ÿæ¢å¤ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸æ˜¯è¯´æ»¡è¶³ä»¥ä¸Šéœ€æ±‚çš„ç”¨æˆ·éƒ½è¢«æ¨èä½¿ç”¨ emptyDirï¼Œæˆ‘ä»¬è¦æ ¹æ®ç”¨æˆ·ä¸šåŠ¡çš„å®é™…ç‰¹ç‚¹æ¥åˆ¤æ–­æ˜¯å¦ä½¿ç”¨emptyDirã€‚å› ä¸º emptyDir çš„ç©ºé—´ä½äºç³»ç»Ÿæ ¹ç›˜ï¼Œè¢«æ‰€æœ‰å®¹å™¨å…±äº«ï¼Œæ‰€ä»¥åœ¨ç£ç›˜çš„ä½¿ç”¨ç‡è¾ƒé«˜æ—¶ä¼šè§¦å‘Pod çš„ eviction æ“ä½œï¼Œä»è€Œå½±å“ä¸šåŠ¡çš„ç¨³å®šã€‚\n\n# åŠæŒä¹…åŒ–å­˜å‚¨\n\nå¸¸è§çš„åŠæŒä¹…åŒ–å­˜å‚¨ä¸»è¦æ˜¯hostPathå·ã€‚hostPathå·èƒ½å°†ä¸»æœºèŠ‚ç‚¹æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•æŒ‚è½½åˆ°æŒ‡å®š Pod ä¸­ã€‚å¯¹æ™®é€šç”¨æˆ·è€Œè¨€ä¸€èˆ¬ä¸éœ€è¦è¿™æ ·çš„å·ï¼Œä½†æ˜¯å¯¹å¾ˆå¤šéœ€è¦è·å–èŠ‚ç‚¹ç³»ç»Ÿä¿¡æ¯çš„Podè€Œè¨€ï¼Œå´æ˜¯éå¸¸å¿…è¦çš„ã€‚\n\nä¾‹å¦‚ï¼ŒhostPath çš„ç”¨æ³•ä¸¾ä¾‹å¦‚ä¸‹ï¼š\n\n- æŸä¸ªPod éœ€è¦è·å–èŠ‚ç‚¹ä¸Šæ‰€æœ‰Pod çš„ logï¼Œå¯ä»¥é€šè¿‡hostPath è®¿é—®æ‰€æœ‰ Pod çš„ stdoutè¾“å‡ºå­˜å‚¨ç›®å½•ï¼Œä¾‹å¦‚/Var/log/pods è·¯å¾„ã€‚\n- æŸä¸ªPod éœ€è¦ç»Ÿè®¡ç³»ç»Ÿç›¸å…³çš„ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ hostPath è®¿é—®ç³»ç»Ÿçš„/procç›®å½•ã€‚\n\nä½¿ç”¨ hostPath çš„æ—¶å€™ï¼Œé™¤è®¾ç½®å¿…éœ€çš„path å±æ€§å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥æœ‰é€‰æ‹©æ€§åœ°ä¸º hostPath å·æŒ‡å®šç±»å‹ï¼Œæ”¯æŒç±»å‹åŒ…å«ç›®å½•ã€å­—ç¬¦è®¾å¤‡ã€å—è®¾å¤‡ç­‰ã€‚\n\n# hostPath å·éœ€è¦æ³¨æ„\n\nä½¿ç”¨åŒä¸€ä¸ªç›®å½•çš„ Pod å¯èƒ½ä¼šç”±äºè°ƒåº¦åˆ°ä¸åŒçš„èŠ‚ç‚¹ï¼Œå¯¼è‡´ç›®å½•ä¸­çš„å†…å®¹æœ‰æ‰€ä¸åŒã€‚\n\nKubernetesåœ¨è°ƒåº¦æ—¶æ— æ³•é¡¾åŠç”± hostPath ä½¿ç”¨çš„èµ„æºã€‚\n\nPodè¢«åˆ é™¤åï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«å¤„ç†ï¼Œé‚£ä¹ˆhostPathä¸Šå†™çš„æ•°æ®ä¼šé—ç•™åˆ°èŠ‚ç‚¹ä¸Šï¼Œå ç”¨ç£ç›˜ç©ºé—´ã€‚\n\n# æŒä¹…åŒ–å­˜å‚¨\n\næ”¯æŒæŒä¹…åŒ–çš„å­˜å‚¨æ˜¯æ‰€æœ‰åˆ†å¸ƒå¼ç³»ç»Ÿæ‰€å¿…å¤‡çš„ç‰¹æ€§ã€‚é’ˆå¯¹æŒä¹…åŒ–å­˜å‚¨ï¼ŒKubernetes å¼•å…¥äº†StorageClassã€Volumeã€PVCï¼ˆPersistent Volume Claimï¼‰ã€PVï¼ˆPersitent Volumeï¼‰çš„æ¦‚å¿µï¼Œå°†å­˜å‚¨ç‹¬ç«‹äº Pod çš„ç”Ÿå‘½å‘¨æœŸæ¥è¿›è¡Œç®¡ç†ã€‚\n\nKuberntes ç›®å‰æ”¯æŒçš„æŒä¹…åŒ–å­˜å‚¨åŒ…å«å„ç§ä¸»æµçš„å—å­˜å‚¨å’Œæ–‡ä»¶å­˜å‚¨ï¼Œè­¬å¦‚ awsElasticBlockStoreã€azureDiskã€cinderã€NFSã€cephfsã€iscsi ç­‰ï¼Œåœ¨å¤§ç±»ä¸Šå¯ä»¥å°†å…¶åˆ†ä¸ºç½‘ç»œå­˜å‚¨å’Œæœ¬åœ°å­˜å‚¨ä¸¤ç§ç±»å‹\n\n## StorageClass\n\nStorageClassç”¨äºæŒ‡ç¤ºå­˜å‚¨çš„ç±»å‹ï¼Œä¸åŒçš„å­˜å‚¨ç±»å‹å¯ä»¥é€šè¿‡ä¸åŒçš„ StorageClass æ¥ä¸ºç”¨æˆ·æä¾›æœåŠ¡ã€‚StorageClass ä¸»è¦åŒ…å«å­˜å‚¨æ’ä»¶ provisionerã€å·çš„åˆ›å»ºå’Œ mount å‚æ•°ç­‰å­—æ®µã€‚\n\n```yaml\nallowVolumeExpansion: true\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  annotations:\n    storageclass.kubernetes.io/is-default-class: \"false\"\n    name: rook-ceph-block\n    parameters:\n      clusterID: rook-ceph\n      csi.storage.k8s.io/controller-expand-secret-name: rook-csi-rbd-provisioner\n      csi.storage.k8s.io/controller-expand-secret-namespace: rook-ceph\n      Csi.storage.k8s.io/fstype: ext4\n      csi.storage.k8s.io/node-stage-secret-name: rook-Csi-rbd-node\n      Csi.storage.k8s.io/node-stage-secret-namespace: rook-Ceph\n      csi.storage.k8s.io/provisioner-secret-name: rook-csi-rbd-provisioner\n      csi.storage.k8s.io/provisioner-secret-namespace: rook-ceph\n      imageFeatures: layering\n      imageFormat: \"2\"\n      pool: replicapool\nprovisioner: rook-ceph.rbd.csi.ceph.com\nreclaimPolicy: Delete\nvolumeBindingMode: Immediate\n```\n\n## PVC\n\nç”±ç”¨æˆ·åˆ›å»ºï¼Œä»£è¡¨ç”¨æˆ·å¯¹å­˜å‚¨éœ€æ±‚çš„å£°æ˜ï¼Œä¸»è¦åŒ…å«éœ€è¦çš„å­˜å‚¨å¤§å°ã€å­˜å‚¨å·çš„è®¿é—®æ¨¡å¼ã€StroageClass ç­‰ç±»å‹ï¼Œå…¶ä¸­å­˜å‚¨å·çš„è®¿é—®æ¨¡å¼å¿…é¡»ä¸å­˜å‚¨çš„ç±»å‹ä¸€è‡´\n\n![image.png](Extras/Images/image_1666116424400_0.png)\n\n## PV\n\nç”±é›†ç¾¤ç®¡ç†å‘˜æå‰åˆ›å»ºï¼Œæˆ–è€…æ ¹æ® PVCçš„ç”³è¯·éœ€æ±‚åŠ¨æ€åœ°åˆ›å»ºï¼Œå®ƒä»£è¡¨ç³»ç»Ÿåç«¯çš„çœŸå®çš„å­˜å‚¨ç©ºé—´ï¼Œå¯ä»¥ç§°ä¹‹ä¸ºå·ç©ºé—´ã€‚\n\n## å­˜å‚¨å¯¹è±¡å…³ç³»\n\nç”¨æˆ·é€šè¿‡åˆ›å»º PVCæ¥ç”³è¯·å­˜å‚¨ã€‚æ§åˆ¶å™¨é€šè¿‡ PVCçš„ StorageClass å’Œè¯·æ±‚çš„å¤§å°å£°æ˜æ¥å­˜å‚¨åç«¯åˆ›å»ºå·ï¼Œè¿›è€Œåˆ›å»º PVï¼ŒPod é€šè¿‡æŒ‡å®š PVCæ¥å¼•ç”¨å­˜å‚¨ã€‚\n\n![image.png](Extras/Images/image_1666116488809_0.png)\n\n# ç”Ÿäº§å®è·µç»éªŒåˆ†äº«\n\nä¸åŒä»‹è´¨ç±»å‹çš„ç£ç›˜ï¼Œéœ€è¦è®¾ç½®ä¸åŒçš„ StorageClassï¼Œä»¥ä¾¿è®©ç”¨æˆ·åšåŒºåˆ†ã€‚StorageClasséœ€è¦è®¾ç½®ç£ç›˜ä»‹è´¨çš„ç±»å‹ï¼Œä»¥ä¾¿ç”¨æˆ·äº†è§£è¯¥ç±»å­˜å‚¨çš„å±æ€§ã€‚\n\nåœ¨æœ¬åœ°å­˜å‚¨çš„ PVé™æ€éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªç‰©ç†ç£ç›˜éƒ½å°½é‡åªåˆ›å»ºä¸€ä¸ª PVï¼Œè€Œä¸æ˜¯åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†åŒºæ¥æä¾›å¤šä¸ªæœ¬åœ°å­˜å‚¨ PVï¼Œé¿å…åœ¨ä½¿ç”¨æ—¶åˆ†åŒºä¹‹é—´çš„I/Oå¹²æ‰°ã€‚\n\næœ¬åœ°å­˜å‚¨éœ€è¦é…åˆç£ç›˜æ£€æµ‹æ¥ä½¿ç”¨ã€‚å½“é›†ç¾¤éƒ¨ç½²è§„æ¨¡åŒ–åï¼Œæ¯ä¸ªé›†ç¾¤çš„æœ¬åœ°å­˜å‚¨ PV å¯èƒ½ä¼šè¶…è¿‡å‡ ä¸‡ä¸ªï¼Œå¦‚ç£ç›˜æŸåå°†æ˜¯é¢‘å‘äº‹ä»¶ã€‚æ­¤æ—¶ï¼Œéœ€è¦åœ¨æ£€æµ‹åˆ°ç£ç›˜æŸåã€ä¸¢ç›˜ç­‰é—®é¢˜åï¼Œå¯¹èŠ‚ç‚¹çš„ç£ç›˜å’Œç›¸åº”çš„æœ¬åœ°å­˜å‚¨ PVè¿›è¡Œç‰¹å®šçš„å¤„ç†ï¼Œä¾‹å¦‚è§¦å‘å‘Šè­¦ã€è‡ªåŠ¨ cordon èŠ‚ç‚¹ã€è‡ªåŠ¨é€šçŸ¥ç”¨æˆ·ç­‰ã€‚\n\nå¯¹å¹²æä¾›æœ¬åœ°å­˜å‚¨èŠ‚ç‚¹çš„ç£ç›˜ç®¡ç†ï¼Œéœ€è¦åšåˆ°çµæ´»ç®¡ç†å’Œè‡ªåŠ¨åŒ–ã€‚èŠ‚ç‚¹ç£ç›˜çš„ä¿¡æ¯å¯ä»¥å½’ä¸€ã€é›†ä¸­åŒ–ç®¡ç†ã€‚åœ¨local-Volume-provisioner ä¸­å¢åŠ éƒ¨ç½²é€»è¾‘ï¼Œå½“å®¹å™¨è¿è¡Œèµ·æ¥æ—¶ï¼Œæ‹‰å–è¯¥èŠ‚ç‚¹éœ€è¦æä¾›æœ¬åœ°å­˜å‚¨çš„ç£ç›˜ä¿¡æ¯ï¼Œä¾‹å¦‚ç£ç›˜çš„è®¾å¤‡è·¯å¾„ï¼Œä»¥Filesystem æˆ– Block çš„æ¨¡å¼æä¾›æœ¬åœ°å­˜å‚¨ï¼Œæˆ–è€…æ˜¯å¦éœ€è¦åŠ å…¥æŸä¸ªLVMçš„è™šæ‹Ÿç»„ï¼ˆVGï¼‰ç­‰ã€‚local-volume-provisioner æ ¹æ®è·å–çš„ç£ç›˜ä¿¡æ¯å¯¹ç£ç›˜è¿›è¡Œæ ¼å¼åŒ–ï¼Œæˆ–è€…åŠ å…¥åˆ°æŸä¸ªVGï¼Œä»è€Œå½¢æˆå¯¹æœ¬åœ°å­˜å‚¨æ”¯æŒçš„è‡ªåŠ¨åŒ–é—­ç¯ã€‚\n\n# ç‹¬å çš„ Local Volume\n\nåˆ›å»º PVï¼šé€šè¿‡local-volume-provisioner DaemonSetåˆ›å»ºæœ¬åœ°å­˜å‚¨çš„PVã€‚\nåˆ›å»ºPVCï¼šç”¨æˆ·åˆ›å»ºPVCï¼Œç”±äºå®ƒå¤„äºpendingçŠ¶æ€ï¼Œæ‰€ä»¥kube-controller-managerå¹¶ä¸ä¼šå¯¹è¯¥PVCåšä»»ä½•æ“ä½œã€‚\n\nåˆ›å»ºPodï¼šç”¨æˆ·åˆ›å»ºPodã€‚\n\nPodæŒ‘é€‰èŠ‚ç‚¹ï¼škube-schedulerå¼€å§‹è°ƒåº¦Podï¼Œé€šè¿‡PVCçš„resources.request.storageå’ŒvolumeModeé€‰æ‹©æ»¡è¶³æ¡ä»¶çš„PVï¼Œå¹¶ä¸”ä¸ºPodé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„èŠ‚ç‚¹ã€‚\n\næ›´æ–°PVï¼škube-schedulerå°†PVçš„pv.Spec.claimRefè®¾ç½®ä¸ºå¯¹åº”çš„PVCï¼Œå¹¶ä¸”è®¾ç½® `annotation pv.kubernetes.io/bound-by-controller` çš„å€¼ä¸ºâ€œyesâ€ã€‚\n\nPVCå’ŒPVç»‘å®šï¼špv_controlleråŒæ­¥PVCå’ŒPVçš„çŠ¶æ€ï¼Œå¹¶å°†PVCå’ŒPVè¿›è¡Œç»‘å®šã€‚\n\nç›‘å¬PVCå¯¹è±¡ï¼škube-schedulerç­‰å¾…PVCçš„çŠ¶æ€å˜æˆ BoundçŠ¶æ€ã€‚\n\nPod è°ƒåº¦åˆ°èŠ‚ç‚¹ï¼šå¦‚æœPVCçš„çŠ¶æ€å˜ä¸ºBoundåˆ™è¯´æ˜è°ƒåº¦æˆåŠŸï¼Œè€Œå¦‚æœPVCä¸€ç›´å¤„äºpendingçŠ¶æ€ï¼Œè¶…æ—¶åä¼šå†æ¬¡è¿›è¡Œè°ƒåº¦ã€‚\n\nMount å·å¯åŠ¨å®¹å™¨ï¼škubelet ç›‘å¬åˆ°æœ‰Pod å·²ç»è°ƒåº¦åˆ°èŠ‚ç‚¹ä¸Šï¼Œå¯¹æœ¬åœ°å­˜å‚¨è¿›è¡Œmountæ“ä½œï¼Œå¹¶å¯åŠ¨å®¹å™¨ã€‚\n\n![image.png](Extras/Images/image_1666116919277_0.png)\n\n# Dynamic Local Volume\n\nCSIé©±åŠ¨éœ€è¦æ±‡æŠ¥èŠ‚ç‚¹ä¸Šç›¸å…³å­˜å‚¨çš„èµ„æºä¿¡æ¯ï¼Œä»¥ä¾¿ç”¨äºè°ƒåº¦ä½†æ˜¯æœºå™¨çš„å‚å®¶ä¸åŒï¼Œæ±‡æŠ¥æ–¹å¼ä¹Ÿä¸åŒã€‚\n\nä¾‹å¦‚ï¼Œæœ‰çš„å‚å®¶çš„æœºå™¨èŠ‚ç‚¹ä¸Šå…·æœ‰ NVMeã€SSDã€HDDç­‰å¤šç§å­˜å‚¨ä»‹è´¨ï¼Œå¸Œæœ›å°†è¿™äº›å­˜å‚¨ä»‹è´¨åˆ†åˆ«è¿›è¡Œæ±‡æŠ¥ã€‚\n\nè¿™ç§éœ€æ±‚æœ‰åˆ«äºå…¶ä»–å­˜å‚¨ç±»å‹çš„ CSIé©±åŠ¨å¯¹æ¥å£çš„éœ€æ±‚ï¼Œå› æ­¤å¦‚ä½•æ±‡æŠ¥èŠ‚ç‚¹çš„å­˜å‚¨ä¿¡æ¯ï¼Œä»¥åŠå¦‚ä½•è®©èŠ‚ç‚¹çš„å­˜å‚¨ä¿¡æ¯åº”ç”¨äºè°ƒåº¦ï¼Œç›®å‰å¹¶æ²¡æœ‰å½¢æˆç»Ÿä¸€çš„æ„è§ã€‚\n\né›†ç¾¤ç®¡ç†å‘˜å¯ä»¥åŸºäºèŠ‚ç‚¹å­˜å‚¨çš„å®é™…æƒ…å†µå¯¹å¼€æºCSI é©±åŠ¨å’Œè°ƒåº¦è¿›è¡Œä¸€äº›ä»£ç ä¿®æ”¹ï¼Œå†è¿›è¡Œéƒ¨ç½²å’Œä½¿ç”¨\n\n# Local Dynamic çš„æŒ‚è½½æµç¨‹\n\nåˆ›å»ºPVCï¼šç”¨æˆ·åˆ›å»ºPVCï¼ŒPVCå¤„äºpendingçŠ¶æ€ã€‚\n\nåˆ›å»ºPodï¼šç”¨æˆ·åˆ›å»ºPodã€‚\n\nPod é€‰æ‹©èŠ‚ç‚¹ï¼škube-schedulerå¼€å§‹è°ƒåº¦Podï¼Œé€šè¿‡PVCçš„pvc.spec.resources.request.storageç­‰é€‰æ‹©æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ã€‚\n\næ›´æ–°PVCï¼šé€‰æ‹©èŠ‚ç‚¹åï¼Œkube-schedulerä¼šç»™PVCæ·»åŠ åŒ…å«èŠ‚ç‚¹ä¿¡æ¯çš„ `annotationâˆ¶ volume.kubernetes.io/selected-nodeâˆ¶\u003cèŠ‚ç‚¹åå­—\u003e`ã€‚\n\nåˆ›å»ºå·ï¼šè¿è¡Œåœ¨èŠ‚ç‚¹ä¸Šçš„å®¹å™¨ external-provisioner ç›‘å¬åˆ°PVCå¸¦æœ‰è¯¥èŠ‚ç‚¹ç›¸å…³çš„annotationï¼Œå‘ç›¸åº”çš„CSIé©±åŠ¨ç”³è¯·åˆ†é…å·ã€‚\n\nåˆ›å»ºPVï¼šPVCç”³è¯·åˆ°æ‰€éœ€çš„å­˜å‚¨ç©ºé—´åï¼Œexternal-provisioneråˆ›å»ºPVï¼Œè¯¥PVçš„pv.Spec.claimRefè®¾ç½®ä¸ºå¯¹åº”çš„PVCã€‚\n\nPVCå’ŒPVç»‘å®šï¼škube-controller-managerå°†PVCå’ŒPVè¿›è¡Œç»‘å®šï¼ŒçŠ¶æ€ä¿®æ”¹ä¸º Boundã€‚\n\nç›‘å¬PVCçŠ¶æ€ï¼škube-schedulerç­‰å¾…PVCå˜æˆBoundçŠ¶æ€ã€‚\n\nPodè°ƒåº¦åˆ°èŠ‚ç‚¹ï¼šå½“PVCçš„çŠ¶æ€ä¸ºBoundæ—¶ï¼ŒPodæ‰ç®—çœŸæ­£è°ƒåº¦æˆåŠŸäº†ã€‚å¦‚æœPVCä¸€ç›´å¤„äºPendingçŠ¶æ€ï¼Œè¶…æ—¶åä¼šå†æ¬¡è¿›è¡Œè°ƒåº¦ã€‚\n\nMountå·ï¼škubeletç›‘å¬åˆ°æœ‰Podå·²ç»è°ƒåº¦åˆ°èŠ‚ç‚¹ä¸Šï¼Œå¯¹æœ¬åœ°å­˜å‚¨è¿›è¡Œmountæ“ä½œã€‚\n\nå¯åŠ¨å®¹å™¨ï¼šå¯åŠ¨å®¹å™¨ã€‚\n\n![image.png](Extras/Images/image_1666117282847_0.png)\n\n# Local Dynamic çš„æŒ‘æˆ˜\n\nå¦‚æœå°†ç£ç›˜ç©ºé—´ä½œä¸ºä¸€ä¸ªå­˜å‚¨æ± ï¼ˆä¾‹å¦‚LVMï¼‰æ¥åŠ¨æ€åˆ†é…ï¼Œé‚£ä¹ˆåœ¨åˆ†é…å‡ºæ¥çš„é€»è¾‘å·ç©ºé—´çš„ä½¿ç”¨ä¸Šï¼Œå¯èƒ½ä¼šå—åˆ°å…¶ä»–é€»è¾‘å·çš„I/Oå¹²æ‰°ï¼Œå› ä¸ºåº•å±‚çš„ç‰©ç†å·å¯èƒ½æ˜¯åŒä¸€ä¸ªã€‚\n\nå¦‚æœ PVåç«¯çš„ç£ç›˜ç©ºé—´æ˜¯ä¸€å—ç‹¬ç«‹çš„ç‰©ç†ç£ç›˜ï¼Œåˆ™I/O å°±ä¸ä¼šå—åˆ°å¹²æ‰°ã€‚\n\n# ç”Ÿäº§å®è·µç»éªŒåˆ†äº«\n\nä¸åŒä»‹è´¨ç±»å‹çš„ç£ç›˜ï¼Œéœ€è¦è®¾ç½®ä¸åŒçš„ StorageClassï¼Œä»¥ä¾¿è®©ç”¨æˆ·åšåŒºåˆ†ã€‚StorageClasséœ€è¦è®¾ç½®ç£ç›˜ä»‹è´¨çš„ç±»å‹ï¼Œä»¥ä¾¿ç”¨æˆ·äº†è§£è¯¥ç±»å­˜å‚¨çš„å±æ€§ã€‚\n\nåœ¨æœ¬åœ°å­˜å‚¨çš„ PV é™æ€éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªç‰©ç†ç£ç›˜éƒ½å°½é‡åªåˆ›å»ºä¸€ä¸ªPVï¼Œè€Œä¸æ˜¯åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†åŒºæ¥æä¾›å¤šä¸ªæœ¬åœ°å­˜å‚¨ PVï¼Œé¿å…åœ¨ä½¿ç”¨æ—¶åˆ†åŒºä¹‹é—´çš„I/O å¹²æ‰°ã€‚\n\næœ¬åœ°å­˜å‚¨éœ€è¦é…åˆç£ç›˜æ£€æµ‹æ¥ä½¿ç”¨ã€‚å½“é›†ç¾¤éƒ¨ç½²è§„æ¨¡åŒ–åï¼Œæ¯ä¸ªé›†ç¾¤çš„æœ¬åœ°å­˜å‚¨ PV å¯èƒ½ä¼šè¶…è¿‡å‡ ä¸‡ä¸ªï¼Œå¦‚ç£ç›˜æŸåå°†æ˜¯é¢‘å‘äº‹ä»¶ã€‚æ­¤æ—¶ï¼Œéœ€è¦åœ¨æ£€æµ‹åˆ°ç£ç›˜æŸåã€ä¸¢ç›˜ç­‰é—®é¢˜åï¼Œå¯¹èŠ‚ç‚¹çš„ç£ç›˜å’Œç›¸åº”çš„æœ¬åœ°å­˜å‚¨ PVè¿›è¡Œç‰¹å®šçš„å¤„ç†ï¼Œä¾‹å¦‚è§¦å‘å‘Šè­¦ã€è‡ªåŠ¨ cordon èŠ‚ç‚¹ã€è‡ªåŠ¨é€šçŸ¥ç”¨æˆ·ç­‰ã€‚\n\nå¯¹äºæä¾›æœ¬åœ°å­˜å‚¨èŠ‚ç‚¹çš„ç£ç›˜ç®¡ç†ï¼Œéœ€è¦åšåˆ°çµæ´»ç®¡ç†å’Œè‡ªåŠ¨åŒ–ã€‚èŠ‚ç‚¹ç£ç›˜çš„ä¿¡æ¯å¯ä»¥å½’ä¸€ã€é›†ä¸­åŒ–ç®¡ç†ã€‚åœ¨ loCal-Volume-proVisioner ä¸­å¢åŠ éƒ¨ç½²é€»è¾‘ï¼Œå½“å®¹å™¨è¿è¡Œèµ·æ¥æ—¶ï¼Œæ‹‰å–è¯¥èŠ‚ç‚¹éœ€è¦æä¾›æœ¬åœ°å­˜å‚¨çš„ç£ç›˜ä¿¡æ¯ï¼Œä¾‹å¦‚ç£ç›˜çš„è®¾å¤‡è·¯å¾„ï¼Œä»¥Filesystem æˆ– Block çš„æ¨¡å¼æä¾›æœ¬åœ°å­˜å‚¨ï¼Œæˆ–è€…æ˜¯å¦éœ€è¦åŠ å…¥æŸä¸ªLVMçš„è™šæ‹Ÿç»„ï¼ˆVGï¼‰ç­‰ã€‚local-volume-provisioneræ ¹æ®è·å–çš„ç£ç›˜ä¿¡æ¯å¯¹ç£ç›˜è¿›è¡Œæ ¼å¼åŒ–ï¼Œæˆ–è€…åŠ å…¥åˆ°æŸä¸ªVGï¼Œä»è€Œå½¢æˆå¯¹æœ¬åœ°å­˜å‚¨æ”¯æŒçš„è‡ªåŠ¨åŒ–é—­ç¯ã€‚\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/Controller-Manager":{"title":"Controller Manager","content":"\n# æ§åˆ¶å™¨çš„å·¥ä½œæµç¨‹\n\n![image.png](Extras/Images/image_1666083933125_0.png)\n\n# Informer çš„å†…éƒ¨æœºåˆ¶\n\n![image.png](Extras/Images/image_1666084265391_0.png)\n\n# æ§åˆ¶å™¨çš„ååŒå·¥ä½œåŸç†\n\n![image.png](Extras/Images/image_1666084297645_0.png)\n\n# é€šç”¨ Controller\n\nJob Controllerï¼šå¤„ç†jobã€‚\n\nPod AutoScalerï¼šå¤„ç† pod çš„è‡ªåŠ¨ç¼©å®¹/æ‰©å®¹ã€‚\n\nRelicaSetï¼šä¾æ® Replicaset Spec åˆ›å»º Podã€‚\n\nService Controllerï¼šä¸º LoadBalancer type çš„ service åˆ›å»ºLB VIPã€‚\n\nServiceAccount Controllerï¼šç¡®ä¿serviceaccountåœ¨å½“å‰namespaceå­˜åœ¨ã€‚\n\nStatefulSet Controllerï¼šå¤„ç† statefulset ä¸­çš„ podã€‚\n\nVolume Controllerï¼šä¾æ® PV specåˆ›å»º volumeã€‚\n\nResource quota Controllerï¼šåœ¨ç”¨æˆ·ä½¿ç”¨èµ„æºä¹‹åï¼Œæ›´æ–°çŠ¶æ€ã€‚\n\nNamespace Controllerï¼šä¿è¯namespaceåˆ é™¤æ—¶ï¼Œè¯¥namespaceä¸‹çš„æ‰€æœ‰èµ„æºéƒ½å…ˆè¢«åˆ é™¤\n\nReplication Controllerï¼šåˆ›å»º RCåï¼Œè´Ÿè´£åˆ›å»º PODã€‚\n\nNode Controllerï¼šç»´æŠ¤ node çŠ¶æ€ï¼Œå¤„ç† evict è¯·æ±‚ç­‰ã€‚\n\nDaemon Controllerï¼šä¾æ® damonsetåˆ›å»º podã€‚\n\nDeployment Controllerï¼šä¾æ® deployment specåˆ›å»º replicasetã€‚\n\nEndpoint Controllerï¼šä¾æ® service specåˆ›å»ºendpointï¼Œä¾æ® podip æ›´æ–° endpointã€‚\n\nGarbage Collectorï¼šå¤„ç†çº§è”åˆ é™¤ï¼Œæ¯”å¦‚åˆ é™¤ deployment çš„åŒæ—¶åˆ é™¤replicaset ä»¥åŠpodã€‚\n\nCronJob Controllerï¼šå¤„ç† cronjobã€‚\n\n# Cloud Controller Manager\n\n**ä»€ä¹ˆæ—¶å€™éœ€è¦ cloud controller manager?**\n\nCloud Controller Manager è‡ªKubernetes1.6å¼€å§‹ï¼Œä»kube-controller-managerä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä¸»è¦å› ä¸º Cloud Controller Managerå¾€å¾€éœ€è¦è·Ÿä¼ä¸š cloud åšæ·±åº¦é›†æˆï¼Œrelease cycle è·ŸKubernetesç›¸å¯¹ç‹¬ç«‹ã€‚\n\nä¸Kubernetesæ ¸å¿ƒç®¡ç†ç»„ä»¶ä¸€èµ·å‡çº§æ˜¯ä¸€ä»¶è´¹æ—¶è´¹åŠ›çš„äº‹ã€‚\n\n**é€šå¸¸ cloud controller manager éœ€è¦ï¼š**\n\nè®¤è¯æˆæƒï¼šä¼ä¸š cloud å¾€å¾€éœ€è¦è®¤è¯ä¿¡æ¯ï¼ŒKubernetesè¦ä¸Cloud APIé€šä¿¡ï¼Œéœ€è¦è·å–cloudç³»ç»Ÿé‡Œçš„ ServiceAccountï¼›\n\nCloud controller manager æœ¬èº«ä½œä¸ºä¸€ä¸ªç”¨æˆ·æ€çš„ componentï¼Œéœ€è¦åœ¨Kubernetesä¸­æœ‰æ­£ç¡®çš„RBACè®¾ç½®ï¼Œè·å¾—èµ„æºæ“ä½œæƒé™ï¼›\n\né«˜å¯ç”¨ï¼šéœ€è¦é€šè¿‡ leader electionæ¥ç¡®ä¿ cloud controller manger é«˜å¯ç”¨ã€‚\n\n# Cloud controller manager çš„é…ç½®\n\n- cloud controller manager æ˜¯ä»è€ç‰ˆæœ¬çš„ APIServer åˆ†ç¦»å‡ºæ¥çš„ã€‚\n\t- Kube-APIServerå’Œkube-controller-managerä¸­ä¸€å®šä¸èƒ½æŒ‡å®šcloud-providerï¼Œå¦åˆ™ä¼šåŠ è½½å†…ç½®çš„ cloud controller managerã€‚\n\t- Kubelet è¦é…ç½®--cloud-provider=externalã€‚\n- Cloud Controller Manager ä¸»è¦æ”¯æŒï¼š\n\t- Node controllerï¼šè®¿é—® cloud APIï¼Œæ¥æ›´æ–°node çŠ¶æ€ï¼›åœ¨ cloudåˆ é™¤è¯¥èŠ‚ç‚¹ä»¥åï¼Œä»kubernetesåˆ é™¤ nodeï¼›\n\t- Service controllerï¼šè´Ÿè´£é…ç½®ä¸º loadbalancerç±»å‹çš„æœåŠ¡é…ç½®LB VIPï¼›\n\t- Route Controllerï¼šåœ¨ cloud ç¯å¢ƒé…ç½®è·¯ç”±ï¼›\n\t- å¯ä»¥è‡ªå®šä¹‰ä»»ä½•éœ€è¦çš„ Cloud Controllerã€‚\n\n# éœ€è¦å®šåˆ¶çš„ Cloud controller\n\n- Ingress controllerï¼›\n- Service Controllerï¼›\n- è‡ªä¸»ç ”å‘çš„ controllerï¼Œæ¯”å¦‚ä¹‹å‰æåˆ°çš„ï¼š\n\t- RBAC controllerï¼›\n\t- Account controllerã€‚\n\n# æ¥è‡ªç”Ÿäº§çš„ç»éªŒ\n\n- ä¿æŠ¤å¥½ controller manager çš„ kubeconfigï¼š\n\t- æ­¤ kubeconfigæ‹¥æœ‰æ‰€æœ‰èµ„æºçš„æ‰€æœ‰æ“ä½œæƒé™ï¼Œé˜²æ­¢æ™®é€šç”¨æˆ·é€šè¿‡ kubectl exec kube\u0002Controller-manager cat è·å–è¯¥æ–‡ä»¶ã€‚\n\t- ç”¨æˆ·å¯èƒ½åšä»»ä½•ä½ æƒ³è±¡ä¸åˆ°çš„æ“ä½œï¼Œç„¶åæ¥æ‰¾ä½  supportã€‚\n- Pod evict å IPå‘ç”Ÿå˜åŒ–ï¼Œä½†endpoint ä¸­çš„ address æ›´æ–°å¤±è´¥ï¼š\n\t- åˆ†æ stacktraceå‘ç° endpointåœ¨æ›´æ–°LoadBalancer æ—¶è°ƒç”¨gophercloud è¿æ¥ hangä½ï¼Œå¯¼è‡´ endpoint workerçº¿ç¨‹å…¨éƒ¨å¡æ­»ã€‚\n\n# ç¡®ä¿ scheduler å’Œ controller çš„é«˜å¯ç”¨\n\nLeader Election\n\nKubenetesæä¾›åŸºäºconfigmap å’Œ endpoint çš„ leader electionç±»åº“\n\nKubernetesé‡‡ç”¨leader electionæ¨¡å¼å¯åŠ¨componentåï¼Œä¼šåˆ›å»ºå¯¹åº”endpointï¼Œå¹¶æŠŠå½“å‰çš„leader ä¿¡æ¯ annotate åˆ° endponit ä¸Š\n\n```yaml\napiversion: v1\nkind: Endpoints\nmetadata:\n  annotations:\n    control-plane.alpha.kubernetes.io/leader: '\"holderldentity\":\"minikube\",leaseDurationSeconds\":15,\"acquireTime\":\"2018-04-05T17:31:29Z\",\"renewTime\":\"2018-04-07T07:18:39Z\",\"leaderTransitions\":0}'\n  creationTimestamp: 2018-04-05T17:31:29Z\n  name: kube-scheduler\n  namespace: kube-system\n  resourceVersion: \"138930\"\n  selfLink: /api/v1/namespaces/kube-system/endpoints/kube-scheduler\n  uid: 2d12578d-38f7-11e8-8df0-0800275259e5\nsubsets: null\n```\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/Headless":{"title":"Headless","content":"\n# Headlesså’ŒClusterIPçš„åŒºåˆ«\n\nCoreDNSçš„ä½œç”¨ï¼šåœ¨K8Sé‡Œï¼Œæˆ‘ä»¬æƒ³è¦é€šè¿‡nameæ¥è®¿é—®æœåŠ¡çš„æ–¹å¼å°±æ˜¯åœ¨Deploymentä¸Šé¢æ·»åŠ ä¸€å±‚Serviceï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡Service nameæ¥è®¿é—®æœåŠ¡äº†ï¼Œé‚£å…¶ä¸­çš„åŸç†å°±æ˜¯å’ŒCoreDNSæœ‰å…³ï¼Œå®ƒå°†Service nameè§£ææˆCluster IPã€‚\n\nè¿™æ ·æˆ‘ä»¬è®¿é—®Cluster IPçš„æ—¶å€™å°±é€šè¿‡Cluster IPä½œè´Ÿè½½å‡è¡¡ï¼ŒæŠŠæµé‡åˆ†å¸ƒåˆ°å„ä¸ªPODä¸Šé¢ã€‚\n\nK8sä¸­èµ„æºçš„å…¨å±€FQDNæ ¼å¼:  \n```\nã€€ã€€Service_NAME.NameSpace_NAME.Domain.LTD.  \nã€€ã€€Domain.LTD.=svc.cluster.local.ã€€ã€€ã€€ã€€ #è¿™æ˜¯é»˜è®¤k8sé›†ç¾¤çš„åŸŸåã€‚\n```\n\n## ClusterIP\n\n`ClusterIP`çš„åŸç†ï¼šä¸€ä¸ª`Service`å¯èƒ½å¯¹åº”å¤šä¸ª`EndPoint(Pod)`ï¼Œ`client`è®¿é—®çš„æ˜¯`Cluster IP`ï¼Œé€šè¿‡`iptables`è§„åˆ™è½¬åˆ°`Real Server`ï¼Œä»è€Œè¾¾åˆ°è´Ÿè½½å‡è¡¡çš„æ•ˆæœã€‚\n\n![[Extras/Images/Pasted image 20230402230548.png]]\n\nä»ä¸Šé¢çš„ç»“æœä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è™½ç„¶`Service`æœ‰2ä¸ª`endpoint`ï¼Œä½†æ˜¯`dns`æŸ¥è¯¢æ—¶åªä¼šè¿”å›`Service`çš„åœ°å€ã€‚å…·ä½“`client`è®¿é—®çš„æ˜¯å“ªä¸ª`Real Server`ï¼Œæ˜¯ç”±`iptables`æ¥å†³å®šçš„ã€‚\n\n## Headless\n\n![[Extras/Images/Pasted image 20230402230702.png]]\n\n`dns`æŸ¥è¯¢ä¼šå¦‚å®çš„è¿”å›2ä¸ªçœŸå®çš„`endpoint`ã€‚\n\n## Headlessä½¿ç”¨åœºæ™¯\n\næœ‰çŠ¶æ€åº”ç”¨ï¼Œä¾‹å¦‚æ•°æ®åº“ã€‚\n\nä¾‹å¦‚ä¸»èŠ‚ç‚¹å¯ä»¥å¯¹æ•°æ®åº“è¿›è¡Œè¯»å†™æ“ä½œï¼Œè€Œå…¶å®ƒçš„ä¸¤ä¸ªå·¥ä½œèŠ‚ç‚¹åªèƒ½è¯»ï¼Œåœ¨è¿™é‡Œå®¢æˆ·ç«¯å°±æ²¡å¿…è¦æŒ‡å®špodæœåŠ¡çš„é›†ç¾¤åœ°å€ï¼Œç›´æ¥æŒ‡å®šæ•°æ®åº“Pod ipåœ°å€å³å¯ï¼Œè¿™é‡Œéœ€è¦ç»‘å®šdnsï¼Œå®¢æˆ·ç«¯è®¿é—®dnsï¼Œdnsä¼šè‡ªåŠ¨è¿”å›pod IPåœ°å€åˆ—è¡¨\n\n![[Extras/Images/Pasted image 20230402230927.png]]\n\n---\n\nç¬¬ä¸€ç§ï¼šè‡ªä¸»é€‰æ‹©æƒï¼Œæœ‰æ—¶å€™`client`æƒ³è‡ªå·±æ¥å†³å®šä½¿ç”¨å“ªä¸ª`Real Server`ï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢`DNS`æ¥è·å–`Real Server`çš„ä¿¡æ¯ã€‚\n\nç¬¬äºŒç§ï¼š`Headless Service`çš„å¯¹åº”çš„æ¯ä¸€ä¸ª`Endpoints`ï¼Œå³æ¯ä¸€ä¸ª`Pod`ï¼Œéƒ½ä¼šæœ‰å¯¹åº”çš„`DNS`åŸŸåï¼›è¿™æ ·`Pod`ä¹‹é—´å°±èƒ½äº’ç›¸è®¿é—®ï¼Œé›†ç¾¤ä¹Ÿèƒ½å•ç‹¬è®¿é—®podã€‚\n\n![[Extras/Images/Pasted image 20230402230752.png]]\n\n## æ€»ç»“\n\n-   æ— å¤´æœåŠ¡ä¸éœ€è¦æŒ‡å®šé›†ç¾¤åœ°å€\n-   æ— å¤´æœåŠ¡é€‚ç”¨æœ‰çŠ¶æ€åº”ç”¨ä¾‹å¦‚æ•°æ®åº“\n-   æ— å¤´æœåŠ¡dnsæŸ¥è¯¢ä¼šè¿”å›podåˆ—è¡¨ï¼Œå¼€å‘äººå‘˜å¯ä»¥è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥\n-   æ™®é€šServiceå¯ä»¥é€šè¿‡è´Ÿè½½å‡è¡¡è·¯ç”±åˆ°ä¸åŒçš„å®¹å™¨åº”ç”¨","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/K0S":{"title":"K0S","content":"\n## å®‰è£…K0S\n\n\u003e https://docs.k0sproject.io/v1.23.6+k0s.2/install/\n\n1. `curl -sSLf [https://get.k0s.sh](https://get.k0s.sh) | sudo sh`\n2. `sudo k0s install controller --single`\n3. `sudo k0s start`\n4. `sudo k0s status`\n5. `sudo k0s kubectl get nodes`\n\n## å¸è½½K0S\n\n1. sudo k0s stop\n2. sudo k0s reset\n3. reboot system\n\n\u003eğŸ’¡ A few small k0s fragments persist even after the reset (for example, iptables). As such, you should initiate a reboot after the running of theÂ `k0s reset`Â command.\n\n## åˆ›å»ºç”¨æˆ·ä¸kubeconfig\n\n`sudo k0s kubeconfig create --groups \"system:masters\" petrus \u003e k0s.config`\n\n`sudo k0s kubectl create clusterrolebinding --kubeconfig k0s.config petrus-admin-binding --clusterrole=admin --user=petrus`\n\nå°†ç”Ÿæˆçš„kubeconfig `k0s.config` åˆå¹¶åˆ°å®¢æˆ·ç«¯æœºå™¨çš„ `~/.kube/config`\n\n## æŸ¥çœ‹å½“å‰CNI\n\nkubectl get pods -n kube-system\n\n## é…ç½®æ–‡ä»¶\n\n\u003e https://docs.k0sproject.io/v1.23.6+k0s.2/configuration/\n\n```\nk0s config create \u003e /etc/k0s/k0s.yaml\n```","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/Kubelet":{"title":"Kubelet","content":"\n# kubelet æ¶æ„\n\n![image.png](Extras/Images/image_1666095908370_0.png)\n\n# kubelet ç®¡ç† Pod çš„æ ¸å¿ƒæµç¨‹\n\n![image.png](Extras/Images/image_1666095931705_0.png)\n\n# kubelet\n\næ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œä¸€ä¸ªkubelet æœåŠ¡è¿›ç¨‹ï¼Œé»˜è®¤ç›‘å¬ 10250ç«¯å£ã€‚\n\n- æ¥æ”¶å¹¶æ‰§è¡Œ master å‘æ¥çš„æŒ‡ä»¤ï¼›\n- ç®¡ç† PodåŠPod ä¸­çš„å®¹å™¨ï¼›\n- æ¯ä¸ªkubelet è¿›ç¨‹ä¼šåœ¨API Server ä¸Šæ³¨å†ŒèŠ‚ç‚¹è‡ªèº«ä¿¡æ¯ï¼Œå®šæœŸå‘ master èŠ‚ç‚¹æ±‡æŠ¥èŠ‚ç‚¹çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œå¹¶é€šè¿‡ cAdvisorç›‘æ§èŠ‚ç‚¹å’Œå®¹å™¨çš„èµ„æºã€‚\n\n# èŠ‚ç‚¹ç®¡ç†\n\nèŠ‚ç‚¹ç®¡ç†ä¸»è¦æ˜¯èŠ‚ç‚¹è‡ªæ³¨å†Œå’ŒèŠ‚ç‚¹çŠ¶æ€æ›´æ–°ï¼š\n\n- Kubelet å¯ä»¥é€šè¿‡è®¾ç½®å¯åŠ¨å‚æ•°--register-node æ¥ç¡®å®šæ˜¯å¦å‘ API Server æ³¨å†Œè‡ªå·±ï¼›\n- å¦‚æœKubelet æ²¡æœ‰é€‰æ‹©è‡ªæ³¨å†Œæ¨¡å¼ï¼Œåˆ™éœ€è¦ç”¨æˆ·è‡ªå·±é…ç½® Node èµ„æºä¿¡æ¯ï¼ŒåŒæ—¶éœ€è¦å‘ŠçŸ¥Kubeleté›†ç¾¤ä¸Šçš„AP| Server çš„ä½ç½®ï¼›\n- Kubeletåœ¨å¯åŠ¨æ—¶é€šè¿‡ API Server æ³¨å†ŒèŠ‚ç‚¹ä¿¡æ¯ï¼Œå¹¶å®šæ—¶å‘API Server å‘é€èŠ‚ç‚¹æ–°æ¶ˆæ¯ï¼ŒAPIServer åœ¨æ¥æ”¶åˆ°æ–°æ¶ˆæ¯åï¼Œå°†ä¿¡æ¯å†™å…¥ etcdã€‚\n\n# Podç®¡ç†\n\nè·å–Podæ¸…å•ï¼š\n\n- æ–‡ä»¶ï¼šå¯åŠ¨å‚æ•°--configæŒ‡å®šçš„é…ç½®ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼ˆé»˜è®¤/etc/Kubernetes/manifests/ï¼‰ã€‚è¯¥æ–‡ä»¶æ¯20ç§’é‡æ–°æ£€æŸ¥ä¸€æ¬¡ï¼ˆå¯é…ç½®ï¼‰ã€‚\n- HTTPendpointï¼ˆURLï¼‰ï¼šå¯åŠ¨å‚æ•°--manifest-urlè®¾ç½®ã€‚æ¯ 20ç§’æ£€é¦™ä¸€æ¬¡è¿™ä¸ªç«¯ç‚¹ï¼ˆå¯é…ç½®)ã€‚\n- API Serverï¼šé€šè¿‡ API Serverç›‘å¬ etcd ç›®å½•ï¼ŒåŒæ­¥ Pod æ¸…å•ã€‚\n- HTTP serverï¼škubeletä¾¦å¬ HTTPè¯·æ±‚ï¼Œå¹¶å“åº”ç®€å•çš„ API ä»¥æäº¤æ–°çš„ Pod æ¸…å•ã€‚\n\n# Podå¯åŠ¨æµç¨‹\n\n![image.png](Extras/Images/image_1666096575505_0.png)\n\n# Kubeletå¯åŠ¨Podçš„æµç¨‹\n\n![image.png](Extras/Images/image_1666097329536_0.png)\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/Service":{"title":"Service","content":"\n# Serviceå¯¹è±¡\n\n- Service Selector\n\t- Kuberneteså…è®¸å°†Podå¯¹è±¡é€šè¿‡æ ‡ç­¾ï¼ˆLabelï¼‰è¿›è¡Œæ ‡è®°ï¼Œå¹¶é€šè¿‡Service Selectorå®šä¹‰åŸºäºPodæ ‡ç­¾çš„è¿‡æ»¤è§„åˆ™ï¼Œä»¥ä¾¿é€‰æ‹©æœåŠ¡çš„ä¸Šæ¸¸åº”ç”¨å®ä¾‹\n- Ports\n\t- Portså±æ€§ä¸­å®šä¹‰äº†æœåŠ¡çš„ç«¯å£ã€åè®®ç›®æ ‡ç«¯å£ç­‰ä¿¡æ¯\n\n```yaml\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx-service\nSpec:\n  selector:\n    app: nginx\n  ports:\n    - protocol: TCP\n      port: 80\n      targetPort: 80\n```\n\n# Endpointå¯¹è±¡\n\n- å½“Serviceçš„selectorä¸ä¸ºç©ºæ—¶ï¼ŒKubernetes EndpointControllerä¼šä¾¦å¬æœåŠ¡åˆ›å»ºäº‹ä»¶ï¼Œåˆ›å»ºä¸ServiceåŒåçš„Endpointå¯¹è±¡\n- selectorèƒ½å¤Ÿé€‰å–çš„æ‰€æœ‰PodIPéƒ½ä¼šè¢«é…ç½®åˆ°addresseså±æ€§ä¸­\n\t- å¦‚æœæ­¤æ—¶selectoræ‰€å¯¹åº”çš„filteræŸ¥è¯¢ä¸åˆ°å¯¹åº”çš„Podï¼Œåˆ™addressesåˆ—è¡¨ä¸ºç©º\n\t- é»˜è®¤é…ç½®ä¸‹ï¼Œå¦‚æœæ­¤æ—¶å¯¹åº”çš„Podä¸ºnot readyçŠ¶æ€ï¼Œåˆ™å¯¹åº”çš„PodIPåªä¼šå‡ºç°åœ¨subsetsçš„notReadyAddresseså±æ€§ä¸­ï¼Œè¿™æ„å‘³ç€å¯¹åº”çš„Podè¿˜æ²¡å‡†å¤‡å¥½æä¾›æœåŠ¡ï¼Œä¸èƒ½ä½œä¸ºæµé‡è½¬å‘çš„ç›®æ ‡ã€‚\n\t- å¦‚æœè®¾ç½®äº†PublishNotReadyAdddressä¸ºtrueï¼Œåˆ™æ— è®ºPodæ˜¯å¦å°±ç»ªéƒ½ä¼šè¢«åŠ å…¥readyAddress list\n\n```yaml\napiVersion: v1\nkind: Endpoint\nmetadata:\n  name: nginx-service\nsubsets:\n  - addresses:\n    - ip: 10.1.1.21\n      nodeName: minikube\n      targetRef:\n        kind: Pod\n        name: nginx-deployment-5754944d6c-hnw27\n        namespace: default\n        resourceVersion: \"722191\"\n        uid: 8a3390ae-2f8e-47bf-b8dd-70fae7fb0d32\n```\n\n# EndpointSliceå¯¹è±¡\n\nå½“æŸä¸ªServiceå¯¹åº”çš„backend Podè¾ƒå¤šæ—¶ï¼ŒEndpointå¯¹è±¡å°±ä¼šå› ä¿å­˜çš„åœ°å€ä¿¡æ¯è¿‡å¤šè€Œå˜å¾—å¼‚å¸¸åºå¤§\n\nPodçŠ¶æ€çš„å˜æ›´ä¼šå¼•èµ·Endpointçš„å˜æ›´ï¼ŒEndpointçš„å˜æ›´ä¼šè¢«æ¨é€è‡³æ‰€æœ‰èŠ‚ç‚¹ï¼Œä»è€Œå¯¼è‡´æŒç»­å ç”¨å¤§é‡ç½‘ç»œå¸¦å®½\n\nEndpointSliceå¯¹è±¡ï¼Œç”¨äºå¯¹Podè¾ƒå¤šçš„Endpointè¿›è¡Œåˆ‡ç‰‡ï¼Œåˆ‡ç‰‡å¤§å°å¯ä»¥è‡ªå®šä¹‰\n\n```yaml\napiVersion: discovery.k8s.io/v1betal\nkind: EndpointSlice\nmetadata:\n  name: example-abc\n  labels:\n    kubernetes.io/service-name: example\naddressType: IPv4\nports:\n\nname: http\n    protocol: TCP\n    port: 80\nendpoints:\n\naddresses:\n\n\"10.1.2.3\"\n    conditions:\n      ready: true\n      hostname: pod-1\n      topology:\n        kubernetes.io/hostname: node-1\n        topology.kubernetes.io/zone: us-west2-a\n```\n\n# ä¸å®šä¹‰Selectorçš„Service\n\n- ç”¨æˆ·åˆ›å»ºäº†Serviceä½†ä¸å®šä¹‰Selector\n\t- Endpoint Controllerä¸ä¼šä¸ºè¯¥Serviceè‡ªåŠ¨åˆ›å»ºEndpoint\n\t- ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨åˆ›å»ºEndpointå¯¹è±¡ï¼Œå¹¶è®¾ç½®ä»»æ„IPåœ°å€åˆ°Addresså±æ€§\n\t- è®¿é—®è¯¥æœåŠ¡çš„è¯·æ±‚ä¼šè¢«è½¬å‘è‡³ç›®æ ‡åœ°å€\n- é€šè¿‡è¯¥ç±»å‹æœåŠ¡ï¼Œå¯ä»¥ä¸ºé›†ç¾¤å¤–çš„ä¸€ç»„Endpointåˆ›å»ºæœåŠ¡\n\n# Serviceã€Endpointå’ŒPodçš„å¯¹åº”å…³ç³»\n\n![image.png](Extras/Images/image_1666193739512_0.png)\n\n# Serviceç±»å‹\n\n- clusterIP\n\t- Serviceçš„é»˜è®¤ç±»å‹ï¼ŒæœåŠ¡è¢«å‘å¸ƒè‡³ä»…é›†ç¾¤å†…éƒ¨å¯è§çš„è™šæ‹ŸIPåœ°å€ä¸Šã€‚\n\t- åœ¨API Serverå¯åŠ¨æ—¶ï¼Œéœ€è¦é€šè¿‡service-cluster-ip-rangeå‚æ•°é…ç½®è™šæ‹ŸIPåœ°å€æ®µï¼ŒAPI Serverä¸­æœ‰ç”¨å¹²åˆ†é…IPåœ°å€å’Œç«¯å£çš„ç»„ä»¶ï¼Œå½“è¯¥ç»„ä»¶æ•è·Serviceå¯¹è±¡å¹¶åˆ›å»ºäº‹ä»¶æ—¶ï¼Œä¼šä»é…ç½®çš„è™šæ‹ŸIPåœ°å€æ®µä¸­å–ä¸€ä¸ªæœ‰æ•ˆçš„IPåœ°å€ï¼Œåˆ†é…ç»™è¯¥Serviceå¯¹è±¡ã€‚\n- nodePort\n\t- åœ¨APIServerå¯åŠ¨æ—¶ï¼Œéœ€è¦é€šè¿‡node-port-rangeå‚æ•°é…ç½®nodePortçš„èŒƒå›´ï¼ŒåŒæ ·çš„ï¼ŒAPIServerç»„ä»¶ä¼šæ•è·Serviceå¯¹è±¡å¹¶åˆ›å»ºäº‹ä»¶ï¼Œå³ä»é…ç½®å¥½çš„nodePortèŒƒå›´å–ä¸€ä¸ªæœ‰æ•ˆç«¯å£ï¼Œåˆ†é…ç»™è¯¥Serviceã€‚\n\t- æ¯ä¸ªèŠ‚ç‚¹çš„kube-proxyä¼šå°è¯•åœ¨æœåŠ¡åˆ†é…çš„nodePortä¸Šå»ºç«‹ä¾¦å¬å™¨æ¥æ”¶è¯·æ±‚ï¼Œå¹¶è½¬å‘ç»™æœåŠ¡å¯¹åº”çš„åç«¯Podå®ä¾‹ã€‚\n- LoadBalancer\n\t- ä¼ä¸šæ•°æ®ä¸­å¿ƒä¸€èˆ¬ä¼šé‡‡è´­ä¸€äº›è´Ÿè½½å‡è¡¡å™¨ï¼Œä½œä¸ºå¤–ç½‘è¯·æ±‚è¿›å…¥æ•°æ®ä¸­å¿ƒå†…éƒ¨çš„ç»Ÿä¸€æµé‡å…¥å£ã€‚\n\t- é’ˆå¯¹ä¸åŒçš„åŸºç¡€æ¶æ„äº‘å¹³å°ï¼ŒKubernertes Cloud Manageræä¾›æ”¯æŒä¸åŒä¾›åº”å•†APIçš„ServiceControllerã€‚å¦‚æœéœ€è¦åœ¨Openstackäº‘å¹³å°ä¸Šæ­å»ºKubernetesé›†ç¾¤ï¼Œé‚£ä¹ˆåªéœ€æä¾›ä¸€openstack.rcï¼ŒOpenstack Service Controllerå³å¯é€šè¿‡è°ƒç”¨LBaaS APIå®Œæˆè´Ÿè½½å‡è¡¡é…ç½®ã€‚\n\n# å…¶ä»–ç±»å‹æœåŠ¡\n\n- Headless Service\n\t- HeadlessæœåŠ¡æ˜¯ç”¨æˆ·å°†clusterIPæ˜¾ç¤ºå®šä¹‰ä¸ºNoneçš„æœåŠ¡ã€‚\n\t- æ— å¤´çš„æœåŠ¡æ„å‘³ç€Kubernetesä¸ä¼šä¸ºè¯¥æœåŠ¡åˆ†é…ç»Ÿä¸€å…¥å£ï¼ŒåŒ…æ‹¬clusterIPï¼ŒnodePortç­‰\n- ExternalName Service\n\t- ä¸ºä¸€ä¸ªæœåŠ¡åˆ›å»ºåˆ«å\n\n# Service Topology\n\nä¸€ä¸ªç½‘ç»œè°ƒç”¨çš„å»¶è¿Ÿå—å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ‰€å¤„ä½ç½®çš„å½±å“ï¼Œä¸¤è€…æ˜¯å¦åœ¨åŒä¸€èŠ‚ç‚¹ã€åŒä¸€æœºæ¶ã€åŒä¸€å¯ç”¨åŒºã€åŒä¸€æ•°æ®ä¸­å¿ƒï¼Œéƒ½ä¼šå½±å“å‚ä¸æ•°æ®ä¼ è¾“çš„è®¾å¤‡æ•°é‡\n\nåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸ºä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨ï¼Œå¾€å¾€éœ€è¦æ§åˆ¶åº”ç”¨çš„é”™è¯¯åŸŸï¼ˆFailure Domainï¼‰ï¼Œæ¯”å¦‚é€šè¿‡åäº²å’Œæ€§é…ç½®ï¼Œå°†ä¸€ä¸ªåº”ç”¨çš„å¤šä¸ªå‰¯æœ¬éƒ¨ç½²åœ¨ä¸åŒæœºæ¶ï¼Œç”šè‡³ä¸åŒçš„æ•°æ®ä¸­å¿ƒ\n\nKubernetesæä¾›é€šç”¨æ ‡ç­¾æ¥æ ‡è®°èŠ‚ç‚¹æ‰€å¤„çš„ç‰©ç†ä½ç½®ï¼Œå¦‚ï¼š\n\n- `topology.kubernetes.io/zone: us-west2-a`\n- `failure-domain.beta.kubernetes.io/region: us-west`\n- `failure-domain.tess.io/network-device:us-west05-ra053`\n- `failure-domain.tess.io/rack:us west02 02-314 19 12`\n- `ubernetes.io/hostname: node-1`\n\n---\n\nServiceå¼•å…¥äº†topologyKeySå±æ€§ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹è®¾ç½®æ¥æ§åˆ¶æµé‡\n\nå½“topologyKeysè®¾ç½®ä¸º[\"kubernetes.io/hostname\"]æ—¶ï¼Œè°ƒç”¨æœåŠ¡çš„å®¢æˆ·ç«¯æ‰€åœ¨èŠ‚ç‚¹ä¸Šå¦‚æœæœ‰æœåŠ¡å®ä¾‹æ­£åœ¨è¿è¡Œï¼Œåˆ™è¯¥å®ä¾‹å¤„ç†è¯·æ±‚ï¼Œå¦åˆ™ï¼Œè°ƒç”¨å¤±è´¥ã€‚\n\nå½“topologyKeysè®¾ç½®ä¸º[\"kubernetes.io/hostname\", \"topology.kubernetes.io/zone\", \"topology.kubernetes.io/region\"]æ—¶ï¼Œè‹¥åŒä¸€èŠ‚ç‚¹æœ‰å¯¹åº”çš„æœåŠ¡å®ä¾‹ï¼Œåˆ™è¯·æ±‚ä¼šä¼˜å…ˆè½¬å‘è‡³è¯¥å®ä¾‹ã€‚å¦åˆ™ï¼Œé¡ºåºæŸ¥æ‰¾å½“å‰zoneåŠå½“å‰regionæ˜¯å¦æœ‰æœåŠ¡å®ä¾‹ï¼Œå¹¶å°†è¯·æ±‚æŒ‰é¡ºåºè½¬å‘ã€‚\n\nå½“topologyKeysè®¾ç½®ä¸º[\"topology.kubernetes.io/ zone\", \"\\*\"]æ—¶ï¼Œè¯·æ±‚ä¼šè¢«ä¼˜å…ˆè½¬å‘è‡³å½“å‰zoneçš„æœåŠ¡å®ä¾‹ã€‚å¦‚æœå½“å‰zoneä¸å­˜åœ¨æœåŠ¡å®ä¾‹ï¼Œåˆ™è¯·æ±‚ä¼šè¢«è½¬å‘è‡³ä»»æ„æœåŠ¡å®ä¾‹ã€‚\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/etcd":{"title":"etcd","content":"\n# etcd\n\nEtcdæ˜¯CoreOSåŸºäºRaftå¼€å‘çš„åˆ†å¸ƒå¼key-valueå­˜å‚¨ï¼Œå¯ç”¨äºæœåŠ¡å‘ç°ã€å…±äº«é…ç½®ä»¥åŠä¸€è‡´æ€§ä¿éšœï¼ˆå¦‚æ•°æ®åº“é€‰ä¸»ã€åˆ†å¸ƒå¼é”ç­‰ï¼‰ã€‚\n\nåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¦‚ä½•ç®¡ç†èŠ‚ç‚¹é—´çš„çŠ¶æ€ä¸€ç›´æ˜¯ä¸€ä¸ªéš¾é¢˜ï¼Œetcdåƒæ˜¯ä¸“é—¨ä¸ºé›†ç¾¤ç¯å¢ƒçš„æœåŠ¡å‘ç°å’Œæ³¨å†Œè€Œè®¾è®¡ï¼Œå®ƒæä¾›äº†æ•°æ®TTLå¤±æ•ˆã€æ•°æ®æ”¹å˜ç›‘è§†ã€å¤šå€¼ã€ç›®å½•ç›‘å¬ã€åˆ†å¸ƒå¼é”åŸå­æ“ä½œç­‰åŠŸèƒ½ï¼Œå¯ä»¥æ–¹ä¾¿çš„è·Ÿè¸ªå¹¶ç®¡ç†é›†ç¾¤èŠ‚ç‚¹çš„çŠ¶æ€ã€‚\n\n- é”®å€¼å¯¹å­˜å‚¨ï¼šå°†æ•°æ®å­˜å‚¨åœ¨åˆ†å±‚ç»„ç»‡çš„ç›®å½•ä¸­ï¼Œå¦‚åŒåœ¨æ ‡å‡†æ–‡ä»¶ç³»ç»Ÿä¸­\n- ç›‘æµ‹å˜æ›´ï¼šç›‘æµ‹ç‰¹å®šçš„é”®æˆ–ç›®å½•ä»¥è¿›è¡Œæ›´æ”¹ï¼Œå¹¶å¯¹å€¼çš„æ›´æ”¹åšå‡ºååº”\n- ç®€å•: curlå¯è®¿é—®çš„ç”¨æˆ·çš„APIï¼ˆHTTP+JSONï¼‰\n- å®‰å…¨: å¯é€‰çš„SSLå®¢æˆ·ç«¯è¯ä¹¦è®¤è¯\n- å¿«é€Ÿ: å•å®ä¾‹æ¯ç§’1000æ¬¡å†™æ“ä½œï¼Œ2000+æ¬¡è¯»æ“ä½œ\n- å¯é : ä½¿ç”¨Raftç®—æ³•ä¿è¯ä¸€è‡´æ€§\n\n## ä¸»è¦åŠŸèƒ½\n\n- åŸºæœ¬çš„key-valueå­˜å‚¨\n- ç›‘å¬æœºåˆ¶\n- keyçš„è¿‡æœŸåŠç»­çº¦æœºåˆ¶ï¼Œç”¨äºç›‘æ§å’ŒæœåŠ¡å‘ç°\n- åŸå­Compare And Swapå’ŒCompare And Deleteï¼Œç”¨äºåˆ†å¸ƒå¼é”å’Œleaderé€‰ä¸¾\n\n## ä½¿ç”¨åœºæ™¯\n\n- ä¹Ÿå¯ä»¥ç”¨äºé”®å€¼å¯¹å­˜å‚¨ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥è¯»å–å’Œå†™å…¥ etcd ä¸­çš„æ•°æ®\n- etcd æ¯”è¾ƒå¤šçš„åº”ç”¨åœºæ™¯æ˜¯ç”¨äºæœåŠ¡æ³¨å†Œä¸å‘ç°\n- åŸºäºç›‘å¬æœºåˆ¶çš„åˆ†å¸ƒå¼å¼‚æ­¥ç³»ç»Ÿ\n\n## é”®å€¼å¯¹å­˜å‚¨\n\netcd æ˜¯ä¸€ä¸ª**é”®å€¼å­˜å‚¨**çš„ç»„ä»¶ï¼Œå…¶ä»–çš„åº”ç”¨éƒ½æ˜¯åŸºäºå…¶é”®å€¼å­˜å‚¨çš„åŠŸèƒ½å±•å¼€ã€‚\n\n- é‡‡ç”¨kvå‹æ•°æ®å­˜å‚¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ¯”å…³ç³»å‹æ•°æ®åº“å¿«ã€‚\n- æ”¯æŒåŠ¨æ€å­˜å‚¨(å†…å­˜)ä»¥åŠé™æ€å­˜å‚¨(ç£ç›˜)ã€‚\n- åˆ†å¸ƒå¼å­˜å‚¨ï¼Œå¯é›†æˆä¸ºå¤šèŠ‚ç‚¹é›†ç¾¤ã€‚\n- å­˜å‚¨æ–¹å¼ï¼Œé‡‡ç”¨ç±»ä¼¼ç›®å½•ç»“æ„ã€‚ï¼ˆB+treeï¼‰\n\t- åªæœ‰å¶å­èŠ‚ç‚¹æ‰èƒ½çœŸæ­£å­˜å‚¨æ•°æ®ï¼Œç›¸å½“äºæ–‡ä»¶ã€‚\n\t- å¶å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸€å®šæ˜¯ç›®å½•ï¼Œç›®å½•ä¸èƒ½å­˜å‚¨æ•°æ®ã€‚\n\n## æœåŠ¡æ³¨å†Œå’Œå‘ç°\n\n- å¼ºä¸€è‡´æ€§ã€é«˜å¯ç”¨çš„æœåŠ¡å­˜å‚¨ç›®å½•ã€‚\n\t- åŸºäº Raft ç®—æ³•çš„ etcd å¤©ç”Ÿå°±æ˜¯è¿™æ ·ä¸€ä¸ªå¼ºä¸€è‡´æ€§ã€é«˜å¯ç”¨çš„æœåŠ¡å­˜å‚¨ç›®å½•ã€‚\n- ä¸€ç§æ³¨å†ŒæœåŠ¡å’ŒæœåŠ¡å¥åº·çŠ¶å†µçš„æœºåˆ¶ã€‚\n\t- ç”¨æˆ·å¯ä»¥åœ¨ etcd ä¸­æ³¨å†ŒæœåŠ¡ï¼Œå¹¶ä¸”å¯¹æ³¨å†Œçš„æœåŠ¡é…ç½® key TTLï¼Œå®šæ—¶ä¿æŒæœåŠ¡çš„å¿ƒè·³ä»¥è¾¾åˆ°ç›‘æ§å¥åº·çŠ¶æ€çš„æ•ˆæœã€‚\n\n![image.png](Extras/Images/image_1665845808268_0.png)\n\n## æ¶ˆæ¯å‘å¸ƒä¸è®¢é˜…\n\nåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæœ€é€‚ç”¨çš„ä¸€ç§ç»„ä»¶é—´é€šä¿¡æ–¹å¼å°±æ˜¯æ¶ˆæ¯å‘å¸ƒä¸è®¢é˜…ã€‚\n\nå³æ„å»ºä¸€ä¸ªé…ç½®å…±äº«ä¸­å¿ƒï¼Œæ•°æ®æä¾›è€…åœ¨è¿™ä¸ªé…ç½®ä¸­å¿ƒå‘å¸ƒæ¶ˆæ¯ï¼Œè€Œæ¶ˆæ¯ä½¿ç”¨è€…åˆ™è®¢é˜…ä»–ä»¬å…³å¿ƒçš„ä¸»é¢˜ï¼Œä¸€æ—¦ä¸»é¢˜æœ‰æ¶ˆæ¯å‘å¸ƒï¼Œå°±ä¼šå®æ—¶é€šçŸ¥è®¢é˜…è€…ã€‚\n\né€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥åšåˆ°åˆ†å¸ƒå¼ç³»ç»Ÿé…ç½®çš„é›†ä¸­å¼ç®¡ç†ä¸åŠ¨æ€æ›´æ–°ã€‚\n\nåº”ç”¨ä¸­ç”¨åˆ°çš„ä¸€äº›é…ç½®ä¿¡æ¯æ”¾åˆ°etcdä¸Šè¿›è¡Œé›†ä¸­ç®¡ç†ã€‚\n\nåº”ç”¨åœ¨å¯åŠ¨çš„æ—¶å€™ä¸»åŠ¨ä»etcdè·å–ä¸€æ¬¡é…ç½®ä¿¡æ¯ï¼ŒåŒæ—¶ï¼Œåœ¨etcdèŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€ä¸ªWatcherå¹¶ç­‰å¾…ï¼Œä»¥åæ¯æ¬¡é…ç½®æœ‰æ›´æ–°çš„æ—¶å€™ï¼Œetcdéƒ½ä¼šå®æ—¶é€šçŸ¥è®¢é˜…è€…ï¼Œä»¥æ­¤è¾¾åˆ°è·å–æœ€æ–°é…ç½®ä¿¡æ¯çš„ç›®çš„ã€‚\n\n## æ ¸å¿ƒï¼šTTL \u0026 CAS\n\nTTLï¼ˆtime to liveï¼‰æŒ‡çš„æ˜¯ç»™ä¸€ä¸ªkeyè®¾ç½®ä¸€ä¸ªæœ‰æ•ˆæœŸï¼Œåˆ°æœŸåè¿™ä¸ªkeyå°±ä¼šè¢«è‡ªåŠ¨åˆ æ‰ï¼Œè¿™åœ¨å¾ˆå¤šåˆ†å¸ƒå¼é”çš„å®ç°ä¸Šéƒ½ä¼šç”¨åˆ°ï¼Œå¯ä»¥ä¿è¯é”çš„å®æ—¶æœ‰æ•ˆæ€§ã€‚\n\nAtomic Compare-and-Swapï¼ˆCASï¼‰æŒ‡çš„æ˜¯åœ¨å¯¹keyè¿›è¡Œèµ‹å€¼çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯éœ€è¦æä¾›ä¸€äº›æ¡ä»¶ï¼Œå½“è¿™äº›æ¡ä»¶æ»¡è¶³åï¼Œæ‰èƒ½èµ‹å€¼æˆåŠŸã€‚è¿™äº›æ¡ä»¶åŒ…æ‹¬ï¼š\n\n- prevExistï¼škeyå½“å‰èµ‹å€¼å‰æ˜¯å¦å­˜åœ¨\n- prevValueï¼škeyå½“å‰èµ‹å€¼å‰çš„å€¼\n- prevIndexï¼škeyå½“å‰èµ‹å€¼å‰çš„Index\n\nè¿™æ ·çš„è¯ï¼Œkeyçš„è®¾ç½®æ˜¯æœ‰å‰æçš„ï¼Œéœ€è¦çŸ¥é“è¿™ä¸ªkeyå½“å‰çš„å…·ä½“æƒ…å†µæ‰å¯ä»¥å¯¹å…¶è®¾\n\n# Raftåè®®\n\n## Raftåè®®æ¦‚è§ˆ\n\nRaftåè®®åŸºäºquorumæœºåˆ¶ï¼Œå³å¤§å¤šæ•°åŒæ„åŸåˆ™ï¼Œä»»ä½•çš„å˜æ›´éƒ½éœ€è¶…è¿‡åŠæ•°çš„æˆå‘˜ç¡®è®¤\n\n![image.png](Extras/Images/image_1665850658533_0.png)\n\n## ç†è§£Raftåè®®\n\nhttp://thesecretlivesofdata.com/raft/\n\n## learner\n\nRaft 4.2.1å¼•å…¥çš„æ–°è§’è‰²\n\nå½“å‡ºç°ä¸€ä¸ªetcdé›†ç¾¤éœ€è¦å¢åŠ èŠ‚ç‚¹æ—¶ï¼Œæ–°èŠ‚ç‚¹ä¸Leaderçš„æ•°æ®å·®å¼‚è¾ƒå¤§ï¼Œéœ€è¦è¾ƒå¤šæ•°æ®åŒæ­¥æ‰èƒ½è·Ÿä¸Šleaderçš„æœ€æ–°çš„æ•°æ®ã€‚\n\næ­¤æ—¶Leaderçš„ç½‘ç»œå¸¦å®½å¾ˆå¯èƒ½è¢«ç”¨å°½ï¼Œè¿›è€Œä½¿å¾—leaderæ— æ³•æ­£å¸¸ä¿æŒå¿ƒè·³ã€‚\n\nè¿›è€Œå¯¼è‡´followeré‡æ–°å‘èµ·æŠ•ç¥¨ã€‚\n\nè¿›è€Œå¯èƒ½å¼•å‘etcdé›†ç¾¤ä¸å¯ç”¨ã€‚\n\n**Learnerè§’è‰²åªæ¥æ”¶æ•°æ®è€Œä¸å‚ä¸æŠ•ç¥¨ï¼Œå› æ­¤å¢åŠ learnerèŠ‚ç‚¹æ—¶ï¼Œé›†ç¾¤çš„quorumä¸å˜ã€‚**\n\n![image.png](Extras/Images/image_1665853509499_0.png)\n\n## etcdåŸºäºRaftçš„ä¸€è‡´æ€§\n\né€‰ä¸¾æ–¹æ³•\n\nåˆå§‹å¯åŠ¨æ—¶ï¼ŒèŠ‚ç‚¹å¤„äºfollowerçŠ¶æ€å¹¶è¢«è®¾å®šä¸€ä¸ªelection timeoutï¼Œå¦‚æœåœ¨è¿™ä¸€æ—¶é—´å‘¨æœŸå†…æ²¡æœ‰æ”¶åˆ°æ¥è‡ª leader çš„ heartbeatï¼ŒèŠ‚ç‚¹å°†å‘èµ·é€‰ä¸¾ï¼šå°†è‡ªå·±åˆ‡æ¢ä¸º candidate ä¹‹åï¼Œå‘é›†ç¾¤ä¸­å…¶å®ƒ followerèŠ‚ç‚¹å‘é€è¯·æ±‚ï¼Œè¯¢é—®å…¶æ˜¯å¦é€‰ä¸¾è‡ªå·±æˆä¸º leaderã€‚\n\nå½“æ”¶åˆ°æ¥è‡ªé›†ç¾¤ä¸­è¿‡åŠæ•°èŠ‚ç‚¹çš„æ¥å—æŠ•ç¥¨åï¼ŒèŠ‚ç‚¹å³æˆä¸º leaderï¼Œå¼€å§‹æ¥æ”¶ä¿å­˜ client çš„æ•°æ®å¹¶å‘å…¶å®ƒçš„ follower èŠ‚ç‚¹åŒæ­¥æ—¥å¿—ã€‚å¦‚æœæ²¡æœ‰è¾¾æˆä¸€è‡´ï¼Œåˆ™candidateéšæœºé€‰æ‹©ä¸€ä¸ªç­‰å¾…é—´éš”ï¼ˆ150ms ~ 300msï¼‰å†æ¬¡å‘èµ·æŠ•ç¥¨ï¼Œå¾—åˆ°é›†ç¾¤ä¸­åŠæ•°ä»¥ä¸Šfolloweræ¥å—çš„candidateå°†æˆä¸ºleader\n\nleaderèŠ‚ç‚¹ä¾é å®šæ—¶å‘ follower å‘é€heartbeatæ¥ä¿æŒå…¶åœ°ä½ã€‚\n\nä»»ä½•æ—¶å€™å¦‚æœå…¶å®ƒ follower åœ¨ election timeout æœŸé—´éƒ½æ²¡æœ‰æ”¶åˆ°æ¥è‡ª leader çš„ heartbeatï¼ŒåŒæ ·ä¼šå°†è‡ªå·±çš„çŠ¶æ€åˆ‡æ¢ä¸º candidate å¹¶å‘èµ·é€‰ä¸¾ã€‚æ¯æˆåŠŸé€‰ä¸¾ä¸€æ¬¡ï¼Œæ–° leader çš„ä»»æœŸï¼ˆTermï¼‰éƒ½ä¼šæ¯”ä¹‹å‰leader çš„ä»»æœŸå¤§1ã€‚\n\n## æ—¥å¿—å¤åˆ¶\n\nå½“æ¥Leaderæ”¶åˆ°å®¢æˆ·ç«¯çš„æ—¥å¿—ï¼ˆäº‹åŠ¡è¯·æ±‚ï¼‰åå…ˆæŠŠè¯¥æ—¥å¿—è¿½åŠ åˆ°æœ¬åœ°çš„Logä¸­ï¼Œç„¶åé€šè¿‡heartbeatæŠŠè¯¥EntryåŒæ­¥ç»™å…¶ä»–Followerï¼ŒFolloweræ¥æ”¶åˆ°æ—¥å¿—åè®°å½•æ—¥å¿—ç„¶åå‘Leaderå‘é€ACKï¼Œå½“Leaderæ”¶åˆ°å¤§å¤šæ•°ï¼ˆn/2+1ï¼‰Followerçš„ACKä¿¡æ¯åå°†è¯¥æ—¥å¿—è®¾ç½®ä¸ºå·²æäº¤å¹¶è¿½åŠ åˆ°æœ¬åœ°ç£ç›˜ä¸­ï¼Œé€šçŸ¥å®¢æˆ·ç«¯å¹¶åœ¨ä¸‹ä¸ªheartbeatä¸­Leaderå°†é€šçŸ¥æ‰€æœ‰çš„Followerå°†è¯¥æ—¥å¿—å­˜å‚¨åœ¨è‡ªå·±çš„æœ¬åœ°ç£ç›˜ä¸­ã€‚\n\n## å®‰å…¨æ€§\n\nå®‰å…¨æ€§æ˜¯ç”¨äºä¿è¯æ¯ä¸ªèŠ‚ç‚¹éƒ½æ‰§è¡Œç›¸åŒåºåˆ—çš„å®‰å…¨æœºåˆ¶ï¼Œå¦‚å½“æŸä¸ªFolloweråœ¨å½“å‰Leadercommit Logæ—¶å˜å¾—ä¸å¯ç”¨äº†ï¼Œç¨åå¯èƒ½è¯¥Followeråˆä¼šè¢«é€‰ä¸¾ä¸ºLeaderï¼Œè¿™æ—¶æ–°Leaderå¯èƒ½ä¼šç”¨æ–°çš„Logè¦†ç›–å…ˆå‰å·²committedçš„Logï¼Œè¿™å°±æ˜¯å¯¼è‡´èŠ‚ç‚¹æ‰§è¡Œä¸åŒåºåˆ—ï¼›Safetyå°±æ˜¯ç”¨äºä¿è¯é€‰ä¸¾å‡ºæ¥çš„Leaderä¸€å®šåŒ…å«å…ˆå‰ committed Logçš„æœºåˆ¶ï¼›\n\né€‰ä¸¾å®‰å…¨æ€§ï¼ˆElection Safetyï¼‰ï¼šæ¯ä¸ªä»»æœŸï¼ˆTermï¼‰åªèƒ½é€‰ä¸¾å‡ºä¸€ä¸ªLeader\n\nLeaderå®Œæ•´æ€§ï¼ˆLeader Completenessï¼‰ï¼šæŒ‡Leaderæ—¥å¿—çš„å®Œæ•´æ€§ï¼Œå½“Logåœ¨ä»»æœŸTerm1è¢«Commitåï¼Œé‚£ä¹ˆä»¥åä»»æœŸTerm2ã€Term3â€¦ç­‰çš„Leaderå¿…é¡»åŒ…å«è¯¥Logï¼›Raftåœ¨é€‰ä¸¾é˜¶æ®µå°±ä½¿ç”¨Termçš„åˆ¤æ–­ç”¨äºä¿è¯å®Œæ•´æ€§ï¼šå½“è¯·æ±‚æŠ•ç¥¨çš„è¯¥Candidateçš„Termè¾ƒå¤§æˆ–Termç›¸åŒIndexæ›´å¤§åˆ™æŠ•ç¥¨ï¼Œå¦åˆ™æ‹’ç»è¯¥è¯·æ±‚ã€‚\n\n## å¤±æ•ˆå¤„ç†\n\n1) Leaderå¤±æ•ˆï¼šå…¶ä»–æ²¡æœ‰æ”¶åˆ°heartbeatçš„èŠ‚ç‚¹ä¼šå‘èµ·æ–°çš„é€‰ä¸¾ï¼Œè€Œå½“Leaderæ¢å¤åç”±äºæ­¥è¿›æ•°å°ä¼šè‡ªåŠ¨æˆä¸ºfollowerï¼ˆæ—¥å¿—ä¹Ÿä¼šè¢«æ–°leaderçš„æ—¥å¿—è¦†ç›–ï¼‰\n\n2ï¼‰followerèŠ‚ç‚¹ä¸å¯ç”¨ï¼šfollower èŠ‚ç‚¹ä¸å¯ç”¨çš„æƒ…å†µç›¸å¯¹å®¹æ˜“è§£å†³ã€‚å› ä¸ºé›†ç¾¤ä¸­çš„æ—¥å¿—å†…å®¹å§‹ç»ˆæ˜¯ä» leader èŠ‚ç‚¹åŒæ­¥çš„ï¼Œåªè¦è¿™ä¸€èŠ‚ç‚¹å†æ¬¡åŠ å…¥é›†ç¾¤æ—¶é‡æ–°ä» leader èŠ‚ç‚¹å¤„å¤åˆ¶æ—¥å¿—å³å¯ã€‚\n\n3ï¼‰å¤šä¸ªcandidateï¼šå†²çªåcandidateå°†éšæœºé€‰æ‹©ä¸€ä¸ªç­‰å¾…é—´éš”ï¼ˆ150ms ~ 300msï¼‰å†æ¬¡å‘èµ·æŠ•ç¥¨ï¼Œå¾—åˆ°é›†ç¾¤ä¸­åŠæ•°ä»¥ä¸Šfolloweræ¥å—çš„candidateå°†æˆä¸ºleader\n\n## walæ—¥å¿—\n\nwalæ—¥å¿—æ˜¯äºŒè¿›åˆ¶çš„ï¼Œè§£æå‡ºæ¥åæ˜¯ä»¥ä¸Šæ•°æ®ç»“æ„LogEntryã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªå­—æ®µtypeï¼Œåªæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯0è¡¨ç¤ºNormalï¼Œ1è¡¨ç¤ºConfChangeï¼ˆConfChangeè¡¨ç¤º Etcd æœ¬èº«çš„é…ç½®å˜æ›´åŒæ­¥ï¼Œæ¯”å¦‚æœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥ç­‰ï¼‰ã€‚ç¬¬äºŒä¸ªå­—æ®µæ˜¯termï¼Œæ¯ä¸ªtermä»£è¡¨ä¸€ä¸ªä¸»èŠ‚ç‚¹çš„ä»»æœŸï¼Œæ¯æ¬¡ä¸»èŠ‚ç‚¹å˜æ›´termå°±ä¼šå˜åŒ–ã€‚ç¬¬ä¸‰ä¸ªå­—æ®µæ˜¯indexï¼Œè¿™ä¸ªåºå·æ˜¯ä¸¥æ ¼æœ‰åºé€’å¢çš„ï¼Œä»£è¡¨å˜æ›´åºå·ã€‚ç¬¬å››ä¸ªå­—æ®µæ˜¯äºŒè¿›åˆ¶çš„dataï¼Œå°†raft requestå¯¹è±¡çš„pbç»“æ„æ•´ä¸ªä¿å­˜ä¸‹ã€‚etcd æºç ä¸‹æœ‰ä¸ªtools/etcd\u0002dump-logsï¼Œå¯ä»¥å°†walæ—¥å¿—dumpæˆæ–‡æœ¬æŸ¥çœ‹ï¼Œå¯ä»¥ååŠ©åˆ†æRaftåè®®ã€‚\n\nRaftåè®®æœ¬èº«ä¸å…³å¿ƒåº”ç”¨æ•°æ®ï¼Œä¹Ÿå°±æ˜¯dataä¸­çš„éƒ¨åˆ†ï¼Œä¸€è‡´æ€§éƒ½é€šè¿‡åŒæ­¥walæ—¥å¿—æ¥å®ç°ï¼Œæ¯ä¸ªèŠ‚ç‚¹å°†ä»ä¸»èŠ‚ç‚¹æ”¶åˆ°çš„data applyåˆ°æœ¬åœ°çš„å­˜å‚¨ï¼ŒRaftåªå…³å¿ƒæ—¥å¿—çš„åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœæœ¬åœ°å­˜å‚¨å®ç°çš„æœ‰bugï¼Œæ¯”å¦‚æ²¡æœ‰æ­£ç¡®çš„å°†data applyåˆ°æœ¬åœ°ï¼Œä¹Ÿå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚\n\n![image.png](Extras/Images/image_1665854364816_0.png)\n\n# etcd v3 å­˜å‚¨ï¼ŒWatchä»¥åŠè¿‡æœŸæœºåˆ¶\n\n![image.png](Extras/Images/image_1665854412122_0.png)\n\n## å­˜å‚¨æœºåˆ¶\n\netcd v3 store åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯å†…å­˜ä¸­çš„ç´¢å¼•ï¼Œkvindexï¼Œæ˜¯åŸºäºGoogleå¼€æºçš„ä¸€ä¸ªGolangçš„btreeå®ç°çš„ï¼Œå¦å¤–ä¸€éƒ¨åˆ†æ˜¯åç«¯å­˜å‚¨ã€‚æŒ‰ç…§å®ƒçš„è®¾è®¡ï¼Œbackendå¯ä»¥å¯¹æ¥å¤šç§å­˜å‚¨ï¼Œå½“å‰ä½¿ç”¨çš„boltdbã€‚boltdbæ˜¯ä¸€ä¸ªå•æœºçš„æ”¯æŒäº‹åŠ¡çš„kvå­˜å‚¨ï¼Œetcd çš„äº‹åŠ¡æ˜¯åŸºäºboltdbçš„äº‹åŠ¡å®ç°çš„ã€‚etcd åœ¨boltdbä¸­å­˜å‚¨çš„keyæ˜¯reversionï¼Œvalueæ˜¯ etcd è‡ªå·±çš„key-valueç»„åˆï¼Œä¹Ÿå°±æ˜¯è¯´ etcd ä¼šåœ¨boltdbä¸­æŠŠæ¯ä¸ªç‰ˆæœ¬éƒ½ä¿å­˜ä¸‹ï¼Œä»è€Œå®ç°äº†å¤šç‰ˆæœ¬æœºåˆ¶ã€‚\n\nreversionä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œç¬¬ä¸€éƒ¨åˆ†main revï¼Œæ¯æ¬¡äº‹åŠ¡è¿›è¡ŒåŠ ä¸€ï¼Œç¬¬äºŒéƒ¨åˆ†sub revï¼ŒåŒä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ¯æ¬¡æ“ä½œåŠ ä¸€ã€‚\n\netcd æä¾›äº†å‘½ä»¤å’Œè®¾ç½®é€‰é¡¹æ¥æ§åˆ¶compactï¼ŒåŒæ—¶æ”¯æŒputæ“ä½œçš„å‚æ•°æ¥ç²¾ç¡®æ§åˆ¶æŸä¸ªkeyçš„å†å²ç‰ˆæœ¬æ•°ã€‚\n\nå†…å­˜kvindexä¿å­˜çš„å°±æ˜¯keyå’Œreversionä¹‹å‰çš„æ˜ å°„å…³ç³»ï¼Œç”¨æ¥åŠ é€ŸæŸ¥è¯¢ã€‚\n\n![image.png](Extras/Images/image_1665909521087_0.png)\n\n## Watchæœºåˆ¶\n\netcd v3 çš„watchæœºåˆ¶æ”¯æŒwatchæŸä¸ªå›ºå®šçš„keyï¼Œä¹Ÿæ”¯æŒwatchä¸€ä¸ªèŒƒå›´ï¼ˆå¯ä»¥ç”¨äºæ¨¡æ‹Ÿç›®å½•çš„ç»“æ„çš„watchï¼‰ï¼Œæ‰€ä»¥ watchGroup åŒ…å«ä¸¤ç§watcherï¼Œä¸€ç§æ˜¯ key watchersï¼Œæ•°æ®ç»“æ„æ˜¯æ¯ä¸ªkeyå¯¹åº”ä¸€ç»„watcherï¼Œå¦å¤–ä¸€ç§æ˜¯ range watchers, æ•°æ®ç»“æ„æ˜¯ä¸€ä¸ª IntervalTreeï¼Œæ–¹ä¾¿é€šè¿‡åŒºé—´æŸ¥æ‰¾åˆ°å¯¹åº”çš„watcherã€‚\n\nåŒæ—¶ï¼Œæ¯ä¸ª WatchableStore åŒ…å«ä¸¤ç§ watcherGroupï¼Œä¸€ç§æ˜¯syncedï¼Œä¸€ç§æ˜¯unsyncedï¼Œå‰è€…è¡¨ç¤ºè¯¥groupçš„watcheræ•°æ®éƒ½å·²ç»åŒæ­¥å®Œæ¯•ï¼Œåœ¨ç­‰å¾…æ–°çš„å˜æ›´ï¼Œåè€…è¡¨ç¤ºè¯¥groupçš„watcheræ•°æ®åŒæ­¥è½åäºå½“å‰æœ€æ–°å˜æ›´ï¼Œè¿˜åœ¨è¿½èµ¶ã€‚\n\nå½“ etcd æ”¶åˆ°å®¢æˆ·ç«¯çš„watchè¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚æºå¸¦äº†revisionå‚æ•°ï¼Œåˆ™æ¯”è¾ƒè¯·æ±‚çš„revisionå’Œstoreå½“å‰çš„revisionï¼Œå¦‚æœå¤§äºå½“å‰revisionï¼Œåˆ™æ”¾å…¥syncedç»„ä¸­ï¼Œå¦åˆ™æ”¾å…¥unsyncedç»„ã€‚åŒæ—¶ etcd ä¼šå¯åŠ¨ä¸€ä¸ªåå°çš„goroutineæŒç»­åŒæ­¥unsyncedçš„watcherï¼Œç„¶åå°†å…¶è¿ç§»åˆ°syncedç»„ã€‚ä¹Ÿå°±æ˜¯è¿™ç§æœºåˆ¶ä¸‹ï¼Œetcd v3 æ”¯æŒä»ä»»æ„ç‰ˆæœ¬å¼€å§‹watchï¼Œæ²¡æœ‰v2çš„1000æ¡å†å²eventè¡¨é™åˆ¶çš„é—®é¢˜ï¼ˆå½“ç„¶è¿™æ˜¯æŒ‡æ²¡æœ‰compactçš„æƒ…å†µä¸‹ï¼‰\n\n## å®¹é‡ç®¡ç†\n\n- å•ä¸ªå¯¹è±¡ä¸å»ºè®®è¶…è¿‡1.5M\n- é»˜è®¤å®¹é‡2G\n- ä¸å»ºè®®è¶…è¿‡8G\n\n# etcdåœ¨é›†ç¾¤ä¸­æ‰€å¤„çš„ä½ç½®\n\n![image.png](Extras/Images/image_1665928249958_0.png)\n\n# etcdæ‹“æ‰‘\n\nå †å å¼etcdé›†ç¾¤çš„é«˜å¯ç”¨æ‹“æ‰‘\n\nè¿™ç§æ‹“æ‰‘å°†ç›¸åŒèŠ‚ç‚¹ä¸Šçš„æ§åˆ¶å¹³é¢å’Œetcdæˆå‘˜è€¦åˆåœ¨ä¸€èµ·ã€‚ä¼˜ç‚¹åœ¨äºå»ºç«‹èµ·æ¥éå¸¸å®¹æ˜“ï¼Œå¹¶ä¸”å¯¹å‰¯æœ¬çš„ç®¡ç†ä¹Ÿæ›´å®¹æ˜“ã€‚ä½†æ˜¯ï¼Œå †å å¼å­˜åœ¨è€¦åˆå¤±è´¥çš„é£é™©ã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œåˆ™etcdæˆå‘˜å’Œæ§åˆ¶å¹³é¢å®ä¾‹éƒ½ä¼šä¸¢å¤±ï¼Œå¹¶ä¸”é›†ç¾¤å†—ä½™ä¹Ÿä¼šå—åˆ°æŸå®³ã€‚å¯ä»¥é€šè¿‡æ·»åŠ æ›´å¤šæ§åˆ¶å¹³é¢èŠ‚æ¥å‡è½»è¿™ç§é£é™©ã€‚å› æ­¤ä¸ºå®ç°é›†ç¾¤é«˜å¯ç”¨åº”è¯¥è‡³å°‘è¿è¡Œä¸‰ä¸ªå †å çš„MasterèŠ‚ç‚¹ã€‚\n\n![image.png](Extras/Images/image_1665928763555_0.png)\n\nå¤–éƒ¨etcdé›†ç¾¤çš„é«˜å¯ç”¨æ‹“æ‰‘\n\nè¯¥æ‹“æ‰‘å°†æ§åˆ¶å¹³é¢å’Œetcdæˆå‘˜è§£è€¦ã€‚å¦‚æœä¸¢å¤±ä¸€ä¸ªMasterèŠ‚ç‚¹ï¼Œå¯¹etcdæˆå‘˜çš„å½±å“è¾ƒå°ï¼Œå¹¶ä¸”ä¸ä¼šåƒå †å å¼æ‹“æ‰‘é‚£æ ·å¯¹é›†ç¾¤å†—ä½™äº§ç”Ÿå¤ªå¤§å½±å“ã€‚ä½†æ˜¯ï¼Œæ­¤æ‹“æ‰‘æ‰€éœ€çš„ä¸»æœºæ•°é‡æ˜¯å †å å¼æ‹“æ‰‘çš„ä¸¤å€ã€‚å…·æœ‰æ­¤æ‹“æ‰‘çš„ç¾¤é›†è‡³å°‘éœ€è¦ä¸‰ä¸ªä¸»æœºç”¨äºæ§åˆ¶å¹³é¢èŠ‚ç‚¹ï¼Œä¸‰ä¸ªä¸»æœºç”¨äºetcdé›†ç¾¤ã€‚\n\n![image.png](Extras/Images/image_1665928794361_0.png)","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/istio":{"title":"istio","content":"\n# é—®é¢˜\n\n## No tracingé—®é¢˜\n\n- æ²¡æœ‰æ­£ç¡®è®¾ç½®meshConfig.defaultConfig.tracing.zipkin.addresså’ŒmeshConfig.defaultConfig.tracing.sampling\n\t- `istioctl install --set profile=demo --set meshConfig.defaultConfig.tracing.zipkin.address=jaeger-collector.istio-system:9411 --set meshConfig.defaultConfig.tracing.sampling=100  -y`\n- é‡å»ºã€æ›´æ–°istioåï¼Œå¯èƒ½éœ€è¦æŠŠsidecaré‡å¯/é‡å»º\n- jaegeræš‚æ—¶ä½¿ç”¨allinoneå³å¯ï¼Œå› ä¸ºç”¨esåšåç«¯å­˜å‚¨å¤ªéš¾é…ç½®\n\n## kialiçš„Graphä¸ºç©ºæˆ–prometheusæ²¡æœ‰æ•°æ®\n\nprometheus.ioçš„annotiationä¸æ”¯æŒï¼Œéœ€è¦ä¸ºprometheusæ·»åŠ åŸºäºkubernetes_sd_configsæœåŠ¡å‘ç°çš„relabelé…ç½®\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Kubernetes/kube-proxy":{"title":"kube-proxy","content":"\n# kube-proxy\n\næ¯å°æœºå™¨ä¸Šéƒ½è¿è¡Œä¸€ä¸ªkube-proxyæœåŠ¡ï¼Œå®ƒç›‘å¬API serverä¸­serviceå’Œendpointçš„å˜åŒ–æƒ…å†µï¼Œå¹¶é€šè¿‡iptablesç­‰æ¥ä¸ºæœåŠ¡é…ç½®è´Ÿè½½å‡è¡¡ï¼ˆä»…æ”¯æŒTCPå’ŒUDPï¼‰ã€‚\n\nkube-proxyå¯ä»¥ç›´æ¥è¿è¡Œåœ¨ç‰©ç†æœºä¸Šï¼Œä¹Ÿå¯ä»¥ä»¥static podæˆ–è€…DaemonSetçš„æ–¹å¼è¿è¡Œã€‚\n\nkube-proxyå½“å‰æ”¯æŒä¸€ä¸‹å‡ ç§å®ç°\n\n- userspaceï¼šæœ€æ—©çš„è´Ÿè½½å‡è¡¡æ–¹æ¡ˆï¼Œå®ƒåœ¨ç”¨æˆ·ç©ºé—´ç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œæ‰€æœ‰æœåŠ¡é€šè¿‡iptablesè½¬å‘åˆ°è¿™ä¸ªç«¯å£ï¼Œç„¶ååœ¨å…¶å†…éƒ¨è´Ÿè½½å‡è¡¡åˆ°å®é™…çš„Podã€‚è¯¥æ–¹å¼æœ€ä¸»è¦çš„é—®é¢˜æ˜¯æ•ˆç‡ä½ï¼Œæœ‰æ˜æ˜¾çš„æ€§èƒ½ç“¶é¢ˆã€‚\n- iptablesï¼šç›®å‰æ¨èçš„æ–¹æ¡ˆï¼Œå®Œå…¨ä»¥iptablesè§„åˆ™çš„æ–¹å¼æ¥å®ç°serviceè´Ÿè½½å‡è¡¡ã€‚è¯¥æ–¹å¼æœ€ä¸»è¦çš„é—®é¢˜æ˜¯åœ¨æœåŠ¡å¤šçš„æ—¶å€™äº§ç”Ÿå¤ªå¤šçš„iptablesè§„åˆ™ï¼Œéå¢é‡å¼æ›´æ–°ä¼šå¼•å…¥ä¸€å®šçš„æ—¶å»¶ï¼Œå¤§è§„æ¨¡æƒ…å†µä¸‹æœ‰æ˜æ˜¾çš„æ€§èƒ½é—®é¢˜\n- ipvsï¼šä¸ºè§£å†³iptablesæ¨¡å¼çš„æ€§èƒ½é—®é¢˜ï¼Œv1.8æ–°å¢äº†ipvsæ¨¡å¼ï¼Œé‡‡ç”¨å¢é‡å¼æ›´æ–°ï¼Œå¹¶å¯ä»¥ä¿è¯serviceæ›´æ–°æœŸé—´è¿æ¥ä¿æŒä¸æ–­å¼€\n- winuserspaceâˆ¶ åŒuserspaceï¼Œä½†ä»…å·¥ä½œåœ¨windowsä¸Š\n\n# Linuxå†…æ ¸å¤„ç†æ•°æ®åŒ…ï¼šNetfilteræ¡†æ¶\n\n![image.png](Extras/Images/image_1666196681318_0.png)\n\n# Netfilterå’Œiptables\n\n![image.png](Extras/Images/image_1666197364236_0.png)\n\n# iptables\n\n![image.png](Extras/Images/image_1666197458799_0.png)\n\n# iptablesæ”¯æŒçš„é”šç‚¹\n\n![image.png](Extras/Images/image_1666198206945_0.png)\n\n# kube-proxyå·¥ä½œåŸç†\n\n![image.png](Extras/Images/image_1666198537603_0.png)\n\n# Kubernetes iptablesè§„åˆ™\n\n![image.png](Extras/Images/image_1666199038246_0.png)\n\n# IPVS\n\n![image.png](Extras/Images/image_1666199163455_0.png)\n\n# IPVSæ”¯æŒçš„é”šç‚¹å’Œæ ¸å¿ƒå‡½æ•°\n\n![image.png](Extras/Images/image_1666199183091_0.png)\n\n# åŸŸåæœåŠ¡\n\nKubernetes Serviceé€šè¿‡è™šæ‹ŸIPåœ°å€æˆ–è€…èŠ‚ç‚¹ç«¯å£ä¸ºç”¨æˆ·åº”ç”¨æä¾›è®¿é—®å…¥å£\n\nç„¶è€Œè¿™äº›IPåœ°å€å’Œç«¯å£æ˜¯åŠ¨æ€åˆ†é…çš„ï¼Œå¦‚æœç”¨æˆ·é‡å»ºä¸€ä¸ªæœåŠ¡ï¼Œå…¶åˆ†é…çš„clusterlPå’ŒnodePortï¼Œä»¥åŠLoadBalancerIPéƒ½æ˜¯ä¼šå˜åŒ–çš„ï¼Œæˆ‘ä»¬æ— æ³•æŠŠä¸€ä¸ªå¯å˜çš„å…¥å£å‘å¸ƒå‡ºå»ä¾›ä»–äººè®¿é—®\n\nKubernetesæä¾›äº†å†…ç½®çš„åŸŸåæœåŠ¡ï¼Œç”¨æˆ·å®šä¹‰çš„æœåŠ¡ä¼šè‡ªåŠ¨è·å¾—åŸŸåï¼Œè€Œæ— è®ºæœåŠ¡é‡å»ºå¤šå°‘æ¬¡ï¼Œåªè¦æœåŠ¡åä¸æ”¹å˜ï¼Œå…¶å¯¹åº”çš„åŸŸåå°±ä¸ä¼šæ”¹å˜\n\n# CoreDNS\n\nCoreDNSåŒ…å«ä¸€ä¸ªå†…å­˜æ€DNSï¼Œä»¥åŠä¸å…¶ä»–controllerç±»ä¼¼çš„æ§åˆ¶å™¨\n\nCoreDNSçš„å®ç°åŸç†æ˜¯ï¼Œæ§åˆ¶å™¨ç›‘å¬Serviceå’ŒEndpointçš„å˜åŒ–å¹¶é…ç½®DNSï¼Œå®¢æˆ·ç«¯Podåœ¨è¿›è¡ŒåŸŸåè§£ææ—¶ï¼Œä» CoreDNSä¸­æŸ¥è¯¢æœåŠ¡å¯¹åº”çš„åœ°å€è®°å½•\n\n![image.png](Extras/Images/image_1666251811723_0.png)\n\n# ä¸åŒç±»å‹æœåŠ¡çš„DNSè®°å½•\n\n- æ™®é€šService\n\t- ClusterIPã€nodePortã€LoadBalancer ç±»å‹çš„Serviceéƒ½æ‹¥æœ‰API Serveråˆ†é…çš„ClusterlPï¼ŒCoreDNSä¼šä¸ºè¿™äº›Serviceåˆ›å»ºFQDNæ ¼å¼ä¸º`$svcname.$namespace.svc.$clusterdomainâˆ¶clusterIP`çš„Aè®°å½•åŠPTRè®°å½•ï¼Œå¹¶ä¸ºç«¯å£åˆ›å»ºSRVè®°å½•ã€‚\n- Headless Service\n\t- é¡¾åæ€ä¹‰ï¼Œæ— å¤´ï¼Œæ˜¯ç”¨æˆ·åœ¨Specæ˜¾å¼æŒ‡å®šClusterlPä¸ºNoneçš„Serviceï¼Œå¯¹äºè¿™ç±»Serviceï¼ŒAPIServerä¸ä¼šä¸ºå…¶åˆ†é…ClusterIPã€‚CoreDNSä¸ºæ­¤ç±»Serviceåˆ›å»ºå¤šæ¡Aè®°å½•ï¼Œå¹¶ä¸”ç›®æ ‡ä¸ºæ¯ä¸ªå°±ç»ªçš„PodIPã€‚\n\t- å¦å¤–ï¼Œæ¯ä¸ªPodä¼šæ‹¥æœ‰ä¸€ä¸ªFQDNæ ¼å¼ä¸º`$podname.$svcname.$namespace.svc.$clusterdomain`çš„Aè®°å½•æŒ‡å‘PodIPã€‚\n- ExternalName Service\n\t- æ­¤ç±»Serviceç”¨æ¥å¼•ç”¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„åŸŸåï¼ŒCoreDNSä¼šä¸ºè¯¥Serviceåˆ›å»ºä¸€ä¸ªCNameè®°å½•æŒ‡å‘ç›®æ ‡åŸŸå\n\n# Kubernetesä¸­çš„åŸŸåè§£æ\n\nKubernetes Podæœ‰ä¸€ä¸ªä¸DNSç­–ç•¥ç›¸å…³çš„å±æ€§DNSPolicyï¼Œé»˜è®¤å€¼æ˜¯ClusterFirst\n\nPodå¯åŠ¨åçš„/etc/resolv.confä¼šè¢«æ”¹å†™ï¼Œæ‰€æœ‰çš„åœ°å€è§£æä¼˜å…ˆå‘é€è‡³CoreDNS\n\n```bash\n$cat /etc/resolv.conf\nsearch ns1.svc.cluster.local svc.cluster.localcluster.local\nnameserver 192.168.0.10\nOptions ndots:4\n```\n\nå½“Podå¯åŠ¨æ—¶ï¼ŒåŒä¸€Namespaceçš„æ‰€æœ‰Serviceéƒ½ä¼šä»¥ç¯å¢ƒå˜é‡çš„å½¢å¼è®¾ç½®åˆ°å®¹å™¨å†…\n\nå½±å“?\n\n# å…³äºDNSçš„è½åœ°å®è·µ\n\n- Kubernetesä½œä¸ºä¼ä¸šåŸºç¡€æ¶æ„çš„ä¸€éƒ¨åˆ†ï¼ŒKubernetesæœåŠ¡ä¹Ÿéœ€è¦å‘å¸ƒåˆ°ä¼ä¸šDNSï¼Œéœ€è¦å®šåˆ¶ä¼ä¸šDNSæ§åˆ¶å™¨\n\t- å¯¹äºKubernetesä¸­çš„æœåŠ¡ï¼Œåœ¨ä¼ä¸šDNSåŒæ ·åˆ›å»ºA/PTR/SRV recordsï¼ˆé€šå¸¸è§£æåœ°å€æ˜¯LOadBalancer VIPï¼‰\n\t- é’ˆå¯¹headless serviceï¼Œåœ¨PodIPå¯å…¨å±€è·¯ç”±çš„å‰æä¸‹ï¼ŒæŒ‰éœ€åˆ›å»ºDNS records\n\t- Headless serviceçš„DNSè®°å½•ï¼Œåº”è¯¥æŒ‰éœ€åˆ›å»ºï¼Œå¦åˆ™å¯¹ä¼ä¸šDNSå†²å‡»è¿‡å¤§\n- æœåŠ¡åœ¨é›†ç¾¤å†…é€šè¿‡CoreDNSå¯»å€ï¼Œåœ¨é›†ç¾¤å¤–é€šè¿‡ä¼ä¸šDNSå¯»å€ï¼ŒæœåŠ¡åœ¨é›†ç¾¤å†…å¤–æœ‰ç»Ÿä¸€æ ‡è¯†ã€‚\n\n# Kubernetesä¸­çš„è´Ÿè½½å‡è¡¡æŠ€æœ¯\n\n- **åŸºäºL4çš„æœåŠ¡**\n\t- åŸºäºiptables/ipvsçš„åˆ†å¸ƒå¼å››å±‚è´Ÿè½½å‡è¡¡æŠ€æœ¯\n\t- å¤šç§Load Balancer Provideræä¾›ä¸ä¼ä¸šç°æœ‰ELBçš„æ•´åˆ\n\t- kube-proxyåŸºäºiptables rulesä¸ºKuberneteså½¢æˆå…¨å±€ç»Ÿä¸€çš„distributed load balancer\n\t- kube-proxyæ˜¯ä¸€ç§meshï¼ŒInternal Clientæ— è®ºé€šè¿‡podipï¼Œ nodeportè¿˜æ˜¯LB VIPéƒ½ç»ç”±kube-proxyè·³è½¬è‡³pod\n\t- å±äºKubernetes core\n- **åŸºäºL7çš„Ingress**\n\t- åŸºäºä¸ƒå±‚åº”ç”¨å±‚ï¼Œæä¾›æ›´å¤šåŠŸèƒ½\n\t- TLS termination\n\t- L7 path forwarding\n\t- URL/http header rewrite\n\t- é‡‡ç”¨7å±‚è½¯ä»¶ç´§å¯†ç›¸å…³\n\n# Serviceä¸­çš„Ingressçš„å¯¹æ¯”\n\n**åŸºäºL4çš„æœåŠ¡**\n\n- æ¯ä¸ªåº”ç”¨ç‹¬å ELBï¼Œæµªè´¹èµ„æº\n- ä¸ºæ¯ä¸ªæœåŠ¡åŠ¨æ€åˆ›å»ºDNSè®°å½•ï¼Œé¢‘ç¹çš„DNSæ›´æ–°Â·\n- æ”¯æŒTCPå’ŒUDPï¼Œä¸šåŠ¡éƒ¨é—¨éœ€è¦å¯åŠ¨HTTPSæœåŠ¡ï¼Œè‡ªå·±ç®¡ç†è¯ä¹¦\n\n![image.png](Extras/Images/image_1666253529410_0.png)\n\n**åŸºäºL7çš„Ingress**\n\n- å¤šä¸ªåº”ç”¨å…±äº«ELBï¼ŒèŠ‚çœèµ„æº\n- å¤šä¸ªåº”ç”¨å…±äº«ä¸€ä¸ªDomainï¼Œå¯é‡‡ç”¨é™æ€DNSé…ç½®\n- TLS terminationå‘ç”Ÿåœ¨Ingresså±‚ï¼Œå¯é›†ä¸­ç®¡ç†è¯ä¹¦\n- æ›´å¤šå¤æ‚æ€§ï¼Œæ›´å¤šçš„ç½‘ç»œhop\n\n![image.png](Extras/Images/image_1666253658823_0.png)\n\n# Ingress\n\n**Ingress**\n\n- Ingressæ˜¯ä¸€å±‚ä»£ç†\n- è´Ÿè´£æ ¹æ®hostnameå’Œpathå°†æµé‡è½¬å‘åˆ°ä¸åŒçš„æœåŠ¡ä¸Šï¼Œä½¿å¾—ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ç”¨äºå¤šä¸ªåå°åº”ç”¨\n- Kubernetes Ingress Specæ˜¯è½¬å‘è§„åˆ™çš„é›†åˆ\n\n**Ingress Controller**\n\n- ç¡®ä¿å®é™…çŠ¶æ€ï¼ˆActualï¼‰ä¸æœŸæœ›çŠ¶æ€ï¼ˆDesiredï¼‰ä¸€è‡´çš„Control Loop\n- Ingress Controllerç¡®ä¿\n- è´Ÿè½½å‡è¡¡é…ç½®\n- è¾¹ç¼˜è·¯ç”±é…ç½®\n- DNSé…ç½®\n\n![image.png](Extras/Images/image_1666258785632_0.png)\n\n# ä¼ ç»Ÿåº”ç”¨ç½‘ç»œæ‹“æ‰‘\n\n![image.png](Extras/Images/image_1666259333625_0.png)\n\n# ä¸ºä»€ä¹ˆéœ€è¦æ„å»ºSLBæ–¹æ¡ˆ\n\n![image.png](Extras/Images/image_1666259361666_0.png)\n\n---\n\néœ€è¦è§£å†³é—®é¢˜âˆ¶å¦‚ä½•è®©domainç”¨æˆ·è‡ªå®šä¹‰åå°åº”ç”¨çš„è®¿é—®åœ°å€ï¼Œå¦‚ä½•ä¼˜åŒ–è®¿é—®è·¯å¾„\n\n![image.png](Extras/Images/image_1666259779802_0.png)\n\n# L4 é›†ç¾¤æ¶æ„\n\n![image.png](Extras/Images/image_1666260769431_0.png)\n\n# L7é›†ç¾¤æ¶æ„\n\n![image.png](Extras/Images/image_1666260815158_0.png)\n\n# æ•°æ®æµ\n\n![image.png](Extras/Images/image_1666264176705_0.png)\n\n# è·¨å¤§é™†çš„äº’è”ç½‘è°ƒç”¨\n\n![image.png](Extras/Images/image_1666264576724_0.png)\n\n# äº’è”ç½‘è·¯å¾„çš„ä¸ç¡®å®šæ€§\n\n![image.png](Extras/Images/image_1666264600590_0.png)\n\n# è¾¹ç¼˜åŠ é€Ÿæ–¹æ¡ˆç»¼è¿°\n\n![image.png](Extras/Images/image_1666264618205_0.png)\n\n# è¾¹ç¼˜åŠ é€Ÿç»„ä»¶\n\n![image.png](Extras/Images/image_1666264634297_0.png)\n\n# å¯¹ç½‘ç»œè·¯å¾„çš„ä¼˜åŒ–\n\n![image.png](Extras/Images/image_1666264650876_0.png)\n\n# ä¸åŒæ–¹æ¡ˆçš„å“åº”æ—¶é—´å¯¹æ¯”\n\n![image.png](Extras/Images/image_1666264674482_0.png)\n-\n\n","lastmodified":"2023-05-18T16:10:29.932349529Z","tags":["CS/Kubernetes"]},"/Cards/CS/Linux/%E5%86%85%E6%A0%B8":{"title":"å†…æ ¸","content":"\n`/etc/modules-load.d` ä¸ InÂ  `/etc/modprobe.d`çš„åŒºåˆ«\n\n`/etc/modules-load.d` can only load modules, nothing more. You canâ€™t blacklist a module and you canâ€™t insert a module with special options.\n\nInÂ  `/etc/modprobe.d` you can blacklist a module, you can crate an alias for a modulename and you can add special options for modules.\n\nSo basicallyÂ  `/etc/modules-load.d` can be used to insert a module at boot.Â  `/etc/modprobe.d` cab be used to blacklist or adds options.\n\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/Linux"]},"/Cards/CS/Linux/%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E8%AE%A1%E7%AE%97":{"title":"ç³»ç»Ÿèµ„æºè®¡ç®—","content":"\n# å†…å­˜\n\n## VIRT\n\n1. è¿›ç¨‹â€œéœ€è¦çš„â€è™šæ‹Ÿå†…å­˜å¤§å°ï¼ŒåŒ…æ‹¬è¿›ç¨‹ä½¿ç”¨çš„åº“ã€ä»£ç ã€æ•°æ®ï¼Œä»¥åŠmallocã€newåˆ†é…çš„å †ç©ºé—´å’Œåˆ†é…çš„æ ˆç©ºé—´ç­‰ï¼›\n2. å‡å¦‚è¿›ç¨‹æ–°ç”³è¯·10MBçš„å†…å­˜ï¼Œä½†å®é™…åªä½¿ç”¨äº†1MBï¼Œé‚£ä¹ˆå®ƒä¼šå¢é•¿10MBï¼Œè€Œä¸æ˜¯å®é™…çš„1MBä½¿ç”¨é‡ã€‚\n3. VIRT = SWAP + RES\n\n## RES\n\n1. è¿›ç¨‹å½“å‰ä½¿ç”¨çš„å†…å­˜å¤§å°ï¼ŒåŒ…æ‹¬ä½¿ç”¨ä¸­çš„mallocã€newåˆ†é…çš„å †ç©ºé—´å’Œåˆ†é…çš„æ ˆç©ºé—´ï¼Œä½†ä¸åŒ…æ‹¬swap outé‡ï¼›\n2. åŒ…å«å…¶ä»–è¿›ç¨‹çš„å…±äº«ï¼›\n3. å¦‚æœç”³è¯·10MBçš„å†…å­˜ï¼Œå®é™…ä½¿ç”¨1MBï¼Œå®ƒåªå¢é•¿1MBï¼Œä¸VIRTç›¸åï¼›\n4. å…³äºåº“å ç”¨å†…å­˜çš„æƒ…å†µï¼Œå®ƒåªç»Ÿè®¡åŠ è½½çš„åº“æ–‡ä»¶æ‰€å å†…å­˜å¤§å°ã€‚\n5. RES = CODE + DATA\n\n## SHR\n\n1. é™¤äº†è‡ªèº«è¿›ç¨‹çš„å…±äº«å†…å­˜ï¼Œä¹ŸåŒ…æ‹¬å…¶ä»–è¿›ç¨‹çš„å…±äº«å†…å­˜ï¼›\n2. è™½ç„¶è¿›ç¨‹åªä½¿ç”¨äº†å‡ ä¸ªå…±äº«åº“çš„å‡½æ•°ï¼Œä½†å®ƒåŒ…å«äº†æ•´ä¸ªå…±äº«åº“çš„å¤§å°ï¼›\n3. è®¡ç®—æŸä¸ªè¿›ç¨‹æ‰€å çš„ç‰©ç†å†…å­˜å¤§å°å…¬å¼ï¼šRES â€“ SHRï¼›\n4. swap outåï¼Œå®ƒå°†ä¼šé™ä¸‹æ¥ã€‚","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/Linux"]},"/Cards/CS/Linux/%E8%BF%9B%E7%A8%8B":{"title":"è¿›ç¨‹","content":"\n# è¿›ç¨‹ä¸çº¿ç¨‹\n\nè¿›ç¨‹ï¼šèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½\n\nçº¿ç¨‹ï¼šè°ƒåº¦çš„åŸºæœ¬å•ä½\n\næ— è®ºæ˜¯çº¿ç¨‹è¿˜æ˜¯è¿›ç¨‹ï¼Œåœ¨ linux ä¸­éƒ½ä»¥ task_struct æè¿°ï¼Œä»å†…æ ¸è§’åº¦çœ‹ï¼Œä¸è¿›ç¨‹æ— æœ¬è´¨åŒºåˆ«\n\nGlibc ä¸­çš„ pthread åº“æä¾› NPTLï¼ˆNative POSIX Threading Libraryï¼‰æ”¯æŒ\n\n![image.png](Extras/Images/image_1665579620119_0.png)\n\n# è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨\n\n![image.png](Extras/Images/image_1665579663729_0.png)\n\n# CPUå¯¹å†…å­˜çš„è®¿é—®\n\nCPU ä¸Šæœ‰ä¸ª Memory Management Unitï¼ˆMMUï¼‰ å•å…ƒ\n\nCPU æŠŠè™šæ‹Ÿåœ°å€ç»™ MMUï¼ŒMMU å»ç‰©ç†å†…å­˜ä¸­æŸ¥è¯¢é¡µè¡¨ï¼Œå¾—åˆ°å®é™…çš„ç‰©ç†åœ°å€\n\nCPU ç»´æŠ¤ä¸€ä»½ç¼“å­˜ Translation Lookaside Bufferï¼ˆTLBï¼‰ï¼Œç¼“å­˜è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€çš„æ˜ å°„å…³ç³»\n\n![image.png](Extras/Images/image_1665579718778_0.png)\n\n# è¿›ç¨‹åˆ‡æ¢å¼€é”€\n\n## ç›´æ¥å¼€é”€\n\nåˆ‡æ¢é¡µè¡¨å…¨å±€ç›®å½•ï¼ˆPGDï¼‰\n\nåˆ‡æ¢å†…æ ¸å †æ ˆ\n\nåˆ‡æ¢ç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼ˆè¿›ç¨‹æ¢å¤å‰ï¼Œå¿…é¡»è£…å…¥å¯„å­˜å™¨çš„æ•°æ®ç»Ÿç§°ä¸ºç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼‰\n\nåˆ·æ–°TLB\n\nç³»ç»Ÿè°ƒåº¦å™¨çš„ä»£ç æ‰§è¡Œ\n\n## é—´æ¥å¼€é”€\n\nCPU ç¼“å­˜å¤±æ•ˆå¯¼è‡´çš„è¿›ç¨‹éœ€è¦åˆ°å†…å­˜ç›´æ¥è®¿é—®çš„ IO æ“ä½œå˜å¤š\n\n# çº¿ç¨‹åˆ‡æ¢å¼€é”€\n\nçº¿ç¨‹æœ¬è´¨ä¸Šåªæ˜¯ä¸€æ‰¹å…±äº«èµ„æºçš„è¿›ç¨‹ï¼Œçº¿ç¨‹åˆ‡æ¢æœ¬è´¨ä¸Šä¾ç„¶éœ€è¦å†…æ ¸è¿›è¡Œè¿›ç¨‹åˆ‡æ¢\n\nä¸€ç»„çº¿ç¨‹å› ä¸ºå…±äº«å†…å­˜èµ„æºï¼Œå› æ­¤ä¸€ä¸ªè¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹å…±äº«è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œçº¿ç¨‹åˆ‡æ¢ç›¸æ¯”è¿›ç¨‹åˆ‡æ¢ï¼Œ**ä¸»è¦èŠ‚çœäº†è™šæ‹Ÿåœ°å€ç©ºé—´çš„åˆ‡æ¢**\n\n# ç”¨æˆ·çº¿ç¨‹\n\næ— éœ€å†…æ ¸å¸®åŠ©ï¼Œåº”ç”¨ç¨‹åºåœ¨ç”¨æˆ·ç©ºé—´åˆ›å»ºçš„å¯æ‰§è¡Œå•å…ƒï¼Œåˆ›å»ºé”€æ¯å®Œå…¨åœ¨ç”¨æˆ·æ€å®Œæˆã€‚\n\n![image.png](Extras/Images/image_1665580048890_0.png)\n\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/Linux"]},"/Cards/CS/Linux/%E9%95%9C%E5%83%8F%E7%AB%99":{"title":"é•œåƒç«™","content":"\n[åŒ—äº¬å¤–å›½è¯­å¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™](https://mirrors.bfsu.edu.cn/)\n\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/Linux"]},"/Cards/CS/Linux/ZFS":{"title":"ZFS","content":"\nARCç¼“å­˜é™åˆ¶\n\néœ€è¦æŠŠå‚æ•°å†™åˆ°cmdlineä¸­ï¼Œå†™åœ¨ `/etc/modprobe.d` ä¸­ä¸ç”Ÿæ•ˆ\n\n`GRUB_CMDLINE_LINUX=\"zfs.zfs_arc_max=8589934592 zfs.zfs_arc_min=4294967296\"`\n\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/Linux"]},"/Cards/CS/Linux/homelab":{"title":"homelab","content":"\n* è·¯ç”±å™¨\n\t* openwrt\n\t* openclash\n\t* zerotier\n* K8S\n\t* K9S\n* registry\n\t* harbor\n\t\t* æ”¯æŒdockeré•œåƒ\n\t\t* æ”¯æŒK8S helm\n* OSS\n\t* Minio","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/Linux"]},"/Cards/CS/Linux/tmux":{"title":"tmux","content":"\n# å¿«æ·é”®\n\n1. tmuxçª—å£æœ€å¤§åŒ–ï¼šprefix+z","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/Linux"]},"/Cards/CS/Linux/zerotier-moon":{"title":"zerotier-moon","content":"\n* ä½¿ç”¨dockeræ­å»º\n\t* éƒ¨ç½²å‘½ä»¤ï¼š`docker run --name zerotier-moon -d --restart always -p 9993:9993/udp -v \u003czerotier-moon-config dir\u003e:/var/lib/zerotier-one seedgou/zerotier-moon -4 \u003cpublic ipv4 addression\u003e`\n\t* æŸ¥çœ‹moon idï¼š`docker logs zerotier-moon`\n* é˜²ç«å¢™è®¾ç½®\n\t* 9993ç«¯å£çš„TCPå’ŒUDPå‡è¦æ‰“å¼€\n* å®¢æˆ·ç«¯é…ç½®\n\t* ç›´æ¥ä½¿ç”¨å‘½ä»¤ `zerotier-cli orbit xxxxxx xxxxxx` æ·»åŠ \n\t* å°†moonç”Ÿæˆçš„é…ç½®çš„moons.dä¸‹çš„000000xxxxxx.moonæ–‡ä»¶æ‹·å…¥å®¢æˆ·ç«¯çš„ç›¸åŒç›®å½•ä¸‹ï¼Œå¹¶é‡å¯æœåŠ¡\n\t* macosçš„é…ç½®è·¯å¾„ä¸º`/Library/Application Support/ZeroTier/One`\n\t* æ·»åŠ å®Œåéœ€è¦é‡å¯æœåŠ¡ï¼ˆä¸ç¡®å®šï¼‰\n* æµ‹è¯•\n\t* `zerotier-cli listpeers`ï¼šå¦‚æœå‘½ä»¤è¾“å‡ºä¸­å¸¦æœ‰moonæœåŠ¡å™¨çš„IPåœ°å€ï¼Œå¹¶ä¸”roleä¸ºmoonï¼Œå³è¯´æ˜moonè¿æ¥æˆåŠŸ\n\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/Linux"]},"/Cards/CS/MongoDB/%E7%B4%A2%E5%BC%95":{"title":"ç´¢å¼•","content":"\n# ç´¢å¼•æ’åº\n\n* å•å­—æ®µçš„ç´¢å¼•ï¼Œåˆ›å»ºæ—¶ä¸è®ºæŒ‡å®šå‡åºè¿˜æ˜¯é™åºï¼Œå®ƒæŸ¥è¯¢æ—¶ç”¨çš„ sort å¯ä»¥æ˜¯ä»»æ„æ–¹å‘çš„ï¼ˆå‡åºæˆ–é™åºï¼‰ã€‚\n\t* å¤šå­—æ®µçš„ç´¢å¼•æŒ‰å‰ç¼€åŒ¹é…\n\t* æ’åºå­—æ®µçš„Â â€œæ’åºé¡ºåºâ€ï¼Œå¿…é¡»å’Œç´¢å¼•ä¸­çš„å¯¹åº”å­—æ®µçš„æ’åºé¡ºåºå®Œå…¨ç›¸åŒæˆ–å®Œå…¨ç›¸åã€‚\n\t* sort æ¡ä»¶æ˜¯ index çš„å‰ç¼€å­é›†æ—¶ï¼Œquery æ¡ä»¶å¯ä»¥ä¸ºç©ºï¼Œä¹Ÿå¯ä»¥ä¸ºä»»ä½• index çš„å‰ç¼€å­é›†ã€‚\n\t* sort æ¡ä»¶ä¸æ˜¯ index çš„å‰ç¼€å­é›†æ—¶ï¼Œquery æ¡ä»¶å¿…é¡»åŒ…å« index å­—æ®µä¸­ sort å­—æ®µå‰æ–¹çš„æ‰€æœ‰å­—æ®µã€‚\n\n# æ•°æ®ç»“æ„\n\n## MongoDb çœŸçš„ç”¨çš„æ˜¯ B æ ‘å—ï¼Ÿ\n\né€šè¿‡æŸ¥é˜…èµ„æ–™ï¼Œæˆ‘ä» MongoDb çš„å®˜ç½‘å’Œ WiredTiger å®˜ç½‘æ‰¾åˆ°äº†ç­”æ¡ˆã€‚MongoDb å®˜ç½‘å…³äºå­˜å‚¨å¼•æ“ï¼ˆStorage Engineï¼‰çš„æè¿°å†™é“ï¼šä» MongoDb 3.2 ç‰ˆæœ¬å¼€å§‹ï¼Œå…¶ä½¿ç”¨äº† WiredTiger ä½œä¸ºå…¶é»˜è®¤çš„å­˜å‚¨å¼•æ“ã€‚\n\nè€Œä» WiredTiger å®˜ç½‘æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š**WiredTiger ä½¿ç”¨çš„æ˜¯ B+ æ ‘ä½œä¸ºå…¶å­˜å‚¨ç»“æ„**ã€‚\n\né‚£ä¸ºä»€ä¹ˆä¼šå‡ºç°å¾ˆå¤šèµ„æ–™è¯´ MongoDb ä½¿ç”¨ B æ ‘ä½œä¸ºå­˜å‚¨çš„æ•°æ®ç»“æ„å‘¢ï¼Ÿæˆ‘æƒ³å¯èƒ½æœ‰ä¸¤ä¸ªåŸå› ï¼šä¸€ä¸ªåŸå› å¯èƒ½æ˜¯ B+ Tree æœ¬èº«æ˜¯ B æ ‘çš„ä¸€ç§ä¼˜åŒ–ï¼Œæ‰€ä»¥å¾ˆå¤šäººå°±ç›´æ¥æŠŠ B+ æ ‘è¯´æˆ B æ ‘äº†ã€‚å¦ä¸€ä¸ªåŸå› å¯èƒ½æ˜¯ MongoDb 3.2 ä¹‹å‰ï¼Œç¡®å®ä½¿ç”¨ B æ ‘ä½œä¸ºå­˜å‚¨çš„æ•°æ®ç»“æ„ã€‚\n\n## Bæ ‘å’ŒB+æ ‘çš„ä¼˜ç¼ºç‚¹\n\n\u003e B æ ‘ä¸ B+ æ ‘ï¼Œå…¶æ¯”è¾ƒå¤§çš„ç‰¹ç‚¹æ˜¯ï¼šB æ ‘å¯¹äºç‰¹å®šè®°å½•çš„æŸ¥è¯¢ï¼Œå…¶æ—¶é—´å¤æ‚åº¦æ›´ä½ã€‚è€Œ B+ æ ‘å¯¹äºèŒƒå›´æŸ¥è¯¢åˆ™æ›´åŠ æ–¹ä¾¿ã€‚\n\nB+**æ ‘æŸ¥è¯¢é€Ÿåº¦æ›´ç¨³å®š**ï¼šB+æ‰€æœ‰å…³é”®å­—æ•°æ®åœ°å€éƒ½å­˜åœ¨**å¶å­**èŠ‚ç‚¹ä¸Šï¼Œæ‰€ä»¥æ¯æ¬¡æŸ¥æ‰¾çš„æ¬¡æ•°éƒ½ç›¸åŒæ‰€ä»¥æŸ¥è¯¢é€Ÿåº¦è¦æ¯”Bæ ‘æ›´ç¨³å®šã€‚\n\nB+**æ ‘å¤©ç„¶å…·å¤‡æ’åºåŠŸèƒ½ï¼š** B+æ ‘æ‰€æœ‰çš„**å¶å­**èŠ‚ç‚¹æ•°æ®æ„æˆäº†ä¸€ä¸ªæœ‰åºé“¾è¡¨ï¼Œåœ¨æŸ¥è¯¢å¤§å°åŒºé—´çš„æ•°æ®æ—¶å€™æ›´æ–¹ä¾¿ï¼Œæ•°æ®ç´§å¯†æ€§å¾ˆé«˜ï¼Œç¼“å­˜çš„å‘½ä¸­ç‡ä¹Ÿä¼šæ¯”Bæ ‘é«˜ã€‚\n\nB+**æ ‘å…¨èŠ‚ç‚¹éå†æ›´å¿«ï¼š** B+æ ‘éå†æ•´æ£µæ ‘åªéœ€è¦éå†æ‰€æœ‰çš„**å¶å­**èŠ‚ç‚¹å³å¯ï¼Œè€Œä¸éœ€è¦åƒBæ ‘ä¸€æ ·éœ€è¦å¯¹æ¯ä¸€å±‚è¿›è¡Œéå†ï¼Œè¿™æœ‰åˆ©äºæ•°æ®åº“åšå…¨è¡¨æ‰«æã€‚\n\n**Bæ ‘**ç›¸å¯¹äº**B+æ ‘**çš„ä¼˜ç‚¹æ˜¯ï¼Œå¦‚æœç»å¸¸è®¿é—®çš„æ•°æ®ç¦»æ ¹èŠ‚ç‚¹å¾ˆè¿‘ï¼Œè€Œ**Bæ ‘**çš„**éå¶å­**èŠ‚ç‚¹æœ¬èº«å­˜æœ‰å…³é”®å­—å’Œæ•°æ®ï¼Œæ‰€ä»¥åœ¨æŸ¥è¯¢è¿™ç§æ•°æ®æ£€ç´¢çš„æ—¶å€™ä¼šè¦æ¯”**B+æ ‘**å¿«ã€‚\n\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["CS/MongoDB"]},"/Cards/CS/RSS/%E5%9F%BA%E4%BA%8ERSS%E7%9A%84%E6%8E%A8%E9%80%81%E7%B3%BB%E7%BB%9F":{"title":"åŸºäºRSSçš„æ¨é€ç³»ç»Ÿ","content":"\n# æƒ³æ³•\n\nä½¿ç”¨RSSHUBæœç´¢åŸRSSä¸­çš„ç‰¹å®šä¿¡æ¯å¹¶ç”Ÿæˆæ–°çš„RSSï¼ˆåˆ·æ–°é€Ÿåº¦æå¿«ï¼‰ï¼Œå†ä½¿ç”¨RSSå®¢æˆ·ç«¯æ¯”å¦‚æµè§ˆå™¨æ‰©å±•æˆ–telegram botè¯»å–æ–°ç”Ÿæˆçš„RSSå¹¶è¿›è¡Œæ¨é€ï¼ˆåŒæ ·éœ€è¦åˆ·æ–°é€Ÿåº¦æå¿«ï¼‰ã€‚\n\n# å®è·µ\n\n## è®¢é˜…telegramé¢‘é“\n\nå°†é¢‘é“usernameä¸éœ€è¦æœç´¢çš„å…³é”®å­—å¡«åˆ°RSSHUBçš„è·¯ç”±ä¸­\n\nå°†ä¸Šä¸€æ­¥RSSHUBçš„è·¯ç”±æ·»åŠ RSSå®¢æˆ·ç«¯ä¸­\n\nRSSå®¢æˆ·ç«¯å®ç°æ¨é€\n\n## RSSå®¢æˆ·ç«¯æœ€å¿«åˆ·æ–°æ—¶é—´\n\n[[Cards/CS/RSS/RSS Reader]]\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["RSS"]},"/Cards/CS/RSS/%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84RSS%E6%9C%8D%E5%8A%A1":{"title":"æ­å»ºè‡ªå·±çš„RSSæœåŠ¡","content":"\n# ä¸ºä»€ä¹ˆæ­å»ºè‡ªå·±çš„RSSæœåŠ¡å¹³å°\n\nåŸºäºDockerï¼Œè‡ªå»ºéš¾åº¦ä½ï¼Œè¿ç§»æ€§å¥½ã€‚\n\nè‡ªå»ºRSSè®¢é˜…å™¨å¹³å°è¶³å¤Ÿå¼ºå¤§ã€‚æœ‰filteråŠŸèƒ½ç­‰ã€‚\n\næ•°æ®å®Œå…¨æŒæ¡åœ¨è‡ªå·±æ‰‹ä¸­ã€‚å¯é€šè¿‡duplicatiå¤‡ä»½ã€‚\n\næ— å¹¿å‘Šï¼Œä¸æ‹…å¿ƒæ‰˜ç®¡å¹³å°å€’é—­ã€‚RSSé˜…è¯»å™¨å¹³å°ç»å¸¸ä¼šç”±äºç›ˆåˆ©æˆ–æ”¿ç­–åŸå› å…³é—¨ã€‚\n\næ²¡æœ‰è®¢é˜…æ•°ä¸Šé™æˆ–å…¶å®ƒæ¶å¿ƒçš„é™åˆ¶ã€‚å®Œå…¨å…è´¹ã€‚\n\nè¿›ä¸€æ­¥å‹æ¦¨VPSã€‚æ¯•ç«Ÿæœ‰è¿™ä¹ˆå¤šæ€§èƒ½æº¢å‡ºï¼\n\né€šè¿‡æ’ä»¶åŠŸèƒ½å¯ä»¥**æ”¯æŒå†…åµŒYoutubeã€Bilibiliã€è¥¿ç“œè§†é¢‘**ç­‰ã€‚\n\nå°†å¤šRSSæºåˆå¹¶æˆä¸€ä¸ªURLåˆ†äº«ç»™ä»–äºº\n\n# æ€è·¯\n\nè‡ªå·±æ­ä¸€ä¸ª RSS Server ï¼ˆå¦‚ FreshRSS æˆ–è€… TTRSS ï¼‰ï¼Œåœ¨æœåŠ¡ç«¯ç®¡ç†è‡ªå·±çš„ RSS æºã€‚\n\nå¯¹å®¢æˆ·ç«¯çš„è¦æ±‚å°±æ˜¯æ”¯æŒ Google Reader API æˆ–è€… Fever API ï¼Œå®¢æˆ·ç«¯èƒ½é€šè¿‡ API è¿æ¥åˆ° RSS Server å°±å¯ä»¥äº†ã€‚\n\n# æ–¹æ¡ˆ\n\nç”± é˜…è¯»å™¨ + rssæœåŠ¡ + rssç”Ÿæˆå™¨ + rssæ¢æµ‹å™¨ ç»„æˆï¼š\n\n**fluent reader**ï¼ˆå…è´¹è·¨ç«¯é˜…è¯»å™¨ï¼‰+\n\n**freshRSS**ï¼ˆç”¨äºç®¡ç†è®¢é˜…æºåŠæš´éœ²fever apiä¾›é˜…è¯»å™¨ä½¿ç”¨ï¼‰+\n\n**RSShub**ï¼ˆç”¨äºç”Ÿæˆè®¢é˜…æºï¼‰+\n\n**RSShub radar**ï¼ˆç”¨äºå—…æ¢è®¢é˜…æºï¼Œä»¥åŠä¸€é”®å½•å…¥åˆ°freshrssï¼‰\n\n## fluent reader â€”â€” é˜…è¯»å™¨\n\nä¸€æ¬¾å¼€æºçš„è·¨ç«¯ï¼ˆç§»åŠ¨+æ¡Œé¢ï¼‰rssé˜…è¯»å™¨ï¼Œä¸æ”¶é›†ä¸ªäººæ•°æ®ã€‚\n\nå®ƒæä¾›äº†æœåŠ¡æ¨¡å¼ï¼Œå³æŠŠè®¢é˜…æºäº¤ç»™å¤–éƒ¨æœåŠ¡ç®¡ç†ï¼Œè‡ªèº«ä½œä¸ºä¸€ä¸ªé˜…è¯»å™¨åŠå¤–éƒ¨æœåŠ¡çš„ä»£ç†ã€‚\n\næˆ‘é€‰æ‹©äº†ã€Œfever apiã€æœåŠ¡æ¨¡å¼ï¼Œåªè¦å¯¹åº”çš„æœåŠ¡å®ç°äº†fever apiï¼Œå°±å¯ä»¥ä½¿ç”¨ï¼Œæ¯”å¦‚freshrssã€tiny tiny rssã€‚\n\nè¿›å…¥è½¯ä»¶åï¼Œä¼šé€šè¿‡æœåŠ¡æä¾›çš„fever apiæ‹‰å–è®¢é˜…æºã€‚å½“ç‚¹å‡»å¼€å§‹é˜…è¯»æ–‡ç« æ—¶ï¼Œä¹Ÿä¼šé€šè¿‡fever apiå‘é€è¯·æ±‚ï¼Œåœ¨webæœåŠ¡ç«¯å°†æ–‡ç« æ ‡æ³¨ä¸ºå·²è¯»ï¼Œè¿™æ ·ä¸ç®¡åœ¨æ¡Œé¢è¿˜æ˜¯æ‰‹æœºï¼Œéƒ½å¯ä»¥è·å–åˆ°ç›¸åŒçš„é˜…è¯»çŠ¶æ€ã€‚\n\n## freshRSS â€”â€” RSSç®¡ç†æœåŠ¡\n\nä¸€æ¬¾å¼€æºçš„rssæºç®¡ç†è½¯ä»¶ï¼Œæ”¯æŒå¤šç”¨æˆ·ã€åˆ†ç±»ã€æ‰“æ ‡ç­¾ï¼Œä»¥åŠä¸°å¯Œçš„è®¢é˜…é…ç½®ï¼Œæ¯”å¦‚æ•°æ®æ¸…ç†é…ç½®ã€‚\n\næœ€é‡è¦çš„æ˜¯æä¾›äº†**fever api**ã€google reader compatible apiï¼Œè®©æ”¯æŒè¿™äº›apiçš„é˜…è¯»å™¨å¯ä»¥æ–¹ä¾¿ä»£ç†ã€‚\n\n## RSShub â€”â€” RSSé›†æ•£åœ°\n\nä¸€ä¸ªå¼€æºæ˜“æ‰©å±•çš„rssç”Ÿæˆå™¨ï¼Œç®€å•æ¥è¯´ï¼šè®©ä¸‡ç‰©çš†å¯rssã€‚\n\nå¯¹äºè¯»è€…æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªrssé›†æ•£åœ°ã€‚\n\nå¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªçˆ¬è™«è·¯ç”±åŠè§£ææœåŠ¡ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡gotã€cheerioç­‰åº“ï¼Œæ¥æŠ“å–ç½‘é¡µæ•°æ®ï¼Œäº¤ç”±rsshubç”Ÿæˆrssæºã€‚\n\n## RSShub radar â€”â€” RSSæ¢æµ‹å™¨\n\nä¸€æ¬¾ç”¨äºæ¢æµ‹rssæºçš„chromeæ’ä»¶ã€‚\n\næ¯”å¦‚ä½ è®¿é—®æŸä¸ªçŸ¥ä¹ç”¨æˆ·çš„ä¸»é¡µï¼Œrsshub radarä¼šè‡ªåŠ¨æ¢æµ‹é¡µé¢é‡Œçš„rssæºï¼Œå¹¶ä¸”å¯ä»¥ä¸€é”®æ·»åŠ è¿›freshrss\n\n# å‚è€ƒèµ„æ–™\n\n1. [æ‰“é€ å®Œç¾çš„rssæ–¹æ¡ˆï¼ˆä¸€ï¼‰ï¼šå™¨](https://juejin.cn/post/7108731159017685006)\n2. [Dockerç³»åˆ— å®‰è£…ä¸ªäººRSSæœåŠ¡TTRSS æ‰‹æœºå®Œç¾é€‚é…](https://blognas.hwb0307.com/linux/docker/788)\n\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["RSS"]},"/Cards/CS/RSS/RSS-Reader":{"title":"RSS Reader","content":"\n|å®¢æˆ·ç«¯|å¹³å°|æ˜¯å¦æ”¶è´¹|æœ€çŸ­åˆ·æ–°æ—¶é—´|ä¼˜ç‚¹|ç¼ºç‚¹|\n|--|--|--|--|--|--|\n|Reeder 5|Mac/iOS|10$||ç•Œé¢ç¾è§‚|æ”¶è´¹|\n|inoreader|web/iOS|å¯å…è´¹ä½¿ç”¨|å®æ—¶/10åˆ†é’Ÿ|åŠŸèƒ½ä¸°å¯Œ||\n|Tiny Tiny RSS|web|å…è´¹|15åˆ†é’Ÿ|è‡ªå»º||\n|Feeder|web/æµè§ˆå™¨æ‰©å±•|å…è´¹|1åˆ†é’Ÿ|||\n|Feedbro|æµè§ˆå™¨æ‰©å±•|å…è´¹|5åˆ†é’Ÿ|||\n|NetNewsWire|Mac/iOS|å…è´¹|10åˆ†é’Ÿ|||\n|FreshRSS|web|å…è´¹|20åˆ†é’Ÿ|è‡ªå»º||\n|miniflux|web|å…è´¹|æ— æ³•è®¾ç½®|è‡ªå»ºã€ç®€å•||\n|fluent-reader|å…¨å¹³å°|å…è´¹|10åˆ†é’Ÿ|||\n|QuiteRSS|Mac/Win/Linux|å…è´¹|1ç§’||å¤å¤ï¼Œå¤ªä¸‘|\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":["RSS"]},"/Cards/ChatGPT":{"title":"ChatGPT","content":"\n# å‰æƒ…æè¦\n\n- [How ChatGPT Works Technically | ChatGPT Architecture - YouTube](https://www.youtube.com/watch?v=bSvTVREwSNw)\n- [ã€æ¸æ„ã€‘ä¸‡å­—ç§‘æ™®GPT4ä¸ºä½•ä¼šé¢ è¦†ç°æœ‰å·¥ä½œæµï¼›ä¸ºä½•ä½ è¦å…³æ³¨å¾®è½¯Copilotã€æ–‡å¿ƒä¸€è¨€ç­‰å¤§æ¨¡å‹\\_å“”å“©å“”å“©\\_bilibili](https://www.bilibili.com/video/BV1MY4y1R7EN/)\n\n---\n\n## GPT æ˜¯ä»€ä¹ˆ\n\nGenerative Pre-trained Transformerï¼š ç”Ÿæˆå¼é¢„è®­ç»ƒå˜æ¢æ¨¡å‹\n\nGenerativeï¼šè‡ªå‘ç”Ÿæˆæ–°çš„æ–‡æœ¬åºåˆ—ï¼Œå¯ä»¥ç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ã€‚\n\nPre-trainedï¼šåœ¨å¤§è§„æ¨¡çš„æ•°æ®é›†ä¸Šè¿›è¡Œæ— ç›‘ç£å­¦ä¹ ï¼Œé€šè¿‡å­¦ä¹ ç‰¹å¾/çŸ¥è¯†ï¼Œå¢åŠ æ¨¡å‹çš„åè¯èƒ½åŠ›å’Œè¡¨ç°ã€‚\n\nTransformerï¼šåŸºäºè‡ªæ³¨æ„åŠ›æœºåˆ¶çš„ç¥ç»ç½‘ç»œç»“æ„ã€‚å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé»‘ç›’å­ï¼Œå°†è‡ªç„¶è¯­è¨€ç¿»è¯‘ä¸ºmachine learningè¯­è¨€ã€‚\n\n---\n\nNew bing å›ç­”ï¼š\n\nGPTçš„æŠ€æœ¯ç»†èŠ‚æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘å°½é‡ç®€å•åœ°ç»™ä½ è®²ä¸€ä¸‹ã€‚GPTæ˜¯ä¸€ç§åŸºäºTransformeræ¶æ„çš„è¯­è¨€æ¨¡å‹ï¼Œå®ƒä½¿ç”¨äº†è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆself-attention mechanismï¼‰æ¥æ•æ‰æ–‡æœ¬ä¸­çš„é•¿è·ç¦»ä¾èµ–å…³ç³»ã€‚GPTçš„ç‰¹ç‚¹æ˜¯ä½¿ç”¨äº†ç”Ÿæˆå¼é¢„è®­ç»ƒï¼ˆgenerative pre-trainingï¼‰å’Œç²¾ç»†è°ƒèŠ‚ï¼ˆfine-tuningï¼‰çš„æ–¹æ³•ï¼Œå³å…ˆåœ¨å¤§è§„æ¨¡çš„æ— ç›‘ç£è¯­æ–™ä¸Šè¿›è¡Œé¢„è®­ç»ƒï¼Œå­¦ä¹ æ–‡æœ¬çš„é€šç”¨è¡¨ç¤ºï¼Œç„¶ååœ¨å°è§„æ¨¡çš„æœ‰ç›‘ç£æ•°æ®é›†ä¸Šè¿›è¡Œç²¾ç»†è°ƒèŠ‚ï¼Œé€‚åº”ä¸åŒçš„ä¸‹æ¸¸ä»»åŠ¡ã€‚GPTè¿˜ä½¿ç”¨äº†æ©ç ï¼ˆmaskingï¼‰æŠ€æœ¯ï¼Œä½¿å¾—æ¨¡å‹åªèƒ½çœ‹åˆ°æ–‡æœ¬ä¸­å½“å‰ä½ç½®ä¹‹å‰çš„å†…å®¹ï¼Œä»è€Œå®ç°è‡ªå›å½’ï¼ˆautoregressiveï¼‰ç”Ÿæˆã€‚\n\n## GPT åŸºç¡€åŸç†\n\n- ChatGPTçš„å®è´¨åŠŸèƒ½æ˜¯å•å­—æ¥é¾™\n- é•¿æ–‡ç”±å•å­—æ¥é¾™çš„è‡ªå›å½’æ‰€ç”Ÿæˆ\n- é€šè¿‡æå‰è®­ç»ƒæ‰èƒ½è®©å®ƒç”Ÿæˆäººä»¬æƒ³è¦çš„é—®ç­”\n- è®­ç»ƒæ–¹å¼æ˜¯è®©å®ƒæŒ‰ç…§é—®ç­”èŒƒä¾‹æ¥åšå•å­—æ¥é¾™\n- è¿™æ ·è®­ç»ƒæ˜¯ä¸ºäº†è®©å®ƒå­¦ä¼šã€Œèƒ½ä¸¾ä¸€åä¸‰çš„è§„å¾‹ã€\n- ç¼ºç‚¹æ˜¯å¯èƒ½æ··æ·†è®°å¿†ï¼Œæ— æ³•ç›´æ¥æŸ¥çœ‹å’Œæ›´æ–°æ‰€å­¦ï¼Œä¸”é«˜åº¦ä¾èµ–å­¦ä¹ ææ–™\n\n## ChatGPT çš„ä¸‰ä¸ªè®­ç»ƒé˜¶æ®µ\n\n- â€œå¼€å·æœ‰ç›Šâ€é˜¶æ®µï¼šè®© ChatGPT å¯¹ã€Œæµ·é‡äº’è”ç½‘æ–‡æœ¬ã€åšå•å­—æ¥é¾™ï¼Œä»¥æ‰©å……æ¨¡å‹çš„è¯æ±‡é‡ã€è¯­è¨€çŸ¥è¯†ã€ä¸–ç•Œçš„ä¿¡æ¯ä¸çŸ¥è¯†ã€‚ä½¿ ChatGPT ä»â€œå“‘å·´é¹¦é¸±â€å˜æˆâ€œè„‘å®¹é‡è¶…çº§å¤§çš„æ‡‚ç‹é¹¦é¹‰â€ã€‚\n\t- æ— ç›‘ç£å­¦ä¹ \n- â€œæ¨¡æ¿è§„èŒƒâ€é˜¶æ®µï¼šè®© ChatGPT å¯¹ã€Œä¼˜è´¨å¯¹è¯èŒƒä¾‹ã€åšå•å­—æ¥é¾™ï¼Œä»¥è§„èŒƒå›ç­”çš„å¯¹è¯æ¨¡å¼å’Œå¯¹è¯å†…å®¹ã€‚ä½¿ ChatGPT å˜æˆâ€œæ‡‚è§„çŸ©çš„åšå­¦é¹¦é¹‰â€ã€‚\n\t- ç›‘ç£å­¦ä¹ \n- â€œåˆ›æ„å¼•å¯¼â€é˜¶æ®µï¼šè®© ChatGPT æ ¹æ®ã€Œäººç±»å¯¹å®ƒç”Ÿæˆç­”æ¡ˆçš„å¥½åè¯„åˆ†ã€æ¥è°ƒèŠ‚æ¨¡å‹ï¼Œä»¥å¼•å¯¼å®ƒç”Ÿæˆäººç±»è®¤å¯çš„åˆ›æ„å›ç­”ã€‚ä½¿ ChatGPT å˜æˆâ€œæ—¢æ‡‚è§„çŸ©åˆä¼šè¯•æ¢çš„åšå­¦é¹¦é¹…â€ã€‚\n\t- å¼ºåŒ–å­¦ä¹ \n\nå½“å•å­—æ¥é¾™æ¨¡å‹çš„è§„æ¨¡è¾¾åˆ°ä¸€å®šç¨‹åº¦å (LLMï¼‰ï¼Œå°±ä¼šæ¶Œç°å‡ºâ€œç†è§£â€æŒ‡ä»¤ï¼Œâ€œç†è§£â€ä¾‹å­ï¼Œæ€ç»´é“¾çš„èƒ½åŠ›ã€‚\n\n## æœªæ¥å½±å“\n\n- ChatGPT çš„é©å‘½æ„ä¹‰æ˜¯å‘äººä»¬å±•ç¤ºäº†ã€Œå¤§è¯­è¨€æ¨¡å‹çš„å¯è¡Œæ€§ã€\n- äººç±»ç¾¤ä½“é€šè¿‡è¯­è¨€å¤„ç†æ¥å®ç°ã€ŒçŸ¥è¯†çš„åˆ›é€ ã€ç»§æ‰¿å’Œåº”ç”¨ã€\n- æœºå™¨å¤„ç†è¯­è¨€æœ‰ç€é€Ÿåº¦å¿«ã€è®°å¿†å¤§ã€è¦†ç›–å¹¿ã€æ— ç–²åŠ³çš„ä¼˜ç‚¹\n- å¤§è¯­è¨€æ¨¡å‹èƒ½å‡è½»è¯­è¨€å¤„ç†å·¥ä½œï¼Œæ”¹å˜äººä¸äººã€äººä¸æœºå™¨çš„åä½œæ–¹å¼\n- äººç±»çš„ç†è§£å’Œæœºå™¨çš„ç†è§£ä¸åŒï¼Œè¯­è¨€æ¨¡å‹ä¸çŸ¥é“ç¬¦å·çš„æŒ‡ä»£\n- å¤§è¯­è¨€æ¨¡å‹å¯¹ç¤¾ä¼šçš„æœ«æ¥å½±å“ï¼Œç›¸å½“äºå£è¯­ã€æ–‡å­—ã€ç”µè„‘ã€äº’è”ç½‘å¯¹ç¤¾ä¼šçš„å½±å“\n- å¯¹æ•™è‚²ç•Œã€å­¦æœ¯ç•Œã€æ–°é—»ç•Œã€å†…å®¹ç”Ÿäº§è¡Œä¸šçš„å½±å“é¢‡æ·±\n- å®ƒå°†æ–¹ä¾¿äººç±»å¯¹æ—¢æœ‰çŸ¥è¯†çš„ç»§æ‰¿ï¼Œæ¨è¿›æ•™è‚²å»åŸ¹å…»é«˜å±‚æ¬¡äººæ‰\n- ä¹Ÿå°†å¸¦æ¥ç½‘ç»œå®‰å…¨å’Œç¤¾ä¼šå®‰å…¨çš„æ–°æŒ‘æˆ˜\n\n## Completions\n\nCompletionsÂ endpoint æ˜¯ ChatGPT API çš„æ ¸å¿ƒï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæå…¶çµæ´»å’Œå¼ºå¤§çš„ç®€å•æ¥å£ã€‚ä½ è¾“å…¥ä¸€äº›æ–‡å­—ä½œä¸º**promot**ï¼ŒAPI å°†è¿”å›ä¸€ä¸ªæ–‡æœ¬**completion**ï¼Œå®ƒä¼šå°è¯•åŒ¹é…ä½ æä¾›çš„ä»»ä½•æŒ‡ä»¤æˆ–ä¸Šä¸‹æ–‡ã€‚\n\n![[Extras/Images/Pasted image 20230503165926.png]]\n\nå¯ä»¥å°†å…¶è§†ä¸ºéå¸¸é«˜çº§çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½â€”â€”è¯¥æ¨¡å‹ä¼šå¤„ç†ä½ çš„æ–‡æœ¬æç¤ºå¹¶å°è¯•é¢„æµ‹æ¥ä¸‹æ¥æœ€æœ‰å¯èƒ½å‡ºç°çš„å†…å®¹ã€‚\n\n## æ ¸å¿ƒæ¦‚å¿µ\n\n### Prompts\n\nè®¾è®¡ prompt æœ¬è´¨ä¸Šå°±æ˜¯ä½ å¦‚ä½•\"ç¼–ç¨‹\"æ¨¡å‹ï¼Œé€šå¸¸æ˜¯æä¾›ä¸€äº›æŒ‡ä»¤æˆ–ä¾‹å­ã€‚\n\n### Tokens\n\næ¨¡å‹é€šè¿‡å°†æ–‡æœ¬åˆ†è§£ä¸º tokens æ¥ç†è§£å’Œå¤„ç†æ–‡æœ¬ã€‚Tokens å¯ä»¥æ˜¯å•è¯æˆ–åªæ˜¯å­—ç¬¦å—ã€‚ä¾‹å¦‚ï¼Œâ€œhamburgerâ€å¯ä»¥è¢«åˆ†è§£ä¸º â€œhamâ€ã€â€œburâ€ å’Œ â€œgerâ€ï¼Œè€Œåƒ\"pear\"è¿™æ ·ç®€çŸ­ã€å¸¸è§çš„è¯æ˜¯ä¸€ä¸ªå•ä¸€çš„ tokenã€‚\n\nåœ¨ç»™å®šçš„ API è¯·æ±‚ä¸­å¤„ç†çš„ token æ•°é‡å–å†³äºè¾“å…¥å’Œè¾“å‡ºçš„é•¿åº¦ã€‚ä½œä¸ºä¸€ä¸ªç²—ç•¥çš„ç»éªŒæ³•åˆ™ï¼Œä¸€ä¸ª token çº¦ç­‰äº 4 ä¸ªå­—ç¬¦æˆ– 0.75 ä¸ªè‹±æ–‡å•è¯ã€‚**è¦è®°ä½ä¸€ä¸ªé™åˆ¶æ˜¯ä½ çš„æ–‡å­— prompts å’Œç”Ÿæˆçš„ completion ç»„åˆä¸èƒ½è¶…è¿‡æ¨¡å‹çš„æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦ï¼ˆå¤§å¤šæ•°æ¨¡å‹æ˜¯ 2048 ä¸ª tokensï¼Œå¤§çº¦ 1500 ä¸ªå•è¯ï¼‰ã€‚**\n\nå¯ä»¥é€šè¿‡ [tokenizer tool](https://platform.openai.com/tokenizer) æ¥å­¦ä¹ å…³äºæ–‡æœ¬æ˜¯å¦‚ä½•è½¬æˆä¸º tokens ã€‚\n\n### Models\n\nAPI ç”±ä¸€ç»„å…·æœ‰ä¸åŒåŠŸèƒ½å’Œä»·æ ¼çš„æ¨¡å‹æä¾›æ”¯æŒã€‚\n\n## æ¨¡å‹\n\n- GPT-4ï¼ˆLimited betaï¼‰ï¼šä¸€ç»„åœ¨ GPT-3.5 ä¸Šæ”¹è¿›çš„æ¨¡å‹ï¼Œå¯ä»¥ç†è§£å¹¶ç”Ÿæˆè‡ªç„¶è¯­è¨€æˆ–ä»£ç \n- GPT-3.5ï¼šä¸€ç»„åœ¨ GPT-3 ä¸Šæ”¹è¿›çš„æ¨¡å‹ï¼Œå¯ä»¥ç†è§£å¹¶ç”Ÿæˆè‡ªç„¶è¯­è¨€æˆ–ä»£ç \n- DALL-Eï¼ˆBetaï¼‰ï¼šå¯ä»¥åœ¨ç»™å®šè‡ªç„¶è¯­è¨€æç¤ºçš„æƒ…å†µä¸‹ç”Ÿæˆå’Œç¼–è¾‘å›¾åƒçš„æ¨¡å‹\n- Whisperï¼ˆBetaï¼‰ï¼šä¸€ç§å¯ä»¥å°†éŸ³é¢‘è½¬æ¢ä¸ºæ–‡æœ¬çš„æ¨¡å‹\n- Embeddingsï¼šä¸€ç»„å¯ä»¥å°†æ–‡æœ¬è½¬æ¢ä¸ºæ•°å­—å½¢å¼çš„æ¨¡å‹\n- Moderationï¼šå¯ä»¥æ£€æµ‹æ–‡æœ¬æ˜¯å¦æ•æ„Ÿæˆ–ä¸å®‰å…¨çš„å¾®è°ƒæ¨¡å‹\n- GPT-3ï¼šä¸€ç»„å¯ä»¥ç†è§£å’Œç”Ÿæˆè‡ªç„¶è¯­è¨€çš„æ¨¡å‹\n\t- chat æ¨¡å‹\n\t- text æ¨¡å‹\n- Codexï¼ˆDeprecatedï¼‰ï¼šä¸€ç»„å¯ä»¥ç†è§£å’Œç”Ÿæˆä»£ç çš„æ¨¡å‹ï¼ŒåŒ…æ‹¬å°†è‡ªç„¶è¯­è¨€ç¿»è¯‘æˆä»£ç ã€‚\n\t- Github Copilot ä¹‹å‰å°±æ˜¯ä½¿ç”¨çš„è¿™ä¸ªæ¨¡å‹ã€‚\n\t- Codex å¯ä»¥æ€»ç»“å·²ç¼–å†™çš„å‡½æ•°ã€è§£é‡Š SQL æŸ¥è¯¢æˆ–è¡¨ï¼Œä»¥åŠå°†å‡½æ•°ä»ä¸€ç§ç¼–ç¨‹è¯­è¨€è½¬æ¢ä¸ºå¦ä¸€ç§ç¼–ç¨‹è¯­è¨€ã€‚\n\n[OpenAI API Model Document](https://platform.openai.com/docs/models)\n\n## å±€é™æ€§\n\n- æ•°æ®åº“æˆªæ­¢äº2021å¹´9æœˆï¼Œæ‰€ä»¥å…³äºé‚£ä¹‹åçš„ä¿¡æ¯å¯èƒ½æ— æ³•æä¾›å‡†ç¡®çš„ç­”æ¡ˆã€‚\n- ChatGPT æœ€å¤§å¯ä»¥å­˜å‚¨ 4096 ä¸ª tokenï¼ˆå¤§çº¦16384ä¸ªè‹±æ–‡å­—æ¯ï¼‰çš„ä¸Šä¸‹æ–‡ï¼Œå½“ä¸€ä¸ªä¼šè¯çš„å†…å®¹è¶…å‡ºè¿™ä¸ªæ•°é‡ï¼Œæœ€å‰é¢çš„ä¿¡æ¯å°±ä¼šè¢«é—å¿˜ã€‚\n- å­˜åœ¨å‡†ç¡®æ€§å’Œå¯è§£é‡Šæ€§çš„ç¼ºé™·\n- å­˜åœ¨ç§‘æŠ€ä¼¦ç†é£é™©\n\t- ç½‘ç»œå®‰å…¨\n\t- ä¼¦ç†é£é™©\n\t\t- æ­§è§†\n\n# åŸºç¡€åŠŸèƒ½\n\nGPT æ¨¡å‹éå¸¸æ“…é•¿å®Œæˆè‹¥å¹²è‡ªç„¶è¯­è¨€ä»»åŠ¡ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š\n\n- å†…å®¹/ä»£ç ç”Ÿæˆ\n- æ±‡æ€»æ–‡æœ¬\n- è§£é‡Š\n- é£æ ¼è½¬æ¢\n- å¯¹æ–‡æœ¬è¿›è¡Œåˆ†ç±»\n- ç¿»è¯‘\n- å›ç­”é—®é¢˜\n- å»ºè®®å†…å®¹\n- æ•°æ®æå–\n- ç­‰ç­‰\n\n[Examples - OpenAI API](https://platform.openai.com/examples)\n\n## Text Completion\n\nCompletion endpoint å¯ç”¨äºå„ç§å„æ ·çš„ä»»åŠ¡ã€‚å®ƒä¸ºä»»ä½• model æä¾›äº†ä¸€ä¸ªç®€å•ä½†åŠŸèƒ½å¼ºå¤§çš„æ¥å£ã€‚è¾“å…¥ä¸€äº›æ–‡æœ¬ä½œä¸º promptï¼Œmodel å°†ç”Ÿæˆä¸€ä¸ªæ–‡æœ¬è¡¥å…¨ï¼Œå°è¯•åŒ¹é…ä½ æä¾›çš„ä»»ä½•ä¸Šä¸‹æ–‡æˆ–æ¨¡å¼ã€‚\n\næ¯æ¬¡çœ‹åˆ°çš„å®é™…è¡¥å…¨æƒ…å†µå¯èƒ½æœ‰æ‰€ä¸åŒï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ API æ˜¯ä¸ç¡®å®šçš„ã€‚è¿™æ„å‘³ç€å³ä½¿ä½ çš„ prompt ä¿æŒä¸å˜ï¼Œæ¯æ¬¡è°ƒç”¨å®ƒæ—¶å¯èƒ½ä¼šå¾—åˆ°ç•¥å¾®ä¸åŒçš„è¡¥å…¨ã€‚å°† [temperature](https://platform.openai.com/docs/api-reference/completions/create#completions/create-temperature) è®¾ç½®ä¸º 0 å°†ä½¿è¾“å‡ºå¤§éƒ¨åˆ†å…·æœ‰ç¡®å®šæ€§ï¼Œä½†ä»ç„¶å¯èƒ½ä¼šä¿ç•™å°‘é‡å¯å˜æ€§ã€‚\n\n## Chat Completions\n\n### ä»‹ç»\n\nChat model å°†ä¸€ç³»åˆ— messages ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å› model ç”Ÿæˆçš„ messageä½œä¸ºè¾“å‡ºã€‚\n\nå°½ç®¡èŠå¤©æ ¼å¼æ—¨åœ¨ç®€åŒ–å¤šå›åˆå¯¹è¯ï¼Œä½†å®ƒå¯¹äºæ²¡æœ‰ä»»ä½•å¯¹è¯çš„å•å›åˆä»»åŠ¡åŒæ ·æœ‰ç”¨ï¼ˆä¾‹å¦‚ä¹‹å‰ç”±æŒ‡ä»¤éµå¾ªæ¨¡å‹ï¼ˆå¦‚ text-davinci-003ï¼‰æä¾›çš„ä»»åŠ¡ï¼‰ã€‚\n\nChat Completions API ç¤ºä¾‹ï¼š\n\n```python\n# Note: you need to be using OpenAI Python v0.27.0 for the code below to work\nimport openai\n\nopenai.ChatCompletion.create(\n  model=\"gpt-3.5-turbo\",\n  messages=[\n        {\"role\": \"system\", \"content\": \"You are a helpful assistant.\"},\n        {\"role\": \"user\", \"content\": \"Who won the world series in 2020?\"},\n        {\"role\": \"assistant\", \"content\": \"The Los Angeles Dodgers won the World Series in 2020.\"},\n        {\"role\": \"user\", \"content\": \"Where was it played?\"}\n    ]\n)\n```\n\nå…¶ä¸»è¦è¾“å…¥æ˜¯ messages å‚æ•°ï¼Œmessages å¿…é¡»æ˜¯ä¸€ä¸ª message å¯¹è±¡æ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªè§’è‰²ï¼ˆâ€œç³»ç»Ÿâ€ã€â€œç”¨æˆ·â€æˆ–â€œåŠ©æ‰‹â€ï¼‰å’Œå†…å®¹ï¼ˆæ¶ˆæ¯çš„å†…å®¹ï¼‰ã€‚\n\né€šå¸¸ï¼Œå¯¹è¯é¦–å…ˆä½¿ç”¨ system message è¿›è¡Œæ ¼å¼åŒ–ï¼Œç„¶åæ˜¯äº¤æ›¿çš„ user å’Œ assistant messagesã€‚\n\nsystem message æœ‰åŠ©äºè®¾ç½® assistant çš„è¡Œä¸ºã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œassistantè¢«æŒ‡ç¤ºâ€œYou are a helpful assistant.â€\n\nuser message æœ‰åŠ©äºæŒ‡å¯¼ assistantã€‚å®ƒä»¬å¯ä»¥ç”±åº”ç”¨ç¨‹åºçš„æœ€ç»ˆç”¨æˆ·ç”Ÿæˆï¼Œæˆ–ç”±å¼€å‘äººå‘˜è®¾ç½®ä¸ºæŒ‡ä»¤ã€‚\n\nassistant messageå¸®åŠ©å­˜å‚¨å…ˆå‰çš„å“åº”ã€‚å®ƒä»¬ä¹Ÿå¯ä»¥ç”±å¼€å‘äººå‘˜ç¼–å†™ï¼Œä»¥å¸®åŠ©æä¾›æ‰€éœ€è¡Œä¸ºçš„ç¤ºä¾‹ã€‚\n\nå½“ç”¨æˆ·æŒ‡ä»¤å¼•ç”¨å…ˆå‰çš„æ¶ˆæ¯æ—¶ï¼ŒåŒ…æ‹¬å¯¹è¯å†å²è®°å½•ä¼šæœ‰æ‰€å¸®åŠ©ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œuser çš„æœ€åä¸€ä¸ªé—®é¢˜æ˜¯â€œWhere was it played?ï¼Ÿâ€ä»…åœ¨æœ‰å…³ World Series of 2020çš„å…ˆå‰æ¶ˆæ¯çš„ä¸Šä¸‹æ–‡ä¸­æ‰æœ‰æ„ä¹‰ã€‚ç”±äºæ¨¡å‹å¯¹è¿‡å»çš„è¯·æ±‚æ²¡æœ‰è®°å¿†ï¼Œå› æ­¤å¿…é¡»é€šè¿‡å¯¹è¯æä¾›æ‰€æœ‰ç›¸å…³ä¿¡æ¯ã€‚å¦‚æœå¯¹è¯è¶…è¿‡æ¨¡å‹çš„tokené™åˆ¶ï¼Œåˆ™éœ€è¦ä»¥æŸç§æ–¹å¼ç¼©çŸ­å®ƒã€‚\n\n### Instructing Chat Models\n\næŒ‡å¯¼ model çš„æœ€ä½³å®è·µå¯èƒ½å›  model ç‰ˆæœ¬è€Œå¼‚ã€‚ä»¥ä¸‹å»ºè®®é€‚ç”¨äº gpt-3.5-turbo-0301ï¼Œå¯èƒ½ä¸é€‚ç”¨äºæœªæ¥çš„ modelã€‚\n\nè®¸å¤šå¯¹è¯ä»¥ system message å¼€å§‹ï¼Œä»¥æ¸©å’Œåœ°æŒ‡å¯¼ assistantã€‚ä¾‹å¦‚ï¼Œè¿™æ˜¯ç”¨äº ChatGPT çš„ system message ä¹‹ä¸€ï¼š\n\n```\nYou are ChatGPT, a large language model trained by OpenAI. Answer as concisely as possible. Knowledge cutoff: {knowledge_cutoff} Current date: {current_date}\n```\n\né€šå¸¸ï¼Œgpt-3.5-turbo-0301 å¯¹ system message çš„å…³æ³¨åº¦ä¸é«˜ï¼Œå› æ­¤é‡è¦çš„æŒ‡ä»¤å¾€å¾€æ”¾åœ¨ user messageä¸­æ¯”è¾ƒå¥½ã€‚\n\nå¦‚æœ model æ²¡æœ‰ç”Ÿæˆä½ æƒ³è¦çš„è¾“å‡ºï¼Œå¯ä»¥éšæ„è¿­ä»£å¹¶å°è¯•æ½œåœ¨çš„æ”¹è¿›ã€‚å¯ä»¥å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼š\n\n- è®©ä½ çš„æŒ‡ä»¤æ›´æ˜ç¡®\n- æŒ‡å®šä½ æƒ³è¦ç­”æ¡ˆçš„æ ¼å¼\n- **åœ¨ç¡®å®šç­”æ¡ˆä¹‹å‰è®© model é€æ­¥æ€è€ƒæˆ–è®¨è®ºåˆ©å¼Š**\n\nå¦‚éœ€ prompt çš„å¤æ‚çš„å·¥ç¨‹åˆ›æ„ï¼Œå¯ä»¥é˜…è¯»æœ‰å…³Â [techniques to improve reliability](https://github.com/openai/openai-cookbook/blob/main/techniques_to_improve_reliability.md) çš„ OpenAI Cookbook Guideã€‚\n\né™¤äº† system message ä¹‹å¤–ï¼Œtemperature å’Œ max tokens æ˜¯å¼€å‘äººå‘˜å¿…é¡»å½±å“ chat model è¾“å‡ºçš„ä¼—å¤šé€‰é¡¹ä¸­çš„ä¸¤ä¸ªã€‚å¯¹äº temperatureï¼Œè¾ƒé«˜çš„å€¼ï¼ˆå¦‚ 0.8ï¼‰å°†ä½¿è¾“å‡ºæ›´åŠ éšæœºï¼Œè€Œè¾ƒä½çš„å€¼ï¼ˆå¦‚ 0.2ï¼‰å°†ä½¿è¾“å‡ºæ›´åŠ é›†ä¸­å’Œç¡®å®šã€‚è€Œå…³äº max tokensï¼Œå¦‚æœè¦å°†å“åº”é™åˆ¶ä¸ºç‰¹å®šé•¿åº¦ï¼Œå¯ä»¥å°† max tokens è®¾ç½®ä¸ºä»»æ„æ•°å­—ã€‚ä½†è¿™ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ï¼Œä¾‹å¦‚ï¼Œå¦‚æœå°† max tokensè®¾ç½®ä¸º 5ï¼Œè¾“å‡ºå°†è¢«åˆ‡æ–­å¹¶ä¸”ç»“æœå¯¹ç”¨æˆ·æ²¡æœ‰æ„ä¹‰ã€‚\n\n### Chat VS Completions\n\nç”±äº gpt-3.5-turbo çš„æ€§èƒ½ä¸ text-davinci-003 ç›¸ä¼¼ï¼Œä½†æ¯ä¸ª tokençš„ä»·æ ¼ä½ 10%ï¼Œå› æ­¤å»ºè®®åœ¨å¤§å¤šæ•°ç”¨ä¾‹ä¸­ä½¿ç”¨ gpt-3.5-turboã€‚\n\n## Code Completion\n\nCodex å¯ç”¨äºå„ç§ä»»åŠ¡ï¼ŒåŒ…æ‹¬ï¼š\n\n- å°†æ³¨é‡Šå˜æˆä»£ç \n- åœ¨ä¸Šä¸‹æ–‡ä¸­å®Œæˆä½ çš„ä¸‹ä¸€è¡Œæˆ–å‡½æ•°\n- ä¸ºä½ å¸¦æ¥çŸ¥è¯†ï¼Œä¾‹å¦‚ä¸ºåº”ç”¨ç¨‹åºæŸ¥æ‰¾æœ‰ç”¨çš„åº“æˆ– API è°ƒç”¨\n- æ·»åŠ æ³¨é‡Š\n- é‡å†™ä»£ç ä»¥æé«˜æ•ˆç‡\n\n[OpenAI API Code completion](https://platform.openai.com/docs/guides/code)\n\n- è§£é‡Šä»£ç \n- Debug\n- ä»ä¸€ç§è¯­è¨€è½¬æ¢ä¸ºå¦ä¸€ç§è¯­è¨€\n- è·å–æœ‰å…³å¦‚ä½•åšæŸäº‹çš„è§£å†³æ–¹æ¡ˆæˆ–ä»£ç ç‰‡æ®µ\n- ç”Ÿæˆå•å…ƒæµ‹è¯•\n- ä¿®æ”¹ç°æœ‰ä»£ç \n- ç”Ÿæˆæ–‡æ¡£å’Œæ³¨é‡Š\n\n[Top 7 ChatGPT Developer Hacks - YouTube](https://www.youtube.com/watch?v=9W_U1y7RYuE)\n\n# ä½¿ç”¨æŠ€å·§\n\n## Prompt Design\n\nGPTæ¨¡å‹å¯ä»¥åšä»»ä½•äº‹æƒ…ï¼Œä»ç”ŸæˆåŸåˆ›æ•…äº‹åˆ°æ‰§è¡Œå¤æ‚çš„æ–‡æœ¬åˆ†æã€‚å› ä¸ºä»–ä»¬å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œæ‰€ä»¥ä½ å¿…é¡»æ˜ç¡®æè¿°ä½ æƒ³è¦ä»€ä¹ˆã€‚é€šå¸¸è‰¯å¥½æç¤ºçš„ç§˜è¯€æ˜¯å±•ç¤ºï¼Œè€Œä¸ä»…ä»…æ˜¯è®²è¿°ã€‚\n\nä»¥ä¸‹æ˜¯åˆ›å»ºpromptçš„ä¸‰ä¸ªåŸºæœ¬å‡†åˆ™ï¼š\n\n**å±•ç¤ºå’Œè®²è¿°ã€‚** é€šè¿‡æŒ‡ä»¤ã€ç¤ºä¾‹æˆ–ä¸¤è€…çš„ç»“åˆï¼Œæ¥æ˜ç¡®ä½ éœ€è¦ä»€ä¹ˆã€‚å¦‚æœä½ å¸Œæœ›æ¨¡å‹æŒ‰å­—æ¯é¡ºåºå¯¹é¡¹ç›®åˆ—è¡¨è¿›è¡Œæ’åæˆ–æŒ‰æ„Ÿæƒ…å¯¹æ®µè½è¿›è¡Œåˆ†ç±»ï¼Œè¯·å‘å®ƒå±•ç¤ºä½ æƒ³è¦çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æä¾›ä¸€ä¸ªä¾‹å­ã€‚\n\n**æä¾›é«˜è´¨é‡æ•°æ®ã€‚** å¦‚æœä½ æ­£åœ¨å°è¯•æ„å»ºä¸€ä¸ªåˆ†ç±»å™¨æˆ–è®©æ¨¡å‹éµå¾ªæŸç§æ¨¡å¼ï¼Œè¯·ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç¤ºä¾‹ã€‚å¹¶ä¸”ä¸€å®šè¦æ ¡å¯¹ä½ çš„ä¾‹å­â€”â€”æ¨¡å‹é€šå¸¸éå¸¸èªæ˜ï¼Œå¯ä»¥çœ‹ç©¿åŸºæœ¬çš„æ‹¼å†™é”™è¯¯å¹¶ç»™ä½ ä¸€ä¸ªå›å¤ï¼Œä½†å®ƒä¹Ÿå¯èƒ½è®¤ä¸ºè¿™æ˜¯æ•…æ„çš„ï¼Œè¿™ä¼šå½±å“å›å¤ã€‚\n\n**æ£€æŸ¥ä½ çš„è®¾ç½®ã€‚** temperature å’Œ top_p è®¾ç½®æ§åˆ¶æ¨¡å‹åœ¨ç”Ÿæˆå›å¤æ—¶çš„ç¡®å®šæ€§ã€‚å¦‚æœä½ è¦æ±‚å®ƒæä¾›åªæœ‰ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆçš„ç­”å¤ï¼Œåˆ™éœ€è¦å°†è¿™äº›è®¾ç½®å¾—è¾ƒä½ã€‚å¦‚æœä½ æ­£åœ¨å¯»æ‰¾æ›´å¤šæ ·åŒ–çš„å›å¤ï¼Œåˆ™å¯èƒ½å¸Œæœ›å°†å®ƒä»¬è®¾ç½®å¾—æ›´é«˜ã€‚åœ¨ä½¿ç”¨è¿™äº›è®¾ç½®æ—¶çŠ¯çš„ç¬¬ä¸€ä¸ªé”™è¯¯æ˜¯å‡è®¾å®ƒä»¬æ˜¯â€œèªæ˜â€æˆ–â€œåˆ›é€ åŠ›â€æ§åˆ¶ã€‚\n\n## é€šç”¨æŠ€å·§\n\n- å…ˆåœ¨æœ€å¼€å§‹è®¾å®šè§’è‰²\n- åŒæ—¶æä¾›æŒ‡ä»¤å’Œç¤ºä¾‹\n- æŒ‡å®šä½ æƒ³è¦ç­”æ¡ˆçš„æ ¼å¼\n- åœ¨ç¡®å®šç­”æ¡ˆä¹‹å‰è®© ChatGPT é€æ­¥æ€è€ƒæˆ–è®¨è®ºåˆ©å¼Š\n\n# æ‰©å±•åŠŸèƒ½\n\n## ChatGPT API ç›¸æ¯” ChatGPT çš„ä¸€äº›ä¼˜ç‚¹\n\n- æ˜¾å¼å®šä¹‰è§’è‰²ã€‚åœ¨æ–°çš„ ChatGPT API ä¸­ï¼Œæ¶ˆæ¯å¢åŠ äº† role çš„å±æ€§ï¼Œè¡¨ç¤ºå…¶æ‰€å±çš„è§’è‰²ï¼Œå…¶ä¸­ system ç”¨äºå®šä¹‰æ¥å£çš„è¡Œä¸ºï¼Œæ¯”å¦‚ã€Œä½ æ˜¯ä¸€ä¸ªå†™ä½œåŠ©æ‰‹ã€ï¼Œ user å’Œ assistant åˆ™ç”¨äºåŒºåˆ†ç”¨æˆ·è¾“å…¥å’Œæ¨¡å‹è¾“å‡ºã€‚è¿™ä½¿å¾—åˆ›é€ ç‰¹å®šéœ€æ±‚çš„åŠ©æ‰‹å˜å¾—æ›´åŠ æ¸…æ™°æ˜ç¡®\n![[Extras/Images/Pasted image 20230503163304.png]]\n- é€‰æ‹©æ€§åœ°å»æ‰ä¼šè¯ä¸­çš„ä¿¡æ¯ã€‚ChatGPT æœ€å¤§å¯ä»¥å­˜å‚¨ 4096 ä¸ª tokenï¼ˆå¤§çº¦16384ä¸ªè‹±æ–‡å­—æ¯ï¼‰çš„ä¸Šä¸‹æ–‡ï¼Œå½“ä¸€ä¸ªä¼šè¯çš„å†…å®¹è¶…å‡ºè¿™ä¸ªæ•°é‡ï¼Œæœ€å‰é¢çš„ä¿¡æ¯å°±ä¼šè¢«é—å¿˜ã€‚è€Œ ChatGPT API æ¯æ¬¡éƒ½è¦å°†å®Œæ•´çš„ä¸Šä¸‹æ–‡ä¼ é€’è¿‡å»ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¿ç•™é‡è¦çš„ä¿¡æ¯ï¼Œé€‰æ‹©æ€§åœ°å»æ‰ä¸€äº›æ— ç”¨çš„ä»¥é¿å…è¶…å‡ºé™åˆ¶ã€‚\n- è¿”å›å¤šä¸ªç»“æœä¾›é€‰æ‹©ã€‚é€šè¿‡ä¼ é€’ n å‚æ•°ï¼Œå¯ä»¥ä¸€æ¬¡æ€§è¿”å›å¤šä¸ªä¸åŒçš„ç»“æœï¼Œé€‚åˆæ–‡å­—æ¶¦è‰²ã€çŸ­å†…å®¹ç”Ÿæˆç­‰åœºæ™¯ï¼Œé¿å…å¤šæ¬¡é‡å¤é—®è¯¢ã€‚\n![[Extras/Images/Pasted image 20230503163354.png]]\n- ä½¿ç”¨ logit_bias å‚æ•°è°ƒæ•´ç‰¹å®šè¯æ±‡ï¼ˆtokenï¼‰åœ¨ç»“æœä¸­å‡ºç°çš„å¯èƒ½æ€§ï¼Œå®ç°å‡å°‘é‡å¤ç”šè‡³å±è”½ç‰¹å®šè¯æ±‡çš„åŠŸèƒ½ã€‚\n![[Extras/Images/Pasted image 20230503163502.png]]\n- ä½¿ç”¨ temperature/top_p å‚æ•°è°ƒæ•´ç»“æœçš„ç›¸å…³æ€§å’Œå‡†ç¡®æ€§ã€‚å½“æˆ‘ä»¬éœ€è¦å‘æ•£æ€ç»´ã€æ‹“å®½è„‘æ´æ—¶ï¼Œå¯é€‚å½“è°ƒä½ç»“æœçš„ç›¸å…³æ€§ï¼›è€Œå½“æä¾›çš„ä¸Šä¸‹æ–‡è¶³å¤Ÿå¤šï¼Œéœ€è¦åšç²¾ç¡®çš„åˆ†ææ—¶ï¼Œåˆ™å¯è°ƒé«˜ç›¸å…³æ€§ï¼Œå‡å°‘ ChatGPT ç¼–é€ å†…å®¹çš„å¯èƒ½ã€‚\n![[Extras/Images/Pasted image 20230503163545.png]]\n\n## Fine-tune\n\n### ä»‹ç»\n\nå¾®è°ƒå¯è®©ä½ ä» API æä¾›çš„ modelä¸­è·å¾—æ›´å¤šæ”¶ç›Šï¼š\n\n1. æ¯” prompt design æ›´é«˜è´¨é‡çš„ç»“æœ\n2. èƒ½å¤Ÿè®­ç»ƒæ¯” prompt å¯å®¹çº³çš„æ›´å¤šçš„ä¾‹å­\n3. ç”±äºæ›´çŸ­çš„ prompt è€ŒèŠ‚çœäº† tokens\n4. æ›´ä½çš„å»¶è¿Ÿè¯·æ±‚\n\nGPT-3 å·²ç»åœ¨äº’è”ç½‘çš„å¤§é‡æ–‡æœ¬ä¸Šè¿›è¡Œäº†é¢„è®­ç»ƒã€‚å½“ç»™å‡ºä»…åŒ…å«å‡ ä¸ªç¤ºä¾‹çš„ prompt æ—¶ï¼Œå®ƒé€šå¸¸å¯ä»¥å‡­ç›´è§‰åˆ¤æ–­å‡ºä½ è¦æ‰§è¡Œçš„ä»»åŠ¡å¹¶ç”Ÿæˆåˆç†çš„ completionã€‚è¿™é€šå¸¸ç§°ä¸ºâ€œå°æ ·æœ¬å­¦ä¹ â€ã€‚\n\nè€Œå¾®è°ƒå¯ä»¥é€šè¿‡è®­ç»ƒï¼Œæ¯”ä»…åœ¨ prompt ä¸­å¯å®¹çº³çš„æ›´å¤šä¾‹å­ï¼Œæ¥æ”¹è¿›å°æ ·æœ¬å­¦ä¹ ï¼Œè®©ä½ åœ¨å¤§é‡çš„ä»»åŠ¡ä¸­å–å¾—æ›´å¥½çš„ç»“æœã€‚**å¯¹æ¨¡å‹è¿›è¡Œäº†å¾®è°ƒåï¼Œä½ ä¸å†éœ€è¦åœ¨ prompt ä¸­æä¾›ç¤ºä¾‹ã€‚**\n\nåœ¨é«˜å±‚æ¬¡ä¸Šï¼Œå¾®è°ƒæ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š\n\n1. å‡†å¤‡å’Œä¸Šä¼ è®­ç»ƒæ•°æ®\n2. è®­ç»ƒæ–°çš„å¾®è°ƒæ¨¡å‹\n3. ä½¿ç”¨ä½ çš„å¾®è°ƒæ¨¡å‹\n\nå¾®è°ƒæ¨¡å‹è®­ç»ƒå’Œä½¿ç”¨çš„å®šä»·å¯å‚è€ƒ[ä»·æ ¼é¡µé¢](https://openai.com/api/pricing)ã€‚\n\n### å“ªäº›æ¨¡å‹å¯ä»¥å¾®è°ƒï¼Ÿ\n\nå¾®è°ƒç›®å‰ä»…é€‚ç”¨äºä»¥ä¸‹åŸºæœ¬æ¨¡å‹ï¼šdavinciã€curieã€babbage å’Œ adaã€‚è¿™äº›æ˜¯è®­ç»ƒåæ²¡æœ‰ä»»ä½•æŒ‡ä»¤çš„åŸå§‹æ¨¡å‹ï¼ˆä¾‹å¦‚ text-davinci-003 æœ‰ç»è¿‡æŒ‡ä»¤è®­ç»ƒï¼‰\n\n### å‡†å¤‡æ•°æ®\n\næ•°æ®å¿…é¡»æ˜¯ JSONL æ–‡æ¡£ï¼Œæ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªÂ prompt-completion å¯¹ï¼Œå¯¹åº”ä¸€ä¸ªè®­ç»ƒç¤ºä¾‹ã€‚\n\n```JSONL\n{\"prompt\": \"\u003cprompt text\u003e\", \"completion\": \"\u003cideal generated text\u003e\"}\n{\"prompt\": \"\u003cprompt text\u003e\", \"completion\": \"\u003cideal generated text\u003e\"}\n{\"prompt\": \"\u003cprompt text\u003e\", \"completion\": \"\u003cideal generated text\u003e\"}\n```\n\nè®¾è®¡å¾®è°ƒç”¨çš„ prompts å’Œ completions ä¸ä½¿ç”¨åŸºç¡€ model æ—¶çš„è®¾è®¡ prompts ä¸åŒã€‚ç‰¹åˆ«æ˜¯ï¼ŒåŸºç¡€ model çš„ promptsé€šå¸¸åŒ…å«å¤šä¸ªç¤ºä¾‹ï¼ˆâ€œå°æ ·æœ¬å­¦ä¹ â€ï¼‰ï¼Œå¯¹äºå¾®è°ƒï¼Œæ¯ä¸ªè®­ç»ƒç¤ºä¾‹é€šå¸¸ç”±ä¸€ä¸ªè¾“å…¥ç¤ºä¾‹ä»¥åŠç›¸å…³è¾“å‡ºç»„æˆï¼Œæ— éœ€æä¾›è¯¦ç»†æŒ‡ä»¤æˆ–åœ¨åŒä¸€ prompts ä¸­åŒ…å«å¤šä¸ªç¤ºä¾‹ã€‚\n\nè®­ç»ƒç¤ºä¾‹è¶Šå¤šè¶Šå¥½ã€‚æ¨èè‡³å°‘æœ‰å‡ ç™¾ä¸ªç¤ºä¾‹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå‘ç°æ•°æ®é›†å¤§å°æ¯å¢åŠ ä¸€å€éƒ½ä¼šå¯¼è‡´æ¨¡å‹è´¨é‡çº¿æ€§å¢åŠ ã€‚\n\n### ç¤ºä¾‹\n\n[Fine-tuning Example notebooks - OpenAI API](https://platform.openai.com/docs/guides/fine-tuning/example-notebooks)\n\n- Classification\n- Question answering\n\n## Embeddings\n\n### Embeddings æ˜¯ä»€ä¹ˆ\n\nTexting embeddings å¯è¡¡é‡æ–‡æœ¬å­—ç¬¦ä¸²çš„ç›¸å…³æ€§ã€‚Embeddings é€šå¸¸ç”¨äºï¼š\n\n- æœç´¢ï¼ˆç»“æœæŒ‰ä¸æŸ¥è¯¢å­—ç¬¦ä¸²çš„ç›¸å…³æ€§æ’åºï¼‰\n- èšç±»ï¼ˆå…¶ä¸­æ–‡æœ¬å­—ç¬¦ä¸²æŒ‰ç›¸ä¼¼æ€§åˆ†ç»„ï¼‰\n- æ¨èï¼ˆæ¨èå…·æœ‰ç›¸å…³æ–‡æœ¬å­—ç¬¦ä¸²çš„é¡¹ç›®ï¼‰\n- å¼‚å¸¸æ£€æµ‹ï¼ˆè¯†åˆ«å‡ºç›¸å…³æ€§å¾ˆå°çš„å¼‚å¸¸å€¼ï¼‰\n- å¤šæ ·æ€§æµ‹é‡ï¼ˆåˆ†æç›¸ä¼¼æ€§åˆ†å¸ƒï¼‰\n- åˆ†ç±»ï¼ˆå…¶ä¸­æ–‡æœ¬å­—ç¬¦ä¸²æŒ‰å…¶æœ€ç›¸ä¼¼çš„æ ‡ç­¾åˆ†ç±»ï¼‰\n\nEmbedding æ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°çš„ vectorï¼ˆlistï¼‰ã€‚ä¸¤ä¸ª vector ä¹‹é—´çš„è·ç¦»è¡¡é‡å®ƒä»¬çš„ç›¸å…³æ€§ã€‚å°è·ç¦»è¡¨ç¤ºé«˜ç›¸å…³æ€§ï¼Œå¤§è·ç¦»è¡¨ç¤ºä½ç›¸å…³æ€§ã€‚\n\n### å¦‚ä½•è·å– Embeddings\n\nå‘é€æ–‡æœ¬å­—ç¬¦ä¸²å’Œé€‰æ‹©çš„ embedding model ID åˆ° [embeddings API endpoint](https://platform.openai.com/docs/api-reference/embeddings)ï¼Œå›å¤å°†ä¼šåŒ…å«ä¸€ä¸ª embeddingï¼Œä½ å¯ä»¥æå–ã€ä¿å­˜å’Œä½¿ç”¨å®ƒã€‚\n\nExampleï¼š\n\n```\ncurl https://api.openai.com/v1/embeddings \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Authorization: Bearer $OPENAI_API_KEY\" \\\n  -d '{\n    \"input\": \"Your text string goes here\",\n    \"model\": \"text-embedding-ada-002\"\n  }'\n```\n\n```\n{\n  \"data\": [\n    {\n      \"embedding\": [\n        -0.006929283495992422,\n        -0.005336422007530928,\n        ...\n        -4.547132266452536e-05,\n        -0.024047505110502243\n      ],\n      \"index\": 0,\n      \"object\": \"embedding\"\n    }\n  ],\n  \"model\": \"text-embedding-ada-002\",\n  \"object\": \"list\",\n  \"usage\": {\n    \"prompt_tokens\": 5,\n    \"total_tokens\": 5\n  }\n}\n```\n\n### Use Cases\n\n- 2D æ•°æ®å¯è§†åŒ–\n- Embedding ä½œä¸º ML ç®—æ³•çš„æ–‡æœ¬ç‰¹å¾ç¼–ç å™¨\n- ä½¿ç”¨ embedding features è¿›è¡Œåˆ†ç±»\n- é›¶æ ·æœ¬åˆ†ç±»\n- è·å–ç”¨äºå†·å¯åŠ¨æ¨èçš„ç”¨æˆ·å’Œäº§å“ embeddings\n- èšç±»\n- ä½¿ç”¨ embedding çš„æ–‡æœ¬æœç´¢\n- ä½¿ç”¨ embedding çš„ä»£ç æœç´¢\n- ä½¿ç”¨ embedding çš„æ¨è\n\n### FAQ\n\n**å¦‚ä½•å¿«é€Ÿæ£€ç´¢ K ä¸ªæœ€è¿‘çš„ embedding vectorsï¼Ÿ**\n\nå¿«é€Ÿæœç´¢å¤šä¸ª vectorï¼Œå»ºè®®ä½¿ç”¨ vector databaseã€‚\n\nVector database é€‰é¡¹åŒ…æ‹¬ï¼š\n\n- Pineconeï¼Œä¸€ä¸ªå®Œå…¨æ‰˜ç®¡çš„ vector database\n- Weaviateï¼Œä¸€ä¸ªå¼€æº vector æœç´¢å¼•æ“\n- Redis ä½œä¸º vector æ•°æ®åº“\n- Qdrantï¼Œvector æœç´¢å¼•æ“\n- Milvusï¼Œä¸€ä¸ªä¸ºå¯æ‰©å±•ç›¸ä¼¼æ€§æœç´¢è€Œæ„å»ºçš„ vector database\n- Chromaï¼Œä¸€ä¸ªå¼€æºÂ embeddings store\n- Typesenseï¼Œå¿«é€Ÿå¼€æº vector æœç´¢\n- Zillizï¼Œæ•°æ®åŸºç¡€è®¾æ–½ï¼Œç”± Milvus æä¾›æ”¯æŒ\n\n### Example\n\n- [How to build an AI that can answer questions about your website](https://platform.openai.com/docs/tutorials/web-qa-embeddings)\n\t- çˆ¬å–ç½‘ç«™å†…å®¹\n\t- å°†å†…å®¹ç”Ÿæˆ embeddings å¹¶å­˜å‚¨åœ¨ vector database ä¸­\n\t- ä½¿ç”¨ vector database æ¥è¿”å› question å¯¹åº”çš„answer\n\n## Plugins \u003csup\u003eLimited Alpha\u003csup\u003e\u003c/sup\u003e\u003c/sup\u003e\n\n### ä»‹ç»\n\nOpenAI æ’ä»¶å°† ChatGPT è¿æ¥åˆ°ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºã€‚è¿™äº›æ’ä»¶ä½¿ ChatGPT èƒ½å¤Ÿä¸å¼€å‘äººå‘˜å®šä¹‰çš„ API è¿›è¡Œäº¤äº’ï¼Œä»è€Œå¢å¼º ChatGPT çš„åŠŸèƒ½å¹¶å…è®¸å…¶æ‰§è¡ŒèŒƒå›´å¹¿æ³›çš„æ“ä½œã€‚\n\n- æ’ä»¶å¯ä»¥å…è®¸ ChatGPT æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\n- æ£€ç´¢å®æ—¶ä¿¡æ¯ï¼›ä¾‹å¦‚ï¼Œä½“è‚²æ¯”åˆ†ã€è‚¡ç¥¨ä»·æ ¼ã€æœ€æ–°æ¶ˆæ¯ç­‰ã€‚\n- æ£€ç´¢çŸ¥è¯†åº“ä¿¡æ¯ï¼›ä¾‹å¦‚ï¼Œå…¬å¸æ–‡æ¡£ã€ä¸ªäººç¬”è®°ç­‰ã€‚\n- ä»£è¡¨ç”¨æˆ·æ‰§è¡Œæ“ä½œï¼›ä¾‹å¦‚ï¼Œè®¢æœºç¥¨ã€è®¢é¤ç­‰ã€‚\n\næ’ä»¶å¼€å‘è€…é€šè¿‡æ ‡å‡†åŒ–çš„ manifest æ–‡ä»¶å’Œ OpenAPI è§„èŒƒæš´éœ²ä¸€ä¸ªæˆ–å¤šä¸ª API endpointsã€‚è¿™äº›å®šä¹‰äº†æ’ä»¶çš„åŠŸèƒ½ï¼Œå…è®¸ ChatGPT æ¶ˆåŒ–æ–‡ä»¶å¹¶è°ƒç”¨å¼€å‘äººå‘˜å®šä¹‰çš„ APIã€‚\n\nAI model å……å½“æ™ºèƒ½ API è°ƒç”¨è€…ã€‚ç»™å®š API è§„èŒƒå’Œä½•æ—¶ä½¿ç”¨ API çš„è‡ªç„¶è¯­è¨€æè¿°ï¼Œmodel ä¼šä¸»åŠ¨è°ƒç”¨ API æ¥æ‰§è¡Œæ“ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·é—®â€œæˆ‘åº”è¯¥åœ¨å·´é»ä½å‡ æ™šï¼Ÿâ€ï¼Œmodel å¯èƒ½ä¼šé€‰æ‹©è°ƒç”¨é…’åº—é¢„è®¢æ’ä»¶ APIï¼Œæ¥æ”¶ API å“åº”ï¼Œå¹¶ç»“åˆ API æ•°æ®å’Œè‡ªç„¶è¯­è¨€èƒ½åŠ›ç”Ÿæˆé¢å‘ç”¨æˆ·çš„ç­”æ¡ˆã€‚\n\n### Example\n\n- [build a semantic search and retrieval plugin](https://github.com/openai/chatgpt-retrieval-plugin)\n\t- è¯¥æ’ä»¶å¯ä»¥å¯¹ä¸ªäººæˆ–ç»„ç»‡æ–‡æ¡£è¿›è¡Œè¯­ä¹‰æœç´¢å’Œæ£€ç´¢ã€‚å®ƒå…è®¸ç”¨æˆ·é€šè¿‡æé—®æˆ–ç”¨è‡ªç„¶è¯­è¨€è¡¨è¾¾éœ€æ±‚ï¼Œæ¥ä»ä»–ä»¬çš„æ•°æ®æºï¼ˆå¦‚æ–‡ä»¶ã€ç¬”è®°æˆ–ç”µå­é‚®ä»¶ï¼‰ä¸­è·å–æœ€ç›¸å…³çš„æ–‡æ¡£ç‰‡æ®µã€‚ä¼ä¸šå¯ä»¥ä½¿ç”¨æ­¤æ’ä»¶é€šè¿‡ ChatGPT å‘å‘˜å·¥æä¾›å†…éƒ¨æ–‡æ¡£ã€‚\n\t- è¯¥æ’ä»¶ä½¿ç”¨ OpenAI çš„ `text-embedding-ada-002` Â embeddings model æ¥ç”Ÿæˆæ–‡æ¡£å—çš„ embeddingsï¼Œå¹¶ä½¿ç”¨åç«¯çš„ vector database æ¥å­˜å‚¨å’ŒæŸ¥è¯¢å®ƒä»¬ã€‚ä½œä¸ºä¸€ä¸ªå¼€æºå’Œè‡ªæ‰˜ç®¡çš„è§£å†³æ–¹æ¡ˆï¼Œå¼€å‘äººå‘˜å¯ä»¥éƒ¨ç½²è‡ªå·±çš„æ£€ç´¢æ’ä»¶å¹¶å°†å…¶æ³¨å†Œåˆ° ChatGPTã€‚æ£€ç´¢æ’ä»¶æ”¯æŒå¤šä¸ª vector database providersï¼Œå…è®¸å¼€å‘äººå‘˜ä»åˆ—è¡¨ä¸­é€‰æ‹©ä»–ä»¬å–œæ¬¢çš„ä¸€ä¸ªã€‚\n\n# å¼€æºé¡¹ç›®\n\n- [GitHub - k8sgpt-ai/k8sgpt: Giving Kubernetes Superpowers to everyone](https://github.com/k8sgpt-ai/k8sgpt)\n\t- æ£€æŸ¥ k8s ä¸­å¼‚å¸¸çš„çŠ¶æ€ï¼Œå¹¶è®°å½•ä¸‹æ¥\n\t- å†ç”¨ ChatGPT å°†å¼‚å¸¸çŠ¶æ€ä¿¡æ¯è½¬æ¢ä¸ºè‡ªç„¶è¯­è¨€ï¼Œå¹¶è®© ChatGPT æä¾›è§£å†³æ–¹æ¡ˆ\n\n# å‚è€ƒèµ„æ–™\n\n- [Introduction - OpenAI API](https://platform.openai.com/docs/introduction/overview)\n- [openai-cookbook/examples at main Â· openai/openai-cookbook Â· GitHub](https://github.com/openai/openai-cookbook/tree/main/examples)\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":[]},"/Cards/LYT-%E7%AC%94%E8%AE%B0%E6%A1%86%E6%9E%B6":{"title":"LYT ç¬”è®°æ¡†æ¶","content":"\ndown:: [[Cards/ACCESS çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ]]\n\n[LYT Kit 6: Your starter kit to build your PKM system (+free download for your Obsidian app) - YouTube](https://www.youtube.com/watch?v=ftzQOkzGCLg)\n\n# æ¦‚æ‹¬ä¸€ä¸‹ LYT ç¬”è®°æ¡†æ¶çš„æ ¸å¿ƒå†…å®¹\n\nä¸ roamresearch å’Œ logseq è¿™ç§çº¯å¤§çº²ï¼Œå¹¶ä¸”æ‰€æœ‰ç¬”è®°æ–‡ä»¶åªæ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢ä¸åŒï¼Œobsidian æœ‰æ–‡ä»¶å¤¹ç³»ç»Ÿã€‚é‚£ä¹ˆ LYT ä¸»å¼ ï¼Œæ–‡ä»¶å¤¹åˆ†ç±»å’Œ MOC ç»“åˆä½¿ç”¨çš„æ–¹å¼æ¥ç»„ç»‡ç¬”è®°ï¼Œå¹¶ä¸”å€Ÿç”¨ dataview çš„å¼ºå¤§ query èƒ½åŠ›ï¼Œå°†æœç´¢ç»“æœä¿å­˜ä¸‹æ¥ã€‚è¿™å‡ ç§æ–¹æ³•ç›¸ç»“åˆä½¿ç”¨ï¼Œè®©åŸå­åŒ–ç¬”è®°å…¼å…·ç»“æ„æ€§å’ŒæµåŠ¨æ€§ï¼Œæ›´èƒ½å®ç°å¸¸é’ç¬”è®°å¼ºè°ƒçš„ï¼Œå¯è¢«æ£€ç´¢ï¼Œå¯ä¸ºæœªæ¥æœåŠ¡çš„ç›®çš„ã€‚ç»¼åˆæ¥è¯´å°±æ˜¯æ•™ä½ å¦‚ä½•é€šè¿‡ obsidian æ„å»ºè‡ªå·±çš„ PKM ç³»ç»Ÿã€‚\n\n[[obsidianã€notionå’Œlogseqçš„å¼‚åŒåˆ†æåŠè½¯ä»¶é€‰ç”¨]]ã€‚\n\n# LYT ç¬”è®°æ¡†æ¶æ˜¯ä»€ä¹ˆ\n\nlinking your thinking çš„ç¼©å†™ã€‚æ ¸å¿ƒå°±æ˜¯ linkã€‚è¿™ä¸ªæ¡†æ¶è™½ç„¶å¼ºè°ƒæ–‡ä»¶å¤¹ã€æ ‡ç­¾çš„ä½œç”¨ï¼Œä½†ç¬¬ä¸€å…¬æ°‘ä¾ç„¶æ˜¯ link é“¾æ¥ï¼Œä¸å…¶ä»–åŒé“¾ç¬”è®°æ–¹æ³•è®ºä¸€æ ·ï¼Œæ¯”å¦‚[[å¡ç‰‡ç›’ç¬”è®°æ³• - Zettelkasten]]ã€‚\n\nåŒ…å«è‹¥å¹²ä¸ªéƒ¨åˆ†ï¼š\n\n- [[HOMEPAGE]]ã€‚å³ä¸»é¡µ Home ç¬”è®°ã€‚å¯åŠ¨é¡µå±¡è§ä¸é²œï¼Œç”µè„‘æ‰‹æœºçš„å¼€æœºç•Œé¢ï¼Œæµè§ˆå™¨çš„å¯åŠ¨é¡µç­‰ç­‰ã€‚æ­¤å¤„ä½œä¸ºè‡ªå·±çš„ç¬”è®°åº“çš„ä¸€ä¸ªå¯åŠ¨å…¥å£ã€‚åŒæ—¶ä¹Ÿæ˜¯å°†æ•´ä¸ªç¬”è®°åº“è”ç»“æˆä¸€å¼ çŸ¥è¯†å·¨ç½‘çš„æŠ“æ‰‹ã€‚\n- å„ä¸ª [[MOC]] é¡µé¢ã€‚å…¶å®å°±æ˜¯ä¸€å †å›´ç»•æŸä¸ªç‰¹å®šä¸»é¢˜çš„ç¬”è®°çš„é“¾æ¥ï¼Œæ”¾åˆ°åŒä¸€åˆ™ç¬”è®°é‡Œï¼Œå¹¶é…ä¸Šé¢å¤–çš„æ–‡å­—è¯´æ˜æé†’è‡ªå·±æŠŠè¿™äº›ç¬”è®°çš„å†…åœ¨é€»è¾‘ä¸²èµ·æ¥ã€‚\n- å…¶ä»–çš„[[æµåŠ¨å¼æ¡†æ¶]]ã€‚ç»™ç¬”è®°åŠ é™å®šçš„ç»“æ„ï¼Œè¶Šå‘åœ°è¢«è¯æ˜æ˜¯ä¸€ä¸ªå¾ˆéš¾åšæŒä¸”æ— æ•ˆçš„æ–¹å¼ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬åˆ›é€ ä¸€ä¸ªæ¡†æ¶ï¼Œå¯ä»¥è®©è¿™äº›é™å®šçš„ç»“æ„äº§ç”ŸæµåŠ¨æ€§ï¼Œä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å…¼å¾— 2 ä¸ªä¼˜åŠ¿ï¼šç§©åºå’Œæ··æ²Œï¼›ç»“æ„åŒ–å’Œçµæ´»æ€§ï¼Œç­‰ç­‰ã€‚\n- é€šè¿‡åšç¬”è®° note-making è€Œä¸æ˜¯å†™ç¬”è®° note-takingï¼Œæ„å»ºæ´»ç¬”è®°ï¼Œ[[å¦‚ä½•åšç¬”è®° note-making]]ã€‚\n- ä½¿ç”¨ [[ACCESS ç¬”è®°ç»„ç»‡æ³•]]ã€‚\n- å¼ºè°ƒ[[ç”¨effortsè€Œéprojectsæ€ç»´ï¼Œå»å‘å±•è‡ªå·±çš„æƒ³æ³•]]ã€‚\n\n# å…¶ä»–\n\n- [[PKM çš„æŒ‡å¯¼æ€§åŸåˆ™ from lyt]]\n- [[å¸¸é’ç¬”è®°]]\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":[]},"/Cards/Yoga-Nidra":{"title":"Yoga Nidra","content":"\n# ä»€ä¹ˆæ˜¯Yoga Nidra?\n\n![image.png](Extras/Images/image_1665148601053_0.png)\n\n## 1ç§ç²¾ç¥çŠ¶æ€\n\nä»‹äºæ¸…é†’å’Œç¡çœ ä¹‹é—´çš„çŠ¶æ€\n\n## 1ç§å¼•å¯¼å¼å†¥æƒ³\n\næ¯”é™åå¼å†¥æƒ³æ›´æ˜“å…¥é—¨ï¼Œå‡å°‘å› å¤±è´¥å¸¦æ¥çš„æŒ«è´¥æ„Ÿã€‚\n\n## 1ç§é«˜æ•ˆçš„æ”¾æ¾æ–¹å¼\n\næ®è¯´45åˆ†é’Ÿçš„Yoga Nidraï¼Œçº¦ç­‰äº4ä¸ªå°æ—¶çš„æ·±åº¦ç¡çœ ã€‚\n\nç‘œä¼½å¼ç¡çœ ï¼Œæ¯90åˆ†é’Ÿï¼Œä¼‘æ¯20åˆ†é’Ÿ\n\n# Yoga Nidraæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ\n\n- ç¼“è§£ç„¦è™‘ã€æŠ‘éƒå’Œå„ç§å¿ƒç†éšœç¢\n- å‡å°‘å¤±çœ ã€æé«˜ç¡çœ è´¨é‡\n- æé«˜è®¤çŸ¥èƒ½åŠ›\n- å¢å¼ºå­¦ä¹ èƒ½åŠ›å’Œè®°å¿†åŠ›\n- å¢å¼ºå…ç–«ç³»ç»ŸåŠŸèƒ½\n\n# å¦‚ä½•è¿›è¡ŒYoga Nidraï¼Ÿ\n\nYoga Nidraçš„æ­¥éª¤å¯èƒ½å› å¼•å¯¼è€å¸ˆä¸åŒè€Œå„æœ‰æ‰€å¼‚ï¼Œä½†åŸºæœ¬éƒ½åŒ…å«ï¼š\n\nè·Ÿéšè€å¸ˆçš„å¼•å¯¼è¯­ï¼Œè¿›è¡Œä»¥ä¸‹åŠ¨ä½œã€‚\n\n1. åç€ï¼Œæˆ–è€…å¹³èººåœ¨å«å­ä¸Šï¼Œèº«ä½“å‘ˆâ€œå¤§â€å­—\n2. é—­ä¸ŠåŒçœ¼ï¼Œæ·±å‘¼å¸ï¼Œæ”¾æ¾èº«ä½“\n3. æ…¢æ…¢åœ°ç§»åŠ¨æ³¨æ„åŠ›ï¼Œæ‰«æèº«ä½“çš„æ¯ä¸€ä¸ªå°éƒ¨ä½ï¼ˆä»å¤´åˆ°è…¹è‡³æ¯ä¸€æ ¹è„šè¶¾å¤´ï½ï¼‰\n4. æ·±å‘¼å¸ï¼Œç¼“æ…¢åœ°çå¼€çœ¼ç›ï¼Œåç«‹èµ·æ¥\n\n![image.png](Extras/Images/image_1665148637099_0.png)\n\n# æ­ç§˜Yoga Nidraçš„ç§‘å­¦åŸç†\n\n## æ¿€æ´»å‰¯äº¤æ„Ÿç¥ç»ç³»ç»Ÿ\n\n![image.png](Extras/Images/image_1665148677225_0.png)\n\næ¿€æ´»å‰¯äº¤æ„Ÿç¥ç»ç³»ç»Ÿï¼Œä¼šæŠ‘åˆ¶ã€Œçš®è´¨é†‡ã€çš„äº§ç”Ÿï¼Œä¿ƒè¿›ã€Œè¡€æ¸…ç´ ã€ã€ã€ŒGABAã€å’Œã€Œå‚¬äº§ç´ ã€çš„åˆæˆã€‚\n\nå‹åŠ›è·å°”è’™ã€Œçš®è´¨é†‡ã€å’Œå¿«ä¹é€’è´¨ã€Œè¡€æ¸…ç´ ã€ï¼Œå·²ç»ä»‹ç»è¿‡å¾ˆå¤šæ¬¡ã€‚\n\nã€ŒGABAã€æ˜¯å¤§è„‘å†…çš„æŠ‘åˆ¶æ€§ç¥ç»é€’è´¨ï¼Œå¯ä»¥å‡ç¼“ç¥ç»å…ƒçš„ä¿¡å·ä¼ é€’ã€‚åœ¨å‹åŠ›äº‹ä»¶ä¸­ï¼Œå¯ä»¥ç¼“è§£ç„¦è™‘æƒ…ç»ªã€è‚Œè‚‰ç´§å¼ å’Œæƒ…ç»ªèµ·ä¼ã€‚\n\nã€Œå‚¬äº§ç´ ã€åˆ™åœ¨æ¯å©´è”ç»“ã€æµªæ¼«æ„Ÿæƒ…ç»´ç³»ã€æ€§å…³ç³»ä¸­å‘æŒ¥ä½œç”¨ã€‚å½“ä½œç”¨äºå¤§è„‘æ—¶ï¼Œå¯ä»¥å¸®åŠ©è°ƒèŠ‚è¡€å‹ã€ç¼“è§£å‹åŠ›ã€å¸®åŠ©ä¼¤å£æ„ˆåˆï¼Œå¹¶äº§ç”Ÿå®‰å…¨ã€èˆ’é€‚ã€å†·é™çš„æ„Ÿè§‰ã€‚\n\n## æ”¹å˜è„‘ç”µæ³¢\n\nå½“è·Ÿéšç€è€å¸ˆçš„å¼•å¯¼è¯­ï¼Œé€ä¸ªæ„Ÿå—èº«ä½“çš„å„ä¸ªéƒ¨ä½æ—¶ï¼Œä½ çš„å¤§è„‘å°†ä»**Î²è„‘æ³¢çŠ¶æ€**ï¼ˆå¤§è„‘æ´»åŠ¨é¢‘ç¹çš„è§‰é†’çŠ¶æ€ï¼‰è½¬å˜ä¸º**Î±è„‘æ³¢çŠ¶æ€**ï¼ˆå¤§è„‘æ´»åŠ¨é€Ÿåº¦æ”¾ç¼“ï¼‰ï¼Œéšç€å®è·µçš„æ·±å…¥ï¼Œè„‘ç”µæ³¢è¿˜å¯èƒ½è¿›å…¥**Î¸è„‘æ³¢çŠ¶æ€**ï¼ˆå™¨å®˜è¿›è¡Œè‡ªæˆ‘ä¿®å¤ï¼‰ï¼Œå³å¯å¾—åˆ°éå¸¸æ·±åº¦çš„æ”¾æ¾ï¼Œä»¥åŠè¿›å…¥åˆ›é€ åŠ›è¿¸å‘ã€è®°å¿†å·©å›ºçš„é˜¶æ®µã€‚\n\n# èµ„æº\n\n1. [20åˆ†é’Ÿå†¥æƒ³=1å°æ—¶ç¡çœ  YogaNidraå¤è€çš„å§å§¿å†¥æƒ³ï¼Œå³ä½¿ç¡ä¸ç€ï¼Œä¾ç„¶èƒ½æ¢å¤ç²¾åŠ›ã€‚æ¨èçš„ç»ƒä¹ æ—¶é—´ï¼šåˆä¼‘æ—¶ï¼Œæ™šä¸Šç¡å‰ï¼ŒåŠå¤œé†’æ¥ç¡ä¸ç€ï¼Œæ—©ä¸Šé†’å¤ªæ—©åˆå¾ˆå›°ã€‚](https://www.bilibili.com/video/BV1Br4y1D7P4?vd_source=95893bf3c956973d41f5d92572ef8a93)\n2. [20åˆ†é’Ÿå†¥æƒ³=2å°æ—¶æ·±åº¦ç¡çœ ï¼ŒYogaNidraèººå¹³ç–—æ„ˆå†¥æƒ³å¼•å¯¼åŠ é•¿ç‰ˆï¼Œè„‘ç§‘å­¦ç ”ç©¶æœ€æœ‰æ•ˆçš„æ·±åº¦æ”¾æ¾](https://www.bilibili.com/video/BV1i44y1j7WL?vd_source=95893bf3c956973d41f5d92572ef8a93)\n3. [èººå¹³å§ï¼ 10åˆ†é’Ÿå†¥æƒ³=1å°æ—¶ç¡çœ ï¼Œåˆç¡ç¥å™¨ç‘œä¼½å¤§ä¼‘æ¯æœ¯ï¼Œè„‘ç§‘å­¦ç ”ç©¶æœ€æœ‰æ•ˆçš„æ·±åº¦æ”¾æ¾ï¼ŒYoga Nidra](https://www.bilibili.com/video/BV1tL411775C?vd_source=95893bf3c956973d41f5d92572ef8a93)\n4. [Yoga Nidra 20 Minute Guided Meditation](https://www.youtube.com/watch?v=7H0FKzeuVVs)\n","lastmodified":"2023-05-18T16:10:29.936349527Z","tags":[]},"/Extras/+-About-Extras":{"title":"About Extras","content":"\nup:: [[Meta PKM]]\n\n# Extras\n\nThink of the Extras folder as the toolbox for your notes.\n\nThese notes _support_ your other notes.\n\n- Images automatically get added to \"Images\" folder (and any other attachments you bring into your vault).\n- Templates will be stored in a \"Templates\" folder as well.\n\n---\n\n# EXTRAS\n\n## Lt Helps You ..\n\nKeep your support material handy\n\n## What Goes In?\n\nSupport material\n\n## What Are Some Examples?\n\n- Attachments\n- Graphics\n- Images\n- Manuals\n- Templates\n\n---\n\n# knowledge-garden\n\n[[å›¾ç‰‡ä¿å­˜ï¼šå›¾åºŠoræœ¬åœ°]]","lastmodified":"2023-05-18T16:10:29.940349526Z","tags":["on/readme"]},"/HOMEPAGE":{"title":"HOMEPAGE","content":"# æœ€è¿‘ç¼–è¾‘çš„ç¬”è®°\n\n```dataview\ntable WITHOUT ID file.link AS \"æ ‡é¢˜\",file.mtime as \"æ—¶é—´\"\nfrom \"\"\nsort file.mtime desc\nlimit 10\n```\n\n# ä¸ƒå¤©å†…åˆ›å»ºçš„ç¬”è®°\n\n```dataview\ntable file.ctime as åˆ›å»ºæ—¶é—´\nfrom \"\"\nwhere date(today) - file.ctime \u003c=dur(7 days)\nsort file.ctime desc\nlimit 10\n```\n\n# Task\n\n## Overdue\n\n```tasks\nnot done\ndue before today\ngroup by filename\nsort by due reverse\nsort by description\n````\n\n## Today\n\n```tasks\nnot done\ndue on today\ngroup by filename\nsort by due reverse\nsort by description\n```\n\n## This Week\n\n```tasks\ndue on this week\nnot done\ngroup by filename\nsort by due reverse\nsort by description\n```\n\n## All Not Done Tasks\n\n```tasks\nnot done\ngroup by filename\nsort by due reverse\nsort by description\n```\n","lastmodified":"2023-05-18T16:10:30.616349313Z","tags":[]},"/Sources/+-About-Sources":{"title":"About Sources","content":"\nup:: [[Meta PKM]]\n\nThe beast-like Evernote Web Clipper approaches Gandalf trying to infect and corrupt your PKM sanctuary with hordes of low-value articles you'll never read and that will drown your own thinking a pit of orc-like chaos.\n\n# Choose\n\n- [[Be tempted by power and clip countless articles into your PKM note library.]]\n- [[Ask Gandalf for assistance.]]\n\n---\n\n# SOURCES\n\n## Lt Helps You .\n\nBuild your external library of ideas\n\n## What Goes In?\n\nThings you encounter\n\n## What Are Some Examples?\n\n- Articles\n- Books\n- Podcasts\n- Research Papers\n- Courses\n- Talks\n- Movies + TV\n- Videos\n\n---\n\n# Knowledge-garden\n\nSpacesä¸­çš„Resourceåå‘actionè¡ŒåŠ¨ï¼Œä»¥åŠä½œä¸ºprojectå’Œareaçš„å¼ºç›¸å…³çš„æ”¯æ’‘ææ–™ï¼Œä»¥å†…å®¹ä¸ºåˆ†ç±»ä¾æ®ã€‚\n\nè€Œè¿™é‡Œçš„Sourcesï¼Œåå‘äºå‰ªè—ã€æœé›†ï¼Œä»¥èµ„æºæ–‡ä»¶ç±»å‹ä¸ºåˆ†ç±»ä¾æ®ã€‚\n\nå¦å¤–å°±æ˜¯æœ‰æ˜æ˜¾ç³»åˆ—åŒ–ã€æ‰¹é‡èµ„æºçš„ï¼Œæ¯”å¦‚ä¸€é—¨è¯¾ç¨‹ï¼Œä¸€ä¸ªrssè®¢é˜…ï¼Œä¸€éƒ¨ç”µè§†å‰§ç­‰ï¼Œéƒ½æ”¾è¿™é‡Œï¼Œå¯ä»¥åšä¸ºå°†æ¥çš„æ£€ç´¢æ¡ä»¶ã€‚\n","lastmodified":"2023-05-18T16:10:30.616349313Z","tags":["on/readme"]},"/Spaces/+-About-Spaces":{"title":"About Spaces","content":"\nup:: [[Meta PKM]]\n\n# About Spaces\n\nSpaces are one of the most important parts of ACCESS: Whenever you have something big in your life, create a new space.\n\nI use spaces for holding:\n\n- My efforts for LYT.\n- My non-idea, work notes for LYT.\n- My non-idea, work notes for my TV Editing career.\n- My personal plans and reviews.\n- My personal notes on finances.\n- Bigger [[Efforts]], like [[My Newsletter MOC]].\n- New areas I'm learning, like the literary industry.\n- Fun micro-efforts, like mapping issues of The Cultural Tutor's newsletter.\n- Special new efforts, where I want to mindfully incubate related notes, to allow them to slowly develop.\n- Folder packs I share, like the LYT Kit and Obsidian Flight School.\n- Other big, hard-to-define things\n- And whatever else demands its own space!\n\nCan you see how terms like \"projects\" and \"areas\" just don't cut it? When you work with ideas, you need looser terms.\n\n\"Spaces\" are more flexible than \"projects\" and more versatile than \"areas\". Spaces contain bothâ€”and moreâ€”because they contain _efforts_.\n\n\u003e Between \"spaces\" and \"efforts\" and \"Maps of Content\", you have the terms that will allow your ideas the room to breath and the flexibility to grow.\n\n---\n\n[[+ Encounters/LYT Space (kit)]]\n\nMAPSï¼š\n\n- **M**OCs\n- **A**reas\n- **P**rojects\n- **S**upport notes\n\n---\n\n# Knowledge-garden\n\nå…¶å®å°±æ˜¯ [[PARA]]ï¼ŒSPACES ä»¥é¡¹ç›® action è¡ŒåŠ¨ä¸ºç›®æ ‡ï¼Œè¿›è¡Œä¿¡æ¯ç®¡ç†ã€‚ä½†å¤šäº†ä¸€ä¸ª [[MOC]]ï¼ŒæŠŠä¿¡æ¯ä¸²èµ·æ¥ã€‚æˆ‘ç›´æ¥å°†å…¶æ”¹æˆ PARAã€‚moc å…ˆç›´æ¥æ”¾åˆ°å¯¹åº”æ–‡ä»¶å¤¹é‡Œé¢ã€‚\n\nä¸ Source ç›¸æ¯”ï¼ŒSpaces å°±åƒç¤¾ä¼šäººï¼Œé«˜ç›®çš„æ€§ï¼Œä¸€åˆ‡ä»¥é¡¹ç›®ã€é—­ç¯ã€å®Œæˆä¸ºç›®æ ‡ï¼Œ[[è‡ªä¸‹è€Œä¸Š]]ã€‚è€Œ Source å°±åƒå­¦ç”Ÿï¼Œä½ç›®çš„æ€§ï¼Œé‡åœ¨æŒç»­ç§¯ç´¯ï¼Œåˆ†ç±»ï¼ŒæŒç»­ç²¾è¿›ï¼Œ[[è‡ªä¸Šè€Œä¸‹]]ã€‚\n","lastmodified":"2023-05-18T16:10:30.616349313Z","tags":["on/readme"]},"/Spaces/Zadig/%E4%BA%91%E5%99%A8":{"title":"äº‘å™¨","content":"äº‘å™¨å¯¼å‡ºæ•°æ®åº“ï¼Œè½¯ä»¶Studio 3T\n\n1.  åœ¨productè¡¨é‡ŒæŸ¥æ‰¾åˆ°ï¼Œ`{ \"product_name\" : â€œ${projectName}, \"env_name\" : â€œ${envName}â€œ }`ï¼Œå¯¼å‡º\n2.  åœ¨ä¸Šé¢æŸ¥åˆ°æ•°æ®ä¸­ï¼Œæ‰¾å‡ºrender.revisionå’Œservices[0].service_nameå’Œrevision\n3.  åœ¨render_setè¡¨é‡ŒæŸ¥æ‰¾ï¼Œ`{ \"product_tmpl\" : \"${projectName}\", \"revision\" : NumberLong(2) }`ï¼Œå¯¼å‡º\n4.  åœ¨product_template_service/template_serviceè¡¨ä¸­æŸ¥æ‰¾ï¼Œ`{ \"service_name\" : \"${serviceName}â€, \"product_name\" : \"${projectName}, \"revision\" : NumberLong(1) }`ï¼Œå¯¼å‡º\n  \næŸ¥è¯¢æ“ä½œæ—¥å¿—ï¼š\n\né¦–é¡µ-\u003eç³»ç»Ÿè®¾ç½®-\u003eæ“ä½œæ—¥å¿—-\u003eæŸ¥è¯¢é¡¹ç›®-\u003eæŸ¥è¯¢æœåŠ¡-\u003eæŸ¥åˆ°æœ€æ—©çš„éƒ¨ç½²æ—¥å¿—\n\n---\n\næ¸…é™¤è„æ•°æ® ï¼š\n1. product è¡¨ï¼ŒæŸ¥æ‰¾ç”Ÿäº§ç¯å¢ƒï¼Œ{ \"product_name\" : ${projectName}, \"env_name\" : ${envName}}\n2. åˆ é™¤ä¸Šé¢æŸ¥åˆ°çš„ services é‡Œçš„å¯¹åº”æœåŠ¡\n3. ä½¿ç”¨ 1 ä¸­æŸ¥æ‰¾åˆ°çš„ render. name å’Œ render. revisionï¼Œåœ¨ render_set è¡¨ï¼ŒæŸ¥æ‰¾{ \"name\" : ${render. name}, \"revision\" : ${render. revision} }\n4. åˆ é™¤ä¸Šé¢æŸ¥æ‰¾åˆ°çš„ service_variables é‡Œçš„å¯¹åº”æœåŠ¡","lastmodified":"2023-05-18T16:10:30.616349313Z","tags":[]},"/Spaces/Zadig/%E4%BA%A7%E5%93%81%E5%B7%A5%E4%BD%9C%E6%B5%81":{"title":"äº§å“å·¥ä½œæµ","content":"","lastmodified":"2023-05-18T16:10:30.616349313Z","tags":[]},"/Spaces/Zadig/%E5%AE%89%E8%A3%85":{"title":"å®‰è£…","content":"# Helm\n- æ–‡æ¡£ï¼š[https://docs.koderover.com/zadig/Zadig%20v1.17.0/install/helm-deploy/](https://docs.koderover.com/zadig/Zadig%20v1.17.0/install/helm-deploy/)\n- `helm upgrade --install ${releaseName} koderover-chart/zadigx --namespace ${namespace} --version=${version} -f ${valuesFile}`\n- å‚è€ƒvaluesï¼ˆä»ee-dev1å¤åˆ¶ï¼‰ï¼š\n```yaml\nconnections:\n  mongodb:\n    connectionString: mongodb://172.16.0.23:27017\n    db: zadig_ee_dev1\n  mysql:\n    auth:\n      password: zadig\n      user: root\n    host: kr-mysql:3306\ndex:\n  config:\n    issuer: http://zadig-ee-dev1-dex:5556/dex\n    staticClients:\n    - id: zadig\n      name: zadig\n      redirectURIs:\n      - http://zadig-ee-dev1.8slan.com/api/v1/callback\n      secret: ZXhhbXBsZS1hcHAtc2VjcmV0\n  fullnameOverride: zadig-ee-dev1-dex\nendpoint:\n  FQDN: zadig-ee-dev1.8slan.com\n  IP: null\n  type: FQDN\nglobal:\n  extensions:\n    extAuth:\n      extauthzServerRef:\n        namespace: zadig-ee-env-dev1\n  image:\n    registry: koderover.tencentcloudcr.com/koderover-public\ngloo:\n  gatewayProxies:\n    gatewayProxy:\n      service:\n        type: NodePort\n      gatewaySettings:\n        customHttpGateway:\n          options:\n            httpConnectionManagerSettings:\n              streamIdleTimeout: 60m\n        customHttpsGateway:\n          options:\n            httpConnectionManagerSettings:\n              streamIdleTimeout: 60m\n  settings:\n    singleNamespace: true\ninit:\n  adminEmail: admin@koderover.com\n  adminPassword: zadig\nee:\n  autoSyncClient: false\n  mongodb:\n    db: \"plutus_zadig_ee_dev1\"\nprotocol: http\ntags:\n  enterprise: true\n  minio: true\n  mongodb: false\n  mysql: true\n\n```\n\n# Plutus Customer\n- æ–‡æ¡£ï¼š[https://koderover.feishu.cn/docx/doxcnqacwHoNSSol7lvUg32BZah](https://koderover.feishu.cn/docx/doxcnqacwHoNSSol7lvUg32BZah)\n- éœ€è¦å®‰è£…md5sum\n\t- `./install_plutus_customer.sh: line 166: md5sum: command not found`\n - macçš„sedå’Œlinux sedä¸å…¼å®¹\n\t - `sed: 1: \"customer-server.yaml\": command c expects \\ followed by text`\n  - éƒ¨ç½²å¤±è´¥\n\t  - `1 error occurred: * failed to install service: zadig-ee, err: unable to build kubernetes objects from release manifest: error validating \"\": error validating data: unknown object type \"nil\" in ConfigMap.data.CLIENT_SECRET`\n\t\t  - `dex.config.staticClients[0].secret`\n\t   - `1 error occurred: * failed to install service: zadig-ee, err: rendered manifests contain a resource that already exists. Unable to continue with install: ClusterRole \"zadig-dex\" in namespace \"\" exists and cannot be imported into the current release: invalid ownership metadata; annotation validation error: key \"meta.helm.sh/release-name\" must equal \"patrick-install-test-zadig-ee-01\": current value is \"zadigx-fansi\"; annotation validation error: key \"meta.helm.sh/release-namespace\" must equal \"patrick-install-test-zadig-01\": current value is \"zadigx-fansi\"`","lastmodified":"2023-05-18T16:10:30.616349313Z","tags":[]},"/Spaces/Zadig/%E5%B7%A5%E4%BD%9C%E6%B5%81%E5%8F%98%E9%87%8F":{"title":"å·¥ä½œæµå˜é‡","content":"å­—æ®µä½ç½®ï¼š\n- å…¨å±€å˜é‡ï¼šWorkflowV4.Params\n- Jobå˜é‡ï¼šFreestyleJobSpec.Properties.Envs\n\næ¸²æŸ“å˜é‡ï¼š\n- å…¨å±€å˜é‡ï¼šjobctl.RenderGlobalVariables\n- Jobå˜é‡ï¼šBuildJobExcutorContext","lastmodified":"2023-05-18T16:10:30.616349313Z","tags":[]},"/Spaces/Zadig/%E5%BE%85%E5%8A%9E%E4%BA%8B%E9%A1%B9":{"title":"å¾…åŠäº‹é¡¹","content":"- [x] æ·»åŠ  swagger çš„å¯èƒ½æ€§ ğŸ“… 2023-04-26 âœ… 2023-04-28\n- [x] ç¡®è®¤åœ¨ä¿å­˜å˜é‡çš„æ—¶å€™éœ€è¦ clip å“ªäº›å€¼ âœ… 2023-04-28 ^bscuh3\n- [x] æ¢³ç†é•œåƒé€‰æ‹©ã€é•œåƒç”Ÿæˆè§„åˆ™ âœ… 2023-04-29\n- [ ] å·¥å…·åˆ†äº«\n- [x] ChatGPT åˆ†äº« âœ… 2023-05-13","lastmodified":"2023-05-18T16:10:30.616349313Z","tags":[]},"/Spaces/Zadig/%E6%9C%8D%E5%8A%A1%E5%8F%98%E9%87%8F":{"title":"æœåŠ¡å˜é‡","content":"\n1. åˆæ¬¡éƒ¨ç½²ï¼Œç¯å¢ƒé‡Œæ²¡æœ‰ï¼ŒæœåŠ¡æ¨¡æ¿é‡Œæœ‰\n2. ç¯å¢ƒé‡Œæœ‰ï¼ŒæœåŠ¡æ¨¡æ¿é‡Œä¹Ÿæœ‰\n3. ç¯å¢ƒé‡Œæ²¡æœ‰ï¼ŒæœåŠ¡æ¨¡æ¿é‡Œæœ‰\n4. ç¯å¢ƒé‡Œæœ‰ï¼ŒæœåŠ¡æ¨¡æ¿é‡Œæ²¡æœ‰\n\n# æ—§ç‰ˆ\n\n## æ•´ä½“æµç¨‹\n\n1. ä»æœåŠ¡æ¨¡ç‰ˆï¼ˆk8sï¼‰æˆ– valuesï¼ˆhelmï¼‰è¯»å–å¯é…ç½®å˜é‡ tmplVarsï¼Œå¹¶é…ç½®å˜é‡å¯è§æ€§\n2. å·¥ä½œæµé…ç½®å˜é‡å¯é€‰èŒƒå›´ï¼ŒrenderVars + tmplVars åˆå¹¶å†æ ¹æ®å¯è§æ€§è¿‡æ»¤å’Œé…ç½®å¾—åˆ° workflowVarsã€‚tmplVars è¦†ç›– renderVarsã€‚\n\t1. è·å–keyå’Œè·å–valueçš„è¦†ç›–æ–¹å¼ä¸åŒã€‚\n\t2. tmplVarsä»¥å¯è§æ€§çš„ç¬¬ä¸€å±‚keyä¸ºä¸»è¿‡æ»¤ï¼Œå¾—åˆ°æœ€ç»ˆç»“æœçš„æ‰€æœ‰key\n\t3. å†æ ¹æ®keyå»æŸ¥æ‰¾renderä¸­æœ‰æ²¡æœ‰ç›¸åŒçš„keyï¼Œå¦‚æœæœ‰ï¼Œåˆ™ä½¿ç”¨å®ƒçš„å€¼\n3. æ‰§è¡Œå·¥ä½œæµæ—¶è·å–workflowVarsçš„keyå’Œé»˜è®¤valueï¼Œå†ä¿®æ”¹é»˜è®¤å€¼ï¼Œæœ€ç»ˆå¾—åˆ°å®é™…å˜é‡ taskVars\n4. taskVarsï¼ˆè®¾ç½®å€¼ï¼‰ + renderVarsï¼ˆç¯å¢ƒå€¼ï¼‰ + tmplVarsï¼ˆé»˜è®¤å€¼ï¼‰åˆå¹¶å¾—åˆ°execVarsã€‚taskVarsè¦†ç›–renderVarsï¼Œå†è¦†ç›–tmplVarsã€‚\n\n## å¯è§æ€§\n\n1. å¯è§æ€§å…³é—­ï¼Œç”¨æˆ·ä¸å¯é…ç½®ï¼Œä½¿ç”¨æ—¶ä»renderçš„å…¨å±€å˜é‡å’ŒæœåŠ¡çš„é»˜è®¤å˜é‡è·å–å€¼ï¼Œrenderçš„å…¨å±€å˜é‡ä¼˜å…ˆï¼Œfallbackåˆ°æœåŠ¡çš„é»˜è®¤å˜é‡\n2. å¯è§æ€§æ‰“å¼€ï¼Œç”¨æˆ·å¯è§ï¼Œå¯ä»¥é…ç½®\n3. ä¸ç®¡å¯ä¸å¯è§ï¼Œè¯¥å˜é‡æœ€ç»ˆä¸€å®šä¼šç”¨åˆ°\n\n## é—®é¢˜\n\n- renderå’ŒtmplSvcåˆå¹¶å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œrenderé»˜è®¤å€¼çš„é—®é¢˜ã€‚renderå’ŒtmplSvcä¹‹é—´keyå¯èƒ½ä¼šå‡ºç°ç»“æ„æ”¹å˜ã€‚kvè½¬yamlæŠ¥é”™ï¼Œyamlåˆå¹¶ä¸ç¬¦åˆé¢„æœŸã€‚\n - ä»£ç å†—ä½™ï¼Œç†æ¸…é€»è¾‘ï¼Œè®¾è®¡æ–°æ¥å£ï¼Ÿï¼Ÿä»¥å‰çš„æ¥å£å“ªéƒ½ç”¨ï¼Œæä¸æ¸…æ¥šä½œç”¨ã€‚è¿˜åŒºåˆ†ç”Ÿäº§å’Œæµ‹è¯•ï¼Œæ²¡å¿…è¦\n - å¦‚ä½•æ‰©å±•æ•°ç»„ï¼Œè€Œä¸”åˆä¸å½±å“å˜é‡åˆå¹¶å’Œå¯é…ç½®èŒƒå›´ï¼Œä»¥prefixä¸ºä¸»åˆæœ‰å¯èƒ½ä¼šé€ æˆç»“æ„å˜åŒ–ï¼Œé¢„æœŸçš„é™åˆ¶å¯å¡«èŒƒå›´æ•ˆæœæ²¡æœ‰è¾¾åˆ°ã€‚\n\n# æ–°ç‰ˆ\n\n- å¢åŠ å…¨å±€å˜é‡æ¨¡å—ï¼Œå»æ‰å¯è§æ€§ï¼Œæ”¹ä¸ºæ˜¯å¦å¼•ç”¨å…¨å±€å˜é‡ä¸­çš„ç›¸åŒçš„ï¼ˆç›¸åŒprefixçš„ï¼‰å˜é‡\n\t- ~~æ¯ä¸ªæœåŠ¡çš„é…ç½®ç»†å¾®çš„ä¸åŒï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨å…¨å±€å˜é‡ä¸­çš„ç»“æ„æˆ–å€¼ï¼Œè¿™æ—¶å€™ä¸åº”è¯¥ä½¿ç”¨å…¨å±€å˜é‡ã€‚~~è¿™æ—¶å€™å°±ä¸åº”è¯¥ä½¿ç”¨å…¨å±€å˜é‡ã€‚\n\t - æ‰€æœ‰å˜é‡åªä»¥ç¬¬ä¸€å±‚ key ä¸ºä¸»ã€‚==å­˜å‚¨æ˜¯ç”¨ yaml è¿˜æ˜¯ kvï¼Ÿ==å¦‚æœå­˜å‚¨ kv åˆ™æ— æ³•å­˜ç±»å‹ï¼Ÿyaml å’Œ kv éƒ½å­˜ï¼Œä½†æ˜¯ kv åªå­˜ç¬¬ä¸€å±‚ï¼Ÿ\n\t\t - kv å…·æœ‰å®Œæ•´åŸæ•°æ®ï¼Œå­˜kv\n - å¢åŠ GUI\n\n## æ¢³ç†\n\n- æœåŠ¡å˜é‡ï¼Œå…¨å±€å˜é‡ï¼Œç¯å¢ƒå˜é‡\n- ä»¥prefix keyä¸ºä¸»\n- æ‰©å±•æ•°ç»„éœ€è¦è‡ªå·±å»å…¨å±€å˜é‡æˆ–æœåŠ¡å˜é‡é‡Œæ‰©å±•\n- å·¥ä½œæµå˜é‡\n\t- configï¼ˆkeyï¼‰ï¼štmplSvcå»é™¤å¼•ç”¨äº†å…¨å±€å˜é‡çš„éƒ¨åˆ†\n\t- execï¼ˆvalueï¼‰ï¼šä»¥ä¸Šè¿°keyä¸ºä¸»ï¼Œå€¼å…ˆå»renderé‡ŒæŸ¥æ‰¾ï¼Œfallbackåˆ°tmplSvc\n\t- applyï¼štaskVars + renderVars(global+svc) + tmplVars(global+svc)\n\t- saveï¼štaskVars éœ€è¦ä¿å­˜å“ªäº›å€¼\n- å˜é‡ä½¿ç”¨æµç¨‹\n\t- åœ¨æ¨¡ç‰ˆä¸­å®šä¹‰å˜é‡\n\t\t- æ¸²æŸ“æµ‹è¯•\n\t\t- æ ¼å¼ yaml+kv\n\t- åœ¨æœåŠ¡ä¸­å®šä¹‰å˜é‡\n\t\t- ä½¿ç”¨æ¨¡ç‰ˆåˆ›å»ºæœåŠ¡\n\t\t- æ¸²æŸ“æµ‹è¯•\n\t\t- æ ¼å¼ yaml+kv\n\t- åœ¨é¡¹ç›®ä¸­å®šä¹‰å…¨å±€å˜é‡\n\t\t- å¯æ·»åŠ çš„å…¨å±€å˜é‡ï¼šæ‰€æœ‰æœåŠ¡ä¸­çš„å˜é‡çš„å¹¶é›†\n\t\t- æ ¼å¼ kv\n\t- ä½¿ç”¨å˜é‡\n\t\t- åˆ›å»ºç¯å¢ƒ\n\t\t\t- æ ¼å¼ kv\n\t\t- æ›´æ–°å…¨å±€å˜é‡ï¼ˆæ·»åŠ ã€åˆ é™¤ã€æ›´æ–°å€¼ï¼‰\n\t\t\t- æ²¡æœ‰å…³è”æœåŠ¡æ‰èƒ½åˆ é™¤\n\t\t\t- æ–°æ·»åŠ çš„ä»é¡¹ç›®ä¸­å®šä¹‰çš„å…¨å±€å˜é‡ä¸­é€‰\n\t\t\t- æ ¼å¼ kv\n\t\t- æ·»åŠ æœåŠ¡\n\t\t\t- UpdateMultiProducts\n\t\t\t- æ ¼å¼ kv\n\t\t- æ›´æ–°æœåŠ¡\n\t\t\t- æ ¼å¼ kv\n\t\t- åˆ é™¤æœåŠ¡\n\t\t\t- åˆ é™¤ç¯å¢ƒä¸­å¯¹åº”å…¨å±€å˜é‡çš„å…³è”å…³ç³»\n\t\t- æœåŠ¡åŠ å…¥ç¯å¢ƒ\n\t\t\t- UpdateMultiProducts\n\t\t\t- æ ¼å¼ kv\n\t\t- è‡ªå®šä¹‰å·¥ä½œæµéƒ¨ç½²ä»»åŠ¡\n\t\t\t- æ ¼å¼ kv\n\t\t- è¿è¡Œæ—¶\n\t\t\t- render_set\n\t\t\t\t- æ ¼å¼ kv\n\t\t\t- æ¸²æŸ“\n\t\t\t\t- æ ¼å¼ yaml\n\n## é—®é¢˜\n\n - helm ä¸ yaml å‰²è£‚ä¸¥é‡\n\t - default values å’Œ global variables åˆ°åº•æ€ä¹ˆåŒºåˆ†\n - å®šä¹‰æ—¶åŒæ—¶åŒ…å« Yaml å’Œ KVï¼Œä½¿ç”¨æ—¶çº¯ KV?\n\n## å®ç°\n\n- åœ¨ç°æœ‰renderseté‡Œæ‰©å±•\n- æ•°æ®å˜æ›´ï¼Œå…¨å±€å˜é‡ã€æœåŠ¡å˜é‡ï¼ˆkvï¼‰ã€å·¥ä½œæµå˜é‡ï¼Œéƒ½ä½¿ç”¨æ–°å­—æ®µ\n- æ¥å£è§£è€¦ï¼Œé…ç½®ã€æ‰§è¡Œã€æµ‹è¯•ã€ç”Ÿäº§ã€å­—æ®µ\n\n## åˆ†è§£\n\n- å®šä¹‰å˜é‡æ•°æ®æ ¼å¼\n\t- å®šä¹‰åœ¨é¡¹ç›®ï¼Œå®ä¾‹åŒ–ã€å…³è”å…³ç³»åœ¨ç¯å¢ƒ\n\t- åŸºç¡€å˜é‡\n\t\t- yaml\n\t\t\t- å¤šè¡Œæ–‡æœ¬\n\t\t- kv\n\t\t\t- é”®åï¼Œç±»å‹ï¼Œå¯é€‰èŒƒå›´ï¼Œé»˜è®¤å€¼ï¼Œæè¿°\n\t- å…¨å±€å˜é‡\n\t\t- åŸºç¡€å˜é‡ + å…³è”å…³ç³»+æ˜¯å¦ä½¿ç”¨å…¨å±€å˜é‡ç­‰\n- æ¨¡ç‰ˆ 1.5d\n\t- ä¿å­˜ç›´æ¥è§£æ keyï¼Œé»˜è®¤ç±»å‹ stringï¼Œå€¼ä¸ºç©º\n\t- ä¸‹æ‰å¯è§æ€§\n\t- ä½¿ç”¨æ¨¡ç‰ˆåˆ›å»ºæœåŠ¡ï¼Œéœ€è¦å¡«å†™å˜é‡çš„å€¼ï¼Œkv å½¢å¼\n\t- **æ›´æ–°æ¨¡ç‰ˆæ—¶ï¼Œbase å˜é‡æ˜¯ä»æ•°æ®åº“è·å–ï¼Œè¿˜æ˜¯ä»å‰ç«¯è·å–ï¼Ÿ**\n\t- å®ç°\n\t\t- åˆ›å»ºæ¨¡ç‰ˆ CreateYamlTemplate\n\t\t- æ›´æ–°æ¨¡ç‰ˆ UpdateYamlTemplate\n\t\t- è·å–æ¨¡ç‰ˆä¿¡æ¯ GetYamlTemplateDetail\n\t\t- æ›´æ–°æ¨¡ç‰ˆå˜é‡ UpdateYamlTemplateVariable\n\t\t- æ ¹æ®æ¨¡ç‰ˆåˆ›å»ºæœåŠ¡ LoadServiceFromYamlTemplate\n\t\t- é‡æ–°åŠ è½½æ¨¡ç‰ˆ ReloadServiceFromYamlTemplate\n- æœåŠ¡ 1d\n\t- ä¿å­˜ç›´æ¥è§£æ keyï¼Œé»˜è®¤ç±»å‹ stringï¼Œå€¼ä¸ºç©º\n\t- äº¤äº’è·Ÿæ¨¡ç‰ˆä¸€æ ·\n\t- æœåŠ¡å¯è®¾ç½®å…¨å±€å˜é‡\n\t- **å˜é‡ yaml é¡ºåºå’Œ kv é¡ºåºä¸€è‡´**\n\t- å®ç°\n\t\t- æ ¡éªŒå˜é‡\n\t\t- ä¿å­˜å˜é‡\n\t\t- ä¿å­˜æœåŠ¡æ—¶è‡ªåŠ¨è§£æå˜é‡\n- å…¨å±€å˜é‡ ï¼ˆå®šä¹‰ï¼‰ 1d\n\t- å£°æ˜åœ¨é¡¹ç›®ä¸­\n\t- åˆ›å»ºç¯å¢ƒæ—¶ç”Ÿæ•ˆ\n\t- æ·»åŠ  key æ—¶ï¼Œç”¨æ‰€æœ‰æœåŠ¡çš„ key çš„å¹¶é›†ï¼Œ~~å¹¶æ˜¾ç¤ºå˜é‡å…³è”æœåŠ¡~~\n\t\t- ä¹Ÿå¯ä»¥æ‰‹åŠ¨è¾“å…¥\n\t- æ–°å¢ã€ç¼–è¾‘ã€åˆ é™¤å…¨å±€å˜é‡\n\t- å®ç°\n\t\t- è·å–å…¨å±€å˜é‡ GetGlobalVariables\n\t\t- è·å–å…¨å±€å˜é‡å€™é€‰ GetGlobalVariableCandidates\n\t\t- æ›´æ–°å…¨å±€å˜é‡ UpdateGlobalVariables\n- ç¯å¢ƒå˜é‡ï¼ˆä½¿ç”¨ï¼‰ 5-6d\n\t- æ›´æ–°å…¨å±€å˜é‡ 1.5d\n\t\t- æ–°å¢ã€åˆ é™¤å˜é‡\n\t\t\t- æ ¹æ®å…¨å±€å˜é‡å®šä¹‰æ¥\n\t\t\t- è¿˜éœ€è¦è¿›è¡Œæ•°æ®æ ¡éªŒ\n\t\t\t- æ²¡æœ‰å…³è”æœåŠ¡çš„å…¨å±€å˜é‡æ‰å¯åˆ é™¤\n\t\t\t- æ·»åŠ å…¨å±€å˜é‡ï¼Œå¯é€‰åˆ—è¡¨ä¸ºæœåŠ¡-å…¨å±€å˜é‡åˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­å»é™¤ç¯å¢ƒä¸­å·²æœ‰çš„å…¨å±€å˜é‡\n\t\t- éœ€è¦æ˜¾ç¤ºå…³è”æœåŠ¡\n\t\t- å®ç°\n\t\t\t- è·å–å…¨å±€å˜é‡å€™é€‰ GetGlobalVariableCandidate\n\t\t\t- æ›´æ–°å…¨å±€å˜é‡ UpdateK8sProductGlobalVariables\n\t- æœåŠ¡åŠ å…¥ç¯å¢ƒã€æ·»åŠ æœåŠ¡ã€æ›´æ–°æœåŠ¡ã€åˆ é™¤æœåŠ¡ 1d\n\t\t- ç•Œé¢ç±»ä¼¼\n\t\t- ä¿å­˜åˆ°ç¯å¢ƒé‡Œçš„å˜é‡æ˜¯å¦å¯ä»¥ä¿®æ”¹? ä¸\n\t\t- éªŒè¯å¼•ç”¨å…¨å±€å˜é‡æ˜¯å¦æ­£ç¡®\n\t\t- helm ä¸æ”¹\n\t\t- å®ç°\n\t\t\t- è·å–ä¿¡æ¯\n\t\t\t\t- /environment/kube/k8s/resources GetResourceDeployStatus\n\t\t\t\t\t- è·å– k8s èµ„æºæ£€æµ‹æƒ…å†µ\n\t\t\t\t- /service/services/{name}/environments/deployable GetDeployableEnvs\n\t\t\t\t\t- è·å–ç¯å¢ƒéƒ¨ç½²æƒ…å†µ\n\t\t\t\t- è·å–å˜é‡ä¿¡æ¯\n\t\t\t\t\t- GetProductDefaultValuesï¼Ÿproduct åº”è¯¥æ²¡æœ‰é»˜è®¤å˜é‡æ‰å¯¹\n\t\t\t\t\t- GetGlobalVariables è·å–ç¯å¢ƒçš„å…¨å±€å˜é‡\n\t\t\t\t\t- service/services/{name} GetServiceTemplateOption æœªæ”¹åŠ¨\n\t\t\t- è®¾ç½®å˜é‡\n\t\t\t\t- å‰ç«¯\n\t\t\t- åº”ç”¨å˜é‡\n\t\t\t\t- åŠ å…¥ç¯å¢ƒã€æ·»åŠ æœåŠ¡\n\t\t\t\t\t- /environment/environments UpdateMultiProducts\n\t\t\t\t- æ›´æ–°æœåŠ¡\n\t\t\t\t\t- /environment/environments/: name/services/: serviceName UpdateService\n\t\t\t\t- åˆ é™¤æœåŠ¡\n\t\t\t\t\t- /environment/environments/{name}/services DeleteServices\n\t\t\t\t\t\t- å‰ç«¯æ²¡å˜åŒ–\n\t- åˆ›å»ºç¯å¢ƒ 1.5d\n\t\t- å…¨å±€å˜é‡æ¨¡å—\n\t\t\t- éœ€è¦æ˜¾ç¤ºå…³è”çš„æœåŠ¡ï¼šå‰ç«¯\n\t\t- æœåŠ¡å˜é‡æ¨¡å—\n\t\t\t- å¯è®¾ç½®æŸä¸ªå˜é‡ä¸ºå…¨å±€å˜é‡\n\t\t\t\t- è‡ªåŠ¨æ›´æ–°å…¨å±€å˜é‡æ¨¡å—\n\t\t\t\t- å¯é…ç½®å˜é‡åœ¨å“ªä¸ªæœåŠ¡ç”Ÿæ•ˆï¼Œæ ¹æ®æœåŠ¡é…ç½®åŠ¨æ€å˜æ›´\n\t\t- ~~æœåŠ¡ä¸­é…ç½®æ ¹æ®å…³è”æ€§æ¥é…ç½®æ˜¯å¦ä¸ºå…¨å±€å˜é‡ï¼Œå—åˆ°æœåŠ¡å®šä¹‰çº¦æŸ~~\n\t\t- å®ç°\n\t\t\t- /environment/init_info GetInitProduct\n\t\t\t- /rendersets/variables GetServiceVariables\n\t\t\t- /environment/environments CreateProduct åˆ›å»ºç¯å¢ƒ\n\t- å¤åˆ¶ç¯å¢ƒ 0.5-1d\n\t\t- /environment/environments CreateProduct ä¹Ÿå¯åˆ›å»º\n\t- åä½œè€…æ¨¡å¼ 0.5-1d ?\n\t\t- è·ŸåŠ å…¥ç¯å¢ƒç±»ä¼¼\n\t\t- å®ç°\n\t\t\t- /collaboration/collaborations/sync SyncCollaborationInstance\n\t- æ•°æ®æ ¡éªŒ 0.5d ï¼Ÿ\n\t\t- æ·»åŠ å˜é‡ã€åˆ é™¤å˜é‡ã€åˆ é™¤æœåŠ¡ã€æ·»åŠ æœåŠ¡ç­‰\n\t\t- ç»´æŠ¤å…¨å±€å˜é‡å…³è”å…³ç³»\n\t- å…¨å±€å˜é‡äº’æ–¥é”\n\t\t- version control\n- è‡ªå®šä¹‰å·¥ä½œæµ 1.5-2d\n\t- ä¸æ˜¾ç¤ºä½¿ç”¨å…¨å±€å˜é‡çš„å˜é‡\n\t\t- ç”Ÿäº§ç¯å¢ƒæ€ä¹ˆåŠï¼Ÿ\n\t\t- ç¬¬ä¸€æ¬¡éƒ¨ç½²åˆæ€ä¹ˆåŠï¼Ÿ\n\t- å·¥ä½œæµé…ç½®ã€å·¥ä½œæµæ‰§è¡Œ\n\t\t- ç¡®å®šåœ¨é…ç½®å˜é‡æ—¶éƒ½è¦å±•ç¤ºå“ªäº›ä¿¡æ¯?\n\t\t- å·¥ä½œæµç»“æ„å®šä¹‰\n\t\t- **æ‰§è¡Œè¿è¡Œæ—¶**\n\t\t\t- å·¥ä½œæµ kv è½¬ yaml\n\t\t\t- å·¥ä½œæµyaml åˆå¹¶ render yamlï¼Œç”Ÿæˆå®Œæ•´çš„ varabile yaml\n\t\t\t- varaible yaml å†å’ŒæœåŠ¡çš„ yaml å®šä¹‰ï¼Œæ¸²æŸ“ç”Ÿæˆ fullRenderYaml (updateYaml)\n\t\t\t- updateSystemService åº”ç”¨ yaml å¹¶æ›´æ–° render set\n\t\t\t- k8s æœåŠ¡ä¸‹çº¿æ²¡æœ‰ä¼ å˜é‡\n\t- æ¥å£æ•´ç†\n\t\t- GetPreset   /workflow/v4/preset\n\t\t- GetFilteredEnvServices    /workflow/v4/filterEnv\n\t\t- ListSvcsInEnv    /environment/environments/{name}/services\n\t\t- PreviewService     /environment/environments/{name}/services/{serviceName}/preview\n\t\t- CreateWorkflowTaskV4    /workflow/v4/workflowtask\n- UA 2d ?\n\t- æ•°æ®å…¼å®¹\n\t- kv åˆå¹¶åˆ°ç¬¬ä¸€å±‚\n\t- å†¬å†¬å®ç°\n\t- æ¶‰åŠå˜åŒ–\n\t\t- template_service\n\t\t- yaml_template\n- å·¥å…·\n\t- [x] kv ä¸ yaml è½¬æ¢ âœ… 2023-04-26\n- Notes\n\t- ç”Ÿäº§ç¯å¢ƒæ²¡æœ‰å…¨å±€å˜é‡\n\t- å˜é‡åœ¨å„ä¸ªé˜¶æ®µçš„æ ¼å¼\n\t\t- æœåŠ¡ï¼škv+yaml\n\t\t- å·¥ä½œæµé…ç½®ï¼škv+yaml\n\t\t- å·¥ä½œæµæ‰§è¡Œï¼škv+yaml\n\t\t- ç¯å¢ƒï¼škv+yaml\n\t\t- è¿è¡Œæ—¶ï¼šyaml\n\t- OpenAPI å˜æ›´\n\t\t- OpenAPILoadServiceFromYamlTemplate\n\t- SafeMergeVariableYaml åºŸå¼ƒ\n","lastmodified":"2023-05-18T16:10:30.616349313Z","tags":[]},"/Spaces/Zadig/%E6%B5%8B%E8%AF%95":{"title":"æµ‹è¯•","content":"","lastmodified":"2023-05-18T16:10:30.616349313Z","tags":[]},"/Spaces/Zadig/%E6%B5%8B%E8%AF%95%E8%B5%84%E6%BA%90":{"title":"æµ‹è¯•èµ„æº","content":"","lastmodified":"2023-05-18T16:10:30.616349313Z","tags":[]},"/Spaces/Zadig/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E4%BD%9C%E6%B5%81":{"title":"è‡ªå®šä¹‰å·¥ä½œæµ","content":"# åˆ†ç±»\n\n- pipeline_task æ—§çš„å•äº§å“å·¥ä½œæµï¼Œå·²å¼ƒç”¨\n- workflow_task äº§å“å·¥ä½œæµ\n- workflow_task_v4 è‡ªå®šä¹‰å·¥ä½œæµ\n\njob è¿è¡Œå®Œä¼šå›å†™pipeline_task_v2\n\n# Job\n\n## JobDeploy\n\n### k8s\n\n- éƒ¨ç½²æ—¶å‹¾é€‰æœåŠ¡é…ç½®ï¼šjobTaskSpec.DeployContents åŒ…å« config\n- å¹¶ä¸”æ˜¯ç³»ç»Ÿåˆ›å»ºçš„ï¼Œå¹¶ä¸”æœåŠ¡çš„UpdateConfig == trueï¼Œåˆ™UpdateServiceRevision = true\n- DeployContentsä¸ä»…ä»…åŒ…å«imageï¼Œåˆ™é‡æ–°éƒ¨ç½²æœåŠ¡\n- æœåŠ¡UpdateConfigä¸ºæ˜¯å¦ä½¿ç”¨æ–°é…ç½®ï¼Œupdatableæ˜¯å¦å¯æ›´æ–°\n- å¯¹ä»…æ›´æ–°workloadé•œåƒçš„æƒ…æ™¯ï¼Œä»…è¿”å›æ¶‰åŠçš„deploymentså’Œstatefulsetsçš„manifest\n\n### Helm\n\næœåŠ¡é…ç½®ï¼šä½¿ç”¨æœ€æ–°é…ç½®ï¼Œæ‹‰å–æœ€æ–°æœåŠ¡é…ç½®\n\næœåŠ¡å˜é‡ï¼šå˜é‡å¯é€‰å€¼ä¸ºvaluesçš„å€¼ï¼Œä¸éœ€è¦å…ˆåœ¨æœåŠ¡é‡Œé…ç½®å˜é‡ï¼Œç›´æ¥åœ¨å·¥ä½œæµé‡Œé…ç½®å¯é€‰èŒƒå›´ï¼Œæœ€ç»ˆæ‰§è¡Œæ—¶å†é…ç½®å…·ä½“çš„å€¼ï¼Œå…¶ä¸­é»˜è®¤å€¼ä¸ºç¯å¢ƒä¸­çš„å€¼ï¼Œç¯å¢ƒä¸­å¦‚æœæ²¡æœ‰ï¼Œåˆ™å»æœåŠ¡æ¨¡ç‰ˆé‡Œæ‹¿æœ€æ–°çš„ï¼Ÿé»˜è®¤å€¼æ˜¯ä»GetFilteredEnvServicesé‡Œè·å–çš„ï¼Œå¯é…ç½®èŒƒå›´ä»template_svcé‡Œè·å–ï¼Ÿ\n\nhelmæ˜¯æ‹¿æœ€æ–°çš„valuesï¼Œè€Œä¸æ˜¯envä¸­çš„valuesï¼Œk8så‘¢ï¼Ÿ\n\nä»template servicesè·å–valuesï¼Œåˆå¹¶render_setçš„values\n\nHelmæ²¡æœ‰ç›´æ¥ä½¿ç”¨template_serviceï¼Œtempate_serviceé‡Œçš„æ˜¯åŸå§‹ä»“åº“ã€æœåŠ¡ä¸­çš„valuesï¼Œrender_seté‡Œçš„æ˜¯åˆå¹¶åçš„ã€æœ€ç»ˆç”Ÿæ•ˆçš„values\n\næ£€æŸ¥è¿è¡Œæ—¶æ—§çš„æ±¡æŸ“å˜é‡æ˜¯å¦æœ‰ç”Ÿæ•ˆ","lastmodified":"2023-05-18T16:10:30.616349313Z","tags":[]},"/Spaces/Zadig/%E8%B6%85%E6%97%B6%E6%8E%A7%E5%88%B6":{"title":"è¶…æ—¶æ§åˆ¶","content":"1.  /picket/projects/helm-simple-service è·³è½¬ /project/products\n2.  timeoutæ•°æ®å­˜åœ¨äº†ï¼štemplate_productè¡¨\n\n- [[Spaces/Zadig/è‡ªå®šä¹‰å·¥ä½œæµ|è‡ªå®šä¹‰å·¥ä½œæµ]]ï¼šWorkflow/Service/Workflow/Job/job_deploy:207\n- [[Spaces/Zadig/äº§å“å·¥ä½œæµ|äº§å“å·¥ä½œæµ]]ï¼šworkflow/service/workflow/pipeline_controller:252\n\n- [[Spaces/Zadig/è‡ªå®šä¹‰å·¥ä½œæµ|è‡ªå®šä¹‰å·¥ä½œæµ]]éƒ¨ç½²è¶…æ—¶æ§åˆ¶ï¼š pkg/microservice/aslan/core/common/service/workflowcontroller/jobcontroller/job_deploy.go:452\n- [[Spaces/Zadig/äº§å“å·¥ä½œæµ|äº§å“å·¥ä½œæµ]]éƒ¨ç½²è¶…æ—¶æ§åˆ¶ï¼špkg/microservice/warpdrive/core/service/taskplugin/deploy.go:110\n\n- å‘é€æ¶ˆæ¯\n\t- å‘é€æ¶ˆæ¯åˆ°[[Spaces/Zadig/warpdrive|warpdrive]]ï¼špkg/microservice/aslan/core/workflow/service/workflow/pipeline_controller.go:289\n\t- æ¶ˆæ¯ç»“æ„ï¼špkg/microservice/aslan/core/common/repository/models/queue.go:28\n- æ¥æ”¶æ¶ˆæ¯\n\t- [[Spaces/Zadig/warpdrive|warpdrive]]å¤„ç†æ¶ˆæ¯ï¼špkg/microservice/warpdrive/core/service/taskcontroller/task_handler.go:66\n\t- æ¶ˆæ¯ç»“æ„ï¼špkg/microservice/warpdrive/core/service/types/task/model.go:29\n- MQ -\u003e Task.Stage.SubTasks -\u003e Deploy.timeout","lastmodified":"2023-05-18T16:10:30.616349313Z","tags":[]},"/Spaces/Zadig/%E9%95%9C%E5%83%8F%E5%90%8D%E7%A7%B0":{"title":"é•œåƒåç§°","content":"- helméƒ¨ç½² -\u003e service module -\u003e get image name\n- K8séƒ¨ç½² -\u003e service -\u003e get image name\n\n- [[Spaces/Zadig/äº§å“å·¥ä½œæµ|äº§å“å·¥ä½œæµ]]åˆ›å»ºï¼špkg/microservice/aslan/core/workflow/service/workflow/workflow_task.go:537\n- [[Spaces/Zadig/äº§å“å·¥ä½œæµ|äº§å“å·¥ä½œæµ]]è®¾ç½®ImageNameçš„åœ°æ–¹ï¼špkg/microservice/aslan/core/workflow/service/workflow/workflow_task.go:2401\n\nimage_name æ•°æ®åº“å­˜åœ¨äº†å“ªé‡Œ\n\n- [[Spaces/Zadig/è‡ªå®šä¹‰å·¥ä½œæµ]]ä¼šå­˜åœ¨ï¼šworkflow_task.stages.jobs.spec.envs.key=IMAGEä¸­\n- [[Spaces/Zadig/äº§å“å·¥ä½œæµ|äº§å“å·¥ä½œæµ]]ä¼šå­˜åœ¨ï¼špipeline_task_v2.stages.sub_tasks.job_ctx.imageä¸­\n\n---\n\n# æ¢³ç†\n\n- æ¢³ç†è·å–é•œåƒåˆ—è¡¨çš„åœºæ™¯\n\t- Build ç”Ÿæˆé•œåƒ\n\t- ä½¿ç”¨é•œåƒçš„åœºæ™¯\n\t\t- äº§å“å·¥ä½œæµ -\u003e äº¤ä»˜ç‰©éƒ¨ç½² ï¼ˆåŸæ¥å°±æ˜¯ imageNameï¼‰\n\t\t- è‡ªå®šä¹‰å·¥ä½œæµ -\u003e éƒ¨ç½²ã€é•œåƒåˆ†å‘ã€k8s éƒ¨ç½² (ç¡®å®šæ˜¯ä½¿ç”¨çš„èµ„æºè¿˜æ˜¯æœåŠ¡çš„ IMAGE_NAME) ï¼ˆå·²æ”¹æˆ imageNameï¼‰\n\t\t- å‘å¸ƒå·¥ä½œæµ -\u003e è“ç»¿éƒ¨ç½²ã€é‡‘ä¸é›€éƒ¨ç½²ã€ç°åº¦å‘å¸ƒã€istioå‘å¸ƒï¼ˆè¿˜æ˜¯serviceModuleï¼‰\n\t\t- æ·»åŠ è§¦å‘å™¨\n\t- åˆ›å»ºé¡¹ç›®\n\t\t- ![[Extras/Images/CleanShot 2023-05-04 at 14.18.37@2x.png]]\n\t- åŠ å…¥ç¯å¢ƒï¼Ÿ\n- æ¢³ç†é•œåƒç”Ÿæˆè§„åˆ™\n\t- æ²¡æœ‰è®¾ç½®ä»£ç æº\n\t\t- ä½¿ç”¨ imageName\n\t- æœ‰è®¾ç½®ä»£ç æº\n\t\t- é»˜è®¤æ²¡æœ‰ä¿å­˜é•œåƒè§„åˆ™\n\t\t\t- åç«¯é»˜è®¤ä½¿ç”¨ service module ä½œä¸ºé•œåƒå\n\t\t\t- å‰ç«¯é»˜è®¤æ˜¾ç¤ºçš„æ˜¯ IMAGE_NAME\n\t\t\t- æ²¡æœ‰ service module å˜é‡ï¼Œåªæœ‰ SERVICEï¼ˆæœåŠ¡åï¼‰\n\t\t- ä¿å­˜äº†é•œåƒè§„åˆ™\n\t\t\t- æ ¹æ®é•œåƒè§„åˆ™æ¥è®¾ç½®\n\t- é•œåƒåæ›´æ”¹åï¼Œå¯èƒ½ä¼šå‡ºç°é€‰æ‹©ä¸åˆ°çš„æƒ…å†µ\n\t\t- ä»…éƒ¨ç½²çš„æƒ…å†µä¸‹ï¼Œæ— æ³•è·å–æ„å»ºç”Ÿæˆçš„å®Œæ•´ imageï¼Œåªèƒ½æ ¹æ®è§„åˆ™æ¥é€‰æ‹©å¯¹åº”çš„é•œåƒï¼Œæˆ–è€…ä½¿ç”¨å›ºå®šçš„ç­–ç•¥\n\t\t- å­˜å‚¨çš„ imageName æ²¡æœ‰æŒ‰ç…§ç”Ÿæˆè§„åˆ™æ¥\n- ä¼˜åŒ–è·å–é•œåƒåé€»è¾‘\n\t- æ ¹æ® image è§£æ image name\n\t\t- image è§£æå¯èƒ½å’Œä½¿ç”¨çš„é•œåƒç”Ÿæˆè§„åˆ™ä¸ä¸€è‡´ã€‚\n\t\t\t- ä»…éƒ¨ç½²æ—¶ä½¿ç”¨å“ªä¸ªï¼Œä»…éƒ¨ç½²ä¸çŸ¥é“éƒ½å·²ç”Ÿæˆçš„é•œåƒæ˜¯æŒ‰ä»€ä¹ˆè§„åˆ™ç”Ÿæˆçš„\u0008\n\t\t\t\t- æ ¹æ®è§„åˆ™æ¥é€‰æ‹©\n\t- ~~ä»æœªæ„å»ºï¼Œä½†æ˜¯å¯ä»¥éƒ¨ç½²~~ ä»…éƒ¨ç½²ï¼Œä»¥å‰ä¹Ÿæ²¡æœ‰éƒ¨ç½²è¿‡\n\t\t- ç›´æ¥æœåŠ¡å®šä¹‰é‡Œçš„é•œåƒåè·å–é•œåƒ\n\t\t- å¯é€šä¿®è¿‡è·å–é•œåƒçš„è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯å¯ä¿®æ”¹é•œåƒåç§° (ï¼Ÿ)\n- è‡ªå®šä¹‰å·¥ä½œæµæ¶‰åŠé•œåƒé€‰æ‹©çš„æ¥å£\n\t- Job Preset\n\t- buildServiceInfoInEnv\n\t- ~~ListBuildModulesByServiceModuleï¼Ÿå•¥å•¥åˆ†ä¸æ¸…æ¥šï¼Œè¿™ä¸ªæ¥å£æ˜¯å“ªé‡Œç”¨çš„ï¼Ÿ~~\n - è‡ªå®šä¹‰å·¥ä½œæµç”Ÿæˆé•œåƒè§„åˆ™å‡½æ•°\n\t - ReleaseCandidate\n- æ—¢é€‰æ‹©äº†æ›´æ–°æœåŠ¡é…ç½®ã€åˆé€‰æ‹©äº†æ›´æ–°é•œåƒåï¼Œé€‰æ‹©é•œåƒæ—¶æ˜¯ä½¿ç”¨çš„å“ªä¸€ä»½é•œåƒåï¼Œç¯å¢ƒé‡Œçš„è¿˜æ˜¯æœ€æ–°çš„\n\t- ä¼˜å…ˆä½¿ç”¨ç¯å¢ƒé‡Œéƒ¨ç½²çš„é•œåƒåç§°ï¼Œç¯å¢ƒé‡Œæ²¡æœ‰åˆ™ä½¿ç”¨æœ€æ–°çš„æœåŠ¡å®šä¹‰é‡Œçš„é•œåƒåç§°\n\t- TBD éœ€è¦æ”¹æˆä½¿ç”¨æœ€æ–°æœåŠ¡é…ç½®é‡Œçš„é•œåƒåæ¥è¿‡æ»¤\n\t- 1.4.0 æ˜¯ä½¿ç”¨æœåŠ¡å®šä¹‰ï¼ˆç¯å¢ƒçš„ revisionï¼Œè¿˜æ˜¯æœ€æ–°çš„ï¼Ÿï¼‰é‡Œçš„é•œåƒåç§°æ¥è¿‡æ»¤\n\t\t- Preset æ˜¯è·å–çš„æœ€æ–°çš„\n\t\t- buildServiceInfoInEnv æ˜¯è·å–æœ€æ–°çš„ revision\n- TDB æ¶‰åŠé•œåƒåç§°å˜æ›´é—®é¢˜çš„å¤„ç†\n- [ ] æ•´ç†éƒ¨ç½²è·å–é•œåƒåæ¥å£ï¼Œç›®å‰å¤ªæ‚ä¹±ï¼Œæ¯”å¦‚ ListBuildModulesByServiceModule æœ‰ updateServiceRevision å‚æ•°ï¼Œä½†åœ¨éƒ¨ç½²çš„æ—¶å€™æ²¡æœ‰ä½¿ç”¨\n\n# 1.4.0 PATCH\n\n- ç”Ÿæˆè§„åˆ™\n\t- ä¿®æ”¹å‰ç«¯é»˜è®¤å€¼ï¼Œé»˜è®¤ SERVCE_MODULEï¼Œè€Œä¸æ˜¯ IMAGE_NAMEï¼Œä»¥åŠä¿®æ”¹ SERVICE å˜é‡æè¿°\n\t- åç«¯ç”Ÿæˆè§„åˆ™ä¸å˜\n- ç”Ÿæˆè§„åˆ™\n\t- ä¿®æ”¹å‰ç«¯é»˜è®¤å€¼ï¼Œä»¥åŠæè¿°\n\t- åç«¯ç”Ÿæˆè§„åˆ™ä¸å˜\n- ç­›é€‰è§„åˆ™\n\t- ~~å‰ç«¯éœ€è¦æ”¯æŒå·¥ä½œæµéƒ¨ç½²å¯é€‰ IMAGE_NAME~~\n\t- åç«¯ IMAGE_NAMEï¼Œä¼˜å…ˆä»ç¯å¢ƒçš„å®Œæ•´æˆ IMAGE é‡Œè·å–ï¼Œ\n\t- ç¯å¢ƒé‡Œæ²¡æœ‰åˆ™ä»æœåŠ¡å®šä¹‰çš„å®Œæ•´ IMAGE é‡Œè·å–\n - ä»…å¤„ç†è‡ªå®šä¹‰å·¥ä½œæµéƒ¨ç½²ä»»åŠ¡\n - å®Œæ•´æ¨¡æ‹Ÿææ°ªç¯å¢ƒ\n\t - serverMoudule å’Œ imageName ä¸ä¸€è‡´\n\t - æ²¡æœ‰ä¿å­˜ç­–ç•¥çš„æƒ…å†µä¸‹ä½¿ç”¨çš„æ˜¯ serviceModule\n","lastmodified":"2023-05-18T16:10:30.616349313Z","tags":[]},"/Spaces/Zadig/%E9%97%AE%E9%A2%98":{"title":"é—®é¢˜","content":"- [ ] recover æ²¡æœ‰æ‰“å°å †æ ˆ\n- [ ] Build è¶…æ—¶ç«‹å³é‡å¯ä¸æ­£ç¡®ï¼Œéœ€è¦æ£€æµ‹ termination\n- [ ] ensureServiceTmplã€fillServiceTmpl å’Œ SetCurrentContainerImagesï¼Œä»£ç å†—ä½™","lastmodified":"2023-05-18T16:10:30.616349313Z","tags":[]},"/Spaces/Zadig/ChatGPT":{"title":"ChatGPT","content":"\n# ä»‹ç»\n\n[[Cards/ChatGPT]]\n\n# çŸ­æœŸåº”ç”¨åœºæ™¯\n\n- codex è¡¥å…¨ yaml\n\t- åº”ç”¨åœºæ™¯è¾ƒå°‘ï¼Œéœ€è¦è‡ªå·±å†™ yaml çš„æƒ…æ™¯ä¸å¤š\n- å·¥ä½œæµ yaml è§£é‡Š\n\t- æœ‰ä¸€å®šä½œç”¨ï¼Œä½†ä¼šå°†å·¥ä½œæµ yaml çš„å†…å®¹è¿›è¡Œè¾ƒå¤§å¹…åº¦çš„ç²¾ç®€\n- ç”Ÿæˆæ„å»ºè„šæœ¬\n\t- ä¸ç†è§£é¡¹ç›®æ— æ³•ç”Ÿæˆ\n- æ„å»ºè„šæœ¬ lintã€è§£é‡Š\n- dockerfile lintã€è§£é‡Š\n\t- åŒä¸Š\n- å±€é™\n\t- åº”ç”¨åœºæ™¯ä»…é™äºç‰‡æ®µçš„ yaml å’Œè„šæœ¬\n\t- æ— æ³•ç†è§£æ•´ä¸ªé¡¹ç›®\n\t- å¦‚ä½•ç†è§£æ•´ä¸ªé¡¹ç›®\n\t\t- ç”¨æ–‡å­—çš„æ–¹å¼å°†é¡¹ç›®ç»“æ„å±•ç°å‡ºæ¥\n\t\t- ~~å°†æ‰€æœ‰ä»£ç ä¸Šä¼ ï¼Œè®© ChatGPT å­¦ä¹ ç†è§£~~\n- è´´è¿‘å¼€å‘è€…æ—¥å¸¸åœºæ™¯ï¼Œæ¯”å¦‚æ„å»ºè¿‡ç¨‹ã€éƒ¨ç½²è¿‡ç¨‹ã€ç¯å¢ƒä½¿ç”¨ï¼Œè®©å¼€å‘è€…æ›´åŠ ä¾¿åˆ©çš„è¯Šæ–­å®šä½é—®é¢˜\n\t- éœ€è¦è®© ChatGPT å®Œå…¨ç†è§£ zadigï¼Œç†è§£ zadig çš„é”™è¯¯ä¿¡æ¯ï¼Œç›®å‰æ²¡æœ‰å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆ\n\t- Fine-tuneï¼Ÿä»…é€‚ç”¨äºåŸºç¡€ modelä¸æ”¯æŒ Chat\n\n# é•¿æœŸåº”ç”¨åœºæ™¯\n\n- æ ¸å¿ƒä¸šåŠ¡ï¼ˆdevopsï¼‰çš„å°åœºæ™¯ï¼Œæµè§ˆå™¨æ’ä»¶å¼€å‘ï¼Œæ¯”å¦‚å·¥ä½œæµ yaml æ ¡éªŒï¼Ÿç¯å¢ƒçŠ¶æ€å·¡æ£€ï¼Ÿå·¥ä½œæµæ‰§è¡Œï¼Ÿ\n\t- å·¥ä½œæµ yaml æ ¡éªŒï¼šæŒ‰ç†è¯´å¯è¡Œï¼Œä½†æµ‹è¯•åæ•ˆæœä¸ä½³\n\t- ç¯å¢ƒçŠ¶æ€å·¡æ£€ï¼šå·²æœ‰å¼€æºé¡¹ç›®ï¼Œk8sGPT\n\t- å·¥ä½œæµæ‰§è¡Œï¼šPlugin\n- å·¥ç¨‹å¸ˆæ—¥å¸¸çš„æ“ä½œï¼Œæ¯”å¦‚çœ‹æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ—¥å¿—ã€ç¯å¢ƒå®æ—¶æ—¥å¿—ã€ä»»ä½•é”™è¯¯è¿”å›åè¿…é€Ÿç»™ä¸€äº› AI å»ºè®®ï¼Ÿ\n\t- æ—¥å¿—å¤ªé•¿\n\t- é”™è¯¯ä¿¡æ¯éœ€è¦è®© ChatGPT å­¦ä¹ ã€ç†è§£\n\t\t- fine-tuningï¼Ÿ\n- åŸºäº azure æœåŠ¡ï¼Œæä¾›é¢å‘ä¼ä¸šå†…éƒ¨çš„ä»£ç æç¤ºå·¥å…·ï¼ˆç›®å‰ github copilot åªèƒ½æ˜¯ github ç”¨æˆ·ï¼‰ ã€‚åœ¨ zadig é‡Œæä¾›ä¸€ä¸ªæ¯”å¦‚æ’ä»¶æˆ–è€…åŒºåŸŸå¯ä»¥ç»™å¼€å‘è€…åš Prompt\n\t- yaml ? or code ?\u0008\n- å°†æ•°æ®å–‚ç»™ ChatGPT ç»Ÿä¸€é—®ç­”å…¥å£ä¸ºå¼€å‘è€…æœåŠ¡ã€‚ChatGPT å¯ä»¥è‡ªåŠ¨åœ°å¯¹å¸–å­ä¸­çš„å…³é”®è¯è¿›è¡Œè¯†åˆ«ï¼Œå¹¶ä¸ºç”¨æˆ·æä¾›ä¸€äº›ä¸å…¶é—®é¢˜ç›¸å…³çš„æ–‡ç« æˆ–å·²çŸ¥è§£å†³æ–¹æ¡ˆï¼Œæˆ–è€…å¯ä»¥å‘ç”¨æˆ·æå‡ºä¸€äº›æ¾„æ¸…æ€§é—®é¢˜ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£å…¶é—®é¢˜ï¼Œå¹¶æä¾›ç›¸åº”çš„ç­”æ¡ˆã€‚\n\t- éƒ¨åˆ†å¯å®ç°\n\t- å…³é”®å­—è¯†åˆ«èƒ½åŠ›è¾ƒå¼±\n- ç»™ zadig æä¾›è‡ªç„¶è¯­è¨€ç•Œé¢ã€‚\n\t- Plugin\n- å·¥ä½œæµå…¨æµç¨‹æ—¥å¿—ï¼ˆæ„å»ºã€éƒ¨ç½²ã€æµ‹è¯•ç­‰ï¼‰ã€è¿è¡Œæ—¶åº”ç”¨å®æ—¶æ—¥å¿—ï¼Œä¸ ChatGPT ç»“åˆåˆ†æè¯Šæ–­é—®é¢˜å¹¶è¿›è¡Œä¼˜åŒ–ï¼Œåšè´¨é‡æ´è§ã€‚\n\t- æ—¥å¿—å¤ªé•¿ï¼Œæœ‰æ•ˆä¿¡æ¯å¤ªå°‘\n- ç»“åˆ Zadig äº§ç”Ÿçš„ç ”å‘è¿‡ç¨‹æ•°æ®è¿›è¡Œæ•°æ®æ´å¯Ÿï¼Œé€šè¿‡è‡ªç„¶è¯­è¨€å¤„ç†ï¼Œè¯†åˆ«æ•°æ®ä¸­å¯èƒ½è¢«å¿½ç•¥çš„æ¨¡å¼å’Œè¶‹åŠ¿ï¼Œå¹¶ä¸ºä¼ä¸šæä¾›æ›´æœ‰æ„ä¹‰çš„è§è§£ã€‚\n\t- ChatGPT æ²¡æœ‰è‡ªå·±çš„æ€ç»´ã€æƒ³æ³•ï¼Œè¿˜æ˜¯éœ€è¦ç”¨å¤§é‡æ•°æ®å¯¹å…¶è¿›è¡Œè®­ç»ƒï¼Œæ‰èƒ½äº§ç”Ÿè‡ªå·±çš„è§è§£ã€‚å°æ ·æœ¬æ•ˆæœå¾…å®šã€‚\n\t- Lilian æˆ– Minmin ç®€å•æµ‹è¯•ä¸€ä¸‹\n\t- Plugin æ¥å…¥\n- ChatGPT æ·±åº¦é›†æˆ zadigï¼Œå¯ä»¥æ ¹æ® promptï¼Œè‡ªåŠ¨ç”Ÿæˆæ„å»ºè„šæœ¬ï¼Œåˆ›å»ºå¹¶æ‰§è¡Œå·¥ä½œæµï¼Œå®ç°æ„å»ºã€éƒ¨ç½²ç­‰ä¸€ç³»åˆ—ä»»åŠ¡ï¼Œå®Œæˆä¸€ä¸ªå®Œæ•´çš„ devops æµç¨‹ã€‚\n\t- å…¶ä¸­ ChatGPT å®ç°åˆ†è§£ä»»åŠ¡ã€ç”Ÿæˆè„šæœ¬ã€æ¥å…¥å¹³å°ï¼Œåˆ†å‘ä»»åŠ¡ç­‰ã€‚\n\t- å› ä¸ºæ·±åº¦é›†æˆï¼Œéœ€è¦ ChatGPT æ’ä»¶æˆ–è€…å®šåˆ¶å¼€æºå®ç°ï¼Œæ¥å®Œæˆæ­¤åŠŸèƒ½ã€‚\n\t- ChatGPT tokens é™åˆ¶ï¼ˆå…¶ä»–æ¨¡å‹å®ç°é¡¹ç›®åˆ†æï¼‰\n\t- å®‰å…¨é£é™©ï¼Œå°†å…¨éƒ¨ä»£ç ä¸Šä¼ åˆ°ChatGPT\n","lastmodified":"2023-05-18T16:10:30.616349313Z","tags":[]},"/Spaces/Zadig/warpdrive":{"title":"warpdrive","content":"","lastmodified":"2023-05-18T16:10:30.616349313Z","tags":[]}}